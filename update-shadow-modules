#!/bin/sh
read -p "You will lose all changes that have not been pushed to GitHub. Are you sure? " -n 1 -r
echo    # (optional) move to a new line
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    exit 1
fi
DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
echo "STEP 1: resetting node_modules"
cd $DIR; rm -rf node_modules; git checkout node_modules
echo ""
echo "STEP 2: checking out submodules"
$DIR/branch-setup
echo ""
echo "STEP 3: running npm install (may take a while)"
npm install
cd $DIR/node_modules/ez-mailer; npm install
cd $DIR/node_modules/streamline-upload; npm install
cd $DIR/node_modules/syracuse-phantomjs; npm install
echo ""
echo "STEP 4: running npm dedup (may take a while)"
cd $DIR; npm dedup
echo ""
echo "STEP 5: running npm-shadow"
cd $DIR/node_modules; node npm-shadow
echo ""
echo "STEP 6: resetting node_modules (again)"
cd $DIR; rm -rf node_modules; git checkout node_modules
echo ""
echo "STEP 7: checking out submodules (again)"
$DIR/branch-setup
