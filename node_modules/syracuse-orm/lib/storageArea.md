# Storage Area API  
```javascript
var sa = require('syracuse-orm/lib/storageArea')  
```
This module is exported to be able to be call from X3
-------------
## getDocumentInstance function :
``` javascript
var document = sa.getDocumentInstance(_, filter, volume); 
```
Retrieve document instance from storage area.  

* The `filter` parameter represents filter selector :  

``` javascript
var filter = {
  jsonWhere:{
    $uuid: uuid
  }
}  
```
* The `volume` parameter represents the name of the volume where a new document will be stored.
* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  

Returns a Document entity  

-------------
## readAll function :
``` javascript
var document = sa.readAll(_, filter); 
```
Read document from storage area.  

* The `filter` parameter represents filter selector :  

``` javascript
var filter = {
  jsonWhere:{
    $uuid: uuid
  }
}  
```

* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  

Returns a Document entity  

-------------
## writeAll function :
``` javascript
var document = sa.writeAll(_, properties, buf, filter, volume);  
```
Update document in storage area if filter is valid, else Create it. 

* The `properties` parameter represents the document properties in JSON format :  

``` javascript
var properties = {
  description: "UPDATE",
  content: {
    contentType: "application/pdf",
    fileName: "update.pdf",
  }
}
```
* The `buf` parameter represents the document in binary format.  
* The `filter` parameter represents filter selector. It's used only for update.  

``` javascript
var filter = {
       jsonWhere:{
          $uuid: uuid
       }
   }
```
* The `volume` parameter represents the name of the volume where a new document will be stored.  
* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  


Returns a Document entity.  
 
-------------
## remove function :
``` javascript
sa.remove(_, filter);  
```
Remove document from storage area.  

* The `filter` parameter represents filter selector :  

``` javascript
var filter = {
       jsonWhere:{
          $uuid: uuid
       }
   }
```

* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  

Returns 1 if operation is successful else throw Error.  
 
-------------
## open function :
``` javascript
var dd = sa.open(_, filter, options);  
``` 
Open document from storage area or create a new instance.  

* The `filter` parameter represents filter selector :  

``` javascript
var filter = {  
     jsonWhere:{
        $uuid: uuid
     }
   }
```

* The `options` parameter represents miscellanous options :  
   * The `volume` option allow to specify what Syracuse volume will be used to store the document. `STD` is used by default.  
   * The `recordSep` option MUST be used ONLY for `plain/text` documents. It permit to define records separators.  

``` javascript
var options = {  
     volume: "STD",
     recordSep: "\r\n"
   }
```

* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  

Returns a Document Descriptor UUID or null if document was not found. 
 
-------------
## write function :
``` javascript
sa.write(_, ddUuid, properties, stream); 
```   
Write content of document instance.  
This function CAN be called between `open` and `close` functions.  

* The `ddUuid` parameter represents an identifier of Document Descriptor in uuid format.  
* The `properties` parameter represents the document properties in JSON format :  

``` javascript
var properties = {
       description: "STREAM",
       content: {
           contentType: "application/pdf",
           fileName: "stream.pdf",
       }
   }
```
* The `stream` parameter represents a stream of the document in binary format.  
* The `forceSave` parameter is a boolean that decide if the document must be saved.
 
-------------
## read function :
``` javascript
sa.read(_, ddUuid , chunkSize); 
```    
Read content of document instance. 
This function CAN be called between `open` and `close` functions.  

* The `ddUuid` parameter represents an identifier of Document Descriptor in uuid format.  
* The `chunkSize` parameter represents the length to read. If its value is -1, chunkSize is ignored.
Returns a Buffer part.  
 
-------------
## close function :
``` javascript
sa.close(_, ddUuid, withSave);  
```   
Close the document store and persist the content in datastore.  
IMPORTANT : this function MUST be called after `open` function !!!!  

* The `ddUuid` parameter represents an identifier of Document Descriptor in uuid format.  
* The `withSave` parameter is a boolean that decide if the document must be saved.

Returns a Document entity.  
 
-------------
## listDocuments function :
``` javascript
var array = sa.listDocuments(_, filter, serialize, expectedProperties);  
``` 
Retrieve list of documents from storage area corresponding to the filter.  

* The `filter` parameter represents sdata filter selector :  

``` javascript
var filter = {  
     sdataWhere: "volume.code eq 'STD' and documentDate gt '2014-01-01'"
   }
```
* The `serialize` boolean parameter defines if the result must be an array of instances of if it must be serialized as JSON array.
* The `expectedProperties` parameter allows to define what properties will be returned if `serialize` parameter is set to `true`.

``` javascript
var expectedProperties = [  
     'description',
     'fileName',
     'documentType'
   ]
```

* The `entityName` parameter allows to define what entity will be used. The entity `document` is used by default.  

Returns an array of Documents as instances or JSON array (depends on `serialize` parameter). 
 
