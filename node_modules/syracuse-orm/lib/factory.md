# Factory API  
```javascript
var factory = require('syracuse-orm/lib/factory')  
```

-------------
## Stream property getProperties function :
``` javascript
var props = anInstance.content(_).getProperties(_); 
```

Returns the stored element properties (file size, content type, ...)  

-------------
## Stream property fileExists function :
``` javascript
var isThere = anInstance.content(_).fileExists(_); 
```

-------------
## Stream property createWorkingCopy function :
``` javascript
anInstance.content(_).createWorkingCopy(_); 
```

creates a new file for storage, to use for two phase update: when using a workingCopy, one must have persist changes of the file
before invoke "Save" on the object. So we should create a new file for update, then "Save" will persist object's pointer to the new file.

-------------
## Stream property createReadableStream function :
``` javascript
var stream = anInstance.content(_).createReadableStream(_); 
var buf;
while(buf = stream.read(_))
  doSomething(buf);
```

------------
## Stream property createWritableStream function :
``` javascript
var stream = anInstance.content(_).createWritableStream(_); 
while(buf = something)
  stream.write(_, buf, encoding);
stream.end(lastMessage, encoding, _);
```
NOTE: the "end" signature isn't standard as normaly doesn't take a callback. But Mongodb "GridFS" driver needs it
so make sure you passe a callback in las parameter of "end"

-------------
## Collections toArray function :
``` javascript
var array = anInstance.myList(_).toArray(_); 
```

returns an array of elements or an array of snapshots if the parent is an snapshot

-------------
## Collections toUuidArray function :
``` javascript
var array = anInstance.myList(_).toUuidArray(_); 
```

return an array of uuids (to avoid instanciation)

-------------
## Collections deleteInstance function :
``` javascript
anInstance.myList(_).deleteInstance(_, instanceId); 
```

removes the instance identified by instanceId from the collection

-------------
## Collections reset function :
``` javascript
anInstance.myList(_).reset(_); 
```

Removes all elements from the collection

-------------
## Collections get function :
``` javascript
var elem = anInstance.myList(_).get(_, uuid); 
```

-------------
## Collections add function :
``` javascript
var newElem = anInstance.collection(_).add(_); 
```
Creates a new element and adds it to the collection  

Returns the created new element  

-------------
## Collections set function :
``` javascript
var array = anInstance.myList(_).set(_, anInstance); 
```

-------------
## Collections filter function :
``` javascript
var options = {
    jsonWhere: {
      title: "some title"
    }
}
var array = anInstance.myList(_).filter(_, options); 
```

returns an array of collection elements filtered with an expression. Doesn't affect the collection itself
* options - object allowing to pass the filter as one of the properties
- jsonWhere : json like
- sdataWhere : string of sdata syntax
- where : parsed tree of sdata syntax

-------------
## Collections isEmpty function :
``` javascript
var empty = anInstance.myList(_).isEmpty(); 
```

-------------
## Collections getLength function :
``` javascript
var array = anInstance.myList(_).getLength(); 
```

-------------
## Factory createInstance function :
``` javascript
var newInstance = entity.factory.createInstance(_, initialData, dbConnection); 
```
Creates a new instance of entity. If initial data is provided (existing object), it uses it to initialize the instance or creates a new object otherwise
dbConnection must be provided as an instance of the database driver

Returns the created new element  

-------------
## Factory replyInstances function :
``` javascript
var factory = require("syracuse-orm/lib/factory");
...
factory.replyInstances(_, context); 
```
Replies the request with an array of resources based on the context object  
The context must provide the database abstraction, an entity and the filters
-------------
## Factory fetchInstance function :
``` javascript
var factory = require("syracuse-orm/lib/factory");
...
var instance = factory.fetchInstance(_, context); 
```
Fetches an instance based on the context object  
The context must provide the database abstraction, an entity and the instanceId
Returns the fetched element or null  

-------------
## Factory replyInstance function :
``` javascript
var factory = require("syracuse-orm/lib/factory");
...
factory.replyInstance(_, context); 
```
Replies the request with a resource based on the context object  
The context must provide the database abstraction, an entity and the instanceId
