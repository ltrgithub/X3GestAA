"use strict";
var program = require('commander');
var config = require('../index').config;

if (!config.etna) throw new Error("config.etna missing");

//process.exit(0);


program
	.version("0.1.0", '-v, --version')
	.option('-e, --exportMeta', 'export metadata and push it to git')
	.option('-i, --importMeta', 'retrieve metadata from git and import it to modigdb/sql database')
	.option('-E, --exportData', 'export data from source sql database')
	.option('-I, --importData', 'import data into destination oracle database')
	.option('-t, --test', 'export a test subset')
	.parse(process.argv);

var sync = require("etna-etl/lib/sync").newSync(config.etna, config.etna.trace);

var t0 = Date.now();

if (program.exportMeta) sync.exportMetadataAndPush(_);
else if (program.importMeta) sync.importMetadata(_);
else if (program.exportData) sync.exportData(_);
else if (program.importData) sync.importData(_);
else if (program.test) sync.exportMetadataAndPush(_, ['ATABLE', 'AABREV']);
else
	program.outputHelp();

config.etna.trace && config.etna.trace("execution completed in " + Math.round((Date.now() - t0) / 1000) + " seconds");

process.exit(0);