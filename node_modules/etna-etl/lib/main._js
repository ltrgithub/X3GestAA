"use strict";
var config = {
	sql: {
		driver: "sqlServer",
		user: "sa",
		password: "nbo32tyu",
		database: "demoSbf",
		hostname: "127.0.0.1"
	},
	mongo: {
		database: 'import',
		host: '127.0.0.1',
		port: 27017,
	},
};

// var supervisor = require("etna-supervisor/lib/supervisor");
// var superv = supervisor.create(_, config);
// superv.sqlDriver.backup(_, 'AdventureWorks', "C:\\Program Files\\Microsoft SQL Server\\MSSQL11.MSSQLSERVER\\MSSQL\\Backup\\test.bak");
// console.log("DONE");
// return;

"use strict";
var program = require('commander');
var config = require('../index').config;
var sync = require("etna-etl/lib/sync").newSync(config.etna, config.etna.trace);

if (!config.etna) throw new Error("config.etna missing");

// sync.exportMetadataAndPush(_, null, ["AABREV", "ABANK"], true);
// process.exit(0);

program
	.version("0.1.0", '-v, --version')
	.option('-e, --exportMeta', 'export metadata and push it to git')
	.option('-i, --importMeta', 'retrieve metadata from git and import it to modigdb/sql database')
	.option('-E, --exportData', 'export data from source sql database')
	.option('-I, --importData', 'import data into destination oracle database')
	.option('-t, --test', 'export a test subset')
	.parse(process.argv);


var t0 = Date.now();

if (program.exportMeta) sync.exportMetadataAndPush(_);
else if (program.importMeta) sync.importMetadata(_);
else if (program.exportData) sync.exportData(_);
else if (program.importData) sync.importData(_);
else if (program.test) sync.exportMetadataAndPush(_, ['ATABLE', 'AABREV']);
else
	program.outputHelp();

config.etna.trace && config.etna.trace("execution completed in " + Math.round((Date.now() - t0) / 1000) + " seconds");

process.exit(0);