"use strict";

var registry = require("syracuse-sdata/lib/sdataRegistry");
var dataModel = require('syracuse-orm/lib/dataModel');

var getEndpoint = exports.getEndpoint = function(_, dataset) {
	return require('syracuse-collaboration/lib/util').getEndpoint(_, {
		application: 'syracuse',
		contract: 'support',
		dataset: dataset || "support",
	});
};
exports.getOrm = function(_, dataset) {
	dataset = dataset || "support";
	var dm = require('syracuse-orm/lib/dataModel');
	var contract = require('support-tool/lib/contract');
	dm.make(contract, dataset);
	var ep = getEndpoint(_, dataset);
	if (!ep) throw new Error("support endpoint not found: dataset=" + dataset);
	return ep.getOrm(_);
};

exports.registerEntity = function(_, name, entity) {
	var contract = require('support-tool/lib/contract').contract;
	contract.entities[name] = entity;
	dataModel.make(contract, "support");
	var ep = getEndpoint(_);
	ep.contract = contract;
	registry.register([ep]);
};