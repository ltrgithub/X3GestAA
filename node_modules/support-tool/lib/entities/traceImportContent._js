'use strict';

var datetime = require('syracuse-core/lib/types/datetime');

exports.entity = {
		$titleTemplate: 'Traces content',
		$createActionTitle: 'Import compressed traces',
		$listTitle: 'List of imports',
		$properties: {
			start: {
				$title: "Import's date",
				$isReadOnly: true,
				$isNullable: true,
			},
			name: {
				$title: "Name",
				$isReadOnly: true,
				$compute: function(_, instance) {
					var imp = instance.import(_);
					return imp.fileExists(_) ? imp.getProperties(_).fileName : null;
				},
			},
			size: {
				$title: "Size",
				$type: "integer",
				$isReadOnly: true,
				$compute: function(_, instance) {
					var imp = instance.import(_);
					return imp.fileExists(_) ? imp.getProperties(_).length : null;
				},
			},
			analysed: {
				$title: "Analysed",
				$type: "boolean",
				$isReadOnly: true,
				$default: false,			
			},
			import: {
				$title: "Import",
				$type: "binary",
				$storage: "db_file",
				$contentType: "application/octet-stream",
				$isReadOnly: function(_, instance) {
					return instance.analysed(_);
				},
				$url: function(_, instance) {
					var parent = instance._parent;
					if (parent) return "{$baseUrl}/" + parent._meta.plural + "('" + parent.$uuid + "')/contents('{$key}')/import";
					return;
				}
			},
		},
		$init: function(_, instance) {
			instance.start(_, datetime.now().toString());
		},
		$defaultOrder: [
			["start", true]
		]
};