"use strict";

var adminHelper = require("syracuse-collaboration/lib/helpers").AdminHelper;
var helpers = require("syracuse-core/lib/helpers");
var sys = require("util");

exports.tracer = null;

var _scripts = [];

_scripts[1] = function(_, db) {
	function _updateCollection(_, collName) {
		var coll = db.db.collection(collName, _);
		coll.update({
			"isFactory": null
		}, {
			$set: {
				"isFactory": false
			}
		}, {
			safe: true,
			multi: true
		}, _);
	}
	exports.tracer && exports.tracer("Executing update script to version: 1; initialize isFactory property");
	//
	_updateCollection(_, "MenuItem");
	_updateCollection(_, "MenuBlock");
	_updateCollection(_, "MenuModule");
	_updateCollection(_, "NavigationPage");
	_updateCollection(_, "LandingPage");
	//
	exports.tracer && exports.tracer("Update script to version: 1 executed");
};

exports.dataUpdate = function(_, db, actualVersion, targetVersion) {
	// force log: always
	exports.tracer = console.log;
	//
	_scripts.slice(actualVersion + 1, targetVersion + 1).forEach_(_, function(_, sequence) {
		sequence && sequence(_, db);
	});
};

exports.metadata = {
	fileId: "5e730f8922dd", // this id MUST never change and MUST be unique over all update scripts
	description: "7 patch 3 branch update script" // !important, some description, optional and can change
};