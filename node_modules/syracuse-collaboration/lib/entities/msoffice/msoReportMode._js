"use strict";

exports.entity = {
	$titleTemplate: "Word report",
	$descriptionTemplate: " ",
	$valueTemplate: " ",
	
	$isPersistent: false,
	$properties: {
        reportMode: {
            $title: "Word report",
            $enum: [{
				$value: "choose_tpl",
				$title: "Choose existing template"
			},{
				$value: "new_tpl",
				$title: "Create template"
			},{
				$value: "mod_tpl",
				$title: "Modify template"
			}],
            $default: "choose_tpl"
        },
        msoCurrentRepresentation: {
        	$title: "Representation",
        	$isDisabled: true
        },
        msoLocaleCode: {
        	$title: "Locale Code",
			$lookup: {
				entity: "lookupLocale",
				field: "name"
			}
        	//$isDisabled: true
        }
	},
    $relations: {
    	document: {
			$title: "Template",
			$type: "msoWordTemplateDocument",
			$isDisabled: function(_, instance) {
                return instance.reportMode(_) === "new_tpl";
			},
			$isMandatory: function(_, instance) {
				return instance.reportMode(_) !== "new_tpl";
			},
			$lookupFilter: function(_, instance) {
			console.log(instance.msoLocaleCode(_) + " - " + instance.msoCurrentRepresentation(_));
				return { 
					"$and": [{
						"templateClass": instance.msoCurrentRepresentation(_)
					}, {
						"templateType": "report"
					}, {
						"localeCode": instance.msoLocaleCode(_)
					}]
				};
			} 
    	}
	}
}
