"use strict"

exports.entity = {
	$titleTemplate: "Import session types",
	$valueTemplate: "{entityName}",
	$properties: {
		entityName: {
			$title: "Entity"
		},
		errorDiags: {
			$title: "Errors",
			$isArray: true
		},
		warnDiags: {
			$title: "Warnings",
			$isArray: true
		}
	},
	$relations: {
		createdObjects: {
			$title: "Created objects",
			$type: "importSessionTypes",
			$isDynamicType: true
		},
		updatedObjects: {
			$title: "Updated objects",
			$type: "importSessionTypes",
			$isDynamicType: true
		}
	},
	$functions: {
		undo: function(_, options) {
			var o = options || {};
			var self = this;
			self.createdObjects(_).toArray(_).forEach_(_, function(_, obj) {
				obj.deleteSelf(_);
				obj.getAllDiagnoses(_, self.$diagnoses, {
					addEntityName: true,
					addPropName: true
				});
				if(!(self.$diagnoses || []).some(function(d) {
					return d.severity === "error";
				}))
					self.createdObjects(_).deleteInstance(_, obj.$uuid);
			});
		}
	}
}