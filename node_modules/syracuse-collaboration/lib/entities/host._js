"use strict";
var config = require('syracuse-main/lib/nodeconfig').config;
var mock = require('syracuse-load/lib/mock')
			
exports.entity = {
	$properties: {
		hostname: {
			$title: "Host name",
			$isMandatory: true,
			$isUnique: true
		},
		nannyPort: {
			$title: "Port of nanny process",
			$type: "integer",
			$isMandatory: true,
			$default: 8123
		},
		children: {
			$title: "Number of child processes",
			$isMandatory: true,
			$type: "integer" 			
		},
		active: {
			$title: "active",
			$type: "boolean",
			$default: true
		},
		started: {
			$title: "started",
			$type: "boolean",
			$default: false,
			$isReadOnly: true			
		},
		pid: {
			$title: "PID",
			$type: "integer",
			$default: 0,
			$isReadOnly: true
		}
	},
	$titleTemplate: "Syracuse Hosts",
    $valueTemplate: "Syracuse Hosts",
    $descriptionTemplate: "Syracuse Hosts",
    $relations: {
    },
    $functions: {
    },
	$services: {
	},
	$events: {
		$afterSave: [function(_, instance) { // update nanny processes
			if (config.mockServer) {
				var options = { path: "/nannyCommand/notifyNannies/update", method: "PUT", hostname: "", port: 0};
				console.log("11oooooooooooooooooMock client")
				try {
					console.log(mock.simpleRequest(config.mockServer.mockClient, options, null, _));			
				} catch (e) {
					console.log("Error "+e);
				}

			}
		}]
	},
	$searchIndex: {
		$fields: ["hostname"]
	},
	$defaultOrder: [["hostname", true]],
};
