"use strict";

var fs = require('fs');
var fsp = require('path');

exports.entity = {
	$properties: {
		name: {
			$title: "Name"
		},
		englishName: {
			$title: "English name"
		},
		nativeName: {
			$title: "Native name"
		}
	},
	$fetchInstances: function(_, context, parameters) {
		// TODO: filters
		var self = this;
		var locales = exports.readLocales(_);
		return locales.map_(_, function(_, localeParams) {
			var instance = self.factory.createInstance(_, null, context.db, context);
			instance.name(_, localeParams.name);
			instance.englishName(_, localeParams.englishName);
			instance.nativeName(_, localeParams.nativeName);
			return instance;
		});
	},
	$defaultOrder: [["name", true]]
}
exports.readLocales = function(_) {
	var dirname = fsp.join(__dirname, "../../../syracuse-core/lib/types/resources");
	var files = fs.readdir(dirname, _).filter(function(file) { return file.match(/\.json$/); });
	var locales = files.map_(_, function(_, file) {
		return JSON.parse(fs.readFile(fsp.join(dirname, file), "utf8", _));		
	});
	return locales;
}