"use strict";

var fs = require('fs');
var fsp = require('path');

exports.entity = {
	$properties: {
		name: {
			$title: "Name"
		},
		englishName: {
			$title: "English name"
		},
		nativeName: {
			$title: "Native name"
		}
	},
	$fetchInstances: function(_, context, parameters) {
		// TODO: filters
		var self = this;
		//
		var dirname = fsp.join(__dirname, "../../../syracuse-core/lib/types/resources");
		var files = fs.readdir(dirname, _).filter(function(file) { return file.match(/\.json$/); });
		// construct full list as we should sort and filter it before pagination
		var preliminary = [];
		files.forEach_(_, function(_, file) {
			var localeParams = JSON.parse(fs.readFile(fsp.join(dirname,file), "utf8", _));
			//
			var instance = self.factory.createInstance(_, null, context.db, context);
			instance.name(_, localeParams.name);
			instance.englishName(_, localeParams.englishName);
			instance.nativeName(_, localeParams.nativeName);
			preliminary.push(instance);
		});
		//
		return preliminary;
	},
	$defaultOrder: [["name", true]]
}