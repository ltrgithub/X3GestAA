"use strict";

exports.entity = {
	$isPersistent: false,
	$canEdit: false,
	$canDelete: false,
	$properties: {
		version: {}
	},
	$relations: {
		endpoints: {
			$type: "aboutEndpoints",
			$isChild: true
		}
	},
	$functions: {
		$setId: function(_, context, id) {
			var self = this;
			var db = self._db; // already admin database
			// dummy 
			self.version(_, "1.0.0.0");
			db.fetchInstances(_, db.getEntity(_, "endPoint"), {}).forEach_(_, function(_, ep) {
				// keep only X3 protocol endpoints for now to avoid test endpoints
				if (ep.protocol(_) === "x3") {
					var a_ep = self.endpoints(_).add(_);
					a_ep.dataset(_, ep.dataset(_));
					a_ep.description(_, ep.description(_));
					a_ep.epBaseUrl(_, ep.getBaseUrl(_));
				}
			});
		}
	}
};