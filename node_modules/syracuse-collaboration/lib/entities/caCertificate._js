"use strict";
var util = require('util');
var cert = require('./certificate');


exports.entity = {
		$properties: {
			name: {
				$title: "Name",
				$isMandatory: true,
				$isUnique: true
			},
			certificate: {
				$title: "CA Certificate",
				$type: "binary",
				$storage: "db_file",
				$isMandatory: true
			},
			dn: {
				$title: "Distinguished name",
				$isReadOnly: true
			},
			issuerDn: {
				$title: "Issuer distinguished name",
				$isReadOnly: true
			}
		},
		$titleTemplate: "Certificates of Certification Authorities",
		$valueTemplate: "{name}",
		$events: {
			$beforeSave: [function(_, instance) {
				var cl = instance.certificate(_);
				if (cl.fileExists(_)) {
					var pemInput = cl.createReadableStream(_).read(_, -1).toString();
					cert.fillInstance(instance, pemInput, _);
				}
			}],
			$afterSave: []
		},
		$searchIndex: {
			$fields: ["name"]
		},
		$functions: {
		},
		$defaultOrder: [["name", true]],
		$services: {
		}
}