"use strict";

// Meta entity containing metadata for sync protocol
exports.entity = {
	$canCreate: false,
	$canDelete: false,
	$canEdit: false,
	$properties: {
		name: {
			$title: "Entity name",
			$isMandatory: true,
			$isUnique: true,
			$linksToDetails: true
		},
		tick: {
			$title: "Tick",
			$type: "integer",
			$default: 0
		},
		conflictPriority: {
			$title: "Conflict priority",
			$type: "integer",
			$maximum: 9
		},
		endpoint: {
			$title: "Endpoint",

		},
		digest: {
			$title: "Digest",
			$type: "json"
		}
	},
	$functions: {
		makeDigest: function(_) {
			var dig = this.digest(_) || [];
			var endpoint = this.endpoint(_);
			dig.push({
				$endpoint: endpoint,
				$tick: this.tick(_),
				$conflictPriority: this.conflictPriority(_),
				$stamp: this.$updDate

			});
			return {
				$origin: endpoint,
				$resources: dig
			};
		}
	}
};