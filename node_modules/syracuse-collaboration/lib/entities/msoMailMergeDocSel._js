"use strict"

var helpers = require("syracuse-core/lib/helpers");
var dataModel = require("syracuse-orm/lib/dataModel");
var sdataRegistry = require("syracuse-sdata/lib/sdataRegistry");
var streams = require("streamline/lib/streams/streams");
var adminHelper = require("syracuse-collaboration/lib/helpers").AdminHelper;

exports.entity = {
	$titleTemplate: "Create word document",
	$descriptionTemplate: " ",
	$valueTemplate: " ",
	
	$isPersistent: false,
//	$canEdit: true,
	
	$properties: {
        creationMode: {
            $title: "Create document by",
            $enum: ["use_tpl", "new_empty_doc", "new_word_tpl"],
            $enumCaptions: ["Use existing template", "New empty document", "New document by word template"],
            $default: "use_tpl"
        }
	},
    $relations: {
    	document: {
			$title: "Document",
			$type: "document",
			$isDisabled: function(_, instance) {
                return instance.creationMode(_) !== "use_tpl";
			},
			$isMandatory: function(_, instance) {
				return instance.creationMode(_) === "use_tpl";
			},
    	}
	},
	/*
	$functions: {
		$save123: function(_, saveRes) {
			var self = this;

			saveRes.$links.$location = saveRes.$links.$location || {
				$title: "Word",
				$method: "GET",
				$isHidden: true
			};

			saveRes.$clientAgent = saveRes.$clientAgent || {};
			saveRes.$clientAgent.$id = "createMailMergeDS";
			saveRes.$clientAgent.$action = "saveDSX3";
			
			//_meta.$.$validated._data._propertyStores._db._context.request.response.query.$msommdata=>
			
			// TODO: Get this information dynamically
			var msommdataUrl = "%2Fsdata%2Fsyracuse%2Fcollaboration%2Fsyracuse%2Fusers%3Frepresentation%3Duser.%24query";
			self.msommdataurl(_, msommdataUrl);
			
			//var msommdataUrl = "http://localhost:8124/syracuse-main/html/main.html?url=/sdata/syracuse/collaboration/syracuse/users?representation=user.$query";
			var linkUrl 
			linkUrl = "http://localhost:8124/msoffice/lib/word/ui/docx.html"; 
			//linkUrl = "http://localhost:8124/syracuse-main/html/main.html";
			saveRes.$links.$location.$url =	
				linkUrl + 
				"?url=" + msommdataUrl +			 
				"&Fmode=" + self.creationMode(_) + 
				"&template_uuid=" + self.document(_).$uuid;

			console.log(saveRes.$links.$location.$url);
		}
	}
	*/
}
