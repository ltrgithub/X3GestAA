"use strict";

var globals = require('streamline/lib/globals');

exports.entity = {
	$titleTemplate: "Navigation page",
	$valueTemplate: "{title}",
	$properties: {
		pageName: {
			$title: "Page name",
			$isUnique: true,
			$isMandatory: true,
			$pattern: "^[a-zA-Z0-9_]*$",
			$patternMessage: "Page name can only contain a to z, A to Z, 0 to 9 and _ caracters",
			$linksToDetails: true
		},
		title: {
			$title: "Title",
			$isMandatory: true,
			$linksToDetails: true,
			$isLocalized: true
		},
		description: {
			$title: "Description",
			$isLocalized: true
		}
	},
	$relations: {
		modules: {
			$title: "Modules",
			$type: "menuModules",
			$capabilities: "sort,reorder,delete",
			$inv: "navigationPages",
			$nullOnDelete: true
		}
	},
	$events: {
		$afterSave: [
			function(_) {
				globals.context.session && globals.context.session.resetCache && globals.context.session.resetCache("navigationPage");
			}
		]
	},
	$searchIndex: {
		$fields: ["pageName", "title", "description", "modules"]
	},
	$exportProfile: {
		$key: "pageName",
		$properties: ["title", "description"],
		$relations: {
			modules: {
				$key: "code",
				$properties: ["title", "description"],
				$relations: {
					application: {
						$key: ["application", "contract"]
					},
					submodules: {
						$key: "code",
						$properties: ["title", "description"],
						$relations: {
							application: {
								$key: ["application", "contract"]
							},
							items: {
								$variants: {
									menuBlock: {
										$key: "code",
										$properties: ["title"],
										$relations: {
											items: {
												$type: "pointer",
												$target: "$parent.items"
											}
										}
									},
									menuItem: {
										$key: "code",
										$properties: ["code", "title", "description", "linkType", "icon", "applicationMenu",
											"facet", "fusionFunction", "fusionKey", "keyParameter", "externalUrl",
											"dashboard", "target"
										],
										$relations: {
											application: {
												$key: ["application", "contract"]
											},
											endpoint: {
												$key: "dataset"
											},
											representationRef: {
												$properties: ["entity", "representation"]
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
};