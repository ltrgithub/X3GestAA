"use strict";

var sys = require("util");

exports.entity = {
	$titleTemplate: "Menu module",
	$valueTemplate: "{title}",
	$properties: {
		code: {
			$title: "Code",
			$isUnique: true,
			$isMandatory: true
		},
		title: {
			$title: "Title",
			$isMandatory: true,
			$isLocalized: true
		},
		description: {
			$title: "Description",
			$isLocalized: true
		}
	},
	$relations: {
		submodules: {
			$title: "Submodules",
			$type: "menuBlocks",
			$capabilities: "sort,reorder,delete"
		},
		application: {
			$title: "Application",
			$type: "application",
			$isMandatory: true
		},
		endpoints: {
			$title: "Endpoints",
			$type: "endPoints"
		}
	},
	$events: {
		$afterSave: [function(_, instance, params) {
			console.log("params (40) " + sys.inspect(params));
			// add module to origin page
			if (params && params.originPage) {
				var page = instance._db.fetchInstance(_, instance._db.getEntity(_, "navigationPage"), params.originPage);
				if (page) {
					page.modules(_).set(_, instance.$uuid);
					page.save(_, null, {
						shallowSerialize: true
					});
				}
			}
		}]
	}
};
