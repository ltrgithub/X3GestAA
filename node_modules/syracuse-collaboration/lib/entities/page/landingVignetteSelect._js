"use strict";

var adminHelper = require("syracuse-collaboration/lib/helpers").AdminHelper;
var locale = require("syracuse-core/lib/locale");

exports.entity = {
	$titleTemplate: "Select vignette",
	$valueTemplate: "{endpoint}",
	$properties: {},
	$relations: {
		endpoint: {
			$title: "Endpoint",
			$type: "endPoint",
			$propagate: function(_, instance) {
				instance.application(_, instance.endpoint(_) && instance.endpoint(_).applicationRef(_));
			}
		},
		application: {
			$title: "Application",
			$type: "application",
			$isHidden: true
		}
	},
	$links: function(_, instance) {
		function _makeLink(title, type) {
			return {
				$title: title,
				$url: lkUrl.replace("{itemType}", type),
				$method: "GET",
				$isDisabled: !enabled
			};
		}
		var lks = {};
		var admEp = adminHelper.getCollaborationEndpoint(_);
		var lkUrl = admEp.getBaseUrl(_) + "/portlets?representation=portlet.$query&include=categories&count=200";
		lkUrl += "&" + encodeURIComponent("where=((type eq '$page') and (itemType eq '{itemType}'))");
		var enabled = instance.endpoint(_) != null;
		lks.requests = _makeLink(locale.format(module, "requestsTitle"), "$request");
		lks.processes = _makeLink(locale.format(module, "processesTitle"), "$process");
		lks.stats = _makeLink(locale.format(module, "statsTitle"), "$stats");
		lks.representation = _makeLink(locale.format(module, "representationTitle"), "$representation");
		lks.extLink = _makeLink(locale.format(module, "extLinkTitle"), "$external");
		//
		return lks;
	}
};