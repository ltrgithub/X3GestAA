"use strict";

var adminHelper = require("syracuse-collaboration/lib/helpers").AdminHelper;
var locale = require("syracuse-core/lib/locale");

exports.entity = {
	$titleTemplate: "Select vignette",
	$valueTemplate: "{endpoint}",
	$properties: {},
	$relations: {
		endpoint: {
			$title: "Endpoint",
			$type: "endPoint",
			$propagate: function(_, instance) {
				instance.application(_, instance.endpoint(_) && instance.endpoint.applicationRef(_));
			}
		},
		application: {
			$title: "Application",
			$type: "application",
			$isHidden: true
		}
	},
	$links: function(_, instance) {
		var lks = {};
		var admEp = adminHelper.getCollaborationEndpoint(_);
		var lkUrl = admEp.getBaseUrl(_) + "/portlets?representation=portlet.$query&search=*";
		lkUrl += "&" + encodeURIComponent("where=((type eq '$page') and (itemType eq '{itemType}'))");
		lks.requests = {
			$title: locale.format(module, "requestsTitle"),
			$url: lkUrl,
			$method: "GET",
			itemType: "request"
		};
		lks.processes = {
			$title: locale.format(module, "processesTitle"),
			$url: lkUrl,
			$method: "GET",
			itemType: "process"
		};
		//
		return lks;
	}
};