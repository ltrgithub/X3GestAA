"use strict";

var fs = require('fs');
var fsp = require('path');

function _getPath(presentation) {
	// syntax : "facet, target, device"
	var path = presentation.split(",");
	//
	var facet = path[0].split(".");
	// add target
	facet.push(path[1] || "$page");
	//
	path = "syracuse-main/html/site/" + (path[2] || "desktop") + "/shells/" + facet.join("-") + ".json";
	return fsp.join(__dirname, "../../..") + "/" + path;
}

exports.entity = {
	$isPersistent: false,
	$events: {},
	$functions: {
		$setId: function(_, context, id) {
			var page;
			try {
				var data = fs.readFile(_getPath(id), "utf8", _);
				page = JSON.parse(data);
			} catch (e) {
				page = {};
			}
			//
			this.$resource = page;
		},
		$serialize: function(_) {
			return this.$resource;
		}
	}
};