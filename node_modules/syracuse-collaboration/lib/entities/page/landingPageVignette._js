"use strict";

exports.entity = {
	$titleTemplate: "Vignettes",
	$valueTemplate: "{vignette.title - endpoint.description}",
	$properties: {},
	$relations: {
		vignette: {
			$title: "Vignette",
			$type: "portlet",
			$isMandatory: true,
			$lookupFilter: {
				type: "$page"
			}
		},
		endpoint: {
			$title: "Endpoint",
			$type: "endPoint",
			$isMandatory: function(_, instance) {
				return !instance._parent.useCurrentEndpoint(_);
			},
			$isDefined: function(_, instance) {
				return !instance._parent.useCurrentEndpoint(_);
			}
		}
	},
	$links: function(_, instance) {
		var lks = {
			$location: instance.getLocationLink(_)
		};
		return lks;
	},
	$functions: {
		getLocationLink: function(_, baseUrlProp) {
			var res = {};
			var instance = this;
			var item = instance.vignette(_) && instance.vignette(_).pageItem(_);
			var ep = null;
			if (!instance._parent.useCurrentEndpoint(_)) ep = instance.endpoint(_);
			return item && item.getLink(_, ep, baseUrlProp || "{$selectedEPBaseUrl}");
		}
	}
};