"use strict";
// JavaScript Document
var path = require("path");

var config = require(path.resolve("nodelocal.js")).config || {};
var tracer = (config.jedi && config.jedi.debug) ? config.jedi.debug : null;

var jsonfile = require('syracuse-jedi/lib/jsonfile');
var JediFile = require('syracuse-jedi/lib/jediFile');


var AFB120 = jsonfile.read(_, "node_modules/syracuse-jedi/lib/AFB120.json");

console.log("file:", process.argv[3]);
var rflow = new JediFile(process.argv[3], 'r');

var bankStatement = rflow.parse(_, AFB120);
jsonfile.write(_, process.argv[3] + ".json", bankStatement);

var solde = 0;
for (var i in bankStatement.statements) {
	solde += bankStatement.statements[i].movement.amount;
}
console.log("oldb balance          =", bankStatement.oldBalance.amount);
console.log("computed balance solde=", bankStatement.oldBalance.amount + solde);
console.log("new balance           =", bankStatement.newBalance.amount);