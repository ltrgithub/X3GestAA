"use strict";

// JavaScript Document
// JavaScript Document
var path = require("path");
//assert = require( "assert" );

var config   = require(path.resolve("nodelocal.js")).config || {};
var tracer   = (config.jedi && config.jedi.debug)?config.jedi.debug:null;

var jsonfile = require('syracuse-jedi/lib/jsonfile');
var JediFile = require('syracuse-jedi/lib/jediFile');

/*
var CFONBAmount = require("jedi/lib/CFONBAmount");
var amount  = new CFONBAmount
console.log(amount.parse(_,"0000000245723F"));
console.log(amount.parse(_,"0000000000188{"));
*/

var AFB120 = jsonfile.read("node_modules/syracuse-jedi/lib/AFB120.json",_);
//!console.log("AFB120:",AFB120);

console.log("file:",process.argv[2]);
var rflow  = new JediFile(process.argv[2], 'r');

var bankStatement = rflow.parse(_,AFB120);
jsonfile.write(process.argv[2]+".json",bankStatement,_);

var solde = 0;
for(var i in bankStatement.statements) {
 solde += bankStatement.statements[i].movement.amount;
}
console.log("oldb balance          =",bankStatement.oldBalance.amount);
console.log("computed balance solde="     ,bankStatement.oldBalance.amount+solde);
console.log("new balance           =",bankStatement.newBalance.amount);

 
