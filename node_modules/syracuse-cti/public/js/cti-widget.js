"use strict";
var io = require('syracuse-ui/deps/socket.io-client/socket.io');

exports.create = function(container) {
	var io = container.registerSocket("/sage-cti", {
		callIn: function(data) {
			var host = window.location.protocol + "//" + window.location.host;
			var baseUrl = container.sessionInfo.selectedEndpoint().baseUrl;
			var url = host + baseUrl + "/VCTKCTIINT('" + data.tel + "~" + data.countryIsoAlpha2 + "')?representation=VCTKCTIINT.$details";
			// console.log(">>> callIn: url= " + url + ", data=" + JSON.stringify(data));
			url = host + "/syracuse-main/html/main.html?url=" + encodeURIComponent(url);
			window.open(url, "sagex3cti", "resizable=true,scrollbars=yes,status=yes,width=800,height=600");
		}
	});
	io.emit("pair", {
		user: container.sessionInfo.user
	});

	if (!syra_site.ctiPhoneCall) {
		syra_site.ctiPhoneCall = function(ctiId, tel) {
			io.emit("callOut", {
				ctiId: ctiId,
				tel: tel
			});
			// http://192.168.1.195:80/web_svc/cti/makecall.php?numagent=201&tel=0450193530
		};
	}
};