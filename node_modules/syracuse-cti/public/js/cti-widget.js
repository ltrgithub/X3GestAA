"use strict";
var io = require('syracuse-ui/deps/socket.io-client/socket.io');

exports.create = function(container) {
	// CTI popup has a name and we do not need to register a web socket for it
	if (window.name)
		return;

	var io = container.registerSocket("/sage-cti", {
		callIn: function(data) {
			var host = window.location.protocol + "//" + window.location.host;
			var baseUrl = container.sessionInfo.selectedEndpoint().baseUrl;
			var showUrl = container.menus && container.menus.$ctiGetData && container.menus.$ctiGetData.$url;
			// console.log(">>> callIn: showUrl= " + showUrl + "\n  data=" + JSON.stringify(data));

			if (showUrl) {
				var url = host + showUrl.replace(/\{\$baseUrl\}/g, baseUrl) //
					.replace(/\{\$tel\}/, data.tel) //
					.replace(/\{\$countryIsoAlpha2\}/, data.countryIsoAlpha2);
				// console.log(">>> callIn: url= " + url + ", data=" + JSON.stringify(data));
				url = host + "/syracuse-main/html/main.html?url=" + encodeURIComponent(url);
				window.open(url, "sage-x3-cti-contact", "resizable=true,scrollbars=yes,status=yes,width=800,height=600");
			}
		},
	});
	io.emit("pair", {
		user: container.sessionInfo.user
	});
};