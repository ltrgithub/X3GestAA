// first, require streamline's compilation hooks
require('streamline').register();
require('coffee-script');
require('syracuse-core/lib/localeWrapper');

var g = function() {
	return this;
}.call();

// QUnit passes the QUnit.assert (its API object) to async test functions, 
// which conflicts with streamline's _ callback.
// So we override asyncTest to pass a real callback to async test functions
var asyncTest = g.asyncTest;
g.asyncTest = function() {
	var fn = arguments[arguments.length - 1];
	arguments[arguments.length - 1] = function() {
		fn.call(this, function(err) {
			if (err) throw err;
		});
	};
	asyncTest.apply(this, arguments);
};
