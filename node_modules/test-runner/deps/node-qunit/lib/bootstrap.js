var qunit = require( "./qunit" ),
path = require( "path" ),
options = JSON.parse( process.argv[2] );
//console.error("OPTIONS: " + JSON.stringify(options.streamline));
require('coffee-script/lib/coffee-script/extensions');
require('streamline').register(options.streamline);
var globals = require('streamline/lib/globals');
globals.context = {};
if (options.tenantId != null) globals.context.tenantId = options.tenantId;
require('syracuse-core/lib/localeWrapper');
require('./qunitWrapper');


// add paths to require
if ( options.paths ) {
	require.paths.push.apply( require.paths, options.paths );
}

try {
	// require code
	qunit.extend( global, require( options.code.replace( /\.js$/, "" ) ) );

	// require tests
	options.tests.forEach( function( test ) {
		require( test.replace( /\.js$/, "" ) );
	});
	if ( options.coverage ) {
		QUnit.done = function() {
			console.log(
			JSON.stringify({
				cov: _$jscoverage
			}));
		};
	}

	QUnit.begin();
} catch (ex) {
	console.log( JSON.stringify({
		module: "bootstrap",
		name: options.code,
		message: ex.message,
		errorStack: ex.stack
	}));
}

