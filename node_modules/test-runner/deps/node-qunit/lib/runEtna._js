var globals = require('streamline/lib/globals');

function run_(_, config, options, mod, handleError) {
	if (!config.unit_test || !config.unit_test.etnaEndPoint) throw new Error("config.unit_test.etnaEndPoint missing in nodelocal.js")
	var superv = require("etna-supervisor/lib/supervisor").create(_, config.unit_test.etnaEndPoint);
		require("etna-engine/lib/runtime/variables").initStack(superv);
	globals.context.x3frame.loc.file = options.code;
	mod.MAIN(_);
	QUnit.begin();
}

exports.run = function(config, options, mod, handleError) {
	return run_(_ >> handleError, config, options, mod, handleError);
}