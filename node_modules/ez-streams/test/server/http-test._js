"use strict";

QUnit.module(module.id);

var ez = require('ez-streams');

var server;
asyncTest("Echo service test", 3, function(_) {
    server = ez.devices.http.server(function(req, res, _) {
        if (req.method === "POST") {
            var text = req.readAll(_);
            strictEqual(text, "post test", "Post test: writer ok");
            res.statusCode = 201;
            res.end("reply for POST");
        }
        if (req.method === "GET") {
            res.end("reply for GET");
        }
    });
    server.listen(_, 3004);
    var writer = ez.factory("http://localhost:3004").writer(_);
    writer.write(_, "post test");
    strictEqual(writer.write(_, undefined), "reply for POST", "Get for POST ok");
    //
    var reader = ez.factory("http://localhost:3004").reader(_);
    strictEqual(reader.read(_), "reply for GET", "Get test: reader ok");
 
    start();
});

