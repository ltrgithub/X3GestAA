
# PrintClient
## createClient
```javascript
PrintClient = require('syracuse-print/lib/PrintClient');  
```


## getMimeFromExport  
```javascript
var mimeType = PrintClient.getMimeFromExport(exportFormat);  
```


var printClient = PrintClient.createClient(_, hostname, port);
```
Instanciate print server client and initialize connection.  

* The `hostname` parameter is the print server hostname.  
* The `port` parameter is the print server port.  

-------------
## getAllPrinters :
``` javascript
var printers = printClient.getAllPrinters(_);  
```
Retrieve all printers informations and capabilities defined on print server.  

Returns an array :  
``` javascript
	[  
	  {  
	    "printerName": "\\\\172.28.8.4\\HP3390-grenoble",  
	    "printerPort": "172.28.8.151",  
	    "driverName": "HP Universal Printing PCL 5",  
	    "comment": "",  
	    "location": "",  
	    "collate": true,  
	    "copies": true,  
	    "orientation": true,  
	    "duplex": true  
	  },  
	  {  
		"printerName": "\\\\172.28.8.4\\KONICA Grenoble",  
		"printerPort": "172.28.8.152",  
		"driverName": "KONICA MINOLTA 423SeriesPCL",  
		"comment": "",  
		"location": "",  
		"collate": true,  
		"copies": true,  
		"orientation": true,  
		"duplex": true  
		  }  
	]  
```

-------------
## getAdvancedParameters :
``` javascript
var infos = printClient.getAdvancedParameters(_, '\\172.28.8.4\HP3390-grenoble', '172.28.8.151', 'HP Universal Printing PCL 5');  
```
Retrieve the list of printers defined on print server.  

* String : The `printerName` parameter is the name of the printer.  
   eg: '\\172.28.8.4\HP3390-grenoble'  
* String : The `printerPort` parameter is the port definition of the printer. (optional)  
   eg: '172.28.8.151'  
* String : The `printerDriver` parameter is the driver reference. (optional)  
   eg: 'HP Universal Printing PCL 5'  

Returns an object that contains paperSize and tray informations :  
``` javascript
{  
  "paperSize": [  
    {  
      "id": 1,  
      "name": "Letter"  
    },  
    {  
      "id": 8,  
      "name": "A3"  
    },  
    {  
      "id": 9,  
      "name": "A4"  
    },  
    ...  
  ],  
  "bac": [  
    {  
      "id": 15,  
      "name": " Sélection automatique"  
    },  
    {  
      "id": 257,  
      "name": " Printer auto select"  
    },  
    ...  
  ]  
}  
```

-------------
## getExtraParameters :
``` javascript
var extra = printClient.getExtraParameters(_, '\\172.28.8.4\HP3390-grenoble', '172.28.8.151', 'HP Universal Printing PCL 5', 9);  
```
Retrieve a paper size.  

* String : The `printerName` parameter is the name of the printer.  
   eg: '\\172.28.8.4\HP3390-grenoble'  
* String : The `printerPort` parameter is the port definition of the printer. (optional)  
   eg: '172.28.8.151'  
* String : The `printerDriver` parameter is the driver reference. (optional)  
   eg: 'HP Universal Printing PCL 5'  
* Number : The `printerPaperSize` parameter is the id of paperSize.  
           This id could be retrieve with 'getExtraParameters' function.  
   eg: '9' for A4 paper  

Returns an object that contains width and length of selected paper :  
``` javascript
	{  
	  "$width": 2100,  
	  "$length": 2970  
	}  
```

-------------
## listPrinters :
``` javascript
var list = printClient.listPrinters(_);  
```
Retrieve the list of printers defined on print server.  

Returns a javascript object :  
``` javascript
{  
  "_NbPrinters": 3,  
  "_PrinterName000": "\\\\172.28.8.4\\HP3390-grenoble",  
  "_PrinterName001": "Microsoft XPS Document Writer",  
  "_PrinterName002": "\\\\172.28.8.4\\KONICA Grenoble"  
}  
```

-------------
## launchReport :
``` javascript
var seqId = printClient.launchReport(_, properties);  
```
Launch a report.  

* Object : The `properties` parameter is a JSON object that contains severals report informations.
           '__wJobID' property is the id that will be used by 'getState' and 'getReport' functions.  

``` javascript
{  
  "_FormatExport": "29",  
  "__REPORT": "TABCOUNTRY.rpt",  
  "__DESTINATION": "3",  
  "__TYPDBA": "1",  
  "__DBDATABASE": "X3DVLP",  
  "__DBUSER": "SUPERV",  
  "__DBPASSWORD": "password",  
  "__WSTATION": "host.sagefr.adinternal.com",  
  "__CDUSER": "USR",  
  "__ADXSOL": "SOLSUPV6",  
  "__APPLICATION": "SUPERV;sodaix02;17000",  
  "__APPRPT": "SUPERV;sodaix02;17000",  
  "__RPTLAN": "FRA",  
  "X3DOS": "SUPERV;sodaix02;17000;150;FRA",  
  "__JOBLINKED": "",  
  "__REQUETE": "25561900",  
  "_Orientation": "0",  
  "_PaperSize": "44",  
  "X3CLI": "Superviseur 140",  
  "X3EDT": "Etat Sage X3 Entreprise Copyright Sage",  
  "X3ETA": "TABCOUNTRY",  
  "X3TIT": "Pays",  
  "X3OPE": "User",  
  "X3USR": "USR",  
  "X3LAN": "FRA",  
  "X3SIT1": "*",  
  "X3SIT2": "z",  
  "X3PRF": "ADMIN",  
  "X3FCT": "",  
  "X3SIT": "",  
  "paysdeb": " ",  
  "paysfin": "zzzzzzzzzz",  
  "impselections": "0",  
  "año": "",  
  "__wJobID": "d22e7432-aa04-4a67-8b5f-352bc9bca209"  
}  
```

Returns a Number that represents the sequence id on print server :  

-------------
## cancelReport :
``` javascript
printClient.cancelReport(_, seqId);  
```
Cancel a launched report.  

* Number : The `seqId` parameter is the sequence id on print server that is corresponding to the stacked report.  

Returns nothing.  

-------------
## getState :
``` javascript
var status = printClient.getState(_, jobId);  
```
Get report status.  

* Number : The `jobId` parameter is the id on print server that is corresponding to the report.  

List of status codes :  
```
	99 : unexpected error  
	98 : unknow job  
	97 : internal error  
	0 : job started  
	1 : read DB pending  
	2 : read finished  
	3 : read canceled  
	4 : job stacked  
	5 : job finished  
	6 : job failed  
	7 : job canceled 
```

Returns a javascript object that contains a status code and a message : 
``` javascript
	{  
	  "code": 5,  
	  "message": ""  
	}  
```

-------------
## getReport :
``` javascript
var report = printClient.getReport(_, jobId);  
```
Get report content.  

* Number : The `jobId` parameter is the id on print server that is corresponding to the report.  

Returns a javascript object : 
``` javascript
	{
	  "length": 47463,
	  "binary": "%PDF-1.7 ..."
	}
```

-------------
## listJobs :
``` javascript
var jobs = printClient.listJobs(_);  
```
Get stacked jobs informations.  

Returns a javascript array : 
``` javascript
[
  {
    "order": 1,
    "rank": 1,
    "processId": 0,
    "serverDuration": 598,
    "processDuration": 597,
    "status": "OK",
    "phase": "Printing is completed.",
    "destination": "File",
    "report": "TABCOUNTRY.rpt",
    "application": {
      "folder": "SUPERV",
      "host": "sodaix02",
      "port": "17001"
    },
    "user": "TC",
    "workstation": "host.sagefr.adinternal.com",
    "linked": null
  },...
]
```

-------------
## changePriority :
``` javascript
var jobs = printClient.changePriority(_, seqId, order);  
```
Change job's priority.  

* Number : The `seqId` parameter is the sequence id on print server that is corresponding to the stacked report.   
* String : The `order` parameter the priority action to apply on job. It can be 'MIN', 'MAX', '+' or '-'.  

Returns a javascript object : 
``` javascript
{
  "ChangeOrderRptJob": "1"
}
```
ChangeOrderRptJob = "1" if all goes well or "0" if an error occurs

-------------
## disconnect :
``` javascript
printClient.disconnect(_);  
```
Close socket with print server.  
This function MUST be called at the end of a process.

Returns nothing  

