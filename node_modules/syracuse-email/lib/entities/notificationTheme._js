"use strict";

exports.entity = {
	$titleTemplate: "Notification themes",
	$valueTemplate: "{name}",
	$descriptionTemplate: "Theme {name}",
	$allowFactory: true,
	$properties: {
		name: {
			$title: "Name",
			$isMandatory: true,
			$isUnique: true,
			$linksToDetails: true
		},
		html: {
			$title: "HTML body",
			$type: "text/html",
		}
	},
	$relations: {
		images: {
			$title: "Attached images",
			$type: "notificationThemeImages",
			$isChild: true,
			$capabilities: "append,delete,sort",
			$cascadeDelete: true
		},
	}
};

exports.imgEntity = {
	$titleTemplate: "Theme image",
	$valueTemplate: "{name}",
	$descriptionTemplate: "Image",
	$properties: {
		name: {
			$title: "Name",
			$isMandatory: true,
			$isUnique: true
		},
		size: {
			$title: "Size",
			$type: "integer",
			$compute: function(_, instance) {
				var file = instance.file(_);
				return file.fileExists(_) ? file.getProperties(_).length : null;
			},
		},
		file: {
			$title: "File",
			$type: "binary",
			$isDisabled: false,
			$storage: "db_file",
			$url: function(_, instance) {
				var parent = instance._parent;
				if (parent) return "{$baseUrl}/" + parent._meta.plural + "('" + parent.$uuid + "')/images('{$key}')/recording";
				return;
			}
		}
	}
};