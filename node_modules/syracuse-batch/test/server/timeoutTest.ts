"use strict";
var X3BatchClient = require('syracuse-batch/lib/batchManager').X3BatchClient;
// Test for passphrase encryption
var tracer; // = console.error;

import { assert } from 'chai';
Object.keys(assert).forEach(key => {
	if (key !== 'isNaN') global[key] = assert[key];
});

describe(module.id, () => {

	it("interrupt test", function(_) {
		var time1 = Date.now();
		var b = new X3BatchClient();
		ok(!b.setInterruptibleTimeout(_, 200, 1), "Timeout with waiting");
		var time2 = Date.now();
		ok(time2 - time1 >= 180, "Wait time");
		ok(!b.setInterruptibleTimeout(_, 1200, 1), "Timeout with waiting");
		var time3 = Date.now();
		ok(!b.interrupt(1), "Timeout cleared");
		ok(time3 - time2 >= 1180, "Wait time 2");
		var future = b.setInterruptibleTimeout(!_, 10000, 1);
		setTimeout(_, 200);
		ok(b.interrupt(1), "Timeout interrupted");
		ok(!b.interrupt(1), "Timeout cleared");
		var time3 = Date.now();
		ok(future(_), "Interrupted timeout");
		var time4 = Date.now();
		ok(time4 - time3 < 1000, "Timeout finished early");
		ok(!b.interrupt(1), "Timeout cleared2");
	});
});
