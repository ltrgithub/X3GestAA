"use strict";

var helpers = require("syracuse-core/lib/helpers");

exports.tracer = null;

var _scripts = [];
// script index MUST be target version number for this script

exports.initData = function(_, db) {
	exports.tracer && exports.tracer("Initializing database");
	// more if needed
};

_scripts[1] = function(_, db) {
	exports.tracer && exports.tracer("Executing update script to version: 1; create global traces setting");
	//
	var tsColl = db.db.collection("TraceSetting", _);
	var settings = tsColl.find({
		code: "settings"
	}).toArray(_)[0];
	if (!settings) {
		tsColl.insert({
			_id: helpers.uuid.generate(),
			"code": "settings",
			"description": "Traces settings"
		}, {});
	}

	exports.tracer && exports.tracer("Update script to version: 1 executed");
};

exports.dataUpdate = function(_, db, actualVersion, targetVersion) {
	console.log("actual=" + actualVersion + ", target=" + targetVersion);
	// force log: always
	exports.tracer = console.log;
	//
	_scripts.slice(actualVersion + 1, targetVersion + 1).forEach_(_, function(_, sequence) {
		sequence && sequence(_, db);
	});
};

exports.metadata = {
	fileId: "ac36c97b27bd",
	// this id MUST never change and MUST be unique over all update scripts
	description: "Traces configuration initialization" // !important, some description, optional and can change
};