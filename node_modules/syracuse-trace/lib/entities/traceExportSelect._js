"use strict";

var jsurl = require("jsurl");

exports.entity = {
	$titleTemplate: "Select import traces",
	$valueTemplate: "",
	$isPersistent: false,
	$canSave: false,
	$capabilities: "",
	$properties: {
		parameters: {
			$title: "Parameters",
			$isHidden: true,
			$compute: function(_, instance) {
				return jsurl.stringify(instance.toJson(_));
			}
		},
		name: {
			$isMandatory: true,
		},
		startDate: {
			$title: "Start Date",
			$type: "date"
		},
		startTime: {
			$title: "Start Time",
			$type: "time"
		},
		endDate: {
			$title: "End Date",
			$type: "date"
		},
		endTime: {
			$title: "End Time",
			$type: "time"
		},
		compress: {
			$title: "Compress",
			$type: "boolean",
			$default: false
		}
	},
	$functions: {
		toJson: function(_) {
			var instance = this;
			var startDate, endDate;
			var sDate = instance.startDate(_);
			var eDate = instance.endDate(_);
			if (sDate) {
				var sTime = instance.startTime(_);
				if (sTime) {
					startDate = new Date(sDate.year, sDate.month - 1, sDate.day, sTime.hour, sTime.minute, sTime.second);
				} else {
					startDate = new Date(sDate.year, sDate.month - 1, sDate.day);
				}
			}
			if (eDate) {
				var eTime = instance.endTime(_);
				if (eTime) {
					endDate = new Date(eDate.year, eDate.month - 1, eDate.day, eTime.hour, eTime.minute, eTime.second);
				} else {
					endDate = new Date(eDate.year, eDate.month - 1, eDate.day);
				}
			}
			return {
				name: instance.name(_),
				start: startDate && startDate.toISOString(),
				end: endDate && endDate.toISOString(),
				compress: instance.compress(_),
			};
		}
	}
};