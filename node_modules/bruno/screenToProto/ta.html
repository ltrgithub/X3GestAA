<html><head><title>typed array test</title></head>
<body><p id="log"></p>
<canvas id="canvas1" width="100", height="100"></canvas>
<script>

var c = document.getElementById('canvas1').getContext("2d");


function stringToBinary(str) {
	//var data = new Uint8Array(str.length);
	var data = c.createImageData(1, str.length / 4);
	for (var i = 0, len = str.length / 4; i < len; i++) {
		data[4 * i] = str.charCodeAt(4 * i);		
		data[4 * i + 1] = str.charCodeAt(4 * i + 1);		
		data[4 * i + 2] = str.charCodeAt(4 * i + 2);		
		data[4 * i + 3] = str.charCodeAt(4 * i + 3);		
	}
	return data;
}

function binaryToString(data) {
	var s = "";
	for (var i = 0, len = data.width * data.height; i < len; i++) {
		s += String.fromCharCode(data[4 * i]);
		s += String.fromCharCode(data[4 * i + 1]);
		s += String.fromCharCode(data[4 * i + 2]);
		s += String.fromCharCode(data[4 * i + 3]);
	}
	return s;
	// apply solution works on FF but not on chrome
	//return String.fromCharCode.apply(null, data);
}

var testStr = "";
for (var i = 0; i < 2048; i++)
	testStr += String.fromCharCode(i % 256);

var data = stringToBinary(testStr);
var str = binaryToString(data);

document.getElementById('log').innerHTML += "<br>success=" + (str === testStr) + ", len=" + str.length;

</script>
</body>
</html>
