"use strict";

var ez = require("ez-streams");
var fs = require("fs");

var filpath = require('etna-engine/lib/runtime/fileio').functions.FILPATH.fn;

exports.AQUERY = function(_, select) {
	console.log("C_AVOLFIL.reader:" + JSON.stringify(select));
	//var volume = (select.$query && select.$query.VOLUME) || "TMP";

	// 	$query {"representation":"AVOLFIL.$query","VOLUME":"TMP","where":"(upper(VOLUME) eq 'TMP') and (upper(FULLNAME) like '%DOM%')","startIndex":"1","count":"50"}
	// C_AVOLFIL.reader:{"$orderBy":{"VOLUME":1,"FULLNAME":1},"$query":{"$and":[{"upper(VOLUME)":"TMP"},{"upper(FULLNAME)":{"$regex":".*DOM.*","$options":"i"}}]}}


	var volume = "TMP";

	function parseSelect(select) {
		if (Array.isArray(select)) {
			select.forEach(function(exp) {
				parseSelect(exp);
			});
		} else if (typeof select === 'object') {
			Object.keys(select).forEach(function(exp) {
				switch (exp) {
					case 'VOLUME':
						volume = volume || select[exp];
						break;
				}
			});
		}
	}

	console.log("volume:" + volume);
	var path = filpath(_, volume, "", "");
	console.log("path:" + path);

	return fs.readdirSync(path).map(function(entry) {
		return {
			VOLUME: "TMP",
			FULLNAME: entry.toUpperCase()
		};
	});
};