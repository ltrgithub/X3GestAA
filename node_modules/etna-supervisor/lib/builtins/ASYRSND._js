"use strict";
var util = require("etna-supervisor/lib/util");

exports.constructor = util.defineClass(function(httpContext) {
	this.httpContext = httpContext;
	this.$exported = true;
	this.data = "";
	this.mode = 0;
}, null, {
	get: function(_, name) {
		switch (name) {
			case "DATA":
				return this.data;
			case "MODE":
				return this.mode;
		}
	},
	set: function(_, name, value) {
		switch (name) {
			case "DATA":
				return this.data = value;
			case "MODE":
				return this.mode = value;
		}
	},
	DATA: {
		get: function() {
			return this.data;
		}
	},
	$send: function(_) {
		switch (this.mode) {
			case 0:
				this.httpContext.response.writeHead(200, {
					"content-type": "application/json"
				});
				this.httpContext.response.end(this.data, "utf8");
				break;
			case 1:
				this.httpContext.response.writeHead(200, {
					"content-type": "application/json"
				});
				this.httpContext.response.write(_, this.data, "utf8");
				this.mode = 2;
				break;
			case 2:
				this.httpContext.response.write(_, this.data, "utf8");
				break;
			case 3:
				this.httpContext.response.end(this.data, "utf8");
				this.mode = 0;
				break;
		}
		this.data = "";
		return true;
	}
});