"use strict";
var attributes  = require("etna-supervisor/lib/attributes");
var X3Error     = require("etna-engine/lib/runtime/errors").X3Error;



function InstanceProperty(value,parent,name,resources) {
	this._value 	   = value;
  // care of the name if and only if the property belongs to 
  // an instance which which belongs to a collection : 
	this.name 		   = name;
  this.bindAttributes(parent,resources);
 }

Object.defineProperty( InstanceProperty.prototype, "value", {
  set:function(value) {
    if(!this.getAttribute("$isReadOnly"))  this._value   = value;
    else throw new X3Error(147,(this.name?this.name:'')+ "is readonly");
  },
  get :function() {
    return this._value;
  },
  enumerable: false,   
}) ;

Object.defineProperty( InstanceProperty.prototype, "clone", {
  value:function(parent) {
   var to = new InstanceProperty(this.value,parent,this.name);
    to.parent = this.parent;
    attributes.clone(this,to);
    to.snapshotof = this;
    return to;
  },
  enumerable: false,   
});

Object.defineProperty( InstanceProperty.prototype, "revertTo", {
  value:function() {
    if(!this.snapshotof) return ;
    this.snapshotof._value = this._value;
    attributes.revertTo(this,this.snapshotof);
  },
  enumerable: false,   
});


attributes.addAttributes(InstanceProperty.prototype);
exports.InstanceProperty = InstanceProperty;