"use strict";
var attributes  = require("etna-supervisor/lib/attributes");
var variables   = require('etna-engine/lib/runtime/variables');

function InstanceCollection(clas,parent) {
  this.class       = clas;
  this.collection  = true;
	this.lines 	     = [];
  this.isLoaded    = false;
  this.parent      = parent;
  this.bindAttributes(parent);
}

Object.defineProperty( InstanceCollection.prototype, "load", {
  value: function(_,lines){
    this.lines    = lines;
    this.isLoaded = true;
  },
  enumerable: false   
});

Object.defineProperty( InstanceCollection.prototype, "add", {
  value: function(_,position){
    var instance = this.parent.supervisor.new(_, 'Instance', this.class,{}).afterCreate(_);
    instance.bindAttributes(this);

    if(position === variables.constants.CST_AFIRSTPOS) {
      this.lines.unshift(instance);
      return 0;
    } 
    this.lines.push(instance);
    return this.lines.length-1;
  },
  enumerable: false   
});

Object.defineProperty( InstanceCollection.prototype, "index", {
  value: function(_,position){
    if(position >= this.lines.length) throw new X3Error(8, "collection index out of range :"+position);
    return this.lines[position];
  },
  enumerable: false   
});


attributes.addAttributes(InstanceCollection.prototype);
exports.InstanceCollection = InstanceCollection;