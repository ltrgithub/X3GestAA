"use strict";

var util = require("etna-supervisor/lib/util");

var tracerJs = require('syracuse-core').getTracer("etna.supervisor");

exports.constructor = util.defineClass(function(superv, clas, data) {
	this.supervisor = superv;
	this.class = clas;
	this.data = data;
}, null, {
	init: function(_) {
		return this;
	},
	name: {
		get: function() {
			return this.data.CODCOL;
		}
	},
	isInstance: {
		get: function() {
			return this.mappingData && this.mappingData.TYPLNK === 3;
		}
	},
	getSql: function(_, colNames, tableNames, wheres, params, descs, cache, raw, sqlOpts) {
		var properties = this.class.properties;
		tracerJs.debug && tracerJs.debug("collection.getSql:" + Object.keys(properties));
		this.class.cache = cache;
		Object.keys(properties).forEach_(_, function(_, name) {
			properties[name].getSql && properties[name].getSql(_, colNames, tableNames, wheres, params, descs, cache, raw, sqlOpts);
		}, this);
	},
	nbrPro: {
		get: function() {
			return this.class.data.PROPERTIES.length;
		}
	}
});