"use strict";

var util = require("etna-supervisor/lib/util");

var tracerJs = require("syracuse-trace/lib/helper").getTracer("etna.supervisor");

exports.constructor = util.defineClass(function(superv, res, trackingId) {
	this.supervisor = superv;
	this.trackingId = trackingId;
	this.snapshot = res;
	this.current = res.clone();
}, null, {
	init: function(_) {
		return this;
	},
	delta: function(_) {
		return {};
	},
	dataNode: function(_) {
		var node = this.previous ? this.delta(_) : this.current.dataNode(_);
		node.$url = "{$baseUrl}/$workingCopies('" + this.trackingId + "')" + //
		"?representation=" + this.current.resourceFactory.representation.name + '.$edit';
		return node;
	},
	update: function(_, data) {
		tracerJs.debug && tracerJs.debug("updating working copy:", data);
		return this.current.applyDelta(_, data);
	}
});