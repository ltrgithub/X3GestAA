"use strict";

var helpers = require("syracuse-core/lib/helpers");
var attributes = require("etna-supervisor/lib/attributes");
var snapshots = require("etna-supervisor/lib/snapshots");

exports.trim = function(obj) {
	//trace && trace("trim:"+JSON.stringify(obj));
	var result = Object.keys(obj).reduce(function(o, k) {
		var v = obj[k];
		/*if (v instanceof Date) {
			v = v.toISOString();
			if (/T00\:00\:00\.000Z$/.test(v)) {
				v = v.substring(0, v.length - 14);
				if (v === '1599-12-31') v = null;
			}
		}*/
		if (/^CAST\(AUUID_0/.test(k)) k = "AUUID_0";
		var kk = k.substring(0, k.lastIndexOf('_'));
		var isArray = (obj[kk + '_1'] !== undefined);
		if (isArray) {
			o[kk] = o[kk] || [];
			o[kk].push(v);
		} else {
			if (v && v !== ' ') o[kk] = v;
		}
		return o;
	}, {});
	Object.keys(result).forEach(function(k) {
		var v = result[k];
		if (Array.isArray(v)) {
			var len = v.length;
			while (len > 0 && !(v[len - 1] && v[len - 1] !== ' ')) len--;
			result[k] = v.slice(0, len);
		}
	});
	return result;
};