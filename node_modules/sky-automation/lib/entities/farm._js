'use strict';
var locale = require('streamline-locale');
var datetime = require('@sage/syracuse-core').types.datetime;
var flows = require('streamline-runtime').flows;
var fs = require('streamline-fs');
var helpers = require('../helpers');

module.exports = {
	$titleTemplate: 'Farm {name}',
	$descriptionTemplate: '{description}',
	$helpPage: 'SKY-reference-farm',
	$valueTemplate: '{name}',
	$listTitle: 'Farm',
	$properties: {
		name: {
			$title: 'Name',
			$linksToDetails: true,
			$isMandatory: true,
		},
		description: {
			$title: 'Description',
		},
		elasticSearchEIP: {
			$title: 'IP address for Elastic Search',
			$isMandatory: true,
		},
		syracuseEIP: {
			$title: 'IP address for Syracuse server',
			$isMandatory: true,
		},
		mongodbEIP: {
			$title: 'IP address for MongoDB server',
			$isMandatory: true,
		},
	},
	$searchIndex: {
		$fields: ['name', 'description']
	},
	$uniqueConstraints: [
		['name']
	],
	$services: {
		farmHealth: {
			$title: 'Check farm health',
			$method: 'POST',
			$invocationMode: 'async',
			$capabilities: 'abort',
			$isMethod: true,
			$execute: function(_, context, instance) {
				var params = {
					elasticSearchEIP: instance.elasticSearchEIP(_),
					syracuseEIP: instance.syracuseEIP(_),
					mongodbEIP: instance.mongodbEIP(_),
				};
				console.log("params = ", params);
				var healthCheck = require(__dirname + '/../../scripts/health');
				var retVal = healthCheck.farmHealthTestFailed(_, params);
				console.log('retVal = ', retVal);
			},
		},
	},
};