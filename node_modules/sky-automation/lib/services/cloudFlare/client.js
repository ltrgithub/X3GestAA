var https = require('https');

function sendRequest(requestOpts,callback){
  
    var str = "";
    if (requestOpts.method == 'POST' || requestOpts.method == 'PUT'){
        var post_data = requestOpts.post_data;
        delete requestOpts.body

    } else {
		delete requestOpts.post_data;
		delete requestOpts.headers['Content-Length'];

	}
	requestOpts.headers['X-Auth-Email'] = requestOpts.headers['X-Auth-Email'].toLowerCase();
    var req = https.request(requestOpts, function(res) {
		res.on('data', function(d) {
			str += d;
		});

		res.on('end', function(d) {
			callback(null,str);
		});

    });
    
    if (requestOpts.method == 'POST' || requestOpts.method == 'PUT'){
        req.write(post_data);
    }


    req.on('error', function(e) {
      console.error(e);
      callback(e);
    });
	req.end();
}

exports.sendRequest = sendRequest
