'use sctrict';


function applyPatch(_, context, site) {

	// Build Chef-Client command to run 'X3Patches' recipe for given X3 site
	var command = 'knife';
	var args = [
		'winrm', 'ipaddress:' + site.ipX3(_), 
		'chef-client', '-r', 'recipe[X3Patches]', 
		'-x', 'Administrator', '-P', process.env.X3APP, 
		'-a', 'ipaddress', '-c', '/etc/chef/knife.rb'
	];
	
	// Run command 
    var spawn = require('child_process').spawn;
    var doIt  = spawn(command, args);

	doIt.stdout.on('data', function (data) {
		console.log('Stdout: ' + data);
	});

	doIt.stderr.on('data', function (data) {
		console.log('Error: ' + data);
	});

	doIt.on('exit', function (code) {
		console.log('Child process exited with code ' + code);
	});
}

exports.applyPatch = applyPatch;
