"use strict"

var helpers = require("syracuse-core/lib/helpers");
var httpHelper = require('syracuse-sdata/lib/httpHelper');

var _dispatchMap = {
	"xlsx": function(_, context) {
		var headers = {};
		headers["content-type"] = httpHelper.mediaTypes.xlsx;
		headers["cache-control"] = "no-cache,must-revalidate";
		context.response.writeHead(200, headers);
		var xlsxUrl = context.url + "?representation=" + context.parameters.representation;
		require('msoffice/lib/excel/xlsx').render(_, context.response, xlsxUrl, context.request.url);
		context.response.end();
	},
	"docx": function(_, context) {
		// TODO: get the prototype and result, or properly provide a title and description
		//var proto = self.getPrototypeResource(_, self.parameters.representation, true);
		var proto = {
			$title: context.parameters.representation,
			$description: context.parameters.representation
		}
		var result = {
			$url: context.request.url
		}
		require('msoffice/lib/word/docx').render(_, context, result, proto, {}, 200);
		context.response.end();
		return;
	}
}

exports.dispatch = function(_, context) {
	_dispatchMap[context.accept[0].type] && _dispatchMap[context.accept[0].type](_, context);
}