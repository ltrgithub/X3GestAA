"use strict";

var UdfRegistry = require('./udfRegistry').UdfRegistry;

var listeners = {};

exports.on = function(event, fn) {
	(listeners[event] = listeners[event] || []).push(fn);
};

exports.emit = function(event, args) {
	var thisArgs = arguments;
	(listeners[event] || []).forEach(function(l) {
		try {
			l.apply(this, Array.prototype.slice.call(thisArgs, 1));
		} catch (ex) {
			console.error(ex);
		}
	});	
};
window.onOfficeEvent = exports.emit;

window.invokeUDF = function(udfName, args) {
	return (UdfRegistry[udfName] && UdfRegistry[udfName].$handler && 
		UdfRegistry[udfName].$handler(Array.prototype.slice.call(arguments, 1))) || "";
}

window.loadTables = function(args) {
	var par = JSON.parse(args || "[]");
	document.site.excelDocument.loadTables(par, function() {
		external.onTablesLoaded();
	});
}