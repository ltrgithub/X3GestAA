"use strict";
exports.initialize = function(site){
    site.defaultFetchCount = 1000;
    site.$isSecurityTitleVisible = false;
    site.$isUserEndpointChangeDisabled = true;
    site.$syracuseMainPageUrl = "/syracuse-main/html/main.html";
    site.addGrid = function(page, $prototype){
        $prototype = $prototype || page.$prototype.$properties.$resources;
        page.$grid = {
            articleParent: page,
            $prototype: $prototype,
            applyChange: function(newData){
                syra_article.applyChange(this, newData);
            },
            dispose: function(){
                syra_article.dispose(this);
            }
        };
        syra_article.beforeDraw(page.$grid);
        syra_article.endDraw(page.$grid);
        
        page.$grid.$record = {
            $prototype: $prototypes.$item,
            articleParent: page.$grid,
            applyChange: function(newData){
                syra_article.applyChange(this, newData);
            },
            dispose: function(){
                syra_article.dispose(this);
            }
        };
        syra_article.beforeDraw(page.$grid.$record);
        syra_article.endDraw(page.$grid.$record);
    };   
    window.getStack = function(){
        try {
            var stack = [];
            var f = arguments.callee.caller;
            while (f) {
                var fn = f.toString();
                var fname = fn.substring(fn.indexOf('function') + 8, fn.indexOf('(')) || 'anonymous';
                stack.push(fname);
                f = f.caller;
            }
            return stack.join('\n');
        } 
        catch (e) {
        }
    };
    window.readBinaryURLContentIE = function(url, returnData){
        try {
            var xhr = new XMLHttpRequest();
            var data = {};
            xhr.open('GET', url, false);
            
            xhr.setRequestHeader("X-Content-Type-Override", "text/plain; charset=x-user-defined");
            xhr.onreadystatechange = function(e){
            };
            xhr.send();
            if (xhr.status == 200) {
                // this.responseText is broken in IE with binary data!
                // This is a c# byte array!
                returnData.setData(xhr.responseBody);
            }
            else 
                if (xhr.status == 1223) {
                    returnData.setErrorText("NOTFOUND");
                }
                else 
                    if (xhr.status == 404) {
                        returnData.setErrorText("NOTFOUND");
                    }
                    else {
                        returnData.setErrorText(xhr.response + "(" + xhr.status + ")");
                    }
        } 
        catch (e) {
            returnData.setErrorText(e);
        }
    };
    
};
