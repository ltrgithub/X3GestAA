
# File service  
This module is build on top of the SadFsqClient class and provide an automatic connection and disconnect mechanism.
All the methods are asynchronous.
  
``` javascript  
```
The first aim of this module is to give a service replacement of the X3 based upload service.
The file names provided in the different method support the the standard naming `dir/file.ext` as well as the x3 volume naming `[vol]/dir/file.ext`.
Volumes are resolved using the X3 AVOLUME class.
## Security
All methods verify the file name path using the following rules:  
  
* `[vol]` is replace by the actual volume dir and if it cannot be resolved `tmp` is assumed
* The final path is normalized and if the first part is not equal to the volume dir the operation is rejected

Examples:  
 
* `[TMP]/myfile.txt` is **resolved** as `tmp/myfile.txt`
* `[TMP]/../TRT/SUBADC.adx` is **rejected**
* `mydata.dat` is **resolved** as `tmp/mydata.dat`
* `../TRT/SUBADC.adx` is **rejected**

## Module level functions  

-------------
### createDownloadStream :  
``` javascript  
	var stream = x3fs.createDownloadStream(_, endpoint, path, [options]);
```
Return a readable stream for downloading file.  
This function use an internal pool that release the client at the end of streaming. 

* `endpoint` the endpoint that while receive the file  
* `path` the remote file path  
* `options` is an `object` that could contains:  
    * encoding : `String | null` default = `utf-8`.  

The `encoding` option is ignored if `data` is a buffer. It defaults to 'utf8'.  

The is automatically released at the end of streaming. The underlying client connection can be reused after that.  

-------------
### createUploadStream :  
``` javascript  
	var stream = x3fs.createUploadStream(_, endpoint, path, [options]);
```
Return a writable stream for uploading file.  
This function use an internal pool that release the client at the end of streaming. 

* `endpoint` the endpoint that while receive the file  
* `path` the remote file path  
* `options` is an `object` that could contains:  
    * encoding : `String | null` default = `utf-8`.  

The `encoding` option is ignored if `data` is a buffer. It defaults to 'utf8'.  

The is automatically released at the end of streaming. The underlying client connection can be reused after that.  


-------------
### deleteFile :  
``` javascript  
	var stream = x3fs.deleteFile(_, endpoint, path, [options]);
```
Delete the given file.  
This function use an internal pool that release the client at the end of streaming. 

* `endpoint` the endpoint that host the file  
* `path` the remote file path  

The `encoding` option is ignored if `data` is a buffer. It defaults to 'utf8'.  

The is automatically released at the end of streaming. The underlying client connection can be reused after that.  

