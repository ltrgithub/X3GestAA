"use strict";
var helpers = require('syracuse-core/lib/helpers');
var AdapiObservable = function() {};

var CAdapiInstanceExeci = helpers.defineClass(function(xmlAck_call, client, ist) {
	TODO_SUPER(client);
	this.instance = ist;
	this.xml = xmlAck_call;
	// En dernier
	setTypeJsonNode(ETypeJsonNode.TARGET);
}, AdapiObservable, {
	getFormat: function() {
		return this.instance == null ? "" : this.instance.getFormat();
	},
	getModeEdit: function() {
		return false;
	},
	getNl: function() {
		return 0;
	},
	getValue: function() {
		return null;
	},
	getWin: function() {
		return null;
	},
	getXid: function() {
		return this.instance == null ? "" : this.instance.getIst().getBlocAlphaId().concat(this.instance.getIst().getFieldId());
	},
	getXml: function() {
		return this.xml;
	},
	hasFormat: function() {
		return this.instance == null ? false : this.instance.hasFormat();
	},
	setInstance: function(instance) {
		this.instance = instance;
	},
	setXml: function(xml) {
		this.xml = xml;
	},
	toJson: function() {
		var object = new JSONObject();
		object.put(JSON_TYPE, JSON_RPC);
		var rpc = new JSONObject();
		rpc.put(JSON_XML, this.xml);
		object.put(JSON_RPC, rpc);
		var ist = new JSONObject();
		if (this.instance != null) {
			ist.put(JSON_XID, getXid());
			if (this.instance.hasFormat()) {
				ist.put(JSON_FMT, getFormat());
			}
			ist.put(JSON_WIN, this.instance.getIst().getWinAlphaId());
			ist.put(JSON_EDIT, true);
			rpc.put(JSON_IST, ist);
		}
		return object;
	}
});