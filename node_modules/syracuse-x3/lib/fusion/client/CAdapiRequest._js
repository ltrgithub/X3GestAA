"use strict";
var helpers = require('syracuse-core/lib/helpers');
var CAdapiModifier = function() {};
var CAdonixRequest = function() {};

var CDataSrcAffStateSetter = helpers.defineClass(function(cli, aAftbTyp, aNbLines) {
	TODO_SUPER(cli.tracer);
	this.aftbTyp = aAftbTyp;
	this.nbLines = aNbLines;
	this.cli = cli;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		this.done = aModifiable instanceof CAdapiDataSrc;
		if (this.done) {
			aModifiable.setAffState(this.aftbTyp, this.nbLines);
		} else {
			setLogicalErrMess(this.cli.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_NOT_RIGHT_MODIFIABLE, aModifiable.adxId, LABEL_CLASS_DATASRC));
		}
		return this.done;
	}
});

var CDataSrcDeleter = helpers.defineClass(function(cli, aTargetLine, aNbLines) {
	TODO_SUPER(cli.tracer);
	this.cli = cli;
	this.targetLine = aTargetLine;
	this.nbLines = aNbLines;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		this.done = aModifiable instanceof CAdapiDataSrc;
		if (this.done) {
			var ds = aModifiable;
			if (this.nbLines == -1) {
				ds.serverRemoveAllLines();
			} else {
				ds.serverRemoveLines(this.targetLine, this.nbLines);
			}
		} else {
			setLogicalErrMess(this.cli.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_NOT_RIGHT_MODIFIABLE, aModifiable.adxId, LABEL_CLASS_DATASRC));
		}
		return this.done;
	}
});

var CDataSrcInserter = helpers.defineClass(function(cli, aTargetLine, aNbLines) {
	TODO_SUPER(cli.tracer);
	this.cli = cli;
	this.zeroBasedIdx = aTargetLine;
	this.nbLines = aNbLines;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		this.done = aModifiable instanceof CAdapiDataSrc;
		Utils.toConsole("\tsetMod=" + aStructIst.alphanumCodage + " - " + this.zeroBasedIdx + " - " + this.nbLines);
		if (this.done) {
			var wAdapiDataSrc = aModifiable;
			wAdapiDataSrc.serverInsertLines(this.zeroBasedIdx, this.nbLines);
			if (wAdapiDataSrc.hasDimOverFlow()) {
				setLogicalErrMess(this.cli.adapiResources.getMessage(
				CAdapiResources.KEYMESS_ERROR_DIM_OVERFLOW, String.valueOf(wAdapiDataSrc.dim), String.valueOf(this.nbLines), String.valueOf(wAdapiDataSrc.size())));
			}
		} else {
			setLogicalErrMess(this.cli.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_NOT_RIGHT_MODIFIABLE, aModifiable.adxId, LABEL_CLASS_DATASRC));
		}
		return this.done;
	}
});

var CDownloadListner = helpers.defineClass(function(aAdapiClient) {
	this.adapiClient = aAdapiClient;
}, null, {
	listenActivity: function(aActivityLib, aPercent) {
		var wSB = new StringBuilder();
		wSB.append(aActivityLib);
		wSB.append(String.format(" : [%d/100]", aPercent));
		this.adapiClient.pushAffSynchroneMessTempOn(wSB.toString());
		return true;
	}
});

var CEntityStateSetter = helpers.defineClass(function(aTracer, aEntityState) {
	TODO_SUPER(aTracer);
	this.entityState = aEntityState;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		/*
		 * STATE_INVISIBLE, STATE_VISIBLE, STATE_EDITABLE, STATE_GRIZO,
		 * STATE_DISZO, WANT_SELECT, WANT_UNSELECT
		 */
		aModifiable.entityStateSet(this.entityState, true);
		this.done = true;
		return this.done;
	}
});

var CLeftListAppender = helpers.defineClass(function(aTracer, aIdx, aBranche, aTxt, aVal, aClf, aClp) {
	TODO_SUPER(aTracer);
	this.idx = aIdx;
	this.branche = aBranche;
	this.txt = aTxt;
	this.val = aVal;
	this.clf = aClf;
	this.clp = aClp;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.appendLeftListLine(this.idx, this.branche, this.txt, this.val, this.clf, this.clp);
		this.done = true;
		return this.done;
	}
});

var NDCOLAR_MODIF_FORMATS = 1;

var CLeftListColumnsModifier = helpers.defineClass(function(aTracer, aWhat, aDefs) {
	TODO_SUPER(aTracer);
	this.whatModification = aWhat;
	this.defs = aDefs;
}, CAdapiModifier, {
	// modif des formats
	setAdapiModifiable: function(aStructIst, aModifiable) {
		if (this.whatModification == NDCOLAR_MODIF_FORMATS) {
			aModifiable.changeColumnsFormats(this.defs);
		} else {
			aModifiable.changeColumnsTitles(this.defs);
		}
		this.done = true;
		return this.done;
	}
});

var CLeftListDeleter = helpers.defineClass(function(aTracer) {
	TODO_SUPER(aTracer);
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.serverRemoveAllLines();
		this.done = true;
		return this.done;
	}
});

var CLeftListPickingSelecter = helpers.defineClass(function(aTracer, selected) {
	TODO_SUPER(aTracer);
	this.selected = selected;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.setLeftListLinePickingSel(this.selected);
		this.done = true;
		return this.done;
	}

});

var CLeftListSelecterByKey = helpers.defineClass(function(aTracer, selected, aCle, request) {
	TODO_SUPER(aTracer);
	this.selected = selected;
	this.cle = aCle;
	this.request = request;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.setServerSelectLine(this.selected, this.cle);
		request.setLefListLineSelected(aModifiable.findLineIdx(this.cle));
		this.done = true;
		return this.done;
	}
});

var CServerFormatSetter = helpers.defineClass(function(cli, aFormat) {
	TODO_SUPER(cli.tracer);
	this.format = aFormat;
	this.inferredState = CAdapiEntity.STATE_DEFAULT;
}, CAdapiModifier, {
	hasInferredState: function() {
		return this.inferredState != CAdapiEntity.STATE_DEFAULT;
	},
	setAdapiModifiable: function(aStructIst, aModifiable) {
		this.inferredState = aModifiable.setServerFormat(new CAdapiFormat(
		this.format));
		this.done = true;
		return this.done;
	}
});

var CServerStateSetter = helpers.defineClass(function(aTracer, aState) {
	TODO_SUPER(aTracer);
	this.entitryState = aState;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.entityStateSet(this.entitryState, true);
		this.done = true;
		return this.done;
	}
});

var CServerStyleSetter = helpers.defineClass(function(aTracer, aStyle, applyOn) {
	TODO_SUPER(aTracer);
	this.style = aStyle;
	this.applyOn = applyOn;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.setServerStyle(this.style, this.applyOn);
		this.done = true;
		return this.done;
	}
});

var CServerTitleSetter = helpers.defineClass(function(aTracer, aTitle) {
	TODO_SUPER(aTracer);
	this.title = aTitle;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.setServerTitle(this.title);
		this.done = true;
		return this.done;
	}
});

var CServerValueSetter = helpers.defineClass(function(aTracer, aResu) {
	TODO_SUPER(aTracer);
	this.resu = aResu;
}, CAdapiModifier, {
	setAdapiModifiable: function(aStructIst, aModifiable) {
		aModifiable.setServerValue(this.resu);
		this.done = true;
		return this.done;
	}
});

var SENDCTX_PARAM_TARGET = "payload.param.target";
//TODO var ARG_VALUES_SEPARATOR = CStructResu.SEPARATOR_TDO_DATA;
var LABEL_CLASS_DATASRC = "CAdapiDataSrc";
var LIB_ACTION_ID = "ActId";
var LIB_FORMAT = "Format";
var LIB_FUNCTION_ID = "FunctionId";
var LIB_IST = "Ist";
var LIB_LIB = "Lib";
var LIB_MENU_ID = "MenuId";
var LIB_MESS_ACT = "MessAction";
var METH_ARGS_DOLEFTLISTLINE = "listenActionArgsDOLEFTLISTLINE";
var METH_ND_ASK_GETFILE = "ASKGetFile";
var METH_ND_CLF = "ND_CLF";
var METH_ND_NAP = "ND_NAP";
var METH_NDCHCR = "NDCHCR";
var METH_NDCHFM = "NDCHFM";
var METH_NDCHGR = "NDCHGR";
var METH_NDCHST = "NDCHST";
var METH_NDCHVB = "NDCHVB";
var METH_NDCHVL = "NDCHVL";
var METH_NDCSTL = "NDCSTL";
var METH_NDCTIT = "NDCTIT";
var METH_NDDSLB = "NDDSLB";
var METH_NDGLAR = "NDGLAR";
var METH_NDINSLI = "NDINSLI";
var METH_NDOCAR = "NDOCAR";
var METH_NDOFENH = "NDOFENH";
var METH_NDOLAR = "NDOLAR";
var METH_NDOMNBO = "NDOMNBO";
var METH_NDOWIN = "NDOWIN";
var METH_NDSUPLI = "NDSUPLI";
var LIB_STATE = "State";
var LIB_STYLE = "Style";
var LIB_TEXT = "Txt";
var LIB_TITLE = "Title";
var LIB_WINDOW_ID = "WindowsId";
var LIB_WINDOW_STAMP = "Stamp";
var WINDOW_TEMPON_ID = "TEMPON";

var CAdapiRequest = helpers.defineClass(function(aAdapiClient, aAdonixReply, aParams, sendContext) {
	TODO_SUPER(aAdapiClient, aAdonixReply, aParams, sendContext);
	this.adapiClient = aAdapiClient;
	this.nbNodeOpenTempon = 0;
	this.lefListLineSelected = -1;
}, CAdonixRequest, {
	breakWaiting: function(aCompleteReply) {
		TODO_SUPER.breakWaiting(aCompleteReply);
	},
	buildIstDatasOfAction: function(aParam) {
		var istData = null;
		// si l'objet passe est une instance de CStructIstDatas => fin
		if (CStructIstDatas.isIstDatas(aParam)) {
			istData = aParam;
		}
		// si l'objet passe est un "element" => erreur
		else if (CStructIstDatas.isIstDatasElmt(aParam)) {
			// 15w_011 - Fiche 42190 - VT (ADC) : la valeur saisie n'est pas
			// stockee dans Entity
			istData = CStructIstDatas.buildEditedIstDatas(this.tracer, aParam);
		}
		// si l'objet passe est une string
		else if (aParam != null && aParam instanceof String) {
			// si l'objet passe est une string vide => fin
			if (aParam.length() == 0) {
				return CStructIstDatas.getIstDatasNull(this.tracer);
			}
		}
		var cli = this.adapiClient;
		// si l'objet passe n'a pas permis de construire un istdata => erreur
		if (istData == null) {
			var wMess = cli.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_NO_ISTDATA, aParam.class.name);
			throw new CCommException(CCommException.CANT_SEND, wMess);
		}
		// si cet istData n'a pas d'instance => fin
		if (!istData.hasIst()) {
			return istData;
		}
		// si le browser a retourne un resu "null" => fin
		if (istData.editedResuTyp == CStructResu.X3TYP_NULL) {
			return istData;
		}
		var wEntity = cli.findModifiable(istData.ist);
		// si l'instance n'est pas une variable
		if (!(wEntity instanceof CAdapiVariable)) {
			return istData;
		}
		var v = wEntity;
		try {
			// si la donnee a un format dedit et editee dans l'IstData est au
			// format "EDIT"
			if (v.acceptEditFormat() && istData.isEditFormat()) {
				// deformatage : format edition => format presentation. Peut
				// lever une exception de formatage ou de valorisation
				istData.setEditedValue(v.formatEditToDisplay(istData.editedValue));
				// ajout d'un noeud "ist" "previous" avec la valeur reformatee.
				// Exemple : <ist which="previous" C="B,B,B5" format="show"
				// IstFmt="N+:5.5#">0,02000</ist>
				this.x3Reply.addAdapiInstance(
				CAdapiInstance.newprevious(cli, istData.ist, v.format.string, istData.editedValue, this.adonixReply == null ? false : this.adonixReply.stayInCommandMode));
			}
			// deformatage : format presentation => format brut
			istData.setValueProtected(v.resuTyp, v.unFormatData(istData.editedValue));
			v.setBrowserUnformatedValue(istData);
			return istData;
		} catch (e) {
			// Récupération de l'erreur de formatage pour info client
			var adapi = CAdapiInstance.newtarget(cli, istData.ist,
			v.format.string, istData.editedValue, this.adonixReply == null ? false : this.adonixReply.stayInCommandMode);
			adapi.setException(e);
			this.x3Reply.addAdapiInstance(adapi);
			if (e instanceof RuntimeException) {
				throw e;
			}
			throw new RuntimeException(e);
		}
	},
	buildListenNodeMessage: function(aKeyMess, aValue1, aModifier) {
		var wMess = this.adapiClient.adapiResources.getMessage(
		aKeyMess, aValue1);

		if (aModifier.hasLogicalErrMess()) {
			return wMess.concat(aModifier.logicalErrMess);
		} else {
			return wMess;
		}
	},
	/* TODO overload
	buildListenNodeMessage: function(aKeyMess, aValue1, aValue2, aModifier) {
		var wMess = this.adapiClient.adapiResources.getMessage(
		aKeyMess, aValue1, aValue2);

		if (aModifier.hasLogicalErrMess()) {
			return wMess.concat(aModifier.logicalErrMess);
		} else {
			return wMess;
		}
	},*/
	getAdapiClient: function() {
		return this.commClient;
	},
	getAffSynchroneAction: function(aMess, aPos) {
		var wPosStart = aPos + CAdapi.AFF_SYNCHRONE_HEADER_LONG + CAdapi.AFF_SYNCHRONE_TYPE_LONG;
		var wPosEnd = wPosStart + CAdapi.AFF_SYNCHRONE_ACTION_LONG;
		var wAction = aMess.substring(wPosStart, wPosEnd);
		if (wAction.equals(CAdapi.AFF_SYNCHRONE_LIB_ACTION_MODIFY)) {
			return CAdapi.AFF_SYNCHRONE_ACTION_MODIFY;
		}
		if (wAction.equals(CAdapi.AFF_SYNCHRONE_LIB_ACTION_OPEN)) {
			return CAdapi.AFF_SYNCHRONE_ACTION_OPEN;
		}
		if (wAction.equals(CAdapi.AFF_SYNCHRONE_LIB_ACTION_CLOSE)) {
			return CAdapi.AFF_SYNCHRONE_ACTION_CLOSE;
		}
		return 0;
	},
	getAffSynchroneType: function(aMess, aPos) {
		var wPosStart = aPos + CAdapi.AFF_SYNCHRONE_HEADER_LONG;
		var wPosEnd = wPosStart + CAdapi.AFF_SYNCHRONE_TYPE_LONG;
		var wType = aMess.substring(wPosStart, wPosEnd);
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_PROGRESS)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_PROGRESS;
		}
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_VALIDCAR)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_VALIDCAR;
		}
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_SESSION)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_SESSION;
		}
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_TEMPON)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_TEMPON;
		}
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_DEBUG)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_DEBUGON;
		}
		if (wType.equals(CAdapi.AFF_SYNCHRONE_LIB_TYPE_VOICE)) {
			return CAdapi.AFF_SYNCHRONE_TYPE_VOICE;
		}
		return 0;
	},
	getX3Reply: function() {
		return TODO_SUPER.this.reply;
	},

	/**
	 * Modifie le contenu de la liste d'arguments re�u du brwowser pour une
	 * action SRV_BRWRAPIDESEL
	 *
	 * SRV_BRWRAPIDESEL (1069) = 1024 + ACK_SLRP (45)
	 *
	 * Re�oit : -(a) le r�su associ� � l'action -(b) l'adxid (ist) de la liste
	 * gauche -(c..k) n resus (sous la forme "adxid^tdo^value" ) des n colonnes
	 * de la liste gauche Supprime : - les n r�sus Ajoute : - une table de n
	 * instances de CStructResu contenant les n valeurs de filtrage des n
	 * colonnes
	 */
	listenActionArgsBRWRAPIDESEL: function(aAdapiClient,  aParams) {
		var wNbArgs = aParams.size();
		var wTabOfResus = new ArrayList();
		var wI = 2;
		var wColValue;
		while (wI < wNbArgs) {
			wColValue = aParams.get(wI);
			// ajoute dans la table un resu deformate construit a partir de la
			// chaine "adxid^tdo^value"
			wTabOfResus.add(new CStructResu(this.tracer, CStructResu.X3TYP_STRU, wColValue));
			wI++;
		}
		wI = wNbArgs - 1;
		while (wI >= 2) {
			aParams.remove(wI);
			wI--;
		}
		aParams.add(wTabOfResus);
	},

	/**
	 * Modifie le contenu de la liste d'arguments re�u du brwowser pour une
	 * action SRV_BRWCHANGELINE ou SRV_BRWSELECTLINE ou SRV_TREECHANGELINE ou
	 * SRV_TREEEXPANDLINE ou SRV_TREESELECTLINE SRV_BRWCHANGELINE (1051) = 1024
	 * + ACK_CLST (27) SRV_BRWSELECTLINE (1052) = 1024 + ACK_SLST (28)
	 * SRV_TREECHANGELINE (1060) = 1024 + ACK_CABR (36) SRV_TREEEXPANDLINE
	 * (1061) = 1024 + ACK_SABR (37) SRV_TREESELECTLINE (1062) = 1024 + ACK_DABR
	 * (38)
	 *
	 * Re�oit : -(a) le r�su associ� � l'action -(b) l'adxid (IST) de la ligne
	 * selectionnee Modifie : - l'adxid (IST) pour supprimer l'index de la ligne
	 * Ajoute : - la cle apr�s l'argument IST
	 */
	listenActionArgsDOLEFTLISTLINE: function(aAdapiClient, aParams) {
		/*
		 * Construction d'une StructIst d�signant la ligne s�lectionn�e � partir
		 * du deuxi�me argument 14w_006 - Evolution TermServer - Liste gauche /
		 * choose Accepte une instance de CStructIst en tant que deuxi�me
		 * param�tre
		 */
		var wParam = aParams.get(1);
		var wArgIst = null;
		if (wParam instanceof CStructIst) {
			wArgIst = wParam;
		} else if (wParam instanceof String) {
			wArgIst = new CStructIst(this.tracer, wParam);
		} else {
			throw new CAdapiException(this.adapiClient, "ARG_WRONG - need a \"CStructIst\" or a \"String\" !");
		}
		if (!wArgIst.isLineIst()) {
			throw new CAdapiException(this.adapiClient, "ARG_WRONG - need a \"line\" ist !");
		}
		var wLeftListLine = aAdapiClient.findModifiable(wArgIst);
		// si l'action porte sur une instance de "CAdapiLeftListNode" il faut
		// memoriser le noeud de "source de l'action" car le traitement des
		// noeuds en reponse en d�pend.
		if (wLeftListLine instanceof CAdapiLeftListLineNode) {
			var wLeftListNode = wLeftListLine;
			/*
			 * Stockage dans la liste gauche r�cursive de l'id du Node �
			 * "expandre"
			 */
			wLeftListNode.leftListRecursiv.setNodeIdToExpanded(
			wArgIst.idx);
		}
		aParams.add(wLeftListLine.cle);
		wArgIst.setLine(0);
		aParams.set(1, wArgIst);
		if (this.tracer.traceLevelFilter(ITracer.LEVEL_DEBUG)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_ARGS_DOLEFTLISTLINE);
			var wMax = aParams.size();
			wTB.appendDescr("nbParams", wMax);
			if (wMax > 0) {
				var wI = 0;
				while (wI < wMax) {
					wTB.appendDescr("ParamClass", CStringFacilities.getClasseName(aParams.get(wI).class));
					wI++;
				}
			}
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
	},

	/**
	 * 15w_002 - Fiche 36375 - VT: accepter CStructIst comme argument de PAGEUP,
	 * PAGEDOWN
	 *
	 * Modifie le contenu de la liste d'arguments re�u du brwowser pour une
	 * action SRV_LIST_PAGE_DOWN
	 *
	 * SRV_LIST_PAGE_UP (1072) = 1024 + ACK_FRWD (49)
	 *
	 * Re�oit : -(a) le r�su associ� � l'action -(b) l'adxid (IST) de la ligne
	 * selectionnee Modifie :
	 *
	 * Ajoute : - la cle de la premere ligne apres l'argument IST
	 */
	listenActionArgsLIST_PAGE_DOWN: function(aAdapiClient,  aParams) {
		var wLeftList = retrieveAdapiLeftList(aAdapiClient, aParams);
		var wLeftListLine = wLeftList.lastLine;
		if (wLeftListLine != null) {
			aParams.add(wLeftListLine.cle);
		}
	},

	/**
	 * 15w_002 - Fiche 36375 - VT: accepter CStructIst comme argument de PAGEUP,
	 * PAGEDOWN Modifie le contenu de la liste d'arguments reeu du brwowser pour
	 * une action SRV_LIST_PAGE_UP SRV_LIST_PAGE_DOWN (1073) = 1024 + ACK_REWD
	 * (48)
	 *
	 * Recoit : - le reesu associe � l'action - l'IST de la ligne selectionnee
	 * Modifie :
	 *
	 * Ajoute : - la cle de la derniere ligne apres l'argument IST
	 */
	listenActionArgsLIST_PAGE_UP: function(aAdapiClient, aParams) {
		var wLeftList = retrieveAdapiLeftList(aAdapiClient, aParams);
		var wLeftListLine = wLeftList.firstLine;
		if (wLeftListLine != null) {
			aParams.add(wLeftListLine.cle);
		}

	},

	/**
	 * Modifie le contenu de la liste d'arguments recu du brwowser pour une
	 * action SRV_PICKING
	 *
	 * SRV_PICKING (1066) = 1024 + ACK_PICK (42) * Recoit : -(a) le resu associe
	 * a l'action -(b) l'adxid (ist) de la liste gauche -(c) n adxid (IST) des n
	 * lignes a selectionner ou a deselectionner separes par un '^' -(d) n
	 * actions (autant que de lignes) de selection ("1052" SRV_BRWSELECTLINE) ou
	 * de deselection ("1067" SRV_BRWDESELECTLINE) separes par un '^' Modifie :
	 * - l'IST piour supprimer l'index de la ligne Supprime
	 *
	 * Ajoute : - la cle apres l'argument IST
	 */
	listenActionArgsPICKING: function(aAdapiClient,  aParams) {
		/*
		 * attribut "c" : n adxid (IST) des n lignes a selectionner ou a
		 * deselectionner separes par un '^' stockage des AdxId dans n StructIst
		 * bufferiszes au niveau du client Exemple : <A I="1066" a="" b="B,AH,C"
		 * c="B,AH,C,5^B,AH,C,6" d="1052^1052" T="0" >0^</A>
		 */
		var wSTAdxids = new StringTokenizer(aParams.get(2), String.valueOf(ARG_VALUES_SEPARATOR));
		/*
		 * attribut "d" : action de selection ou de d�s�lection 1052
		 * SRV_BRWSELECTLINE ou 1067 SRV_BRWDESELECTLINE stockage au niveau du
		 * client
		 */
		var wSTActions = new StringTokenizer(aParams.get(3), String.valueOf(ARG_VALUES_SEPARATOR));
		// vidage de la liste de ligne pickees
		this.adapiClient.clearAdxIstsOfPickedLines();
		// Picking : pas de depickage par programme chargement de la liste
		var wStructIst;
		var wAdapiPickedLine;
		var wAction;
		while (wSTAdxids.hasMoreTokens()) {
			wStructIst = new CStructIst(this.tracer, wSTAdxids.nextToken());
			wAction = new Integer(wSTActions.nextToken());
			wAdapiPickedLine = new CAdapiPickedLine(wStructIst, wAction);
			this.adapiClient.traverseSettable(
			wStructIst, new CLeftListPickingSelecter(this.tracer, wAdapiPickedLine.isSelection()));
			this.adapiClient.addAdxIstOfPickedLines(wAdapiPickedLine);
		}
		aParams.remove(3);
		aParams.remove(2);
		if (this.tracer.traceLevelFilter(ITracer.LEVEL_DEBUG)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName("listenActionArgsPICKING");
			wTB.appendDescr("NbPickedLines", wSTAdxids.countTokens());
			wTB.appendDescr("NbParamsAfter", aParams.size());
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
	},
	listenException: function(e) {
		if (this.tracer.isTraceParametersOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_LISTEN_EXCEPTION);
			wTB.appendDescr("Throwable", e.class);
			if (this.tracer.isTraceDebugOn()) {
				wTB.append('\n').appendDescr(e);
			}
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		setMemorizedException(e);
		return true;
	}

	/**
	 * "AskPutFile", "AskSelFile", "AskReadTextFile", "AskExecShell",
	 * "AskGetFile"
	 */
	,
	listenNodeND_ASK: function(aSegmentNode) {
		Utils.toConsole("ND_ASK nodes are ignored in fusion client");
		return true;
	},

	/**
	 * transfert un fichier du serveur dans l'espace temporaire en le renomant.
	 * Le renomage est
	 *
	 * -90 Impossible de se connecter � un serveur sadfsq [%s] avec les
	 * param�tres fournis [%s]. -91 Transfert impossible dossier source
	 * inexistant -92 Transfert impossible dossier source inaccessible (droits)
	 * -93 Transfert impossible parm�tre RemotePath non fourni.
	 */
	
	listenNodeND_ASKGetFile: function(aExtendProperties) {
		var wRemoteFileDescriber = aExtendProperties.getOnePropertyValue(CAdonixClient.ASKUI_PARAM_REMOTEPATH);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_ND_ASK_GETFILE);
			wTB.appendDescr("RemoteFileDescriber", wRemoteFileDescriber);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wDownloadListner = new CDownloadListner(
		this.adapiClient);
		return this.adapiClient.getNewAdonixFileManager(wDownloadListner).getFile(wRemoteFileDescriber);
	},
	listenNodeND_ASKSendAutoReply: function(aNumError, aExplaination) {
		var wResponse = new StringBuilder();
		wResponse.append(aNumError);
		wResponse.append(',');
		wResponse.append(aExplaination);
		var wIstDatas = new CStructIstDatas(this.tracer, CStructResu.X3TYP_STRU, wResponse.toString());
		var wProtocolNum = this.adonixClient.remoteProtocolNum;
		var wSegReplyAction = CSegmentActionFactory.buildSegmentAction(this.tracer, true, wProtocolNum, CDefAction.SRV_ASKUI_RESPONSE, wIstDatas);
		try {
			if (this.adapiClient.typeClient == ETypeClient.JULIET) {
				this.connClient.writeSegment(wSegReplyAction);
			} else {
				this.adonixClient.writeSegment(wSegReplyAction, false);
			}
		} catch (e) {
			var wErrMess = this.adonixClient.adonixResources.getMessCantSendAutomaticReply("ND_ASK");
			throw new CCommException(CCommException.CANT_SEND, e, wErrMess);
		}
	}

	/**
	 * ND_CLF 0E1400 (Adxcpl_CloseWin) Fermeture d'une fen�tre Id=[ND_CLF]
	 * level=[?] x3func=[Adxcpl_CloseWin] nb=[1] ist =[ win=[2] srn=[0] blc=[0]
	 * fld=[0] idx=[0] ]
	 */
	,
	listenNodeND_CLF: function(aSegmentNode) {
		// IN--> ist =[ win=[2] srn=[0] blc=[0] fld=[0] idx=[0]]
		var wIst = aSegmentNode.getNodeArgIst(0);
		if (this.nbNodeOpenTempon > 0) {
			if (this.tracer.isTraceCallsOn()) {
				var wTB = this.tracer.popTraceBuffer();
				wTB.appendMethodName(METH_ND_CLF);
				wTB.appendDescr(wIst);
				wTB.append(" Close Window TEMPON => nothing to do");
				this.tracer.trace(this, ITracer.LEVEL_CALLS, wTB);
				this.tracer.pushTraceBuffer(wTB);
			}
			this.nbNodeOpenTempon--;
			return true;
		}
		var wAdapiStackedWindow = this.adapiClient.popRequesterWindow();
		var wX3Reply = this.x3Reply;
		wX3Reply.addPopedWindow(wAdapiStackedWindow);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_ND_CLF);
			wTB.appendDescr("isWindowChanged", wX3Reply.isWindowChanged());
			wTB.appendDescr("hasPopedWindow", wX3Reply.hasPopedWindow());
			wTB.appendDescr("getNbPopedWindows", wX3Reply.nbPopedWindows);
			wTB.appendDescr("LastPopedWindowId", wX3Reply.lastPopedWindowId);
			aSegmentNode.addDescrInTB(wTB); // 14w_006 - Bug 31739 - gestion
			// tableau
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		return true;
	}

	/**
	 * ND_DCL 0E2400 (LeftList_NewRequete) Debut de chargement liste simple ou
	 * arbre Id=[ND_DCL] func=[LeftList_NewRequete] NbArgs=[1] ist =[ win=[2]
	 * srn=[34] blc=[1] fld=[0] idx=[0]]
	 */
	,
	listenNodeND_DCL: function(aSegmentNode) {
		return TODO_SUPER.listenNodeND_DCL(aSegmentNode);
	}

	/**
	 * ND_FCL 0E2500 (LeftList_CloseReq) Fin de chargement liste simple ou arbre
	 * Id=[ND_FCL] func=[LeftList_CloseReq] NbArgs=[1] ist =[ win=[2] srn=[34]
	 * blc=[1] fld=[0] idx=[0]]
	 */
	,
	listenNodeND_FCL: function(aSegmentNode) {
		return TODO_SUPER.listenNodeND_FCL(aSegmentNode);
	}

	/**
	 * ND_ICL 111000 (LeftList_SynchroRequete) Interrogation chargement liste *
	 * Id=[ND_ICL] func=[LeftList_SynchroRequete] NbArgs=[1] ist =[ win=[2]
	 * srn=[34] blc=[1] fld=[0] idx=[0]]
	 */
	,
	listenNodeND_ICL: function(aSegmentNode) {
		return TODO_SUPER.listenNodeND_ICL(aSegmentNode);
	}

	/**
	 * Ouverture d'une session secondaire
	 */
	,
	listenNodeND_NAP: function(aSegmentNode) {
		var wTxt = aSegmentNode.getNodeArgString(0).stringValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_ND_NAP);
			wTB.appendDescr(LIB_TEXT, wTxt);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		this.x3Reply.setAskOpenSession(wTxt);
		return true;
	},
	listenNodeND_REB: function(aSegmentNode) {
		// Notify observer
		new AdapiReboot(this.adapiClient);
		return TODO_SUPER.listenNodeND_REB(aSegmentNode);
	}

	/**
	 * NDAFTB 0E2600 (Grid_setRedraw) Activation/Desactivation mode affichage
	 * tableau debut et fin ensemble de neoud de tableau
	 */
	,
	listenNodeNDAFTB: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wAffTbState = aSegmentNode.getNodeArgByte(1).intValue;
		var wNbLines = aSegmentNode.getNodeArgShort(2).intValue;
		var wDataSrcAffStateSetter = new CDataSrcAffStateSetter(
		this.adapiClient, wAffTbState, wNbLines);
		this.adapiClient.traverseSettable(wArgIst.structIst, wDataSrcAffStateSetter);
		if (!wDataSrcAffStateSetter.done()) {
			var wState = CAdapiDataSrc.aftbTypToString(wAffTbState);
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_AFFSTATE, wState, wDataSrcAffStateSetter);
			(this.reply).addLogicalErrorMess(
			this, CProtocolDefs.protocoleDefs.getProtocolDef(this.conn.remoteProtocolNum).findNode(this.tracer, CDefNode.NDAFTB).fullIdInString, wArgIst.structIst.toStringDescr(), wMessLE);

			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDCHCR 114300 (Adxcpl_setColor) Modification couleur champ/cellule
	 * tableau Id=[NDCHCR] x3func=[Adxcpl_setColor] elems=[hasArg:2] nb=[2] ist
	 * =[ win=[2] srn=[4] blc=[1] fld=[5] idx=[1] ] st=[.x14]
	 * Dump=[.x00.x00.x09.x11.x43.x02.x04.x01.x05.x00.x01.x14]
	 */
	,
	listenNodeNDCHCR: function(aSegmentNode) {
		if (this.tracer.isTraceDebugOn() && this.tracer.traceModuleFilter(CAdapiClientConfig.TRACER_MODULE_MODIFIER)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCHCR);
			wTB.appendDescr("!DEPRECATED NODE");
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		return true;
	}

	/**
	 * NDCHFM 0E4300 (Adxcpl_setFormat) Mise a jour Format champ/cellule tableau
	 * Id=[NDCHFM] x3func=[Adxcpl_setFormat] elems=[hasArg:2] nb=[2] ist =[
	 * win=[2] srn=[7] blc=[2] fld=[11] idx=[0] ] txt
	 * =[K:2#[.]2#[.]2#[.]2#[.]2#[ ]]
	 * Dump=[.x00.x00.x2C.x0E.x43.x02.x07.x02.x0B.
	 * x00.x00.x00.x22.x00.x20.x4B.x3A
	 * .x32.x23.x5B.x2E.x5D.x32.x23.x5B.x2E.x5D.x32
	 * .x23.x5B.x2E.x5D.x32.x23.x5B.x2E
	 * .x5D.x32.x23.x5B.x20.x20.x20.x20.x20.x20.x5D]
	 */
	,
	listenNodeNDCHFM: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wFormat = aSegmentNode.getNodeArgString(1).stringValue;
		if (this.tracer.isTraceDebugOn() && this.tracer.traceModuleFilter(CAdapiClientConfig.TRACER_MODULE_MODIFIER)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCHFM);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(LIB_FORMAT, wFormat);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wFormatSetter = new CServerFormatSetter(
		this.adapiClient, wFormat);
		var wIst = wArgIst.structIst;
		this.adapiClient.traverseSettable(wIst, wFormatSetter);
		if (wFormatSetter.hasInferredState() && wArgIst.structIst.isCellIst()) {
			// pour designer la colonne
			wIst.setLine(-1);
			var wStateSetter = new CEntityStateSetter(this.tracer, wFormatSetter.inferredState);
			this.adapiClient.traverseSettable(wIst, wStateSetter);
		}
		if (!wFormatSetter.done()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_SETTER_FORMAT, wFormat, wFormatSetter);
			(this.reply).addLogicalErrorMess(this, METH_NDCHFM, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDCHGR 0E1F00 (Adxcpl_setState) Activation / desactivation champ/cellule
	 * tableau 0 grizo 1 actzo 2 diszo
	 */
	,
	listenNodeNDCHGR: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wState = aSegmentNode.getNodeArgByte(1).intValue;
		// 0 "SRV_GRIZO";
		// 1 "SRV_ACTZO"
		// 2 "SRV_DISZO";
		if (this.tracer.isTraceDebugOn() && this.tracer.traceModuleFilter(CAdapiClientConfig.TRACER_MODULE_MODIFIER)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCHGR);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(LIB_STATE, CAdapiEntity.x3StateToString(wState));
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		// entityState - status Java
		var entityState = CAdapiEntity.x3State2EntityState(wState);
		var wStateSetter = new CServerStateSetter(this.tracer, entityState);
		this.adapiClient.traverseSettable(wArgIst.structIst, wStateSetter);
		if (!wStateSetter.done()) {
			(this.reply).addLogicalErrorMess(
			this, METH_NDCHGR, wArgIst.structIst.toStringDescr(), buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_SETTER_STATE, CAdapiEntity.x3StateToString(wState), wStateSetter));
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	},
	listenNodeNDCHVB: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wExtendResu = aSegmentNode.getNodeExtendResu(0);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCHVB);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(wExtendResu.valueResu);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wValueSetter = new CServerValueSetter(this.tracer, wExtendResu.valueResu);
		this.adapiClient.traverseSettable(wArgIst.structIst, wValueSetter);
		if (!wValueSetter.done()) {
			var wBlobSize = String.valueOf(wExtendResu.valueResu.valueLength);
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_SETTER_BLOB, wBlobSize, wValueSetter);
			(this.reply).addLogicalErrorMess(this, METH_NDCHVB, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDCHVL 114600 (Adxcpl_setValue) Mise a jour valeur champ/cellule tableau
	 *
	 * IN--> Id=[NDCHVL] x3func=[Adxcpl_setValue] elems=[hasArg:2] nb=[2] ist =[
	 * win=[2] srn=[4] blc=[1] fld=[2] idx=[4] ] st=[ typ=[122,STRU] val=[CPT] ]
	 * Dump
	 * =[.x00.x00.x12.x11.x46.x02.x04.x01.x02.x00.x04.x7A.x03.x00.x43.x00.x50
	 * .x00.x54.x00.x00]
	 */

	,
	listenNodeNDCHVL: function(aSegmentNode) {
		var resu = aSegmentNode.getNodeArgResu(1);
		var ist = aSegmentNode.getNodeArgIst(0).structIst;
		if (this.tracer.traceLevelFilter(ITracer.LEVEL_DEBUG)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCHVL);
			wTB.appendDescr(aSegmentNode.getNodeArgIst(0));
			wTB.appendDescr(resu);
			aSegmentNode.addDescrInTB(wTB);
			this.tracer.trace(this, wTB.toString());
			this.tracer.pushTraceBuffer(wTB);
		}
		var wValueSetter = new CServerValueSetter(this.tracer, resu.resu);
		this.adapiClient.traverseSettable(ist, wValueSetter);
		if (!wValueSetter.done()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_SETTER_VALUE, resu.toStringDescr(), wValueSetter);
			(this.reply).addLogicalErrorMess(this, METH_NDCHVL, ist.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDCHST 0E3400 (Adxcpl_setStyle) Mise a jour Style champ/cellule tableau
	 * Id=[NDCSTL] x3func=[Adxcpl_setStyle] elems=[hasArg:2] nb=[2] ist =[
	 * win=[2] srn=[7] blc=[2] fld=[11] idx=[0] ] txt =[STYLE]
	 */
	,
	listenNodeNDCSTL: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var sty = aSegmentNode.getNodeArgString(1).stringValue;
		if (this.tracer.isTraceDebugOn() && this.tracer.traceModuleFilter(CAdapiClientConfig.TRACER_MODULE_MODIFIER)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCSTL);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(LIB_STYLE, sty);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wStyleSetter = new CServerStyleSetter(this.tracer, sty, StyleApply.getApply(wArgIst));
		this.adapiClient.traverseSettable(wArgIst.structIst, wStyleSetter);
		if (!wStyleSetter.done()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_SETTER_STYLE, sty, wStyleSetter);
			(this.reply).addLogicalErrorMess(this, METH_NDCHST, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDCTIT 0E3300 (Adxcpl_setLabel) Mise a jour label d'un objet modelise
	 * Id=[NDCTIT] level=[?] x3func=[Adxcpl_setLabel] nb=[2] ist=[ win=[2]
	 * srn=[0] blc=[0] fld=[0] idx=[0] ] txt =[Utilisateurs]
	 */
	,
	listenNodeNDCTIT: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wTitle = aSegmentNode.getNodeArgString(1).stringValue;
		if (this.tracer.isTraceDebugOn() && this.tracer.traceModuleFilter(CAdapiClientConfig.TRACER_MODULE_MODIFIER)) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDCTIT);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(LIB_TITLE, wTitle);
			aSegmentNode.addDescrInTB(wTB);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		this.adapiClient.traverseSettable(wArgIst.structIst, new CServerTitleSetter(this.tracer, wTitle));
		return true;
	}

	/**
	 * Dynamisme des combos des menus locaux
	 */
	,
	listenNodeNDDSLB: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var value = aSegmentNode.getNodeArgByte(1).intValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDDSLB);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("State", value);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}

		var v = null;
		if (this.sendContext != null) {
			var currentIst = this.sendContext.get(
			SENDCTX_PARAM_TARGET);
			if (currentIst != null) {
				v = this.adapiClient.findModifiable(currentIst);
				if (v != null && v instanceof CAdapiVariableCombo) {
					v.setServerDisabledChoice(value);
				}
			}
		}
		if (v == null) {
			Utils.toConsole("NDDSLB - Variable not found[" + wArgIst.structIst.alphanumCodage + "]");
		}
		return true;
	}

	/**
	 * override nedexeci to get the ack_call readed
	 */
	,
	listenNodeNDEXECI: function(aSegmentNode) {
		var result = TODO_SUPER.listenNodeNDEXECI(aSegmentNode);
		var ack_call = this.adonixReply.execIstArgs;
		// FDB - ON passe this.adapiClient.currentField pour le
		// notiyObservers
		new CAdapiInstanceExeci(ack_call.xml, this.adapiClient, this.adapiClient.currentField);

		return result;
	}

	/**
	 * NDGLAR 0E2E00 (LeftList_SelectLine) Selection ligne dans liste simple ou
	 * arbre
	 */
	,
	listenNodeNDGLAR: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wCle = aSegmentNode.getNodeArgTblResuOld(1);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDGLAR);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr(wCle);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wLeftListLineSelecter = new CLeftListSelecterByKey(
		this.tracer, true, wCle, this);
		this.adapiClient.traverseSettable(wArgIst.structIst, wLeftListLineSelecter);
		if (!wLeftListLineSelecter.done()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_LLLINE_SELECTER, wCle.toStringDescr(), wLeftListLineSelecter);
			(this.reply).addLogicalErrorMess(this, METH_NDGLAR, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDINSLI 0E0B00 (Adxcpl_addGridLines) Ajout lignes dans tableau
	 *
	 * Parametres : - sX3Adxid *psAdxidTarget : Identifiant de la cible [in] -
	 * short nStartLine : ligne de depart [in] - short nNbLine : Nombre de
	 * lignes [in]
	 *
	 * Id=[NDINSLI] x3func=[Adxcpl_addGridLines] elems=[hasArg:3] nb=[3] ist =[
	 * win=[2] srn=[4] blc=[1] fld=[0] idx=[0] ] sh1=[1] sh2=[44]
	 * Dump=[.x00.x00.x0C.x0E.x0B.x02.x04.x01.x00.x00.x00.x00.x01.x00.x2C]
	 *
	 * Remarque : A la construction d'une fenetre, un tableau est toujours cree
	 * avec une ligne d'en-tete et une ligne vide.
	 */
	,
	listenNodeNDINSLI: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wTargetLine = aSegmentNode.getNodeArgShort(1).intValue;
		var wNbLines = aSegmentNode.getNodeArgShort(2).intValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDINSLI);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("TargetLine", wTargetLine);
			wTB.appendDescr("NbLines", wNbLines);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		Utils.toConsole("INSLI - Start=" + wTargetLine + " - Nb=" + wNbLines);
		var wDataSrcInserter = new CDataSrcInserter(
		this.adapiClient, wTargetLine, wNbLines);
		this.adapiClient.traverseSettable(wArgIst.structIst, wDataSrcInserter);
		if (wDataSrcInserter.hasLogicalErrMess()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_INSERTER, String.valueOf(wNbLines), String.valueOf(wTargetLine), wDataSrcInserter);
			(this.reply).addLogicalErrorMess(this, METH_NDINSLI, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * Traitement des noeud NDOBOXI transportant des messages synchrones. Compte
	 * tenu du m�canisme de si le noeud NDOBOXI n'est pas trait� ici, il sera
	 * trait� dans la m�thode "listenNodeNDOBOXI" de la classe "CAdonixRequest"
	 *
	 * NDBOXI 0E0108 (MessageBox_Create)
	 *
	 * Transporte les demandes d'affichage synchrone
	 *
	 * Infbox "$$TEMPOPE" + WMESS Infbox "$$TEMPCLO" Infbox "$$VLC_OPE" +
	 * INTTEXT + "^" + INTNUM Titled TITREWINDOW + "^" + WLIB1 + "^" + WLIB2
	 * Infbox "$$VLC_MOD" + VALEXT + "^" + VALNUM Infbox "$$VLC_CLO" Infbox
	 * "$$PROGOPE" Titled TITREWINDOW Infbox "$$PROGMOD" + WMAX + "^" +
	 * WPROGRESS + "^" + WLIB Infbox "$$PROGCLO"
	 *
	 * simulation de close session Infbox "$$SESSCLO"
	 *
	 * pilotage timeout de la requ�te courante - Timeout d'une heure si
	 * $$DBG_OPE + texte - Timeout standard si $$DBG_CLO + texte
	 */
	,
	listenNodeNDOBOXI: function(aSegmentNode) {
		var wTypeBox = aSegmentNode.getNodeArgByte(0).byteValue;
		if (wTypeBox == OU_BIF) {
			var wMessText = aSegmentNode.getNodeArgString(2).stringValue;
			var wPos = wMessText.indexOf(CAdapi.AFF_SYNCHRONE_HEADER);
			// si le message contient "$$" au debut (pos 0 ou 1) : c'est un
			// message d'affichage asynchone
			if (wPos == 0 || wPos == 1) {
				var wMessTitre = aSegmentNode.getNodeArgString(3).stringValue;
				var wSleep = aSegmentNode.getNodeArgByte(4).byteValue;
				wMessText.replace('\r', ' ');
				wMessTitre.replace('\r', ' ');
				var wAffSynchroneType = getAffSynchroneType(wMessText, wPos);
				var wAffSynchroneAction = getAffSynchroneAction(wMessText, wPos);
				// si simulation de timeout session, recup timeout reponse
				// automatique
				if (wAffSynchroneType == CAdapi.AFF_SYNCHRONE_TYPE_SESSION) {
					wSleep = (this.commClient).maxTimeBeforeAutomaticHangUp;
				} else if (wAffSynchroneType == CAdapi.AFF_SYNCHRONE_TYPE_DEBUGON) {
					if (wAffSynchroneAction == CAdapi.AFF_SYNCHRONE_ACTION_CLOSE) {
						wAffSynchroneType = CAdapi.AFF_SYNCHRONE_TYPE_DEBUGOFF;
					}
				}
				wMessText = removeAffSynchronePrefix(wMessText, wPos);
				if (this.tracer.isTraceDebugOn()) {
					var wTB = this.tracer.popTraceBuffer();
					wTB.appendMethodName(LIB_METHOD_LISTEN);
					wTB.append(aSegmentNode.nodeIdInString);
					var wLibType = CAdapi.affSynchroneTypeToString(wAffSynchroneType);
					wTB.appendDescr(LIB_MESS_TYP, wAffSynchroneType, wLibType != null ? wLibType : "unknown type");
					var wLibAction = CAdapi.affSynchroneActionToString(wAffSynchroneAction);
					wTB.appendDescr(LIB_MESS_ACT, wAffSynchroneAction, wLibAction != null ? wLibAction : "unknown action");
					wTB.appendDescr(LIB_MESS_TEXT, wMessText.replace('\n', '.'));
					wTB.appendDescr(LIB_MESS_TITRE, wMessTitre.replace('\n', '.'));
					aSegmentNode.addDescrInTB(wTB); // 14w_006 - Bug 31739 -
					// gestion tableau
					this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
					this.tracer.pushTraceBuffer(wTB);
				}
				// construction et stockage du message Synchone dans le client
				var wAdapiMessage = new CAdapiMessage(
				wAffSynchroneType, wAffSynchroneAction, wMessText, wMessTitre, -1, wSleep, -1, this.adapiClient);
				this.adapiClient.pushAffSynchroneMessage(wAdapiMessage);
				// memorisation dans la requete qu'il y a eu au moins un message
				// Synchrone et qu'il est peut �tre du type DEBBUG
				setFlagsMessagesSynchrones(wAdapiMessage.isAffSynchroneDebug());
				// pour que le message "$$DBG_OFF" (type 22) arrive au browser,
				// on le met directement dans le reply !
				if (wAffSynchroneType == CAdapi.AFF_SYNCHRONE_TYPE_DEBUGOFF) {
					this.adonixReply.addMessage(wAdapiMessage);
				}
				// puisque ndboxi pour un affichage synchrone => reply immediat
				var wDefaultButton = 5;
				listenNodeNDOBOXISendAutoReply(wDefaultButton);
				// positionnement du fait que l'on a deja envoye une reponse
				// pouyr ce segment
				aSegmentNode.setAutoReplied();
				return true;
			}
		}
		// si le noeud NDOBOXI n'est pas traite ici, il sera trait� dans la
		// methode "listenNodeNDOBOXI" de la classe "CAdonixRequest"
		return TODO_SUPER.listenNodeNDOBOXI(aSegmentNode);
	}

	/**
	 * NDOCAR 0E012A (LeftList_NewFormat) Mise a jour Label/Format colonnesListe
	 * simple et arbre
	 */
	,
	listenNodeNDOCAR: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wWhat = aSegmentNode.getNodeArgByte(1).intValue;
		var wDefs = aSegmentNode.getNodeArgTblResuOld(2);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDOCAR);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("What", wWhat);
			wTB.appendDescr(wDefs);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		if (!wDefs.isComplete()) {
			var wMessMdl = this.adapiClient.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_ARG_RESU_TBL);
			var wMess = CStringFacilities.sprintf(wMessMdl, "Defs", String.valueOf(wDefs.size()), String.valueOf(wDefs.nbReceivedElements));
			wMessMdl = this.adapiClient.adapiResources.getMessage(
			CAdapiResources.KEYMESS_NDOCAR_WHAT);
			wMess += CStringFacilities.sprintf(wMessMdl, String.valueOf(wWhat));
			(this.reply).addLogicalErrorMess(this, METH_NDOCAR, wArgIst.structIst.toStringDescr(), wMess);
		}
		var wModifier = new CLeftListColumnsModifier(
		this.tracer, wWhat, wDefs);
		this.adapiClient.traverseSettable(wArgIst.structIst, wModifier);
		return true;
	}

	/**
	 * NDOFENH 0E0103 (Help_Direct) Demande affichage aide
	 */
	,
	listenNodeNDOFENH: function(aSegmentNode) {
		var wTxt = aSegmentNode.getNodeArgString(0).stringValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDOFENH);
			wTB.appendDescr(LIB_TEXT, wTxt);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		this.x3Reply.setAskOpenHelpParam(wTxt);
		return true;
	}

	/**
	 * 14w_022 - Fiche 34442 - Support du noeud NDOFLD pour l'editeur de formule
	 * Traitemet du noeud specifique d'ajout de definition de champ dans
	 * l'editeur de formule en simulant un noeud NDOLAR pour charge la premiere
	 * liste gauche de 6 colonnes de la fenetre "_FORMULA"
	 *
	 * NDOFLD 0E0128 (de formule) Ajout informations dans les arbres de
	 * l'editeur de Formules
	 * "tsrfld","Lecture des Parametres et Appel a la Fonction"
	 * "ist","nxtist( ist )","ist " "string","nxtstu( st1 )","st1 "
	 * "string","nxtstu( st2 )","st2 " "string","nxtstu( st3 )","st3 "
	 * "short","st0 = nxtint( )","st0" "string","nxtstu( st4 )","st4 "
	 * "string","nxtstu( st5 )","st5 "
	 */
	,
	listenNodeNDOFLD: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wTxt1 = aSegmentNode.getNodeArgString(1).stringValue;
		var wTxt2 = aSegmentNode.getNodeArgString(2).stringValue;
		var wTxt3 = aSegmentNode.getNodeArgString(3).stringValue;
		var wInt1 = aSegmentNode.getNodeArgShort(4).intValue;
		var wTxt4 = aSegmentNode.getNodeArgString(5).stringValue;
		var wTxt5 = aSegmentNode.getNodeArgString(6).stringValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName("NDOFLD");
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("Txt1", wTxt1);
			wTB.appendDescr("Txt2", wTxt2);
			wTB.appendDescr("Txt3", wTxt3);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wIst = wArgIst.structIst;
		wIst.setScreenLeftList();
		wIst.setBloc(1);
		wIst.setLine(-1);
		var wLine = new CNodeArgTblResu(this.tracer, 6);
		wLine.setResu(0, CStructResu.X3TYP_STRU, wTxt1);
		wLine.setResu(1, CStructResu.X3TYP_STRU, wTxt2);
		wLine.setResu(2, CStructResu.X3TYP_STRU, wTxt3);
		wLine.setResu(3, CStructResu.X3TYP_STRU, String.valueOf(wInt1));
		wLine.setResu(4, CStructResu.X3TYP_STRU, wTxt4);
		wLine.setResu(5, CStructResu.X3TYP_STRU, wTxt5);
		var wClf = new CNodeArgTblResu(this.tracer, 0);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName("listenNDOFLD");
			wIst.addDescrInTB(wTB);
			wLine.addDescrInTB(wTB);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		this.adapiClient.traverseSettable(wIst, new CLeftListAppender(this.tracer, -1, 0, "", wLine, wClf, null));
		return true;
	}

	/**
	 * NDOLAR E012B (LeftList_AddLine) Ajout ligne dans liste simple et arbre
	 *
	 * Id=[NDOLAR] level=[?] x3func=[LeftList_AddLine] nb=[7] ist =[ win=[2]
	 * srn=[34] blc=[1] fld=[0] idx=[0]] sh1=[19] sh2=[.x00] txt =[] val, st
	 * =[.x02
	 * ;.x7A;.x05;.x00;.x41;.x00;.x53;.x00;.x4E;.x00;.x55;.x00;.x32;.x00;.x00
	 * ;.x7A
	 * ;.x11;.x00;.x55;.x00;.x74;.x00;.x69;.x00;.x6C;.x00;.x69;.x00;.x73;.x00
	 * ;.x61
	 * ;.x00;.x74;.x00;.x65;.x00;.x75;.x00;.x72;.x00;.x20;.x00;.x41;.x00;.x53
	 * ;.x00;.x4E;.x00;.x20;.x00;.x32;.x00;.x00] clf, st
	 * =[.x01;.x7A;.x05;.x00;.x41
	 * ;.x00;.x53;.x00;.x4E;.x00;.x55;.x00;.x32;.x00;.x00] clp, st =[.x00]
	 *
	 * ist short byte stru resu_tbl_old resu_tbl_old resu_tbl_old
	 */
	,
	listenNodeNDOLAR: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wIdx = aSegmentNode.getNodeArgShort(1).intValue;
		var wBranche = aSegmentNode.getNodeArgByte(2).intValue;
		var wTxt = aSegmentNode.getNodeArgString(3).stringValue;
		var wVal = aSegmentNode.getNodeArgTblResuOld(4);
		var wClf = aSegmentNode.getNodeArgTblResuOld(5);
		var wClp = aSegmentNode.getNodeArgTblResuOld(6);
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDOLAR);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("Idx", wIdx);
			wTB.appendDescr("Branche", wBranche);
			wTB.appendDescr(wClf);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		if (!wVal.isComplete() || !wClf.isComplete() || !wClp.isComplete()) {
			var wMess = "";
			var wMessMdl = this.adapiClient.adapiResources.getMessage(
			CAdapiResources.KEYMESS_ERROR_ARG_RESU_TBL);
			if (!wVal.isComplete()) {
				wMess += CStringFacilities.sprintf(wMessMdl, "Val", String.valueOf(wVal.size()), String.valueOf(wVal.nbReceivedElements));
			}
			if (!wClf.isComplete()) {
				wMess += CStringFacilities.sprintf(wMessMdl, "Clf", String.valueOf(wVal.size()), String.valueOf(wClf.nbReceivedElements));
			}
			if (!wClp.isComplete()) {
				wMess += CStringFacilities.sprintf(wMessMdl, "Clp", String.valueOf(wVal.size()), String.valueOf(wClp.nbReceivedElements));
			}(this.reply).addLogicalErrorMess(this, METH_NDOLAR, wArgIst.structIst.toStringDescr(), wMess);
			this.tracer.trace(this, 1, "####" + wMess);
		}
		this.adapiClient.traverseSettable(
		wArgIst.structIst, new CLeftListAppender(this.tracer, wIdx, wBranche, wTxt, wVal, wClf, wClp));
		return true;
	}

	/**
	 * NDOMNBO 0E0161 (menu_New) Stockage param�tres d'element de menu -
	 * Exemples: Id=[NDOMNBO] idm=[50504] rng=[10] ide=[-985112310] flg=[.x18]
	 * cod=[1119] txt =[Selection avancee] acc=[0] Id=[NDOMNBO] idm=[307]
	 * rng=[50] ide=[50504] flg=[.x10] cod=[1024] txt =[Selection] acc=[0]
	 * Id=[NDOMNBO] level=[W] x3func=[menu_New] NbArgs=[7] idm=[307] rng=[50]
	 * ide=[50501] flg=[.x10] cod=[1024] txt =[S�lection] acc=[0]
	 */
	,
	listenNodeNDOMNBO: function(aSegmentNode) {
		var wIdm = aSegmentNode.getNodeArgInt(0).intValue;
		var wRng = aSegmentNode.getNodeArgShort(1).intValue;
		var wIde = aSegmentNode.getNodeArgInt(2).intValue;
		var wFlg = aSegmentNode.getNodeArgByte(3).intValue;
		var wActionId = aSegmentNode.getNodeArgShort(4).intValue;
		var wTxt = aSegmentNode.getNodeArgString(5).stringValue;
		var wAcc = aSegmentNode.getNodeArgShort(6).intValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDOMNBO);
			wTB.appendDescr(LIB_ACTION_ID, wActionId);
			wTB.appendDescr(LIB_LIB, wTxt);
			wTB.appendDescr(LIB_MENU_ID, wIdm);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		this.x3Reply.addMenuWin(wFlg, wActionId, wTxt, wIdm, wRng, wIde, wAcc);
		return true;
	}

	/**
	 * Id=[NDOUVIMP] x3func=[Impression_ChargeReport] elems=[hasArg:5,hasExtend]
	 * NbArgs=[5] st1=[.x00] st2=[.x00] buf[1] =[] buf[2] =[] buf[3] =[]
	 * NbExtends=[1] nb=[1] len=[18] 0=[ nb=[23] 0=[ id=[__REPORT]
	 * value=[TABCOUNTRY.rpt] length=[23]] 1=[ id=[__DESTINATION] value=[0]
	 * length=[15]] 2=[ id=[__TYPDBA] value=[1] length=[10]] 3=[
	 * id=[__DBDATABASE] value=[DV140] length=[18]] 4=[ id=[__DBUSER]
	 * value=[GX3APP] length=[15]] 5=[ id=[__DBPASSWORD] value=[tiger]
	 * length=[18]] 6=[ id=[__APPLICATION] value=[GX3APP;gaile610;1940]
	 * length=[34]] 7=[ id=[__APPRPT] value=[GX3APP;gaile610;1940] length=[29]]
	 * 8=[ id=[__RPTLAN] value=[null] length=[9]] 9=[ id=[X3DOS]
	 * value=[GX3APP;gaile610;1940] length=[26]] 10=[ id=[__REQUETE]
	 * value=[81595] length=[15]] 11=[ id=[_PreVisuOptions]
	 * value=[11111111111111111111] length=[36]] 12=[ id=[X3CLI] value=[X3]
	 * length=[8]] 13=[ id=[X3EDT] value=[Etat Adonix Copyright Adonix]
	 * length=[34]] 14=[ id=[X3ETA] value=[TABCOUNTRY] length=[16]] 15=[
	 * id=[X3TIT] value=[Pays] length=[10]] 16=[ id=[X3OPE] value=[Olivier
	 * Gattaz ccc] length=[24]] 17=[ id=[X3USR] value=[OG] length=[8]] 18=[
	 * id=[X3LAN] value=[FRA] length=[9]] 19=[ id=[X3SIT1] value=[*] length=[8]]
	 * 20=[ id=[X3SIT2] value=[z] length=[8]] 21=[ id=[paysdeb] value=[ ]
	 * length=[10]] 22=[ id=[paysfin] value=[zzzzzzzzzz] length=[18]] ]
	 */
	,
	listenNodeNDOUVIMP: function(aSegmentNode) {
		// Les argument du noeud NDOUVIMP ne sont pas pris en compte
		// recuperation de l'extend properties associee au noeud NDOUVIMP
		// FDB Non utilisé - CNodeExtendProperties wExtendProperties =
		// (CNodeExtendProperties) ((CSegmentNodeExtended)
		// aSegmentNode).getNodeExtend(0);
		// FDB Non utilisé -
		// this.x3Reply.addAdapiReport(wExtendProperties.properties);
		var wSegReplyBinShort = new CSegmentReplyBinShort(
		this.tracer, true, 1);
		try {
			if (this.adapiClient.typeClient == ETypeClient.JULIET) {
				this.connClient.writeSegment(wSegReplyBinShort);
			} else {
				this.adapiClient.writeSegment(wSegReplyBinShort, false);
			}
		} catch (e) {
			this.adonixClient.setServerNotConnected();
			var wErrMess = this.adonixClient.adonixResources.getMessCantSendAutomaticReply("NDOUVIMP");
			// 16w_104 - refonte interface de CException
			throw new CCommException(CCommException.CANT_SEND, e, wErrMess);
		}
		return true;
	}

	/**
	 * NDOWIN 0E0157 (Adxcpl_OpenWin) Ouverture fenetre (Fille - Independante -
	 * Selection - Formule) IN--> Id=[NDOWIN] x3func=[Adxcpl_OpenWin]
	 * elems=[hasArg:4,hasExtend] nb=[4] ist =[ win=[2] srn=[0] blc=[0] fld=[0]
	 * idx=[0]] nmw =[OAUS] nmf =[GESAUS] tsp =[20030617110837] NbExtends=[1]
	 */
	,
	listenNodeNDOWIN: function(aSegmentNode) {
		var wIst = aSegmentNode.getNodeArgIst(0);
		var wWindowsId = aSegmentNode.getNodeArgString(1).stringValue;
		var wFunctionId = aSegmentNode.getNodeArgString(2).stringValue;
		var wStamp = aSegmentNode.getNodeArgString(3).stringValue;
		// pour ex�cuter le traitement "standard" d'un empoilage de fenetre
		TODO_SUPER.listenNodeNDOWIN(aSegmentNode);
		// glute : protection contre les ouvertures de fenetre tempon
		if (wWindowsId.equals(WINDOW_TEMPON_ID)) {
			if (this.tracer.isTraceCallsOn()) {
				var wTB = this.tracer.popTraceBuffer();
				wTB.appendMethodName(METH_NDOWIN);
				wTB.append("Open Window TEMPON => nothing to do");
				wTB.appendDescr(LIB_IST, wIst.toStringDescr());
				aSegmentNode.addDescrInTB(wTB); // 14w_006 - Bug 31739 - gestion
				// tableau
				this.tracer.trace(this, ITracer.LEVEL_CALLS, wTB);
				this.tracer.pushTraceBuffer(wTB);
			}
			this.nbNodeOpenTempon++;
			return true;
		}
		// gestion de la compatibilite des prefixes '&' et '_'
		if (wWindowsId.charAt(0) == '&') {
			wWindowsId = CAdapiWindow.PREFIX_SPECIAL + wWindowsId.substring(1);
		}
		if (this.tracer.isTraceCallsOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDOWIN);
			wTB.appendDescr(wIst);
			wTB.appendDescr(LIB_WINDOW_ID, wWindowsId);
			wTB.appendDescr(LIB_FUNCTION_ID, wFunctionId);
			wTB.appendDescr(LIB_WINDOW_STAMP, wStamp);
			aSegmentNode.addDescrInTB(wTB);
			this.tracer.trace(this, ITracer.LEVEL_CALLS, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wAdapiStackedWindow = null;
		var wX3Reply = this.x3Reply;
		try {
			wX3Reply.setChangeWindow();
			// construction et stockage du message Synchone "TYPE_NDOWIN" dans
			// le client
			// instancie une CAdapiStackedWindow : load la description et
			// instancie les structures
			wAdapiStackedWindow = this.adapiClient.pushRequesterWindow(
			wWindowsId, wFunctionId, wStamp, wIst.structIst.win);
			wX3Reply.addPushedWindow(wAdapiStackedWindow);
			wX3Reply.setStamp(wStamp);
			if (aSegmentNode instanceof CSegmentNodeExtended) {
				var wSegNodeExtended = aSegmentNode;
				if (wSegNodeExtended.hasExtends()) {
					var wExtendedInfos = (wSegNodeExtended.getNodeExtend(0)).value;
					wAdapiStackedWindow.setNDOWinComplementDescr(wExtendedInfos);
				}
			}
			if (this.tracer.isTraceDebugOn()) {
				var wTB = this.tracer.popTraceBuffer();
				wTB.appendMethodName(METH_NDOWIN);
				wTB.appendDescr("isWindowChanged", wX3Reply.isWindowChanged());
				wTB.appendDescr("hasPushedWindow", wX3Reply.hasPushedWindow());
				wTB.appendDescr("NbPushedWindows", wX3Reply.nbPushedWindows);
				wTB.appendDescr("LastPushedWindowId", wX3Reply.lastPushedWindowId);
				aSegmentNode.addDescrInTB(wTB);
				this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
				this.tracer.pushTraceBuffer(wTB);
			}
		} catch (e) {
			wX3Reply.setStatusNOTOK(e);
			wX3Reply.setAskCloseSession(true);
		}
		return true;
	}

	/**
	 * NDRZAR 0E2D00 (LeftList_DeleteAllLine) Suppression de toute les lignes
	 * dans liste simple ou arbre
	 */
	,
	listenNodeNDRZAR: function(aSegmentNode) {
		this.adapiClient.traverseSettable(
		aSegmentNode.getNodeArgIst(0).structIst, new CLeftListDeleter(this.tracer));
		return true;
	}

	/**
	 * NDSUPLI 0E0A00 (Adxcpl_delGridLines) Suppression lignes dans tableau
	 */
	,
	listenNodeNDSUPLI: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wTargetLine = aSegmentNode.getNodeArgShort(1).intValue;
		var wNbLines = aSegmentNode.getNodeArgShort(2).intValue;
		if (this.tracer.isTraceDebugOn()) {
			var wTB = this.tracer.popTraceBuffer();
			wTB.appendMethodName(METH_NDSUPLI);
			wTB.appendDescr(wArgIst);
			wTB.appendDescr("TargetLine", wTargetLine);
			wTB.appendDescr("NbLines", wNbLines);
			this.tracer.trace(this, ITracer.LEVEL_DEBUG, wTB);
			this.tracer.pushTraceBuffer(wTB);
		}
		var wDataSrcDeleter = new CDataSrcDeleter(this.adapiClient, wTargetLine, wNbLines);
		this.adapiClient.traverseSettable(wArgIst.structIst, wDataSrcDeleter);
		if (wDataSrcDeleter.hasLogicalErrMess()) {
			var wMessLE = this.buildListenNodeMessage(
			CAdapiResources.KEYMESS_ERROR_DELETER, String.valueOf(wNbLines), String.valueOf(wTargetLine), wDataSrcDeleter);
			(this.reply).addLogicalErrorMess(this, METH_NDSUPLI, wArgIst.structIst.toStringDescr(), wMessLE);
			aSegmentNode.setLogicalErrFlag();
		}
		return true;
	}

	/**
	 * NDULAR 0E3100 (LeftList_DeselectLine) Deselection ligne dans liste simple
	 * ou arbre
	 */
	,
	listenNodeNDULAR: function(aSegmentNode) {
		var wArgIst = aSegmentNode.getNodeArgIst(0);
		var wCle = aSegmentNode.getNodeArgTblResuOld(1);
		this.adapiClient.traverseSettable(wArgIst.structIst, new CLeftListSelecterByKey(this.tracer, false, wCle, this));
		return true;
	}

	/**
	 * Traite les segment "CSegmentNode" et interromp l'attente si neoud
	 * "isNodeWaitUser". (non-Javadoc)
	 */
	,
	listenSegment: function(aSegment) {
		if (!validSegmentNode(aSegment)) {
			return false;
		}
		var wProcessed = false;
		var wSegmentNode = aSegment;
		var wNodeId = wSegmentNode.nodeId;
		switch (wNodeId) {
		case CDefNode.NDOLAR:
			wProcessed = listenNodeNDOLAR(wSegmentNode);
			break;
		case CDefNode.NDCHVL:
			wProcessed = listenNodeNDCHVL(wSegmentNode);
			break;
		case CDefNode.NDCHVB:
			wProcessed = listenNodeNDCHVB(wSegmentNode);
			break;
		case CDefNode.NDCHFM:
			wProcessed = listenNodeNDCHFM(wSegmentNode);
			break;
		case CDefNode.NDCHGR:
			wProcessed = listenNodeNDCHGR(wSegmentNode);
			break;
		case CDefNode.NDCHCR:
			wProcessed = listenNodeNDCHCR(wSegmentNode);
			break;
		case CDefNode.NDOFLD:
			wProcessed = listenNodeNDOFLD(wSegmentNode);
			break;
		case CDefNode.NDCTIT:
			wProcessed = listenNodeNDCTIT(wSegmentNode);
			break;
		case CDefNode.NDCSTL:
			wProcessed = listenNodeNDCSTL(wSegmentNode);
			break;
		case CDefNode.NDGLAR:
			wProcessed = listenNodeNDGLAR(wSegmentNode);
			break;
		case CDefNode.NDINSLI:
			wProcessed = listenNodeNDINSLI(wSegmentNode);
			break;
		case CDefNode.NDOCAR:
			wProcessed = listenNodeNDOCAR(wSegmentNode);
			break;
		case CDefNode.NDSUPLI:
			wProcessed = listenNodeNDSUPLI(wSegmentNode);
			break;
		case CDefNode.NDAFTB:
			wProcessed = listenNodeNDAFTB(wSegmentNode);
			break;
		case CDefNode.NDRZAR:
			wProcessed = listenNodeNDRZAR(wSegmentNode);
			break;
		case CDefNode.NDULAR:
			wProcessed = listenNodeNDULAR(wSegmentNode);
			break;
		case CDefNode.ND_CLF:
			wProcessed = listenNodeND_CLF(wSegmentNode);
			break;
		case CDefNode.NDDSLB:
			wProcessed = listenNodeNDDSLB(wSegmentNode);
			break;
		case CDefNode.ND_NAP:
			wProcessed = listenNodeND_NAP(wSegmentNode);
			break;
		case CDefNode.NDOMNAO:
		case CDefNode.NDOMNBO:
			wProcessed = listenNodeNDOMNBO(wSegmentNode);
			break;
		case CDefNode.NDOUVIMP:
			wProcessed = listenNodeNDOUVIMP(wSegmentNode);
			break;
		case CDefNode.NDOFENH:
			wProcessed = listenNodeNDOFENH(wSegmentNode);
			break;
		case CDefNode.ND_ASK:
			// AskUI_Call]
			wProcessed = listenNodeND_ASK(wSegmentNode);
			break;
		default:
		}
		if (wProcessed) {
			this.receivedSegments.add(wSegmentNode);
			// noeud pour rendre la main a l'utilisateur => traitement du noeud
			// complet et fin d'attente
			if (wSegmentNode.isNodeWaitUser()) {
				if (this.adonixClient.typeClient == ETypeClient.JULIET) {
					breakWaiting(true);
				}
			}
			return wProcessed;
		} else {
			return TODO_SUPER.listenSegment(aSegment);
		}
	},
	listenSendingArgs: function(aRequestId, aCommClient, aParams) {
		switch (aRequestId) {
		case CDefAction.SRV_BRWCHANGELINE:
		case CDefAction.SRV_BRWSELECTLINE:
		case CDefAction.SRV_TREECHANGELINE:
		case CDefAction.SRV_TREEEXPANDLINE:
		case CDefAction.SRV_TREESELECTLINE:
			listenActionArgsDOLEFTLISTLINE(aCommClient, aParams);
			break;
		case CDefAction.SRV_BRWRAPIDESEL:
			listenActionArgsBRWRAPIDESEL(aCommClient, aParams);
			break;
		case CDefAction.SRV_LIST_PAGE_DOWN:
			listenActionArgsLIST_PAGE_DOWN(aCommClient, aParams);
			break;
		case CDefAction.SRV_LIST_PAGE_UP:
			listenActionArgsLIST_PAGE_UP(aCommClient, aParams);
			break;
		case CDefAction.SRV_PICKING:
			// listenActionArgsPICKING(aCommClient, aParams);
			break;
		default:
			TODO_SUPER.listenSendingArgs(aRequestId, aCommClient, aParams);
		}
	},
	removeAffSynchronePrefix: function(aMess, aPos) {
		var wPosStart = aPos + CAdapi.AFF_SYNCHRONE_PREFIX_LONG;
		if (wPosStart < aMess.length() - 1) {
			return aMess.substring(wPosStart);
		} else {
			return "";
		}
	},
	retrieveAdapiLeftList: function(aAdapiClient, aParams) {
		return aAdapiClient.findModifiable(CStructIst.newStructIst(this.tracer, aParams.get(1)));
	},
	setLefListLineSelected: function(lefListLineSelected) {
		this.lefListLineSelected = lefListLineSelected;
	},
	setTargetAdxId: function(ist) {
		if (this.adonixReply instanceof CAdapiReply) {
			(this.adonixReply).setTargetAdxId(ist, this);
		} else {
			var reply = new CAdapiReply(this.adapiClient, this);
			reply.setOk(this.adonixReply.status);
			reply.setValue(this.adonixReply.binValue);
			reply.setTargetAdxId(ist, this);
		}
	}
});