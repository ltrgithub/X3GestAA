"use strict";
var helpers = require('syracuse-core/lib/helpers');
var CAdapiVariable = require('syracuse-x3/lib/fusion/CAdapiVariable').CAdapiVariable;

var CAdapiVariableLocalMenu = exports.CAdapiVariableLocalMenu = helpers.defineClass(function(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu) {
	CAdapiVariable.call(this, srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState);
	this.localMenu = aLocalMenu;
}, CAdapiVariable, {
	// True si la valeur formatee a du sens - false pour tout ce qui herite de menu car format non applique
	acceptEditFormat: function() {
		return false;
	},

	//abstract clone: function();
	// Fusion - Pas de format
	formatEditToDisplay: function(aValue) {
		return aValue;
	},
	getDisplayValue: function() {
		var val = this.getServerValue();
		try {
			if (val == null) {
				return EMPTY;
			}
			if (this.localMenu == null) {
				throw new Error("no local menu available.");
			}
			if (val.isNum()) {
				if (val.intValue > 0) {
					return this.localMenu.getLib(val.intValue);
				} else {
					return EMPTY;
				}
			} else {
				return val.value;
			}
		} catch (e) {
			return EMPTY;
		}
	},
});