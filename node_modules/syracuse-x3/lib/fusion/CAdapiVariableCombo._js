"use strict"; var helpers = require('syracuse-core/lib/helpers');

var CAdapiVariableCombo = helpers.defineClass(function() {}, CAdapiVariableLocalMenu, {

	private ArrayList<Integer> this.disableList = null;
	private boolean this.disableModif = false;

	protected CAdapiVariableCombo(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu) {
		TODO_SUPER(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu);
	}, clone: function() {
		var wVariable = new CAdapiVariableCombo(getSrcLine(), getEntityIndexBaseOne(), getName(), getId(), getDataType(), getFormat(), getState(), getLocalMenu());
		wVariable.setMustBeFormated(mustBeFormated());
		cloneValues(wVariable);
		return wVariable;
	}, hasDchModifications: function() {
		return  this.disableModif;
	}, hasGuiModModifications: function() {
		return TODO_SUPER.hasGuiModModifications() || this.disableModif;
	}, razModification: function() {
		TODO_SUPER.razModification();
		this.disableModif = false;
	}, setServerDisabledChoice: function(choice) {
		if (choice == 0) {
			if (this.disableList != null) {
				this.disableList.clear();
			}
			this.disableModif = true;
		} else {
			if (this.disableList == null) {
				this.disableList = new ArrayList<Integer>();
			}
			if (!this.disableList.contains(new Integer(choice))) {
				this.disableList.add(new Integer(choice));
				this.disableModif = true;
			}
		}
		if (this.disableModif && getSrcLine()!=null) {
			getSrcLine().comboDchModifSet();
		}
	}

	// arr != null pour les grilles
	, toDchJSON: function(arr){
		if (this.disableModif) {
			if (this.disableList == null || this.disableList.isEmpty()) {
				if (arr!=null){
					arr.put( JSONObject.NULL);
				}
				return JSONObject.NULL;
			} else {
				if (arr==null) {
					arr=new JSONArray();
				}
				for (item : this.disableList) {
					arr.put(item);
				}
				return arr;
			}
		}
		return null;
	}, toJson: function() {
		var object = (JSONObject) TODO_SUPER.toJson();
			Object dch=toDchJSON(null);
			if (dch!=null) {
				object.put(JSON_DCH, dch);
			}
		return object;
	}
}
