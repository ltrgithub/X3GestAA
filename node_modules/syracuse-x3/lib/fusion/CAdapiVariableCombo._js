"use strict";
var helpers = require('syracuse-core/lib/helpers');
var CAdapiVariableLocalMenu = function() {};

var CAdapiVariableCombo = helpers.defineClass(function(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu) {
	TODO_SUPER(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu);
	this.disableList = null;
	this.disableModif = false;
}, CAdapiVariableLocalMenu, {
	clone: function() {
		var wVariable = new CAdapiVariableCombo(this.srcLine, this.entityIndexBaseOne, this.name, this.id, this.dataType, this.format, this.state, this.localMenu);
		wVariable.setMustBeFormated(mustBeFormated());
		cloneValues(wVariable);
		return wVariable;
	},
	hasDchModifications: function() {
		return this.disableModif;
	},
	hasGuiModModifications: function() {
		return TODO_SUPER.hasGuiModModifications() || this.disableModif;
	},
	razModification: function() {
		TODO_SUPER.razModification();
		this.disableModif = false;
	},
	setServerDisabledChoice: function(choice) {
		if (choice == 0) {
			if (this.disableList != null) {
				this.disableList.clear();
			}
			this.disableModif = true;
		} else {
			if (this.disableList == null) {
				this.disableList = new ArrayList();
			}
			if (!this.disableList.contains(new Integer(choice))) {
				this.disableList.add(new Integer(choice));
				this.disableModif = true;
			}
		}
		if (this.disableModif && this.srcLine != null) {
			this.srcLine.comboDchModifSet();
		}
	}

	// arr != null pour les grilles
	,
	toDchJSON: function(arr) {
		if (this.disableModif) {
			if (this.disableList == null || this.disableList.isEmpty()) {
				if (arr != null) {
					arr.put(JSONObject.NULL);
				}
				return JSONObject.NULL;
			} else {
				if (arr == null) {
					arr = new JSONArray();
				}
				for (var item in this.disableList) {
					arr.put(item);
				}
				return arr;
			}
		}
		return null;
	},
	toJson: function() {
		var object = TODO_SUPER.toJson();
		var dch = toDchJSON(null);
		if (dch != null) {
			object.put('dch', dch);
		}
		return object;
	}
});