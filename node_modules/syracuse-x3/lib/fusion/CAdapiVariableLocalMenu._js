"use strict";
var helpers = require('syracuse-core/lib/helpers');
var CAdapiVariable = function() {};

var CAdapiVariableLocalMenu = helpers.defineClass(function(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState, aLocalMenu) {
	TODO_SUPER(srcLine, aEntityIndexBaseOne, aVarName, aID, aTdo, aFormat, aEntityState);
	this.localMenu = aLocalMenu;
}, CAdapiVariable, {
	// True si la valeur formatee a du sens - false pour tout ce qui herite de menu car format non applique
	acceptEditFormat: function() {
		return false;
	},

	//abstract clone: function();
	// Fusion - Pas de format
	formatEditToDisplay: function(aValue) {
		return aValue;
	},
	getDisplayValue: function() {
		var val = getServerValResu();
		try {
			if (val == null) {
				return EMPTY;
			}
			if (this.localMenu == null) {
				throw new Exception("no local menu available.");
			}
			if (val.isNum()) {
				if (val.getIntValue() > 0) {
					return this.localMenu.getLib(val.getIntValue());
				} else {
					return EMPTY;
				}
			} else {
				return val.getValue();
			}
		} catch (e) {
			return EMPTY;
		}
	},
	getLocalMenu: function() {
		return this.localMenu;
	},
	getValueForJson: function() {
		if (getServerValInt() == -999) {
			return getServerValStr();
		} else {
			return getServerValInt();
		}

	}
});