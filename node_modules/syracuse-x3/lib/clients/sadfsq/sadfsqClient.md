
# SadFsq Client  
SadFsq is provided by simple wrappers around standard POSIX functions.  
The module is using sadfsq protocol layer implemented in [SadFsqComm](./sadfsqComm.md).  
To use this module do require('syracuse-x3/lib/clients/sadfsq/sadfsqClient').SadFsqClient.  
All the methods are asynchronous.  
``` javascript
var SadFsqClient = require('syracuse-x3/lib/clients/sadfsq/sadfsqClient').SadFsqClient;
var sadfs = new SadFsqClient(_, endpoint);
 OR TO USE OLD SAFEV1 PROTOCOL WITHOUT USING CERTIFICATES :  
var sadfs = new SadFsqClient(_, context, "user", "password", secure);
```
* `context` is the endpoint instance to use for connection or an object with host and port properties.
* `user` is the system user to use for the connection.  
* `password` is the password corresponding to the user.  
* `secure` is boolean that define if the connection is secured by user/password.  


## General parameters  
In the following described functions, some general parameters would be necessary. This chapter describes these parameters.  

### File Options :  
Some following functions take in parameters `fileOptions`.  
This chapter describes how these options can be used.  
There are severals ways to create the `fileOptions` object :  

* Use an absolute path :  
``` javascript
var fileOptions = {
   path: "c:/temp/test.txt"
}
```

* Use a folder name, a relative path, a file name and an extension :  
``` javascript
var fileOptions = {
   folder: "DEMO",
   path: "tmp",
   name: "test",
   extension: "txt"
}
```

* Use a volume, a relative path, a file name and an extension :  
``` javascript
var fileOptions = {
   volume: "c:/",
   path: "tmp",
   name: "test",
   extension: "txt"
}
```

* Use directly a canonical path :  
``` javascript
var fileOptions = {
   canonical: "@SUPERV.tmp/test$txt"
}
```

* It's possible too to use a `server` property to access to a different server through the same adxadmin server :   
``` javascript
var fileOptions = {
   server: "server2_hostname",
   ...,
   ...
}
```

-------------
### Flags :  
Some following functions take in parameters `flags`.  
This chapter describes how these options can be used.  
The flags argument points to a string. If the string is one of the following, the file shall be opened in the indicated mode. Otherwise, the behavior is undefined.  
* `r` or `rb` : Open file for reading.  
* `w` or `wb` : Truncate to zero length or create file for writing.  
* `a` or `ab` : Append; open or create file for writing at end-of-file.  
* `r+` or `rb+` or `r+b` : Open file for update (reading and writing).  
* `w+` or `wb+` or `w+b` : Truncate to zero length or create file for update.  
* `a+` or `ab+` or `a+b` : Append; open or create file for update, writing at end-of-file.  


## Functions

-------------
### open :
``` javascript
var fd = sadfs.open(_, fileOptions, flags);  
```
Open a remote file corresponding to `fileOptions` and associates a stream with it.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `flags` : a string that represent the open mode for the remote file. See [Flags](./sadfsqClient.md#flags-).  

Opening a file with read mode (`r` as the first character in the mode argument) shall fail if the file does not exist or cannot be read.  

Opening a file with append mode (`a` as the first character in the mode argument) shall cause all subsequent writes to the file to be forced to the then current end-of-file, regardless of intervening calls to [seek()](./sadfsqClient.md#seek-) function.  

When a file is opened with update mode ('+' as the second or third character in the mode argument), both input and output may be performed on the associated stream. However, the application shall ensure that output is not directly followed by input without an intervening call to [flush()](./sadfsqClient.md#flush-) or to a file positioning function as [seek()](./sadfsqClient.md#seek-), and input is not directly followed by output without an intervening call to a file positioning function, unless the input operation encounters end-of-file.  

If flags is `w`, `wb`, `a`, `ab`, `w+`, `wb+`, `w+b`, `a+`, `ab+`, or `a+b`, and the file did not previously exist, upon successful completion, [open()](./sadfsqClient.md#open-) shall mark for update the last data access, last data modification, and last file status change timestamps of the file and the last file status change and last data modification timestamps of the parent directory.  

If flags is `w`, `wb`, `a`, `ab`, `w+`, `wb+`, `w+b`, `a+`, `ab+`, or `a+b`, and the file did not previously exist, [open()](./sadfsqClient.md#open-) shall create a file.  

If flags is `w`, `wb`, `w+`, `wb+`, or `w+b`, and the file did previously exist, upon successful completion, [open()](./sadfsqClient.md#open-) shall mark for update the last data modification and last file status change timestamps of the file.  

Upon successful completion, [open()](./sadfsqClient.md#open-) shall return a pointer (file descriptor) to the object controlling the stream. Otherwise, an error shall be thrown by adxadmin runtime.  


-------------
### close :
``` javascript
sadfs.close(_, fd);  
```
Close the remote file identified by `fd`.  

* `fd` is a file descriptor that identify the opened remote file.  


-------------
### stat :
``` javascript
var stats = sadfs.stat(_, fileOptions, [attributes]);  
```
Retrieve informations from remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `attributes` is an array of strings that contains the attributes name.  
   `attributes` can have the following values :  
   `mode`, `ino`, `dev`, `rdev`, `nlink`, `uid`, `gid`, `size`, `atime`, `mtime`, `ctime`.  
   If `attributes` is `null` all properties are returned.  
Returns a javascript object that contains attributes keys and values.  

``` javascript
   { 
      mode: 33188, // file mode  
      ino: 48064969, // inode number  
      dev: 0, // id of device containing a directory entry  
      rdev: 2114, // id of device if special char/block  
      nlink: 1, // number of links  
      uid: 85, // uid  
      gid: 100, // gid  
      size: 527, // file size in bytes  
      atime: Mon, 10 Oct 2011 23:24:11 GMT, // last time of access  
      mtime: Mon, 10 Oct 2011 23:24:11 GMT, // last time of modification  
      ctime: Mon, 10 Oct 2011 23:24:11 GMT // last time of file status change  
   }
``` 


-------------
### fstat :
``` javascript
var stats = sadfs.fstat(_, fd, [attributes]);  
```
This function is the same that [stat()](./sadfsqClient.md#stat-) but take a file descriptor as first parameter.  

* `fd` is a file descriptor that identify the opened remote file.  


-------------
### path :
``` javascript
var path = sadfs.path(_, fileOptions);  
```
Retrieve the full path of the remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

Returns the the full path.  

-------------
### feof :
``` javascript
sadfs.feof(_, fd);  
```
Test end-of-file indicator on a stream.  

* `fd` is a file descriptor that identify the opened remote file.  

Shall returns true if and only if the end-of-file indicator is set for stream.


-------------
### truncate :
``` javascript
sadfs.truncate(_, fileOptions, len);  
```
Truncate the remote file specified by `fileOptions`.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `len` is the number of bytes to truncate.  


-------------
### ftruncate :
``` javascript
sadfs.ftruncate(_, fd, len);  
```
Truncate the remote file specified by `fileOptions`.  

* `fd` is a file descriptor that identify the opened remote file.  
* `len` is the number of bytes to truncate.  


-------------
### rename :
``` javascript
sadfs.rename(_, oldFileOptions, newFileOptions);  
```
Rename the remote file specified by `oldFileOptions` with the `newFileOptions`.  

* `oldFileOptions` is the object that represent the old sadFsq File options to rename. See [File Options](./sadfsqClient.md#file-options-).  
* `newFileOptions` is the object that represent the new sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  


-------------
### getPosition :  
``` javascript  
var position = sadfs.getPosition(_, fd);  
```
Get the cursor position in the file specified by `fd`. 

-------------
### seek :  
``` javascript  
sadfs.seek(_, fd, cursor, offset, [strict]);  
```
Change the cursor position in the in the stream associated to the file specified by `fd`. 

* `cursor` is the base of the move. (0: BOF, 1: Current position, 2: EOF)  
* `offset` is a number of bytes to ignore until the new position.  
* `strict` define if the position is allowed to be out of bounds. `true` by default.  

-------------
### readFile :  
``` javascript  
var buf = sadfs.readFile(_, fileOptions, [options]);  
```
Reads the entire contents of a file.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `options` is the object that represent encoding and flag.  
    * encoding : `String | null` default = `null`.  
    * flag : `String`default = `r`. See [Flags](./sadfsqClient.md#flags-).  
      The rules described in [open()](./sadfsqClient.md#open-) function are also applied here.  

``` javascript
   var options = {  
        encoding:"utf-8",
        flag : "r"
   };  
```

If no encoding is specified, then the raw buffer is returned.  


-------------
### read :  
``` javascript  
var buf = sadfs.read(_, fd, buffer, offset, length, [position]);  
```
Read data from the file specified by `fd`. 
* `buffer` is the buffer that the data will be written to.  
* `offset` is the offset in the buffer to start writing at.  
* `length` is an integer specifying the number of bytes to read.  
* `position` is an integer specifying where to begin reading from in the file. If position is null, data will be read from the current file position.  

Returns the size of read bytes.  

-------------
### writeFile :  
``` javascript  
sadfs.writeFile(_, fileOptions, data, [options]);  
```
Writes data to the remote file, replacing the file if it already exists.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `data` is a `String | Buffer`.  
* `options` is an `object` that could contains :  
    * encoding : `String | null` default = `utf-8`.  
    * flag : `String`default = `w`. See [Flags](./sadfsqClient.md#flags-).  
      The rules described in [open()](./sadfsqClient.md#open-) function are also applied here.  

``` javascript
   var options = {  
        encoding:"utf-8",
        flag : "w"
   };  
```

The `encoding` option is ignored if `data` is a buffer. It defaults to 'utf8'.  


-------------
### write :  
``` javascript  
sadfs.write(_, fd, buffer, offset, length, [position], [lock]);  
```
Write buffer to the remote file specified by `fd`.  

* `offset` and `length` determine the part of the buffer to be written.  
* `position` refers to the offset from the beginning of the file where this data should be written. If `position` is `null`, the data will be written at the current position.  
* `lock` is boolean parameter that determines if the write operation use lock. if it's not define, `null` or `false` , the lock and lock test is not applied .  

On Linux, positional writes don't work when the file is opened in append mode. The kernel ignores the position argument and always appends the data to the end of the file. See [open()](./sadfsqClient.md#open-) rules.      


-------------
### appendFile :  
``` javascript  
sadfs.appendFile(_, fileOptions, data, [options]);  
```
Append data to athe remote file, creating the file if it not yet exists.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  
* `data` is a `String | Buffer`.  
* `options` is an `object` that could contains :  
    * encoding : `String | null` default = `utf-8`.  
    * flag : `String`default = `a`. See [Flags](./sadfsqClient.md#flags-).  
      The rules described in [open()](./sadfsqClient.md#open-) function are also applied here.  

``` javascript
   var options = {  
        encoding:"utf-8",
        flag : "a"
   };  
```

The `encoding` option is ignored if `data` is a buffer. It defaults to 'utf8'.  


-------------
### unlink :  
``` javascript  
sadfs.unlink(_, fileOptions);  
```
Delete the remote file specified by `fileOptions`.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

-------------
### flush :  
``` javascript  
sadfs.flush(_, fd);  
```
Force the buffers to be flushed into the file specified by `fd` without waiting for close.  

-------------
### exists :  
``` javascript  
sadfs.exists(_, fileOptions);  
```
Test whether or not the given remote file specified by `fileOptions` exists by checking with the file system.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

Returns true if the file exists.  

-------------
### lock :  
``` javascript  
sadfs.lock(_, fd, type, len, pos);  
```
Allows sections of the file specified by fd to be locked.  

* `fd` argument is an open file descriptor. The file descriptor must have Write permission in order to establish locks with this function call.  
* `type` argument is a control value that specifies the action to be taken. The permissible values for function are :  
   * 0: unlock previously locked section.  
   * 1: lock section for exclusive use.  
   * 2: test & lock section for exclusive use.  
   * 3: test section for other locks.  
* `len` argument is the number of contiguous bytes to be locked or unlocked.  
* `pos` define where the lock will start. Not including current byte.  

Force the buffers to be flushed into the file specified by fd without waiting for close.  


-------------
### mkdir :  
``` javascript  
sadfs.mkdir(_, fileOptions);  
```
Create a remote directory   

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

Returns the output generated by the command `ae_mkdir`.  


-------------
### rmdir :  
``` javascript  
sadfs.rmdir(_, fileOptions);  
```
Remove a remote directory   

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

Returns the output generated by the command `ae_rmdir`.  

-------------
### rmdir :
``` javascript
sadfs.rmdir(_, fileOptions);
```
Remove a remote directory
* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).
Returns the output generated by the command `ae_rmdir`.

-------------
### readdir :  
``` javascript  
var array = sadfs.readdir(_, fileOptions);  
```
List the content of a remote directory   

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#file-options-).  

Returns an array that represents the content of the remote directory.  


-------------
### exec :  
``` javascript  
var output = sadfs.exec(_, cmd);  
```
Execute a remote process.  

* `cmd` is the command to launch on the adxadmin server.  

Returns the output generated by the command `cmd`.  


-------------
### kill :  
``` javascript  
var output = sadfs.kill(_, pid, signal);  
```
Kill a remote process.  

* `pid` is the remote process identifier.  
* `signal` is the signal to send to this process. 1 to 9.  

