"use strict";
var helpers = require('syracuse-core/lib/helpers');
var CvgVariableBlob = require('syracuse-x3/lib/convergence/model/CvgVariableBlob').CvgVariableBlob;
var CvgDiagnose = require('syracuse-x3/lib/convergence/model/CvgDiagnose').CvgDiagnose;

var _checkCtx = ["x3User", "x3Host", "x3Port", "x3Lang", "x3HttpPub", "x3Solution", "x3Folder", "SDate", "IDate", "SThousand", "SDecimal"];
var _PE_AVAILABLE = "PEAvailable";
var _DEV_RPT_MODE = "DevRptMode";
var _APP_HOSTNAME = "AppHostName";
var _CNX_HOSTNAME = "CnxHostName";

var CvgClientConfig = exports.CvgClientConfig = helpers.defineClass(function(client, params) {
	this.client = client;
	this._initParams(params);
	this.modePLAY = "PLAY" == this._params.recmode;
	this.datePivot = 1957;
}, null, {
	getParam: function(key) {
		return this._params[key];
	},
	isSameContext: function(context, tracerSession) { // check context for reuse session
		tracerSession.info() && tracerSession.info("CvgClientConfig.isSameContext\n\t" + JSON.stringify(context));
		var i, x;
		for (i in _checkCtx) {
			x = _checkCtx[i];
			if (!context[x] || context[x] !== this._params[x]) {
				tracerSession.info() && tracerSession.info("\tContext do not match - param[" + x + "] - contextValue[" + context[x] + "] - configValue[" + this._params[x] + "]");
				return false;
			}
		}
		tracerSession.info() && tracerSession.info("\tTrue");
		return true;
	},
	_initParams: function(params) {
		this._params = params || {};
		this._params[_DEV_RPT_MODE] = this._params[_DEV_RPT_MODE] || "OFF";
		this._params[_PE_AVAILABLE] = this._params[_PE_AVAILABLE] || "0";
		this._params[_CNX_HOSTNAME] = this._params[_CNX_HOSTNAME] || this._params.x3Host;
		this._params[_APP_HOSTNAME] = this._params[_APP_HOSTNAME] || this._params.appHost || this._params[_CNX_HOSTNAME];
	},
	setDatePivot: function(v) {
		v = parseInt(v, 10);
		if (!isNaN(v)) {
			this.datePivot = v;
		}
	},
	// Add settings for client
	addUiCliSettings: function(settings) {
		if (!settings) {
			return;
		}
		// datePivot
		settings.datePivot = this.datePivot;
		// dateOrder
		var x = parseInt(this._params.IDate, 10);
		if (isNaN(x)) {
			x = 0;
		}
		settings.dateOrder = x;
		// dateSep
		x = this._params.SDate;
		settings.dateSep = x && x.length == 1 ? x : '/';
		// thousandSep
		x = this._params.SThousand;
		settings.thousandSep = x && x.length == 1 ? x : ',';
		// decimalSep
		x = this._params.SDecimal;
		settings.decimalSep = x && x.length == 1 ? x : '.';
		// timeSep
		x = this._params.STime;
		settings.timeSep = x && x.length == 1 ? x : ':';
	},
	toString: function() {
		return "";
	}
});