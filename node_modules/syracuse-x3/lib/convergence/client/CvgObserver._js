"use strict";
var helpers = require('syracuse-core/lib/helpers');

//

exports.CvgObserver = helpers.defineClass(function() {
	this._trackLists = this.newTrackLists();
}, null, {
	newTrackLists: function() {
		return {
			SESSION: [],
			SESSIONOPEN: [],
			ACT: [],
			TARGETACT: [],
			SESSIONMNU: [],
			TARGET: [],
			MISC: [],
			ENTITY: [],
			FUNCO: [],
			FUNCC: [],
			RPC: [],
			WINDOW: [],
			DIAGNOSE: [],
			GLDIAGNOSE: [],
			REPORT: []
		};
	},
	track: function(obj) {
		// add if not exists the current obj
		var list = this._trackLists[obj.jsonType];
		// Allow observable to not send adat - see CvgDiagnose
		/*if (obj.sendToClient && !obj.sendToClient(list)) {
         return;
         }*/
		if (obj.getObservableId) {
			// we can add keys directly to the array, they will be ignored by JSON.stringify
			var key = '#' + obj.getObservableId();

			var old = list[key];
			if (old != null) {
				list[old] = undefined;
			}
			list[key] = list.length;
		}
		list.push(obj);
	}
});