"use strict";
var locale = require('syracuse-core/lib/locale');
var module = QUnit.module;
var PrintClient = require('syracuse-x3/lib/print/client/PrintClient').PrintClient;
var done;
module("X3 - Print Client Tests", {
	setup: function() {},
	teardown: function() {
		if (done) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 500)
		}
	}
});

asyncTest("Connection", 5, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1890);
	strictEqual(cli.pid != null && cli.pid >= 0 , true, "pid: "+cli.pid);
	var comm = cli.communicator;
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.UIAction, "SetTechnoVers", "UIAction: "+comm.srvTechnoVers.UIAction);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Id, "3", "Id: "+comm.srvTechnoVers.Id);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Version, "15i.012", "Version: "+comm.srvTechnoVers.Version);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Protocol, "15000B", "Protocol: "+comm.srvTechnoVers.Protocol);
	cli._disconnect(_);
	start();
});

asyncTest("GetState on unknow Job", 2, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1890);
	var result = cli.communicator.send_ND_GETSTATEREPORT(_, "UnknowJob");
	strictEqual(result && result.state, 99, "State: "+result.state);
	strictEqual(result && result.message, "", "Message: "+result.message);
	cli._disconnect(_);
	start();
});

asyncTest("kill", 0, function(_) {
	done = true;
	start();
});