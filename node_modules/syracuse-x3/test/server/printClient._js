"use strict";
var locale = require('syracuse-core/lib/locale');
var module = QUnit.module;
var PrintClient = require('syracuse-x3/lib/print/client/PrintClient').PrintClient;
var done;
module("X3 - Print Client Tests", {
	setup: function() {},
	teardown: function() {
		if (done) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 500)
		}
	}
});

asyncTest("Connection", 5, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1889);
	strictEqual(cli.pid != null && cli.pid >= 0 , true, "pid: "+cli.pid);
	var comm = cli.communicator;
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.UIAction, "SetTechnoVers", "UIAction: "+comm.srvTechnoVers.UIAction);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Id, "3", "Id: "+comm.srvTechnoVers.Id);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Version, "15i.012", "Version: "+comm.srvTechnoVers.Version);
	strictEqual(comm.srvTechnoVers && comm.srvTechnoVers.Protocol, "15000B", "Protocol: "+comm.srvTechnoVers.Protocol);
	cli._disconnect(_);
	start();
});

asyncTest("AllPrinter", 7, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1889);
	strictEqual(cli.pid != null && cli.pid >= 0 , true, "pid: "+cli.pid);
	var comm = cli.communicator;
	var result = comm.send_ND_ALL_PRINTER(_);
	strictEqual(result.printName.length>0,true,"print name "+result.printName);
	strictEqual(result.portName.length >0,true,"print port "+result.portName);
	strictEqual(result.driverName.length>0,true,"driver "+result.driverName);
	strictEqual(result.comment,"","comment "+result.comment);
	strictEqual(result.location,"","location "+result.location);
	strictEqual(result.devmod.length>0,true,"devmod "+result.devmod);

	cli._disconnect(_);
	start();
});

asyncTest("MorePrinter", 5, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1889);
	strictEqual(cli.pid != null && cli.pid >= 0 , true, "pid: "+cli.pid);
	var comm = cli.communicator;
	console.log("send more");
	comm.send_ND_MORE_PRINTER(_,"\\\\172.28.8.4\\HP3390-grenoble","172.28.8.151","HP Universal Printing PCL 5");
	console.log("disconnect");
	cli._disconnect(_);
	start();
});

/*asyncTest("GetState on unknow Job", 2, function(_) {
	var cli = new PrintClient(_, "ecchambard-001", 1889);
	var result = cli.communicator.send_ND_GETSTATEREPORT(_, "UnknowJob");
	strictEqual(result && result.state, 99, "State: "+result.state);
	strictEqual(result && result.message, "", "Message: "+result.message);
	cli._disconnect(_);
	start();
});*/

asyncTest("kill", 0, function(_) {
	done = true;
	start();
});
