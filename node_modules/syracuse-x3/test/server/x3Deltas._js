// JavaScript Document
"use strict";
var module 	  	= QUnit.module;
var assert 	  	= require("assert" );
var dataModel 	= require("syracuse-orm/lib/dataModel");
var x3Helper   	= require("syracuse-x3/test/fixtures/x3Helper");
var helpers     = require("syracuse-core/lib/helpers");

var tracer = console.log;
var doStop = false;

module("x3DeltasTest", {
	setup: function() {},
	teardown: function() {
		if (doStop) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 100)
		}
	}
});


asyncTest("start", function(_) {
	ok(x3Helper.initDatabase(_),"syracuse mongodb database initialized");

	x3Helper.initialize(_,function(_) {
		ok(x3Helper.createObjects(_),"createObjects");
		start();
	});
});

var cookie=null;
function _getCookie(_) {
  cookie = cookie || x3Helper.getCookie(_);
  return cookie;
}
//******************************************************************************
asyncTest("ZQAB", function(_) {
  var uuid = helpers.uuid.generate();
  var url  = x3Helper.x3Url("ZQAB(%27AAA~%27)/$workingCopies?representation=ZQAB.$edit&trackingId="+uuid);
  console.log("*** url=",url);
	var data = x3Helper.post(_, _getCookie(_),url,{},200);
  console.log("*** data=",data);

  start(); 
});

//******************************************************************************

asyncTest("stop server", 0, function(_) {
	x3Helper.stopServer();
	start();
});
asyncTest("stop  tests", 0, function(_) {
	doStop = true;
	start();
});
// JavaScript Document
