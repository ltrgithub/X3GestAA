// JavaScript Document
"use strict";
var module 	  	= QUnit.module;
var assert 	  	= require("assert" );
var dataModel 	= require("syracuse-orm/lib/dataModel");
var x3Helper   	= require("syracuse-x3/test/fixtures/x3Helper");

var tracer = console.log;
var doStop = false;

module("x3PrototypesTest", {
	setup: function() {},
	teardown: function() {
		if (doStop) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 100)
		}
	}
});


asyncTest("start", function(_) {
	ok(x3Helper.initDatabase(_),"syracuse mongodb database initialized");

	x3Helper.initialize(_,function(_) {
		ok(x3Helper.createObjects(_),"createObjects");
		start();
	});
});


//******************************************************************************
function checkJSON(_,_representation){
  var cookie = x3Helper.getCookie(_, "admin", "admin");
  var name = _representation + ".$bulk";
  try {
  	var prototype = x3Helper.get(_, cookie, x3Helper.x3Url(_representation+"?representation=" + _representation+ ".$bulk"), 200);
    console.log("prototype=",prototype);
    strictEqual(true,true,"The JSON of "+ _representation + ".$bulk is well formed");
   } catch (e) {
    strictEqual(true,false,"The JSON of "+ _representation + ".$bulk isn't well formed");
  }   
}

asyncTest("AUTILIS    JSON",3, function(_) {checkJSON(_,"AUTILIS") ;  start(); });
//******************************************************************************

asyncTest("stop server", 0, function(_) {
	x3Helper.stopServer();
	start();
});
asyncTest("stop  tests", 0, function(_) {
	doStop = true;
	start();
});