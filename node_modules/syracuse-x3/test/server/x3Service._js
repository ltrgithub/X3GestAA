"use strict";
var module = QUnit.module;
var assert = require("assert");
var config = require('config'); // must be first syracuse require
var dataModel = require("syracuse-orm/lib/dataModel");
var x3Helper = require("syracuse-x3/test/fixtures/x3Helper");
var helpers = require('syracuse-core').helpers;

var tracer; // = console.log;
var doStop = false;

module(config.unit_test.QLF.folder + ".x3Service", {
	setup: function() {}
});


if ((config.unit_test || {}).x3endpoint) {
	(function test(_) {
		asyncTest("start", 18, function(_) {
			ok(x3Helper.initDatabase(_), "syracuse mongodb database initialized");
			x3Helper.initialize(_);
			ok(x3Helper.createObjects(_), "createObjects");
			start();
		});

		var cookie = null;

		function _getCookie(_) {
			cookie = cookie || x3Helper.getCookie(_);
			//!ok("cookie"   ,"cookie"   +JSON.stringify(cookie));
			return cookie;
		}

		asyncTest("About", 6, function(_) {
			var about = x3Helper.get(_, _getCookie(_), x3Helper.x3Url("$service/ABOUT"), 200);
			ok(true, JSON.stringify(about));
			strictEqual(about.folder, config.unit_test.QLF.folder, "folder:" + about.folder);
			strictEqual(about.applicationServer.substring(0, config.unit_test.QLF.serverHost.length), config.unit_test.QLF.serverHost, "serverHost:" + about.folder);
			strictEqual(parseInt(about.port), config.unit_test.QLF.serverPort, "serverPort:" + about.port);

			start();
		});

		//******************************************************************************

		asyncTest("stop server", 0, function(_) {
			x3Helper.stopServer();
			start();
		});
	})(_);
}

asyncTest("stop  tests", 0, function(_) {
	doStop = true;
	start();
});
// JavaScript Document