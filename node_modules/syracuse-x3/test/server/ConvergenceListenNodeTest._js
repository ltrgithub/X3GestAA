"use strict";

var locale = require('syracuse-core/lib/locale');
var CvgClient = require('syracuse-x3/lib/convergence/client/CvgClient').CvgClient;
var CvgSession = require('syracuse-x3/lib/cvgSession');
var CvgIst = require('syracuse-x3/lib/convergence/types/CvgIst').CvgIst;
var CvgResu = require('syracuse-x3/lib/convergence/types/CvgResu').CvgResu;
var CvgResuTag = require('syracuse-x3/lib/convergence/types/CvgResu').TAG;
var CvgResuTdo = require('syracuse-x3/lib/convergence/types/CvgResu').TDO;


var done;
QUnit.module(module.id, {
	setup: function() {},
	teardown: function() {
		if (done) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 500);
		}
	}
});
var context = {
	request: {
		session: {
			id: ""
		}
	},
	endpoint: {
		x3server: function(_) {
			return {
				serverHost: function(_) {
					return 'test';
				},
				serverPort: function(_) {
					return 'test';
				},
				serverName: function(_) {
					return 'test';
				},
			};
		}
	},
	httpSession: {
		getUserProfile: function(_) {
			return null;
		}
	}
};
var streamTest = {
	read: function(_, size) {

	},
	write: function(_, buf) {

	},
	end: function() {}
};

asyncTest("listenNode -  open close / purge reply", function(_) {
	var session = CvgSession.newSession(_, "test1");

	var cvgClient = new CvgClient(_, session, streamTest, {}, null, context);
	cvgClient.cdlang = "FRA";

	ok(true, "new CvgClient ");

	cvgClient.cvgWinStubPath = "/../../../test/server/data/cvgWin/";
	// window contain an 4 array AA, AB and BA and CA
	// call listen NDOWIN to create a structure of entity
	cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "TESTWIN", "TESTFUNC", "20140505", "");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDOWIN TESTWIN ok");

	cvgClient.razModification();
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "After raz ok");


	start();
});


asyncTest("listenNode -  array", function(_) {

	var session = CvgSession.newSession(_, "test1");

	var cvgClient = new CvgClient(_, session, streamTest, {}, null, context);
	cvgClient.cdlang = "FRA";

	ok(true, "new CvgClient ");

	cvgClient.cvgWinStubPath = "/../../../test/server/data/cvgWin/";
	// window contain an 4 array AA, AB and BA and CA
	// call listen NDOWIN to create a structure of entity
	cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "TESTWIN", "TESTFUNC", "20140505", "");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDOWIN TESTWIN ok");

	// get non exits windows
	try {
		cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "UNKNOWN", "TESTFUNC", "20140505", "");
		ok(false, "NDOWIN load not exists window");
	} catch (e) {
		ok(true, "NDOWIN load not exists window");
	}
	// add 10 line to BA dataSrc from 0
	cvgClient.activeRequest.listenNodeNDINSLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDINSLI 100 line from 0 on BA dataSrc ok");

	// NDCHVL on first column / first line -> new string
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A2,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 1");


	// delete 10 line to BA dataSrc from 0 -> normally do nothin
	cvgClient.activeRequest.listenNodeNDSUPLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);

	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "SUPLI from index 0 of 10 lines");

	cvgClient.activeRequest.listenNodeNDSUPLI(_, {}, {}, new CvgIst("B,B,A"), 1, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1],[1,1,10],[0,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "SUPLI from index 1 of 10 lines");

	cvgClient.razModification();

	cvgClient.activeRequest.listenNodeNDINSLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDINSLI 100 line from 0 on BA dataSrc ok");

	//test again ndchvl
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A4,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 3");

	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A2,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 1");

	// try a date this time

	// I actually would have expected one of these next three to do something different as the date
	// format is wrong on at least two of them.
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A3,1"), new CvgResu(CvgResuTag.DATE, "23/02/2014"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"23/02/2014","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a date column 2");

	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A3,1"), new CvgResu(CvgResuTag.DATE, "02/23/2014"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/23/2014","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a date column 2");

	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A3,1"), new CvgResu(CvgResuTag.DATE, "32/13/2014"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"32/13/2014","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a date column 2");

	// This one has a date that can't be expressed incorrectly
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A3,1"), new CvgResu(CvgResuTag.DATE, "02/02/2014"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a date column 2");

	// And finally a decimal??
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A5,1"), new CvgResu(CvgResuTag.DCB, "1234"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a decimal column 4");

	// format test on a cell
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,1"), "KX20");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"fmt":[["BA2",1,"KX20"],["BA2",0,"KX20"]],"stt":[["BA2",0,262148,"V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT KX20 column 1 line 1 : on a cell");

	// format on a column
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,0"), "KX22");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"fmt":[["BA2",1,"KX20"],["BA2",0,"KX22"]],"stt":[["BA2",0,262148,"V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT KX22 on column A2");

	// invisible format
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,1"), "-KX20");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"stt":[["BA2",0,262144,"!V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT -KX20 column 1 line 1 : on a cell - set invisible ");

	cvgClient.razModification();

	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A4,1"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA4",1,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 4 in line 1 - on a cell");

	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A2,0"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA4",1,{"type":122,"value":"style1"}],["BA2",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 2 - A2");

	// override style on column 4
	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A4,0"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 4 - A4");

	//listenNodeNDGIST
	cvgClient.activeRequest.listenNodeNDGIST(_, {}, {}, new CvgIst("B,B,A4,0"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"target":{"type":"ist","ist":{"xid":"BA4","nl":null,"win":"B","edit":true,"ctrlFailed":false}},"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDGIST on target BBA4,0");

	//listenNodeNDCHGR
	// GRIZO
	cvgClient.activeRequest.listenNodeNDCHGR(_, {}, {}, new CvgIst("B,B,A2,1"), 0);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"target":{"type":"ist","ist":{"xid":"BA4","nl":null,"win":"B","edit":true,"ctrlFailed":false}},"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]],"stt":[["BA2",1,65536,"!E"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHGR GRIZO column 1 line 1 : on a cell");
	// ACTZO
	cvgClient.activeRequest.listenNodeNDCHGR(_, {}, {}, new CvgIst("B,B,A2,1"), 1);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"target":{"type":"ist","ist":{"xid":"BA4","nl":null,"win":"B","edit":true,"ctrlFailed":false}},"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]],"stt":[["BA2",1,196609,"E!R"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHGR ACTZO column 1 line 1 : on a cell");
	// DISZO
	cvgClient.activeRequest.listenNodeNDCHGR(_, {}, {}, new CvgIst("B,B,A2,1"), 2);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"target":{"type":"ist","ist":{"xid":"BA4","nl":null,"win":"B","edit":true,"ctrlFailed":false}},"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]],"stt":[["BA2",1,196611,"ER"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHGR DISZO column 1 line 1 : on a cell");

	//console.log(JSON.stringify(cvgClient.response));
	//listenNodeNDCHVB

	//listenNodeND_ASKUI

	//listenNodeND_CLF

	//listenNodeND_NAP

	//listenNodeND_REB


	start();
});


asyncTest("listenSendingArgs ", function(_) {
	var session = CvgSession.newSession(_, "test1");

	var cvgClient = new CvgClient(_, session, streamTest, {}, null, context);
	cvgClient.cdlang = "FRA";

	ok(true, "new CvgClient ");

	cvgClient.cvgWinStubPath = "/../../../test/server/data/cvgWin/";
	// window contain an 4 array AA, AB and BA and CA
	// call listen NDOWIN to create a structure of entity
	cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "TEST_LEFTLIST", "TESTFUNC", "20140505", "");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TEST_LEFTLIST","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"appendModel":{"bB":{"$type":"application/x-array","$item":{"$properties":{"bB0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bB0","$parent":"bB1","$description":"bB2","$open":"bB3"}}},"bF":{"$type":"application/x-array","$item":{"$properties":{"bF0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bF0","$parent":"bF1","$description":"bF2","$open":"bF3"}}}},"mnu":[]}}},"wins":{"B":{"entities":{"AA1":{"v":""},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"bA":{"$mvt":[]},"bB":{"$mvt":[]},"bC":{"$mvt":[]},"bD":{"$mvt":[]},"bE":{"$mvt":[]},"bF":{"$mvt":[]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "open window that contains several left list ");

	// create element in left list
	var listResuVal = [new CvgResu(CvgResuTdo.STRU, "test1"), new CvgResu(CvgResuTdo.STRU, "test2"), new CvgResu(CvgResuTdo.STRU, "test3"), new CvgResu(CvgResuTdo.STRU, "test4")];
	cvgClient.activeRequest.listenNodeNDOLAR(_, {}, {}, new CvgIst("B,b,A"), -1, {}, "test", listResuVal, listResuVal, []);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TEST_LEFTLIST","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"appendModel":{"bB":{"$type":"application/x-array","$item":{"$properties":{"bB0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bB0","$parent":"bB1","$description":"bB2","$open":"bB3"}}},"bF":{"$type":"application/x-array","$item":{"$properties":{"bF0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bF0","$parent":"bF1","$description":"bF2","$open":"bF3"}}}},"mnu":[]}}},"wins":{"B":{"entities":{"AA1":{"v":""},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"bA":{"$rcd":[{"$uuid":0,"$key":"7~test1^7~test2^7~test3^7~test4","bA1":"test1","bA2":"test2","bA3":"test3","bA4":"test4"}],"$mvt":[[1,1,1]]},"bB":{"$mvt":[]},"bC":{"$mvt":[]},"bD":{"$mvt":[]},"bE":{"$mvt":[]},"bF":{"$mvt":[]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', " add element in first left list ");

	var listResuVal = [new CvgResu(CvgResuTdo.STRU, "test1-"), new CvgResu(CvgResuTdo.STRU, "test2-"), new CvgResu(CvgResuTdo.STRU, "test3-"), new CvgResu(CvgResuTdo.STRU, "test4-")];
	cvgClient.activeRequest.listenNodeNDOLAR(_, {}, {}, new CvgIst("B,b,A"), -1, {}, "test", listResuVal, listResuVal, []);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{"statusCode":200},"body":{"sap":{"func":{"open":{"B":{"name":"TEST_LEFTLIST","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"appendModel":{"bB":{"$type":"application/x-array","$item":{"$properties":{"bB0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bB3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bB0","$parent":"bB1","$description":"bB2","$open":"bB3"}}},"bF":{"$type":"application/x-array","$item":{"$properties":{"bF0":{"$title":"Key","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF1":{"$title":"Parent","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF2":{"$title":"Title","$type":"application/x-string","$capabilities":"","$maxLength":10},"bF3":{"$title":"Open","$type":"application/x-boolean","$capabilities":"","$maxLength":10}}},"$treeview":{"$mode":"parentKey","$bindings":{"$clientId":"bF0","$parent":"bF1","$description":"bF2","$open":"bF3"}}}},"mnu":[]}}},"wins":{"B":{"entities":{"AA1":{"v":""},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","$uuid":0}],"$mvt":[[1,1,1]]},"bA":{"$rcd":[{"$uuid":0,"$key":"7~test1^7~test2^7~test3^7~test4","bA1":"test1","bA2":"test2","bA3":"test3","bA4":"test4"},{"$uuid":1,"$key":"7~test1-^7~test2-^7~test3-^7~test4-","bA1":"test1-","bA2":"test2-","bA3":"test3-","bA4":"test4-"}],"$mvt":[[1,1,2]]},"bB":{"$mvt":[]},"bC":{"$mvt":[]},"bD":{"$mvt":[]},"bE":{"$mvt":[]},"bF":{"$mvt":[]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', " add element in first left list ");

	var param = ["1077", "BbA", "7~test1^7~test2^7~test3^7~test4"];
	cvgClient.activeRequest.listenActionArgsDOLEFTLISTLINE(cvgClient, param);
	strictEqual(JSON.stringify(param), '["1077","B,@,@",[{"type":7,"value":"test1"},{"type":7,"value":"test2"},{"type":7,"value":"test3"},{"type":7,"value":"test4"}]]', " select first element of left list");


	var param = ["1077", "BbA", "7~test1~est38~~bc^7~test2^7~test3^7~test4"];
	cvgClient.activeRequest.listenActionArgsDOLEFTLISTLINE(cvgClient, param);
	strictEqual(JSON.stringify(param), '["1077","B,@,@",[{"type":7,"value":"test1~est38~~bc"},{"type":7,"value":"test2"},{"type":7,"value":"test3"},{"type":7,"value":"test4"}]]', " select element where key contains '~' character");


	start();
});


test("kill", function() {
	done = true;
	start();
});