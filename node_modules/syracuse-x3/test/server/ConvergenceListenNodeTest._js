"use strict";

var locale = require('syracuse-core/lib/locale');
var CvgClient = require('syracuse-x3/lib/convergence/client/CvgClient').CvgClient;
var CvgSession = require('syracuse-x3/lib/cvgSession');
var CvgIst = require('syracuse-x3/lib/convergence/types/CvgIst').CvgIst;
var CvgResu = require('syracuse-x3/lib/convergence/types/CvgResu').CvgResu;
var CvgResuTag = require('syracuse-x3/lib/convergence/types/CvgResu').TAG;


var done;
QUnit.module(module.id, {
	setup: function() {},
	teardown: function() {
		if (done) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 500);
		}
	}
});
var context = {
	request: {
		session: {
			id: ""
		}
	},
	endpoint: {
		x3server: function(_) {
			return {
				serverHost: function(_) {
					return 'test';
				},
				serverPort: function(_) {
					return 'test';
				},
				serverName: function(_) {
					return 'test';
				},
			};
		}
	},
	httpSession: {
		getUserProfile: function(_) {
			return null;
		}
	}
};
var streamTest = {
	read: function(_, size) {

	},
	write: function(_, buf) {

	},
	end: function() {}
};

asyncTest("listenNode -  open close / purge reply", function(_) {
	var session = CvgSession.newSession(_, "test1");

	var cvgClient = new CvgClient(_, session, streamTest, {}, null, context);
	cvgClient.cdlang = "FRA";

	ok(true, "new CvgClient ");

	cvgClient.cvgWinStubPath = "/../../../test/server/data/cvgWin/";
	// window contain an 4 array AA, AB and BA and CA
	// call listen NDOWIN to create a structure of entity
	cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "TESTWIN", "TESTFUNC", "20140505", "");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDOWIN TESTWIN ok");

	cvgClient.razModification();
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "After raz ok");


	start();
});


asyncTest("listenNode -  array", function(_) {

	var session = CvgSession.newSession(_, "test1");

	var cvgClient = new CvgClient(_, session, streamTest, {}, null, context);
	cvgClient.cdlang = "FRA";

	ok(true, "new CvgClient ");

	cvgClient.cvgWinStubPath = "/../../../test/server/data/cvgWin/";
	// window contain an 4 array AA, AB and BA and CA
	// call listen NDOWIN to create a structure of entity
	cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "TESTWIN", "TESTFUNC", "20140505", "");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDOWIN TESTWIN ok");

	// get non exits windows
	try {
		cvgClient.activeRequest.listenNodeNDOWIN(_, {}, {}, new CvgIst("B"), "UNKNOWN", "TESTFUNC", "20140505", "");
		ok(false, "NDOWIN load not exists window");
	} catch (e) {
		ok(true, "NDOWIN load not exists window");
	}
	// add 10 line to BA dataSrc from 0
	cvgClient.activeRequest.listenNodeNDINSLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDINSLI 100 line from 0 on BA dataSrc ok");

	// NDCHVL on first column / first line -> new string
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A2,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 1");


	// delete 10 line to BA dataSrc from 0 -> normally do nothin
	cvgClient.activeRequest.listenNodeNDSUPLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);

	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":10}],"$mvt":[[1,1,1],[1,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "SUPLI from index 0 of 10 lines");

	cvgClient.activeRequest.listenNodeNDSUPLI(_, {}, {}, new CvgIst("B,B,A"), 1, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"func":{"open":{"B":{"name":"TESTWIN","scrnNum":1,"stamp":"20140505","extend":"","func":"TESTFUNC","type":1,"mnu":[]}}},"wins":{"B":{"entities":{"AA":{"$rcd":[{"AA2":-1,"AA3":"","$uuid":0}],"$mvt":[[1,1,1]]},"AB":{"$rcd":[{"AB2":-1,"AB3":"","AB4":"","AB5":"","AB6":"","AB7":"","AB8":"","$uuid":0}],"$mvt":[[1,1,1]]},"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0}],"$mvt":[[1,1,1],[1,1,10],[0,1,10]]},"CA":{"$rcd":[{"CA2":"","CA3":"","CA4":"","CA5":"","CA6":"","CA7":"","CA8":"","CA9":"","CA10":"","CA11":"","CA12":-1,"CA13":-1,"CA14":"","CA15":"","CA16":"","$uuid":0}],"$mvt":[[1,1,1]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "SUPLI from index 1 of 10 lines");

	cvgClient.razModification();

	cvgClient.activeRequest.listenNodeNDINSLI(_, {}, {}, new CvgIst("B,B,A"), 0, 10);
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDINSLI 100 line from 0 on BA dataSrc ok");

	//test again ndchvl
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A4,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"","BA3":"","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 3");

	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A2,1"), new CvgResu(CvgResuTag.STRU, "test"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a string column 1");

	// try a date this time
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A3,1"), new CvgResu(CvgResuTag.DATE, "02/02/2014"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a date column 2");

	// And finally a decimal??
	cvgClient.activeRequest.listenNodeNDCHVL(_, {}, {}, new CvgIst("B,B,A5,1"), new CvgResu(CvgResuTag.DCB, "1234"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]]}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDCHVL a decimal column 4");

	// format test on a cell
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,1"), "KX20");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"fmt":[["BA2",1,"KX20"],["BA2",0,"KX20"]],"stt":[["BA2",0,262148,"V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT KX20 column 1 line 1 : on a cell");

	// format on a column
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,0"), "KX22");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"fmt":[["BA2",1,"KX20"],["BA2",0,"KX22"]],"stt":[["BA2",0,262148,"V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT KX22 on column A2");

	// invisible format
	cvgClient.activeRequest.listenNodeNDCHFM(_, {}, {}, new CvgIst("B,B,A2,1"), "-KX20");
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$rcd":[{"BA2":"test","BA3":"02/02/2014","BA4":"test","BA5":"1234","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":0},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":1},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":2},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":3},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":4},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":5},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":6},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":7},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":8},{"BA2":"","BA3":"","BA4":"","BA5":"","BA6":"","BA7":"","BA8":"-1","BA9":"","BA10":"","BA11":"","BA12":-1,"BA13":-1,"BA14":"","BA15":"","BA16":"","$uuid":9}],"$mvt":[[1,1,10]],"$meta":{"stt":[["BA2",0,262144,"!V"]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDFMT -KX20 column 1 line 1 : on a cell - set invisible ");

	cvgClient.razModification();

	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A4,1"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA4",1,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 4 in line 1 - on a cell");

	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A2,0"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);

	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA4",1,{"type":122,"value":"style1"}],["BA2",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 2 - A2");

	// override style on column 4
	cvgClient.activeRequest.listenNodeNDCSTL(_, {}, {}, new CvgIst("B,B,A4,0"), new CvgResu(CvgResuTag.STRU, "style1"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDSLT change style on column 4 - A4");

	//listenNodeNDGIST
	cvgClient.activeRequest.listenNodeNDGIST(_, {}, {}, new CvgIst("B,B,A4,0"));
	cvgClient.generateResponse(_, false, false);
	strictEqual(JSON.stringify(cvgClient.response), '{"head":{},"body":{"sap":{"target":{"type":"ist","ist":{"xid":"BA4","nl":null,"win":"B","edit":true,"ctrlFailed":false}},"wins":{"B":{"entities":{"BA":{"$mvt":[],"$meta":{"sty":[["BA2",0,{"type":122,"value":"style1"}],["BA4",0,{"type":122,"value":"style1"}]]}}}}}},"session":{"settings":{"mnu":[],"datePivot":1957,"dateOrder":0,"dateSep":"/","thousandSep":",","decimalSep":".","timeSep":":"}},"srvop":{"request":{"id":0,"v":1,"connect":1,"server":""}}}}', "NDGIST on target BBA4,0");

	//listenNodeND_ASKUI

	//listenNodeND_CLF

	//listenNodeND_NAP

	//listenNodeND_REB

	//listenNodeNDCHGR

	//listenNodeNDCHVB


	start();
});

test("kill", function() {
	done = true;
	start();
});