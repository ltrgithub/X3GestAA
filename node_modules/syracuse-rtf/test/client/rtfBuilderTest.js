"use strict";

/* "QUnit" : true, "deepEqual" : true, */

var rtfbuilder = require("syracuse-rtf/lib/buildrtf");

// TODO:
// <span style="font-weight: bold;">Bold<br></span>
// <span style="font-style: italic;">Italic</span>
// <span style="text-decoration: underline;">Underline</span>
// <span style="text-decoration: line-through;">Strikethrough</span>
QUnit.module(module.id);

function testConvert(html, result, name) {
	var rtf = rtfbuilder.buildRtf(html);
	//console.log(JSON.stringify(parsed, null, '  '));
	deepEqual(rtf, "{\\rtf1\\ansi" + (['\\', '{'].indexOf(result.charAt(0)) !== -1 ? "" : " ") + result.replace(/<<prefix>>/, "\\uc0\\pard\\fs22") + "}", name);
}

test('basic', function() {
	testConvert("<b>bold</b>", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\b bold\\b0\\par", "simple tag ");
	testConvert("first line<br>next line<br>and another one", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> first line\\par next line\\par and another one\\par", "newlines ");

	testConvert("<font face='Arial'>fontarial</font>", "{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Arial;}}<<prefix>>\\f1 fontarial\\par", "font face ");
	testConvert("<font face='Arial'>fontarial</font>" + // -->
		"<font face='Bitstream Charter'>fontbitstreamcharter</font>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Arial;}{\\f2 Bitstream Charter;}}" + // -->
		"<<prefix>>{\\f1 fontarial}\\f2 fontbitstreamcharter\\par", //
		"font face x2");
	testConvert("<span style='font-size:7.5pt'>fontsize7.5pt</span>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\fs15 fontsize7.5pt\\fs22\\par");
	testConvert("<font color='#ff0000'>red</font>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}{\\colortbl;\\red255\\green0\\blue0;}<<prefix>>\\cf1 red\\cf0\\par", "font color ");
	testConvert("<span style='color:rgb(255,0,0)'>redstyle</span>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}{\\colortbl;\\red255\\green0\\blue0;}<<prefix>>\\cf1 redstyle\\cf0\\par", "color ");
	testConvert("<span style='background-color:rgb(255,0,0)'>redbackground</span>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}{\\colortbl;\\red255\\green0\\blue0;}<<prefix>>\\highlight1 redbackground\\highlight0\\par", //
		"background color ");
	testConvert("<div align='center'>centered text</div>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\pard\\qc centered text\\par\\pard\\par", "alignement  ");

	testConvert("<b>ﻼ</b>", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\b\\u65276\\b0\\par", "unicode character alone");
	testConvert("<b>beforeﻼafter</b>", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\b before\\u65276 after\\b0\\par", "unicode character inside text ");

	testConvert("<b>étage</b>", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\b\\u233 tage\\b0\\par", "simple unicode character");

	testConvert("<div style='margin-left:40px'>left indented text</div>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\li600 left indented text\\pard\\par", "indentations paragraphe ");

	testConvert("<p style='margin:0cm 0cm 10px; text-align:right'>Align right</p>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>>\\pard\\qr Align right\\par\\pard\\par", "Align and copy/past from word");
	testConvert("<p style='margin: 0cm 0cm 10pt;'><font size='3'><font face='Calibri'>Align left</font></font></p>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Calibri;}}<<prefix>>\\fs24\\f1 Align left\\par", "Align left and copy/past from word");
	testConvert("<p><span style='font-size: 11pt; background-color: #ff0000;'>1</span><span style='font-size: 18pt; background-color: #ff0000;'>2</span><span style='font-size: 26pt; background-color: #ff0000;'>3</span>456</p>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}}{\\colortbl;\\red255\\green0\\blue0;}<<prefix>>{\\fs22\\highlight1 1}{\\fs36\\highlight1 2}{\\fs52\\highlight1 3}456\\par", "Background-color and font size");
	testConvert(">> &nbsp;<<", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> >>  <<\\par", "2 blanks");
	testConvert(">> &nbsp; <<", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> >>   <<\\par", "3 blanks");
	testConvert(">> &nbsp; &nbsp;<<", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> >>    <<\\par", "4 blanks");
	testConvert(">> &nbsp; &nbsp; <<", "{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> >>     <<\\par", "5 blanks");
	/*testConvert("<ul><li>item1</li><li>item2</li></ul>", //
		prefix+"\\pard {\\pntext }{\\*\\pn \\pnlvlblt {\\pntxtb \\'b7 }}item1\\par {\\pntext }item2\\par \\pard "+suffix, "unordered bulleted list  ");
	testConvert("<ul><li><font face='Arial'><span style='font-size:12pt'>item1</span></font></li><li>item2</li></ul>", //
		prefix+"{\\fonttbl{\\f0 Arial;}}\\pard {\\pntext }{\\*\\pn \\pnlvlblt {\\pntxtb \\'b7 }}{\\f0 {\\fs22 item1}}\\par {\\pntext }item2\\par \\pard "+suffix, "unordered bulleted list with text formatting ");
	*/
});
test('Left indent', function() {
	/*Non indent
    Indent 1
        Indent 2
        Indent 2
    Indent 1
Non indent  
*/
	testConvert('Non indent<blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 1</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 2</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 2</div></blockquote></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 1</div></blockquote><div>Non indent</div>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\li1200 Indent 2\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "Left indented chrome fist form");

	testConvert('<p>Non indent</p><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 1</p></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 2</p></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 2</p></blockquote></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 1</p></blockquote><p>Non indent</p>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\li1200 Indent 2\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "Left indented chrome second form");

	testConvert('Non indent<div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 1</div></blockquote></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 2</div><div>Indent 2</div></blockquote>Indent 1</div></blockquote>Non indent', //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Non indent\\par{\\li600 Indent 1\\par\\pard}\\li1200 Indent 2\\par Indent 2\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "Left indented chrome third form");

	testConvert('Non indent<br><div style="margin-left: 40px;">Indent 1<br><div style="margin-left: 40px;">Indent 2<br>Indent 2<br></div>Indent 1<br></div>Non indent<br>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\li1200 Indent 2\\par Indent 2\\par\\li600 Indent 1\\par\\pard Non indent\\par", "Left indented FireFox first form");

	testConvert('<p>Non indent</p><p style="margin-left: 40px;">Indent 1</p><p style="margin-left: 80px;">Indent 2</p><p style="margin-left: 80px;">Indent 2</p><p style="margin-left: 40px;">Indent 1</p><p>Non indent<br></p>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\li1200 Indent 2\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par\\par", "Left indented FireFox second form");


	testConvert('<p>Non indent</p><blockquote style="margin-right: 0px;" dir="ltr"><p>Indent 1</p><blockquote style="margin-right: 0px;" dir="ltr"><p>Indent 2</p><ul><li>Indent 2 List</li><li>Indent 2 List</li></ul><p>Indent 2 non list</p></blockquote><p>Indent 1</p></blockquote><p>Non indent</p>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\li1200 Indent 2\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 List\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\li1200 Indent 2 non list\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "bulleted list Left indented IE first form");

	testConvert('<div><p>Non indent</p></div><blockquote><div><p>Indent 1</p></div></blockquote><blockquote><blockquote><p>Indent 2</p></blockquote></blockquote><ul><ul><ul><li><font face="MS Sans Serif">Indent 2 List</font></li><li><font face="MS Sans Serif">Indent 2 List</font></li></ul></ul></ul><blockquote><blockquote><p><font face="MS Sans Serif">Indent 2 non List</font></p></blockquote></blockquote><blockquote><p><font face="MS Sans Serif">Indent 1</font></p></blockquote><p><font face="MS Sans Serif">Non indent</font></p><blockquote></blockquote>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>>{ Non indent\\par}\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\pard\\pard\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260\\f0 Indent 2 List\\par{\\pntext\\f1\\'B7\\tab}\\f0 Indent 2 List\\par\\pard\\pard\\pard\\li1200\\f0 Indent 2 non List\\par\\pard\\li600\\f0 Indent 1\\par\\pard\\f0 Non indent\\par", "bulleted list Left indented IE second form");
});

test('bullets', function() {
	testConvert("<ul><li>item1</li><li>item2</li></ul>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>>\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li420item1\\par{\\pntext\\f1\\'B7\\tab}item2\\par\\pard", "unordered bulleted list  ");

	testConvert("<ul><li><font face='Arial'><span style='font-size:12pt'>item1</span></font></li><li>item2</li></ul>", //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Arial;}{\\f2 Symbol;}}<<prefix>>\\pard{\\pntext\\f2\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li420\\f1\\fs24 item1\\fs22\\par{\\pntext\\f2\\'B7\\tab}item2\\par\\pard", "unordered bulleted list with text formatting ");

	// this test is probably wrong, the expected result should be without \pard after \li720 and without 2 \par at the end
	testConvert('<div style="margin-left: 36pt;">\
<ul>\
<li><font face="MS Sans Serif"><span style="font-size: 8.5pt;">item 1</span></font></li>\
<li><font face="MS Sans Serif"><span style="font-size: 8.5pt;">item 2</span></font></li>\
<li><font face="MS Sans Serif"><span style="font-size: 8.5pt;">item 3</span></font></li>\
<li><font face="MS Sans Serif"><span style="font-size: 8.5pt;">item 4</span></font></li>\
</ul></div>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>>\\li720\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\
\\f0\\li840\\f0\\fs17 item 1\\fs22\\par\
{\\pntext\\f1\\'B7\\tab}\\f0\\fs17 item 2\\fs22\\par\
{\\pntext\\f1\\'B7\\tab}\\f0\\fs17 item 3\\fs22\\par\
{\\pntext\\f1\\'B7\\tab}\\f0\\fs17 item 4\\fs22\\par\\pard\\pard\\par", //
		"single bullet list ");

	/*
    . aaa
        . bbb
            . ccc
            . ddd
        . eee
    . fff  
 */
	testConvert('<ul><li><span style="font-size: 0.7em;">aaaa</span></li><ul><li><span style="font-size: 0.7em;">bbbb</span></li><ul><li><span style="font-size: 0.7em;">cccc</span></li><li><span style="font-size: 0.7em;">dddd</span></li></ul><li><span style="font-size: 0.7em;">eeee</span></li></ul><li><span style="font-size: 0.7em;">fffff</span></li></ul>',
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>>\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li420aaaa\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li840bbbb\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260cccc\\par{\\pntext\\f1\\'B7\\tab}dddd\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li840eeee\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li420fffff\\par\\pard", "List in list");


});
test('bullets indented', function() {
	/*
Non indent
    Indent 1
        Indent 2
            . Indent 2 list
            . Indent 2 List
        Indent 2 non list
    Indent 1
Non indent
 */
	testConvert('non indent<blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 1</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 2</div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><ul><li><span style="font-size: 0.7em;">Indent 2 list</span></li><li><span style="font-size: 0.7em;">Indent 2 List</span></li></ul></div></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 2 non list</div></blockquote></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>Indent 1</div></blockquote><div>Non indent</div>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 list\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\li1200 Indent 2 non list\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "bulleted list  Left indented chrome fist form");

	testConvert('<p>non indent</p><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 1</p></blockquote><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><p>Indent 2</p><ul><li><span style="font-size: 0.7em;">Indent 2 list</span></li><li><span style="font-size: 0.7em;">Indent 2 List</span></li></ul><span style="font-size: 0.7em;">Indent 2 non list</span></blockquote><span style="font-size: 0.7em;">Indent 1</span></blockquote><span style="font-size: 0.7em;">Non indent</span>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 list\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\li1200 Indent 2 non list\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "bulleted list  Left indented chrome second form");

	testConvert('Non Indent<br><div style="margin-left: 40px;">Indent 1<br><div style="margin-left: 40px;">Indent 2<br><ul><li>Indent 2 List</li><li>Indent 2 List</li></ul>Indent 2 non List<br></div>Indent 1<br></div>Non Indent<br>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> Non Indent\\par\\li600 Indent 1\\par\\li1200 Indent 2\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 List\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\li1200 Indent 2 non List\\par\\li600 Indent 1\\par\\pard Non Indent\\par", "bulleted list Left indented FireFox first form");

	testConvert('<p>Non indent</p><p style="margin-left: 40px;">Indent 1</p><p style="margin-left: 80px;">Indent 2</p><ul style="margin-left: 80px;"><li>Indent 2 list</li><li>Indent 2 List</li></ul><p style="margin-left: 80px;">Indent 2 non list</p><p style="margin-left: 40px;">Indent 1</p><p>Non indent<br></p>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 list\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\pard\\li1200 Indent 2 non list\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par\\par", "bulleted list Left indented FireFox second form");


	testConvert('<p>Non indent</p><blockquote style="margin-right: 0px;" dir="ltr"><p>Indent 1</p><blockquote style="margin-right: 0px;" dir="ltr"><p>Indent 2</p><ul><li>Indent 2 List</li><li>Indent 2 List</li></ul><p>Indent 2 non list</p></blockquote><p>Indent 1</p></blockquote><p>Non indent</p>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>> Non indent\\par\\li600 Indent 1\\par\\li1200 Indent 2\\par\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260Indent 2 List\\par{\\pntext\\f1\\'B7\\tab}Indent 2 List\\par\\pard\\li1200 Indent 2 non list\\par\\pard\\li600 Indent 1\\par\\pard Non indent\\par", "bulleted list Left indented IE first form");

	testConvert('<div><p>Non indent</p></div><blockquote><div><p>Indent 1</p></div></blockquote><blockquote><blockquote><p>Indent 2</p></blockquote></blockquote><ul><ul><ul><li><font face="MS Sans Serif">Indent 2 List</font></li><li><font face="MS Sans Serif">Indent 2 List</font></li></ul></ul></ul><blockquote><blockquote><p><font face="MS Sans Serif">Indent 2 non List</font></p></blockquote></blockquote><blockquote><p><font face="MS Sans Serif">Indent 1</font></p></blockquote><p><font face="MS Sans Serif">Non indent</font></p><blockquote></blockquote>', //
		"{\\fonttbl{\\f0 MS Sans Serif;}{\\f1 Symbol;}}<<prefix>>{ Non indent\\par}\\li600 Indent 1\\par\\pard\\li1200 Indent 2\\par\\pard\\pard\\pard\\pard{\\pntext\\f1\\'B7\\tab}{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li1260\\f0 Indent 2 List\\par{\\pntext\\f1\\'B7\\tab}\\f0 Indent 2 List\\par\\pard\\pard\\pard\\li1200\\f0 Indent 2 non List\\par\\pard\\li600\\f0 Indent 1\\par\\pard\\f0 Non indent\\par", "bulleted list Left indented IE second form");
});

test('Multi-line - SAM BUG 92644', function() {

	testConvert("Ligne 1 Ligne 1 Ligne 1<br>Ligne 2 Ligne 2 Ligne 2 <br>Ligne 3 Ligne 3 Ligne 3<br>", // -->
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Ligne 1 Ligne 1 Ligne 1\\par Ligne 2 Ligne 2 Ligne 2 \\par Ligne 3 Ligne 3 Ligne 3\\par", // -->
		"Firefox multi-line style");

	testConvert("Ligne 1 Ligne 1&nbsp;Ligne 1<div>Ligne 2&nbsp;Ligne 2&nbsp;Ligne 2</div><div>Ligne 3&nbsp;Ligne 3&nbsp;Ligne 3</div><div><br></div>", // -->
		"{\\fonttbl{\\f0 MS Sans Serif;}}<<prefix>> Ligne 1 Ligne 1 Ligne 1\\par Ligne 2 Ligne 2 Ligne 2\\par Ligne 3 Ligne 3 Ligne 3\\par", // -->
		"Chrome multi-line style");
});

/*test('maps', 1, function() {
	var source = "{\\rtf1\\ansi" //
	+ "{\\fonttbl" //
	+ "\n{\\f0\\fnil\\fcharset0\\fprq0\\fttruetype Helvetica;}" //
	+ "\n{\\f1\\fnil\\fcharset0\\fprq0\\fttruetype Bitstream Charter;}}" //
	+ "\n{\\f1\\fs24 Ceci est un texte accentu\\'e9}" //
	+ "\n\\par" //
	+ "\n\\par" //
	+ "\n{\\f1 des {\\fs18 petits} et des {\\fs32 gros}.}" //
	+ "\n}";

	var result = [{
		"word": "rtf",
		"arg": 1,
	}, {
		"word": "ansi",
	}, [{
		"word": "fonttbl",
	}, [{
		"word": "f",
		"arg": 0,
	}, {
		"word": "fnil",
	}, {
		"word": "fcharset",
		"arg": 0,
	}, {
		"word": "fprq",
		"arg": 0,
	}, {
		"word": "fttruetype",
	}, "Helvetica;"],
		[{
			"word": "f",
			"arg": 1,
		}, {
			"word": "fnil",
		}, {
			"word": "fcharset",
			"arg": 0,
		}, {
			"word": "fprq",
			"arg": 0,
		}, {
			"word": "fttruetype",
		}, "Bitstream Charter;"]
	],
		[{
			"word": "f",
			"arg": 1,
		}, {
			"word": "fs",
			"arg": 24,
		}, "Ceci est un texte accentu", "'", "e9"], {
			"word": "par",
		}, {
			"word": "par",
		}, [{
			"word": "f",
			"arg": 1,
		}, "des ", [{
			"word": "fs",
			"arg": 18,
		}, "petits"], " et des ", [{
			"word": "fs",
			"arg": 32,
		}, "gros"], "."]
	];
	testParse(source, result);
});*/