"use strict";
var module = QUnit.module;
var convert = require("syracuse-ui");

module("RTF to HTML converter");

function escape(html) {
    return html.replace(/\&/g, '&amp;').replace(/\</g, '&lt;').replace(/\>/g, '&gt;');
}

function testConvert(result,rtf, name) {
   strictEqual(escape(convert(rtf)), escape(result), name);
}

test('basic', 12, function() {
    var prefix ="{\\rtf1\\ansi"
    var suffix="}" ;

    


    testConvert("<b>bold</b>", prefix+"{\\b bold}"+suffix, "simple tag ");

    testConvert("<font face='Arial'>fontarial</font>", prefix+"{\\fonttbl{\\f0 Arial;}}{\\f0 fontarial}"+suffix, "font face ");
    testConvert("<font face='Arial'>fontarial</font>"  //
        +"<font face='Bitstream Charter'>fontbitstreamcharter</font>", // 
        prefix+"{\\fonttbl{\\f0 Arial;}{\\f1 Bitstream Charter;}}"  //
        + "{\\f0 fontarial}{\\f1 fontbitstreamcharter}"+ //
        suffix, "font face x2");
    testConvert("<span style='font-size:7.5pt'>fontsize7.5pt</span>", //
        prefix+"{\\fs15 fontsize7.5pt}"+suffix, "font-size ");
    testConvert("<font color='#ff0000'>red</font>", //
        prefix+"{\\colortbl;\\red255\\green0\\blue0;}{\\cf1 red}"+suffix, "font color ");
    testConvert("<font bgcolor='#ff0000'>redbackground</font>", //
     prefix+"{\\colortbl;\\red255\\green0\\blue0;}{\\highlight1 redbackground}"+suffix, //
     "background color ");
    testConvert("<div align='center'>centered text</div>", //
        prefix+"\\pard \\qc centered text\\par "+suffix, "alignement  ");
    testConvert("<li>item1</li><li>item2</li>", //
        prefix+"\\bullet item1\\par \\bullet item2\\par"+suffix, "bulleted list items ");
    testConvert("<ul><li>item1</li><li>item2</li></ul>", //
        prefix+"\\pard {\\pntext }{\\*\\pn \\pnlvlblt {\\pntxtb \\'b7 }}item1\\par {\\pntext }item2\\par \\pard "+suffix, "unordered bulleted list  ");
    testConvert("<ul><li><font face='Arial'><span style='font-size:12pt'>item1</span></font></li><li>item2</li></ul>", //
        prefix+"{\\fonttbl{\\f0 Arial;}}\\pard {\\pntext }{\\*\\pn \\pnlvlblt {\\pntxtb \\'b7 }}{\\f0 {\\fs24 item1}}\\par {\\pntext }item2\\par \\pard "+suffix, "unordered bulleted list with text formatting ");
    testConvert("ﻼ",prefix+"\\u65276"+suffix, "unicode character ");
    testConvert("ﻼ",prefix+"\\u65276?"+suffix, "unicode character and substituting ansi character ");
    
});

test('maps', 1, function() {
    var rtf = "{\\rtf1\\ansi\\ansicpg1252\\deff0\\deflang1036{" + //
    "\\fonttbl\n" + //
    "{\\f0\\fnil\\fcharset0\\fprq0\\fttruetype Helvetica;}" + //
    "{\\f1\\fswiss\\fcharset0\\fprq2 Arial;}" + //
    "{\\f2\\fswiss\\fcharset0\\fprq2 Verdana;}" + //
    "{\\f3\\froman\\fcharset2\\fprq2 Symbol;}}" + //
    "{\\colortbl;\\red255\\green0\\blue0;\\red0\\green255\\blue0;\\red0\\green0\\blue255;}\n" + //
    "{{\\f1\\fs24 Ceci est un texte accentu}\n" + //
    "\\par\n\\par\n{\\f1 des {\\fs18 petits} et des {\\fs32 gros}." + //
    "\\par Hellou RTF Wörld\\par " + //
    "\\f0 some \\b bold\\b0, \\i italic\\i0, \\ul underlined\\ul0  and \\strike strikethrough\\strike0  text " + //
    "\\par some nested styles: {\\b\\cf1 bold}, {\\i\\cf2 italic},{\\ul\\cf3 underlined}, normal\\par " + //
    "\\par some combined styles: {\\b bold+\\i italic+\\ul underlined} vs. normal " + //
    "\\par and further: {\\b bold, {\\i bold+italic},\\ul bold+underlined{\\plain, normal} }}";

    
    var html = "<font face='Arial'><span style='font-size:12pt'>Ceci est un texte accentu</span></font>" + //
    "<p><p><font face='Arial'>des <span style='font-size:9pt'>petits</span> et des <span style='font-size:16pt'>gros</span>." + //
    "<p>Hellou RTF Wörld" + //
    "<p><font face='Helvetica'>some <b>bold</b>, <i>italic</i>, <u>underlined</u> and <s>strikethrough</s> text " + //
    "<p>some nested styles: <b><font color='#ff0000'>bold</font></b>, <i><font color='#00ff00'>italic</font></i>,<u><font color='#0000ff'>underlined</font></u>, normal" + //
    "<p><p>some combined styles: <b>bold+<i>italic+<u>underlined</u></i></b> vs. normal <p>and further: <b>bold, <i>bold+italic</i>,<u>bold+underlined" + //
    "<pre>, normal</pre> </u></b></font></font>" ;
    console.log(convert(rtf));
    strictEqual(escape(convert(rtf)), escape(html));
});