"use strict";
var eventManager = require('syracuse-notification/lib/eventManager');
var socketHandler = require('syracuse-notification/lib/socketHandler');
var globals = require('streamline/lib/globals');
var tracer = require("syracuse-trace/lib/helper").getTracer("notifications");

exports.$exported = true;

exports.sendMessage = function(_, type, title, message, to, severity) {
	var from = "X3 ERP";
	var msg = eventManager.createMessage(_, type, title, message, from, to, severity);

	if (to && Array.isArray(to)) {
		var _sockets = socketHandler.getSocketByLogin(globals.context.session._ioclient, to);
		_sockets.forEach(function(_s) {
			tracer.info && tracer.info("* EMIT MESSAGE TO '" + _s.login + "' on socket '" + _s.socket.id + "'");
			_s.socket.emit('message', msg);
		});

	} else if (to === "*") {
		tracer.info && tracer.info("* EMIT MESSAGE TO EVERY CONNECTED USERS");
		globals.context.session._ioclient.broadcast.emit('message', msg);
	}
};