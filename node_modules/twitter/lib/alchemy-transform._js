"use strict";

var AlchemyAPI = require('alchemy-api');

module.exports = function() {
	var alchemy = new AlchemyAPI('b07b434e1a7f9bd63a1e43dab8c01dea9649b086');

	return function(_, reader, writer) {
		var tweet = reader.read(_);

		if (tweet === undefined)
		{
			// End of in-stream
			return;
		}

		// Use alchemy to compute the sentiment of the text
		try {
			var response = alchemy.sentiment(obj.text, {});
			var record =  {
				tweet : tweet,
				sentiment : {
					score : response.score,
					type: response.type,
				}
			};
			writer.write(_, record);
		}
		catch (err)
		{
			console.error('Could not analyze the tweet ' + tweet.id);		
		}
	};
};