var fs = require("streamline-fs"),
	path = require('path'),
	mongodb = require('streamline-mongodb'),
	ezMongo = require("ez-mongodb");

exports.get_mongoWriter = function (_, config, options, colName) {
	try {
		var mongoConfig = config.mongo || {};
		mongoConfig.options  = mongoConfig.options || { db :{ w:1}};
		mongoConfig.host     = mongoConfig.host || "localhost";
		mongoConfig.port     = mongoConfig.port || 27017;
		mongoConfig.database = mongoConfig.database || "tweet";

	    var dbUrl = "mongodb://" + mongoConfig.host + ":" + mongoConfig.port + "/" + mongoConfig.database;
	    var db = mongodb.MongoClient.connect(dbUrl, mongoConfig.options,_);

		var coln = db.collection(colName, _);

		return ezMongo.writer(coln, options);
	}
	catch(err)
	{
		console.error('get_mongoWriter ERROR ' + err.message);
	}
}

exports.get_reader = function (_, config,  colName, qs) {
	try {
		var mongoConfig = config.mongo || {};
		mongoConfig.options  = mongoConfig.options || { db :{ w:1}};
		mongoConfig.host     = mongoConfig.host || "localhost";
		mongoConfig.port     = mongoConfig.port || 27017;
		mongoConfig.database = mongoConfig.database || "tweet";

	    var dbUrl = "mongodb://" + mongoConfig.host + ":" + mongoConfig.port + "/" + mongoConfig.database;
	    var db = mongodb.MongoClient.connect(dbUrl, mongoConfig.options,_);

		var coln = db.collection(colName, _);

		cursor = coln.find(qs, _);

		return ezMongo.reader(cursor);
	}
	catch(err)
	{
		console.error('get_reader ERROR ' + err.message);
	}
}