"use strict";
var url = require('url');
var syracuse;
var config;
var mock = require('syracuse-load/lib/mock');

exports.dispatcher = function(config) {
	var routes = {
		notificationAll: function(_, request, response) {
			// this function is called when the scheduler should be updated
			response.writeHead(200, {
				"Content-Type": "text/plain"
			});
			require('syracuse-event/lib/scheduler').scheduleAll(_); // function which updates local notification array
			response.end('OK');
			return;
		}


	};
	return function(_, request, response) {
		syracuse = syracuse || require('syracuse-main/lib/syracuse');
		config = config || require('config');
		if (syracuse.server instanceof mock.MockStreamServer && !request.fromNanny && !request._request.fromNanny || !(syracuse.server instanceof mock.MockStreamServer) && (!config.system || !config.system.enableDevelopmentFeatures)) {
			response.writeHead("404", {});
			return response.end("Resource not found.");
		}
		var route = routes[request.url.split('/')[2]];
		if (!route) throw new Error("bad url: " + request.url);
		return route(_, request, response);
	};
};