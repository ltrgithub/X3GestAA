"use strict";

module.exports = function(options) {
	if (options.runtime === 'await') require('es6-promise');
	require("babel-plugin-streamline");
	require("babel-plugin-flow-comments");
	require("babel/register")({
		plugins: ['flow-comments', 'streamline'],
		extensions: [".js", "._js"],
		// ignore dependencies but not shadow-modules 
		ignore: function(path) {
			if (/\/node_modules\/fibers\//.test(path)) return true;
			var segs = path.split('/node_modules/');
			return segs.length > 3 || (segs.length == 3 && segs[1] !== 'shadow-modules');
		},
		extra: {
			streamline: {
				cache: options.cache,
				verbose: options.verbose,
				runtime: options.runtime || "fibers",
			}
		}
	});
};