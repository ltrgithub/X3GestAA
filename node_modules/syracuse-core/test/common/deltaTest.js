var module = QUnit.module;

var helpers = require("syracuse-core/lib/helpers");
module('delta');

test('array delta', 38, function(){
	var oldResource, newResource, delta;
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": []
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": []
	};
	delta = {
		"$uuid": "ROOT",
		"$url": "ROOT"
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array empty --> array empty");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array empty --> array empty - merge");
	oldResource  = {
		"$url": "5882...",
		"$uuid": "5882...",
		"people": [
			{ "$uuid": "639e...", "name": "Mark" },
			{ "$uuid": "b619...", "name": "Ann" },
			{ "$uuid": "1cd3...", "name": "John" },
			{ "$uuid": "4a20...", "name": "Bill" }
		]
	};
	newResource = {
		"$url": "5882...",
		"$uuid": "5882...",
		"people": [
			{ "$uuid": "639e...", "name": "Mark" },
			{ "$uuid": "7a71...", "name": "Sue" },
			{ "$uuid": "f331...", "name": "Kate" },
			{ "$uuid": "1cd3...", "name": "John" },
			{ "$uuid": "4a20...", "name": "Billy" },
			{ "$uuid": "88f0...", "name": "Bob" }
		]
	};
	delta = {
		"$url": "5882...",
		"$uuid": "5882...",
		"people": [
			{ "$uuid": "b619...", "$index": 1, "$isDeleted": true },
			{ "$uuid": "7a71...", "$index": 1, "name": "Sue" },
			{ "$uuid": "f331...", "$index": 2, "name": "Kate" },
			{ "$uuid": "4a20...", "$index": 4, "name": "Billy" },
			{ "$uuid": "88f0...", "$index": 5, "name": "Bob" }
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "wiki example 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "wiki example 1 - merge");
	var oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": []
	};
	var newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2}
		]
	};
	var delta = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1, $index: 0},
			{ "$uuid": "B", "value": 2, $index: 1}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true,  "array empty --> array not empty");	
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array empty --> array not empty - merge");

	oldResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2}
		]
	};
	newResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": []
	};
	delta = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, $index:0},
			{ "$uuid": "B", "$isDeleted": true, $index:0}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array not empty --> array empty");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array not empty --> array empty - merge");
	oldResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2}
		]
	};
	newResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT"
	};
	delta = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"lines": {"$isUndefined": true}
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array not empty --> array undefined");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array not empty --> array undefined - merge");
	oldResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2}
		]
	};
	newResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 3},
			{ "$uuid": "B", "value": 2}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 3, "$index": 0}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array --> modify item");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array --> modify item - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2},
			{ "$uuid": "C", "value": 3},
			{ "$uuid": "D", "value": 4}
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "D", "value": 4}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, "$index": 0},
			{ "$uuid": "B", "$isDeleted": true, "$index": 0},
			{ "$uuid": "C", "$isDeleted": true, "$index": 0}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  delete 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  delete 1 - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 2},
			{ "$uuid": "C", "value": 3},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "E", "value": 4},
			{ "$uuid": "F", "value": 4},
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "D", "value": 4}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, "$index": 0},
			{ "$uuid": "B", "$isDeleted": true, "$index": 0},
			{ "$uuid": "C", "$isDeleted": true, "$index": 0},
			{ "$uuid": "E", "$isDeleted": true, "$index": 1},
			{ "$uuid": "F", "$isDeleted": true, "$index": 1}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  delete 2");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  delete 2 - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "B", "value": 3}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, "$index": 0},
			{ "$uuid": "B", "value": 3, "$index": 0},
			{ "$uuid": "C", "$isDeleted": true, "$index": 1}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  delete/modify");	
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  delete/modify - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1},
			{ "$uuid": "D", "value": 1},
			{ "$uuid": "E", "value": 1},
			{ "$uuid": "F", "value": 1},
			{ "$uuid": "G", "value": 1},
			{ "$uuid": "H", "value": 1}
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "X", "value": 1},
			{ "$uuid": "Y", "value": 1},
			{ "$uuid": "C", "value": 3},
			{ "$uuid": "D", "value": 1},
			{ "$uuid": "G", "value": 5},
			{ "$uuid": "H", "value": 1},
			{ "$uuid": "Z", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, "$index": 0},
			{ "$uuid": "B", "$isDeleted": true, "$index": 0},
			{ "$uuid": "X", "value": 1, "$index": 0},
			{ "$uuid": "Y", "value": 1, "$index": 1},
			{ "$uuid": "C", "value": 3, "$index": 2},
			{ "$uuid": "E", "$isDeleted": true, "$index": 4},
			{ "$uuid": "F", "$isDeleted": true, "$index": 4},
			{ "$uuid": "G", "value": 5, "$index": 4},
			{ "$uuid": "Z", "value": 1, "$index": 6}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  insert/modify/delete 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  insert/modify/delete 1 - merge");
	
	
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "X", "value": 1},
			{ "$uuid": "B", "value": 3},
			{ "$uuid": "Z", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "$isDeleted": true, "$index": 0},
			{ "$uuid": "X", "value": 1, "$index": 0},
			{ "$uuid": "B", "value": 3, "$index": 1},
			{ "$uuid": "C", "$isDeleted": true, "$index": 2},
			{ "$uuid": "Z", "value": 1, "$index": 2}
		]
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  insert/modify/delete 2");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  insert/modify/delete 2 - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		]
		
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "B"},
			{ "$uuid": "A"},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C"}
		],
		$: {
			"lines": {"$deleteMissing": true }
		}
		
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  $deleteMissing 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  $deleteMissing 1 - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"oldProp": false,
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		],
		"$": {
			"oldProp": {"$isReadOnly": true }
		}
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"lines": [
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"lines": [
			{ "$uuid": "B"},
			{ "$uuid": "A"},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C"}
		],
		$: {
			"lines": {"$deleteMissing": true },
			"oldProp": {"$isUndefined": true, "$isReadOnly": null}

		}
		
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  $deleteMissing 2");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  $deleteMissing 2 - merge");
	

	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"oldProp": false,
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		]
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"lines": [
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"lines": [
			{ "$uuid": "B"},
			{ "$uuid": "A"},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C"}
		],
		$: {
			"lines": {"$deleteMissing": true },
			"oldProp": {"$isUndefined": true}

		}
		
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "array,  $deleteMissing 3");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "array,  $deleteMissing 3 - merge");
	
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"oldProp": false,
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		],
		$: {
			"newProp": {"$isReadOnly": true}
		}  
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"lines": [
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"lines": [
			{ "$uuid": "B"},
			{ "$uuid": "A"},
			{ "$uuid": "D", "value": 4},
			{ "$uuid": "C"}
		],
		$: {
			"lines": {"$deleteMissing": true },
			"oldProp": {"$isUndefined": true},
			"newProp": null

		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "$ delta 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "$ delta 1 - merge");

	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"oldProp": false,
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		],
		$: {
			"newProp": {"$isReadOnly": true}
		}  
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$newProp": true,
		"oldProp": false,
		"lines": [
			{ "$uuid": "A", "value": 1},
			{ "$uuid": "B", "value": 1},
			{ "$uuid": "C", "value": 1}
		]
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		$: null
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "$ delta 2");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "$ delta 2 - merge");

	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"$diagnoses": [{ "severity": "warning", "message": "order date cannot be after shipping date" }]
		}
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"$diagnoses": [{ "severity": "error", "message": "order date cannot be after shipping date" }]
		}
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"$diagnoses": [{ "severity": "error", "message": "order date cannot be after shipping date" }]
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "$ delta 3");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "$ delta 3 - merge");
	
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"value" : "1",
		"$": {
			"$diagnoses": [{ "severity": "warning", "message": "order date cannot be after shipping date" }]
		}
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"value" : "1",
		"$": {
			"value" : {"$isReadOnly": true}
		}
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"$diagnoses": null,
			"value" : {"$isReadOnly": true}
		}
	};
	
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "$ delta 4");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "$ delta 4 - merge");
	oldResource  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"boolValue": true,
		"boolValue2": true,
		"boolValue3": true,
		"$": {
			"boolValue": {"$isReadOnly": true},
			"boolValue2": {"$isReadOnly": true},
			"boolValue3": {"$isReadOnly": true},
			"$diagnoses": [{ "severity": "warning", "message": "order date cannot be after shipping date" }]
		}
	};
	newResource = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"boolValue2": true,
		"boolValue3": true,
		"$": {
			"boolValue2": {"$isReadOnly": false},
			"$diagnoses": [{ "severity": "warning", "message": "order date cannot be after shipping date" }]
		}
	};
	delta  = {
		"$uuid": "ROOT",
		"$url": "ROOT",
		"$": {
			"boolValue": {"$isReadOnly": null, "$isUndefined": true},
			"boolValue2": {"$isReadOnly": false},
			"boolValue3": null
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "$ delta 5");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "$ delta 5 - merge");
	
});

test('object delta', 24, function(){
	var oldResource  =   {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"$key": "O147",
		"status": "confirmed",
		"orderDate": "2010-11-03",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "Paris"},
		"$": {
			"orderDate": { $isReadOnly: true }
		}
	};
	var newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"$key": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": {$uuid: "3278..", "street": "12 Baker St", "city": "London"},
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	var delta = {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"$key": "O147",
		"shipDate": "2010-11-19",
		"status": "shipped",
		"billingAddress": {$uuid: "3278..", "city": "London"},
		"$": {
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 1");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 1 - merge");
	oldResource  =   {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "confirmed",
		"orderDate": "2010-11-03",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": {"$uuid": "3278..", "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true }
		}
	};
	newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": {"$uuid": "3278..",  "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 3, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	delta = {
		"$uuid": "f3c4...",
		"$url": "http://.../salesOrders('O147')",
		"status": "shipped",
		"shipDate": "2010-11-19",
		"lines": [
			{ "$uuid": "348c...", "qty": 3, "$index": 1 }
		],
		"$": {
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 2");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 2 - merge");
	oldResource  =   {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "confirmed",
		"orderDate": "2010-11-03",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true }
		}
	};
	newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	delta = {
		"$uuid": "f3c4...",
		"$url": "http://.../salesOrders('O147')",
		"status": "shipped",
		"shipDate": "2010-11-19",
		"$": {
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 3");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 3 - merge");
	oldResource  =   null;
	var newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"$key": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	var delta = {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"$key": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 4");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 4 - merge");
	
	oldResource  =   {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "confirmed",
		"orderDate": "2010-11-03",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"lines": null,
		"$": {
			"orderDate": { $isReadOnly: true }
		}
	};
	newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	delta = {
		"$uuid": "f3c4...",
		"$url": "http://.../salesOrders('O147')",
		"status": "shipped",
		"shipDate": "2010-11-19",
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 5");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 5 - merge");
	
	oldResource  =   {
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "confirmed",
		"orderDate": "2010-11-03",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"$": {
			"orderDate": { $isReadOnly: true }
		}
	};
	newResource ={
		"$url": "http://.../salesOrders('O147')",
		"$uuid": "f3c4...",
		"id": "O147",
		"status": "shipped",
		"orderDate": "2010-11-03",
		"shipDate": "2010-11-19",
		"customer": { "$url": "http://.../customers('C31')" },
		"billingAddress": { "street": "12 Baker St", "city": "London"},
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"orderDate": { $isReadOnly: true },
			"shipDate": { $isReadOnly: true }
		}
	};
	delta = {
		"$uuid": "f3c4...",
		"$url": "http://.../salesOrders('O147')",
		"status": "shipped",
		"shipDate": "2010-11-19",
		"lines": [
			{ "$uuid": "b138...", "qty": 1, "item": { "$url": "http://.../stockItems('S187')" }},
			{ "$uuid": "348c...", "qty": 2, "item": { "$url": "http://.../stockItems('S429')" }}
		],
		"$": {
			"shipDate": { $isReadOnly: true }
		}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 6");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 6 - merge");
	
	oldResource  =   {
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1000, "bool": true, "currency": { "codeISO" : "$"} }
	};
	newResource ={
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1002, "bool": false, "currency": { "codeISO" : "$"} }
	};
	delta = {
		"$uuid": "f3c4...",
		"complex": { "value": 1002, "bool": false}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 7");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 7 - merge");


	oldResource  =   {
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1000, "bool": true, "currency": { "codeISO" : "$"} }
	};
	newResource ={
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": null
	};
	delta = {
		"$uuid": "f3c4...",
		"complex": null
	};
	
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 8");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 8 - merge");
	
	oldResource  =   {
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1000, "bool": true, "currency": { "codeISO" : "$"} }
	};
	newResource ={
		"$uuid": "f3c4...",
		"status": "confirmed",
	};
	delta = {
		"$uuid": "f3c4...",
		$: {
			complex: {$isUndefined : true}
		}
	};
	
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 9");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 9 - merge");
	
	oldResource  =   {
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1000, "bool": true, "currency": { "codeISO" : "EUR"} }
	};
	newResource ={
		"$uuid": "f3c4...",
		"status": "confirmed",
		"complex": { "value": 1000, "bool": true, "currency": { "codeISO" : "USD"}}
	};
	delta = {
		"$uuid": "f3c4...",
		"complex": { "currency": { "codeISO" : "USD"}}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 10");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 10 - merge");
	
	
	oldResource  =   {
		"$uuid": "f3c4...",
		"$actions": { "title": "Save", "state": "ready", "trigger": null, $diagnoses:[] }
	};
	newResource ={
		"$uuid": "f3c4...",
		"$actions": { "title": "Save", "state": "ready", "trigger": null, $diagnoses:[] }
	};
	delta = {
		"$uuid": "f3c4...",
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 11");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 11 - merge");
	
	oldResource  =   {
		"$uuid": "f3c4...",
		"$actions": { "title": "Save", $isDisabled: false, $diagnoses:[] }
	};
	newResource ={
		"$uuid": "f3c4...",
		"$actions": { "title": "Save", $isDisabled: true,  $diagnoses:[] }
	};
	delta = {
		"$uuid": "f3c4...",
		"$actions": { $isDisabled: true}
	};
	strictEqual(helpers.object.areEqual(helpers.resource.sdataDelta(oldResource, newResource), delta), true, "object delta 12");
	strictEqual(helpers.object.areEqual(helpers.resource.sdataMerge(oldResource, delta), newResource), true, "object delta 12 - merge");
	
});
