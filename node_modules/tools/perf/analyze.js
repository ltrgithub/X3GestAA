"use strict";

require("streamline").register({
	fibers: true,
	fast: true,
	verbose: true,
	cache: true
});

var perf = require("@sage/syracuse-lib/src/perfmon/analyzer");

if (process.argv.length < 5) {
	console.log("Usage: " + process.argv.splice(0, 2).join(" ") + " [options] [logdir] [json-dest-file]");
	process.exit(-1);
}

var args = process.argv.slice(2),
	i = 0,
	len = args.length,
	options = {};
while (i < len && args[i].substring(0, 2) === "--") {
	switch (args[i].substring(2)) {
		case "regex":
			options.regex = args[++i];
			break;
	}
	i++;
}
console.log("\nOptions: " + JSON.stringify(options, null, "\t"));
console.log("\nWriting output to " + args[i + 1] + "\n");
perf.analyze(args[i], args[i + 1], options);
// perf.analyze("C:/workspace/Syracuse/logs/perfmon/2014-06/16", __dirname + "/perf/perfstat-del.json");
// perf.analyze("C:/workspace/Syracuse/logs/perfmon/2014-06/20", __dirname + "/perf/perfstat-2014-06-20.json");
// perf.analyze("D:/temp/perf/230", __dirname + "/perf/perfstat-gre230.json");