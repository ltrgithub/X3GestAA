#!/usr/bin/env node

require('npm-shadow')();

var config = {};
try {
	config = require("../../../nodelocal").config || {};
} catch (ex) {
	console.error("Error in nodelocal.js: " + ex);
	process.exit(6);
}
var fsp = require('path');

if (config.streamlineFromCI) {
	try {
		var version = require("../../../version.json") || {};
		if (version.streamline) {
			console.log("Streamline config from version.json");
			config.streamline = version.streamline;
		}
	} catch (ex) {
		console.error(ex);
	}
}

config.streamline = config.streamline || {
	"runtime": "fibers",
	"cache": true,
	"verbose": false,
	"aggressive": true
};

if (!config.streamline.cacheDir && (process.env.HOME === undefined) && (process.env.HOMEDRIVE === undefined)) {
	config.streamline.cacheDir = fsp.resolve(fsp.join(__dirname, "../../../../cache"));
}

require('syracuse-core/streamline-loader')(config.streamline);
require('syracuse-license').register(function(err, data) {
	require('./main');
});
