"use strict";

var fs = require('streamline-fs');

var config = require('../../../nodelocal').config;
if (!config.metadata) throw new Error("config.metadata missing");

function run(_) {
	var exporter = require("tools/metadata/exporter").newExporter(config.metadata);
	exporter.clean(_);
	exporter.init(_);

	var entityExporter = require("tools/metadata/export-entity");
	var entitiesPath = "tools/metadata/entities/";
	fs.readdir(entitiesPath, _).forEach_(_, function(_, filename) {
		if (/(.*)\.(_js)/.test(filename)) {
			var entity = require(entitiesPath + filename).entity;
			entityExporter.run(_, exporter, entity);
		}
	});
}

run(_);
