"use strict";

var fs = require('streamline-fs');

var config = require('../../../nodelocal').config;
if (!config.metadata) throw new Error("config.metadata missing");

function runExporter(_) {
	var exporter = require("tools/metadata/exporter").newExporter(config.metadata);
	exporter.clean(_);
	exporter.init(_);

	var entityExporter = require("tools/metadata/export-entity");
	var entitiesPath = __dirname + "/entities/";
	fs.readdir(entitiesPath, _).forEach_(_, function(_, filename) {
		if (/(.*)\.(_js)/.test(filename)) {
			var entity = require(entitiesPath + filename).entity;
			entityExporter.run(_, exporter, entity);
		}
	});
}

function runImporter(_) {
	var importer = require("tools/metadata/importer").newImporter(config.metadata);
	importer.init(_);
}

runExporter(_);
//runImporter(_);
