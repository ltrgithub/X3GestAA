"use strict";

require('public/deps/jsPlumb/lib/jsBezier-0.6', window);
require('public/deps/jsPlumb/lib/mottle-0.4', window);
require('public/deps/jsPlumb/lib/biltong-0.2', window);
require('public/deps/jsPlumb/lib/katavorio-0.4', window);
require('public/deps/jsPlumb/src/util', window);
require('public/deps/jsPlumb/src/browser-util', window);
require('public/deps/jsPlumb/src/dom-adapter', window);
require('public/deps/jsPlumb/src/jsPlumb', window);
require('public/deps/jsPlumb/src/endpoint', window);
require('public/deps/jsPlumb/src/connection', window);
require('public/deps/jsPlumb/src/anchors', window);
require('public/deps/jsPlumb/src/defaults', window);
require('public/deps/jsPlumb/src/connectors-bezier', window);
require('public/deps/jsPlumb/src/connectors-statemachine', window);
require('public/deps/jsPlumb/src/connectors-flowchart', window);
require('public/deps/jsPlumb/src/connector-editors', window);
require('public/deps/jsPlumb/src/renderers-svg', window);
require('public/deps/jsPlumb/src/renderers-vml', window);
require('public/deps/jsPlumb/src/base-library-adapter', window);
require('public/deps/jsPlumb/src/dom.jsPlumb', window);
var designerComponent = require('syracuse-uml/public/js/class-designer');

// fix CSS
['/syracuse-uml/public/css/class-designer.css'].forEach(function(href) {
	$("<link/>", {
		rel: "stylesheet",
		type: "text/css",
		href: href,
	}).appendTo("head");
});

exports.create = function(opts) {
	if (/^\$(details|edit)$/.test(opts.facet)) {
		return designerComponent.create(opts);
	} else {
		var $synopsis = $('<span>').addClass('uml-synopsis').appendTo($(opts.div));
		return {
			setValue: function(value) {
				var text = (value && value.classes) ? value.classes.length + " classes" : "<empty>";
				$synopsis.text(text);
			}
		};
	}
};