

var canvasContext; // cache for browsers that don't have Uint8Array

function newBuffer(size) {
	if (typeof Uint8Array === 'function')
		return new Uint8Array(size);
	canvasContext = canvasContext || document.createElement('canvas').getContext('2d');
	var image = canvasContext.createImageData(1, size / 4);
	image.length = size;
	return image;
}

exports.stringToBinary = function(str) {
	var data = newBuffer(str.length);
	for (var i = 0, len = str.length; i < len; i++) {
		data[i] = str.charCodeAt(i);		
	}
	return data;
}

exports.binaryToString = function(data) {
	var s = "";
	for (var i = 0, len = data.length; i < len; i++) {
		s += String.fromCharCode(data[i]);
	}
	return s;
	// apply variant works on FF but not on chrome
	//return String.fromCharCode.apply(null, data);
}

