var z = require('x3-engine/lib/runtime').instructions,r=require,e=exports,p=[],B=z.B,NL=z.NL,A=z.A,REQ=z.REQ,C=z.C,CALL=z.CALL,F=z.F,RET=z.RET,GO=z.GO,DECL=z.DECL,SET=z.SET,V=z.V,GOSUB=z.GOSUB,PLUSEQ=z.PLUSEQ,IF=z.IF,EQ=z.EQ,PROG=z.PROG,END=z.END,NE=z.NE,CASE=z.CASE,WHEN=z.WHEN,RESUME=z.RESUME,CALLJS=z.CALLJS,ONERRGO=z.ONERRGO,GT=z.GT,MUL=z.MUL,SUB=z.SUB,WHILE=z.WHILE,MULEQ=z.MULEQ,MINUSEQ=z.MINUSEQ,BREAK=z.BREAK,LE=z.LE,FORV=z.FORV,FORIN=z.FORIN,CLOSE=z.CLOSE,OPEN=z.OPEN,LT=z.LT,WRSEQ=z.WRSEQ;z.BEGIN(module);NL(0);z.MAIN(e);e.MAIN=B(CALL(REQ(r,C('XUNIT')),C('INIT'),[F('TRTCOU'),C(27)])
,NL(1),CALL(C(e),C('GOSUB_TEST'),[])
,NL(1),CALL(C(e),C('IF_TEST'),[])
,NL(1),CALL(C(e),C('CASE_TEST'),[])
,NL(1),CALL(C(e),C('LOOP_TEST'),[])
,NL(1),CALL(C(e),C('ERROR_TEST'),[])
,NL(1),CALL(C(e),C('WRSEQ_TEST'),[])
,NL(1),CALL(C(e),C('SCOPES_TEST'),[])






,NL(7),CALL(REQ(r,C('XUNIT')),C('FINISH'),[])
,NL(1),RET(C("That's all folks"))); 

e.SUB1=B(
NL(3),DECL('DS','SUBRES')
,NL(1),SET(V('SUBRES'),C('A'))
,NL(1),GOSUB(C(e),'SUB2')
,NL(1),PLUSEQ(V('SUBRES'),C('B'))
,NL(1),GOSUB(C(e),'SUB2')
,NL(1),PLUSEQ(V('SUBRES'),C('C'))
,NL(1),RET()); 

e.SUB2=B(
NL(3),PLUSEQ(V('SUBRES'),C('D'))
,NL(1),GOSUB(C(e),'SUB3')
,NL(1),PLUSEQ(V('SUBRES'),C('E'))
,NL(1),RET()); 

e.SUB3=B(
NL(3),PLUSEQ(V('SUBRES'),C('F'))
,NL(1),RET()); 

e.SUB4=B(
NL(3),IF(EQ(V('SUBRES'),C('A')),p,1,B(PLUSEQ(V('SUBRES'),C('B')),RET(),GO(p,1)))); p[1]=B(
NL(1),PLUSEQ(V('SUBRES'),C('C'))
,NL(1),RET()); 

PROG(e,'GOSUB_TEST',[],B(
NL(3),GOSUB(C(e),'SUB1')
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('GOSUB'),V('SUBRES'),C('ADFEBDFEC')])
,NL(1),GOSUB(C(e),'SUB3')
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('GOSUB'),V('SUBRES'),C('ADFEBDFECF')])
,NL(1),SET(V('SUBRES'),C('')),GOSUB(C(e),'SUB4')
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('GOSUB'),V('SUBRES'),C('C')])
,NL(1),SET(V('SUBRES'),C('A')),GOSUB(C(e),'SUB4')
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('GOSUB'),V('SUBRES'),C('AB')])
,NL(1),END())); 

PROG(e,'IF_PROG',['X'],B(
NL(3),DECL('BI','X')
,NL(1),DECL('DS','GOT')
,NL(1),SET(V('GOT'),C(''))
,NL(1),IF(EQ(V('X'),C(10)),p,2,B(PLUSEQ(V('GOT'),C('A')),GO(p,2)))));p[2]=B(
NL(1),IF(NE(V('X'),C(10)),p,3,B(PLUSEQ(V('GOT'),C('B')),GO(p,3))));p[3]=B(
NL(1),IF(EQ(V('X'),C(10)),p,4,B(PLUSEQ(V('GOT'),C('C')),GO(p,5))));p[4]=B(PLUSEQ(V('GOT'),C('D')),GO(p,5));p[5]=B(
NL(1),IF(NE(V('X'),C(10)),p,6,B(PLUSEQ(V('GOT'),C('E')),GO(p,7))));p[6]=B(PLUSEQ(V('GOT'),C('F')),GO(p,7));p[7]=B(
NL(1),IF(EQ(V('X'),C(10)),p,8,B(PLUSEQ(V('GOT'),C('G')),GO(p,9))));p[8]=IF(EQ(V('X'),C(10)),p,10,B(PLUSEQ(V('GOT'),C('H')),GO(p,9)));p[10]=B(PLUSEQ(V('GOT'),C('I')),GO(p,9));p[9]=B(
NL(1),IF(NE(V('X'),C(10)),p,11,B(PLUSEQ(V('GOT'),C('J')),GO(p,12))));p[11]=IF(EQ(V('X'),C(10)),p,13,B(PLUSEQ(V('GOT'),C('K')),GO(p,12)));p[13]=B(PLUSEQ(V('GOT'),C('L')),GO(p,12));p[12]=B(
NL(1),IF(NE(V('X'),C(10)),p,14,B(PLUSEQ(V('GOT'),C('M')),GO(p,15))));p[14]=IF(NE(V('X'),C(10)),p,16,B(PLUSEQ(V('GOT'),C('N')),GO(p,15)));p[16]=B(PLUSEQ(V('GOT'),C('O')),GO(p,15));p[15]=B(
NL(1),END(V('GOT'))); 

PROG(e,'IF_TEST',[],B(
NL(3),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('IF'),CALL(C(e),C('IF_PROG'),[C(10)]),C('ACFGKO')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('IF'),CALL(C(e),C('IF_PROG'),[C(5)]),C('BDEIJM')])
,NL(1),END())); 

PROG(e,'CASE_PROG',['X'],B(
NL(3),DECL('BI','X')
,NL(1),DECL('DS','GOT')
,NL(1),SET(V('GOT'),C(''))
,NL(1),CASE(V('X'),p,17,17)));p[17]=B(
NL(1),CASE(V('X'),p,18,19));p[18]=WHEN([C(10)],p,19,B(PLUSEQ(V('GOT'),C('A')),GO(p,19)));p[19]=B(
NL(1),CASE(V('X'),p,20,21));p[20]=WHEN([C(5),C(10)],p,22,B(PLUSEQ(V('GOT'),C('B')),GO(p,21)));p[22]=WHEN([C(20),C(30)],p,21,B(PLUSEQ(V('GOT'),C('C')),GO(p,21)));p[21]=B(
NL(1),END(V('GOT'))); 

PROG(e,'CASE_PROG2',['X'],B(
NL(3),DECL('BI','X')
,NL(1),DECL('DS','GOT')
,NL(1),SET(V('GOT'),C(''))
,NL(1),CASE(V('X'),p,23,24)));p[23]=WHEN([C(10)],p,25,B(PLUSEQ(V('GOT'),C('A')),GO(p,24)));p[25]=WHEN([],p,24,B(PLUSEQ(V('GOT'),C('B')),GO(p,24)));p[24]=B(
NL(1),CASE(V('X'),p,26,27));p[26]=WHEN([],p,27,B(PLUSEQ(V('GOT'),C('C')),GO(p,27)));p[27]=B(
NL(1),END(V('GOT'))); 

PROG(e,'CASE_TEST',[],B(
NL(3),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('CASE'),CALL(C(e),C('CASE_PROG'),[C(10)]),C('AB')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('CASE'),CALL(C(e),C('CASE_PROG'),[C(20)]),C('C')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('CASE'),CALL(C(e),C('CASE_PROG'),[C(25)]),C('')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('CASE'),CALL(C(e),C('CASE_PROG2'),[C(10)]),C('AC')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('CASE'),CALL(C(e),C('CASE_PROG2'),[C(25)]),C('BC')])
,NL(1),END())); 

e.ERROR_RESUME=B(
NL(3),RESUME()); 

e.ERROR_END=B(
NL(3),END(C('Z'))); 

e.ERROR_RECURSE=B(
NL(3),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('Error during error')]))
,NL(1),RESUME()); 

e.ERROR_SUB=B(
NL(3),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('T5')]))
,NL(1),RET()); 

PROG(e,'ERROR_PROG',['X'],B(
NL(3),DECL('BI','X')
,NL(1),DECL('DS','GOT')
,NL(1),SET(V('GOT'),C(''))
,NL(1),ONERRGO(C(e),'ERROR_RESUME')
,NL(1),IF(EQ(V('X'),C(1)),p,28,B(PLUSEQ(V('GOT'),C('A')),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('T1')])),PLUSEQ(V('GOT'),C('B')),GO(p,28)))));p[28]=B(
NL(1),ONERRGO(C(e),'ERROR_END')
,NL(1),IF(EQ(V('X'),C(2)),p,29,B(PLUSEQ(V('GOT'),C('C')),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('T2')])),PLUSEQ(V('GOT'),C('D')),GO(p,29))));p[29]=B(
NL(1),ONERRGO(C(e))
,NL(1),IF(EQ(V('X'),C(3)),p,30,B(PLUSEQ(V('GOT'),C('E')),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('T3')])),PLUSEQ(V('GOT'),C('F')),GO(p,30))));p[30]=B(
NL(1),ONERRGO(C(e),'ERROR_RECURSE')
,NL(1),IF(EQ(V('X'),C(4)),p,31,B(PLUSEQ(V('GOT'),C('G')),CALLJS('sync',C('x3-engine/lib/helpers'),'fail',A([C('T4')])),PLUSEQ(V('GOT'),C('H')),GO(p,31))));p[31]=B(
NL(1),ONERRGO(C(e))
,NL(1),IF(EQ(V('X'),C(5)),p,32,B(PLUSEQ(V('GOT'),C('I')),GOSUB(C(e),'ERROR_SUB'),PLUSEQ(V('GOT'),C('J')),GO(p,32))));p[32]=B(
NL(1),PLUSEQ(V('GOT'),C('K'))
,NL(1),END(V('GOT'))); 

e.ERROR_UNHANDLED=B(
NL(3),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),V('ERROR_MESSAGE'),C('UNHANDLED ERROR')])
,NL(1),RESUME()); 

PROG(e,'ERROR_TEST',[],B(
NL(3),DECL('DS','ERROR_MESSAGE')
,NL(1),ONERRGO(C(e),'ERROR_UNHANDLED')
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(0)]),C('K')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(1)]),C('ABK')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(2)]),C('Z')])
,NL(1),SET(V('ERROR_MESSAGE'),C('UNHANDLED ERROR'))
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(3)]),C('???')])

,NL(2),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(5)]),C('???')])
,NL(1),SET(V('ERROR_MESSAGE'),C(''))
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('ERROR'),CALL(C(e),C('ERROR_PROG'),[C(6)]),C('K')])
,NL(1),END())); 

PROG(e,'FACT_R',['N'],B(
NL(3),DECL('BI','N')
,NL(1),IF(GT(V('N'),C(1)),p,33,B(END(MUL(V('N'),CALL(C(e),C('FACT_R'),[SUB(V('N'),C(1))]))),GO(p,34))))); 
p[33]=B(NL(1),END(C(1)),GO(p,34)); 
p[34]=B(

);PROG(e,'FACT_W',['N'],B(
NL(4),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),WHILE(GT(V('N'),C(1)),p,35,B(MULEQ(V('R'),V('N')),MINUSEQ(V('N'),C(1))))));p[35]=B(
NL(1),END(V('R'))); 

PROG(e,'FACT_WB0',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),WHILE(GT(V('N'),C(1)),p,36,B(MULEQ(V('R'),V('N')),BREAK(p,C(0)),MINUSEQ(V('N'),C(1))))));p[36]=B(
NL(1),END(V('R'))); 

PROG(e,'FACT_WB1',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),WHILE(C(1),p,37,B(MULEQ(V('R'),V('N')),BREAK(p,LE(V('N'),C(1))),MINUSEQ(V('N'),C(1))))));p[37]=B(
NL(1),END(V('R'))); 

PROG(e,'FACT_U',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),WHILE(LE(V('N'),C(1)),p,38,B(MULEQ(V('R'),V('N')),MINUSEQ(V('N'),C(1))),true)));p[38]=B(
NL(1),END(V('R'))); 

PROG(e,'FACT_F',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),FORV('I',C(1),V('N'),null,p,39,B(MULEQ(V('R'),V('I'))))));p[39]=B(
NL(1),END(V('R'))); 

PROG(e,'FACT_L',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('DI','R')
,NL(1),SET(V('R'),C(1))
,NL(1),FORIN('I',[C(6),C(2),C(10)],p,40,B(MULEQ(V('R'),V('I'))))));p[40]=B(
NL(1),END(V('R'))); 

PROG(e,'LOOP_TEST',[],B(
NL(3),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_R'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_W'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_WB0'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_WB1'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_U'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_F'),[C(5)]),C(120)])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('LOOP'),CALL(C(e),C('FACT_L'),[C(5)]),C(120)])
,NL(1),END())); 

PROG(e,'SCOPES_SUB',['P1','P2'],B(
NL(3),DECL('BS','P1'),DECL('BS','P2')
,NL(1),DECL('LS','LTEST')
,NL(1),SET(V('GTEST'),V('P1'))
,NL(1),SET(V('LTEST'),V('P2'))
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('SCOPES SUB L'),V('LTEST'),C('D')])
,NL(1),END())); 

PROG(e,'SCOPES_TEST',[],B(
NL(3),DECL('VS','GTEST')
,NL(1),DECL('LS','LTEST')
,NL(1),SET(V('GTEST'),C('A'))
,NL(1),SET(V('LTEST'),C('B'))
,NL(1),CALL(C(e),C('SCOPES_SUB'),[C('C'),C('D')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('SCOPES G'),V('GTEST'),C('C')])
,NL(1),CALL(REQ(r,C('XUNIT')),C('CHECK_EQUAL'),[C('SCOPES L'),V('LTEST'),C('B')])

,NL(2),END())); 

PROG(e,'WRSEQ_TEST',[],B(
NL(3),OPEN('',C('/tmp/factorials.txt'),'w')
,NL(1),DECL('DI','N')
,NL(1),SET(V('N'),C(1))
,NL(1),WHILE(LT(V('N'),C(3)),p,41,B(WRSEQ('',A([V('N'),CALL(C(e),C('FACT_R'),[V('N')])])),PLUSEQ(V('N'),C(1))))));p[41]=B(
NL(1),CLOSE('')
,NL(1),END()); 

PROG(e,'LOP',['N'],B(
NL(3),DECL('BI','N')
,NL(1),DECL('LI','I')
,NL(1),SET(V('I'),V('N'))
,NL(1),WHILE(GT(V('I'),C(0)),p,42,B(
NL(1),MINUSEQ(V('I'),C(1))
))));p[42]=B(
NL(2),END(V('I'))); 
