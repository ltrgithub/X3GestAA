$TC_SNAPSHOT_ERR
OK = 1
Resume

Subprog CHECK_OBJECT_00(INS)
Call CHECK_EQUAL( "CHECK_OBJECT_00", "CHECK_OBJECT_00" )  From AXUNIT
Call CHECK_EQUAL( INS.C03P01, "5" )  From AXUNIT
Call CHECK_EQUAL( INS.C03P01.$isHidden,CST_ATRUE )  From AXUNIT
Call CHECK_EQUAL( maxtab(INS.COL),2) From AXUNIT
Call CHECK_EQUAL( INS.COL(1).C03P02,11)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02,12)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02.$isHidden, CST_ATRUE)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02.$filename, "$filename 11")  From AXUNIT
Return

$TC_SNAPSHOT_SETUP
Local Instance INS Using C_AQCPROC03
Local Integer LINE
Local Integer ASTATUS
INS = NewInstance C_AQCPROC03

INS.C03P01  = "5"
INS.C03P01.$isHidden  = CST_ATRUE

#Add 2 lines :
LINE = Fmet INS.COL.AADD(CST_ALASTPOS)
Call CHECK_EQUAL(LINE,1) From AXUNIT
INS.COL(LINE).C03P02 = 10+LINE

LINE = Fmet INS.COL.AADD(CST_ALASTPOS)
Call CHECK_EQUAL(LINE,2) From AXUNIT
INS.COL(LINE).C03P02 = 10+LINE
INS.COL(LINE).C03P02.$isHidden = CST_ATRUE
INS.COL(LINE).C03P02.$filename = "$filename 11"

Call CHECK_OBJECT_00(INS)

Return 


$TC_SNAPSHOT_00
Local integer ISHIDDEN
Local Integer OK
OK = 0
If (INS.snapshot =  null)
  OK = 1
Endif
Call CHECK_EQUAL(OK,1)  From AXUNIT

# Let's try to get an attribute of a disabled snapshot
Onerrgo TC_SNAPSHOT_ERR
ISHIDDEN = INS.snapshot.C03P01.$isHidden
Call CHECK_EQUAL( OK,1)  From AXUNIT
Onerrgo
Return


$TC_SNAPSHOT_01
Local Integer OK
OK = 0
If (INS.snapshot <>  null)
  OK = 1
Endif
Call CHECK_EQUAL(OK,1)  From AXUNIT
Return


$TC_SNAPSHOT_02
#Check the initial status :
Call CHECK_OBJECT_00(INS)


# Modify the instance:
INS.C03P01 = "6"
INS.C03P01.$isHidden  = CST_AFALSE
INS.COL(1).C03P02 = 20
INS.COL(2).C03P02.$filename = "$filename 21"
INS.COL(2).C03P02.$isHidden = CST_AFALSE

# Check the instance
Call CHECK_EQUAL( maxtab(INS.COL),2) From AXUNIT
Call CHECK_EQUAL( INS.C03P01, "6" )  From AXUNIT
Call CHECK_EQUAL( INS.C03P01.$isHidden,CST_AFALSE)  From AXUNIT
Call CHECK_EQUAL( INS.COL(1).C03P02,20)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02.$isHidden, CST_AFALSE)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02.$filename, "$filename 21")  From AXUNIT

# Check the snapshot
Call CHECK_OBJECT_00(INS.snapshot)

## Add 1 line
LINE = Fmet INS.COL.AADD(CST_ALASTPOS)
INS.COL(LINE).C03P02 = 10+LINE

Call CHECK_EQUAL(maxtab(INS.COL),3) From AXUNIT
Call CHECK_EQUAL(LINE,3) From AXUNIT
Call CHECK_EQUAL(INS.COL(1).C03P02,20)  From AXUNIT
Call CHECK_EQUAL(INS.COL(2).C03P02,12)  From AXUNIT
Call CHECK_EQUAL(INS.COL(3).C03P02,13)  From AXUNIT

# Check the snapshot
Call CHECK_OBJECT_00(INS.snapshot)

#remove the first line :
ASTATUS = fmet INS.COL.ADEL(1)
Call CHECK_EQUAL(maxtab(INS.COL),2) From AXUNIT
Call CHECK_EQUAL(INS.COL(1).C03P02,12)  From AXUNIT
Call CHECK_EQUAL(INS.COL(2).C03P02,13)  From AXUNIT

# Check the snapshot
Call CHECK_OBJECT_00(INS.snapshot)

Return

$TC_SNAPSHOT_03
#Check the initial status :
Call CHECK_OBJECT_00(INS)

# Check the snapshot
Call CHECK_OBJECT_00(INS.snapshot)

# Modify the instance:
INS.COL(2).C03P02 = 101
INS.COL(2).C03P02.$filename = "$filename 21"
Call CHECK_EQUAL( INS.COL(2).C03P02, 101)  From AXUNIT
Call CHECK_EQUAL( INS.COL(2).C03P02.$filename, "$filename 21")  From AXUNIT

# Check the snapshot
Call CHECK_OBJECT_00(INS.snapshot)
Return


$TC_SNAPSHOT_99
Local Integer OK
#Let's try to change snapshotEnabled:
Onerrgo TC_SNAPSHOT_ERR
INS.snapshotEnabled = CST_ATRUE
Onerrgo
Call CHECK_EQUAL( OK,1)  From AXUNIT
Return

$TC_SNAPSHOT_TEARDOWN
FreeInstance INS
Return