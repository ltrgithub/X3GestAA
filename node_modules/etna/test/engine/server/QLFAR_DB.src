Call OUVRE_TRACE("QLFAR_DB") From LECFIC
Call TESTSUITE()

Call FERME_TRACE From LECFIC

GTRACE = "QLFAR_DB_"+GACTX.USER
Call LEC_TRACE From LECFIC
End

$ERROR
Call CHECK_EQUAL(errn, EX) From AXUNIT
If errn<>EX
Call CHECK_EQUAL(errp-"("+num$(errl)+")"+"\"+mess(6,123,1)-num$(errn)-":"-errmes$(errn)+"\"+errm,"") From AXUNIT
Endif
Resume


Funprog TESTSUITE()
Call TESTSUITE_START("AQCQRY01", "AQCQRY01") From AXUNIT

Call ADD_TESTCASE("TC_AQCQRY01_CLEAN","TC_AQCQRY01_CLEAN",5) From AXUNIT
Call ADD_TESTCASE("TC_AQCQRY01_SETUP","TC_AQCQRY01_SETUP",5) From AXUNIT

Local Clbfile  SUITE_RESULT
SUITE_RESULT = func AXUNIT.RUN_TESTSUITE("CONTEXT", "CONTEXT")
End SUITE_RESULT


Subprog TC_AQCQRY01_CLEAN
Local Integer EX
Onerrgo ERROR
Local File AQCQRY01   [AQQ01]
Call CHECK_EQUAL("Open AQCQRY01","Open AQCQRY01") From AXUNIT

Trbegin [AQQ01]
Call CHECK_EQUAL("Trbegin AQCQRY01","Trbegin AQCQRY01") From AXUNIT

Delete [AQQ01] Where 1=1
Call CHECK_EQUAL("Delete AQCQRY01","Delete AQCQRY01") From AXUNIT

Commit
Call CHECK_EQUAL("Commit AQCQRY01","Commit AQCQRY01") From AXUNIT

Close Local File [AQQ01]
Call CHECK_EQUAL("Close AQCQRY01","Close AQCQRY01") From AXUNIT
End

Subprog TC_AQCQRY01_SETUP
Local Integer EX,I,J
Onerrgo ERROR

Local File AQCQRY01   [AQQ01]
Call CHECK_EQUAL("Open AQCQRY01","Open AQCQRY01") From AXUNIT

Trbegin [AQQ01]
Call CHECK_EQUAL("Trbegin AQCQRY01","Trbegin AQCQRY01") From AXUNIT

Delete [AQQ01] Where 1=1
Call CHECK_EQUAL("Delete AQCQRY01","Delete AQCQRY01") From AXUNIT

For I=1 To 100
 J = 1+mod(I-1,10)
 [AQQ01]FIELD01 = "F1_" + format$("N0:3",I)
 [AQQ01]FIELD02 = "F2_" + format$("N0:3",J)
 Case J
  When 1 : [AQQ01]ACCESS = "AQCACS1"
  When 2 : [AQQ01]ACCESS = "AQCACS2"
  When Default : [AQQ01]ACCESS = "-"
 Endcase
 Write [AQQ01]
Next I

Commit
Call CHECK_EQUAL("Commit AQCQRY01","Commit AQCQRY01") From AXUNIT

Close Local File [AQQ01]
Call CHECK_EQUAL("Close AQCQRY01","Close AQCQRY01") From AXUNIT
End

