"use strict";

function unwrap(fn) {
    return function(_: _,  ...args) {
        return fn.apply(this, args);
    }
};

class Wrapper {
    constructor(reader) {
        this.reader = reader;
    }
    read() {
        return this.reader.read['fiberized-0'].call(this.reader, true);
    }
    stop(arg) {
        return this.reader.stop['fiberized-0'].call(this.reader, true, arg);
    }
    forEach(fn) {
       return this.reader.forEach['fiberized-0'].call(this.reader, true, unwrap(fn));
    }
    map(fn) {
        return new Wrapper(this.reader.map(unwrap(fn)));
    }
    limit(n) {
        return new Wrapper(this.reader.limit(n));
    }
}

module.exports = function(reader) {
    return new Wrapper(reader);
}