"use strict";

const glob = require('streamline/lib/globals');
const generic = require('ez-streams').devices.generic;
import * as util from './util';
import * as basic from './basic';
import * as arrays from './arrays';
import * as variables from './variables';

module.exports = {
	reader(vtb, key, nat) {
		const names = Object.keys(vtb.values);
		const guide = key.guide;

		return generic.reader(function (_: _) {
			var pos = vtb.curpos[nat];
			vtb.curpos.curr = nat;
			if (pos < vtb.lines) {
				var row = {};
				for (var i = 0; i < names.length; i++) {
					row[names[i]] = arrays.instructions.INDEX(vtb.tables[i], [basic.instructions.C(guide[pos] + vtb.bases[i])])(_);
				}
				pos += 1;
				vtb.curpos[nat] = pos;
				return row;
			}
			vtb.curpos[nat] = -1;
			return undefined;
		}, function stop(_: _) {});
	}
};