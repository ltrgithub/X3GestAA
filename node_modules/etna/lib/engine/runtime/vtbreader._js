"use strict";

var generic = require('ez-streams').devices.generic;
var arrays = require('./arrays');
var util = require('./util');


module.exports = {
	reader: function( vtb, key, nat ) {
		var names = Object.keys(vtb.values) ;
		var guide = key.guide ;

		return generic.reader(function(_) {
			var pos = vtb.curpos[nat];
			vtb.curpos.curr = nat ;
			if (pos < vtb.lines) {
				var row = {};
				for (var i = 0; i < names.length; i++)
					row[names[i]] = arrays.instructions.INDEX(vtb.tables[i], [util.instructions.C( guide[pos]+vtb.bases[i])])(_);

				pos += 1;
				vtb.curpos[nat] = pos ;				
				return row;
			}
			vtb.curpos[nat] = -1 ;
			return undefined;
		}, function stop(_) {

		});
	},
};