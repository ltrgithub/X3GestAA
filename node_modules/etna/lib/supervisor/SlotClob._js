"use strict";

var util = require('util');
var Clbfile = require('etna/lib/engine/runtime/tclbfile').Clbfile;
var SlotLob = require("etna/lib/supervisor/slotlob").SlotLob;

class SlotClob extends SlotLob {
	constructor(parent, property) {
		super(parent, property);
	}

	_set(_, value, raw) {
		if (value !== undefined && value instanceof Buffer) {
			value = new Clbfile(value.toString());
		}
		return super._set(_, value, raw);
	}

	_get(_,raw) {
		if(raw) return "";// For resource.toJson  
		
		if(!this._value) {
			var data = this.read(_);
			this._value = (typeof data === 'string') ? new Clbfile(data) : data;
		}
		return super._get(_,raw);
	}

}

exports.SlotClob = SlotClob;

exports.newSlotClob = function(property) {
	return function(_, parent) {
		return new SlotClob(parent, property);
	};
};
