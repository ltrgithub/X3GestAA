import { _ } from 'streamline-runtime';
const db = require("etna/lib/engine/runtime/db");
const glob = require('streamline/lib/globals');
const tracerJs = require('syracuse-core').getTracer("etna.dbms");

export class Transaction {
	inProgress: boolean;
	constructor() {
		this.inProgress = false;
	}
	begin(_: _) {
		const frame = glob.context.x3frame;

		if (frame.context.sys.values.ADXLOG === 0) {
			db.instructions.TRBEGIN()(_);
			tracerJs.debug && tracerJs.debug("begin Transaction");
			this.inProgress = true;
		} else {
			this.inProgress = false;
		}
	}
	commit(_: _) {
		if (this.inProgress) {
			db.instructions.COMMIT()(_);
			tracerJs.debug && tracerJs.debug("commit Transaction");
			this.inProgress = false;
		}
	}
	rollback(_: _) {
		if (this.inProgress) {
			db.instructions.ROLLBACK()(_);
			tracerJs.debug && tracerJs.debug("rollback Transaction");
			this.inProgress = false;
		}
	}
}