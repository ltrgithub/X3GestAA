"use strict";

var util = require("etna/lib/supervisor/util");

exports.constructor = util.defineClass(function(superv, table, data) {
	this.supervisor = superv;
	this.table = table;
	this.data = data;
}, null, {
	init: function(_) {
		this.direction = [];
		this.columns = [];

		var names0 = this.data.DESCRIPT.split('+');
		for (var i = 0; i < names0.length; i++) {
			var names1 = names0[i].split('-');
			this.direction.push(1);
			this.columns.push(this.table.column(names1[0]));

			if (names1.length > 1) {
				this.direction.push(1);
				this.columns.push(this.table.column(names1[0]));
				for (var j = 1; j < name1.length; j++) {
					this.direction.push(-1);
					this.columns.push(this.table.column(names1[j]));
				}
			}
		}
		return this;
	},
	name: {
		get: function() {
			return this.data.CODIND;
		}
	},
	unique: {
		get: function() {
			return (this.data.HOMONYM === 1) ? true : false;
		}
	},
	hasColumn: function(name) {
		return this.columns.some(function(elt) {
			return elt.name === name;
		});
	},
	sqlNames: function() {
		return this.columns.map(function(elt) {
			return elt.name + '_0';
		});
	},
	keyExpression: function(_) {
		return this.columns.map(function(elt) {
			return '{' + elt.name + '}';
		}).join('~');
	},
});