"use strict";

var util = require("etna/lib/supervisor/util");

exports.constructor = util.defineClass(function(superv, table, data) {
	this.supervisor = superv;
	this.table = table;
	this.data = data;
}, null, {
	init: function(_) {
		this.direction = [];
		this.columns = [];

		var addColumn = function(self, name,direction) {
			if(name) {
				var column = self.table.column(name);
				if(column) {
					self.direction.push(direction);		
					self.columns.push(column);				
				}
			}
		}

		var match = this.data.DESCRIPT.match(/[-+]?\w+/g);
		if (match) {
			for (var i = 0; i < match.length; i++) {
				var name = match[i];
				switch (name.charAt(0)) {
					case '+': addColumn(this,name.substring(1), 1); break;
					case '-': addColumn(this,name.substring(1),-1); break;
					default:  addColumn(this,name             , 1); break;
				}
			}
		}
		return this;
	},
	name: {
		get: function() {
			return this.data.CODIND;
		}
	},
	unique: {
		get: function() {
			return (this.data.HOMONYM === 1) ? true : false;
		}
	},
	hasColumn: function(name) {
		return this.columns.some(function(elt) {
			return elt.name === name;
		});
	},
	sqlNames: function() {
		return this.columns.map(function(elt) {
			return elt.name + '_0';
		});
	},
	keyExpression: function(_) {
		return this.columns.map(function(elt) {
			return '{' + elt.name + '}';
		}).join('~');
	},
});