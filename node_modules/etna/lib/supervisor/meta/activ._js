"use strict";

const util = require("etna/lib/supervisor/util");
const Helper = util.Helper;
const date = require('syracuse-core').types.date;
const bcd = require('etna/lib/engine/runtime/bcd');
const uuid = require('etna/lib/engine/runtime/uuid');
const tuuid = require('etna/lib/engine/runtime/tuuid');
const datetime = require('syracuse-core').types.datetime;
const variables = require('etna/lib/engine/runtime/variables');

class Activ extends Helper {
	constructor(superv, data) {
		super();
		this.supervisor = superv;
		this.data = data;
	}
	init(_) {
		return this;
	}
};

module.exports = {
	collectionName: 'ACTIV',
	keyName: 'CODACT',
	constructor: Activ,
	// end of constructor
	getActiv(_, supervisor, cod) {
		if (!cod || cod === '') return 1;
		const activ = supervisor.load(_, 'Activ', cod);
		//if (!activ) return 0;  //  GH 6167
		//if (!activ) return 1; // GH 6167

		if (activ === undefined || activ === null) return 1;
		if (activ.data.FLACT !== 2) return 0;
		else if (activ.data.TYP === 2) return activ.data.DIME;
		else return 1;
	},
	dimension: {
		get() {
			if (activ.data.DIMFIL > 0 && activ.data.DIME > 0 && activ.data.DIMMAX > 0) {
				return Math.min(Math.max(activ.data.DIMFIL, activ.data.DIME), activ.data.DIMMAX);
			} else if (activ.data.DIMFIL > 0 && activ.data.DIME > 0) {
				return Math.max(activ.data.DIMFIL, activ.data.DIME);
			} else if (activ.data.DIMFIL > 0) {
				return activ.data.DIMFIL;
			}
			return 0;
		}
	}
};