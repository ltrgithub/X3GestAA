import { _ } from 'streamline-runtime';
import * as runtimeUtil from '../../engine/runtime/util';
import { QueryParams } from '../../engine/runtime/types';
import * as ez from 'ez-streams';
import * as fs from 'fs';
import * as fileio from '../../engine/runtime/fileio';
const filpath = fileio.functions.FILPATH.fn;

exports.AQUERY = function (_: _,  select: QueryParams) {
	const superv = runtimeUtil.currentFrame().context.superv;
	const volume = select.$params && select.$params.VOLUME || "TMP";
	const instance = superv.newInstance(_, "AVOLUME");
	const status = instance.AREAD(_, volume);
	const root = instance.get(_, "ROOT");
	const path = filpath(_, root, "", "");

	return fs.readdir(path, _).map(entry => {
		return {
			VOLUME: volume,
			FULLNAME: entry.toUpperCase()
		};
	});
};