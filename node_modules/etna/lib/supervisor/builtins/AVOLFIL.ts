"use strict";

const glob = require('streamline/lib/globals');
import * as ez from 'ez-streams';
import * as fs from 'fs';
const filpath = require('etna/lib/engine/runtime/fileio').functions.FILPATH.fn;

exports.AQUERY = function (_: _,  select) {
	const superv = glob.context.x3frame.context.superv;
	const volume = select.$params && select.$params.VOLUME || "TMP";
	const instance = superv.newInstance(_, "AVOLUME");
	const status = instance.AREAD(_, volume);
	const root = instance.get(_, "ROOT");
	const path = filpath(_, root, "", "");

	return fs.readdir(path, _).map(entry => {
		return {
			VOLUME: volume,
			FULLNAME: entry.toUpperCase()
		};
	});
};