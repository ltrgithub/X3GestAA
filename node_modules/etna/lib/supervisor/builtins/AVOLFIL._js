"use strict";

var glob = require('streamline/lib/globals');
var ez = require("ez-streams");
var fs = require('streamline-fs');

var filpath = require('etna/lib/engine/runtime/fileio').functions.FILPATH.fn;

exports.AQUERY = function(_, select) {
	var superv = glob.context.x3frame.context.superv;

	var volume = (select.$params && select.$params.VOLUME) || "TMP";
	var instance = superv.newInstance(_, "AVOLUME");
	var status = instance.AREAD(_, volume);
	var root = instance.get(_, "ROOT");
	var path = filpath(_, root, "", "");

	return fs.readdir(path, _).map(function(entry) {
		return {
			VOLUME: volume,
			FULLNAME: entry.toUpperCase()
		};
	});
};