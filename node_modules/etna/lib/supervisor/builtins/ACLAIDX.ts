import { _ } from 'streamline-runtime';
import { QueryParams} from '../../engine/runtime/types';
import * as util from '../../engine/runtime/util';
import * as ez from 'ez-streams';

exports.AQUERY = function (_: _,  select: QueryParams) {
	const superv = util.currentFrame().context.superv;
	const orderBy = select && select.$orderBy ? select.$orderBy : {
		CODCLA: 1
	};
	const filter = select ? select.$orderBy ? select.$query || {} : select : {};
	const coln = superv.mongoStore.collection("ACLASSE").find(filter).sort(orderBy);

	return ez.devices.generic.reader(function (_: _) {
		const record = coln.next().then(_, _);

		if (record) {
			record.UPDDATTIM = null;
		}
		// Make sure to return undefined for the last record
		return record || undefined;
	});
};