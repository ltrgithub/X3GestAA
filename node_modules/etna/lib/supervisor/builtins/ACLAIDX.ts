import { _ } from 'streamline-runtime';
import * as types from '../../engine/runtime/types';
const glob = require('streamline/lib/globals');
import * as ez from 'ez-streams';

exports.AQUERY = function (_: _,  select: types.QueryParams) {
	const superv = glob.context.x3frame.context.superv;
	const orderBy = select && select.$orderBy ? select.$orderBy : {
		CODCLA: 1
	};
	const filter = select ? select.$orderBy ? select.$query || {} : select : {};
	const coln = superv.mongoStore.collection("ACLASSE", _).find(filter).sort(orderBy);

	return ez.devices.generic.reader(function (_: _) {
		const record = coln.nextObject(_);

		if (record) {
			record.UPDDATTIM = null;
		}
		// Make sure to return undefined for the last record
		return record || undefined;
	});
};