"use strict";

var glob = require('streamline/lib/globals');
var ez = require("ez-streams");

exports.AQUERY = function(_, select) {
	var superv = glob.context.x3frame.context.superv;

	var orderBy = (select && select.$orderBy) ? select.$orderBy : {
		CODCLA: 1
	};
	var filter = select ? (select.$orderBy ? (select.$query || {}) : select) : {};

	var coln = superv.mongoStore.collection("ACLASSE", _).find(filter).sort(orderBy);
	return ez.devices.generic.reader(function(_) {
		var record = coln.nextObject(_);
		if (record) {
			record.UPDDATTIM = null;
		}
		// Make sure to return undefined for the last record
		return record || undefined;
	});
};