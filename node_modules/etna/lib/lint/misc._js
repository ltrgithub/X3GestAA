"use strict";

const glob = require('streamline/lib/globals');
import * as util from './util';

exports.instructions = {
	CALLJS(mode, ns, name, args) {
		const loc = util.sourceLoc;

		return function calljs$do(_) {
			const lint = glob.context.lint;
			const nsVal = ns(_);

			var mod;
			try {
				mod = require(nsVal);
				if (!mod[name]) lint.addDiagnose("error", "function " + name + " not found", loc);
			} catch (ex) {
				lint.addDiagnose("error", "module " + nsVal + " not found", loc);
			}
			args(_);
		};
	},
	BOX(kind, args) {
		const aargs = args ? util.instructions.A(args) : null;

		return function log$do(_) {
			aargs && aargs(_);
		};
	},

	CLOSEMESBOX() {
		return function closemesbox$do(_) {
			//compilation compatibility
		};
	},

	DBGETNA(args) {
		const aargs = args ? util.instructions.A(args) : null;

		return function dbg$do(_) {
			aargs && aargs(_);
		};
	},

	SLEEP(args) {
		const aargs = args ? util.instructions.A(args) : null;

		return function sleep$do(_) {
			aargs && aargs(_);
		};
	}
};