var EventEmitter = require('events').EventEmitter;
var helpers = require("syracuse-core/lib/helpers");
var sessionStub = require("./sessionManagerStub").sessionManager;

function Client() {
	var self = this;
	self.sessionId = helpers.uuid.generate();
}
helpers.defineClass(Client, EventEmitter, {
	send : function(message) {
		var self = this;
		self.emit("send", message);
	}
});

var _connectionObserver = null;
exports.listen = function() {
	return {
		on : function(event, callback) {
			_connectionObserver = callback;
		}
	};
};

exports._reset = function() {
	_connectionObserver = null;
	sessionStub._session._reset();
};

exports._addClient = function(user) {
	var client = new Client();
	sessionStub._session.setData("user", user);
	_connectionObserver(client);
	return client;
};