"use strict";

/*
 Copyright (c)2012 Sage.
 http://wwww.sage.com
 */
/**
 * @fileoverview Printer selection/configuration resources
 */
 
var locale = require('syracuse-core/lib/locale');
var _resource = null;


function _getPage(pageN) {
    if (!_resource) {
        _resource = locale.resources(module)();
    }
    if(!_kProto[pageN].$localization)  {
        _kProto[pageN].$localization = _resource;
    }
    return _kProto[pageN]; 
}

exports.helpers = {
    "applyCapabilities": function (boundFields, printerRcd){
        var i, len, cap = printerRcd.$capabilities ? printerRcd.$capabilities.split(",") : null;
        var capSupported = ["collate", "copies", "orientation", "duplex"];
        if(boundFields && cap) {
            for(i = 0, len = capSupported.length; i < len; i++) {
                if(boundFields[capSupported[i]]) {
                    boundFields[capSupported[i]][0].setState({"$isReadOnly": cap.indexOf(capSupported[i]) >= 0 ? false : true});
                }
            }
        }
    },
    "getDefaultPrinterRcd": function(boundFields) {
        var prt;
        return boundFields && (prt = boundFields["printers"]) && prt[0].dataset.length > 0 ? prt[0].dataset[0] : {"name": ""};
    },
    "getPrinterName": function(rcd) {
        return rcd.name;
    }
};

exports.getSetupPage = function (dummy){
    return _getPage("setup");
};

exports.getPropertiesPage = function (dummy){
   return _getPage("properties");
};

var _kProto = {
    "properties": {
        "$type": "application/json",
        "$title": "{@properties_page_title}",
        "$properties": {
            "paperSize": {
                "$type": "application/x-choice",
                "$format": "$combo",
                "$title": "{@properties_fld_psize}",
                "$capabilities": ""
            },
            "paperSource": {
                "$title": "{@properties_fld_psource}",
                "$type": "application/x-choice",
                "$format": "$combo",
                "$capabilities": ""
            },
            "copies": {
                "$type": "application/x-integer",
                "$title": "{@properties_fld_copies}",
                "$capabilities": ""
            },
            "orientation": {
                "$type": "application/x-choice",
                "$format": "$radios",
                "$value": {
                    "$type": "application/x-integer",
                    "$enum": [
                        {
                            "$value": 0,
                            "$title": "{@properties_fld_ort_P}"
                        },
                        {
                            "$value": 1,
                            "$title": "{@properties_fld_ort_L}"
                        }
                    ]
                },
                //"$title": "{@properties_fld_ort}",
                "$capabilities": ""
            },
            "duplex": {
                "$type": "application/x-choice",
                "$value": {
                    "$type": "application/x-integer",
                    "$enum": [
                        {
                            "$value": 0,
                            "$title": "{@properties_fld_dplx_none}"
                        },
                        {
                            "$value": 1,
                            "$title": "{@properties_fld_dplx_short}"
                        },
                        {
                            "$value": 2,
                            "$title": "{@properties_fld_dplx_long}"
                        }
                    ]
                },
                "$format": "$radios",
                //"$title": "{@properties_fld_dplx}",
                "$capabilities": ""
            }
        },
        "$links": {
            "$save": {
                "$title": "{@properties_link_ok}",
                "$method": "POST"
            },
            "$cancel": {
                "$title": "{@properties_link_cancel}",
                "$method": "POST"
            }
        },
        "$article": {
           "$category": "section",
            "$layout": {
                "$layoutType": "stack",
                "$items": [
                    {
                        "$category": "block",
                        "$layout": {
                            "$items": [
                                {
                                    "$layoutType": "stack",
                                    "$items": [
                                        {
                                            "$bind": "paperSize"
                                        },
                                        {
                                            "$bind": "paperSource"
                                        },
                                        {
                                            "$bind": "copies"
                                        }
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        "$category": "block",
                        "$title": "{@properties_blck_ort}",
                        "$layout": {
                            "$items": [
                                {
                                    "$layoutType": "stack",
                                    "$items": [
                                        {
                                            "$bind": "orientation"
                                        }
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        "$category": "block",
                        "$title": "{@properties_blck_dpx}",
                        "$layout": {
                            "$items": [
                                {
                                    "$layoutType": "stack",
                                    "$items": [
                                        {
                                            "$bind": "duplex"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        }
    },
    "setup": {
    	"$type": "application/json",
    	"$title": "{@setup_page_title}",
        "$properties": {
            "printers": {
                "$type": "application/x-array",
                "$capabilities": "sort",
                "$item": {
                    "$properties": {
                        "name": {
                            "$title": "{@setup_fld_name}",
                            "$type": "application/x-string",
                            "$capabilities": "",
                            "$isFixed": true,
    						"$isReadOnly":true
                        },
                        "port": {
                            "$type": "application/x-string",
                            "$title": "{@setup_fld_port}",
                            "$capabilities": "",
    						"$isReadOnly":true
                        },
                        "driver": {
                            "$type": "application/x-string",
                            "$title": "{@setup_fld_driver}",
                            "$capabilities": "",
    						"$isReadOnly":true
                        },
                        "comment": {
                            "$type": "application/x-string",
                            "$title": "{@setup_fld_comment}",
                            "$capabilities": "",
    						"$isReadOnly":true
                        },
                        "location": {
                            "$type": "application/x-string",
                            "$title": "{@setup_fld_location}",
                            "$capabilities": "",
    						"$isReadOnly":true
                        },
                        "devmode": {
                            "$type": "application/x-string",
                            "$title": "{@setup_fld_devmode}",
                            "$capabilities": "",
    						"$isReadOnly":true,
    						"$isHidden": true
                        }
    				},
    				"$links": {
                        "$properties": {
                            "$title": "{@setup_mnu_prop}",
                            "$method": "POST"
                        }
                    }
    			}
    		},
            "orientation": {
                "$type": "application/x-choice",
                "$format": "$radios",
                "$value": {
                    "$type": "application/x-integer",
                    "$enum": [
                        {
                            "$value": 0,
                            "$title": "{@setup_fld_ort_P}"
                        },
                        {
                            "$value": 1,
                            "$title": "{@setup_fld_ort_L}"
                        }
                    ]
                },
                //"$title": "{@setup_fld_ort}",
                "$isHidden": true,
                "$capabilities": ""
            },
    		"collate": {
    			"$type": "application/x-boolean",
    			"$title": "{@setup_fld_collate}",
    			"$capabilities": ""
    		},
    		"collateIco": {
    			"$type": "application/x-icon",
    			"$url": "",
    			"$isReadOnly":true
    		},
    		"allPages": {
    			"$type": "application/x-choice",
    			"$format": "$radios",
    			"$value": {
    				"$type": "application/x-integer",
    				"$enum": [
    					{
    						"$value": 1,
    						"$title": "{@setup_fld_pg_pages}"
    					},
                        {
                            "$value": 0,
                            "$title": "{@setup_fld_pg_all}"
                        }
    				]
    			},
    			"$title": "{@setup_fld_pg}",
    			"$capabilities": ""
    		},
    		"copies": {
    			"$type": "application/x-integer",
    			"$title": "{@setup_fld_copies}",
    			"$capabilities": ""
    		},
    		"startpage": {
    			"$type": "application/x-integer",
    			"$title": "{@setup_fld_pgstart}",
    			"$capabilities": ""
    		},
    		"stoppage": {
    			"$type": "application/x-integer",
    			"$title": "{@setup_fld_pgstop}",
    			"$capabilities": ""
    		},
    		"capabilities": {
    			"$type": "application/x-string",
    			"$capabilities": "",
    			"$isReadOnly": true,
    			"$isHidden": true
    		}
        },
        "$links": {
    		"$save": {
                "$title": "{@setup_link_ok}",
                "$method": "POST"
            },
            "$cancel": {
                "$title": "{@setup_link_cancel}",
                "$method": "POST"
            }
        },
    	"$article": {
    	   "$category": "section",
    		"$layout": {
                "$layoutType": "stack",
                "$items": [
                    {
                        "$category": "block",
                        "$title": "{@setup_blck_printers}",
                        "$layout": {
                            "$items": [
                                {
                                    "$layoutType": "stack",
                                    "$items": [
                                        {
                                            "$bind": "printers"
                                        }
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        "$layoutType": "row",
                        "$items": [
                            {
                                "$category": "block",
                                "$title": "{@setup_blck_pages}",
                                "$layout": {
                                    "$items": [
                                        {
                                            "$layoutType": "row",
                                            "$items": [
                                                {
                                                    "$bind": "allPages",
                                                    "$choiceLayout": "row"
                                                },
                                                {
                                                    "$bind": "startpage"
                                                },
                                                {
                                                    "$bind": "stoppage"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            },
                            {
                                "$category": "block",
                                "$title": "{@setup_blck_copies}",
                                "$layout": {
                                    "$items": [
                                        {
                                            "$layoutType": "row",
                                            "$items": [
                                                {
                                                    "$bind": "copies"
                                                },
												{
                                                    "$bind": "collateIco"
                                                },
                                                {
                                                    "$bind": "collate"
                                                },
                                                {
                                                    "$bind": "orientation"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                ]
            }
    	}
    }
};
