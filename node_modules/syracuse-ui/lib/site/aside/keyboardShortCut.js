"use strict";
var helpers = require('syracuse-core/lib/helpers');

var _keyboardMap = {
	"tab":9,
	"home":36,
	"pageup" : 33,
	"pagedown":34,
	"f5" :116,
	a:65,
	b:66,
	c:67,
	d:68,
	e:69,
	f:70,
	g:71,
	h:72,
	i:73,
	j:74,
	k:75,
	l:76,
	m:77,
	n:78,
	o:79,
	p:80,
	q:81,
	r:82,
	s:83,
	t:84,
	u:85,
	v:86,
	w:87,
	x:88,
	y:89,
	z:90 
};
exports.applyKeyboardShortCut= function(targetField,isFusion,keysDown){
	// retrieve $prototype on menu 
	//

	var bodypage = document.site;
	if(keysDown.length>=2 && keysDown.indexOf(_keyboardMap['tab'])!==-1){
		if( keysDown.indexOf(_keyboardMap['p'])!==-1){
			applyMenuAction(bodypage,"$print");
		}else if( keysDown.indexOf(_keyboardMap['s'])!==-1){
			// focus of search box
			var inputSearch = $('input[class="s-search-rq-field-input"]');
			if( inputSearch && inputSearch.length && inputSearch.length === 1 ){
				inputSearch[0].focus();
			}
		}else if( keysDown.indexOf(_keyboardMap['n'])!==-1){
			applyMenuAction(bodypage,"$create");
		}else if( keysDown.indexOf(_keyboardMap['f5'])!==-1){
			if( isFusion ){
				// must send a special action to refresh data
			}
		}
	} 
	return false;
}



function applyMenuAction(bodypage,action){

	var protoMenu =  bodypage.mainPage.$menus;
	var baseUrl = encodeURIComponent(bodypage.mainPage.$prototype.$baseUrl);
	if( protoMenu[action] ){
		//Â get title to retrieve the menu button
		var tmp = protoMenu[action].$url;
		tmp = tmp.substring(tmp.indexOf('/'));
		var href = "?url="+baseUrl+encodeURIComponent(tmp); 

		var items = bodypage.$$body.find("a[href='"+href+"'][data-s-menu]");
		if( items.length >= 1 ){
			var click = false;
			for(var i=0;i<items.length && !click;i++){
				var f = $(items[i]);
				if( f.parents(":hidden").length==0 && !f.attr("disabled") && f.is(':visible') ){
					f.click();
					click = true;
				}
			}
		}// else can't determine action
	}
}
