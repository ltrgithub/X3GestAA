"use strict";
var helpers = require('syracuse-core/lib/helpers');
var handler = require('./shortcutHandler');
var SectionBlock = require('syracuse-ui/lib/article/sectionBlock').SectionBlock;
var SheetPage = require('syracuse-ui/lib/fusion/article/sheetPage').SheetPage;
var _keyboardMap = {
	"backspace" : 8,
	"tab":9,
	"enter" : 13,
	"esc" : 27,
	"home":36,
	"pageup" : 33,
	"pagedown":34,
	"insert":45,
	"delete":46,
	":":58,
	"divide" : 111,
	"f1" :112,
	"f5" :116,
	"f7":118,
	"f9":120,
	"f11" :122,
	"f12" : 123,
	",":188,
	"right":39,
	"left":37,
	a:65,
	b:66,
	c:67,
	d:68,
	e:69,
	f:70,
	g:71,
	h:72,
	i:73,
	j:74,
	k:75,
	l:76,
	m:77,
	n:78,
	o:79,
	p:80,
	q:81,
	r:82,
	s:83,
	t:84,
	u:85,
	v:86,
	w:87,
	x:88,
	y:89,
	z:90 
};

var letterMap = _keyboardMap.reduce(function(key,desc,index){
	key[desc[2]] = desc[1];
},{});

var mapShortCut = {
	'modifier' : 'esc',
	'2' : { // shortcut with 2 key
		'p' : 'handler.actionPage("$print")',
	}
	'3' : { // shortcut with 3 key
	}


}

var modifier = "esc";
exports.applyKeyboardShortCut2= function(context){
	var isFusion = context.isFusion;
	var keysDown = context.keysDown;
	var event = context.event;

	try{
		mapShortCut[keysDown.length][
	}catch(e){
		console.log(e);
	}finally{
		return false;
	}
}
	
exports.applyKeyboardShortCut= function(context){
	// retrieve $prototype on menu 
	var isFusion = context.isFusion;
	var keysDown = context.keysDown;
	var event = context.event;
	try{
		if(keysDown.length>=2 && keysDown.indexOf(_keyboardMap[modifier])!==-1){
			if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['p'])!==-1){// print 
				handler.actionPage('$print');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['a'])!==-1){// selection all rows of page grid
				handler.selectAllGridLines();
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['right'])!==-1){// tab navigation
				handler.navTab(true);		
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['left'])!==-1){// tab navigation
				handler.navTab(false);		
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['delete'])!==-1){// delete current grid line
				handler.actionGridLine('$delete');
			}else if( keysDown.indexOf(_keyboardMap['insert'])!==-1){// insert grid line
				handler.actionGridLine('$create');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['n'])!==-1){// create new file
				// check if the focus field is in a table or not 
				handler.actionPage(isFusion?"1115":'$create');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['pageup'])!== -1  ){// next page
				// check if we are in a grid
				handler.navGridFusion(true,event);	
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['pagedown'])!== -1  ){// prev page
				// check if we are in a grid
				handler.navGridFusion(false,event);	
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['enter'])!== -1  ){// main action
				handler.mainActionPage();
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['f1'])!==-1 ){// go to help

				handler.goToHelp();
			}else if(keysDown.length === 3 &&  keysDown.indexOf(_keyboardMap['g'])!==-1 && keysDown.indexOf(_keyboardMap['h'])!==-1){// go to home 
				handler.goToHome();
			}else if(keysDown.length === 3 &&  keysDown.indexOf(_keyboardMap['m'])!==-1 && event.shiftKey ){ // contextual menu grid line
				actionContextMenu(true);
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['m'])!==-1 ){ // contextual menu
				handler.actionContextMenu(false);
			}else if( keysDown.length === 2 && keysDown.indexOf(_keyboardMap['f5'])!==-1){ // refresh
				handler.refresh();
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['q'])!==-1 ){ // last record
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['k'])!==-1 && event.shiftKey){ // last record
				handler.navRecord('$last');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['j'])!==-1 && event.shiftKey ){ // first record
				handler.navRecord('$first');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['j'])!==-1){ // previous record
				handler.navRecord('$previous');
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['k'])!==-1){ // next record 
				handler.navRecord('$next');
			}else if( keysDown.length === 3 && keysDown.indexOf(_keyboardMap['h'])!==-1 && keysDown.indexOf(_keyboardMap['l'])!==-1){ // fullscreen mode
				handler.hideBar('l');
			}else if(keysDown.length === 3 &&  keysDown.indexOf(_keyboardMap['h'])!==-1 && keysDown.indexOf(_keyboardMap['r'])!==-1){ // fullscreen mode
				handler.hideBar('r');
			
			}else if((keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['f11'])!==-1) 
					|| ( keysDown.length === 3 &&  keysDown.indexOf(_keyboardMap['h'])!==-1 && keysDown.indexOf(_keyboardMap['a'])!==-1)){ // fullscreen mode
				handler.hideBar('a');
			}else if(isFusion && ( keysDown.length === 2 && keysDown.indexOf(_keyboardMap['f7'])!==-1 ) || (keysDown.length === 3 && keysDown.indexOf(_keyboardMap['g'])!==-1 &&  keysDown.indexOf(_keyboardMap['f'])!==-1) ){ // got to function 
				handler.goToFunction();
			}else if( (keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['f9'])!==-1 )
					|| ( keysDown.length === 3 && keysDown.indexOf(_keyboardMap['g'])!==-1 && keysDown.indexOf(_keyboardMap['d'])!==-1) ){ // tunnel picker
				handler.goToDetailTunnel();
			}else if(keysDown.length === 2 && ( keysDown.indexOf(_keyboardMap['l'])!==-1 ||Â  keysDown.indexOf(_keyboardMap['f12'])!==-1)){ // lookup picker
				handler.actionLookup();
			}else if( (keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['s'])!==-1 )
					|| (keysDown.length === 2 && keysDown.indexOf(_keyboardMap[':'])!==-1 && event.shiftKey ) 
					|| (keysDown.length === 2 && keysDown.indexOf(_keyboardMap['divide'])!==-1) ){ // focus USB (universal search bar)
				handler.focusUSB();
			}else if(keysDown.length === 2 &&  keysDown.indexOf(_keyboardMap['tab'])!==-1 ){// next field on Grid Fusion
				handler.nextFieldConvGrid();
			}
		}else{
				//send escape
			var field = document.site.lastFocusField ;
			if( field ) {
				event.type ='keydown'
				event.keyCode= _keyboardMap[modifier]
				field.onFieldInputEvent(event);
			}
				
		}

		return false;
	}catch(e){
		console.error(e);
		return false;
	}
}

exports.getModifier =  function(){
	return _keyboardMap[modifier];
}



