"use strict";
var helpers = require('syracuse-core/lib/helpers');
var locale = require('syracuse-core/lib/locale');
var RawPage = require('syracuse-ui/lib/article/rawPage').RawPage;
function SearchRequest(){
}

exports.SearchRequest = helpers.defineClass(SearchRequest, RawPage, {
    drawBox: function(){
        var dom;
        this.$layoutOptions = {
            $skin: this.$skin = "s-search-rq",
            section: "s-h1",
            block: "s-h2",
            menus: "s-page-menus"
        };
        dom = document.createElement("article");
        dom.className = this.$skin;
        this.$$item = $(dom).appendTo(this.$$container);
        
        dom = document.createElement("div");
        this.$$body = $(dom).appendTo(this.$$item);
        
        this._renderLayoutContent(this.$item);
        this._setClickPicker();
        this.appendArticleMenus();
    },
    _setClickPicker: function(){
        var self = this;
        (self._searchField = self.boundFields.search[0]).onClickPicker = function(){
            self._searchField.onInputValidate(); //trigger notification change
        };
    },
    notifyChange: function($bind, value){
        if ($bind == "search") {
            this.dataset[$bind] = value;
            document.controller.executeMenu(this.menuItems["$searchLink"][0]);
        }
    },
    dispose: function(){
        if (this._searchField) {
            delete this._searchField.onClickPicker;
        }
        RawPage.prototype.dispose.call(this);
    }
});

exports.loadRequest = function($$container){
    var $url = "/sdata/syracuse/search/syracuse/$search?representation=queryResult.$search&q={search}";
    var httpQuery = document.controller.parseUrl($url);
    var $itemPage = {
        $autoFetch: false,
        $isEditMode: true,
        $$container: $$container,
        $category: "searchRequest",
        $urlParts: httpQuery.$urlParts,
        $representation: {
            $prototype: {
                $properties: {
                    search: {
                        $type: "application/x-string",
                        $title: "Search by key words",
                        $links: {
                            $suggest: {
                                "$type": "application/json;vnd.sage=syracuse",
                                $url: "/sdata/syracuse/search/syracuse/$search?representation=queryResult.$search&q={search}"
                            }
                        }
                    }
                },
                $links: {
                    $searchLink: {
                        "$type": "application/json;vnd.sage=syracuse",
                        $url: "/sdata/syracuse/search/syracuse/$search?representation=queryResult.$search&q={search}"
                    }
                }
            },
            $article: {
                $isTitleHidden: true,
                $layout: {
                    $items: [{
                        $bind: "search",
                        $isTopLabelAlignment: false,
                        $category: "field",
                        $validationTrigger: "keyup",
                        $skin: "s-search-rq-field",
                        $inplace: true
                    }, {
                        $bind: "$searchLink",
                        $category: "link",
                        $noText: true,
                        $skin: "s-site-search-picker"
                    }]
                }
            }
        }
    };
    return document.itemFactory.loadPage($itemPage, SearchRequest);
    
};
