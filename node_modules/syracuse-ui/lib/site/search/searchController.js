"use strict";
var locale = require('syracuse-core/lib/locale');

exports.isSearchUrl = function($url) {
	return $url && (decodeURIComponent($url).indexOf("$search?representation=queryResult.$search&q=") >= 0);
};

exports.getProperties = function() {
	return {
		"$queryFunctions": {
			"$type": "application/x-array",
			"$item": {
				"$type": "application/json",
				"$prototype": "{$baseUrl}/$prototypes('{$representation}.$search')",
				"$url": "{$baseUrl}/{$pluralType}('{$key}')",
				"$value": "{$key}",
				"$title": "queryResult {$key}",
				"$key": "{$uuid}",
				"$description": "queryResult {$key}",
				"$pluralType": "queryResults",
				"$representation": "queryResult",
				"$properties": {
					"description": {
						"$title": "Resume",
						"$type": "application/x-string",
						"$capabilities": "sort,filter,alphaTab",
						"$format": "$html"
					},
					"title": {
						"$title": "Description",
						"$type": "application/x-string",
						"$format": "$html",
						"$capabilities": "sort,filter,alphaTab",
						"$links": {
							"$details": {
								"$type": "application/json;vnd.sage=syracuse",
								"$url": "{$baseUrl}/{$pluralType}('{$key}')?representation={$representation}.$details&role={$role}"
							}
						}
					},
					"$creUser": {
						"$title": "Created by",
						"$type": "application/x-string",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$updUser": {
						"$title": "Updated by",
						"$type": "application/x-string",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$creDate": {
						"$title": "Created on",
						"$type": "application/x-datetime",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$updDate": {
						"$title": "Updated on",
						"$type": "application/x-datetime",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					}
				},
				"$defaultOrder": "title"
			}
		},
		"$queryData": {
			"$type": "application/x-array",
			"$item": {
				"$type": "application/json",
				"$prototype": "{$baseUrl}/$prototypes('{$representation}.$search')",
				"$url": "{$baseUrl}/{$pluralType}('{$key}')",
				"$value": "{$key}",
				"$title": "queryResult {$key}",
				"$key": "{$uuid}",
				"$description": "queryResult {$key}",
				"$pluralType": "queryResults",
				"$representation": "queryResult",
				"$properties": {
					"description": {
						"$title": "Resume",
						"$type": "application/x-string",
						"$format": "$html",
						"$capabilities": "sort,filter,alphaTab"
					},
					"title": {
						"$title": "Description",
						"$type": "application/x-string",
						"$format": "$html",
						"$capabilities": "sort,filter,alphaTab",
						"$links": {
							"$details": {
								"$type": "application/json;vnd.sage=syracuse",
								"$urld": "{$baseUrl}/{$pluralType}('{$key}')?representation={$representation}.$details&role={$role}",
								"$url": "{$url}"
							}
						}
					},
					"type": {
						"$title": "Type",
						"$type": "application/x-string",
						"$format": "$html",
						"$capabilities": "sort,filter,alphaTab"
					},
					"$creUser": {
						"$title": "Created by",
						"$type": "application/x-string",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$updUser": {
						"$title": "Updated by",
						"$type": "application/x-string",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$creDate": {
						"$title": "Created on",
						"$type": "application/x-datetime",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					},
					"$updDate": {
						"$title": "Updated on",
						"$type": "application/x-datetime",
						"$isDisabled": true,
						"$isHidden": true,
						"$capabilities": "sort,filter"
					}
				},
				"$defaultOrder": "title"
			}
		},
		"query": {
			"$type": "application/x-string"
		}
	};
};

exports.getArticle = function() {
	var localize = document.site.localize;
	var $skin = "s-search-res";
	return {
		"$title": "Search results for '{query}'",
		"$layout": {
			"$layoutType": "tabs",
			"$items": [{
				"$category": "section",
				$clientId: "searchDataTab",
				"$title": "Data",
				"$layout": {
					"$layoutType": "columns",
					"$widths": "100",
					"$items": [{
						"$items": [{
							"$bind": "$queryData",
							$isMenuRecordHidden: true,
							"$noDataText": localize.search_no_res,
							"$format": "cards",
							$skin: $skin,
							$css: $skin,
							$layout: {
								$items: [{
									$bind: "title",
									$skin: $skin,
									$isTitleHidden: true
								}, {
									$bind: "description",
									$skin: $skin,
									$isTitleHidden: true
								}, {
									$bind: "type",
									$skin: $skin + "-type",
									$isTitleHidden: true
								}]
							}
						}]
					}]
				}
			}, {
				"$category": "section",
				"$title": "Functions",
				$clientId: "searchFunctionsTab",
				"$layout": {
					"$layoutType": "columns",
					"$widths": "100",
					"$items": [{
						"$items": [{
							"$bind": "$queryFunctions",
							$isMenuRecordHidden: true,
							"$noDataText": localize.search_no_res,
							"$format": "cards",
							$skin: $skin,
							$css: $skin,
							$layout: {
								$items: [{
									$bind: "title",
									$skin: $skin,
									$isTitleHidden: true
								}, {
									$bind: "description",
									$skin: $skin,
									$isTitleHidden: true
								}]
							}
						}]
					}]
				}
			}]
		}
	};
};

exports.getPrototype = function() {
	return {
		"$baseType": "application/json;vnd.sage=syracuse",
		"$url": "{$baseUrl}/queryResults",
		"$type": "application/json",
		"$properties": exports.getProperties(),
		"$descriptor": "prototype queryResult.$search",
		"$article": exports.getArticle()
	};
};


exports.openRequestPage = function(httpQuery) {
	var $itemPage = {
		$category: "search",
		$urlParts: httpQuery.$urlParts,
		$representation: {
			$prototype: exports.getPrototype()
		}
	};

	document.site.onMainPageChange($itemPage);

};