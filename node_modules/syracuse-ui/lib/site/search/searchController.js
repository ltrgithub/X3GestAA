"use strict";
var searchUtils = require('./searchUtils');
exports.isSearchUrl = function($url) {
	return $url && (decodeURIComponent($url).indexOf("$search?representation=queryResult.$search&q=") >= 0);
};

exports.getProperties = function() {
	var $skin = "s-search-res";
	return {
		"$vignetteFunctions": {
			$type: "application/x-vignette",
			$format: "$searchPage",
			$prototype: {
				$properties: {
					$searchModeDescription: {
						$type: "application/x-string"
					},
					"$queryFunctions": {
						"$type": "application/x-array",
						"$item": {
							"$type": "application/json",
							"$prototype": "{$baseUrl}/$prototypes('{$representation}.$search')",
							"$url": "{$baseUrl}/{$pluralType}('{$key}')",
							"$value": "{$key}",
							"$title": "queryResult {$key}",
							"$key": "{$uuid}",
							"$description": "queryResult {$key}",
							"$pluralType": "queryResults",
							"$representation": "queryResult",
							"$properties": {
								"$descriptionData": {
									"$title": "Resume",
									"$type": "application/x-array",
									"$item": {
										"$type": "application/x-string",
										"$format": "$html",
									}
								},
								"$searchItemTitle": {
									"$title": "Description",
									"$type": "application/x-string",
									"$format": "$html",
									"$capabilities": "sort,filter",
									"$links": {
										"$details": {
											"$type": "application/json;vnd.sage=syracuse",
											"$url": "{$url}"
										}
									}
								}
							},
							"$defaultOrder": "title"
						}
					}
				},
				$article: {
					"$layout": {
						"$layoutType": "columns",
						"$widths": "100",
						"$items": [{
							"$items": [{
								"$bind": "$queryFunctions",
								$selectMode: "row",
								$isMenuRecordHidden: true,
								"$noDataText": syra_local.search_no_res,
								"$format": "cards",
								$skin: $skin,
								$css: $skin,
								$layout: {
									$items: [{
										$bind: "$searchItemTitle",
										$skin: $skin,
										$isTitleHidden: true
									}, {
										$bind: "$descriptionData",
										"$noDataText": " ",
										$isTitleHidden: true,
										$skin: $skin + "-desc",
										$inplaceSkin: $skin + "-inplace"
									}]
								}
							}]
						}]
					}
				}
			}
		},
		$vignetteData: {
			$type: "application/x-vignette",
			$format: "$searchPage",
			$prototype: {
				$properties: {
					$searchModeDescription: {
						$type: "application/x-string"
					},
					"$queryData": {
						"$type": "application/x-array",
						"$item": {
							"$type": "application/json",
							"$prototype": "{$baseUrl}/$prototypes('{$representation}.$search')",
							"$url": "{$baseUrl}/{$pluralType}('{$key}')",
							"$value": "{$key}",
							"$title": "queryResult {$key}",
							"$key": "{$uuid}",
							"$description": "queryResult {$key}",
							"$pluralType": "queryResults",
							"$representation": "queryResult",
							"$properties": {
								"$searchItemTitle": {
									"$title": "Description",
									"$type": "application/x-string",
									"$format": "$html",
									"$capabilities": "sort,filter",
									"$links": {
										"$details": {
											"$type": "application/json;vnd.sage=syracuse",
											"$url": "{$url}"
										}
									}
								},
								"$descriptionData": {
									"$title": "Resume",
									"$type": "application/x-array",
									"$item": {
										"$type": "application/x-string",
										"$format": "$html"
									}
								},
								"$resultTypeTitle": {
									"$title": "Result type title",
									"$type": "application/x-string",
									"$format": "$html",
									"$capabilities": "sort,filter"
								}
							},
							"$defaultOrder": "title"
						}
					}
				},
				$article: {
					"$layout": {
						"$layoutType": "columns",
						"$widths": "100",
						"$items": [{
							"$items": [{
								$bind: "$queryData",
								$selectMode: "row",
								$isMenuRecordHidden: true,
								"$noDataText": syra_local.search_no_res,
								"$format": "cards",
								$skin: $skin,
								$css: $skin,
								$layout: {
									$items: [{
										$bind: "$searchItemTitle",
										$skin: $skin,
										$isTitleHidden: true
									}, {
										$bind: "$resultTypeTitle",
										$skin: $skin + "-type",
										$isTitleHidden: true
									}, {
										$bind: "$descriptionData",
										"$noDataText": " ",
										$isTitleHidden: true,
										$skin: $skin + "-desc",
										$inplaceSkin: $skin + "-inplace"
									}]
								}
							}]
						}]
					}
				}
			}
		},
		"query": {
			"$type": "application/x-string"
		}
	};
};


exports.getArticle = function() {
	var $skin = "s-search-res";
	return {
		"$title": syra_local.searchPageTitle,
		"$layout": {
			"$layoutType": "columns",
			"$items": [{
				"$category": "section",
				"$title": syra_local.search_functions_tab,
				$clientId: "searchFunctionsTab",
				$layout: {
					$items: [{
						$bind: "$vignetteFunctions"
					}]
				}
			}, {
				"$category": "section",
				$clientId: "searchDataTab",
				"$title": syra_local.search_data_tab,
				$layout: {
					$items: [{
						$bind: "$vignetteData"
					}]
				}
			}]
		}
	};
};

exports.getPrototype = function() {
	return {
		$baseType: "application/json;vnd.sage=syracuse",
		$url: "{$baseUrl}/queryResults",
		$type: "application/json",
		$properties: exports.getProperties(),
		$links: searchUtils.getSearchModeLinks(),
		$descriptor: "prototype queryResult.$search",
		$article: exports.getArticle()
	};
};