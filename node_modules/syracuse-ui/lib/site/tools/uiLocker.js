"use strict";

var _locker, _overlay, _dummy, _timeout;


exports.lock = function(delay, isLong, forceFocusLoss) {
	if (!_locker) {
		_locker = document.createElement('div');
		_locker.className = "s-uiLocker-loading";
		_dummy = document.createElement('a');
		_dummy.setAttribute("href", "#");
		_dummy.syrUILockerBlackHole = true;
		_locker.appendChild(_dummy);
		syra_site.layoutSlot.appendChild(_locker);
	}
	syra_dom.hide(_locker, false);
	syra_quality.logLock(1);
	if (forceFocusLoss) {
		_dummy.focus();
	}
	_timeout = setTimeout(function() {
		if (isLong) {
			if (!_overlay) {
				_overlay = syra_dom.addDiv("s-uiLocker-overlay", syra_site.layoutSlot);
				_overlay.syraIsOverlay = true;
			}
			syra_quality.logLock(2);
			syra_dom.hide(_overlay, false);
		}
		exports.ensureLock();
	}, (delay || 0) > 0 ? delay : 0);
};

exports.ensureLock = function() {
	if (_locker && _locker.style.display !== "none") {
		var site = syra_site;
		syra_dom.setZIndex(_locker);
		var siteSize = site.getSize();
		var height = siteSize.height;
		var top = 0;
		if (site.header) {
			var headerH = site.header.clientHeight;
			if (headerH) {
				top = headerH;
				height -= top;
			}
		}
		var style = _locker.style;
		style.top = top + "px";
		style.width = siteSize.width + "px";
		style.height = height + "px";

		style = _overlay && _overlay.style;
		if (style && style.display !== "none") {
			style.top = top + "px";
			style.width = siteSize.width + "px";
			style.height = height + "px";
			syra_dom.setZIndex(_overlay);
		}
	}
};

exports.unlock = function() {
	if (_locker) {
		syra_dom.hide(_locker, true);
		_locker.style.width = "0px";
	}
	if (_overlay) {
		syra_dom.hide(_overlay, true);
		_overlay.style.width = "0px";
	}
	if (_timeout) {
		clearTimeout(_timeout);
		_timeout = null;
	}
	syra_quality.logLock(0);
};
exports.dispose = function() {
	_locker = _overlay = _dummy = _timeout = null;
};