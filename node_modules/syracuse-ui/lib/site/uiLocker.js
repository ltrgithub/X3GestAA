"use strict";
var helpers = require('syracuse-core/lib/helpers');

/*
 * lock the browser interface by change the cursor and add an overlay
 * delay : start lock after this delay
 * kind : kind of cursor
 */
var overlay = null;
var lockerdiv = null;
var locked = false;
var idTimeout = null;
exports.lock = function(delay, isLong) {
	if (lockerdiv == null) {
		lockerdiv = document.createElement('div');
		document.site.setZIndex(lockerdiv);
		lockerdiv.className = "s-locker-loading";
		lockerdiv.style.width = document.documentElement.clientWidth + "px";
		lockerdiv.style.height = document.documentElement.clientHeight + "px";
		lockerdiv.style.cursor = "progress";
		document.site.layoutSlot.appendChild(lockerdiv);
	}

	function apply() {
		if (isLong) { // if longer request
			if (overlay == null) { //first call
				overlay = document.createElement('div');
				overlay.className = "s-overlay-loading";
				overlay.style.width = document.documentElement.clientWidth + "px";
				overlay.style.height = document.documentElement.clientHeight + "px";
				overlay.style.cursor = "wait";
				document.site.body.appendChild(overlay);
				var img = document.createElement('img');
				overlay.appendChild(img);
				document.site.setZIndex(overlay);
				document.site.setZIndex(img);
				img.setAttribute("src", "/syracuse-ui/themes/desktop/sage/images/page/s-overlay-loading.gif");
				img.setAttribute("alt", "loading");
				img.style.position = "absolute";
				img.style.left = "50%";
				img.style.top = "40%";
			}
		}
	}
	if (!delay || delay <= 0) {
		apply();
	} else {
		idTimeout = setTimeout(apply, delay);
	}

};

/ * * * unlock the screen * /;
exports.unlock = function() {
	if (overlay && document.site.body.contains(overlay)) {
		document.site.body.removeChild(overlay);
	}
	overlay = null;
	if (lockerdiv && document.site.layoutSlot.contains(lockerdiv)) {
		document.site.layoutSlot.removeChild(lockerdiv);
	}
	lockerdiv = null;
	if (idTimeout) {
		clearTimeout(idTimeout);
	}
};
/ * * * Ensure lock overlay * /;
exports.ensureOverlay = function() {
	if (overlay && document.site.body.contains(overlay)) {
		document.site.setZIndex(overlay);
	}
	if (lockerdiv && document.site.layoutSlot.contains(lockerdiv)) {
		document.site.setZIndex(lockerdiv);
	}
};