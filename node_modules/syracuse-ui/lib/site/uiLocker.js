"use strict";
var helpers = require('syracuse-core/lib/helpers');

/*
 * lock the browser interface by change the cursor and add an overlay
 * delay : start lock after this delay 
 * kind : kind of cursor 
 */
var overlay= null;
var idTimeout = null;
exports.lock = function(delay,isLong){
	function apply(){
		if( overlay == null ){
			overlay = document.createElement('div');
			overlay.className = "s-overlay-loading";
			if( isLong ){
				var img = document.createElement('img');
				img.setAttribute("src","/syracuse-ui/themes/desktop/sage/images/page/s-overlay-loading.gif");
				img.setAttribute("alt","loading");
				img.style.position= "absolute";
				img.style.left= "50%";
				img.style.top= "40%";
				document.site.setZIndex(overlay);
				document.site.setZIndex(img);
			}
			overlay.appendChild(img);
			overlay.style.cursor = 'progress';
			overlay.style.width = document.documentElement.clientWidth+"px";
			overlay.style.height = document.documentElement.clientHeight+"px";
			document.site.body.appendChild(overlay);
		}
	}
	if( delay <= 0 ){
		apply();
	}else{
		idTimeout = setTimeout(apply,delay);
	}

};

/**
 * unlock the screen 
 */
exports.unlock = function(){
	if( overlay ){
		document.site.body.removeChild(overlay);
		document.body.style.cursor = 'default';
		overlay = null;
	}
	if( idTimeout ){
		clearTimeout(idTimeout);
	}
};
