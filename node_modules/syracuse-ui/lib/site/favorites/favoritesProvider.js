"use strict";
var helpers = require('syracuse-core/lib/helpers');

function FavoritesProvider() {}

exports.FavoritesProvider = helpers.defineClass(FavoritesProvider, null, {
	save: function($url, $description) {
		if ($url) {
			if (!this.map) {
				this.map = {};
			}
			var start = $url.indexOf("?");
			if (start) {
				$url = $url.slice(start);
			}
			this.map[$url] = {
				$url: $url,
				$description: $description
			};
		}
	},
	onClickPicker: function(target, event) {
		if (target.syraMenuItemPath) {
			var field = document.controller.findField(target);
			document.site.toggleClass(target, "s-favorite-on", field.isFavorite = !field.isFavorite);
			if (field.isFavorite) {
				this.save(field.codeMenu.href);
			} else {
				delete this.map[field.codeMenu.href];
			}
		}
	},
	addFavoritePicker: function(item) {
		if (item.isNavigationMenuItem) {
			if (item.codeMenu) {
				if (item.codeMenu.href) {
					var picker = document.createElement("a");
					picker.setAttribute("data-s-picker", picker.syraPickerType = "favorite");
					picker.syra_field_id = item.id;
					picker.syraMenuItemPath = item.page.getNavigationPath(item);
					picker.className = "s-nav-menu-favorite";
					if (this.map && this.map[item.codeMenu.href]) {
						document.site.toggleClass(picker, "s-favorite-on", item.isFavorite = true);
					}
					item.layoutSlot.parentNode.insertBefore(picker, item.layoutSlot);
				} else {
					document.site.toggleClass(item.layoutSlot, "s-favorite-off", true);
				}
			}
		}
	},
	dispose: function() {
		this.map = null;
	}
});