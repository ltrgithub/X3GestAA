"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Field = require('syracuse-ui/lib/field/field').Field;

function _renderMandatoryItem(field, type) {
	var label = document.createElement("label");
	label.className = field.$skinInput + "-boolean-rd-item";
	label.setAttribute("for", field.inputId + type);
	label.textContent = syra_local["fld_bool_" + type];
	var item = field[type + "_value"] = document.createElement("input");
	item.className = field.$skinInput + "-boolean-rd-val";
	item.setAttribute("name", field.inputId);
	item.setAttribute("id", field.inputId + type);
	item.setAttribute("type", "radio");
	label.insertBefore(item, label.firstChild);
	field.fieldValue.appendChild(label);
}

function _setMandatoryValue(field, type, value) {
	var item = field[type + "_value"];
	item.checked = value;
	if (value) {
		item.setAttribute("data-s-selected", true);
	} else {

		item.removeAttribute("data-s-selected");
	}
}

function _render(field) {
	if (field.$item.$inplace) {
		field.domItem.style.textAlign = "center";
	}
	if (field.$isEditMode) {
		if (field.$field.$isMandatory && !field.$item.$isFilterMode) {
			_renderMandatoryItem(field, "true");
			_renderMandatoryItem(field, "false");
		} else {
			field.input = document.createElement("input");
			field.input.setAttribute("type", "checkbox");
			syra_site.setSpecificAttributes(field.input);
			field.input.className = field.$skinInput + "-boolean";
			field.fieldValue.appendChild(field.input);

			if (field.domTitle) {
				field.domTitleSpace = document.createElement("div");
				field.domTitleSpace.className = field.domTitle.className;
				field.domItem.insertBefore(field.domTitleSpace, field.domItem.firstChild);
				var css = " " + field.$skin + "-title-boolean";
				if (field.$item.$css) {
					css += " " + field.$item.$css;
				}
				field.domTitle.className = css;
				field.fieldValue.appendChild(field.domTitle);
			}
		}
	} else {
		field.fieldValue.className += (" " + field._$cssField + "-read-boolean");
	}
}



function BooleanField() {}

exports.BooleanField = helpers.defineClass(BooleanField, Field, {
	initialize: function() {
		this.hasFreeWidth = true;
		//this.$field.$isMandatory = true;
		this.statusValues = this.statusValues || {
			on: true,
			off: false
		};
		this.$isDetailLinkDisabled = true;
	},
	dispose: function() {
		this.domTitleSpace = this.statusValues = null;
		Field.prototype.dispose.call(this);
	},
	notifyFieldChange: function(newValue) {
		Field.prototype.notifyFieldChange.call(this, newValue);
		if (this.$isEditMode && this.input) {
			var boolValue = (newValue || this.statusValues.off) == this.statusValues.on;
			this.input.setAttribute("data-s-selected", newValue);
		}
	},
	getDataValue: function() {
		if (this.$field.$isMandatory && !this.$item.$isFilterMode) {
			if (this.true_value.checked) {
				return this.statusValues.on;
			}
			if (this.false_value.checked) {
				return this.statusValues.off;
			}
			return null;
		}
		return (this.input.checked ? this.statusValues.on : this.statusValues.off);
	},
	setDataValue: function(value) {
		var boolValue = (this.currentValue = value || this.statusValues.off) == this.statusValues.on;
		if (this.$isEditMode) {
			if (this.$field.$isMandatory && !this.$item.$isFilterMode) {
				_setMandatoryValue(this, "true", value === this.statusValues.on);
				_setMandatoryValue(this, "false", value === this.statusValues.off);
			} else {
				this.input.setAttribute("data-s-selected", this.input.checked = boolValue);
			}
		} else {
			syra_site.dom.toggleClass(this.fieldValue, "s-on", boolValue);
			syra_menus.ensureMenuPicker(this);
		}
	},
	applyDesignMetaData: function(metaData, designing) {
		Field.prototype.applyDesignMetaData.call(this, metaData, designing);
		if (metaData.$isLeftSpaceHidden !== undefined) {
			this.domTitleSpace.style.display = metaData.$isLeftSpaceHidden ? "none" : "";
		}
	},
	_initCss: function() {
		Field.prototype._initCss.call(this);
		this._$cssField = "s-boolean " + this._$cssField;
	},

	render: function() {
		_render(this);
	},
	_onSetReadOnly: function($isReadOnly) {
		if (this.input) {
			if (this.$isReadOnly) {
				this.input.disabled = true;
				if (this.domTitle) {
					syra_site.dom.toggleClass(this.domTitle, "s-disabled", true);
				}
			} else {
				if (!this.$isDisabled) {
					this.input.disabled = false;
					if (this.domTitle) {
						syra_site.dom.toggleClass(this.domTitle, "s-disabled");
					}
				}
			}
		}
	}
});