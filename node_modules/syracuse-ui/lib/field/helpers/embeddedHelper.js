"use strict";
var helpers = require('syracuse-core/lib/helpers');

exports.addEmbeddedLink = function(article, $bind, $menu) {
	if (article.isDesktopPage) {
		var $properties = article.$prototype.$properties;
		if ($properties) {
			var $vignette = $properties[$bind];
			$menu = helpers.object.clone($menu, true);
			if ($menu.$url) {
				$menu.$url = syra_site.expressionMaker.parseUrl(article, $menu.$url);
				var seg = syra_site.urlMaker.parse($menu.$url, true);
				if (!seg.isSyracuse) {
					$menu.$type = "html";
				}
			}
			if (!$vignette) {
				$vignette = $properties[$bind] = {
					$type: "application/x-vignette",
					$title: $menu.$title,
					$location: $menu
				};
			} else {
				syra_site.deltaManager.applyObjectDelta(article.page, $vignette.$location, $menu);
			}
			article.layoutContent.loadChildItem(null, {
				$bind: $bind
			});
			return true;
		}
	}
};