"use strict";
var helpers = require('syracuse-core/lib/helpers');
var SectionBlock = require("syracuse-ui/lib/article/sectionBlock").SectionBlock;

function VignetteField() {}

exports.VignetteField = helpers.defineClass(VignetteField, SectionBlock, {
	ensureSkin: function() {
		SectionBlock.prototype.ensureSkin.call(this);
		this.$designLevel = "field";
	},
	resizeItem: function() {},
	setValue: function() {},
	loadBox: function() {
		this.isVignetteField = true;
		if (!this.page.isLandingPage && this.$item.$isBoxCollapsable == undefined) {
			this.$item.$isBoxCollapsable = true;
		}
		SectionBlock.prototype.loadBox.call(this);
		//$(this.domItem).resizable();

		this.refreshBtn = syra_button.add({
			parent: this,
			slot: this.ensureButtonsSlot(),
			text: syra_local.box_refresh,
			css: this.$skin + "-btn",
			iconOnly: true,
			fontIcon: "refresh",
			btnclick: function() {
				this.parent.refresh(true);
			}
		});

		this.toggleMaximizeButton(true);
		syra_item.bind(this, this.$item.$bind);

		this.page.resizableList.add(this);
	},
	refresh: function(onVignetteRefresh) {
		var $refresh = this.vignette && this.vignette.$menus && this.vignette.$menus.$refresh;
		var $url = $refresh && $refresh.$url;
		if ($url) {
			$url = syra_expression.parse(this.vignette, $url);
		}
		this.renderLayoutContent($url, onVignetteRefresh);
	},
	onItemInOut: function(onEnter, event) {

	},
	toggleMenuButton: function(show) {
		if (show) {
			if (!this.menuBtn) {
				this.menuBtn = syra_button.add({
					parent: this,
					slot: this.ensureButtonsSlot(),
					text: syra_local.box_menus,
					css: this.$skin + "-btn",
					iconOnly: true,
					fontIcon: "menus",
					btnclick: function() {
						syra_menus.pickers.menus.showPopup({
							field: this.parent.vignette,
							picker: this
						});
					}
				});
			}
		} else {
			syra_button.remove(this.menuBtn);
		}
	},
	renderLayoutContent: function() {
		if (this.vignette) {
			syra_dom.empty(this.body);
			this.vignette.dispose();
			this.vignette = null;
		}
	},
	dispose: function() {
		this.toggleMenuButton(false);
		this.page && this.page.resizableList.remove(this);
		SectionBlock.prototype.dispose.call(this);
	}
});