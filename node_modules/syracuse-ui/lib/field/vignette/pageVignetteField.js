"use strict";
var helpers = require('syracuse-core/lib/helpers');
var VignetteField = require("syracuse-ui/lib/field/vignette/vignetteField").VignetteField;
var PageVignetteAuthoring = require("syracuse-ui/lib/authoring/field/pageVignetteAuthoring").PageVignetteAuthoring;

function PageVignetteField(){
}

exports.PageVignetteField = helpers.defineClass(PageVignetteField, VignetteField, {
    getAuthoringWidget: function(designedField){
        if (!this.awAddin) {
            this.awAddin = new PageVignetteAuthoring();
            this.awAddin.create(designedField);
        }
        return this.awAddin;
    },
    renderLayoutContent: function(){
        var self = this;
        VignetteField.prototype.renderLayoutContent.call(self);
        document.controller.loadRepresentation(null, self.$field.$location.$url, function($itemPage){
            $itemPage.layoutSlot = self.$$body[0];
            $itemPage.$category = "vignette";
            if (self.$item.$page) {
                $itemPage.$representation.$article = self.$item.$page;
                delete self.$item.$page.$menus;
            }
            self.vignette = document.site.loadNewPage($itemPage);
            self.vignette.vignetteField = self;
        });
    }
});
