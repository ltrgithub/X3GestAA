"use strict";
var helpers = require('syracuse-core/lib/helpers');
var VignetteField = require("syracuse-ui/lib/field/vignette/vignetteField").VignetteField;
var PageVignetteAuthoring = require("syracuse-ui/lib/authoring/field/pageVignetteAuthoring").PageVignetteAuthoring;

function PageVignetteField() {}

exports.PageVignetteField = helpers.defineClass(PageVignetteField, VignetteField, {
	showAdvancedFields: function(show) {
		if (!this._isOnChildPageUpdate) {
			VignetteField.prototype.showAdvancedFields.call(this, show);
			if (this.vignette && this.vignette.showAdvancedFields) {
				this._isOnChildPageUpdate = true;
				this.vignette.showAdvancedFields(this.vignette.$isAdvancedFieldsVisible = this.$isAdvancedFieldsVisible);
				this._isOnChildPageUpdate = false;
			}
		}
	},
	renderLayoutContent: function($url) {
		var self = this;
		VignetteField.prototype.renderLayoutContent.call(self);
		if ($url) {
			self.$url = $url;
		}
		document.controller.loadRepresentation(null, self.$url || self.$field.$location.$url, function($itemPage) {
			if (self.$$body) {
				$itemPage.layoutSlot = self.body;
				$itemPage.$category = "vignette";
				$itemPage.vignetteField = self;
				if (!self.$url && self.$item.$page) {
					$itemPage.$representation.$article = self.$item.$page;
					delete self.$item.$page.$menus;
				}
				self.vignette = document.site.loadNewPage($itemPage);
			}
		});
	}
});