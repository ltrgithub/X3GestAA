"use strict";

function _goToPage(list, isPageDown, isShift) {
	var pagerTop = list.pagging.pagerTop;
	if (pagerTop) {
		if (pagerTop.pages.length > 0) {
			// looking for the next page
			var currentIndex = Math.ceil(list.pagging.$startIndex / list.pagging.getItemsPerPage());
			var goToPage;
			if (isPageDown) {
				goToPage = isShift ? (pagerTop.pages.length - 1) : (currentIndex + 1);
			} else {
				goToPage = isShift ? 1 : (currentIndex - 1);
			}
			if (goToPage !== undefined) {
				goToPage = Math.min(Math.max(1, goToPage), pagerTop.pages.length - 1);
				pagerTop.pages[goToPage].click();
			}
			if (list.clientFetchOptions && list.records && list.records.length) {
				/* aurelien
                 var record = list.records[0];
                 if (record.rowIndexBtn) {
                 record.rowIndexBtn.click();
                 }*/
			}
		} else {
			if (pagerTop.pageSteps) {
				isPageDown ? syra_menus.click.next(list, event.shiftKey) : syra_menus.click.prev(list, event.shiftKey);
			}
		}
	}
}

exports.apply = function(list, shortcuts, event) {
	if (list.treeDecorator) {
		return list.treeDecorator.applyShortCut(shortcuts, event);
	}
	if (shortcuts.pagedown || shortcuts.pageup) {
		if (list.pagging) {
			_goToPage(list, shortcuts.pagedown, event.shiftKey);
			event.preventDefault();
			return true;
		}
	}
	if (shortcuts.up || shortcuts.down) {
		if (list.$item.$isNavigationList) {
			if (list.deferSelect) {
				clearTimeout(list.deferSelect);
				list.deferSelect = null;
			}
			if (record = list.getFocusedRecord(true)) {
				list.toggleFocusRecord(record, false);
				recordIndex = record.getRecordIndex();
				if (list.treeDecorator) {
					recordIndex = list.treeDecorator.getPrevNextTreeRecordVisible(recordIndex, shortcuts.down);
				} else {
					if (shortcuts.down) {
						recordIndex = (recordIndex < list.clientDataset.length - 1) ? recordIndex + 1 : recordIndex;
					} else {
						recordIndex = recordIndex > 0 ? recordIndex - 1 : recordIndex;
					}
				}
			}
			if (newSelect = list.records[recordIndex]) {
				list.toggleFocusRecord(newSelect, true);
				list.scroller.scrollToItem(newSelect.dataRow);
				if (newSelect.$facet && newSelect.$facet != "$lookup" && !list.treeDecorator) {
					list.deferSelect = setTimeout(function() {
						newSelect.domItem.click();
					}, 500);
				}
				event.preventDefault();
				return true;
			}
		}
	}
	if (shortcuts.enter) {
		if (list.$item.$isNavigationList) {
			record = list.getFocusedRecord(false);
			if (!record && list.selector && list.selector.uuid !== undefined) {
				record = list.selector.records[list.selector.uuid];
			}
			if (record && record.domItem) {
				record.domItem.click();
				event.preventDefault();
				return true;
			}
		}

	}

	return false;
};