"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Article = require("syracuse-ui/lib/article/article").Article;

function ChildFieldRecord() {}

exports.ChildFieldRecord = helpers.defineClass(ChildFieldRecord, Article, {
	ensureDataSet: function() {
		return this.dataset = this.articleParent.ensureDataSet();
	},
	remove: function() {
		syra_site.dom.removeChild(this.domItem);
	},
	drawBox: function() {
		this.$defaultSkinSection = this.$defaultSkinSection || "s-h3";
		this.$defaultSkinBlock = this.$defaultSkinBlock || "s-h4";
		this.domItem = this.list._core;
		this.menusSlot = document.createElement("div");
		this.menusSlot.className = this.list.$skin + "-actions-cell";
		this.domItem.appendChild(this.menusSlot);
		var card = this.domItem.appendChild(document.createElement("div"));
		card.className = this.list.$skin + "-record";
		this.page.loadNewItem(card, this.list.$item.$cardItem, this);
	},
	onMenuClick: function(menuItem) {
		var doClick = false;
		var self = this;
		if (!self.$isDisabled && !menuItem.$isDisabled && !menuItem.$isAction) {
			if (menuItem.$bind == "$lookup") {
				self.list.currentSelectRecords = null;
				syra_site.dialogManager.openLookup(self.list.boxParent, {
					article: self.list,
					$url: menuItem.$url,
					onSelectRecord: function(selectedRecords) {
						var record = selectedRecords[Object.keys(selectedRecords)[0]];
						self.list.setDataBind(record.dataset);
						self.page.notifyDataChange(self.list, record.dataset);
					}
				});
				return false;
			}
		}
		return true;
	},
	applyMetaData: function(metaData) {

	},
	dispose: function() {
		this.list = this.menusBox = null;
		Article.prototype.dispose.call(this);
	}
});