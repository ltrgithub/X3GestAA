"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Article = require("syracuse-ui/lib/article/article").Article;

function TabularChartRecord() {}

exports.TabularChartRecord = helpers.defineClass(TabularChartRecord, Article, {
	_clearMenuItems: function() {
		Article.prototype._clearMenuItems.call(this);
		if (this.menusBox) {
			this._menusSlot.style.display = "none";
			this.menusBox.layoutParent.removeItem(this.menusBox, true);
			this.removeMenuBag(this.menusBox);
			delete this.menusBox;
		}
	},
	onMenuDataFilled: function(menuItem) {
		if (menuItem.boxParent.isMenuGroup) {
			var menuGroupRoot = menuItem.boxParent.menuGroupRoot;
			if (menuGroupRoot.id == (this.id + "-menu-picker")) {
				if (!menuGroupRoot.$isPickerVisible) {
					this._menusSlot.style.display = "";
					menuGroupRoot.$isPickerVisible = true;
				}
			}
		}
	},
	drawBox: function() {
		this._menusSlot = document.createElement("div");
		this._menusSlot.style.position = "absolute";
		this._menusSlot.style.display = "none";
		document.site.toggleClass(this._menusSlot, "s-record-actions", true);
		this.menusBox = this.page.loadNewItem(this._menusSlot, {
			$isMenusBag: true,
			$category: "menus",
			$title: "-",
			$isTitlePicker: true,
			$isBoxCollapsable: true,
			$isPopupContent: true,
			$id: this.id + "-menu-picker",
			$skin: "s-record-menus"
		}, this);
		this.menusBox.contextField = this;
	},
	onMenuClick: function(menuItem) {
		return this._onGraphMenuClick ? this._onGraphMenuClick(menuItem) : true;
	},
	openMenuBox: function($links, event, onGraphMenuClick) {
		this.applyChange($links);
		this._onGraphMenuClick = onGraphMenuClick;
		this._menusSlot.style.top = event.pageY + "px";
		this._menusSlot.style.left = event.pageX + "px";
		this.menusBox.doOpenPicker();
		this.menusBox.$$body[0].style.top = event.pageY + "px";
		this.menusBox.$$body[0].style.left = event.pageX + "px";
	},
	dispose: function() {
		this._onGraphMenuClick = this.menusBox = null;
		Article.prototype.dispose.call(this);
	}
});