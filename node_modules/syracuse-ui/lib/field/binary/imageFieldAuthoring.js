"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Article = require("syracuse-ui/lib/article/article").Article;

function ImageFieldAuthoring(){

}

exports.ImageFieldAuthoring = helpers.defineClass(ImageFieldAuthoring, Article, {
    notifyChange: function($bind, value){
        var metaData = {};
        metaData[$bind] = value;
        this.designedField.applyDesignMetaData(metaData, true);
        this.applyChange(metaData);
        document.site.authoringView.notifyUpdate();
    },
    applyChange: function(newData){
        var metaData = {
            $properties: {}
        };
        if (newData) {
            Object.keys(newData).forEach(function($prop){
                var value = newData[$prop];
                if ($prop == "$isAutoSize") {
                    metaData.$properties.$imageHeight = {
                        $isDisabled: value
                    };
                }
                metaData[$prop] = value;
            });
        }
        Article.prototype.applyChange.call(this, metaData);
    },
    loadBox: function(initData){
        this.$prototype = {
            "$properties": {
                $imageWidth: {
                    $type: "application/x-string",
                    $title: this.designedField._localize.if_imageFieldWidth
                },
                $imageHeight: {
                    $type: "application/x-string",
                    $title: this.designedField._localize.if_imageFieldHeight
                },
                $isAutoSize: {
                    $type: "application/x-boolean",
                    $title: this.designedField._localize.if_imageFieldWidthIsAutoSize
                }
            }
        };
        this.$item = {
            $category: "section",
            $title: this.designedField._localize.ifa_imageSectionTitle,
            $layout: {
                $items: [{
                    $bind: "$isAutoSize",
                    $isEditMode: true,
                    $labelWidth: "auto",
                    $skin: "s-author-field"
                }, {
                    $bind: "$imageHeight",
                    $isEditMode: true,
                    $labelWidth: "auto",
                    $skin: "s-author-field"
                }]
            }
        };
        Article.prototype.loadBox.call(this, initData);
    },
    dispose: function(){
        Article.prototype.dispose.call(this);
    }
});
