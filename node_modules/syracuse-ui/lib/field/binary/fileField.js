"use strict";
var helpers = require('syracuse-core/lib/helpers');
var httpHelper = require('syracuse-sdata/lib/httpHelper');
var BinaryField = require('./binaryField').BinaryField;
//http://www.pdfobject.com/generator.php
//http://joliclic.free.fr/html/object-tag/
function FileField(){

}

exports.FileField = helpers.defineClass(FileField, BinaryField, {
    _renderEditMode: function(){
        BinaryField.prototype._renderEditMode.call(this, this.$skin + "-file");
    },
    _renderDetailMode: function($skin){
        if (!this.$item.$inplace) {
            //this.$field.$isEmbedded = true;
        }
        BinaryField.prototype._renderDetailMode.call(this, this.$skin + "-file");
    },
    _setFile: function(file){
        var self = this;
        if (file) {
            var $type = file.$contentType || file.type || this.$field.$contentType || "";
            var $dataUrl = self.articleParent.parseExpression(self.$dataUrl);
            if (this.$field.$isEmbedded) {
                self.embed = document.createElement("object");
                self.embed.setAttribute("width", "100%");
                self.embed.setAttribute("height", "100%");
                self.embed.setAttribute("type", $type);
                self.fieldValue.insertBefore(self.embed, self.fieldValue.firstChild);
                //self.embed.setAttribute("data", $dataUrl);
                //self.embed.setAttribute("data", "http://localhost:8124/syracuse-ui/themes/syracuseForSageup.pdf" + "#view=FitB");
                //self.embed.setAttribute("data", "http://localhost:8124/syracuse-ui/themes/test.docx" + "#view=FitB");
            
                //self.embed.setAttribute("src", $dataUrl);// "http://localhost:8124/sdata/syracuse/collaboration/syracuse/documents(%27a8d6428f-8f87-4dc1-833e-38253335741e%27)/content");
                // self.embed.setAttribute("src", "http://www.pdfobject.com/pdf/pdfobject.pdf#view=FitH&pagemode=thumbs&search=pdfobject&toolbar=0&statusbar=0&messages=0&navpanes=1");
            
            
            }
            else {
                if (!self._image) {
                    self._image = document.createElement("img");
                    self._image.style.display = "none";
                    self._image.onload = function(){
                        clearTimeout(self._defaultFileTimeOut);
                        self._image.className = self.$skin + "-file-img";
                        self._image.style.display = "";
                    };
                    self.anchor.appendChild(self._image);
                }
                self._defaultFileTimeOut = setTimeout(function(){
                    if (self.anchor) {
                        document.site.toggleClass(self.anchor, self.$skin + "-file-default", true);
                    }
                }, 1000);
                
                var image = httpHelper.defaultIcon($type);
                if (!image) {
                    image = $type.replace("application/", "");
                    image = (image.indexOf("image") >= 0) ? "image" : image.replace("/", "-");
                }
                self._image.src = document.site.$item.$iconPath + "/file/s-file-" + (image || "default") + ".png";
                if (self.removeBtn && !self.$isReadOnly) {
                    self.removeBtn.style.display = "";
                }
                self.anchor.setAttribute("target", "_blank");
                self.anchor.setAttribute("href", $dataUrl);
                self.anchor.setAttribute("disabled", false);
            }
            
        }
        else {
            if (self._image) {
                delete self._image.onload;
                delete self._image;
            }
            document.site.emptyDom(self.anchor);
            document.site.toggleClass(self.anchor, self.$skin + "-file-default", false);
            self.anchor.setAttribute("href", "#");
            self.anchor.setAttribute("disabled", true);
            if (self.removeBtn) {
                self.removeBtn.style.display = "none";
            }
        }
    }
});
