"use strict";
//var io = require('syracuse-ui/deps/socket.io-client');


var _toggleWindow = function() {
	var $$notifPanel = $(".s-notif-panel");
	if ($$notifPanel.length > 0) {
		$$notifPanel.toggle();
	} else {
		var notifPanelTmpl = '\
			<div class="s-notif-panel">\
				<header>NOTIFICATIONS</header>\
				<section>{{{notifications}}}</section>\
				<footer></footer>\
			</div>';
		$$notifPanel = $(notifPanelTmpl);

		// append notifpanel
		$(document.body).append($$notifPanel);
	}

};


var _appendTrigger = function() {

	// dom element before which trigger button will be added
	var $$siteOpener = $(".s-site-help-link");

	// building trigger button
	var $$trigger = $("<a>Trigger</a>");
	$$trigger.css("display", "table-cell");
	$$trigger.css("width", "35px");
	$$trigger.css("color", "white");
	$$trigger.css("vertical-align", "middle");

	// bind function on click
	$$trigger.click(_toggleWindow);

	// append trigger button
	$$trigger.insertBefore($$siteOpener);


	// IO CONNECTION
	var host = "http://" + window.location.host;
	console.log("CONNECTION:" + host);
	var socket = io.connect(host);

	// on message receive
	socket.on("message", function(msg) {
		console.log("message received : " + JSON.stringify(msg, null, 2));
		// TODO : DISPLAY MESSAGE SOMEWHERE
	});


	// on get events return (events is an array)
	socket.on("events", function(events) {
		console.log("events received : " + JSON.stringify(events, null, 2));
		// TODO : DISPLAY MESSAGE SOMEWHERE
	});

	// TODO : Retrieve real login
	var login = "admin";
	socket.emit("connect", login);


	// Example to send a message
	// send message
	//	 var msg = {
	//		title: "Hello",	
	//		message: "Test Message",
	//		from: login,
	//		to: ['admin', 'Teddy', 'Christophe'],
	//		severity: "info"
	//	 };
	//	 socket.emit("message",msg);
	//


	// NOT DONE YET ON SERVER SIDE !!
	// Example to retrieve events
	//	 var count = 30; // default to 20 if coutnis not given here !
	//	 socket.emit("get events", count);

};

exports.appendTrigger = _appendTrigger;