"use strict";
var helpers = require('syracuse-core/lib/helpers');
var TabsLayout = require("syracuse-ui/lib/common/article/layouts/tabsLayout").TabsLayout;

function MobileTabsLayout(){
}

exports.MobileTabsLayout = helpers.defineClass(MobileTabsLayout, TabsLayout, {
    appendChildTab: function(box){
        var self = this;
        box.$$header = box.$$title = $("<a/>").attr("data-theme", box.getPage().$layoutOptions.theme.$navbar);
        if (!self._$$tabs) {
            self._$$tabs = $("<div/>").attr("data-role", "navbar").prependTo(self.$$container);
            self._$$ul = $("<ul/>").appendTo(self._$$tabs);
            self._$$tabs.delegate("a", "click", function(){
                if (!document.authoringSite.dragDrop) {
                    var tabItem = self.items[$(this).parent().index()];
                    if (self.tabOpened != tabItem) {
                        var open = !tabItem.$$header.hasClass("s-open");
                        tabItem.openBox(open);
                    }
                    return tabItem.authoringNode ? true : false; //authoringNode => true hooked by layout
                }
            });
        }
        box.$$header.appendTo($("<li/>").appendTo(self._$$ul));
    },
    openTab: function(item, open){
        TabsLayout.prototype.openTab.call(this, item, open);
        item.$$header.toggleClass("ui-btn-active", open);
    },
    render: function(){
        TabsLayout.prototype.render.call(this);
        if (this._$$tabs) {
            this._$$tabs.navbar();
        }
    }
});
