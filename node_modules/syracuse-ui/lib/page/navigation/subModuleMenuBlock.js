"use strict";
var _megaDetailPanel = require('./megaDetailPanel');
var _menuItem = require('./menuItem');

function SubModuleMenuBlock() {}

SubModuleMenuBlock.prototype.load = function(dataset) {
	//test par rapport au submodule
	var css = this.isHLayout ? {
		slot: "s-mega-sub-menu-block-slot",
		title: "s-mega-sub-menu-block-title",
		titleLink: "s-mega-link-slot"
	} : {
		slot: "s-mega-block-slot",
		title: "s-mega-block-title",
		titleLink: "s-mega-link-slot"
	};

	this.record = dataset;
	this.domItem = this.slot;
	this.domItem.syrainout = this.id;
	this.title = syra_dom.div(css.title, this.domItem);
	this.title.textContent = dataset.title;

	if (this.isHLayout) {
		this.megaDetailPanel = _megaDetailPanel.add(this);
	} else {
		this.body = syra_dom.div("s-mega-block-body");
	}
	this.children = [];
	for (var ii = 0, jj = dataset.items.length; ii < jj; ii++) {
		var item = dataset.items[ii];
		var dataItem = item.menuItem || item.menuBlock;
		if (dataItem) {
			var child;
			if (item.menuItem) {
				child = _menuItem.add(this);
				child.slot = syra_dom.li(css.titleLink, this.isHLayout ? this.megaDetailPanel.firstColumnSlot() : this.body);
			} else {
				child = exports.add(this);
				if (this.megaDetailPanel && this.megaDetailPanel.firstColumnSlot()) {
					child.slot = syra_dom.li(css.slot, this.megaDetailPanel.firstColumnSlot());
				} else {
					child.slot = syra_dom.li(css.slot, this.body);
				}
			}
			this.children.push(child);
			child.load(dataItem);
		}
	}
	if (!this.isHLayout) {
		this.domItem.appendChild(this.body);
	}
};
SubModuleMenuBlock.prototype.onItemInOut = function(onEnter) {
	onEnter && this.activate(true);
};
SubModuleMenuBlock.prototype.onActivated = function() {
	if (this.isHLayout) {
		this.megaDetailPanel.activate();
	}
};
SubModuleMenuBlock.prototype.activate = function(on) {
	this.isHLayout && this.page.activateItem(this, on);
};
SubModuleMenuBlock.prototype.dispose = function() {
	syra_item.unregister(this);
	syra_site.disposeObject(this);
};

exports.add = function(navParent) {
	var block = syra_item.initialize(navParent.page, new SubModuleMenuBlock());
	block.navParent = this;
	block.submodule = navParent.submodule || navParent;
	return block;
};