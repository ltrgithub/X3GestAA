"use strict";
var helpers = require('syracuse-core/lib/helpers');
var ModuleRecord = require("./moduleRecord").ModuleRecord;
var MultiList = require("syracuse-ui/lib/field/array/multiList").MultiList;

function ModuleList(){

}

exports.ModuleList = helpers.defineClass(ModuleList, MultiList, {
    loadBox: function(initData){
        this.emptyMessage = this.localize.navigPageNoModule;
        this.$confirmDelete = this.localize.navigPageConfirmDeleteModule;
        this.$isEditMode = false;
        this.$isQuickDesignerEnabled = false;
        this.$item.$iconPath = "page/s-nav-";
		this.$item.$skinMenus = "s-nav-list-menus";
        this.$item.$isPagerHidden = true;
        this.$item.$selectMode = "row";
        this.selectFirstByDefault = true;
        MultiList.prototype.loadBox.call(this, initData);
    },
    drawBox: function(){
        MultiList.prototype.drawBox.call(this);
        this.body = this._core;
        this.fieldValue.style.overflow = "auto";
        this.$skin = this.$item.$skin || "s-cards";
        this.applyDesignMetaData(this.$item, false);
        this.loadSelector();
        this.applyCapabilities();
        document.site.ddManager.toggleColResizerObserver(this, true);
        this.ensureLayoutMode();
        this.layoutSlot.appendChild(this.domItem);
        this.topbar.className += " s-nav-modules-bar";
        this._core.parentNode.appendChild(this.topbar);
    },
    initializeList: function(){
        this.$item.$isTopLabelAlignment = true;
        this.RecordClass = ModuleRecord;
        if (!this.$item.$layout || !this.$item.$layout.$items) {
            this.$item.$layout = this.defineDefaultCard().$layout;
        }
        MultiList.prototype.initializeList.call(this);
    },
    onItemEnterLeave: function(event){
        this.page.toggleCssOnEnter(this.menusSlot, event);
        this.page.showOnEnter(this.reorderPicker, event);
    },
    _createMenusBox: function(){
        if (!this.isMenuLoaded) {
            this.isMenuLoaded = true;
            this.onItemEnterLeave();
            if (this.page.isAdminMode) {
				var $item;  
				($item =this.defineNewIconMenu("$create", this.$skinMenus + "-link")).$icon.$value = "new-module";
				this.page.loadNewItem(this.menusSlot,$item, this);
				($item =this.defineNewIconMenu("$select", this.$skinMenus + "-link")).$icon.$value = "select-module";
                this.page.loadNewItem(this.menusSlot, $item, this);
            }
        }
    },
    onWindowResize: function(){
        if (!this.disposed && this.records) {
            for (var ii = 0, jj = this.records.length; ii < jj; ii++) {
                this.records[ii].resizeResizableChildren();
            }
        }
    },
    isDraggable: function(target, event){
        return this.isReorderRecordDraggable(target, event);
    },
    dispose: function(){
        document.site.emptyDom(this._core);
        this.rows = null;
        MultiList.prototype.dispose.call(this);
    }
});
