"use strict";
var helpers = require('syracuse-core/lib/helpers');
var BarSplitter = require("syracuse-ui/lib/page/utility/barSplitter").BarSplitter;

function MenuBar() {}

exports.MenuBar = helpers.defineClass(MenuBar, BarSplitter, {
	load: function(page, layoutSlot, barSlot, barBody) {
		this.options = {
			resizeDirection: {
				left: true
			},
			$skins: {
				bar: page.$skin + "-menubar",
				openerPicker: page.$skin + "-menubar-opener",
				resizeBar: page.$skin + "-menubar-resizer"
			}
		};
		page.initializeNewItem(this);
		var preferences = document.site.ensurePreferences() || {};
		if (!preferences.menuBar) {
			preferences.menuBar = {
				isDocked: true,
				isCollapsed: false
			};
		};
		this.preferences = preferences.menuBar;

		this._barSlot = document.createElement("div");
		this._barSlot.className = page.$skin + "-menubar-slot";
		this._barSlot.style.display = "none";

		this._barBody = document.createElement("div");
		this._barBody.className = page.$skin + "-menubar-body";

		if (page.$pageCategory == "vignette" || page.$pageCategory == "dashboard") {
			this.page._item.insertBefore(this._barSlot, this.page._item.firstChild);
			if (page.$pageCategory == "vignette") {
				this.preferences = {}; //temp for preference management
			}
		} else {
			this.page._item.appendChild(this._barSlot);
		}
		BarSplitter.prototype.load.call(this, page, null, this._barSlot, this._barBody);
	},
	onBarBodyAdded: function() {
		this.page.appendArticleMenus(this._barBody);
	},
	onMenuDataFilled: function(menuItem) {
		if (!this.isSlotVisible && !this.isHidden) {
			if (menuItem.boxParent.menuGroupRoot) {
				if (menuItem.boxParent.menuGroupRoot.$item.$isMenuPage) {
					this.isSlotVisible = true;
					if (!this.page.designer) {
						this._barSlot.style.display = "";
						if (this.page.layoutSlot.style.display != "none") {
							document.site.resize();
						}
					}
				}
			}
		}
	}
});