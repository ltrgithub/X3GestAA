"use strict";
exports.load = function(page) {
	page.layoutContent.layoutSlot.appendChild(syra_menus.addTextButton("Copy Old Dashboard and click", "s-uitest-mn", "onConvertClick"));
	var col = page.addCol(page.layoutContent.layoutSlot, "50%");
	var label = col.appendChild(document.createElement("label"));
	label.className = "s-uitest-h1";
	label.textContent = "Old Dashboard";
	page.sourceJson = col.appendChild(document.createElement("textArea"));
	page.sourceJson.setAttribute("rows", 40);
	page.sourceJson.className = "s-json-field-input";

	var col = page.addCol(page.layoutContent.layoutSlot, "50%");
	label = col.appendChild(document.createElement("label"));
	label.className = "s-uitest-h1";
	label.textContent = "New Dashboard";
	page.convertedJson = col.appendChild(document.createElement("textArea"));
	page.convertedJson.setAttribute("rows", 40);
	page.convertedJson.className = "s-json-field-input";


	page.onConvertClick = function() {
		var json = JSON.parse(this.sourceJson.value);
		var $links = json.$prototype.$links;
		var keys = Object.keys($links);
		var $sections = {};
		Object.keys($links).forEach(function(key) {
			var $link = $links[key];
			if ($link.$vignettes) {
				var id = $link.$vignettes[0];
				delete $link.$vignettes;
				var $section = $sections[id];
				if (!$section) {
					$section = $sections[id] = {};
					var $vignette = json.$prototype.$properties[id];
					$section.$title = ($vignette && $vignette.$title) || id;
				}
				($section.$menus = $section.$menus || []).push($link);
			}
		});
		/*for (var ii = 0, jj = keys.length; ii < jj; ii++) {
         var $link = $links[keys[ii]];
         if ($link.$vignettes) {
         var id = $link.$vignettes[0];
         delete $link.$vignettes;
         var $section = $sections[id];
         if (!$section) {
         $section = $sections[id] = {};
         var $vignette = json.$prototype.$properties[id];
         $section.$title = ($vignette && $vignette.$title) || id;
         }
         ($section.$menus = $section.$menus || []).push($link);
         }
         }*/
		$sections = Object.keys($sections).map(function(id) {
			return $sections[id];
		});
		this.convertedJson.value = JSON.stringify($sections);
	};
	page.onFieldInputEvent = function(event, target) {

	};
};