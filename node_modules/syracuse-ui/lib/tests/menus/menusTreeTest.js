"use strict";
var helpers = require("syracuse-core/lib/helpers");
var TestPage = require("syracuse-ui/lib/tests/testPage").TestPage;
var menuTreeSettings = require("./menuTreeSettings");

function MenusTreeTest() {}

exports.MenusTreeTest = helpers.defineClass(MenusTreeTest, TestPage, {
	_initiliazeTestPage: function() {
		syra_site.deltaManager.applyObjectDelta(this, this.$prototype, menuTreeSettings.$prototype, true);
		this.$item.$layout = menuTreeSettings.$layout;
	},
	notifyActionChange: function(menuItem, target, value) {
		var action = this.$prototype.$actions[Object.keys(value)[0]];
		if (action && action.$bind.indexOf("menutest") == 0) {
			this.applyChange({
				$fieldJsonDelta: JSON.stringify(action.testcase, null, 2)
			});
			var layoutContent = this.idMap["$result"].layoutContent;
			if (layoutContent.items.length > 0) {
				layoutContent.removeItem(layoutContent.items[0], true);
			}
			layoutContent.createChildItem(action.testcase);
			return;
		}
		TestPage.prototype.notifyActionChange.call(this, menuItem, target, value);
	},
	loadBox: function() {
		TestPage.prototype.loadBox.call(this);
	}
});