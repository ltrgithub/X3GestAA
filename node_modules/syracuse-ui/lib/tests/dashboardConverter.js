"use strict";
exports.load = function(page) {
	page.setTitle("DashboardConverter");
	page.leftCol.style.width = "50%";
	page.leftCol.parentNode.insertBefore(syra_menus.addTextButton("Copy Old Dashboard and click", "s-uitest-mn", "onConvertClick"), page.leftCol);
	var label = page.leftCol.appendChild(document.createElement("label"));
	label.className = "s-uitest-h1";
	label.textContent = "Old Dashboard";
	page.sourceJson = page.leftCol.appendChild(document.createElement("textArea"));
	page.sourceJson.setAttribute("rows", 40);
	page.sourceJson.className = "s-json-field-input";

	page.rightCol.style.width = "50%";
	label = page.rightCol.appendChild(document.createElement("label"));
	label.className = "s-uitest-h1";
	label.textContent = "New Dashboard";
	page.convertedJson = page.rightCol.appendChild(document.createElement("textArea"));
	page.convertedJson.setAttribute("rows", 40);
	page.convertedJson.className = "s-json-field-input";


	page.onConvertClick = function() {
		var json = JSON.parse(this.sourceJson.value);
		var $links = json.$prototype.$links;
		var keys = Object.keys($links);
		var $sections = {};
		Object.keys($links).forEach(function(key) {
			var $link = $links[key];
			if ($link.$vignettes) {
				var id = $link.$vignettes[0];
				delete $link.$vignettes;
				var $section = $sections[id];
				if (!$section) {
					$section = $sections[id] = {};
					var $vignette = json.$prototype.$properties[id];
					$section.$title = ($vignette && $vignette.$title) || id;
				}
				($section.$menus = $section.$menus || []).push($link);
			}
		});
		$sections = Object.keys($sections).map(function(id) {
			return $sections[id];
		});
		this.convertedJson.value = JSON.stringify($sections);
	};
	page.onFieldInputEvent = function(event, target) {

	};
};