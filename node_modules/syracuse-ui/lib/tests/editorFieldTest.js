"use strict";
var helpers = require("syracuse-core/lib/helpers");
var FieldsTest = require("./fieldsTest").FieldsTest;

function EditorFieldTest() {}

exports.EditorFieldTest = helpers.defineClass(EditorFieldTest, FieldsTest, {
	_initiliazeTestPage: function() {
		FieldsTest.prototype._initiliazeTestPage.call(this);
		this.ensureDeltaManager().applyObjectDelta(this.$prototype.$properties, {
			"$field$TestProperty": {
				$title: "$editMode",
				$type: "application/x-choice",
				$value: {
					$type: "application/x-integer",
					$enum: [{
						$value: "array",
						$title: "array (default)"
					}, {
						$value: "record",
						$title: "record"
					}, {
						$value: "cell",
						$title: "cell"
					}]
				}
			},
			"$field$rows": {
				$title: "$rows",
				$type: "application/x-string",
			},
			"$field$output": {
				$title: "output",
				$type: "application/x-string",
			},
			"textrtf": {
				$title: "text-rtf",
				$type: "text/rtf",
				$maxLength: 500,
				$capabilities: "sort,filter,alphaTab,raw",
				$links: {
					$tunnel: {},
					$lookup: {}
				}
			},
			"texthtml": {
				$title: "text-html",
				$type: "text/html",
				$links: {
					$tunnel: {},
					$lookup: {}
				}
			},
			"textplain": {
				$title: "text-plain",
				$type: "text/plain",
				$links: {
					$tunnel: {},
					$lookup: {}
				}
			}
		}, true);
	},
	loadBox: function() {
		FieldsTest.prototype.loadBox.call(this, {
			"$field$TestProperty": "record",
			"textplain": "Hello World!!!",
			"textrtf": "{\\rtf1\\ansi{\\fonttbl{\\f0 Bitstream Charter;}} {\\f0 \\fs24 Ceci est un texte accentu\\u233 }\\par \\par {\\f0 des \\fs18 petits}{\\f0  et des \\fs32 gros}\\f0 .}",
			"texthtml": "<h1>Hi</h1><p>This is very minimal \"hello world\" HTML document.</p>"
		});
	},
	appendSettingsBar: function() {
		var $items = FieldsTest.prototype.appendSettingsBar.call(this);
		$items.unshift({
			$category: "section",
			$title: "Html Editor Specific",
			$layout: {
				$items: [{
					$bind: "$field$TestProperty",
					$isEditMode: true
				}, {
					$bind: "$field$rows",
					$isHidden: true
				}, {
					$bind: "$field$output",
					$isEditMode: false
				}]
			}
		});
		return $items;
	},
	notifyDataChange: function(field, value) {
		switch (field.$item.$bind) {
			case "$field$TestProperty":
				alert(value);
				break;
			default:
				FieldsTest.prototype.notifyDataChange.call(this, field, value);
				break;
		}
		var rtfField = this.boundFields["textrtf"][0],
			msg = "textrtf: caret=" + rtfField.getCaretPosition() + ", data=" + rtfField.getInputValue();

		this.boundFields["$field$output"][0].setDataValue(msg);
	},
	_makeBlock: function($isEditMode) {
		return [this._makeEditReadBlock("textplain", [{
			"$bind": "textplain"
		}]), this._makeEditReadBlock("textrtf", [{
			"$bind": "textrtf",
			"$rows": 5
		}]), this._makeEditReadBlock("texthtml", [{
			"$bind": "texthtml",
			"$rows": 5
		}])];
	}
});