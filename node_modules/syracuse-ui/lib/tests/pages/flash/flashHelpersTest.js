"use strict";

var flashHelpers = require("syracuse-ui/lib/field/chart/flashHelpers");
var Tree = require("syracuse-ui/lib/field/chart/flashHelpers").Tree;
var jsxml = require("jsxml/lib/jsxml");

QUnit.module(module.id);

test("Flash Xml Builder", function() {
	var xb = flashHelpers.xmlBuilder("agenda", {
		uersLang: "BRI"
	});

	// Initial content
	equal(xb.xml(), //
		'<X3PORTAL><Data/><Technical><HtcProvType>TABLEBLOC</HtcProvType><DataSrc Type="AGD" Code=""/>' //
		+
		'<VisCmp Type="FAG"/><UserLang>BRI</UserLang></Technical><Messages/></X3PORTAL>', //
		"Initial content");

	var title = xb.addNode("Data.Titles.Title", "My title");

	// Title value
	strictEqual(title.$value, "My title", "Title");

	// Adding Title content
	equal(xb.xml(), //
		'<X3PORTAL><Data><Titles><Title>My title</Title></Titles></Data><Technical><HtcProvType>TABLEBLOC</HtcProvType><DataSrc Type="AGD" Code=""/>' //
		+
		'<VisCmp Type="FAG"/><UserLang>BRI</UserLang></Technical><Messages/></X3PORTAL>', //
		"Adding Title content");

	xb.$.Data.Titles.Title.$value = "";
	equal(xb.xml(), //
		'<X3PORTAL><Data><Titles><Title></Title></Titles></Data><Technical><HtcProvType>TABLEBLOC</HtcProvType><DataSrc Type="AGD" Code=""/>' //
		+
		'<VisCmp Type="FAG"/><UserLang>BRI</UserLang></Technical><Messages/></X3PORTAL>', //
		"Empty Title value");

	// Adding ColTitle content
	for (var i = 1; i < 13; i++) {
		xb.addNode("Data.Titles.ColTitle", null, {
			Num: "" + i,
			X3Type: "7"
		});
	}
	var xml = '<X3PORTAL><Data><Titles><Title></Title>' //
	+
		'<ColTitle Num="1" X3Type="7"/>' //
	+
		'<ColTitle Num="2" X3Type="7"/>' //
	+
		'<ColTitle Num="3" X3Type="7"/>' //
	+
		'<ColTitle Num="4" X3Type="7"/>' //
	+
		'<ColTitle Num="5" X3Type="7"/>' //
	+
		'<ColTitle Num="6" X3Type="7"/>' //
	+
		'<ColTitle Num="7" X3Type="7"/>' //
	+
		'<ColTitle Num="8" X3Type="7"/>' //
	+
		'<ColTitle Num="9" X3Type="7"/>' //
	+
		'<ColTitle Num="10" X3Type="7"/>' //
	+
		'<ColTitle Num="11" X3Type="7"/>' //
	+
		'<ColTitle Num="12" X3Type="7"/>' //
	+
		'</Titles></Data><Technical>' //
	+
		'<HtcProvType>TABLEBLOC</HtcProvType><DataSrc Type="AGD" Code=""/>' //
	+
		'<VisCmp Type="FAG"/><UserLang>BRI</UserLang></Technical><Messages/></X3PORTAL>';
	// var obj = jsxml.parse(xml);
	equal(xb.xml(), xml, "Adding ColTitle content");

	delete xb.$.Data.Titles.ColTitle;

	// for (var i = 1; i < 4; i++) {
	// 	var line = xb.addNode("Data.Lines.Line", null, {
	// 		Num: i + 1
	// 	});

	// 	for (var j = 1; j < 2; j++) {
	// 		xb.addChild(line, {
	// 			Col: {
	// 				$: {
	// 					Num: i
	// 				},
	// 				X3IntVal: {
	// 					$value: "vi" + i
	// 				},
	// 				X3Value: {
	// 					$value: "vv" + i
	// 				}
	// 			}
	// 		});
	// 	}
	// }

	// Adding ColTitle with X3IntVal and X3Value
	xml = '<X3PORTAL><Data><Titles><Title></Title>';
	for (var i = 1; i < 13; i++) {
		xml += '<ColTitle Num="' + i + '" X3Type="7"/>';
		xb.addChild(xb.$.Data.Titles, {
			ColTitle: {
				$: {
					Num: i,
					X3Type: 7
				}
			}
		});
	}
	xml += '</Titles></Data>';
	xml += '<Technical><HtcProvType>TABLEBLOC</HtcProvType><DataSrc Type="AGD" Code=""/>';
	xml += '<VisCmp Type="FAG"/><UserLang>BRI</UserLang></Technical><Messages/></X3PORTAL>';
	equal(xb.xml(), xml, "Adding ColTitle with X3IntVal and X3Value");

});