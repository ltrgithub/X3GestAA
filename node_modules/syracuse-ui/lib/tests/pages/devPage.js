"use strict";
var helpers = require("syracuse-core/lib/helpers");
var DesktopPage = require("syracuse-ui/lib/page/desktopPage").DesktopPage;

function DevPage() {}

exports.DevPage = helpers.defineClass(DevPage, DesktopPage, {
	addBox: function($title) {
		var box = {
			slot: document.createElement("div"),
			body: document.createElement("div")
		};
		box.slot.className = "s-nav-submodule";
		if ($title) {
			box.head = document.createElement("h2");
			box.head.className = "s-nav-submodule-head";
			box.title = document.createElement("h2");
			box.title.className = "s-nav-submodule-title";
			box.head.appendChild(box.title).textContent = $title;
			box.slot.appendChild(box.head);
		}
		box.slot.appendChild(box.body).className = "s-nav-submodule-body";
		return box;
	},
	addCol: function(slot, width) {
		var col = slot.appendChild(document.createElement("div"));
		col.className = "s-uitest-col";
		if (width) {
			col.style.width = width;
		}
		return col;
	},
	loadBox: function(initData) {
		var self = this;
		self.isAutoInsertFieldDisabled = true;
		self.isMenuBarDisabled = true;
		syra_pageBuilder.initialize(self);
		self.$prototype.$properties = self.$prototype.$properties || {};
		DesktopPage.prototype.loadBox.call(self, initData);
		require.async("syracuse-ui/lib/tests/pages/" + self.$prototype.$devName, function(err, module) {
			if (err && err.message) {
				syra_diagnose.showDiagnoses({
					$diagnoses: [{
						$severity: "error",
						$message: err.message
					}]
				});
			} else {
				self.devModule = module.map;
				var $links = {};
				self.devModule.$items.forEach(function($block, blockIndex) {
					var box = self.addBox($block.$title, "mn");
					self.layoutContent.domItem.appendChild(box.slot);
					box.cols = [];
					for (var mm = 0; mm < 4; mm++) {
						var col = document.createElement("div");
						col.className = "s-uitest-col";
						col.style.width = "25%";
						box.cols.push(col);
						box.body.appendChild(col);
					}
					var colIndex = 0;
					$block.$menus.forEach(function($menu, menuIndex) {
						var id = self.id + "-link-" + blockIndex + "-" + menuIndex;
						$links[id] = $menu;
						self.loadNewItem(box.cols[colIndex++], {
							$category: "link",
							$skin: "s-nav-menu-link",
							$bind: id
						});
						if (colIndex == 4) {
							colIndex = 0;
						}
					});
				});
				self.applyChange({
					$title: self.devModule.$title,
					$links: $links
				});
				self.resizeArticle(true);
			}
		});

	}
});