"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Article = require("syracuse-ui/lib/common/article/article").Article;


function CardRecord(){
}

exports.CardRecord = helpers.defineClass(CardRecord, Article, {
    initializeRecord: function(options){
        var rowIndex;
        if (this.builder.rows.length == 0) {
            this.row = this.builder.appendCardsRow();
        }
        else {
            this.row = this.builder.rows[this.builder.rows.length - 1];
        }
        if (this.list.$item.$cardsByRowCount) {
            if (this.row.count == this.list.$item.$cardsByRowCount) {
                this.row = this.builder.appendCardsRow();
            }
        }
        else {
            var div = document.createElement("div");
            div.className = this.list.$recordCss;
            div.style.visibility = "hidden";
            this.row.$$cells.push($(div).appendTo(this.row.$$row));
        }
        this.cellIndex = this.row.count++;
        options.$item = {
            $category: "section",
            $layout: {
                $items: this.list.$item.$layout.$items
            }
        };
    },
    remove: function(){
        this.$$item.remove();
    },
    applyMetaData: function(metaData){
    },
    drawBox: function(){
        this.$$item = this.row.$$cells[this.cellIndex].attr("data-s-record", this.$recordUuid);
        if (this.list.$alternateStyle && this.$recordIndex % 2) {
            this.$$item.addClass(this.list.$alternateSkin);
        }
        var selectorCell = document.createElement("div");
        var $$selectorCell = $(selectorCell).appendTo(this.$$item);
        
        var dom = document.createElement("div");
        dom.className = this.list.$skin + "-record";
        var $$data = $(dom).appendTo(this.$$item);
        if (!this.list.$item.$isMenuRecordHidden) {
            dom = document.createElement("div");
            dom.className = this.list.$skin + "-menu-row";
            this.$$menuContainer = $(dom).appendTo(this.$$item);
        }
        if (this.list.recordSelector.hasColumn) {
            selectorCell.className = this.list.$skin + this.list.recordSelector.css;
            $$selectorCell.append(this.$$selector = $(this.list.recordSelector.record));
        }
        else {
            selectorCell.style.display = "none";
        }
        document.itemFactory.load($$data, this.list.$item.$cardview, this);
        this.$$item[0].style.visibility = "";
    },
    highlightSelection: function(selected){
        document.site.toggleClass(this.$$item[0], "s-list-record-selected", selected);
        if (this.$$selector && this.$$selector.is("input")) {
            this.$$selector.attr('checked', selected);
        }
    },
    dispose: function(){
        delete this.list
        delete this.builder;
        delete this.row;
        delete this.menus;
        Article.prototype.dispose.call(this);
    }
});
