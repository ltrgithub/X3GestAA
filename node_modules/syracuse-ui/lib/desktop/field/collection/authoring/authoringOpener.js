"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Article = require("syracuse-ui/lib/common/article/article").Article;
var ListAuthoring = require("./listAuthoring").ListAuthoring;

function QuickDesigner(){

}

exports.QuickDesigner = helpers.defineClass(QuickDesigner, null, {
    appendOpener: function(list){
        var self = this;
        var dom = document.createElement("a");
        dom.className = "s-list-quick-designer";
        dom.setAttribute("href", "#");
        self.$$opener = $(dom).bind("click", function(){
            if (!self.authoring) {
                self.authoring = new ListAuthoring();
                self.authoring.$$opener = self.$$opener;
                self.authoring.designedField = list;
                self.authoring.toggleQuick(true);
            }
            else {
                self.authoring.toggleQuick(false);
                delete self.authoring;
            }
            return false;
        });
        dom = document.createElement("div");
        dom.className = "s-list-quick-designer-cell";
        $(dom).append(self.$$opener).prependTo(list.$$topbar);
    },
    dispose: function(){
        if (this.$$opener) {
            this.$$opener.unbind();
            delete this.$$opener;
        }
    }
});

function WidgetAuthoring(){

}

exports.WidgetAuthoring = helpers.defineClass(WidgetAuthoring, Article, {
    loadBox: function(initData){
        var self = this;
        if (!self.$$item) {
            var dom = document.createElement("a");
            dom.className = "s-list-main-designer";
            self.$$item = $(dom);
            dom = document.createElement("div");
            dom.className = "s-list-main-designer-icon s-top-link-author-open";
            self.$$item.append(dom);
            
            dom = document.createElement("div");
            dom.className = "s-top-link-title";
            var $$title = $(dom).appendTo(self.$$item);
            $$title.text("Design the current list");
            
            dom = document.createElement("div");
            dom.className = "s-top-link-desc";
            $(dom).appendTo($$title).text("Launch the authoring panel");
            
            self.$$item.bind("click", function(){
                if (!self.authoring) {
                    self.authoring = new ListAuthoring();
                    self.authoring.$$opener = self.$$item;
                    self.authoring.designedField = self.designedField;
                    self.authoring.toggleQuick(true);
                }
                else {
                    self.authoring.toggleQuick(false);
                    delete self.authoring;
                }
                return false;
            }).appendTo(self.$$container);
        }
    },
    dispose: function(){
        if (this.$$item) {
            this.$$item.unbind();
            delete this.$$item;
        }
        delete this.designedField;
        Article.prototype.dispose.call(this);
    }
});
