"use strict";
var helpers = require('syracuse-core/lib/helpers');
var BinaryField = require('./binaryField').BinaryField;

function FileField(){

}

exports.FileField = helpers.defineClass(FileField, BinaryField, {
    _renderEditMode: function(){
        BinaryField.prototype._renderEditMode.call(this, this.$skin + "-file");
    },
    _renderDetailMode: function($skin){
        BinaryField.prototype._renderDetailMode.call(this, this.$skin + "-file");
    },
    _setFile: function(file){
        var self = this;
        if (file) {
            var $type = file.$contentType || file.type || "";
            if (!self._image) {
                self._image = document.createElement("img");
                self._image.style.display = "none";
                self._image.onload = function(){
                    clearTimeout(self._defaultFileTimeOut);
                    self._image.className = self.$skin + "-file-img";
                    self._image.style.display = "";
                };
                $(self._image).appendTo(self.$$anchor);
            }
            self._defaultFileTimeOut = setTimeout(function(){
                if (self.$$anchor) {
                    self.$$anchor.toggleClass(self.$skin + "-file-default", true);
                }
            }, 1000);
            
            var image = $type.replace("application/", "");
            image = (image.indexOf("image") >= 0) ? "image" : image.replace("/", "-");
            self._image.src = document.site.$item.$iconPath + "/fileType/s-file-" + image + ".png";
            if (self.remove) {
                self.remove.style.display = "";
            }
            self.$$anchor.attr("target", "_blank").attr("href", self.getArticle().parseExpression(self.$dataUrl)).attr("disabled", false);
        }
        else {
            if (self._image) {
                delete self._image.onload;
                delete self._image;
            }
            self.$$anchor.empty().toggleClass(self.$skin + "-file-default", false).attr("href", "#").attr("disabled", true);
            if (self.remove) {
                self.remove.style.display = "none";
            }
        }
    }
});
