"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Layout = require('./layout').Layout;

function ColumnsLayout(){
}

exports.ColumnsLayout = helpers.defineClass(ColumnsLayout, Layout, {
    applySeparatorsVisibility: function(){
        var visible = this.box.$item.$isSeparatorsVisible;
        var css = this.box.$skin + "-border-cell";
        this.items.forEach(function(item, index){
            document.site.toggleClass(item.$$container[0], css, visible);
        });
        if (this.layoutAuthoring) {
            if (this._domTable) {
                document.site.toggleClass(this._domTable, "s-author-layout-table-on", !visible);
            }
            this.items.forEach(function(item, index){
                document.site.toggleClass(item.$$container[0], "s-author-layout-col", !visible);
            });
        }
    },
    _wrapInSlot: function(item, columnIndex){
        var cell = document.createElement("div");
        item.$$container = $(cell);
        if (this.box.$item.$isSeparatorsVisible) {
            document.site.toggleClass(cell, this.box.$skin + "-border-cell", true);
        }
        cell.style.display = "table-cell";
        cell.style.verticalAlign = "top";
        cell.style.width = this.colWidths[columnIndex] + "%";
        if (!this._domTable) {
            this._domTable = document.createElement("div");
            this._domTable.style.display = "table";
            if (!this.$layout.$fitToContent) {
                this._domTable.style.width = "100%";
            }
            this._domTable.style.tableLayout = "fixed";
            /* if (this.box.$item.$isSeparatorsVisible !== undefined) {
             this._$$table.toggleClass(this.box.$skin + "-border-table", this.box.$item.$isSeparatorsVisible);
             }*/
            this.$$container[0].appendChild(this._domTable);
        }
        var $layoutCss = item.$layout.$layoutCss || this.$layout.$layoutCss;
        if ($layoutCss) {
            cell.className += " " + $layoutCss;
        }
        this._domTable.appendChild(cell);
    },
    appendNewItem: function(options){
        if (this.items.length) {
            this.items[0].appendNewItem(options);
        }
    },
    _createChildLayout: function($subLayout, index){
        var subLayout = document.itemFactory.createLayout(this.box, $subLayout);
        this._wrapInSlot(subLayout, index);
        this.items.push(subLayout);
        subLayout.layoutParent = this;
        return subLayout;
    },
    render: function(){
        var self = this;
        self.colWidths = this.$layout.$layoutSubType.split(",");
        self.items = [];
        self.$layout.$items.forEach(function($item, index){
            self._createChildLayout($item, index).render();
        });
        if (document.site.authoringView) {
            self.toggleAuthoring(true);
        }
    },
    dispose: function(){
        document.site.removeDomChild(this._domTable);
        Layout.prototype.dispose.call(this);
    }
});
