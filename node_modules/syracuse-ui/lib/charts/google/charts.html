<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script>
window.Chart={
	sampleData:  null,
	options: null,
	draw: function(){
		google.load("visualization", "1", {"packages":["table", "areachart", "barchart", "columnchart", "linechart", "piechart"]});
		google.setOnLoadCallback(Chart.drawData);

	},
	checkArrayNotEmpty: function(obj, name) {
		if (!obj[name]) return false;
		if (!obj[name].length) return false;
		return true;
	},
	checkData: function(data, options) {
		if (!options) options={};
		if (!data.axes) return false;
		if (!data.cells) return false;
		if (data.axes.length<2) return false;
		if (!Chart.checkArrayNotEmpty(data.axes[0], "hierarchies")) return false;
		if (!Chart.checkArrayNotEmpty(data.axes[0], "tuples")) return false;
		if (!Chart.checkArrayNotEmpty(data.axes[1], "hierarchies")) return false;
		if (!Chart.checkArrayNotEmpty(data.axes[1], "tuples")) return false;
		if (!Chart.checkArrayNotEmpty(data.cells, "values")) return false;
		return true;
	},
	drawData: function() {
		var data=Chart.sampleData;
		var options=Chart.options;
		//if (options.title) data.caption=options.title;
		if (!Chart.checkData(data, options)) return;
		var gd = new google.visualization.DataTable();
		if (options.chart=="PieChart") {
			gd.addColumn("string", data.axes[0].hierarchies[0]);
			gd.addColumn("number", "");
			var ll=data.axes[1].tuples.length;
			gd.addRows(ll);
			for (var i = 0; i  < ll; i++) {
				gd.setValue(i, 0, data.axes[1].tuples[i][0].caption);    
				var value=0;
				for (var j=0, size=data.axes[0].tuples.length; j<size; j++) {
					value=+data.cells.values[i*size+j];
				}
				gd.setValue(i, 1, value);
			}
		} else {
			gd.addColumn("string", data.axes[0].hierarchies[0]);
			for (var i = 0; i  <  data.axes[1].tuples.length; ++i) {
				gd.addColumn("number", data.axes[1].tuples[i][0].caption);    
			}
			gd.addRows(data.axes[0].tuples.length);
			var len=data.axes[0].tuples.length;
			for (var i = 0; i  < len; i++) {
				gd.setValue(i, 0, ((data.axes[0].tuples[i][0].caption+"") || ""));
				for (var j = 0; j  < data.axes[1].tuples.length; j++) {
					gd.setValue(i, j+1,  data.cells.values[j*len+i]);    
				}
			}
		}
		var el=document.getElementById("visualization");
		el.style.width=options.width+"px";
		el.style.height=options.height+"px";
		var chart=google.visualization.ColumnChart;
		switch (options.chart) {
			case "TableChart": 
				chart=google.visualization.Table;
				break;
			case "BarChart": 
				chart=google.visualization.BarChart;
				break;
			case "PieChart": 
				chart=google.visualization.PieChart;
				break;
			default: 
				chart=google.visualization.ColumnChart;
				break;
				
		}
		new chart(el).draw(gd,{title:"" /*width: options.width-20, height: options.height}*/});
		
	}
};
</script>

</head>
<body style="margin: 0px;">
<div id="visualization" style="position:relative; left:0px; top:0px" ></div>
<script>
	if (parent && window.frameElement) {
		Chart.sampleData=parent.$(window.frameElement).data("chart");
		Chart.options=parent.$(window.frameElement).data("options");
	}
	if (Chart.sampleData) Chart.draw();
</script>
</body>
</html>

