"use strict"

// This controller is only used to catch the save event of a document entry to directly
// save content from an active document inside ms word

var helpers = require('syracuse-core/lib/helpers');
var CommonController = require('syracuse-ui/lib/common/controller/controller').Controller;

function Controller(){
}

exports.Controller = helpers.defineClass(Controller, CommonController, {
    notifyChange: function(article, binding, value){
        var self = this;
        var notifyArgs = arguments;
        if ((binding === "$actions")) {
            var repr = ((article && article.dataset.$url) || "").match(/\?.*representation=(.*)\./);
            repr = (repr && repr[1]) || "";
            switch (repr) {
                case "msoWordDocument":
                    document.site.wordInterface.publishDocument(
                    		article.parseExpression(article.$prototype.$url + "?representation={$representation}.$details"), 
                    		article.dataset.description, article.parseExpression(article.get$Properties().content.$url), 
                    		function(data, resp) {
                    			CommonController.prototype.notifyChange.apply(self, notifyArgs);
                    		});
                    break;
                default:
                    CommonController.prototype.notifyChange.apply(self, notifyArgs);
            }
        }
        else 
        {
            CommonController.prototype.notifyChange.apply(self, notifyArgs);
        }
    }
});
