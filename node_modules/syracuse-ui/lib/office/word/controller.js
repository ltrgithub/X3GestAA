"use strict"

// This controller is only used to catch the save event of a document entry to directly
// save content from an active document inside ms word

var helpers = require('syracuse-core/lib/helpers');
var CommonController = require('syracuse-ui/lib/controller/controller').Controller;

function Controller(){
}

exports.Controller = helpers.defineClass(Controller, CommonController, {
    executeMenu: function(menu, record, article, confirmed){
        var self = this;
        var args = arguments;
        var repr;
    	if (menu && menu.$url && menu.$url.indexOf("$workingCopies") > -1)
    	{
    		repr = self._getRepresentation(menu.$url);
    		menu.$url += "&templateClass=" + document.site.wordInterface.getDocumentRepresentation();
    		var locale = document.site.wordInterface.getDocumentLocale();
    		if (locale)
    			menu.$url += "&templateLocale=" + locale; 
    	}
        CommonController.prototype.executeMenu.apply(self, args);
    },
    _getRepresentation: function(url){
        var repr = url.match(/\?.*representation=(.*)\./);
        repr = (repr && repr[1]) || "";
        return repr;
    },
});
