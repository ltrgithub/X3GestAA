"use strict"
var helpers = require('syracuse-core/lib/helpers');
var DesktopPage = require('syracuse-ui/lib/article/page').DesktopPage;

function OfficePage(){
}

exports.OfficePage = helpers.defineClass(OfficePage, DesktopPage, {
    notifyActionChange: function(target, value, notifyServer){
        var self = this;
        // extract representation
        var repr = (this.dataset.$url || "").match(/\?.*representation=(.*)\./);
        repr = (repr && repr[1]) || "";
        var documentUrl = this.parseExpression(this.$prototype.$url + "?representation={$representation}.$details");
		var publisher;
		var saveUrl = (this.$prototype.$properties.content || {}).$url;
		if(saveUrl) {
			saveUrl = this.parseExpression(saveUrl);
			switch (repr) {
				case "msoMailMergeTemplate":
				case "msoReportTemplate":
				case "msoWordDocument":
					publisher = document.site.wordInterface;
					break;
				case "msoPptDocument":
					// save the document to the working copy
					publisher = document.site.pptInterface;
					break;
				case "documentExcel":
				case "documentExcelSI":
					// save the document to the working copy
					publisher = document.site.excelDocument;
					break;
			}
		}
		// save the document to the working copy
        if(publisher) 
			publisher.publishDocument(documentUrl, this.dataset.description, saveUrl, function(data, resp){
				// on succes continue with save the working copy
				DesktopPage.prototype.notifyActionChange.call(self, target, value, notifyServer);
			});
		else
            DesktopPage.prototype.notifyActionChange.call(this, target, value, notifyServer);
    }
});