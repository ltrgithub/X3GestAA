"use strict";

/*
 Copyright (c)2012 Sage.
 http://wwww.sage.com
 */
/**
 * @fileoverview Fusion "Left List" event handling classes
 */


var sapUtil = require('syracuse-ui/lib/fusion/core/client/sap/util').Fusion;
var syraUtil = require('syracuse-ui/lib/fusion/core/client/sap/util').Syra;
var requestActions = require('../sap/srvactions');

var _evtProcList = {};
exports.ListEventHandling = _evtProcList;

/* "Server page input" event handling class for "Left List" widget */
_evtProcList.sap = function () {
	this.eventListeners = function () {
		return [["wdgt.list.toggle", beforeToggle, true, true],
				["wdgt.list.selline", changeLine, true, true],
				["wdgt.list.toggled", afterToggle]
		];
	};
	
	function beforeToggle(event, listXid) {
		var processed = undefined, currIst, $fusionPageMeta, listIst;
        if (event.target && event.data.open && ($fusionPageMeta = syraUtil.getFusionPageMeta(event.target))) {
 			currIst = this.sapController.getCurrInst();
 			listIst = sapUtil.makeIst($fusionPageMeta.winModel.getWinId(), listXid, currIst.nl);
 			if(!sapUtil.cmpIst(currIst, listIst)) {
	            event.result = {"$act": requestActions.getSrvAction("SRV_GETFOCUS")};
	            event.result.params = {"target": listIst};
	            event.result.post = {"callback": event.data.doEvent, "args": []};
	            processed = true; 				
 			}
        }
		return processed;
	}
	
	function afterToggle(event, listXid) {
        return undefined;
	}

	function changeLine(event) {
		var processed = undefined, currIst, $fusionPageMeta, listIst, srvAct, focus;
        if (event.target && ($fusionPageMeta = syraUtil.getFusionPageMeta(event.target))) {
 			currIst = this.sapController.getCurrInst();
 			listIst = sapUtil.makeIst($fusionPageMeta.winModel.getWinId(), event.data.xid, currIst.nl);
 			focus = sapUtil.cmpIst(currIst, listIst);
 			if(!focus || currIst.nl != event.data.line) {
 				listIst.nl = event.data.line;
	 			srvAct = focus ? requestActions.getSrvAction("SRV_BRWCHANGELINE") : requestActions.getSrvActionEX("SUP_LIST_SELLINE");
	            event.result = {"$act": srvAct};
	            event.result.params = {"target": listIst};
	            processed = true;
	        }				
        }
        return processed;
	}
};
