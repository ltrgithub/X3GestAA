"use strict";
var syraUtil = require('syracuse-ui/lib/fusion/core/client/sap/util').Syra;
var sapUtil = require('syracuse-ui/lib/fusion/core/client/sap/util').Fusion;
var requestActions = require('../sap/srvactions');

/**
 * @fileoverview Fusion "Link" event handling classes
 */
var _evtProcLink = {};
exports.LinkEventHandling = _evtProcLink;

/* "Server page input" events handling class for "Link" controls*/
_evtProcLink.sap = function(){
    this.eventListeners = function(){
        return [["wdgt.link.click", onClick, true, true]];
    };
    
    function onClick(event, ist){
        var processed = undefined, act = null, $fusionPageMeta, $itemMeta, itemIst, focus;
        if (event.target && !event.target.$isDisabled) {
            if (event.target.$act && event.target.$act > 0) {
                // Native link
                event.result = {
                    "$act": event.target.$act
                };
                processed = true;
            }
            else 
                if (event.target.$url) {
                    // Special link
                    $fusionPageMeta = event.target.boxParent ? syraUtil.getFusionPageMeta(event.target.boxParent) : null;
                    itemIst = $fusionPageMeta && ist ? sapUtil.makeIst($fusionPageMeta.winModel.getWinId(), ist, null, true) : null;
                    if (itemIst) {
                        // Item is valid, we retrieve action code for this link
                        focus = this.sapController.hasFocus(itemIst);
                        switch (event.target.$url) {
                            case "leftList-Next":
                                act = focus ? requestActions.getSrvAction("SRV_LIST_PAGE_DOWN") : requestActions.getSrvActionEX("SUP_LIST_NEXT");
                                break;
                            case "leftList-Prev":
                                act = focus ? requestActions.getSrvAction("SRV_LIST_PAGE_UP") : requestActions.getSrvActionEX("SUP_LIST_PREV");
                                break;
                        }
                        if (act) {
                            event.result = {"$act": act};
                            event.result.params = {"target": itemIst};
                            processed = true;
                        }
                    }
                }
        }
        return processed;
    }
    
};
