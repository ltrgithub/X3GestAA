"use strict";
var helpers = require('syracuse-core/lib/helpers');

function DesignerViews($skin) {
	this.$skin = $skin;
}

exports.DesignerViews = helpers.defineClass(DesignerViews, null, {
	load: function(designer) {
		this.designer = designer;
		this.drawLinks();
	},
	drawLinks: function() {
		var $types = ["viewTypePreview", "viewTypeLayout", "viewTypeStructure", "viewTypeJSON"];
		var linksSlot = document.createElement("div");
		linksSlot.id = "s-aw-viewType";
		this._links = {};
		for (var ii = 0, jj = $types.length; ii < jj; ii++) {
			var $type = $types[ii];
			if ($type != "viewTypeJSON" || document.site.isMobileSite) {
				var link = document.createElement("a");
				link.setAttribute("data-s-picker", $type);
				link.className = this.$skin;
				link.textContent = link.title = this.designer.designerLocalize["aw_" + $type];
				this._links[$type] = link;
				linksSlot.appendChild(link);
			}
		}
		document.site.toggleClass(this._links[this._$viewType = "viewTypeLayout"], "s-selected", true);
		this.designer.toolsSlots.views.appendChild(linksSlot);
	},
	_toggleViewType: function($viewType) {
		if (this._$viewType) {
			document.site.toggleClass(this._links[this._$viewType], "s-selected", false);
		}
		this._$viewType = $viewType;
		var isBarsVisible = true;
		if (this.isOnPreviewMode && this._$viewType != "viewTypePreview") {
			this.isOnPreviewMode = false;
			this.designer.tools.uiSwitch.toggleItemAuthoring(this.designer.awArticle.page, true);
		}
		if (this.isJsonMode && this._$viewType != "viewTypeJSON") {
			this.isJsonMode = false;
			document.site.mobileGateway.toggleJsonEditor(false);
		}
		document.site.toggleClass(this._links[this._$viewType], "s-selected", true);
		switch (this._$viewType) {
			case "viewTypeJSON":
				if (this.$isLightMode) {
					this.$isLightMode = false;
				}
				this.isJsonMode = true;
				isBarsVisible = false;
				document.site.mobileGateway.toggleJsonEditor(true);
				break;
			case "viewTypePreview":
				if (!this.isOnPreviewMode) {
					if (this.$isLightMode) {
						this.$isLightMode = false;
						this.designer.tools.uiSwitch.toggleItemAuthoring(this.designer.awArticle.page, true);
					}
					this.isOnPreviewMode = true;
				}
				isBarsVisible = false;
				break;
			case "viewTypeStructure":
				if (!this.$isLightMode) {
					this.$isLightMode = true;
				}
				break;
			case "viewTypeLayout":
				if (this.$isLightMode) {
					this.$isLightMode = false;
				}
				break;
		}
		this.designer.toolsSlots.treebar.style.display = this.designer.toolsSlots.properties.style.display = isBarsVisible ? "" : "none";
		this.designer.tools.uiSwitch.toggleItemAuthoring(this.designer.awArticle.page, !this.isOnPreviewMode);
		this.designer.awArticle.page.layoutValidator.validate(this.designer.awArticle.page.layoutContent, true);
		this.designer.awArticle.page.onWindowResize();
	},
	onClickPicker: function($bind) {
		switch ($bind) {
			case "viewTypePreview":
			case "viewTypeLayout":
			case "viewTypeStructure":
			case "viewTypeJSON":
				this._toggleViewType($bind);
				break;
			default:
				return false;
		}
		return true;
	},
	dispose: function() {
		if (this._$viewType && this._$viewType != "viewTypeLayout") {
			this._toggleViewType("viewTypeLayout");
		}
		this.designer = this._links = null;
	}
});