"use strict";
var helpers = require('syracuse-core/lib/helpers');


function _showButtons(tool, add, $skin) {
	var slot = document.createElement("div");
	slot.id = "s-aw-viewType";
	tool._btns = {};
	var types = ["viewTypePreview", "viewTypeLayout", "viewTypeStructure", "viewTypeJSON"];
	for (var ii = 0, jj = types.length; ii < jj; ii++) {
		var type = types[ii];
		if (type == "viewTypeJSON" && !syra_site.mobileGateway) {
			continue;
		}
		if (add) {
			var btn = syra_menus.addTextButton(syra_local["aw_" + type], $skin, "onViewClick");
			btn.syraViewType = type;
			btn.syraarticle = tool.designer.id;
			btn.syraTool = tool.id;
			slot.appendChild(tool._btns[type] = btn);
		} else {
			tool._btns[type] = null;
		}
	}
	tool.designer.viewsSlot.appendChild(slot);
}


function ViewsTool() {}

exports.ViewsTool = helpers.defineClass(ViewsTool, null, {
	load: function(designer, $skin) {
		this.designer = designer;
		this.id = designer.id + "viewsTools";
		syra_store.add(this);
		_showButtons(this, true, $skin);
		syra_site.dom.toggleClass(this._btns[this.$viewType = "viewTypeLayout"], "s-selected", true);
	},
	ensureLayoutView: function() {
		if (this.$viewType != "viewTypeLayout") {
			this.toggleViewType("viewTypeLayout");
		}
	},
	toggleViewType: function($viewType) {
		if (this.$viewType) {
			syra_site.dom.toggleClass(this._btns[this.$viewType], "s-selected", false);
		}
		this.$viewType = $viewType;
		if (this.isJsonMode && this.$viewType != "viewTypeJSON") {
			this.isJsonMode = false;
			syra_site.mobileGateway.toggleJsonEditor(false);
		}
		this.designer.ensureDesigneBar();
		if (this.$viewType == "viewTypeJSON") {
			this.isJsonMode = true;
			syra_site.mobileGateway.toggleJsonEditor(true);
		}
		syra_site.dom.toggleClass(this._btns[this.$viewType], "s-selected", true);
		this.designer.uiSwitchTool.toggleUIDesign(this.designer.designedArticle, true);
		this.designer.designedArticle.page.ensurePageVisibility();
	},
	onViewClick: function(event, btn) {
		this.toggleViewType(btn.syraViewType);
	},
	dispose: function() {
		syra_store.remove(this);
		_showButtons(this, false);
		this.designer = this._btns = null;
	}
});