"use strict";
var InsertTree = require("syracuse-ui/lib/authoring/page/tree/insertTree").InsertTree;
var ContentTree = require("syracuse-ui/lib/authoring/page/tree/contentTree").ContentTree;

function _selectTab(designer, tab, select) {
	if (select && designer._selectedTab && designer._selectedTab.tab != tab) {
		_selectTab(designer, designer._selectedTab.tab, false);
	}
	var tabItem = designer.contentTree.tabItem.tab == tab ? designer.contentTree.tabItem : designer.insertTree.tabItem;
	designer._selectedTab = (select) ? tabItem : null;
	tabItem.tab.className = "new-s-aw-tlbr-tab" + (select ? " s-tab-open" : "");
	tabItem.body.style.display = select ? "" : "none";
}

function _appendTab(designer, title) {
	var tab = syra_menus.addTextButton(title, "new-s-aw-tlbr-tab", "onTabTreesClick");
	tab.syraItem = designer.id;
	var body = document.createElement("div");
	body.style.display = "none";
	body.className = "s-aw-content-tree";
	var tabItem = {
		tab: designer.treebarTabs.appendChild(tab),
		body: designer.treebarBody.appendChild(body)
	};
	return tabItem;
}

exports.load = function(designer) {
	designer.onTabTreesClick = function(event, btn) {
		_selectTab(this, btn, true);
	};
	designer.fillTree = function() {
		if (this.designedArticle) {
			this.contentTree.fill();
			this.insertTree.fill();
			if (this._selectedTab && this._selectedTab.tab) {
				_selectTab(this, this._selectedTab.tab, true);
			}
		}
	};
	designer.treebarTabs = document.createElement("div");
	designer.treebarTabs.className = "s-aw-tlbr-tabs-nav";
	designer.treebarBody.appendChild(designer.treebarTabs);
	designer._selectedTab = null;
	designer.designedArticle.garbage.loadFreeField();
	(designer.contentTree = new ContentTree()).load(designer, _appendTab(designer, syra_local.aw_viewTypeContent));
	(designer.insertTree = new InsertTree()).load(designer, _appendTab(designer, syra_local.aw_insert));
	_selectTab(designer, designer.contentTree.tabItem.tab, true);
};