"use strict";
var helpers = require('syracuse-core/lib/helpers');
var DesktopPageDesigner = require("syracuse-ui/lib/authoring/desktopPage/desktopPageDesigner").DesktopPageDesigner;

function CardDesigner() {}

exports.CardDesigner = helpers.defineClass(CardDesigner, DesktopPageDesigner, {
	initializePageDesigner: function() {
		this.togglePageBars(true);
		this.awArticle.$designLevel = "article";
		DesktopPageDesigner.prototype.initializePageDesigner.call(this);
	},
	toogleOverLaySlots: function(show) {
		var ids = ["left", "top", "right", "bottom"];
		if (show) {
			this.overlays = {};
			for (var ii = 0, jj = ids.length; ii < jj; ii++) {
				var overlay = this.overlays[ids[ii]] = document.createElement("div");
				overlay.className = "s-aw-carddesigner-overlay";
				this.awArticle.page.body.appendChild(overlay);
			}
		} else {
			if (this.overlays) {
				for (var ii = 0, jj = ids.length; ii < jj; ii++) {
					document.site.removeDomChild(this.overlays[ids[ii]]);
				}
				this.overlays = null;
			}
		}
	},
	onWindowResize: function() {
		DesktopPageDesigner.prototype.onWindowResize.call(this);
		if (this.overlays) {
			var offsetBody = this.awArticle.page.body.getBoundingClientRect();
			var offsetCard = this.awArticle.domItem.getBoundingClientRect();

			this.overlays.left.style.top = (offsetCard.top - offsetBody.top) + "px";
			this.overlays.left.style.left = 0;
			this.overlays.left.style.width = (offsetCard.left - offsetBody.left) + "px";
			this.overlays.left.style.height = offsetCard.height + "px";

			this.overlays.right.style.top = (offsetCard.top - offsetBody.top) + "px";
			this.overlays.right.style.right = 0;
			this.overlays.right.style.width = (offsetBody.right - offsetCard.right) + "px";
			this.overlays.right.style.height = offsetCard.height + "px";

			this.overlays.bottom.style.top = 0;
			this.overlays.bottom.style.left = 0;
			this.overlays.bottom.style.width = offsetBody.width + "px";
			this.overlays.bottom.style.height = (offsetCard.top - offsetBody.top) + "px";

			this.overlays.top.style.bottom = 0;
			this.overlays.top.style.left = 0;
			this.overlays.top.style.width = offsetBody.width + "px";
			this.overlays.top.style.height = (offsetBody.bottom - offsetCard.bottom) + "px";
		}
	},
	drawBox: function() {
		DesktopPageDesigner.prototype.drawBox.call(this);
		document.site.removeDomChild(this.viewsSlot);
		this.viewsSlot = null;
		this.cardTitle = document.createElement("div");
		this.cardTitle.className = "s-aw-carddesigner-title";
		var title = this.awArticle.list.getTitle() || "";
		if (title.length) {
			title += " - ";
		}
		title += this.awArticle.list.$item.$format == "grid" ? this.localize.aw_card_detail_title : this.localize.aw_card_card_title;
		this.cardTitle.textContent = title;
		this.leftTop.className += " s-aw-carddesigner-left-top";
		this.layoutSlot.insertBefore(this.cardTitle, this.leftTop.nextSibling);
		this.toogleOverLaySlots(true);
	},
	closeDesigner: function() {
		if (this.historyTool._currentStep > 1) {
			this.awArticle.list.designer.historyTool.notifyUpdate(true);
		}
		document.site.designItem(false, this.awArticle);
	},
	togglePageBars: function(designing) {
		var page = this.awArticle.page;
		if (!page.designer) {
			if (page.menuBar) {
				page.menuBar.toggleUIDesign(designing);
			}
			if (page.fusionBar) {
				page.fusionBar.toggleUIDesign(designing);
			}
		}
	},
	endTargetPageUpdate: function(selectedItem, isStructureUpdated) {
		this.awArticle.page.layoutValidator.validate(this.awArticle.layoutContent, true);
		this.toggleUIDesign(this.awArticle, true);
		DesktopPageDesigner.prototype.endTargetPageUpdate.call(this, selectedItem, isStructureUpdated);
	},
	dispose: function() {
		this.toogleOverLaySlots(false);
		this.togglePageBars(false);
		DesktopPageDesigner.prototype.dispose.call(this);
	}
});