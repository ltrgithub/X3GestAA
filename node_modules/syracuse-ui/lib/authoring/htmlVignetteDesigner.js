"use strict";
var helpers = require('syracuse-core/lib/helpers');
var Designer = require("syracuse-ui/lib/authoring/designer").Designer;

function HTMLVignetteDesigner() {}

exports.HTMLVignetteDesigner = helpers.defineClass(HTMLVignetteDesigner, Designer, {
	saveDesign: function() {
		if (this.designedArticle.page.designer) {
			this.designedArticle.page.designer.endArticleUpdate();
		} else {
			this.designedArticle.page.savePageDesign();
		}
	},
	loadBox: function(designedPage) {
		this.$skin = "s-vignette-designer";
		this.$prototype = {
			$properties: {
				$title: {
					$type: "application/x-string",
					$title: syra_local.htmlVignetteTitle,
					$displayLength: 200
				},
				$url: {
					$type: "application/x-string",
					$isHidden: true,
					$title: syra_local.htmlVignetteUrl,
					$displayLength: 200
				},
				$height: {
					$type: "application/x-string",
					$title: syra_local.htmlVignetteHeight,
					$displayLength: 8
				}
			}
		};
		this.$item = {
			$layout: {
				$items: [{
					$category: "section",
					$skin: "s-aw-h2",
					$layout: {
						$items: [{
							$bind: "$url",
							$isEditMode: true,
							$isTopLabelAlignment: false,
							$css: "s-aw-prop"
						}, {
							$layoutType: "row",
							$autoSize: true,
							$items: [{
								$bind: "$title",
								$isEditMode: true,
								$isTopLabelAlignment: false,
								$css: "s-aw-prop"
							}, {
								$bind: "$height",
								$isEditMode: true,
								$isTopLabelAlignment: false,
								$css: "s-aw-prop"
							}]
						}]
					}
				}]
			}
		};
		Designer.prototype.loadBox.call(this);
		this.applyChange({
			$title: this.designedItem.$item.$title || this.designedItem.$field.$title,
			$url: this.designedItem.$item.$url || (this.designedItem.$field.$location ? this.designedItem.$field.$location.$url : null),
			$height: this.designedItem.$item.$height || this.designedItem.$field.$height
		});
	},
	drawBox: function() {
		this.domItem = this.body = this.layoutSlot = document.createElement("aside");
		this.domItem.syraItem = this.domItem.syraarticle = this.id;
		this.layoutSlot.className = "s-aw-vignette-designer";
		this.designedArticle.body.insertBefore(this.layoutSlot, this.designedArticle.body.firstChild);
		this.layoutSlot.style.display = "";
		this.layoutSlot.appendChild(this.addCloseButton());
		this.loadHistoryTool();
		this.renderLayoutContent();
		this.designedItem = this.designedArticle;
		syra_site.resize();
	},
	closeDesigner: function() {
		this.designedArticle.designArticle(false);
	},
	dispose: function() {
		syra_site.dom.removeChild(this.layoutSlot);
		Designer.prototype.dispose.call(this);
	}
});