"use strict";
import { Ajax, AjaxResponse } from '../../ajax/ajax';
import * as SyraAlert from '../../syra/alert/syraAlert';
import * as syra_expression from '../../syra/utility/syra_expression';
import Store from '../../dataStore/store';

let ajax: Ajax;

export function dispose() {
    ajax && ajax.abort();
    ajax = null;
}

export function put(store: Store, url: string, data: any, next: (dataset: any) => void) {
    ajax = new Ajax();
    data.$uuid = store.$uuid;
    data.$etag = 1;
    ajax.put({
        lock: true,
        url: syra_expression.parse(store, url),
        data: data,
        end: (response: AjaxResponse) => {
            ajax = null;
            if (response.ok) {
                next(response.data);
            }
            else {
                SyraAlert.error(response.error.diagnoses);
            }
        }
    });
}