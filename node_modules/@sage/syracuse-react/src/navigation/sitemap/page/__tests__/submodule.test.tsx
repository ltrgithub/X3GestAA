import TestHelper from '../../../../__tests__/testHelper';
import * as React from 'react';
import * as Enzyme from 'enzyme';
import {Submodule} from '../submodule';
import { SitemapSubmodule } from '../../groups';
import { ISubModuleProps } from '../props';

describe('Sitemap Submodule', function () {

    const submodule:SitemapSubmodule = TestHelper.fixtures.getSitemap().modules[0].submodules[0];
    const render: (props: ISubModuleProps) => Cheerio =
        (props) => Enzyme.render(<Submodule {...props} />)

    const defaultProps:ISubModuleProps= {
        submodule,
        onMenuClick: ()=>{},
        onSwitchBookmark: ()=>{},
        onSubModuleCollapse: ()=>{},
        onMenuBlockCollapse: ()=>{},
        searchFilter: ""
    }

    it('should compare to not highlighted Sitemap Submodule item snapshot', ()=>{
        const wrapper = render({...defaultProps});
        expect(wrapper).toMatchSnapshot();
    });

    it('should not highlight the Sitemap Submodule item if the title does not match the search string', ()=>{
        let wrapper = render({...defaultProps});
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').contents().filter(
            function(){return this.nodeType === 3;}
        ).text()).toBe('Administration');
        expect(wrapper.children('li').children('span').length).toBe(0);
        wrapper = render({...defaultProps, searchFilter:"notfound"});
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').contents().filter(
            function(){return this.nodeType === 3;}
        ).text()).toBe('Administration');
        expect(wrapper.children('li').children('span').length).toBe(0);
    });

    it('should compare to highlighted Sitemap Submodule item snapshot', ()=>{
        const wrapper = render({...defaultProps, searchFilter:"Adm"});
        expect(wrapper).toMatchSnapshot();
    });

    it('should highlight the Sitemap Submodule item if the title matches the search string', ()=>{
        let wrapper = render({...defaultProps, searchFilter:"Adm"});
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').contents().filter(function(){
            return this.nodeType === 3 || this.name === 'span';
        }).text()).toBe('Administration');
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').children('span').length).toBe(1);
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').children('span').hasClass('s_sitemap_highlight_text')).toBe(true);
        expect(wrapper.children('li').children('.s_sitemap_submodule_link').children('span').text()).toBe("Adm");
    });

});