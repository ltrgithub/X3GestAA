let _ext = require('syracuse-ui/lib/extend/extendGateway');
let _d3 = require('../deps/index');

class TaskToolTip {
    constructor(locale) {
        this.locale = locale;
        this._data = null;
        this._initialise();

    }

    _initialise() {
        var self = this;
        _d3.select("body").append("div")
            .attr("class", "gantt-task-tip hidden");
    }

    dispose() { }

    onMouseOver(data, locale) {
        let self = this;
        if (self._data == data ) { 
            return;
        }
        self._data = data;
        //Clear the contents of the tooltip
        let taskDetailSlot = $(".gantt-task-tip")["0"];
        _ext.dom.empty(taskDetailSlot);
        //Add the task details to the tool tip
        _d3.select(".gantt-task-tip").append(function () {
            let tipDIV = document.createElement("div");
            tipDIV.className = "gantt-task-detail";
            _ext.dom.text("gantt-task-detail-title", self._data.taskType, tipDIV);
            _ext.dom.text("gantt-task-detail-subtitle", self._data.taskName, tipDIV);
            let period = _ext.dom.div("gantt-task-detail-period", tipDIV);
            let dt = _ext.dom.div("gantt-task-detail-period-dt", period);
            _ext.dom.text("gantt-task-detail-period-dt-lb", self.locale.gantt_start, dt);
            let s_startDate = _ext.culture.datetime.fromJsDate(self._data.startDate).toString(_ext.culture.format.getDatetime());
            _ext.dom.text("gantt-task-detail-period-dt-val", s_startDate, dt);
            dt = _ext.dom.div("gantt-task-detail-period-dt", period);
            _ext.dom.text("gantt-task-detail-period-dt-lb", self.locale.gantt_end, dt);
            let s_endDate = _ext.culture.datetime.fromJsDate(self._data.endDate).toString(_ext.culture.format.getDatetime());
            _ext.dom.text("gantt-task-detail-period-dt-val", s_endDate, dt);
            let duration = _ext.dom.div("gantt-task-detail-duration", tipDIV);
            _ext.dom.text("gantt-task-detail-duration-lb", self.locale.gantt_duration, duration);
            _ext.dom.text("gantt-task-detail-duration-val", parseFloat(self._data.duration).toFixed(2), duration);
            return tipDIV;
        });

        //Position and show the tooltip			
        _d3.select(".gantt-task-tip")
            .style("left", (_d3.event.pageX + 10) + "px")
            .style("top", (_d3.event.pageY - 28) + "px")
            .classed("hidden", false);
    }

    onMouseOut() {
        this._data = null;
        _d3.select(".gantt-task-tip")
            .classed("hidden", true);
    }



}
exports.create = function (locale) {
    return new TaskToolTip(locale);
};
