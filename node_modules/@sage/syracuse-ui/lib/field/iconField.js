"use strict";
var helpers = require('@sage/syracuse-core').helpers;
var Field = require('@sage/syracuse-ui/lib/field/field').Field;

function IconField() {}

exports.IconField = helpers.defineClass(IconField, Field, {
	setValue: function(value, metaData) {
		if (value !== undefined) {
			this.currentValue = value;
			if (value != null) {
				var $path = syra_config.$iconPath + (this.$icon.$path || "x3icons/");
				this.iconLink.style.backgroundImage = "url('" + $path + this.currentValue + ".png')";
			} else {
				this.iconLink.style.backgroundImage = "";
			}
		}
		this.applyMetaData(metaData);
	},
	getValue: function() {
		return this.currentValue || "";
	},
	load: function() {
		this.$item.$isEditMode = this.$item.$isEditMode || false;
		if (this.$item.$isTitleHidden == undefined) {
			this.$item.$isTitleHidden = true;
		}
		Field.prototype.load.call(this);
	},
	setState: function(state) {
		syra_fields.setState(this, state);
		if (state.$isDisabled !== undefined) {
			syra_dom.disable(this.iconLink, this.$isDisabled);
		}
	},
	focus: function() {
		if (!this.$isHidden && !this.$isDisabled) {
			this.iconLink.focus();
			syra_fields.scrollToField(this);
			return true;
		}
		syra_fields.scrollToField(this);
		return false;
	},
	applyMenusChange: function(metaData) {
		if ((metaData && metaData.$links) !== undefined) {
			this.renderIcon(metaData);
		}
	},
	renderIcon: function(metaData) {
		if (!this.iconLink) {
			this.iconLink = document.createElement("a");
			this.iconLink.setAttribute("data-s-field-extra", this.id);
			if (metaData.$tooltip) {
				this.iconLink.syraTip = 2;
				this.iconLink.setAttribute("title", syra_expression.render(this.boxParent, metaData.$tooltip));
			}
			this.iconLink.style.width = this.$icon.$width || "16px";
			this.iconLink.style.height = this.$icon.$height || "16px";
			this._dataValue.appendChild(this.iconLink);
		}
		var css = "";
		if (this.$links = metaData.$links) {
			this.iconLink.setAttribute("href", "#");
			syra_dom.toggleClass(this._dataValue, "s-icon-link", this.iconLink != null);
			css = " s-icon-link";
			this.iconLink.syraOnClick = "onFieldInputEvent";
		} else {
			syra_dom.toggleClass(this._dataValue, this.$skin + "-icon", true);
		}
		if (syra_dom.rtl.on) {
			css += " s-rtl-img ";
		}
		this.iconLink.className = this.$skin + "-value-icon s-icon-link " + css;
		if (this.$isDisabled !== undefined) {
			syra_dom.disable(this.iconLink, this.$isDisabled);
		}
		if (this.currentValue != null) {
			this.setValue(this.currentValue);
		}
	},
	render: function() {
		this.$icon = this.$item.$icon || {};
		this.renderIcon(this.$field);
	}
});