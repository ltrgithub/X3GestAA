import { assert } from 'chai';

describe(module.id, () => {
	var ez = require('ez-streams');
	var transform = require("@sage/syracuse-lib/src/transforms");

	function t(_, from, to) {
		var r = ez.devices.string.reader(from) //
		.transform(ez.transforms.cut(2)) //
		.transform(transform.escaper({
			preserve: true,
		})).toArray(_).join('');
		assert.equal(r, to);
		r = ez.devices.string.reader(to) //
		.transform(ez.transforms.cut(2)) //
		.transform(transform.unescaper()).toArray(_).join('');
		assert.equal(r, from);
	}
	// no need to test sophisticated stuff, just that streaming works
	it('escaper', function(_) {
		t(_, 'abc<div foo><w>x<y>z</div>def', 'abc<div disabled-foo><!--<w>-->x<!--<y>-->z</div>def');
	});
});