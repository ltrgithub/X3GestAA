"use strict";
var url = require('url');
var config = require('config');
var mock = require('../load-balancer/mock');

exports.dispatcher = function(config) {
	var routes = {
		notificationAll: function(_, request, response) {
			// this function is called when the scheduler should be updated
			response.writeHead(200, {
				"Content-Type": "text/plain"
			});
			require('./scheduler').scheduleAll(_); // function which updates local notification array
			response.end('OK');
			return;
		}


	};
	return function(_, request, response) {
		if (request.fromNanny || (request._request && request._request.fromNanny) ||  
			(config.system && config.system.unsafeForceNanny)) {
			var route = routes[request.url.split('/')[2]];
			if (!route) throw new Error("bad url: " + request.url);
			return route(_, request, response);
		} else {
			response.writeHead("404", {});
			return response.end("Resource not found.");
		}
	};
};