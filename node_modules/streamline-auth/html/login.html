<!DOCTYPE html>
<html>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <head>
        <meta charset="UTF-8" />
    	  <meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Sage ERP X3</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">      
        <link rel="stylesheet" type="text/css" href="/syracuse-ui/themes/desktop/sage/login.css" />   
        <script type="text/javascript">
        
function isTablet(){
	var agt = navigator.userAgent;
	return (document.documentElement.ontouchstart !=null) ||
	(agt.match(/(iphone|ipod|ipad)/) ||
			agt.match(/(android)/i)  || 
			agt.match(/(iemobile)/) || 
			agt.match(/iphone/i) || 
			agt.match(/ipad/i) || 
			agt.match(/ipod/i) || 
			agt.match(/blackberry/i) || 
			agt.match(/bada/i));
}

function init(){
   var pics=[
               '/syracuse-ui/themes/desktop/sage/images/login/1.jpg',
               '/syracuse-ui/themes/desktop/sage/images/login/2.jpg',
               '/syracuse-ui/themes/desktop/sage/images/login/3.jpg',
			   '/syracuse-ui/themes/desktop/sage/images/login/4.jpg',
			   '/syracuse-ui/themes/desktop/sage/images/login/5.jpg',
               '/syracuse-ui/themes/desktop/sage/images/login/6.jpg',
			   '/syracuse-ui/themes/desktop/sage/images/login/7.jpg',
			   '/syracuse-ui/themes/desktop/sage/images/login/8.jpg'
              ];

   document.body.style.backgroundImage=
   'url('+pics[Math.floor(Math.random()*pics.length)]+')';
   if (isTablet()){
	  var e = document.getElementById("mainlink");
	  if (e){
		  var l = e.getAttribute("href");
		  if(l) {
			  e.setAttribute("href",l.replace("/main.html", "/main-tablet.html"));
		  }
		  e.innerHTML="To start your experience on the tablet version, tap here";
	  }
   }
 }
   window.addEventListener?
   window.addEventListener('load',init,false):
   window.attachEvent('onload',init);

   function authenticate() {
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;

        var auth = "sageerpx3 " + btoa(username+":"+password); // !!! btoa not supported on IE
       
        var request = new XMLHttpRequest();
        request.open("POST", "/sdata/$sessions", true);
        request.setRequestHeader("authorization", auth);
        request.onreadystatechange = function (aEvt) {
            if (request.readyState == 4) {
                 if(request.status == 201) {
                    // should take callbackUrl parameter or main site if no parameter
                    var search = window.location.search || "";
                    var cbUrl = search && search.substring(search.indexOf("callbackUrl=")+12); // quick and dirty, should manage properly
                    cbUrl = cbUrl && decodeURIComponent(cbUrl);
                    window.location.href = cbUrl || "/syracuse-main/html/main.html?url=%3Frepresentation%3Dhome.%24navigation";
                 } else {
                    document.getElementById("error-msg").style.visibility = "visible";
                    document.getElementById('username').value = "";
                    document.getElementById('password').value = "";
                    document.getElementById('username').focus();
                 }
             }
        };
        request.send();
   }

   function redirect(url) {
      window.location = url + window.location.search;
   }
   
</script>
    </head>
    <body>
<div class="container">
  <div class="s-text-containt">
    <div class="s-text" style="float:left;padding-bottom:0;">
      <div class="s-product">Sage ERP X3</div>
      <!-- auth-if basic,sageerpx3 -->
      <div style="float:left;width:100%;">
        <div style="float:left; width:100%;">
          <div id="error-msg" style="float:left;font-size:0.3em;color:red;line-height:1em;visibility: hidden;">Incorrect username and password</div>
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Username: </div>
          <input id="username" type="text" style="width:200px;float:left;line-height: 2em;margin: 1.5em;">
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Password: </div>
          <input id="password" type="password" style="width:200px;float:left;line-height: 2em;margin: 1.5em;margin-left:1.9em;">
        </div>
        <div style="float:left; width:100%;line-height:0.5em;padding-bottom:0.5em">
          <input type="button" value="Sign In" onclick="authenticate()"/>
        </div>
      </div>
      <!-- auth-endif -->
    </div>
    <!-- auth-if sage-id -->
    <div class="s-text" style="float:left;width:89%;padding-top:0;">
      <div class="s-product" style="font-size:0.5em">Sage ID</div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 1em;">
        <a href="javascript:redirect('/auth/sage-id/signIn')">Sign In</a>
      </div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 2em;">
        <a href="javascript:redirect('/auth/sage-id/signUp')">Register for Sage ID</a>
      </div>
    </div>
    <!-- auth-endif -->
  </div>
</div>