<!DOCTYPE html>
<html>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <head>
        <meta charset="UTF-8" />
    	  <meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Sage ERP X3</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">      
        <link rel="stylesheet" type="text/css" href="/syracuse-ui/themes/desktop/sage/login.css" />   
        <script type="text/javascript">
function isTablet() {
  var agt = navigator.userAgent;
  return (document.documentElement.ontouchstart != null) || (agt.match(/(iphone|ipod|ipad)/) || agt.match(/(android)/i) || agt.match(/(iemobile)/) || agt.match(/iphone/i) || agt.match(/ipad/i) || agt.match(/ipod/i) || agt.match(/blackberry/i) || agt.match(/bada/i));
}

function init() {
  var pics = [
   '/syracuse-ui/themes/desktop/sage/images/login/1.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/2.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/3.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/4.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/5.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/6.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/7.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/8.jpg'];

  document.body.style.backgroundImage = 'url(' + pics[Math.floor(Math.random() * pics.length)] + ')';
  if (isTablet()) {
    var e = document.getElementById("mainlink");
    if (e) {
      var l = e.getAttribute("href");
      if (l) {
        e.setAttribute("href", l.replace("/main.html", "/main-tablet.html"));
      }
      e.innerHTML = "To start your experience on the tablet version, tap here";
    }
  }
}
window.addEventListener ? window.addEventListener('load', init, false) : window.attachEvent('onload', init);

function authToken(type, username, password) {
   // !!! btoa not supported on IE??
  switch (type) {
    case 'basic': return 'Basic ' + btoa(username + ":" + password);
    case 'sageerpx3': return 'sageerpx3 ' + btoa(username + ":" + password);
    default: return null;
  }
}

function queryString() {
  return (window.location.search || '').split('&').reduce(function(qs, item) {
    var pair = item.split('=');
    if (pair[0] && pair[1] != null) qs[pair[0]] = decodeURIComponent(pair[1]);
    return qs;
  }, {});
}

function authenticate(type) {
  var username = document.getElementById('username').value;
  var password = document.getElementById('password').value;

  var auth = authToken(type, username, password);
  if (!auth) return alert("unsupported authentication method: " + auth);

  var request = new XMLHttpRequest();
  request.open("POST", "/auth/submitLogin", true);
  request.setRequestHeader("authorization", auth);
  request.onreadystatechange = function(aEvt) {
    if (request.readyState == 4) {
      if (request.status == 200) {
        window.location.href = queryString().callbackUrl || "/";
      } else {
        document.getElementById("error-msg").style.visibility = "visible";
        document.getElementById('username').value = "";
        document.getElementById('password').value = "";
        document.getElementById('username').focus();
      }
    }
  };
  request.send();
}

function redirect(url) {
  window.location = url + window.location.search;
}   
</script>
    </head>
    <body>
<div class="container">
  <div class="s-text-containt">
    <div class="s-text" style="float:left;padding-bottom:0;">
      <div class="s-product">Sage ERP X3</div>
      <div style="visibility:{{passwordVisibility}};float:left;width:100%;">
        <div style="float:left; width:100%;">
          <div id="error-msg" style="float:left;font-size:0.3em;color:red;line-height:1em;visibility: hidden;">Incorrect username or password. Try again...</div>
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Username: </div>
          <input id="username" type="text" style="width:200px;float:left;line-height: 2em;margin: 1.5em;">
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Password: </div>
          <input id="password" type="password" style="width:200px;float:left;line-height: 2em;margin: 1.5em;margin-left:1.9em;">
        </div>
        <div style="float:left; width:100%;line-height:0.5em;padding-bottom:0.5em;">
          <input style="visibility:{{basicVisibility}};" type="button" value="Sign In (basic)" onclick="authenticate('basic')"/>
          <input style="visibility:{{digestVisibility}};" type="button" value="Sign In (digest)" onclick="authenticate('digest')"/>
          <input style="visibility:{{sageerpx3Visibility}};" type="button" value="Sign In (X3)" onclick="authenticate('sageerpx3')"/>
          <input style="visibility:{{ldapVisibility}};" type="button" value="Sign In (LDAP)" onclick="authenticate('ldap')"/>
        </div>
      </div>
    </div>
    <div class="s-text" style="visibility:{{sage-idVisibility}};float:left;width:89%;padding-top:0;">
      <div class="s-product" style="font-size:0.5em">Sage ID</div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 1em;">
        <a href="javascript:redirect('/auth/sage-id/signIn')">Sign In</a>
      </div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 2em;">
        <a href="javascript:redirect('/auth/sage-id/signUp')">Register for Sage ID</a>
      </div>
    </div>
  </div>
</div>