<!DOCTYPE html>
<html>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <head>
        <meta charset="UTF-8" />
    	  <meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Sage ERP X3</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">      
        <link rel="stylesheet" type="text/css" href="/syracuse-ui/themes/desktop/sage/login.css" />   
        <script type="text/javascript">
function isTablet() {
  var agt = navigator.userAgent;
  return (document.documentElement.ontouchstart != null) || (agt.match(/(iphone|ipod|ipad)/) || agt.match(/(android)/i) || agt.match(/(iemobile)/) || agt.match(/iphone/i) || agt.match(/ipad/i) || agt.match(/ipod/i) || agt.match(/blackberry/i) || agt.match(/bada/i));
}

function init() {
  var pics = [
   '/syracuse-ui/themes/desktop/sage/images/login/1.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/2.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/3.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/4.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/5.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/6.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/7.jpg',
   '/syracuse-ui/themes/desktop/sage/images/login/8.jpg'];

  document.body.style.backgroundImage = 'url(' + pics[Math.floor(Math.random() * pics.length)] + ')';
  if (isTablet()) {
    var e = document.getElementById("mainlink");
    if (e) {
      var l = e.getAttribute("href");
      if (l) {
        e.setAttribute("href", l.replace("/main.html", "/main-tablet.html"));
      }
      e.innerHTML = "To start your experience on the tablet version, tap here";
    }
  }

  var oauth2s = {{oauth2s}};
  if (oauth2s.length > 0) {
    var div = document.getElementById("oauth2-0");
    var parent = div.parentNode;
    oauth2s.forEach(function(oauth2, i) {
      if (i > 0) {
        div = div.clone(true);
        div.id = "oauth2-" + i;
        parent.appendChild(div);
      }
      div.firstElementChild.href = oauth2.href;
      div.firstElementChild.textContent = oauth2.title;
    });
  }

}
window.addEventListener ? window.addEventListener('load', init, false) : window.attachEvent('onload', init);

function authToken(type, username, password) {
   // !!! btoa not supported on IE??
  switch (type) {
    case 'basic': return 'Basic ' + btoa(username + ":" + password);
    case 'sageerpx3': return 'sageerpx3 ' + btoa(username + ":" + password);
    default: return null;
  }
}

function authenticate(type) {
  var username = document.getElementById('username').value;
  var password = document.getElementById('password').value;

  var auth = authToken(type, username, password);
  if (!auth) return alert("unsupported authentication method: " + auth);

  var request = new XMLHttpRequest();
  request.open("POST", "/auth/login/submit", true);
  request.setRequestHeader("authorization", auth);
  request.setRequestHeader("accept", "application/json");
  request.onreadystatechange = function(aEvt) {
    if (request.readyState == 4) {
      try {
        json = JSON.parse(request.responseText);
        window.location.href = json.$diagnoses[0].$links.redirect.$url;
      } catch (ex) {
        document.getElementById('error-msg').textContent = ex.message || request.statusText;
        document.getElementById('password').value = "";
        document.getElementById('username').focus();
      }
    }
  };
  request.send();
}

function redirect(url) {
  window.location = url;
}   
</script>
    </head>
    <body>
<div class="container">
  <div class="s-text-containt">
    <div class="s-text" style="float:left;padding-bottom:0;">
      <div class="s-product">Sage ERP X3</div>
      <div style="visibility:{{passwordVisibility}};float:left;width:100%;">
        <div style="float:left; width:100%;">
          <div id="error-msg" style="float:left;font-size:0.3em;color:red;line-height:1em;">{{errorMessage}}</div>
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Username: </div>
          <input id="username" type="text" style="width:200px;float:left;line-height: 2em;margin: 1.5em;">
        </div>
        <div style="float:left; width:100%;">
          <div style="float:left;font-size: 0.5em;">Password: </div>
          <input id="password" type="password" style="width:200px;float:left;line-height: 2em;margin: 1.5em;margin-left:1.9em;">
        </div>
        <div style="float:left; width:100%;line-height:0.5em;padding-bottom:0.5em;">
          <input style="visibility:{{basicVisibility}};" type="button" value="Sign In (basic)" onclick="javascript:authenticate('basic')"/>
          <input style="visibility:{{digestVisibility}};" type="button" value="Sign In (digest)" onclick="javascript:authenticate('digest')"/>
          <input style="visibility:{{sageerpx3Visibility}};" type="button" value="Sign In (X3)" onclick="javascript:authenticate('sageerpx3')"/>
          <input style="visibility:{{ldapVisibility}};" type="button" value="Sign In (LDAP)" onclick="javascript:authenticate('ldap')"/>
        </div>
      </div>
    </div>
    <div class="s-text" style="visibility:{{oauth2Visibility}};float:left;width:89%;padding-top:0;">
      <div class="s-product" style="font-size:0.5em">Login with OAuth 2</div>
      <div id="oauth2-0" style="float:left; width:100%;font-size:0.5em;line-height: 1em;">
        <a href="javascript:redirect('/auth/oauth2/signOnStart')"></a>
      </div>
    </div>
    <div class="s-text" style="visibility:{{sage-idVisibility}};float:left;width:89%;padding-top:0;">
      <div class="s-product" style="font-size:0.5em">Sage ID</div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 1em;">
        <a href="javascript:redirect('/auth/sage-id/signOnStart')">Sign In</a>
      </div>
      <div style="float:left; width:100%;font-size:0.5em;line-height: 2em;">
        <a href="javascript:redirect('/auth/sage-id/registerStart')">Register for Sage ID</a>
      </div>
    </div>
  </div>
</div>