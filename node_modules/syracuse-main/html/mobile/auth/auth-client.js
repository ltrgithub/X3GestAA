"use strict"; 
(function($) {
	$.proto = $.proto || {};
	var $proto = $.proto;
	var $helpers = $.helpers;
	var $sdata = $.sdata;
	var that = $proto.auth || {};
	$proto.auth = that;
	$proto.auth.designMode = true;
	$proto.auth.apply
	$proto.auth.notifyParent = function(event, eventData, info) {
		var $auth = (window && window.parent && (window.parent != window) && window.parent.$ && window.parent.$.auth)?window.parent.$.auth:null;
		if ($auth) {
			return $auth.notify(event, eventData, info);
		} else {
			return eventData;
		}
	};
	$proto.auth.applyAuth = function(name, value, authorUrl) {
		if ($sdata.config || ($sdata.config.id != page.application)) {
			$sdata.getAppConfig($sdata.config.id, function(config, error) {
				$sdata.config = config;
				
				var design = $sdata.config.pages[name];
				if (authorUrl) design.$authorUrl = authorUrl;
				design.$article = value;
				$sdata.saveAppConfig($sdata.config, function() {
					window.location.reload(true);
				});
				
			});
		} 
	};
	$proto.auth.createAuthWorhingCopy = function(url, name, data) {
		var cd = {
			$actions:{
				"$save":{
					"$isRequested":true,
					"$parameters":{
						"saveAsOption":"factory_variant",
						"isFactory":true,
						"variantCode":"DEFAULT",
						"variantTitle":"DEFAULT",
						"variantDescription":"DEFAULT"
					}
				}
			},
			content: {
				$article: data
			}
		
		};
		$sdata.post(url, cd, function(resdata) {
			if (resdata && resdata.$authorUrl && resdata.content && resdata.content.$article) {
				return $proto.auth.applyAuth(name, resdata.content.$article, resdata.$authorUrl);
			}
		});
	};
	
	
})(jQuery); 

	