"use strict"; 
$(function() {
	var $auth = $.auth;
	$auth.resetData = function(eventData, info) {
		$auth.name = "";
		$("#json").val('');
		$("#proto").val('');
	}
	$auth.loadData = function(data, info) {
		$auth.name = info.name;
		$auth.$authorUrl = info.$authorUrl;
		$("#json").val(window.JSON.stringify(data, null,2));
		if (info.$prototype) {
			$("#proto").val(window.JSON.stringify(info.$prototype, null,2));
		}
	};
	$("#refresh").click(function(e) {
		var value = $("#json").val();
		if (!value) return;
		if (value ) {
			try {
				value = JSON.parse(value);
				$("#json").val(window.JSON.stringify(value, null,2));
			} catch(ex) {
				alert(ex.message);
				return;
			}
			var cw = $('#view')[0].contentWindow;
			if ($auth.name && cw.$.proto.auth.applyAuth) {
				cw.$.proto.auth.applyAuth($auth.name, value); 
			}
			
		}
	});
	$("#save").click(function(e) {
		if ($auth.$authorUrl) {
			var value = $("#json").val();
			if (!value) return;
			if (value ) {
				try {
					value = JSON.parse(value);
					$("#json").val(window.JSON.stringify(value, null,2));
				} catch(ex) {
					alert(ex.message);
					return;
				}
				var cw = $('#view')[0].contentWindow;
				cw.$.proto.auth.createAuthWorhingCopy($auth.$authorUrl, $auth.name, value, function(data){});
				
			}		
		}
	});
	
	
});