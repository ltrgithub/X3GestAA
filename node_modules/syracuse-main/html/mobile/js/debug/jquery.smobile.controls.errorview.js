(function($) {
	var that = $.smobile || {};
	$.smobile = that;
	that.controls.ErrorView = {
		_additem: function(cd, html) {
			html.push('<li');
			var css = [];
			if (true) css.push("ui-li-has-icon");
			//if (layout.icon_size) css.push(layout.icon_size);
			if (css.length) html.push(' class="' + css.join(" ")+'"');
			html.push('>');
			html.push($.helpers.FUNCS.TITLE_LW(cd.title)+ $.helpers.FUNCS.ERROR(cd.data.message) + $.helpers.FUNCS.INFO(cd.data.solution));
			html.push('</li>');
		
		},
		handler: function(c, after) {
			var controller = this, html = [], options= c.data || {};
			var data = $.helpers.lastErrors();
			html.push('<ul id="'+c.id + '" data-role="listview"');
			html.push(' data-inset="true"');
			html.push('>');
			if (data) {
				data.forEach(function(cd){
					that.controls.ErrorView._additem(cd, html);
				});
			}
			html.push('</ul>');
			controller.hasErrorView = true;
			after({ 
				html: html.join(''),
				bind: true
			});
		},
		refresh: function(controller, options, $c, id) {
			var data = $.helpers.lastErrors(), html=[];
			data.forEach(function(cd){
				that.controls.ErrorView._additem(cd, html);
			});
			$c.html(html.join(''));
			$c.listview("refresh");
		}
	}
})(jQuery);    


