(function(b){var e=b.proto||{};b.proto=e;var f=function(a){this.stack=[];a&&this.stack.push(a)};f.prototype={push:function(a){this.stack.unshift(a)},data:function(){return this.stack.length?this.stack[this.stack.length-1]:null},parent:function(a){a=this.stack.indexOf(a);return 0<a?this.stack[a-1]:null}};var d="application/x-string,application/x-password,application/x-integer,application/x-real,application/x-decimal,application/x-boolean,application/x-date,application/x-time,application/x-datetime,application/x-choice,image".split(",");
e.trace={expressions:!1};e.isExpression=function(a){return 0<=a.indexOf("{")};e.sdataKey={workingCopies:"$workingCopies"};e.exprData=function(a){return new f(a)};e.htmlValue=function(a,c,d,h){var f=a[h.$bind],j=b.proto.exprData(a),j=b.proto.exprData(a);if(d.$isHidden)return"";null===f&&(f="");switch(h.$type){case "application/x-password":case "application/x-string":if(d.$format&&f){if("$email"===d.$format)return'<a href="mailto:'+f+'">'+f+"</a>";if("$phone"===d.$format)return'<a href="tel://'+f+'">'+
f+"</a>"}return b.helpers.htmlEncode(f);case "application/x-integer":return b.helpers.htmlEncode(f+"");case "application/x-real":return b.helpers.htmlEncode(f+"");case "application/x-decimal":return b.helpers.htmlEncode(f+"");case "application/x-date":return f&&(f=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,new Date(f))),b.helpers.htmlEncode(f+"");case "application/x-datetime":return b.helpers.htmlEncode(f+"");case "application/x-time":return b.helpers.htmlEncode(f+"");case "application/x-boolean":return'<div class="ui-icon ui-icon-shadow ui-icon-checkbox-'+
(f?"on":"off")+'"></div>';case "application/x-choice":c=d.$value.$enum;j=0;for(d=c.length;j<d;j++)if(c[j].$value===f)return b.helpers.htmlEncode(c[j].$title);break;case "image":if(f){a=f.$url;!a&&d.$url&&(a=e.parseExpression(d.$url,{data:j,$prototype:d},"$url"));if(a)return f=a,e.isExpression(a)&&(f=e.parseExpression(a,{data:j,$prototype:c},"$url")),'<image class="s-image-detail" src="'+f+'"/>';if(f.$value)return'<image class="s-image-detail" src="data:'+(f.$contentType||"image/jpeg")+";base64,"+
f.$value+'"/>'}}return null};e.getArticle=function(a){var c=a.$article;if(c)return c;c=a.$prototype;return c.$article};e.extractFirstProp=function(a){var c=a.indexOf("}");0<=c&&(a=a.substring(0,c));c=a.indexOf("{");0<=c&&(a=a.substring(c+1));return a};e.getProto=function(a,c){if(!c)return a.$prototype||a.$;var b=a.$prototype;if(b=b&&b.$properties?b.$properties:a.$properties){if(b=b[c])switch(b.$type){case "application/x-array":b=b.$item;if(b.$item)b=b.$item;break;case "application/x-reference":if(b.$item)b=
b.$item;break;case "application/x-object":if(b.$item)b=b.$item}return b}return null};e.linkParents=function(a,c){if(a){var b=[];if(!a.$protoparent)a.$protoparent=c;if(!a.$rprotoparent)a.$rprotoparent=c;a.$properties&&Object.keys(a.$properties).forEach(function(c){c=a.$properties[c];switch(c.$type){case "application/x-array":c.$protoparent=a;c.$rprotoparent=a;c.$item.$rtype="application/x-array";c.$item.$protoparent=c;c.$item.$rprotoparent=a;var d=c.$item;if(d&&d.$item)d=d.$item,d.$rprotoparent=a,
d.$protoparent=c.$item,d.$rtype="application/x-array";b.push(d);break;case "application/x-reference":c.$protoparent=a;c.$rprotoparent=a;c.$item.$protoparent=c;c.$item.$rprotoparent=a;c.$item.$rtype="application/x-reference";b.push(c.$item);break;case "application/x-object":if(!c.$item)break;c.$protoparent=a;c.$rprotoparent=a;c.$item.$protoparent=c;c.$item.$rprotoparent=a;b.push(c.$item);c.$item.$rtype="application/x-object";break;default:c.$protoparent=a,c.$rprotoparent=a}});b.forEach(function(c){e.linkParents(c,
a)})}};e.layoutParser=function(a,c,b,f,g){var j=a,a=!1;if(!c.$isHidden){var m=f.slice(),l=m[m.length-1];if(c.$category&&c.$title)j.fields=j.fields||[],f={$isSection:!0,fields:[]},f.title=e.parseExpression(c.$title,{data:null,$prototype:l},"$title"),j.fields.push(f),j=f;if(c.$bind){l=l&&l.$properties?l.$properties[c.$bind]:null;if(!l||!l.$type||l.$isHidden)return;if("application/x-array"===l.$type)if("$resources"==c.$bind)m.push(l.$item);else{if(!l.$item)return;j.fields=j.fields||[];f={$type:l.$type,
$bind:c.$bind,$title:l.$title,$proto:l.$item};j.fields.push(f);switch(l.$item.$type){case "application/x-reference":break;case "application/json":case "application/x-object":var b={},k=[];m.push(l.$item);var o=c.$layout||c.$cards,n=!1;o&&(e.layoutParser(b,o,"",m,k),a=!0);k.length?c.$cards&&(n=!0):Object.keys(l.$item.$properties).forEach(function(c){"$"!==c.charAt(0)&&(l.$isHidden||k.push(c))});f.items=k;f.cards=n;if(!l.$item)return;break;default:d.indexOf(l.$item.$type);return}}else{if("application/x-object"!==
l.$type)if("application/x-reference"===l.$type){if(!l.$item)return;l=l.$item;j.fields=j.fields||[];f={$type:"application/x-reference",$bind:c.$bind,$title:l.$title,$proto:l};j.fields.push(f)}else if(!(0>d.indexOf(l.$type)))g&&g.push(c),j.fields=j.fields||[],f={$type:l.$type,$bind:c.$bind},j.fields.push(f);return}}a||Object.keys(c).forEach(function(a){var b=c[a];b&&(Array.isArray(b)?b.forEach(function(c){"object"==typeof c&&e.layoutParser(j,c,a,m,g)}):"object"==typeof b&&e.layoutParser(j,b,a,m,g))})}};
e.useUuid=function(a){return"{$uuid}"===a.$key};e.getRefFromValue=function(a,c){if(!a)return null;var b={};if(e.useUuid(c))b.$uuid=a.$uuid,b.$key=a.$key||a.$uuid;Object.keys(c.$properties).forEach(function(c){b[c]=a[c]});return b};e.setArrayRef=function(a,c){if(b.proto.useUuid(c))return a;var d={};Object.keys(c.$properties).forEach(function(b){if(c.$properties.isReadOnly)a&&delete a[b];else{var e=(a?a[b]:"")||"",f=c[b];f||(f="{"+b+"}");if(f&&!("{"!=f.charAt(0)||"}"!=f.charAt(f.length-1)))a&&delete a[b],
b=f.substring(1,f.length-1),d[b]=e}});return d};e.proto2Instance=function(a){var c={},d;Object.keys(a.$properties).forEach(function(e){var f=a.$properties[e];if("$"!==e.charAt(0))switch(f.$type){case "application/x-password":case "application/x-string":c[e]="";break;case "application/x-decimal":case "application/x-real":c[e]=0;break;case "application/x-integer":c[e]=0;break;case "application/x-boolean":c[e]=!1;break;case "application/x-date":d=new Date;c[e]=b.helpers.date.checkString(d.toISOString());
break;case "application/x-datetime":d=new Date;c[e]=d.toISOString();break;case "application/x-time":d=b.helpers.Time.parse("00:00");c[e]=d.toISO();break;case "application/x-choice":c[e]=f.$value.$enum[0].$value}});return c};e.setRef=function(a,c,d,e){var f=b.proto.useUuid(c),j=d.data();f?j[e]=a:(Object.keys(c.$properties).forEach(function(b){if(c.$properties.isReadOnly)a&&delete a[b];else{var d=(a?a[b]:"")||"",e=c[b];e||(e="{"+b+"}");if(e&&!("{"!=e.charAt(0)||"}"!=e.charAt(e.length-1)))a&&delete a[b],
b=e.substring(1,e.length-1),c.$rprotoparent.$properties[b]&&(j[b]=d)}}),a?Object.keys(a).length&&(j[e]=a):delete j[e])};e._protoProp=function(a,c){if("$baseUrl"===c)return{value:b.sdata.config.baseUrl,found:!0,stop:!0};var d=a;if("@"==c.charAt(0))for(;d;){if(d&&d.$localization&&d.$localization.hasOwnProperty(c))return{value:d.$localization[c],found:!0,stop:!0};d=d.$rprotoparent}else for(;d;){if(d.hasOwnProperty(c))return{value:d[c],found:!0};d=d.$protoparent}return{found:!1}};e._dataProp=function(a,
c){if("$baseUrl"===c)return{value:b.sdata.config.baseUrl,found:!0,stop:!0};for(var d=a.data();d;){if(d.hasOwnProperty(c))return{value:d[c],found:!0};d=a.parent(d)}return{value:"",found:!1}};e.execExpression=function(a,c,b,d){d=d||0;a=(a||"")+"";if(!d&&0>a.indexOf("{")&&b){var f=e._dataProp(b,a);if(f.found)return f.value}return a.replace(/\{(.*?)\}/g,function(f,g){var l;if(!d&&c&&!c.noRef&&c.$protoparent&&"application/x-reference"===c.$protoparent.$type){l=e._protoProp(c,g);if(l.found){if(l.stop)return l.value||
"";if(0<=l.value.indexOf("{")){var k=c;if(0<=l.value.indexOf("{"+g+"}"))k=c.$protoparent;return e.execExpression(l.value,k,b,d+1)}l=b?e._dataProp(b,g):{found:!1};!l.found&&e.trace.expressions&&(console.log(a),console.log("Not found:"+g),console.log("----------------------------------"));return l.value||""}l=b?e._dataProp(b,g):{found:!1};!l.found&&e.trace.expressions&&(console.log(a),console.log("Not found:"+g),console.log("----------------------------------"));return l.value||""}l=b?e._dataProp(b,
g):{found:!1};if(l.found)return l.value||"";l=c?e._protoProp(c,g):{found:!1};return!l.found?(e.trace.expressions&&(console.log(a),console.log("Not found:"+g),console.log("----------------------------------")),""):l.stop?l.value:0<=l.value.indexOf("{")?e.execExpression(l.value,c,b,d+1):l.value||""})||""};e.parseExpression=function(b,c){return e.execExpression(b,c.$prototype,c.data)};e.jqmDataArray=function(){return{"data-inset":"true","data-mini":"true","data-theme":"d","data-divider-theme":"e"}};
e.generateForm=function(b,c,f,h,g,j){var m=!0,l=h,k=[],o=null;g&&(l="c"+c,c++,f[l]={layout:"BlockLayout",data:{jmdata:{"data-theme":"d"}},parent:h});b.fields&&b.fields.forEach(function(b){if(b.$isSection){var a=o=null;b.title&&(a={layout:"CollapsibleLayout",data:{facet:j,jmdata:{"data-theme":"b","data-content-theme":"d","data-inset":g?"false":"true"},text:b.title,collapsed:!1,size:6}});if(a){if(l)a.parent=l;var h="c"+c;c++;f[h]=a;b.fields&&b.fields.length&&(c=e.generateForm(b,c,f,h,!1,j));k.push(a)}}else if(m=
!1,a=null,0<=d.indexOf(b.$type)){if(!o){a={uiClass:"MultiField",data:{facet:j,fields:[]}};if(l)a.parent=l;h="e"+c;c++;o=f[h]=a}o.data.fields.push(b)}else{o=null;a={uiClass:"ArrayField",data:{facet:j,field:b}};a.data.jmdata=e.jqmDataArray();if(l)a.parent=l;h="e"+c;c++;f[h]=a}});if(g&&m)f[l].layout="CollapsibleSetsLayout",k.forEach(function(c,b){c.data.collapsed=0!=b});return c}})(jQuery);
(function(b){var e=b.helpers||{};(function(){if(!Array.isArray)Array.isArray=function(c){return null!=c&&null!=c.splice};if(!Function.prototype.bind)Function.prototype.bind=function(c){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),a=this,d=function(){},e=function(){return a.apply(this instanceof d?this:c||window,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;
e.prototype=new d;return e};if(!Object.keys)Object.keys=function(c){if(c!==Object(c))throw new TypeError("Object.keys called on non-object");var b=[],a;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&b.push(a);return b};var c=!1;try{isNaN(new Date("2011-11-08T23:00:00.000Z"))&&(c=!1)}catch(b){c=!1}Date.parseISO8601=c?function(c){return new Date(c)}:function(c){var b=/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?)?)?$/.exec(c);if(null===b)throw Error("Invalid ISO String");
var a=new Date;a.setUTCFullYear(+b[1]);a.setUTCMonth(b[3]?(b[3]>>0)-1:0);a.setUTCDate(b[5]>>0);a.setUTCHours(b[7]>>0);a.setUTCMinutes(b[8]>>0);a.setUTCSeconds(b[10]>>0);a.setUTCMilliseconds(b[12]>>0);if(b[13]&&"Z"!==b[13]){var d=b[16]>>0,e=b[17]>>0,c="+"===b[15];a.setUTCHours((b[7]>>0)+c?-d:d);a.setUTCMinutes((b[8]>>0)+c?-e:e)}return a}})();if(!window.console)window.console={log:function(){}};b.helpers=e;b.helpers.extend=function(c,b){for(var a in b)c[a]=b[a]};var f={http:1,db:2,exception:3,sdata:4};
e.slashAtEnd=function(c){c&&"/"!=c.charAt(c.length-1)&&(c+="/");return c};e.displayDateFormat="YYYY-MM-DD";e._diag=function(c,b,a){if(c){var d=c.$diagnoses;if(d&&d.length)b?a[b]={message:d[0].message}:a.message=d[0].message;Object.keys(c).forEach(function(d){var f=c[d],g=f.$diagnoses;if(g&&g.length&&(a[d]={message:g[0].message},!a.message))a.message=d+": "+a[d].message;if("object"==typeof f&&(f.$||f.$properties))e._diag(f.$||f.$properties,b?b+"."+d:d,a)})}};e.http={parseCookie:function(c){var b={};
(c||"").split(";").forEach(function(c){c=c.split("=");2<=c.length&&c[0]&&c[1]&&(b[c[0].trim()]=c[1].trim())});return b},setCookie:function(c,b,a,d){!b&&""==b&&(d=new Date);try{window.document.cookie=c+"="+b+(null!=d?"; expires="+d.toGMTString():"")+(a?"; path="+a:"/")}catch(e){}}};e.extractErrors=function(c,b){var a={message:b};if(!c||!c.$&&!c.$properties)return a;e._diag(c.$||c.$properties,"",a);return a};e.format=function(c,b){return c=c.replace(/\{([0-9]\})*/g,function(c,a){return b[parseInt(a)]})};
e.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var b=16*Math.random()|0;return("x"==c?b:b&3|8).toString(16)})};e.htmlEncode=function(c){return b("<div/>").text(c).html()};e.htmlDecode=function(c){return b("<div/>").html(c).text()};e.FUNCS={H:function(c,b,a){return c?b+c+a:""},ERROR:function(c){return e.FUNCS.H(c,'<p class="ui-m-margin-0 ui-m-error"><strong>',"</strong><br/p>")},INFO:function(c){return e.FUNCS.H(c,'<p class="ui-m-margin-0 ui-m-ok">',"</p>")},
TITLE_LW:function(c){return e.FUNCS.H(c,'<p class="ui-m-margin-0"><strong>',"</strong></p>")}};e.ERRORS=f;e.pushdbError=function(c){e.pushError({type:f.db,title:e.messages.db_exception,data:{message:c.message}})};e.pushException=function(c,b){e.pushError({type:f.exception,title:e.messages.app_exception,data:{message:c.message,solution:b}})};e.pushAjaxError=function(c,a,d,g,j){var a=d,j=j||"GET",m=null;if(c.responseText&&0<c.responseText.indexOf("$diagnoses"))try{m=JSON.parse(c.responseText)}catch(l){}if(m&&
m.$diagnoses&&m.$diagnoses.length)a=m.$diagnoses[0].message;else if(d&&d.message)a=d.message;else if(c.statusText)a=c.statusText;if(!a)a=b.smobile.locale().ui.unknownError;200==c.status||201==c.status?e.pushError({type:f.exception,title:e.messages.app_exception,data:{message:a}}):e.pushError({type:f.http,title:j+" "+g,data:{message:(c.status?c.status+" - ":"")+a}})};e._errkey=function(c){return c?"mobile_errors":"mobile_errors"};e._localStorage=!0;try{if(!window.sessionStorage)e._localStorage=!1}catch(d){e._localStorage=
!1}e._pushError=function(c,b){var a=e._errkey(b);if(e._localStorage){var d=window.sessionStorage.getItem(a),d=d?JSON.parse(d):[];d.push(c);window.sessionStorage.setItem(a,JSON.stringify(d))}else e[a]||(e[a]=[]),e[a].push(c)};e._hasErrors=function(c){c=e._errkey(c);return e._localStorage?(c=window.sessionStorage.getItem(c))?(c=JSON.parse(c),0<c.length):!1:e[c]&&e[c].length};e._clearErrors=function(c){c=e._errkey(c);e._localStorage?window.sessionStorage.removeItem(c):delete e[c]};e._lastErrors=function(c){c=
e._errkey(c);return e._localStorage?(c=window.sessionStorage.getItem(c))?JSON.parse(c):null:e[c]};e.pushError=function(c){e._pushError(c,!1)};e.hasErrors=function(){return e._hasErrors(!1)};e.clearErrors=function(){e._clearErrors(!1)};e.lastErrors=function(){return e._lastErrors(!1)};e.pushWarn=function(c){e._pushError(c,!0)};e.hasWarns=function(){return e._hasErrors(!0)};e.clearWarns=function(){e._clearErrors(!0)};e.lastWarns=function(){return e.lastErrors(!0)};e.each=function(c,b,a,d){c=c||[];if(!c.length)return a();
if(null==a)return c.forEach(b);var d=d||1,e=0,f=0,l=c.length;(function o(){if(f==l&&!e)return a();for(;f<l&&e<d;){e++;var n=f++;b(c[n],n,function(){e--;o()})}})()};e.forEachKey=function(c,b,a,d){if(a)return null==c?a():e.each(Object.keys(c),function(a,d,e){return b(a,c[a],e)},a,d);for(var f in c)b(f,c[f])};e.sdataURL2key=function(c){return(c=/^.*\(\'(.*)\'\)$/.exec(c))&&2==c.length?c[1]:""};e.applySDataSort=function(c,b){b.sort(function(b,a){for(var d,e,f=0,i=c.length;f<i;f++){var o=c[f];d=b[o.name];
e=a[o.name];if(d!=e)return d>e?o.asc?1:-1:o.asc?-1:1}return 0})};e.addJqmData=function(b,a,d,e,f){b.jmdata&&Object.keys(b.jmdata).forEach(function(m){if(!(d&&0>d.indexOf(m))){var l=b.jmdata[m],k="true"==b.jmdata||"false"==b.jmdata?"":'"';e?a.push(" "+f+l):a.push(" "+m+"="+k+l+k)}})};e.encodeURIComponent=function(b){return encodeURIComponent(b).replace(/\'/g,"%27")};e.encodeJsmQuery=function(b){return e.encodeURIComponent(b)};e.decodeJsmQuery=function(b){return 0<b.indexOf("=")?b:decodeURIComponent(b)};
e.hashFirst=function(){return!0};e.sdataSort=function(b){if(b&&b.orderBy){var a=b.orderBy.split(",");a.forEach(function(b,c){var b=b.trim(),d=b.split(" ");a[c]=2==d.length?{name:d[0],asc:"desc"!=d[1]}:{name:b,asc:!0}});return a}return null};e.number={decimalSep:"",decimalSeparator:function(){if(e.decimalSep)return e.decimalSep;var b;b=(1.1).toLocaleString().substring(1,2);return e.decimalSep=b}};var a=function(b){b=""+b;1==b.length&&(b="0"+b);return b};e.date={isoToDate:function(b){return Date.parseISO8601(b)},
dateMY:function(b){return e.messages.monthsOfYear[b.getMonth()]+" "+b.getFullYear()},dateMY2:function(b,a){return e.messages.monthsOfYear[b]+" "+a},dateym:function(b){return b.getFullYear()+"-"+a(b.getMonth()+1)},str2dateym:function(b){b=e.date.isoToDate(b);return b.getFullYear()+"-"+a(b.getMonth()+1)},str2dateYM:function(b){b=e.date.isoToDate(b);return e.date.dateMY(b)},dateTimeToLocalDate:function(b){return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())},checkString:function(b,a){if(!a)return b.substring(0,
10);try{var d=b.substring(0,10);return a.substring(0,10)==d?a:d}catch(e){return a}},dateStringToIso:function(b){var a=(new Date).toISOString().substring(10);return Date.parseISO8601(b+a).toISOString()}}})(jQuery);
(function(b){var e=b.helpers||{};b.helpers=e;b.helpers.Time=function(b){this._value=(b+31536E7)%86400};var f=function(b){b=b.toString();return 1==b.length?"0"+b:b};b.helpers.Time.prototype={hour:function(){return Math.floor(this._value/3600)},minute:function(){return Math.floor(this._value/60)%60},second:function(){return this._value%60},value:function(){return this._value},toISO:function(){return f(this.hour())+":"+f(this.minute())+":"+f(this.second())},format:function(){var b=this.hour(),a=this.minute(),
c=this.second(),i=e.dateSettings.timeFormat||"HH:ii",h=a+"",a=f(a),g=c+"",c=f(c),j=b+"",m=f(b);if(e.dateSettings.ampmText){var l="AM";13<b&&(b-=12,j=b+"",m=f(b),l="PM");return i.replace(/ii/,a).replace(/i/,h).replace(/ss/,c).replace(/s/,g).replace(/hh/,m).replace(/h/,j).replace(/A/,l)}return i.replace(/ii/,a).replace(/i/,h).replace(/ss/,c).replace(/s/,g).replace(/HH/,m).replace(/H/,j)}};b.helpers.Time.parse=function(d){d=d||"00:00";if(5!=d.length&&8!=d.length)throw Error("bad time format, expected hh:mm or hh:mm:ss, got "+
d);d=8==d.length?3600*parseInt(d.substring(0,2),10)+60*parseInt(d.substring(3,5),10)+parseInt(d.substring(6.8),10):3600*parseInt(d.substring(0,2),10)+60*parseInt(d.substring(3,5),10);return new b.helpers.Time(d)};b.helpers.Time.parseTime=function(d){var a=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,new Date),d=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,a+" "+d),a=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,
a+" "+(new b.helpers.Time("00:00")).format());return new b.helpers.Time((d-a)/1E3)};e.messages={http_error:"Http Error",app_exception:"Application Exception",db_exception:"Database Exception",nothing_to_send:"No changes to send.",menu_apps:"Root Menu",datasets:"Societies",entities:"Entities",resources:"Resources"};e.lang2DateSettings=function(d){var a=new Date;d||(d={amDesignator:"AM",pmDesignator:"PM",dateElementOrder:"mdy",dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
abbreviatedDayNames:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),abbreviatedMonthNames:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),formatPatterns:{shortDate:"M/d/yyyy",shortTime:"h:mm tt"}});d={ampmText:d.amDesignator||d.pmDesignator?"&nbsp;":"",dateFormat:d.formatPatterns.shortDate.toLowerCase().replace(/yyyy/,"yy"),dateOrder:d.dateElementOrder.replace(/m/,"mm").replace(/y/,
"yy").replace(/d/,"dd"),dayNames:d.dayNames,dayNamesShort:d.abbreviatedDayNames,monthNames:d.monthNames,monthNamesShort:d.abbreviatedMonthNames,timeFormat:d.formatPatterns.shortTime.replace(/tt/g,"A").replace(/m/g,"i"),yearText:b.smobile.locale().datetime.year,monthText:b.smobile.locale().datetime.month,dayText:b.smobile.locale().datetime.day,minuteText:b.smobile.locale().datetime.minutes,hourText:b.smobile.locale().datetime.hour,secText:b.smobile.locale().datetime.seconds};d.endYear=a.getFullYear()+
20;d.timeFormat=d.ampmText?d.timeFormat.replace(/H/g,"h"):d.timeFormat.replace(/h/,"H");d.timeWheels=d.timeFormat.replace(/:/g,"").replace(/ /g,"");return d};e.dateSettings=e.lang2DateSettings(null);b.scroller&&b.scroller.setDefaults(e.dateSettings)})(jQuery);(function(b){var e=b.sdata||{};b.sdata=e;e.sdataHost=window.location.protocol+"//"+window.location.host;e.sdataAdmin=e.sdataHost+"/sdata/syracuse/collaboration/syracuse/dashboardDefs/$service/mobilePortlets";e.store=function(){return!1};e.$url=function(b,c){c=c||b.$url;return b.$baseURI&&0>c.indexOf(b.$baseURI)?b.$baseURI+c:c};e.$purl=function(b){var b=b||"",c=e.config.baseUrl;return c&&0>b.indexOf(c)?c+b:b};e.authName="none";e.authModule={authName:"none",checkConnected:function(b){return b.success()},
connect:function(b){return b.success()},connectedUser:function(){return{id:"",caption:""}},disconnect:function(b){return b.success()}};e.STATUS={ORIGINAL:0,CREATED:1,MODIFIED:2,DELETED:3};e.TYPES={ENTITY:0,TEMPLATE:1,UNKNOWN:10};e.options={statefulServerPrtocol:!0};e.funcs={yearMonth:function(a){return b.helpers.date.str2dateym(a)},yearMONTH:function(a){return b.helpers.date.str2dateYM(a)},thisMonth:function(a){var c=b.helpers.date.isoToDate(a),a=c.getFullYear(),c=c.getMonth(),d=new Date(new Date(a,
c+2,1,0,0,0,0)-1/24/60/60/1E3);return"@"+(new Date(a,c+1,1,0,0,0,0)).toISOString()+"@ and @"+d.toISOString()+"@"},asString:function(b){return"'"+b.replace("'","''")+"'"}};var f=/^(.*)\(\'(.*)\'\)$/i;e.config={id:"",baseUrl:"",resources:{}};var d={groups:{$count:function(){},$sum:function(){}},funcs:{month:function(a){return b.helpers.date.isoToDate(a).getMonth()},year:function(a){return b.helpers.date.isoToDate(a).getFullYear()}},_parseQuery:function(b){var c={};b&&b.replace(/([^&=;]*)=?([^&;]*)/g,
function(b,a,d){a&&(c[a]=decodeURIComponent(d))});return c},_execSDATA:function(a,c){if(a.createActivity||a.editActivity)return d._startEditActivity(a,c);if(a.entity==b.proto.sdataKey.workingCopies)return d._loadDraft(a,c);d.makeURL(a);return e.sendSDataRequest(a,c)},makeURL:function(a){var c=[a.base,a.application,"/"+a.contract,"/"+a.dataset];c.push("/"+a.entity);a.id&&c.push("('"+a.id+"')");a.template&&c.push("/$template");a.createActivity&&c.push("/"+b.proto.sdataKey.workingCopies);a.editActivity&&
c.push("/"+b.proto.sdataKey.workingCopies);if(a.createActivity||a.editActivity)if(a.query=a.query||{},!a.query.trackingId)a.query.trackingId=b.helpers.uuid();if(a.query){var d=Object.keys(a.query);d&&d.forEach(function(d,e){e?c.push("&"):c.push("?");c.push(d+"="+b.helpers.encodeURIComponent(a.query[d]))})}a.uri=c.join("")},logSdata:function(a,c){b.helpers.log&&(console.log(a),console.log((c.method||"GET")+": "+c.uri))},_protoFromschema:function(b){var c={};b&&Object.keys(b.properties).forEach(function(e){var f=
b.properties[e];"string"==f.type?c[e]="":"integer"==f.type?c[e]=0:"decimal"==f.type?c[e]=0:"boolean"==f.type?c[e]=!1:"object"==f.type?c[e]=d._protoFromschema(f):"object"==typeof f.type&&f.type.$ref&&(c[e]=null)});return c},_loadDraft:function(b,c){e.loadDraft(b.id,function(b){if(!b)return c.success(null,{status:404});var a=b.data;a.$info={original_url:b.original_url};return c.success(a,{status:200})})},_startEditActivity:function(a,c){d.makeURL(a,!0);d.logSdata("Virtual operation: Start edit activity ",
a);var f=b.extend(f,a),h=b.extend(!0,{},a);delete h.query.trackingId;h.createActivity?delete h.createActivity:h.editActivity&&delete h.editActivity;d._execSDATA(h,{success:function(g,j){h.query={representation:h.query.representation};d.makeURL(h,!0);var m=h.uri;if(!g&&400<j.status&&h.template&&e.config&&e.config&&e.config.pages&&h.query&&e.config.pages[h.query.representation])g=b.proto.proto2Instance(e.config.pages[h.query.representation].$prototype),j.status=200;if(300<j.status)return 404==j.status&&
h.template&&b.helpers.pushException({message:b.helpers.format(b.smobile.locale().sdata.S404,[f.uri])},b.smobile.locale().actions.syncronize),c.success(null,j);if(!g.$key&&!g.$uuid)g.$uuid=b.helpers.uuid();var l=!1;if(h.template){var k=null;if(e.config&&e.config.pages&&h.query&&e.config.pages[h.query.representation])k=e.config.pages[h.query.representation].$prototype;l=!0;if(k){if(b.proto.useUuid(k))g.$uuid=b.helpers.uuid()}else g.$uuid=b.helpers.uuid()}g.$trackingId=a.query.trackingId;h.entity=b.proto.sdataKey.workingCopies;
h.template=!1;h.id=a.query.trackingId;d.makeURL(h);m={id:g.$trackingId,data:g,representation:h.query.representation,original_url:m};if(!l)m.original_data=b.extend(!0,{},g),delete m.original_data.$trackingId;e.createDraft(m,function(a){var d=b.extend(!0,{},a.data);d.$info={original_url:a.original_url};return c.success(d,{status:201,location:h.uri})})}})},_parseSE:function(b){var c={prefix:b,content:""};if((b=f.exec(b))&&3==b.length)c.prefix=b[1],c.content=b[2];return c},parseSDataURL:function(a){var c=
a.split("/sdata/"),e=null;if(2==c.length){e={base:c[0]+"/sdata/",query:{},sdata:"sdata",origUri:a};c=c[1].split("?");if(2==c.length)e.query=d._parseQuery(c[1]);c=c[0].split("/");if(3>c.length)return null;e.application=c[0];e.contract=c[1];e.dataset=c[2];if(4>c.length)return e;e.entity=c[3];a=d._parseSE(e.entity);e.entity=a.prefix;e.id=a.content;if(4<c.length)if(a=c[4],"$template"==a)e.template=!0;else if(a==b.proto.sdataKey.workingCopies&&e.id)e.editActivity=!0;if(5<c.length&&(a=c[5],e.template&&
a==b.proto.sdataKey.workingCopies))e.createActivity=!0}return e}};e.initFromSchema=function(b){return d._protoFromschema(b)};e._cleanHeaders=function(b){b&&(delete b.$httpMethod,delete b.$httpStatus,delete b.$httpMessage,delete b.$httpLocation)};e.loadAuth=function(a){if(e.authName==e.authModule.authName)return a();var c="js/auth/jquery.smobile.auth."+e.authName+".min.js";b.ajax({url:c,dataType:"script",success:function(){a()},error:function(d,e,f){b.helpers.pushAjaxError(d,e,f,c,"GET");a()}})};e.execBatch=
function(b,c,d){if(!b&&!d)return c.success();e.loadAuth(function(){e.authModule.checkConnected({success:function(){return e._execBatch(b,c,d)},fail:function(){e.authModule.connect({success:function(){return e._execBatch(b,c,d)},fail:function(){c.success&&c.success()}})}})})};e._execBatch=function(a,c,d){b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.sending});var f=function(b){d({$reinstall:!0},null,b.success)},g=function(a){if(!b.helpers.hasErrors()&&d)return f({success:function(){b.mobile.loading("hide");
if(a.success)return a.success()}});b.mobile.loading("hide");if(a.success)return a.success()};if(!a)return g(c);b.sdata.useCacheCount=!1;b.helpers.each(Object.keys(a),function(c,d,f){var k=e.config.baseUrl+"/"+c,g={$url:k+"/$batch",$resources:[]},i=[];a[c].forEach(function(a){var c;if(a.$info.status==b.sdata.STATUS.CREATED){debugger;i.push(a.$info);c=a;c.$httpMethod="POST";c.$url=k;delete c.$info}else if(a.$info.status==b.sdata.STATUS.MODIFIED)i.push(a.$info),c=a,c.$httpMethod="PUT",c.$httpifMatch=
c.$etag,delete c.$info;else if(a.$info.status==b.sdata.STATUS.DELETED){i.push(a.$info);c={$httpMethod:"DELETE"};c.$httpifMatch=a.$etag;c.$url=a.$info.url;var d=e.parseSdataUri(c.$url);if(a.$uuid)c.$uuid=a.$uuid;c.$key=d.id}c&&g.$resources.push(c)});g.$resources.length?b.ajax({headers:{Accept:"application/json"},type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:g.$url,data:JSON.stringify(g),success:function(a){a.$resources?b.helpers.each(a.$resources,function(a,c,d){var f=
g.$resources[c],c=i[c],t=c.url,k;if("PUT"==f.$httpMethod){if(200==a.$httpStatus)return e._cleanHeaders(a),b.sdata.updData(t,{data:a,representation:"",original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(400==a.$httpStatus)return e._cleanHeaders(a),k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.modify_before),e._cleanHeaders(f),b.sdata.updData(t,{$load:!0,data:a,representation:c.representation,status:b.sdata.STATUS.MODIFIED,
last_error:k.message},d);if(410==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.S410),e._cleanHeaders(a),b.sdata.delData(t,d);if(412==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.S412),e._cleanHeaders(a),b.sdata.updData(t,{data:a,representation:"",original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(500==a.$httpStatus)return k=
b.helpers.extractErrors(a,a.$httpMessage),b.sdata.updData(t,{$load:!0,last_error:k.message},d);if(503==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.S503),d()}else if("POST"==f.$httpMethod){if(201==a.$httpStatus){var h=a.$httpLocation;e._cleanHeaders(a);return b.sdata.delData(t,function(){console.log(h);e.store(h);d()})}if(202==a.$httpStatus)b.helpers.pushException({message:b.smobile.locale().post_ni});else{if(400==
a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.modify_before),b.sdata.updData(t,{$load:!0,last_error:k.message},d);if(403==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.SC_canceled),b.sdata.undoUpdate(t,d);if(404==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.sdata.updData(t,{$load:!0,last_error:k.message},
d);if(409==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.modify_before),b.sdata.updData(t,{$load:!0,last_error:k.message},d);if(503==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.S503),d();if(500==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.sdata.updData(t,{$load:!0,last_error:k.message},d)}}else if("DELETE"==
f.$httpMethod){if(200==a.$httpStatus||410==a.$httpStatus)return b.sdata.delData(t,d);if(400==a.$httpStatus)return e._cleanHeaders(a),k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.modify_before),k=b.helpers.extractErrors(a,a.$httpMessage),b.sdata.updData(t,{$load:!0,last_error:k.message},d);if(403==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.SD_canceled),
b.sdata.undoUpdate(t,d);if(412==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.SD412),e._cleanHeaders(a),b.sdata.updData(t,{data:a,representation:"",original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(500==a.$httpStatus)return e._cleanHeaders(a),k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.modify_before),k=b.helpers.extractErrors(a,
a.$httpMessage),b.sdata.updData(t,{$load:!0,last_error:k.message},d);if(503==a.$httpStatus)return k=b.helpers.extractErrors(a,a.$httpMessage),b.helpers.pushException({message:k.message},b.smobile.locale().sdata.S503),d()}d()},function(){f()}):f()},error:function(a,c,d){b.helpers.pushAjaxError(a,c,d,g.$url,"POST");f()}}):f()},function(){return g(c)})};e.createDraft=function(b,c){c(b)};e.saveDraft=function(b,c,d){d()};e.deleteDraft=function(b,c){c.success()};e.undoUpdate=function(b,c){c()};e.deleteDataByDraft=
function(b,c){c()};e.updateDraft=function(){};e.loadDraft=function(b,c){c(null)};e.initData=function(b,c,d){d.success()};e.updData=function(b,c,d){d(null)};e.getSyncData=function(b){b(null)};e.execWhere=function(){return!0};e.parseWhere=function(){return null};e.groupFunc=function(b){return!b?!1:null!=d.groups[b]};e._parseProp=function(b,c){var b=b.trim(),d={name:b,func:null};if(!c)return d;if(")"==b[b.length-1]){var e=b.indexOf("(");if(0<e)d.func=b.substr(0,e),d.name="$count"==d.func?"$count":b.substr(e+
1,b.length-e-2)}return d};e.getFunc=function(b){return d.funcs[b]};e.applyFunc=function(b,c){var d=e.getFunc(c);return d?d(b):b};e.addSelected=function(a,c,d,e){c.forEach(function(c){if(c.group)if(e){if("$count"==c.name)d.$count=1}else"$count"==c.name&&d.$count++;else if(e){var f=b.sdata.syncGetValue(a,c.name);c.func&&(f=b.sdata.applyFunc(f,c.func));var m=d;if(c.func)m[c.func+"("+c.name+")"]=f;else{for(var c=c.name.split("."),l=0,k=c.length-1;l<k;l++)m[c[l]]||(m[c[l]]={}),m=m[c[l]];m[c[c.length-1]]=
f}}})};e._reduceFields=function(b,c,d,f){b&&b.props&&b.props.forEach(function(b){if(b.props)f=b.func?b.func:f,e._reduceFields(b,b.name,d,f);else{var a=c?f:b.func;c?d.push({name:c+"."+b.name,func:a,group:e.groupFunc(a)}):d.push({name:b.name,func:a,group:e.groupFunc(a)})}});return d};e.parseField=function(b,c,d){var a;var f=b.split(".");if(1<f.length&&(a=(c=c?e.config.entities[c]:null)&&c.$schema?c.$schema.properties:null,c=a))b=f.shift(),c&&c[b]&&c[b].type&&c[b].type.$ref&&(b=e.parseSdataUri(c[b].type.$ref),
e.config.entities[b.entity]&&(d[b.entity]=!0,e.parseField(f.join("."),b.entity,d)))};e.parseFields=function(b,c,d,f,g){var j=d?e.config.entities[d]:null,j=j&&j.$schema?j.$schema.properties:null,m=b||{entity:d,props:[]};c.split(",").forEach(function(b){var a=!1,b=e._parseProp(b,g);if("*"==b.name)m.all=!0;else if(0<b.name.indexOf("/")){var b=b.name.split("/"),c=b[0],d;j&&j[c]&&j[c].type&&j[c].type.$ref&&(d=e.parseSdataUri(j[c].type.$ref),e.config.entities[d.entity]&&(a=!0));c={name:c,props:[]};if(a)f[d.entity]=
!0,c.entity=d.entity;m.props.push(c);b.shift();e.parseFields(c,b.join("/"),a?d.entity:"",f,!1,!1)}else m.props.push(b)});return e._reduceFields(m,"",[],null)};e.execSelected=function(b){return b};e.getSyncCount=function(b){e.useCacheCount?b.success(e.syncCount):e.getSyncDataCount(function(c){e.syncCount=c;e.useCacheCount=!0;b.success(c)})};e.getSyncDataCount=function(b){b(0)};e.getModifiedData=function(b,c){c(null)};e.translateURL=function(b){var c;if(e.urlmap){if(c=e.urlmap.key.indexOf(b),0<=c)return e.urlmap.value[c]}else e.hack_replace&&
(c=b.indexOf(e.hack_replace.src),0==c&&(b=e.hack_replace.dst+b.substring(e.hack_replace.src.length)));return b};e.post=function(a,c,d,f,g){b.helpers.log&&console.log("POST "+a);var j={Accept:"application/json;vnd.sage=syracuse"};f&&b.extend(j,f);var m=e.translateURL(a);b.ajax({headers:j,type:"POST",dataType:"json",data:JSON.stringify(c),url:m,contentType:"application/json; charset=utf-8",success:function(c){if(e.hack_replace&&a!=m)var f=RegExp(e.hack_replace.src.replace(/\//g,"/"),"g"),c=JSON.parse(JSON.stringify(c).replace(f,
e.hack_replace.dst));b.helpers.log&&(console.log("Response: "),console.log(c));d(c)},error:function(c,e,f){if(g&&g.ignoreErrors)return d(null);b.helpers.pushAjaxError(c,e,f,a,"POST");d(null)}})};e.GET=function(a,c,d,f){b.helpers.log&&console.log("GET "+a);var g={Accept:"application/json;vnd.sage=syracuse"};d&&b.extend(g,d);var j=e.translateURL(a);b.ajax({headers:g,type:"GET",dataType:"json",url:j,success:function(d,f,k){e.hack_replace&&a!=j&&(f=RegExp(e.hack_replace.src.replace(/\//g,"/"),"g"),d=
JSON.parse(JSON.stringify(d).replace(f,e.hack_replace.dst)));b.helpers.log&&(console.log("Response: "),console.log(d));k={status:k?k.status:200,location:k?k.getResponseHeader("Location"):""};c(d,k)},error:function(d,e,k){if(f&&f.ignoreErrors)return c(null);b.helpers.pushAjaxError(d,e,k,a,"GET");d={status:d?d.status:200,location:d?d.getResponseHeader("Location"):""};c(null,d)}})};e.applicationDetails=function(b,c){var d={baseURL:b.baseURL},f=e.parseSdataUri(b.baseURL);d.applicationName=f.application;
d.contractName=f.contract;d.endpointName=f.dataset;e.post(e.$url(b,b.url),d,function(b){c(b)})};e.syncGetValue=function(b,c){var d=c.split("."),f=!1,g=b;if(!b)return null;d.forEach(function(b){var a;if(!f){if((a=(g=g[b])?g.$key||g.$uuid:!1,b=a)&&e.loadCache&&e.loadCache[b])g=e.loadCache[b].data;f=null==g}});return g};e.applicationList=function(b){var c=e.sdataAdmin,d=e.parseSdataUri(c);e.GET(c,function(c){var f=[],j="";if(c&&c.$resources){if(c.$baseUrl)j=c.$baseUrl,delete c.$baseUrl;c.$resources.forEach(function(b){if(b&&
b.endpoints&&b.endpoints.length){var c={url:b.installUrl,title:b.title,description:b.description||b.title,icon:b.icon||"",baseURL:d.base+b.applicationName+"/"+b.contract+"/",datasets:b.endpoints};if(j&&0>c.url.indexOf(j))c.url=j+c.url;if(c.url&&"/"==c.url.charAt(0))c.url=e.sdataHost+c.url;delete b.endpoints;f.push(c)}})}b.success&&b.success(f)})};e.removeFromDB=function(b,c){c()};e.delData=function(b,c){c()};e.sendSDataRequest=function(a,c){d.logSdata("Real operation: Send SDATA request: ",a);var f=
{},h=c.success;if(e.store(a.uri)){if(!a.id&&!a.template&&a.query&&(a.query.selected||a.query._groupBy||a.query.where)){if(a.query.selected)a.pselected=e.parseFields(null,a.query.selected,a.entity,f,!0,!1);if(a.query._groupBy)a.pgroupBy=e.parseFields(null,a.query._groupBy,a.entity,f,!0,!0);if(a.query.where)a.pwhere=e.parseWhere(a.query.where,a.entity,f);f=Object.keys(f);if(f.length)c.$prefetch=c.$prefetch||[],c.$prefetch=c.$prefetch.concat(f)}}else return e.getModifiedData(a,function(d){if(a.id){if(d&&
d[a.id])return d[a.id].status===b.sdata.STATUS.DELETED?c.success(null,{status:404}):c.success(d[a.id].data,{status:200});e.execGetSData(a,c)}else if(!a.template&&d&&Object.keys(d).length){var f=!0,g=a.query&&a.query.representation?b.sdata.config.pages[a.query.representation]:null;if(g)g=g.$prototype.$properties.$resources.$item,g=g.$item||g,f=b.proto.useUuid(g);e.execGetSData(a,{success:function(a,e){if(a&&a.$resources)for(var i=a.$resources.length,h;i--;)if(h=a.$resources[i],h=f?h.$uuid||h.$key:
b.proto.parseExpression(g.$key,{data:b.proto.exprData(h),$prototype:g},"$key"),d[h])d[h].status===b.sdata.STATUS.DELETED?a.$resources.splice(i,1):a.$resources[i]=d[h].data;c.success(a,e)}})}else e.execGetSData(a,c)});var g=c.$prefetch&&!a.id&&!a.template&&!e.loadCache;g&&e.startLoad();c.success=function(c,a){g&&e.endLoad();b.helpers.log&&(console.log("Response: "),console.log(c));h&&h(c,a)};c.$prefetch&&!a.id?b.helpers.each(c.$prefetch,function(b,c,f){b=d.parseSDataURL(a.base+a.application+"/"+a.contract+
"/"+a.dataset+"/"+b);e.execGetSData(b,{success:function(b){b&&b.$resources&&b.$resources.forEach(function(b){e.loadCache[b.$key||b.$uuid]={data:b,headers:{status:200}}});return f()}})},function(){e.execGetSData(a,c)}):e.execGetSData(a,c)};e.execGetSData=function(a,c){var d=b.sdata.config.entities[a.entity]&&b.sdata.config.entities[a.entity].sync,f=!d&&b.sdata.offline&&b.sdata.config.entities[a.entity]&&b.sdata.config.entities[a.entity].cache;!d&&!f?e.GET(a.uri,c.success):e.getSData(a,c)};e.getSData=
function(b,c){c.success&&c.success("Not found",{status:404})};e.execURL=function(b,c){e.config&&e.config.baseUrl&&(b=e.$url({$baseURI:e.config.baseUrl},b));var f=d.parseSDataURL(b);f?d._execSDATA(f,c):c.success&&c.success("Not Implemented",{status:500})};e.parseSdataUri=function(b){return d.parseSDataURL(b)};e.getUri=function(b){d.makeURL(b);return b.uri};e.entityUri=function(b){var c=[b.base,b.application,"/"+b.contract,"/"+b.dataset];c.push("/"+b.entity);return c.join("")};e.getBaseUrl=function(b){return[b.base,
b.application,"/"+b.contract,"/"+b.dataset,"/"].join("")};e.entityMeta=function(b){return e.config.entities?e.config.entities[b]:null};e.getInstalledApps=function(b,c){c([])};e.startLoad=function(){};e.endLoad=function(){};e.getAppConfig=function(b,c){c(null)};e.installApp=function(b,c){c(null,!0)}})(jQuery);(function(b){var e=b.sdata||{};b.sdata=e;var f={identifier:"identifier",operator:"operator",literal:"literal"};e.tokenType=f;(function(d){function a(b,c,a,d,e,f,q){this.code=b;this.text=c;this.precedence=a;this.isPrefix=d;this.isInfix=e;this.isAssociative=f;this.isPredicate=q}function c(){this.operators={};this.init()}function e(b,c,a,d,f){this.type=b;this.value=f;this.getRemainingText=function(){return c.substring(a,c.length)}}function h(b){this.children=null;if(b.operator)this.type="operator",this.value=
b.operator,this.children=[],b.expression1&&this.children.push(b.expression1),b.expression2&&this.children.push(b.expression2);else if(b.expressionType&&(this.type=b.expressionType,this.value=b.value,this.svalue=b.svalue,this.dataType=b.dataType,"function"===this.type))this.children=[]}function g(c,a){if("identifier"==a.type)a.property=b.sdata.syncGetValue(c,a.value);else if("literal"==a.type)a.property="datetime"==a.dataType?a.svalue:a.value;else if(a.children)if("operator"==a.type)switch(a.value.code){case "and":a.children.forEach(function(b){g(c,
b)});a.property=a.children[0].property&&a.children[1].property;break;case "or":a.children.forEach(function(b){g(c,b)});a.property=a.children[0].property||a.children[1].property;break;case "between":a.children.forEach(function(b){g(c,b)});a.property=a.children[0].property>=a.children[1].property&&a.children[0].property<=a.children[2].property;break;case "=":a.children.forEach(function(b){g(c,b)});a.property=a.children[0].property==a.children[1].property;break;case ".":g(c,a.children[0]);g(a.children[0].property,
a.children[1]);a.property=a.children[1].property;break;default:a.property=null,a.children.forEach(function(b){g(c,b);if("literal"==b.type)b.property=null})}else if("function"==a.type){var d=[];a.children&&a.children.forEach(function(b){g(c,b);d.push(b.property)});var e=b.sdata.getFunc(a.value);if(e)a.property=e.apply(b.sdata,d)}}b.helpers.extend(a.prototype,{toString:function(){return this.text}});b.helpers.extend(c.prototype,{_createOp:function(b,c,d,e,f,g,q){b=new a(b||c,c,d,e,f,g,q);this.operators[b.text]=
b},init:function(){this._createOp(null,".",1,!1,!0,!0,!1);this._createOp(null,"not",2,!0,!1,!1,!1);this._createOp("*","mul",3,!1,!0,!0,!1);this._createOp("/","div",3,!1,!0,!0,!1);this._createOp("%","mod",3,!1,!0,!0,!1);this._createOp(null,"+",4,!1,!0,!0,!1);this._createOp(null,"-",4,!0,!0,!0,!1);this._createOp("=","eq",5,!1,!0,!1,!0);this._createOp("<>","ne",5,!1,!0,!1,!0);this._createOp("<","lt",5,!1,!0,!1,!0);this._createOp("<=","le",5,!1,!0,!1,!0);this._createOp(">","gt",5,!1,!0,!1,!0);this._createOp(">=",
"ge",5,!1,!0,!1,!0);this._createOp(null,"between",5,!1,!0,!1,!0);this._createOp(null,"in",5,!1,!0,!1,!0);this._createOp(null,"like",5,!1,!0,!1,!0);this._createOp(null,"and",6,!1,!0,!0,!0);this._createOp(null,"or",7,!1,!0,!0,!0);this._createOp(null,"(",8,!0,!1,!1,!1);this._createOp(null,")",8,!1,!1,!1,!1);this._createOp(null,",",8,!1,!1,!1,!1)}});var j=new c;b.helpers.extend(e.prototype,{matches:function(b){return this.value instanceof a&&this.value.code==b}});var m=new function(){this.tokenize=function(b){for(var c=
[],a=0;a<b.length;){for(;a<b.length&&" "===b[a];)a++;var d=b[a];switch(d){case "@":for(var g=d=b,h=a,a=c,q=h+1,s=g.length;q<s&&!("@"==g[q]);)q++;if(q===g.length)throw Error("date constant not terminated:"+d.substring(h,d.length));g=g.substr(h+1,q-h-1);s=new Date(g);if(null!=s)d=new e(f.literal,d,h,q+1-h,s),d.dataType="datetime",d.svalue=g,a.push(d);a=q+1;break;case '"':case "'":a:{for(var q=d=b,g=a,a=c,s=q[g],h=g+1,t="";h<q.length;){if(q[h]===s&&(h++,h===q.length||q[h]!==s)){d=new e(f.literal,d,g,
h-g,t);d.dataType="string";a.push(d);a=h;break a}t+=q[h++]}throw Error("quoted string not terminated: "+d.substring(g));}break;case "-":case "+":case "(":case ")":case ",":c.push(new e(f.operator,b,a,1,j.operators[d]));a+=1;break;default:if(/[a-zA-Z%']/.test(d)){g=d=b;q=c;h=a+1;for(s=void 0;h<g.length&&/[a-zA-Z0-9_%.%']/.test(g[h]);)h++;g=g.substr(a,h-a);s=j.operators[g.toLowerCase()];null!=s?q.push(new e(f.operator,d,a,h-a,s)):("true"===g||"false"===g||"null"===g?(s=new e(f.literal,d,a,h-a,g),s.dataType=
"bool"):(s=new e(f.identifier,d,a,h-a,g),s.dataType="word"),q.push(s));a=h}else if(/[0-9]/.test(d)){q=d=b;h=c;g=a+1;for(s=t=void 0;g<q.length&&/[0-9]/.test(q[g]);)g++;t=void 0;if(g<q.length&&"."===q[g]){for(g++;g<q.length&&/[0-9]/.test(q[g]);)g++;t=parseFloat(d.substring(a,g));s="float"}else t=parseInt(d.substring(a,g),10),s="int";t=new e(f.literal,d,a,g-a,t);t.dataType=s;h.push(t);a=g}else throw Error("invalid character: "+b.substring(a));}}return c};return this};b.helpers.extend(h.prototype,{isPredicate:function(){switch(this.type){case "operator":return this.value.isPredicate;
case "identifier":return!0;case "function":return!0;case "literal":return!1;default:throw Error("invalid expression type: "+this.type);}},toString:function(){if(null==this.children)return this.value.toString();var b=[];b.push("["+this.value.toString());for(var a=0;a<this.children.length;a++)b.push(" "+this.children[a].toString());b.push("]");return b.join("")}});var l=new function(){function c(b,e,g){var q;a:{if(e[0]==b.length)throw Error("premature end of expression");q=b[e[0]];switch(q.type){case f.identifier:e[0]++;
if(e[0]<b.length&&b[e[0]].matches("(")){e[0]++;var s=new h({expressionType:"function",value:q.value});d(b,q,e,s.children);q=s}else q=new h({expressionType:"identifier",value:q.value});break a;case f.literal:e[0]++;q=new h({expressionType:"literal",value:q.value,svalue:q.svalue,dataType:q.dataType});break a;case f.operator:s=q.value;if(!s.isPrefix)throw Error("invalid expression: expected beginning of term at "+q.getRemainingText());e[0]++;b:switch(s.code){case "-":case "not":q=c(b,e,1);q=new h({operator:s,
expression1:q});break b;case "(":q=c(b,e,s.precedence);if(e[0]==b.length||!b[e[0]].matches(")"))throw Error("invalid expression: expected ')' after "+b[e[0]-1].getRemainingText());e[0]++;break b;default:throw Error("internal error: bad prefix operator "+s.code);}break a;default:throw Error("internal error: bad token type "+q.type);}}for(;e[0]<b.length;){var t=b[e[0]],s=t.value instanceof a?t.value:null;if(null==s||!s.isInfix||s.precedence>g)break;e[0]++;if("in"==s.code){if(e[0]===b.length||!b[e[0]].matches("("))throw Error("invalid expression: '(' expected after "+
t.getRemainingText());e[0]++;q=new h({operator:s,expression1:q});d(b,t,e,q.children)}else if(t=c(b,e,s.precedence-1),q=new h({operator:s,expression1:q,expression2:t}),"between"==s.code){var i=b,n=e,t=q,j=s.precedence;if(n[0]==i.length||!i[n[0]].matches("and"))throw Error("invalid expression: expected 'and' after "+i[n[0]-1].getRemainingText());n[0]++;i=c(i,n,j);t.children.push(i)}if(!s.isAssociative&&s.precedence==g)break}return q}function d(b,a,f,q){if(f[0]<b.length&&b[f[0]].matches(")"))f[0]++;
else{for(;f[0]<b.length;){var s=c(b,f,e);q.push(s);if(f[0]<b.length&&b[f[0]].matches(")")){f[0]++;return}if(f[0]==b.length||!b[f[0]].matches(","))throw Error("invalid expression: expected ',' or ')' at "+b[f[0]].getRemainingText());f[0]++}throw Error("invalid function call syntax: argument missing after "+a.getRemainingText());}}var e=8;this.parse=function(a,d,g){if(null==a||0==a.length)return null;a=m.tokenize(a);a.forEach(function(a){a.type==f.identifier&&0<a.value.indexOf(".")&&b.sdata.parseField(a.value,
d,g)});var q=[0],s=c(a,q,e);if(q[0]!=a.length)throw Error("invalid expression: unexpected token at "+a[q[0]].getRemainingText());return s};return this};d.parseWhere=function(b,a,c){return l.parse(b,a,c)};d.execWhere=function(b,a){if(null==a)return!0;g(b,a);return a.property}})(e)})(jQuery);(function(b){function e(){this.init()}function f(){this.init()}b.sdatadb=b.sdatadb||{};var d=function(b,a){return!b?(a(null,!0),!1):!0},a=function(a,c){var d=b.sdata.config.pages[a].$prototype;if(!d)return c.$uuid||"";return b.proto.useUuid(d)?(c.$uuid=c.$uuid||b.helpers.uuid(),c.$uuid):b.proto.parseExpression(d.$key,{data:b.proto.exprData(c),$prototype:d},"$key")};if("webkitIndexedDB"in window)window.indexedDB=window.webkitIndexedDB,window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=
window.webkitIDBKeyRange,window.IDBDatabaseException=window.webkitIDBDatabaseException;var c=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;if(c&&!window.IDBTransaction.READ_WRITE)window.IDBTransaction.READ_ONLY="readonly",window.IDBTransaction.READ_WRITE="readwrite";var i={migration:{columns:{version:{def:"version text"}}},draft:{columns:{id:{def:"id TEXT  PRIMARY KEY"},appid:{def:"appid TEXT"},original_url:{def:"original_url TEXT"},representation:{def:"representation TEXT"},data:{def:"data TEXT"},
original_data:{def:"original_data TEXT"}}},sdata:{columns:{appid:{def:"appid TEXT"},url:{def:"url TEXT PRIMARY KEY"},entity_url:{def:"entity_url TEXT"},data:{def:"data TEXT"},original_data:{def:"original_data TEXT"},status:{def:"status integer"},representation:{def:"representation TEXT"},updated:{def:"updated TEXT"},last_error:{def:"last_error TEXT"}}},apps:{columns:{id:{def:"id TEXT PRIMARY KEY"},url:{def:"url TEXT"},title:{def:"title TEXT"},description:{def:"description TEXT"},icon:{def:"icon TEXT"},
baseURL:{def:"baseURL TEXT"},version:{def:"version TEXT"},data:{def:"data TEXT"}}}},h=function(b){var a=["CREATE TABLE IF NOT EXISTS"];a.push(b);a.push("(");var c=i[b].columns;Object.keys(c).forEach(function(b,d){a.push((d?",":"")+c[b].def)});a.push(")");return a.join(" ")},g=function(a,c){var d=b.helpers.sdataSort(a.query);d&&b.helpers.applySDataSort(d,c)},j=function(a,c){return c.$modified?a.status!=b.sdata.STATUS.ORIGINAL:a.status>=b.sdata.STATUS.DELETED?!1:!0},m=function(b,a){if(a)a.$info={status:b.status,
last_error:b.last_error};return a},l=function(a,c,d,e,f,g,k){if(c){if(!b.sdata.execWhere(c,e.pwhere))return k();if(e.pgroupBy){var h="",i="",a=!1;e.pgroupBy.forEach(function(a){var d=b.sdata.syncGetValue(c,a.name);a.func&&(d=b.sdata.applyFunc(d,a.func));h=h+i+d;i="#"});d=f.indexOf(h);0>d&&(a=!0,f.push(h),d=f.length-1,g[d+""]={});b.sdata.addSelected(c,e.pselected,g[d+""],a)}else c.$info={status:a.status,last_error:a.last_error},d.push(c)}k()},k=function(a){a.appid=b.sdata.config.id;var c=b.sdata.parseSdataUri(a.url);
if(0>a.url.indexOf("?appid="))a.url=a.url+"?appid="+b.sdata.config.id;delete c.id;delete c.query;a.entity_url=b.sdata.getUri(c);a.data&&(delete a.data.$info,delete a.data.$trackingId);a.status=a.status||b.sdata.STATUS.ORIGINAL;a.updated=a.data?a.data.$updated||a.data.$updDate||(new Date).toISOString():(new Date).toISOString();a.last_error=a.last_error||"";a.representation=a.representation||""},o=function(a,c,d,e){m(c,d);delete a.query;d.$info.representation=c.representation;d.$info.url=b.sdata.getUri(a);
d.$info.title=b.proto.parseExpression(e.$value,{data:b.proto.exprData(d),$prototype:e},"$value");return d},n={version:1,_createObjectStore:function(b){b.objectStoreNames.contains("draft")&&b.deleteObjectStore("draft");b.objectStoreNames.contains("sdata")&&b.deleteObjectStore("sdata");b.objectStoreNames.contains("apps")&&b.deleteObjectStore("apps");var a=b.createObjectStore("draft",{keyPath:"id"});a.createIndex("appid","appid",{unique:!1});a.createIndex("original_url","original_url",{unique:!1});a=
b.createObjectStore("sdata",{keyPath:"url"});a.createIndex("appid","appid",{unique:!1});a.createIndex("entity_url","entity_url",{unique:!1});a.createIndex("status","status",{unique:!1});a=b.createObjectStore("apps",{keyPath:"id"});a.createIndex("url","url",{unique:!1})},_openDB:function(a){var d=!1;try{var e=c.open("sage-mge-test",n.version)}catch(f){b.helpers.pushException(f,b.smobile.locale().ui.no_db_support_sol);d||a(null,f);return}try{e.onupgradeneeded=function(b){d=!0;n._createObjectStore(b.target.result||
b.target.source)}}catch(g){}e.onsuccess=function(c){var e=c.target.result||c.target.source;!e.setVersion&&n.version!=e.version?(c=e.setVersion(n.version),c.onsuccess=function(){n._createObjectStore(e);d||a(e,void 0)},c.onerror=function(c){b.helpers.pushdbError(c);d||a(null,c)}):d||a(e,void 0)};e.onerror=function(c){b.helpers.pushdbError(c);d||a(null,c)}},_getSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c=c.get(a);c.onerror=function(b){d(null,b)};c.onsuccess=
function(b){d(b.target.result)}},_rmvSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c=c["delete"](a);c.onerror=function(b){d(null,b)};c.onsuccess=function(){d(null)}},_insertSdata:function(b,a,c){k(b);b=a.add(b);b.onerror=function(b){c(null,b)};b.onsuccess=function(){c(null)}},_updSDataByUrl:function(b,a,c,d){k(a);b=c.put(a);b.onerror=function(b){d(null,b)};b.onsuccess=function(){d(null)}},_saveDraft:function(c,e,f,g){if(d(c,g)){var k=c.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(e);
k.onsuccess=function(d){if(d.target.result){var d=d.target.result,k=b.sdata.parseSdataUri(d.original_url),h=c.transaction(["sdata","draft"],IDBTransaction.READ_WRITE),i=!1;if(k.template){i=!0;k.template=!1;debugger;k.id=a(k.query.representation,d.data)}k.createActivity=!1;k.editActivity=!1;delete k.query;var k=b.sdata.getUri(k),o={url:k,representation:d.representation,data:f,original_data:d.original_data};delete d.original_data;var j=h.objectStore("sdata");n._getSDataByUrl(k,j,function(a){if(a){if(a.status===
b.sdata.STATUS.DELETED)return n._deleteDraft(c,h,e,function(){g({status:404})});if(a.status===b.sdata.STATUS.ORIGINAL||a.status===b.sdata.STATUS.MODIFIED){if(a.status===b.sdata.STATUS.ORIGINAL)o.original_data=b.extend(!0,{},a.data),o.status=b.sdata.STATUS.MODIFIED;else if(a.status===b.sdata.STATUS.MODIFIED)o.original_data=b.extend(!0,{},a.original_data),o.status=b.sdata.STATUS.MODIFIED;delete o.data.$info;delete o.data.$trackingId;if(o.original_data&&(delete o.original_data.$info,delete o.original_data.$trackingId,
JSON.stringify(o.original_data)===JSON.stringify(o.data)&&(delete o.original_data,o.status=b.sdata.STATUS.ORIGINAL,!b.sdata.store(o.url))))return n._rmvSDataByUrl(o.url,j,function(){n._deleteDraft(c,h,e,function(){g({status:200})})})}else o.status=b.sdata.STATUS.CREATED;return n._updSDataByUrl(o.url,o,j,function(){n._deleteDraft(c,h,e,function(){g({status:200})})})}i?(o.status=b.sdata.STATUS.CREATED,delete o.original_data):o.status=b.sdata.STATUS.MODIFIED;delete o.data.$info;delete o.data.$trackingId;
if(o.original_data&&(delete o.original_data.$info,delete o.original_data.$trackingId,JSON.stringify(o.original_data)===JSON.stringify(o.data)))return delete o.original_data,o.status=b.sdata.STATUS.ORIGINAL,n._deleteDraft(c,h,e,function(){g({status:404})});n._insertSdata(o,j,function(){n._deleteDraft(c,h,e,function(){g({status:200})})})})}else g({status:404})};k.onerror=function(a){b.helpers.pushdbError(a);g({status:404},a)}}},_deleteDataByDraft:function(b,a,c){if(d(b,c)){var e=b.transaction(["draft",
"sdata"],IDBTransaction.READ_WRITE);try{var f=e.objectStore("draft").get(a);f.onsuccess=function(d){if(d.target.result){var d=d.target.result,f=d.original_url,g=e.objectStore("sdata");n._markSdataSeleted(f,g,d.original_data?d.original_data:d.data,function(){return n._deleteDraft(b,e,a,function(){c(null)})})}else c(null)};f.onerror=function(){c(null)}}catch(g){console.log(g)}}},_markSdataSeleted:function(c,d,e,f){var c=b.sdata.parseSdataUri(c),g=!1,k=c.query?c.query.representation:"";if(c.template)g=
!0,c.template=!1,c.id=a(c.query.representation,e);delete c.query;c.createActivity=!1;c.editActivity=!1;var h=b.sdata.getUri(c);n._getSDataByUrl(h,d,function(a){if(a){if(a.status===b.sdata.STATUS.DELETED)return f(null);if(a.status===b.sdata.STATUS.MODIFIED)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:b.sdata.STATUS.DELETED,representation:a.representation},n._updSDataByUrl(a.url,a,d,function(){return f(null)});if(a.status===b.sdata.STATUS.CREATED)return n._rmvSDataByUrl(h,
d,function(){return f(null)})}else{if(g)return f(null);n._insertSdata({url:h,data:e,original_data:null,status:b.sdata.STATUS.DELETED,representation:k},d,function(){return f(null)})}})},_deleteDraft:function(a,c,e,f){if(d(a,f)){c=c||a.transaction(["draft"],IDBTransaction.READ_WRITE);try{var g=c.objectStore("draft")["delete"](e);g.onsuccess=function(){f(null)};g.onerror=function(a){b.helpers.pushdbError(a);f(null,a)}}catch(k){b.helpers.pushdbError(k),f(null,k)}}},_uninstallDraft:function(b,a,c,d){try{var e=
b.index("appid"),f=IDBKeyRange.only(c),g=e.openCursor(f);g.onsuccess=function(b){b.target.result?(b=b.target.result,b["delete"](),b["continue"]()):n._uninstallSdata(a,c,d)};g.onerror=function(){n._uninstallSdata(a,c,d)}}catch(k){console.log(k)}},_uninstallSdata:function(b,a,c){b=b.index("appid");a=IDBKeyRange.only(a);try{var d=b.openCursor(a);d.onsuccess=function(b){b.target.result?(b=b.target.result,b["delete"](),b["continue"]()):c()};d.onerror=function(){c()}}catch(e){console.log(e)}},_updateDraft:function(b,
a,c,e){if(d(b,e))try{var f=b.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(a);f.onsuccess=function(d){if(d.target.result){var f=d.target.result;f.data=c;n._deleteDraft(b,null,a,function(a,c){if(c)return e(null,d);var g=b.transaction(["draft"],IDBTransaction.READ_WRITE).objectStore("draft").add(f);g.onsuccess=function(){e(null)};g.onerror=function(b){e(null,b)}})}else e(null)};f.oerror=function(b){e(null,b)}}catch(g){console.log(g)}},_insertDraft:function(a,c,e,f){if(d(a,
f))a=c.objectStore("draft").add(e),a.onsuccess=function(){f(e)},a.onerror=function(a){b.helpers.pushdbError(a);f(null,a)}},_getSData:function(a,c,e){if(d(a,e.success)){var f,a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata");try{if(c.id||c.template)f=a.get(c.uri),f.onsuccess=function(b){b.target.result&&j(b.target.result,e)?e.success(m(b.target.result,b.target.result.data),{status:200}):e.success(null,{status:404})},f.onerror=function(){e.success(null,{status:404})};else if(c.entity){var k=
{$url:c.uri,$resources:[]},h={query:null},i=[],o={};b.extend(h,c);delete h.query;var n=b.sdata.getUri(h),p=a.index("entity_url"),r=IDBKeyRange.only(n);f=p.openCursor(r);f.onsuccess=function(b){var a=b.target.result;if(a)j(a.value,e)&&l(a.value,a.value.data,k.$resources,c,i,o,function(){a["continue"]()});else{if(c.pgroupBy)for(var d in o)k.$resources.push(o[d]);g(c,k.$resources,e);e.success(k,{status:200})}};f.onerror=function(b){b.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?e.success(k,{status:200}):
e.success("",{status:500})}}}catch(u){console.log(u)}}},_getModifiedData:function(a,c,e){if(d(a,e)){var a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),f=b.sdata.config?b.sdata.config.id:"",g=b.sdata.entityUri(c),c=IDBKeyRange.lowerBound(b.sdata.STATUS.ORIGINAL,!0),c=a.openCursor(c),k={};c.onsuccess=function(a){if(a=a.target.result){if(a.value.appid===f&&a.value.entity_url===g){var c=a.value.data,d=b.sdata.parseSdataUri(a.value.url);k[d.id]={data:c,status:a.value.status}}a["continue"]()}else e(k)};
c.onerror=function(){e(k)}}},_getSyncData:function(a,c,e){if(d(a,e)){var a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),f=b.sdata.config?b.sdata.config.id:"",g=IDBKeyRange.lowerBound(b.sdata.STATUS.ORIGINAL,!0);if(c){var c=a.openCursor(g),k=0;c.onsuccess=function(b){(b=b.target.result)?(b.value.appid===f&&k++,b["continue"]()):e(k)};c.onerror=function(){e(0)}}else{var h=null,c=a.openCursor(g);c.onsuccess=function(a){if(a=a.target.result){if(a.value.appid===
f){var c=b.sdata.parseSdataUri(a.value.url);h=h||{};var d=h[c.entity]||[];h[c.entity]=d;var q=a.value.data;o(c,a.value,q,b.sdata.config.pages[a.value.representation].$prototype);d.push(q)}a["continue"]()}else e(h)};c.onerror=function(){e(null)}}}},_undoUpdate:function(a,c,e){if(d(a,e)){a=a.transaction(["sdata"],IDBTransaction.READ_WRITE);try{var f=a.objectStore("sdata");n._getSDataByUrl(c,f,function(a){if(a){if(!b.sdata.store(c)||a.status===b.sdata.STATUS.CREATED)return n._rmvSDataByUrl(c,f,function(){e(null)});
a={appid:a.appid,url:a.url,data:a.original_data?JSON.parse(a.original_data):JSON.parse(a.data),original_data:null,status:b.sdata.STATUS.ORIGINAL,representation:a.representation};return n._updSDataByUrl(c,a,f,function(){e(null)})}e(null)})}catch(g){console.log(g)}}},_installApp:function(a,c,e){if(d(a,e)){var f=a.transaction(["apps"],IDBTransaction.READ_WRITE).objectStore("apps"),a=f.index("url"),g=IDBKeyRange.only(c.url),a=a.openCursor(g),k=function(){var a=f.add(c);a.onerror=function(a){b.helpers.pushdbError(a);
e()};a.onsuccess=function(){e()}};a.onsuccess=function(b){if(b=b.target.result){if(b.value.baseURL==c.baseURL)b["delete"]();b["continue"]()}else k()};a.onerror=function(a){a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?k():(b.helpers.pushdbError(a),e())}}},_removeFromDB:function(a,c,e){if(d(a,e)){var f=a.transaction(["apps","draft","sdata"],IDBTransaction.READ_WRITE),a=f.objectStore("sdata"),g=f.objectStore("draft");n._uninstallDraft(g,a,c,function(){var a=f.objectStore("apps")["delete"](c);
a.onsuccess=function(){e()};a.onerror=function(a){if(a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR)return e();b.helpers.pushdbError(a);e()}})}},_getAppConfig:function(a,c,e){if(d(a,e))a=a.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").get(c),a.onsuccess=function(a){if(a=a.target.result){a.data.id=a.id;var c=b.extend(!0,{},a.data);c.$info={url:a.url,version:a.version,title:a.title,icon:a.icon};e(c)}else e(null)},a.onerror=function(a){b.helpers.pushdbError(a);e(null,a)}},
_getInstalledApps:function(a,c,e){if(d(a,e)){var a=a.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").index("url").openCursor(),f=[];a.onsuccess=function(b){if(b=b.target.result){var a=b.value;f.push({id:a.id,url:a.url,title:a.title,description:a.description,icon:a.icon,baseURL:a.baseURL,version:a.version});b["continue"]()}else e(f)};a.onerror=function(a){a.target.errorCode!=IDBDatabaseException.NOT_FOUND_ERR&&b.helpers.pushdbError(a);e(f)}}},_delData:function(b,a,c){d(b,c)&&(b=
b.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata"),n._rmvSDataByUrl(a,b,c))},_updData:function(a,c,e,f){if(d(a,f)){var g=a.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata");e.url=c;var k=function(){return e.status===b.sdata.STATUS.ORIGINAL&&!b.sdata.store(c)?n._rmvSDataByUrl(c,g,function(b,a){f(null,a)}):n._updSDataByUrl(c,e,g,function(b,a){f(null,a)})};e.$load?(delete e.$load,n._getSDataByUrl(e.url,g,function(b){Object.keys(e).forEach(function(a){b[a]=e[a]});
e=b;k()})):k()}},_initData:function(a,c,e,f){if(d(a,f.success)){var g=a.transaction(["sdata"],IDBTransaction.READ_WRITE);g.oncomplete=function(){};g.onabort=function(){};var k=!1,h=g.objectStore("sdata");if(e)return n._initData_one(a,c,e,g,h,f);b.helpers.each(c,function(c,d,e){if(k)return e();if(f.setConfig)b.sdata.config={baseURL:c.$baseURI};return n._initData_one(a,c.value,c.data,g,h,{success:e,fail:function(){k=!0;return e()}})},function(){f.success&&f.success()})}},_initData_one:function(a,c,
d,e,f,g){var k={success:function(){if(d){if(c.onlyOne)return n._addSdata(a,e,{data:d,url:c.url},f,{success:function(){g.success&&g.success()}});if(d.$resources){var k=d.$baseUrl;return b.helpers.each(d.$resources,function(c,d,g){c={data:c,url:b.sdata.$purl(c.$url)};if(k)c.$baseURI=k;return n._addSdata(a,e,c,f,{success:function(){g()}})},function(){g.success(a)},10)}}g.success&&g.success()}},h;if(c.onlyOne)h=IDBKeyRange.only(c.url),h=f.openCursor(h);else{var i=f.index("entity_url");h=IDBKeyRange.only(c.url);
h=i.openCursor(h)}h.onsuccess=function(b){(b=b.target.result)?(b["delete"](),b["continue"]()):k.success()};h.onerror=function(){k.success()}},_loadDraft:function(a,c,e){if(d(a,e))try{var f=a.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(c);f.onsuccess=function(b){b.target.result?e(b.target.result):e(null)};f.onerror=function(a){b.helpers.pushdbError(a);e(null)}}catch(g){b.helpers.pushdbError(g),e(null,g)}},_createDraft:function(a,c,e){if(d(a,e)){c.appid=b.sdata.config.id;
var f=a.transaction(["draft"],IDBTransaction.READ_WRITE),g=f.objectStore("draft").index("original_url"),k=IDBKeyRange.only(c.original_url);try{var h=g.openCursor(k);h.onsuccess=function(b){if(b.target.result){b=b.target.result;if(b.value.appid===c.appid)b["delete"]();b["continue"]()}else n._insertDraft(a,f,c,e)};h.onerror=function(b){b.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR&&n._insertDraft(a,null,c,e)}}catch(i){return b.helpers.pushdbError(i),e(null,i)}}}},p={_addSdata:function(b,a,
c,e){d(b,e.success)&&(k(c),a.executeSql("INSERT INTO sdata(url, entity_url, data, original_data, sync_status, url_type, status, ui_url, ui_type, updated, last_error) values(?,?,?,?,?,?,?,?,?,?,?)",[c.url,c.entity_url,JSON.stringify(c.data),JSON.stringify(c.original_data),c.sync_status,c.url_type,c.status,c.ui_url,c.ui_type,c.updated,c.last_error],function(){e.success()},function(){e.success()}))},_delSdata:function(b,a,c,e){d(b,e.success)&&a.executeSql("delete from sdata where url= ?",[c],function(){e.success()},
function(){e.success()})},_getSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c.executeSql("SELECT * FROM sdata where url=?",[a],function(b,a){var c=a.rows;c&&c.length?(c=c.item(0),d({appid:c.appid,url:c.url,entity_url:c.entity_url,data:c.data?JSON.parse(c.data):null,original_data:c.original_data?JSON.parse(c.original_data):null,status:c.status,representation:c.representation,updated:c.updated,last_error:c.last_error})):d(null)},function(b,a){d(null,a)})},_rmvSDataByUrl:function(a,
c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c.executeSql("DELETE FROM sdata where url=?",[a],function(){d(null)},function(b,a){d(null,a)})},_insertSdata:function(b,a,c){k(b);a.executeSql("INSERT INTO sdata(appid, url, entity_url, data, original_data,status, representation, updated, last_error) values(?,?,?,?,?,?,?,?,?)",[b.appid,b.url,b.entity_url,b.data?JSON.stringify(b.data):"",b.original_data?JSON.stringify(b.original_data):"",b.status,b.representation,b.updated,b.last_error],
function(){c(null)},function(b,a){c(null,a)})},_updSDataByUrl:function(b,a,c,d){k(a);c.executeSql("Update sdata set appid=?, url=?, entity_url=?, data=?, original_data=? ,status=?, representation=?, updated=?, last_error=? where url=?",[a.appid,a.url,a.entity_url,a.data?JSON.stringify(a.data):"",a.original_data?JSON.stringify(a.original_data):"",a.status,a.representation,a.updated,a.last_error,a.url],function(){d(null)},function(b,a){d(null,a)})},_saveDraft:function(c,e,f,g){d(c,g)&&p._execOpen(c,
"SELECT * FROM draft where id=?",[e],function(d,k){if(k)return b.helpers.pushdbError(k),g({status:404});if(d&&d.length){var h=d.item(0),i=h.original_url,o=h.representation,n=h.data?JSON.parse(h.data):null,j=h.original_data?JSON.parse(h.original_data):null,l=b.sdata.parseSdataUri(i);c.transaction(function(d){var k=!1;if(l.template)k=!0,l.template=!1,l.id=a(l.query.representation,n);l.createActivity=!1;l.editActivity=!1;delete l.query;var h=b.sdata.getUri(l),i={url:h,representation:o,data:f,original_data:j};
delete j;p._getSDataByUrl(h,d,function(a){if(a){if(a.status===b.sdata.STATUS.DELETED)return p._deleteDraft(c,d,e,function(){g({status:404})});if(a.status===b.sdata.STATUS.ORIGINAL||a.status===b.sdata.STATUS.MODIFIED){if(a.status===b.sdata.STATUS.ORIGINAL)i.original_data=b.extend(!0,{},a.data),i.status=b.sdata.STATUS.MODIFIED;else if(a.status===b.sdata.STATUS.MODIFIED)i.original_data=b.extend(!0,{},a.original_data),i.status=b.sdata.STATUS.MODIFIED;delete i.data.$info;delete i.data.$trackingId;if(i.original_data&&
(delete i.original_data.$info,delete i.original_data.$trackingId,JSON.stringify(i.original_data)===JSON.stringify(i.data)&&(delete i.original_data,i.status=b.sdata.STATUS.ORIGINAL,!b.sdata.store(i.url))))return p._rmvSDataByUrl(i.url,d,function(){p._deleteDraft(c,d,e,function(){g({status:200})})})}else i.status=b.sdata.STATUS.CREATED;return p._updSDataByUrl(i.url,i,d,function(){p._deleteDraft(c,d,e,function(){g({status:200})})})}k?(i.status=b.sdata.STATUS.CREATED,delete i.original_data):i.status=
b.sdata.STATUS.MODIFIED;delete i.data.$info;delete i.data.$trackingId;if(i.original_data&&(delete i.original_data.$info,delete i.original_data.$trackingId,JSON.stringify(i.original_data)===JSON.stringify(i.data)))return delete i.original_data,i.status=b.sdata.STATUS.ORIGINAL,p._deleteDraft(c,d,e,function(){g({status:404})});p._insertSdata(i,d,function(){p._deleteDraft(c,d,e,function(){g({status:200})})})})},function(a,c){b.helpers.pushdbError(c);return g(null,c)})}else g({status:404})})},_droptables:function(a,
c,e){if(d(a,e)){var f=function(c){b.helpers.each(["draft","sdata","apps"],function(b,a,d){c.executeSql("drop table if exists "+b,[],function(){d()},function(b,a){console.log(a);d()})},function(){e(a)})};c?f(c):a.transaction(f)}},_createtables:function(a,c,e){if(d(a,e)){var f=function(c){b.helpers.each(["draft","sdata","apps"],function(a,d,e){c.executeSql(h(a),[],function(){e()},function(a,c){b.helpers.pushdbError(c);e()})},function(){e(a)})};c?f(c):a.transaction(f)}},_openDB:function(a){if(window.openDatabase){var c=
function(b,a){alert(a.message)};try{var d=openDatabase("sage-mge-test","1.0","HTML 5 Database for Mobile",2E5)}catch(e){return b.helpers.pushException(e,b.smobile.locale().ui.no_db_support_sol),a(null)}if(!d)return b.helpers.pushException({message:b.smobile.locale().ui.no_db_support},b.smobile.locale().ui.no_db_support_sol),a(null);d?d.transaction(function(b){b.executeSql(h("migration"),[],function(b){b.executeSql("select version from migration",[],function(b,e){if(e.rows&&e.rows.length){if("1"==
e.rows.item(0).version)return a(d);p._droptables(d,b,function(){p._createtables(d,b,function(){b.executeSql("update migration set version=?",["1"],function(){return a(d)},c)})})}else b.executeSql("insert into migration (version) values (?)",[1],function(b){p._createtables(d,b,a)},c)},c)},c)}):alert("Failed to open the database on disk.  This is probably because the version was bad or there is not enough space left in this domain's quota")}},_execOpen:function(a,c,e,f){if(d(a,f)){var g=function(a,
c){b.helpers.pushdbError(c);f(null,!0)};a.readTransaction(function(b){b.executeSql(c,e,function(b,a){f(a.rows)},g)},g)}},_execSQL:function(a,c,d,e,f){var g=f.fail;f.fail=function(a,c){b.helpers.pushdbError(c);g&&g()};var k=function(a,c){b.helpers.pushdbError(c);g&&g()};c?c.executeSql(d,e,function(){f.success()},f.fail):a.transaction(function(b){b.executeSql(d,e,function(){f.success()},f.fail)},k)},_insertDraft:function(b,a,c,e){d(b,e)&&p._execSQL(b,a,"INSERT INTO draft (id, appid, original_url, representation, original_data,  data) values(?,?,?,?,?,?)",
[c.id,c.appid,c.original_url,c.representation,c.original_data?JSON.stringify(c.original_data):"",JSON.stringify(c.data)],{success:function(){e(c)}})},_deleteDraft:function(b,a,c,e){d(b,e)&&p._execSQL(b,a,"DELETE from draft where id=?",[c],{success:function(){e(null)},fail:function(){e(null)}})},_markSdataSeleted:function(c,d,e,f){var c=b.sdata.parseSdataUri(c),g=!1,k=c.query?c.query.representation:"";if(c.template)g=!0,c.template=!1,c.id=a(c.query.representation,e);delete c.query;c.createActivity=
!1;c.editActivity=!1;var h=b.sdata.getUri(c);p._getSDataByUrl(h,d,function(a){if(a){if(a.status===b.sdata.STATUS.DELETED)return f(null);if(a.status===b.sdata.STATUS.MODIFIED)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:b.sdata.STATUS.DELETED,representation:a.representation},p._updSDataByUrl(a.url,a,d,function(){return f(null)});if(a.status===b.sdata.STATUS.CREATED)return p._rmvSDataByUrl(h,d,function(){return f(null)})}else{if(g)return f(null);
p._insertSdata({url:h,data:e,original_data:null,status:b.sdata.STATUS.DELETED,representation:k},d,function(){return f(null)})}})},_deleteDataByDraft:function(a,c,e){if(d(a,e)){var f=function(a,c){b.helpers.pushdbError(c);e(null,c)};a.transaction(function(b){b.executeSql("SELECT * FROM draft where id=?",[c],function(b,d){if(d&&d.rows&&d.rows.length){var f=d.rows.item(0),g=f.original_url,k=f.data?JSON.parse(f.data):null,f=f.original_data?JSON.parse(f.original_data):null;p._markSdataSeleted(g,b,f?f:
k,function(){return p._deleteDraft(a,b,c,function(){e(null)})})}else e(null)},f)},f)}},_createDraft:function(a,c,e){if(d(a,e))c.appid=b.sdata.config.id,a.transaction(function(b){p._execSQL(a,b,"DELETE from draft where original_url=? and appid=?",[c.original_url,c.appid],{success:function(){p._insertDraft(a,b,c,e)},fail:function(){p._insertDraft(a,b,c,e)}})},function(a,c){b.helpers.pushdbError(c);e(null,c)})},_updateDraft:function(b,a,c,e){d(b,e)&&p._execSQL(b,null,"UPDATE draft set data=? where id=?",
[JSON.stringify(c),a],{success:e})},_getSData:function(a,c,e){if(d(a,e.success))try{if(c.id||c.template)p._execOpen(a,"SELECT * FROM sdata where url=?",[c.uri],function(b,a){if(a)return e.success(null,{status:404});if(b.length&&j(b.item(0),e)){var c=b.item(0);e.success(m(c,JSON.parse(c.data)),{status:200})}else e.success(null,{status:404})});else if(c.entity){var f={$url:c.uri,$resources:[]},k={query:null},h=[],i={};b.extend(k,c);delete k.query;var o=b.sdata.getUri(k);p._execOpen(a,"SELECT * FROM sdata where entity_url=?",
[o],function(a,d){if(d)return e.success(f,{status:404});a.length?b.helpers.each(Array(a.length),function(b,d,g){b=a.item(d);return j(b,e)?l(b,JSON.parse(b.data),f.$resources,c,h,i,function(){g()}):g()},function(){if(c.pgroupBy)for(var b in i)f.$resources.push(i[b]);g(c,f.$resources,e);e.success(f,{status:200})}):e.success(f,{status:200})})}}catch(n){console.log(n)}},_loadDraft:function(b,a,c){d(b,c)&&p._execOpen(b,"SELECT * FROM draft where id=?",[a],function(b,a){if(a)return c(null);if(b.length){var d=
b.item(0);c({appid:d.appid,id:d.id,original_url:d.original_url,data:JSON.parse(d.data)})}else c(null)})},_getModifiedData:function(a,c,e){if(d(a,e)){var f={},c=b.sdata.entityUri(c);p._execOpen(a,"SELECT * FROM sdata where status > ? and appid = ? and entity_url = ?",[b.sdata.STATUS.ORIGINAL,b.sdata.config?b.sdata.config.id:"",c],function(a,c){if(c)return e(f);if(a&&a.length)for(var d=0,g=a.length;d<g;d++){var k=a.item(d),h=JSON.parse(k.data),i=b.sdata.parseSdataUri(k.url);f[i.id]={data:h,status:k.status}}e(f)})}},
_getSyncData:function(a,c,e){if(d(a,e)){var f=null,g=b.sdata.config?b.sdata.config.id:"";c?p._execOpen(a,"SELECT count(*) as sync FROM sdata where status > ? and appid = ?",[b.sdata.STATUS.ORIGINAL,g],function(b,a){if(a)return e(0);b&&b.length?e(b.item(0).sync):e(0)}):p._execOpen(a,"SELECT * FROM sdata where status > ? and appid = ?",[b.sdata.STATUS.ORIGINAL,g],function(a,c){if(c)return e(null);if(a&&a.length){for(var d=0,g=a.length;d<g;d++){var k=a.item(d);f=f||{};var h=b.sdata.parseSdataUri(k.url),
i=f[h.entity]||[];f[h.entity]=i;var q=JSON.parse(k.data);o(h,k,q,b.sdata.config.pages[k.representation].$prototype);i.push(q)}e(f)}else e(null)})}},_delData:function(b,a,c){d(b,c)&&b.transaction(function(b){return p._rmvSDataByUrl(a,b,c)})},_installApp:function(a,c,e){d(a,e)&&a.transaction(function(a){var d=function(){a.executeSql("INSERT INTO apps(id, url, title, description, icon, baseURL, version, data) values(?,?,?,?,?,?,?,?)",[c.id,c.url,c.title,c.description,c.icon,c.baseURL,c.version,JSON.stringify(c.data)],
function(){e()},function(a,c){b.helpers.pushdbError(c);e()})};a.executeSql("delete from apps where url=? and baseURL= ?",[c.url,c.baseURL],function(){d()},function(){d()})})},_removeFromDB:function(a,c,e){d(a,e)&&a.transaction(function(b){var d=function(){return p._execSQL(a,b,"DELETE from apps where id=?",[c],{success:function(){e()},fail:function(){e()}})},f=function(){return p._execSQL(a,b,"DELETE from draft where appid=?",[c],{success:function(){d()},fail:function(){d()}})};return p._execSQL(a,
b,"DELETE from sdata where appid=?",[c],{success:function(){f()},fail:function(){f()}})},function(a,c){b.helpers.pushdbError(c);return e()})},_getAppConfig:function(b,a,c){d(b,c)&&p._execOpen(b,"SELECT * FROM apps where id=?",[a],function(b,a){a&&c(null);if(b&&b.length){var d=b.item(0),e=null;try{e=JSON.parse(d.data)}catch(f){}e=e||{};e.id=d.id;e.$info={url:d.url,version:d.version,title:d.title,icon:d.icon};c(e)}else c(null)})},_getInstalledApps:function(b,a,c){if(d(b,c)){var e=[];p._execOpen(b,"SELECT * FROM apps ORDER BY url",
[],function(b,a){if(a)return c(e);if(b&&b.length)for(var d=0,f=b.length;d<f;d++){var g=b.item(d);e.push({id:g.id,url:g.url,title:g.title,description:g.description,icon:g.icon,baseURL:g.baseURL,version:g.version})}c(e)})}},_undoUpdate:function(a,c,e){d(a,e)&&a.transaction(function(a){p._getSDataByUrl(c,a,function(d){if(d)return!b.sdata.store(c)||d.status===b.sdata.STATUS.CREATED?p._rmvSDataByUrl(c,a,function(){e(null)}):p._updSDataByUrl(c,{appid:d.appid,url:d.url,data:d.original_data?d.original_data:
d.data,original_data:null,status:b.sdata.STATUS.ORIGINAL,representation:d.representation},a,function(){e(null)});e(null)})})},_updData:function(a,c,e,f){d(a,f)&&a.transaction(function(a){e.url=c;var d=function(){return e.status===b.sdata.STATUS.ORIGINAL&&!b.sdata.store(c)?p._rmvSDataByUrl(c,a,function(b,a){f(null,a)}):p._updSDataByUrl(c,e,a,function(b,a){f(null,a)})};e.$load?(delete e.$load,p._getSDataByUrl(e.url,a,function(b){Object.keys(e).forEach(function(a){b[a]=e[a]});e=b;d()})):d()})},_initData:function(a,
c,e,f){if(d(a,f.success)){if(!f.fail)f.fail=f.success;a.transaction(function(d){if(e)return p._initData_one(a,c,e,d,f);var g=!1;b.helpers.each(c,function(c,e,k){if(g)return k();if(f.setConfig)b.sdata.config={baseURL:c.$baseURI};return p._initData_one(a,c.value,c.data,d,{success:k,fail:function(){g=!0;return k()}})},function(){f.success&&f.success()})},f.fail)}},_initData_one:function(a,c,d,e,f){var g={success:function(){if(d){if(c.onlyOne)return p._addSdata(a,e,{data:d,url:c.url},{success:function(){f.success&&
f.success()}});if(d.$resources)return b.helpers.each(d.$resources,function(c,d,f){return p._addSdata(a,e,{data:c,url:b.sdata.$purl(c.$url)},{success:function(){f()}})},function(){f.success()})}else f.success()},fail:function(){f.fail()}};return c.onlyOne?p._delSdata(a,e,c.url,g):e.executeSql("delete from sdata where entity_url= ?",[c.url],g.success,g.fail)}};e.prototype={init:function(){},check:function(a,c){var d=this;if(c)return n._openDB(function(c){c||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});
a(c)});d.db?a(d.db):n._openDB(function(c){d.db=c;d.db||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(d.db)})},createDraft:function(b,a){this.check(function(c){n._createDraft(c,b,a)})},updateDraft:function(b,a,c){this.check(function(d){n._updateDraft(d,b,a,c)})},deleteDraft:function(b,a){this.check(function(c){n._deleteDraft(c,null,b,a)})},deleteDataByDraft:function(b,a){this.check(function(c){n._deleteDataByDraft(c,b,a)})},saveDraft:function(b,a,c){this.check(function(d){n._saveDraft(d,
b,a,c)})},loadDraft:function(b,a){this.check(function(c){n._loadDraft(c,b,a)})},getSData:function(b,a){this.check(function(c){n._getSData(c,b,a)})},initData:function(b,a,c){this.check(function(d){n._initData(d,b,a,c)})},delData:function(b,a){this.check(function(c){n._delData(c,b,a)})},undoUpdate:function(b,a){this.check(function(c){n._undoUpdate(c,b,a)})},installApp:function(b,a){this.check(function(c){n._installApp(c,b,a)})},removeFromDB:function(b,a){this.check(function(c){n._removeFromDB(c,b,a)})},
getAppConfig:function(b,a){this.check(function(c){n._getAppConfig(c,b,a)})},getInstalledApps:function(b,a){this.check(function(c){n._getInstalledApps(c,b,a)})},getSyncData:function(b){this.check(function(a){n._getSyncData(a,!1,b)})},getModifiedData:function(b,a){this.check(function(c){n._getModifiedData(c,b,a)})},getSyncCount:function(b){this.check(function(a){n._getSyncData(a,!0,b)})},updData:function(b,a,c){this.check(function(d){n._updData(d,b,a,c)})}};f.prototype={init:function(){},check:function(a,
c){var d=this;if(c)return p._openDB(function(c){c||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(c)});d.db?a(d.db):p._openDB(function(c){d.db=c;d.db||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(d.db)})},createDraft:function(b,a){this.check(function(c){p._createDraft(c,b,a)})},updateDraft:function(b,a,c){this.check(function(d){p._updateDraft(d,b,a,c)})},deleteDraft:function(b,a){this.check(function(c){p._deleteDraft(c,null,b,a)})},deleteDataByDraft:function(b,
a){this.check(function(c){p._deleteDataByDraft(c,b,a)})},saveDraft:function(b,a,c){this.check(function(d){p._saveDraft(d,b,a,c)})},loadDraft:function(b,a){this.check(function(c){p._loadDraft(c,b,a)})},getSData:function(b,a){this.check(function(c){p._getSData(c,b,a)})},initData:function(b,a,c){this.check(function(d){p._initData(d,b,a,c)})},delData:function(b,a){this.check(function(c){p._delData(c,b,a)})},undoUpdate:function(b,a){this.check(function(c){p._undoUpdate(c,b,a)})},getInstalledApps:function(b,
a){this.check(function(c){p._getInstalledApps(c,b,a)})},installApp:function(b,a){this.check(function(c){p._installApp(c,b,a)})},removeFromDB:function(b,a){this.check(function(c){p._removeFromDB(c,b,a)})},getAppConfig:function(b,a){this.check(function(c){p._getAppConfig(c,b,a)})},getSyncData:function(b){this.check(function(a){p._getSyncData(a,!1,b)})},getSyncCount:function(b){this.check(function(a){p._getSyncData(a,!0,b)})},getModifiedData:function(b,a){this.check(function(c){p._getModifiedData(c,
b,a)})},updData:function(b,a,c){this.check(function(d){p._updData(d,b,a,c)})}};if(c&&!window.openDatabase){var r=new e;b.sdata.createDraft=function(a,c){b.sdata.useCacheCount=!1;r.createDraft(a,c)};b.sdata.updateDraft=function(a,c,d){b.sdata.useCacheCount=!1;d||(d=function(){});r.updateDraft(a,c,d)};b.sdata.loadDraft=function(b,a){r.loadDraft(b,a)};b.sdata.deleteDraft=function(a,c){b.sdata.useCacheCount=!1;r.deleteDraft(a,c)};b.sdata.saveDraft=function(a,c,d){b.sdata.useCacheCount=!1;r.saveDraft(a,
c,d)};b.sdata.getSData=function(b,a){r.getSData(b,a)};b.sdata.initData=function(a,c,d){b.sdata.useCacheCount=!1;r.initData(a,c,d)};b.sdata.updData=function(a,c,d){b.sdata.useCacheCount=!1;r.updData(a,c,d)};b.sdata.delData=function(a,c){b.sdata.useCacheCount=!1;r.delData(a,c)};b.sdata.deleteDataByDraft=function(a,c){b.sdata.useCacheCount=!1;r.deleteDataByDraft(a,c)};b.sdata.getSyncData=function(b){r.getSyncData(b)};b.sdata.getSyncDataCount=function(b){r.getSyncCount(b)};b.sdata.getModifiedData=function(b,
a){r.getModifiedData(b,a)};b.sdata.undoUpdate=function(a,c){b.sdata.useCacheCount=!1;r.undoUpdate(a,c)};b.sdata.getInstalledApps=function(b,a){r.getInstalledApps(b,a)};b.sdata.installApp=function(b,a){r.installApp(b,a)};b.sdata.getAppConfig=function(b,a){r.getAppConfig(b,a)};b.sdata.removeFromDB=function(b,a){r.removeFromDB(b,a)}}else if(window.openDatabase){var u=new f;b.sdata.createDraft=function(a,c){b.sdata.useCacheCount=!1;u.createDraft(a,c)};b.sdata.updateDraft=function(a,c,d){b.sdata.useCacheCount=
!1;d||(d=function(){});u.updateDraft(a,c,d)};b.sdata.loadDraft=function(b,a){u.loadDraft(b,a)};b.sdata.deleteDraft=function(a,c){b.sdata.useCacheCount=!1;u.deleteDraft(a,c)};b.sdata.saveDraft=function(a,c,d){b.sdata.useCacheCount=!1;u.saveDraft(a,c,d)};b.sdata.getSData=function(a,b){u.getSData(a,b)};b.sdata.initData=function(a,c,d){b.sdata.useCacheCount=!1;u.initData(a,c,d)};b.sdata.updData=function(a,c,d){b.sdata.useCacheCount=!1;u.updData(a,c,d)};b.sdata.delData=function(a,c){b.sdata.useCacheCount=
!1;u.delData(a,c)};b.sdata.deleteDataByDraft=function(a,c){b.sdata.useCacheCount=!1;u.deleteDataByDraft(a,c)};b.sdata.getSyncData=function(a){u.getSyncData(a)};b.sdata.getSyncDataCount=function(a){u.getSyncCount(a)};b.sdata.getModifiedData=function(a,b){u.getModifiedData(a,b)};b.sdata.undoUpdate=function(a,c){b.sdata.useCacheCount=!1;u.undoUpdate(a,c)};b.sdata.getInstalledApps=function(a,b){u.getInstalledApps(a,b)};b.sdata.installApp=function(a,b){u.installApp(a,b)};b.sdata.getAppConfig=function(a,
b){u.getAppConfig(a,b)};b.sdata.removeFromDB=function(a,b){u.removeFromDB(a,b)}}})(jQuery);(function(b){var e=b.smobile||{},f=/([^&=;]*)=?([^&;]*)/g;e._uiCache={};e.PAGES={start:{ui:"start.$static",useAppId:!1,db:!1,addBack:!1},errors:{ui:"errors.$static",useAppId:2,db:!1,addBack:!0},home:{ui:"home.$static",useAppId:2,isHome:!0,db:!0,addBack:!0,cache:!0},about:{ui:"about.$static",useAppId:!1,db:!1,addBack:!0,home:!0},send:{ui:"send.$static",useAppId:2,home:!0,addBack:!0},page:{useAppId:2,db:!0,addBack:!0,home:!0},dialog:{useAppId:1,db:!0,addBack:!0,home:!1},apps:{ui:"applications.$static",
useAppId:0,db:!1,addBack:!0,home:!0}};Object.keys(e.PAGES).forEach(function(a){e.PAGES[a].id=a});e.mainFooter=function(){return"mainfooter"};e.pageIsDialog=function(a){return"dialog"===a.attr("data-"+b.mobile.ns+"role")};e.pageController=function(a){return b.jqmData(a[0],"controller")};e.pageIsDetail=function(a){return"detail"===b.jqmData(a[0],"detail")};e.hash_sep="-";b.smobile=e;e.CONSTS={error_json:"error"};e.PAGES.start.enhanceHandler=function(a,c){var d=a&&a.content&&a.content.menu&&a.content.menu.data&&
a.content.menu.data.items?a.content.menu.data.items:null;if(!d)return c(a);b.sdata.getInstalledApps(!1,function(f){var g=e.locale();f&&f.length?f.forEach(function(a){d.push({data:{title:a.title,description:a.description,icon:a.icon,hash:e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(a.id)}})}):(d.push({data:{title:g.applicationmanager.title,divider:!0}}),d.push({data:{title:g.applicationmanager.title,description:g.applicationmanager.description,icon:"menu.appmanager",hash:e.PAGES.apps.id}}));
c(a)})};e.PAGES.apps.enhanceHandler=function(a,b){var c=e.locale();if(a)a.$title=c.applicationmanager.title;b(a)};e.linkDetailPage=function(a){return a.applicationId?e.PAGES.page.id+e.hash_sep+b.helpers.encodeURIComponent(a.applicationId):e.PAGES.page.id};var d=function(a){if(a.representation){var b=a.representation.split(".");if(2<=b.length)a.representation=b[0],a.facet=b[1]}},a=function(a){var c={},a=b.helpers.decodeJsmQuery(a),e=a.indexOf("?");0<e&&a.substring(e+1).replace(f,function(a,b,d){b&&
(c[b]=decodeURIComponent(d))});if(c.url&&(c.dataurl="",e=c.url.indexOf("?"),0<=e))c.dataurl=c.url.substr(0,e),a=c.url.substr(e+1),a.replace(f,function(a,b,d){b&&(c[b]=decodeURIComponent(d))});d(c);return c},c=function(a){if(!a)return null;var c=0>a.indexOf("="),a="#"===a[0]?a.substring(1):a,c=a.indexOf(c?b.helpers.encodeJsmQuery("?"):"?");0<c&&(a=a.substring(0,c));var d={page:null},c=a.indexOf(e.hash_sep);if(0<c){if(d.page=e.PAGES[a.substring(0,c)],d.application=decodeURIComponent(a.substr(c+1)),
36<d.application.length)d.pageId=d.application.substr(37),d.application=d.application.substr(0,36)}else d.page=e.PAGES[a],d.application="";if(!d.page||2===d.page.useAppId&&!d.application)return null;if(1===d.page.useAppId&&!d.application)d.application=b.sdata.config?b.sdata.config.id:"";if(!d.pageId)d.pageId=b.helpers.uuid();d.pageName=d.page.id+(d.application?e.hash_sep+b.helpers.encodeURIComponent(d.application):"");d.domid=e.PAGES.home.id===d.page.id?d.application:d.pageId;d.longPageName=e.PAGES.home.id===
d.page.id?d.pageName:d.page.id+(d.application?e.hash_sep+b.helpers.encodeURIComponent(d.application+"-"+d.pageId):"");return d};e.ACTIONS={home:{name:"home",execute:function(a,b){e.goHome(null);b(null)}},"action-cancel":{name:"action-cancel",execute:function(a,c){b.sdata.undoUpdate(a.url,function(){b.sdata.getSyncDataCount(function(a){a?c(!0):(e.doBack(null),c(!1))})})}}};var i=function(a,b){a.before&&b.push(a.before);a.html&&b.push(a.html);a.childs&&a.childs.forEach(function(a){i(a,b)});a.after&&
b.push(a.after)},h=function(a){for(var b in a)if("ErrorView"===a[b].uiClass)return!0;return!1},g=function(a,c,d,e){b.helpers.each(Object.keys(c),function(e,f,g){var h=c[e],f=d[h.parent]||d.root;h.id=a.prefix+e;if(h.layout)return f=b.smobile.addLayout.apply(a,[f,h]),d[e]=f,f.childs&&f.childs.length&&f.childs.forEach(function(a){d[a.id]=a}),g();if(h.uiClass)b.smobile.addControl.apply(a,[f,h,function(b){b&&Array.isArray(b)?b.forEach(function(b){d[e+b.scid]=b;(b.bind||b.action)&&a.registerControl({id:h.id+
b.scid,bind:b.bind,action:b.action,options:b.options,uiClass:b.uiClass,refresh:b.refresh})}):b&&(d[e]=b,(b.bind||b.action)&&a.registerControl({id:h.id,bind:b.bind,action:b.action,options:b.options,uiClass:h.uiClass,refresh:b.refresh}));g()}]);else return g()},e)};e._loadStaticUI=function(a){return e.staticui[a]()};var j=function(a,d){var f=b.helpers.encodeURIComponent("?url="+b.helpers.encodeURIComponent(a)),g=c("#"+e.PAGES.dialog.id);return l(f,g,function(a,b){b&&delete b.footer;d(a,b)})},m={menu2link:function(a,
b){if("$representation"==a.linkType)b.entity=a.entity,b.representation=a.representation,b.facet=a.facet||"$query"},representation2ui:function(a,c){var d={};if("$dashboard"==a.facet)d={content:{menu:{uiClass:"MainMenu",data:{items:[]}}}},c.forEach(function(a){var b={title:a.title,description:a.description,icon:a.icon};m.menu2link(a,b);d.content.menu.data.items.push({data:b})}),d.$facet="$dashboard";else if("$query"===a.facet||"$lookup"===a.facet){d={content:{items:{uiClass:"SDataList",data:{bind:"$resources"}}}};
if("$lookup"===a.facet)d.options={detail:!0},d.content.items.data.$lookup=1;if(c&&c.$prototype&&c.$prototype.$title)d.$title=b.proto.parseExpression(c.$prototype.$title,{data:null,$prototype:c.$prototype},"$title");d.$page=a.representation+"."+a.facet;d.$facet=a.facet;d.$representation=a.representation}else if("$details"==a.facet||"$edit"==a.facet||"$create"==a.facet){var d={content:{}},e={};if(c.$article||c.$prototype.$article)b.proto.layoutParser(e,c.$article||c.$prototype.$article,"$article",[c.$prototype]);
b.proto.generateForm(e,0,d.content,"",!1,a.facet);if(c&&c.$prototype&&c.$prototype.$title)d.$title=b.proto.parseExpression(c.$prototype.$title,{data:null,$prototype:c.$prototype},"$title");d.$page=a.representation+"."+a.facet;d.$facet=a.facet;d.$representation=a.representation}else d=c;return d},getCtxItems:function(a,c,d,f){d={exclude:!1,items:[]};if(c=b.sdata.config.pages[c+"."+a])if("$details"===a)c.$prototype.$links.$edit&&!c.$prototype.$links.$edit.$isHidden&&(a=b.proto.parseExpression(c.$prototype.$links.$edit.$url,
{data:null,$prototype:c.$prototype},"$url"),a=b.sdata.parseSdataUri(a),a.query&&a.query.representation&&b.sdata.config.pages[a.query.representation]&&d.items.push({title:e.locale().ui.edit_item,icon:"edit",url:c.$prototype.$links.$edit.$url,bind:!0}));else if(("$edit"===a||"$create"===a)&&f&&f.url)b.sdata.parseSdataUri(f.url),d.exclude=!0,d.items=[{title:e.locale().ui.cancel_item,action:"cancel",jmdata:{"data-icon":"refresh","data-transition":"none"}},{title:e.locale().ui.remove_item,action:"delete",
jmdata:{"data-icon":"delete","data-transition":"none"}},{title:e.locale().ui.save_item,action:"save",jmdata:{"data-icon":"check","data-transition":"none"}}];return d},concatItems:function(a,b,c){if(a.exclude)return a.items||[];a.items=a.items||[];return a.items.concat(c,b)},enhanceFooter:function(a,c,d,e,f){if(!a.footer){if((a.footer=c)&&a&&a.$facet&&b.sdata.config){if("$query"===a.$facet||"$lookup"===a.$facet){a.footer.footer.data.items=c.footer.data.items=[{type:"previous"},{type:"home"},{type:"next"}];
return}var e=c.footer.data.items,g=b.sdata.config.footer,a=m.getCtxItems(a.$facet,a.$representation,f,d);c.footer.data.items=m.concatItems(a,e,g)}for(;4<c.footer.data.items.length;)c.footer.data.items.pop()}}};e.detailUiData=function(a,b,c,d){a={};a.uiData=m.representation2ui({facet:"$edit",representation:"x-object"},{$prototype:b,$article:{$items:d}});a.uiData.$prototype=b;return a};var l=function(c,f,g){var h={},i=a(c,f.pageName);if(!i.representation&&f.page.ui)i.representation=f.page.ui,d(i);if(!i.representation)return g("",
null,null);var j=function(a){if(f.page.db){var c=null,d=i.representation;if(f.page.isHome)i.representation=b.sdata.config.home,d=i.representation,i.facet="$dashboard";if("$dashboard"==i.facet)c=b.sdata.config.dashboards;else if(i.facet)d=i.representation+"."+i.facet,c=b.sdata.config.pages;if(c&&c[d])if(h=c[d],h=m.representation2ui(i,h)){m.enhanceFooter(h,a,i,f.page);if(f.page.isHome)h.$title=b.sdata.config.title;if(f.page.enhanceHandler)f.page.enhanceHandler(h,function(a){return g(d,a,null)});else return g(d,
h,null)}else return g("",null,null);else return g("",null,null)}else{c=e._loadStaticUI(i.representation);if(!c)return g(i.representation,h,null);h=c;m.enhanceFooter(h,a,i,f.page);if(f.page.enhanceHandler)f.page.enhanceHandler(h,function(a){return g(i.representation,a,null)});else return g(i.representation,h,null)}};(function(){var a=null;2==f.page.useAppId&&(!b.sdata.config||b.sdata.config.id!=f.application)?b.sdata.getAppConfig(f.application,function(c){b.sdata.config=c;if(!b.sdata.config)return g("",
null,{action:"start"});b.sdata.config.pages&&Object.keys(b.sdata.config.pages).forEach(function(a){a=b.sdata.config.pages[a];a.$prototype&&b.proto.linkParents(a.$prototype,null)});a=e.staticui.appFooter();j(a)}):(f.page.useAppId?a=e.staticui.appFooter():(delete b.sdata.config,b.sdata.useCacheCount=!1,a=e._loadStaticUI(e.mainFooter())),j(a))})()};e.removePage=function(a){var c=b.jqmData(a,"controller");c&&(console.log("Remove page"+(c?": "+c.pageInfo.page.id+"-"+(c.pageInfo.pageId||""):"")),c.remove());
a=b(a);b.removeWithDependents(a)};e.removeAllPages=function(a){a=a||[];a.push("page-template");var c=b('div[data-role="page"]');if(c&&c.length)for(var d=c.length,f;d--;)f=c[d],0>a.indexOf(f.id)&&e.removePage(f)};e.hashOfUrl=function(a){var b=a.indexOf("#");return 0<=b?a.substring(b):""};e.pageName=c;e.actionName=function(a){if(!a)return null;for(var b=Object.keys(e.ACTIONS),c=b.length;c--;){var d=b[c],f=a.indexOf(d);if(0===f||1===f)return e.ACTIONS[d]}return null};e.loadPage=function(a,b,c){l(a,b,
c)};e.loadDialog=function(a,b){j(a,b)};e.execAction=function(b,c,d){b=a(b,c.name);return c.execute(b,d)};e.buildPage=function(a,c,d,f,j,l,m,s,t){var B=d[0],y={root:{before:"",after:"",childs:[]}},w=null,z={root:{before:"",after:"",childs:[]}},A={root:{before:"",after:"",childs:[]}};c&&c[0]&&(w=b.jqmData(c[0],"controller"));if(l.url)l.url=b.sdata.parseSdataUri(l.url);d.uiController({id:a,ui:a,entity:l.entity,inCreate:l.$createActivity,page:m,url:l.url});var v=b.jqmData(B,"controller");v.pageInfo=m;
if(2===m.page.useAppId&&m.application)v.applicationId=m.application,v.homeRef="#"+e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(v.applicationId);else if(!1==m.page.useAppId)v.applicationId="",v.homeRef="#"+e.PAGES.start.id;if(f.$page)v.page=f.$page,delete f.$page;v.data=j||{};v.pageOptions=f.options||{};if(v.pageOptions.detail&&w&&(v.parent=w,w.child=v,v.applicationId=w.applicationId,f.$prototype))v.detailpagedata={$prototype:f.$prototype};var x=d.children(":jqmData(role=header)"),C=d.children(":jqmData(role=content)").children(".content-primary"),
D=d.children(":jqmData(sagerole=footer)");f.header=f.header||{title:{uiClass:"Html",data:{html:"<h1></h1>"}}};f.footer=f.footer||{};f.content=f.content||{};g(v,f.footer,A,function(){g(v,f.header,z,function(){h(f.content)?v.hasErrorView=!0:b.helpers.clearErrors();g(v,f.content,y,function(){var a=[],c;i(z.root,a);x.html(a.join(""));(a=x.find("h1"))&&a.length&&(c=f.$title||(v.data?v.data.$title:"")||"");c&&a.html(c);m&&m.page&&m.page.home?x.append('<a href="'+(v.homeRef?v.homeRef:m.page.home)+'" data-'+
b.mobile.ns+'icon="home" data-'+b.mobile.ns+'iconpos="notext" data-'+b.mobile.ns+'direction="reverse" class="ui-btn-right jqm-home">'+e.locale().maintoolbar.home+"</a>"):m&&m.page&&m.page.id==e.PAGES.home.id&&x.append('<a href="#'+e.PAGES.start.id+'" data-'+b.mobile.ns+'icon="gear" data-'+b.mobile.ns+'iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">'+e.locale().ui.root_menu_tip+"</a>");a=[];i(y.root,a);C.html(a.join(""));a=[];i(A.root,a);D.html(a.join(""));v.pageOptions.dialog?
(d.removeAttr("data-"+b.mobile.ns+"role"),d.attr("data-"+b.mobile.ns+"role","dialog"),v.pageOptions.detail=!1):v.pageOptions.detail&&b.jqmData(d[0],"detail","detail");if(f.actions)for(var g in f.actions)v["action"+g]=f.actions[g];s?d.insertBefore(s):d.appendTo(b("body"));t()})})})};e.refreshPage=function(){window.location.reload()};e.goHome=function(a,c){var d="#"+e.PAGES.start.id;!a&&b.mobile.activePage&&(a=b.jqmData(b.mobile.activePage[0],"controller"));if(a&&a.applicationId)c=a.applicationId;c&&
(d="#"+e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(c));b.mobile.changePage(d,{allowSamePageTransition:!0,reverse:!0})};e.doBack=function(){b.mobile.back()};e.showErrors=function(a){if(a&&a.hasErrorView)return e.refreshPage();b.mobile.changePage("#errors",{allowSamePageTransition:!0})};e.createPage=function(a){var c=b("#page-template"),d=c.clone().attr("data-"+b.mobile.ns+"url",a.pageName).attr("id",a.domid);a.page.addBack&&d.attr("data-"+b.mobile.ns+"add-back-btn","true");return{$page:d,
$template:c}};e.createDialog=function(a,d){var f=c("#dialog"),g=e.createPage(f),h={transition:"pop",role:"dialog",changeHash:!0};b.smobile.buildPage("dialog",b.mobile.activePage,g.$page,a,d,{$createActivity:!0},f,g.$template,function(){var c=b.jqmData(g.$page[0],"controller");if(a.actions)c.pageActions=a.actions,delete a.actions;b.mobile.changePage(g.$page,h);c.bindData()})};e.createDetail=function(a,d,f){a.options=a.options||{};a.options.detail=!0;var g=c(f?"#page-"+f.applicationId+"-"+b.helpers.uuid():
"#dialog"),h=e.createPage(g);h.$page.attr("data-url","#"+g.longPageName);var i={transition:"slide",changeHash:!0};b.smobile.buildPage("dialog",b.mobile.activePage,h.$page,a,d,{$createActivity:!0},g,h.$template,function(){var c=b.jqmData(h.$page[0],"controller");if(f)c.options.url=f.options.url;if(a.actions)c.pageActions=a.actions,delete a.actions;b.mobile.changePage(h.$page,i);c.bindData()})};e.showError=function(a,c){b.mobile.showPageLoadingMsg(b.mobile.pageLoadErrorMessageTheme,c||b.mobile.pageLoadErrorMessage,
!0);setTimeout(b.mobile.hidePageLoadingMsg,3E3)};e.silentAction=function(a){"start"===a.action&&e.goHome(null)};e.addLayout=function(){return null};e.addControl=function(a,b,c){c()};e.setEvents=function(){return null};e.parseURL=function(c,d,f){var g={method:"GET"},h=a(c.search||c.hash,d.pageName),i=c.domain+c.pathname+(b.helpers.hashFirst()?"#"+d.longPageName:"");if(!h.representation&&d.page.ui)h.representation=d.page.ui;var j={url:h.url};if(h.url){var l={$title:h.title,$method:g.method,$init:null,
$filter:null,$ui:h.ui,$type:h.type,success:function(a,g){var l=c.domain+c.pathname;g.location&&0!=g.location.indexOf("http")&&delete g.location;var m=g.location?g.location:h.url;j.url=m;if(300<g.status)return l=d.application?l+"#"+e.PAGES.home.id+e.hash_sep+d.application:l+"#"+e.PAGES.start.id,f(l,a,!0,j);if(100==g.status)return j.stop=!0,f("",a,!1,{stop:!0});l="?url="+b.helpers.encodeURIComponent(m);l=i+b.helpers.encodeJsmQuery(l)+(b.helpers.hashFirst()?"":"#"+d.longPageName);return f(l,a,!1,j)}};
g&&g.options&&b.extend(l,g.options);return b.sdata.execURL(h.url,l)}return f(i+(b.helpers.hashFirst()?"":"#"+d.longPageName),null,!1,j)};e.load=function(a,c,d){b.sdata.loadAuth(function(){b.sdata.authModule.checkConnected({success:function(){return e._load(a,c,d)},fail:function(){b.sdata.authModule.connect({success:function(){return e._load(a,c,d)},fail:function(){d&&d()}})}})})};e._saveAppsInDB=function(a,c,d,e,f,g){b.helpers.each(c,function(a,c,h){if(d||b.helpers.hasErrors())return d=!0,h();b.sdata.installApp(a,
function(a,b){b||(f++,e&&e(f,g,"Done"));h()})},function(){e&&e(g,g,"Done");a&&a()})};e._load=function(a,c,d){var f=[];if(a.$reinstall)if(delete a.$reinstall,b.sdata.config&&b.sdata.config.id){var g={};g.id=b.sdata.config.id;g.baseURL=b.sdata.config.baseUrl;g.description=b.sdata.config.description;g.url=b.sdata.config.$info.url;g.title=b.sdata.config.$info.title;g.icon=b.sdata.config.$info.icon;g.version=b.sdata.config.$info.version;f.push(g)}else return d();else g=a.datasets,delete a.datasets,g.forEach(function(c){if(!1!==
c.selected){var d=b.extend(!0,{},a);d.id=b.helpers.uuid();d.baseURL+=c.dataset;d.description=d.description+" ("+c.description+")";d.version=d.version||"0.000";f.push(d)}});var h=2*f.length,i=0;b.helpers.each(f,function(a,d,e){b.sdata.applicationDetails(a,function(b){i++;c&&c(i,h,"Done");if(a.data=b)b.title=a.title,b.description=a.description,b.baseUrl=a.baseURL;return e()})},function(){e._saveAppsInDB(d,f,!1,c,i,h)})}})(jQuery);
(function(b){var e=function(e,d){this.$page=e;this.page=e[0];if(d.id)d.id=d.id.replace(/\./g,"_").replace(/\$/g,"_");var a=b.jqmData(this.page,"controller");a&&a.remove();b.jqmData(this.page,"controller",this);this.options=d;this.controls={};return this.init()};e.prototype={defaults:{id:"empty"},init:function(){this.config=b.extend({},this.defaults,this.options);this.prefix=this.config.id+"_";this.ui=this.config.ui;this.hasErrorView=!1;this.errors=[];return this},exprData:function(e){var d=b.proto.exprData(),
a=this;for(e&&(Array.isArray(e)?e.forEach(function(a){a&&d.push(a)}):d.push(e));;)if(d.push(a.data),a.parent&&a.$bind)a=a.parent;else break;return d},clearErrors:function(){this.errors.length=0},hasErrors:function(){return 0<this.errors.length},pushError:function(b){this.errors.push(b)},getPageData:function(){return!this.page?null:this.detailpagedata?this.detailpagedata:!b.sdata.config||!b.sdata.config.pages||!b.sdata.config.pages[this.page]?null:b.sdata.config.pages[this.page]},afterChangeHnd:function(b){return b.options&&
b.options.action&&this["action"+b.options.action]?(b=this["action"+b.options.action],b.bind(this)):null},checkData:function(){var e=this;e.clearErrors();Object.keys(e.controls).forEach(function(d){var d=e.controls[d],a=b.smobile.controls[d.uiClass].checkValue;if(a){var c=b("#"+d.id);c&&a.apply(e,[c,d])}});return e.hasErrors()?!1:!0},checkChange:function(b,d,a){var c=this.controls[b];if(c&&c.bind){var e=c.options&&c.options.$lookup,b=this.getValue(c.bind,null,"");if(e){if(d){if(null!=d.$value)d[c.options.$display]=
d.$value,delete d.$value;""===d[c.options.$display]&&!d.$key&&!d.$uuid&&(d=null)}if(null===d)null!=b&&(this.setData(c.bind,d),this.notifyChange());else if(d.$key){if(!b||b.$key!=d.$key)this.setData(c.bind,d),this.notifyChange()}else if(d.$uuid){if(!b||b.$uuid!=d.$uuid)this.setData(c.bind,d),this.notifyChange()}else if(null!=d[c.options.$display]){if(!b||b[c.options.$display]!=d[c.options.$display])this.setData(c.bind,d),this.notifyChange()}else null!=b&&(this.setData(c.bind,null),this.notifyChange())}else b!=
d&&(this.setData(c.bind,d),this.notifyChange());if(a)return a()}if(a)return a()},editActivity:function(){return this.options&&this.options.url&&this.options.url.entity===b.proto.sdataKey.workingCopies},draftId:function(){return this.options.url.id},notifyChange:function(){this.editActivity()&&(this.parent?this.parent.notifyChange():b.sdata.updateDraft(this.draftId(),this.data))},getValue:function(b,d,a){for(var d=d||this.data,c=b.split(".");c.length&&d;){b=c.shift();d=d[b]}null==d&&(d=a);return d},
getProtoDataValue:function(b,d,a){if(d=d||this.data)d=d.$properties;for(var c=b.split(".");c.length&&d;){b=c.shift();d=d[b]}null==d&&(d=a);return d},getCurrentData:function(){return this.data},setData:function(b,d,a){for(var a=a||this.data,b=b.split("."),c=0,e=b.length-1;c<e;c++){var h=a[b[c]];h||(h={},a[b[c]]=h);a=h}a[b[b.length-1]]=d},actioncancel:function(e){if(this.editActivity())return b.sdata.deleteDraft(this.draftId(),e.success);e.success&&e.success()},actionsave:function(e){if(!this.checkData())return!1;
if(this.editActivity())return b.sdata.saveDraft(this.draftId(),this.data,e.success);e.success()},setNeedRefresh:function(){for(var b=this;b;)b.needRefresh=!0,b=b.parent},doRefresh:function(){var e=this;Object.keys(e.controls).forEach(function(d){d=e.controls[d];if(d.uiClass){var a=b.smobile.controls[d.uiClass]?b.smobile.controls[d.uiClass].refresh:null;a&&d.id&&a(e,d.options,b("#"+d.id),d.id)}})},actionnext:function(){var e=this,d=e.getCurrentData();if(d.$links&&d.$links.$next&&(d=b.proto.parseExpression(d.$links.$next.$url,
{data:null,$prototype:b.proto.getProto(e.getPageData())},"$url")))b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.loading}),b.sdata.execURL(d,{error:function(){b.mobile.loading("hide")},success:function(a){b.mobile.loading("hide");if(a)e.data=a,e.doRefresh()}})},actionprevious:function(){var e=this,d=e.getCurrentData();if(d.$links&&d.$links.$previous&&(d=b.proto.parseExpression(d.$links.$previous.$url,{data:null,$prototype:b.proto.getProto(e.getPageData())},"$url")))b.mobile.loading("show",
{theme:"a",text:b.smobile.locale().ui.loading}),b.sdata.execURL(d,{error:function(){b.mobile.loading("hide")},success:function(a){b.mobile.loading("hide");if(a)e.data=a,e.doRefresh()}})},installApplication:function(e,d){var a=!1;if(d){b.helpers.clearErrors();if(d.datasets)for(var c=0,i=d.datasets.length;c<i&&!(a=!1!==d.datasets[c].selected);c++);if(a){var h=this;b.smobile.load(d,function(a,c){0==a&&c?b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.installing}):a==c&&b.mobile.loading("hide")},
function(){b.helpers.hasErrors()?b.smobile.showErrors(h):e.success&&e.success()})}else if(e.fail)return e.fail()}else if(e.fail)return e.fail()},removeApplication:function(e,d){b.helpers.clearErrors();var a=this;b.sdata.removeFromDB(d,function(){b.helpers.hasErrors()?b.smobile.showErrors(a):e.success&&e.success()})},actionsync:function(e){b.helpers.clearErrors();var d=this,a=d.resync?b.smobile.load:null;delete d.resync;return b.sdata.execBatch(d.data,{success:function(){b.helpers.hasErrors()?b.smobile.showErrors(d):
e.success&&e.success()}},a)},actionundo:function(e){b.helpers.clearErrors();var d=this;d.data?b.helpers.each(Object.keys(d.data),function(a,c,e){(a=d.data[a])&&a.length?b.helpers.each(a,function(a,c,d){b.sdata.undoUpdate(a.$info.url,d)},e):e()},function(){e.success&&e.success()}):e.success&&e.success()},actiondelete:function(e){b.helpers.clearErrors();if(this.editActivity())return b.sdata.deleteDataByDraft(this.draftId(),function(){b.helpers.hasErrors()?b.smobile.showErrors():e.success&&e.success()});
e.success&&e.success()},remove:function(){b.jqmRemoveData(this.page,"controller");delete this.$page;delete this.detailpagedata;delete this.page;delete this.controls;delete this.detail;delete this.parent},registerControl:function(b){this.controls[b.id]=b},controlByClass:function(b){for(var d in this.controls){var a=this.controls[d];if(a.uiClass==b)return a}return null},bindData:function(e){var d=this;Object.keys(d.controls).forEach(function(a){var a=d.controls[a],c=b("#"+a.id);c&&b.smobile.setEvents.apply(d,
[c,a])});e&&e()}};b.fn.uiController=function(b){new e(this,b);return this}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;var f={GroupLayout:function(d){var a=['<center><div id="'+d.id+'" data-role="controlgroup"'];b.helpers.addJqmData(d.data,a);a.push('">');return{before:a.join(""),after:"</div></center>",childs:[]}},FieldContainer:function(d){var a=['<div id="'+d.id+'" data-role="fieldcontain"'];b.helpers.addJqmData(d.data,a);a.push('">');return{before:a.join(""),after:"</div>",childs:[]}},CollapsibleLayout:function(d){var a=d.data,c=['<div id="'+d.id+'" data-role="collapsible"  data-collapsed="'+
(a.collapsed?"true":"false")+'"'];b.helpers.addJqmData(a,c);c.push("><h"+(d.size||3)+">"+(a.text||"")+"</h"+(d.size||3)+">");return{before:c.join(""),after:"</div>",childs:[]}},CollapsibleSetsLayout:function(d){var a=['<div id="'+d.id+'" data-role="collapsible-set"'];b.helpers.addJqmData(d.data,a);a.push(">");return{before:a.join(""),after:"</div>",childs:[]}},Block:function(d){var a=['<div id="'+d.id+'" data-role="controlgroup"'];b.helpers.addJqmData(d.data,a);a.push('">');return{before:a.join(""),
after:"</div>",childs:[]}},BlockLayout:function(d){var a=['<div id="'+d.id+'" class="ui-body'];b.helpers.addJqmData(d.data,a,["data-theme"],!0,"ui-body-");a.push('">');return{before:a.join(""),after:"</div>",childs:[]}},GridLayout:function(d){var a=d.data,c=a.colCount||2;5<c&&(c=5);2>c&&(c=2);var e=a.rowCount||1;1>e&&(e=1);var f=["a","b","c","d","e"],g=['<div id="'+d.id+'"',' class="ui-grid-'+f[c-2]];b.helpers.addJqmData(a,g,["data-theme"],!0,"ui-body-");g.push('">');for(var a=a.cells||[],j={childs:[]},
m=0;m<e;m++)for(var l=0;l<c;l++){var k;a:{k=0;for(var o=a.length;k<o;k++){var n=a[k];if(n.col==l&&n.row==m){k=n;break a}}k=null}o=k||{};k={id:d.id.substring(this.prefix.length)+"_"+m+"_"+l};b.extend(k,o);o=['<div id="'+this.prefix+k.id+'"',' class="ui-block-'+f[l]];o.push('">');k={id:k.id,before:o.join(""),after:"</div>",childs:[]};j.childs.push(k)}j.before=g.join("");j.after="</div>";return j}};e.addLayout=function(b,a){if(f[a.layout]){var c=f[a.layout].apply(this,[a]);c.layoutClass=a.layout;b.childs.push(c);
return c}return null}})(jQuery);(function(b){var e=b.smobile||{},f={normal_icon:"s-m-icon-space",normal_icon_size:"s-m-icon-size",normal_noimage:"s-m-noimage",menu_icon:"s-m-menu-space",menu_icon_size:"s-m-menu-size",default_menu_name:"menu.empty",default_menu_class:"menu",default_icon_name:"sage.empty",default_icon_class:"sage"};e.ui=e.ui||{};e.ui.consts=f;e.ui.menuItem=function(b,a,c){c=c||f.default_menu_name;c=c.split(".");1==c.length&&c.splice(0,0,f.default_menu_class);return'<div class="'+f.menu_icon_size+" "+c.join(" ")+'"></div><h3>'+
b+"</h3><p><strong>"+a+"</strong></p>"};e.ui.iconItem=function(b,a,c){c=c||f.default_icon_name;c=c.split(".");1==c.length&&c.splice(0,0,f.default_icon_class);return'<div class="'+f.normal_icon_size+" "+c.join(" ")+'"></div><h3>'+b+"</h3><p><strong>"+a+"</strong></p>"};e.ui.sdataentry=function(b,a,c,e,h,g){h="";b||(b=a,a="");c&&(h='<div class="'+f.normal_icon_size+" "+f.normal_noimage+'"',e&&(h=h+" style=\"background: transparent url('"+e.replace(/'/g,"\\'")+"') no-repeat center center; background-size: 100% 100%\""),
h+="></div>");c="";g&&(c="<span class='ui-li-count'>"+g+"</span>");return h+""+b+""+(a?'<p class="s-m-margin-0">'+a+"</p>":"")+c};e.ui.sdata_link=function(d,a){var c="";if(!a.url&&a.facet){var e={$role:b.sdata.config.role||"",$baseUrl:b.sdata.config.baseUrl,$pluralType:a.entity,$representation:a.representation};"$query"==a.facet?c=b.proto.parseExpression("{$baseUrl}/{$pluralType}?representation={$representation}.$query&role={role}",{data:b.proto.exprData(e)},"$url"):"$create"==a.facet&&(c=b.proto.parseExpression("{$baseUrl}/{$pluralType}/$template/$workingCopies?representation={$representation}.$edit&role={role}",
{data:b.proto.exprData(e)},"$url"))}return c};e.ui.urlHref=function(d,a){var c=[b.helpers.hashFirst()?"#"+b.smobile.linkDetailPage(a):""];c.push(b.helpers.encodeJsmQuery("?url="+b.helpers.encodeURIComponent(d)));c.push(b.helpers.hashFirst()?"":"#"+b.smobile.linkDetailPage(a));return c.join("")};b.smobile=e;e.controls={};e._addLink=function(d,a,c,f){var h=a.css||[],g=!1;a.disabled&&h.push("ui-disabled");if(a.url||a.hash||a.action){g=!0;if(a.action)d.push('<a href="#"'),a.actionParams&&d.push("data-action='"+
a.actionParams+"'");else if(a.hash){if(c.applicationId&&0>a.hash.indexOf(b.smobile.hash_sep)){var j=b.smobile.PAGES[a.hash];if(j&&2==j.useAppId)a.hash=a.hash+b.smobile.hash_sep+b.helpers.encodeURIComponent(c.applicationId)}a.navbar&&!c.applicationId&&c.pageInfo.page.id==a.hash&&h.push("ui-btn-active");d.push('<a href="#'+a.hash+'"')}else"$external"==a.linkType?d.push('<a href="'+a.url+'"'):(d.push('<a href="'),d.push(e.ui.urlHref(a.url,c)),d.push('"'));b.helpers.addJqmData(a,d);a.controlId&&d.push(' id="'+
a.controlId+'"');h.length&&d.push(' class="'+h.join(" ")+'"');d.push(">")}null!=a.value?d.push(a.value):f&&f();g&&d.push("</a>")};e.controls.Html={handler:function(b,a){var c=b.data,e={html:c.html,options:c};delete c.html;return a(e)}};e.addControl=function(b,a,c){var f=e.controls[a.uiClass];f&&f.handler?f.handler.apply(this,[a,function(a){a&&(Array.isArray(a)?a.forEach(function(a){b.childs.push(a)}):b.childs.push(a));c(a)},b.layoutClass]):c(null)};e.setEvents=function(b,a){var c=e.controls[a.uiClass];
return c&&c.events?c.events.apply(this,[b,a]):null}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.MainMenu={handler:function(b,d){((b.data||{}).items||[]).forEach(function(a){a.data=a.data||{};a.data.menu=!0});return e.controls.List.handler.apply(this,[b,d])}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Combo={createCombo:function(e,d){var a=d.data||{},c=['<div data-role="fieldcontain" id="'+d.id+'">'];c.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');c.push('<label class="ui-input-text" for="'+d.id+'_i">'+a.label+": </label>");c.push('<select id="'+d.id+'_i"');b.helpers.addJqmData(a,c);c.push(">");var i=e.getValue(a.bind,null,null),h=i||a.value;a.items=a.items||[];if(null==i&&a.items.length)h=
a.items[0].value,e.setData(a.bind,h);a.items.forEach(function(a){c.push('<option value="'+a.value+'"'+(h==a.value?' selected="selected"':"")+">"+a.title+"</option>")});c.push("</select>");c.push("</div>");return{html:c.join(""),bind:a.bind,options:a}},handler:function(b,d){d(e.controls.Combo.createCombo(this,b))},checkValue:function(b,d){b.find("#"+d.id+"_i").find("option:selected").val();b.find("#"+d.id+"_error").html("")},xrefresh:function(e,d,a,c){var i=b("#"+e.id+"_i");i.empty();e=e.data||{};
e.items=d||[];var h=[];e.items.forEach(function(b){h.push('<option value="'+b.value+'"'+(a==b.value?' selected="selected"':"")+">"+b.title+"</option>")});i.html(h.join(""));i.selectmenu("refresh");c&&c()},events:function(b,d){var a=this,c=b.find("#"+d.id+"_i");c.bind("change",function(){var b=c.find("option:selected").val(),e=a.afterChangeHnd(d);a.getValue(d.bind,null,null)!=b&&(a.setData(d.bind,b),a.notifyChange(),e&&e())})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.SyncCheck={handler:function(a,b){a.data={label:e.locale().ui.sync_sync_data,value:!1,action:" "};return e.controls.CheckBox.handler.apply(this,[a,b])},events:function(a,b){var d=this,e=a.find("#"+b.id+"_i");e.change(function(){d.resync=e[0].checked})}};var f=function(a){switch(a){case b.sdata.STATUS.CREATED:return"created";case b.sdata.STATUS.DELETED:return"deleted";case b.sdata.STATUS.MODIFIED:return"modified"}return""},d=function(a){switch(a){case b.sdata.STATUS.CREATED:return b.smobile.locale().cancel_create;
case b.sdata.STATUS.DELETED:return b.smobile.locale().ui.cancel_delete;case b.sdata.STATUS.MODIFIED:return b.smobile.locale().cancel_update}return""};e.controls.SyncFooter={handler:function(a,c){var d=this;return b.sdata.getSyncCount({success:function(b){a.data=b?{items:[{title:e.locale().ui.sync_cancel_all,action:"undo",jmdata:{"data-icon":"delete","data-transition":"none"}},{title:e.locale().ui.sync_send_all,action:"sync",jmdata:{"data-icon":"arrow-u","data-transition":"none"}}]}:{items:[{title:e.locale().ui.sync_resync_data,
action:"sync",jmdata:{"data-icon":"arrow-d","data-transition":"none"}}]};return e.controls.NavBar.handler.apply(d,[a,c])}})},events:function(a,b){return e.controls.NavBar.events.apply(this,[a,b])}};e.controls.SyncView={handler:function(a,c){var i=this,h=[];i.hasSyncView=!0;var g=function(){h.push("</ul>");c({html:h.join(""),bind:" "})};b.sdata.getSyncData(function(c,m){if(m)return g(c);if(i.data=c)h.push('<ul id="'+a.id+'" data-role="listview" data-split-icon="back" data-split-theme="d"'),h.push(' data-inset="true"'),
h.push(">"),Object.keys(c).forEach(function(a){var g=b.sdata.entityMeta(a);g&&(h.push('<li data-role="list-divider">'),h.push(g.title||a),h.push("</li>"),c[a].forEach(function(a){h.push("<li");var c=[];c.push("ui-li-has-icon");c.length&&h.push(' class="'+c.join(" ")+'"');h.push(">");var g=[];g.push('<span class="ui-li-icon ui-li-thumb s-m-status '+f(a.$info.status)+'"></span>');g.push(b.helpers.htmlEncode(a.$info.title||"..."));a.$info.last_error&&(g.push('<p class="s-m-error"><strong>'),g.push(b.helpers.htmlEncode(a.$info.last_error)),
g.push("</strong></p>"));a.$info.status==b.sdata.STATUS.DELETED?(h.push('<a href="#">'),h.push(g.join("")),h.push("</a>")):(c={url:a.$info.url+"/"+b.proto.sdataKey.workingCopies+"?representation="+b.helpers.encodeURIComponent(a.$info.representation)},e._addLink(h,c,i,function(){h.push(g.join(""))}));h.push('<a href="#action-cancel'+b.helpers.encodeJsmQuery("?url="+b.helpers.encodeURIComponent(a.$info.url))+'">'+b.helpers.htmlEncode(d(a.$info.status))+"</a>");h.push("</li>")}))});g(c)})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.AppsView={handler:function(f,d){var a=this,c=[];a.data={};var i=function(a,b){if(!b||!b.length)return a;for(var c=a.length;c--;){for(var d=a[c],e=d.datasets.length;e--;){var f;a:{for(f=b.length;f--;){var h=b[f];if(h.url==d.url&&h.baseURL==d.baseURL+d.datasets[e].dataset){f=!0;break a}}f=!1}f&&d.datasets.splice(e,1)}d.datasets.length||a.splice(c,1)}return a},h=function(g){if(g&&g.length)c.push('<div data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d"  data-collapsed="false" data-inset="true">'),
c.push("<h2>"+e.locale().applicationmanager.installed_apps+"</h2>"),c.push('<ul id="'+f.id+'_remove" data-role="listview"'),c.push(' data-inset="false"'),c.push(">"),a.data.remove={},g.forEach(function(d){a.data.remove[d.id]=d;c.push('<li data-role="fieldcontain"');c.push(' class="ui-li-has-icon '+e.ui.consts.menu_icon+'"');c.push(">");c.push('<fieldset class="ui-grid-a"><div class="ui-block-a">');c.push(b.smobile.ui.menuItem(d.title,d.description,d.icon));c.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="b" data-icon="delete" id="'+
d.id+'_remove" data-inline="false">'+e.locale().applicationmanager.uninstall+"</button></div></fieldset>");c.push("</li>")}),c.push("</ul>"),c.push("</div>");d({html:c.join(""),bind:" "})};b.sdata.getInstalledApps(!0,function(d){b.sdata.applicationList({success:function(j){j=j||[];j=i(j,d);if(j.length)c.push('<div data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" data-collapsed="false">'),c.push("<h2>"+e.locale().applicationmanager.available_apps+
"</h2>"),c.push('<ul id="'+f.id+'_install" data-split-icon="plus" data-role="listview"'),c.push(' data-inset="false"'),c.push(">"),j.forEach(function(a){a.id=b.helpers.uuid();c.push('<li data-role="fieldcontain"');c.push(' class="ui-li-has-icon '+e.ui.consts.menu_icon+'"');c.push(">");c.push('<fieldset class="ui-grid-a"><div class="ui-block-a">');c.push(b.smobile.ui.menuItem(a.title,a.description,a.icon));c.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="e" data-icon="plus" id="'+
a.id+'_install" data-inline="false">'+e.locale().applicationmanager.install+"</button></div></fieldset>");a.datasets.length&&a.datasets.forEach(function(a){a.$name=b.helpers.uuid();c.push('<input  data-mini="true" type="checkbox" checked="'+(a.selected?"true":"false")+'" name="'+a.$name+'" id="'+a.$name+'" class="custom" />');c.push('<label for="'+a.$name+'">'+a.description+"</label>")});c.push("</li>")}),c.push("</ul></div>"),c.push("</div>"),a.data.install={},j.map(function(b){a.data.install[b.id]=
b});h(d)}})})},events:function(){var e=this;e.data.install&&Object.keys(e.data.install).forEach(function(d){var a=e.data.install[d];a&&a.datasets&&a.datasets.length&&a.datasets.forEach(function(a){if(a.$name){var d=b("#"+a.$name);d&&d.length&&d.change(function(){a.selected=null==a.selected?!1:!a.selected})}});(d=b("#"+a.id+"_install"))&&d.length&&d.click(function(){if(!e.disabled){var c=a.id;e.disabled=!0;e.installApplication({success:function(){e.disabled=!1;b.smobile.goHome(e)},fail:function(){e.disabled=
!1}},e.data.install[c])}})});e.data.remove&&Object.keys(e.data.remove).forEach(function(d){var a=e.data.remove[d];(d=b("#"+a.id+"_remove"))&&d.length&&d.click(function(){e.disabled||e.removeApplication({success:function(){e.disabled=!1;b.smobile.goHome(e)},fail:function(){e.disabled=!1}},a.id,e.data.remove)})})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.ErrorView={handler:function(e,d){var a=[],c=b.helpers.lastErrors();c&&(a.push('<ul id="'+e.id+'" data-role="listview"'),a.push(' data-inset="true"'),a.push(">"),c.forEach(function(c){a.push("<li");var d=[];d.push("ui-li-has-icon");d.length&&a.push(' class="'+d.join(" ")+'"');a.push(">");a.push(b.helpers.FUNCS.TITLE_LW(c.title)+b.helpers.FUNCS.ERROR(c.data.message)+b.helpers.FUNCS.INFO(c.data.solution));a.push("</li>")}),a.push("</ul>"));this.hasErrorView=
!0;d({html:a.join("")})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Edit={_nativeToString:function(e,d){return"number"==d?(e||0)+"":"date"==d?!e?"":b.scroller.formatDate(b.helpers.dateSettings.dateFormat,e):"datetime"==d?!e?"":b.scroller.formatDate(b.helpers.dateSettings.dateFormat+"  "+b.helpers.dateSettings.timeFormat,e):"time"==d?e.format():e||""},_getvalue:function(f,d){var a=null;if("date"==f.type)if(a=d.getValue(f.bind,null,null),null!=a)try{a=Date.parseISO8601(a)}catch(c){a=new Date}else f.$isMandatory&&
d.config.inCreate&&(a=new Date);else if("time"==f.type){a=d.getValue(f.bind,null,0);try{a=b.helpers.Time.parse(a)}catch(i){a=new b.helpers.Time(0)}}else if("datetime"==f.type)if(a=d.getValue(f.bind,null,0),null!=a)try{a=Date.parseISO8601(a)}catch(h){a=new Date}else f.$isMandatory&&d.config.inCreate&&(a=new Date);else a="number"==f.type?d.getValue(f.bind,null,0):d.getValue(f.bind,null,"");return e.controls.Edit._nativeToString(a,f.type)},createEdit:function(f,d){var a=d.data,c=['<div data-role="fieldcontain" id="'+
d.id+'">'];c.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');c.push('<label class="ui-input-text" for="'+d.id+'_i">'+b.helpers.htmlEncode(a.label)+(a.$isMandatory?"*":"")+"</label>");c.push("<input ");var i=a.type||"text";if("date"==i||"time"==i||"datetime"==i)i="text";c.push('type="'+i+'" name="'+d.id+'" id="'+d.id+'_i" ');a.$isReadOnly&&c.push('readonly="true" ');c.push('value="');i=e.controls.Edit._getvalue(a,f);c.push(b.helpers.htmlEncode(i));c.push('"');
a.$pattern&&c.push(' pattern="'+a.$pattern+'"');a.$minimum&&c.push(' min="'+a.$minimum+'"');a.$maximum&&c.push(' max="'+a.$maximum+'"');a.$maxLength&&c.push(' maxlength="'+a.$maxLength+'"');a.$isMandatory&&c.push(' required="required"');c.push("/>");c.push("</div>");return{html:c.join(""),bind:a.bind,options:a}},refresh:function(f,d,a,c){b("#"+c+"_i").val(e.controls.Edit._getvalue(d,f))},handler:function(b,d){return d(e.controls.Edit.createEdit(this,b))},checkValue:function(f,d){var a=f.find("#"+
d.id+"_i"),c=f.find("#"+d.id+"_error");c.html("");var i=d.options;i.$isMandatory&&""===a[0].value?(a={field:f,message:b.helpers.format(e.locale().ui.mandatory_field,[i.label])},this.pushError(a),c.html(a.message)):i.$minLength&&a[0].value.length<i.$minLength&&(a={field:f,message:b.helpers.format(e.locale().ui.minlength_field,[i.label])},this.pushError(a),c.html(a.message))},_checkDateTime:function(e,d){var a=b("#"+e.id+"_i"),c,i,h,g=d.afterChangeHnd(e);if("date"==e.options.type){c=a.val();if(!c)return d.checkChange(e.id,
c,g);try{c=b.scroller.parseDate(b.helpers.dateSettings.dateFormat,c)}catch(j){c=new Date}c=c.toISOString();i=d.getValue(e.bind,null,"");h=b.helpers.date.checkString(c,i);if(c!=h){var m=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,b.helpers.date.isoToDate(c));a.val(m)}i!=h&&d.checkChange(e.id,h,g)}else if("time"==e.options.type){c=a.val();i=d.getValue(e.bind,null,"");c||(c=b.helpers.Time.parse(i).format());try{c=b.helpers.Time.parseTime(c)}catch(l){c=b.helpers.Time.parse("00:00")}a.val(c.format());
c=c.toISO();c!=i&&d.checkChange(e.id,c,g)}else if("datetime"==e.options.type){c=a.val();if(!c)return d.checkChange(e.id,c,g);try{c=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,c)}catch(k){c=new Date}c=c.toISOString();i=d.getValue(e.bind,null,"");m=b.scroller.formatDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,b.helpers.date.isoToDate(c));a.val(m);i!=c&&d.checkChange(e.id,c,g)}},events:function(b,d){var a=this,c=b.find("#"+
d.id+"_i");"date"==d.options.type?c.scroller({preset:"date"}):"datetime"==d.options.type?c.scroller({preset:"datetime"}):"time"==d.options.type&&c.scroller({preset:"time"});c.blur(function(){var b=a.afterChangeHnd(d),f,g;if(d.bind)"number"==d.options.type?(f=a.getValue(d.bind,null,0),g=parseFloat(c[0].value),isNaN(g)&&(g=f),f=d.options.decimals,null==d.options.decimals&&d.options.bindDecimals&&(f=a.getValue(d.options.bindDecimals,null,0)),null!=f&&(g=parseFloat(g.toFixed(f))),c[0].value=g,a.checkChange(d.id,
g,b)):"datetime"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,a)},0):"time"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,a)},0):"date"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,a)},0):a.checkChange(d.id,c.val(),b)})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Picture={_setPhoto:function(e,d,a,c){var i=d.find("#"+a.id+"_image"),h=d.find("#"+a.id+"_cont"),d=e.getPageData(),d=b.proto.getProto(d,a.options.bind);if(!d)return g();var g=function(){h.addClass("s-m-noimage");i.addClass("s-m-hidden");i[0].src=""},j=function(){h.removeClass("s-m-noimage");i.removeClass("s-m-hidden")},c=c||(e?e.getValue(a.options.bind,null,null):null);null==c?g():(a=c.$url,!a&&d.$url&&(a=b.proto.parseExpression(d.$url,
{data:e.exprData(),$prototype:d},"$url")),c.$value?(i[0].src="data:"+(c.$contentType||"image/jpeg")+";base64,"+c.$value,j()):a?(b.proto.isExpression(a)&&(a=b.proto.parseExpression(a,{data:e.exprData(),$prototype:d},"$url")),i[0].src=a,j()):g())},createPicture:function(f,d){var a=d.data,c=[];c.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');a.label&&c.push(b.helpers.htmlEncode(a.label));c.push('<div id="'+d.id+'">');c.push('<div id="'+d.id+'_cont" class="ui-body s-m-image-container s-m-noimage" >');
c.push('<input id="'+d.id+'_input" class="s-hidden-file" accept="image/*" type="file" data-role="none" data-ajax="false" name="'+d.id+'_input"/>');c.push('<center><img class="s-m-image s-m-hidden" id="'+d.id+'_image" src="');c.push('"/></center>');c.push("</div>");c.push('<a id="'+d.id+'_file" data-role="button" data-mini="true" data-icon="file" data-inline="true">'+e.locale().ui.picture_file+"</a>");c.push('<a id="'+d.id+'_photo"  data-role="button" data-mini="true" data-icon="photo" data-inline="true">'+
e.locale().ui.picture_photo+"</a>");c.push("</div>");return{html:c.join(""),bind:a.bind,options:a}},handler:function(b,d){return d(e.controls.Picture.createPicture(this,d))},checkValue:function(f,d){var a=b("#"+d.id+"_error");a.html("");if(d.options.$isMandatory&&!this.getValue(d.options.bind,null,null)){var c={field:f,message:b.helpers.format(e.locale().ui.mandatory_field,[d.options.label])};this.pushError(c);a.html(c.message)}},events:function(b,d){var a=this,c=b.find("#"+d.id+"_file"),i=b.find("#"+
d.id+"_input");b.find("#"+d.id+"_photo").bind("click",function(){navigator.camera&&navigator.camera.getPicture?navigator.camera.getPicture(function(c){var g={$type:"image",$value:c,$fileName:"picture.jpeg",$contentType:"image/jpeg"};a.setData(d.options.bind,c);e.controls.Photo._setPhoto(a,b,d,g)},function(){},{quality:50}):alert(e.locale().ui.picture_nocamera)});c.bind("click",function(){b.find("#"+d.id+"_input").click()});i.bind("change",function(c){if(window.File&&window.FileReader&&window.FileList&&
window.Blob){var g=c.target.files,c={};if(g&&g.length&&(g=g[0],g.type.match("image.*"))){c.$contentType=g.type;c.$fileName=g.name;c.$type="image";var i=new FileReader;i.onload=function(c,g){return function(c){var h=c.target.result.indexOf("base64,");g.$value=0<h?c.target.result.substring(h+7):c.target.result;delete g.$url;e.controls.Picture._setPhoto(a,b,d,g);a.setData(d.options.bind,g);a.notifyChange()}}(g,c);i.readAsDataURL(g)}}});e.controls.Picture._setPhoto(a,b,d)}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};var f=e.controls;f.types=f.types||{};f.types.addReference=function(d,a,c){var e={},f=a,d=d.$item||d;a&&Array.isArray(a)&&(f=a[a.length-1]);if(b.proto.useUuid(d)&&!f)return e.value="",e;e.value=f&&f.hasOwnProperty("$value")?f.$value:d.$value?b.proto.parseExpression(d.$value,{data:c.exprData(a),$prototype:d},"$value"):b.proto.parseExpression(d.$key,{data:c.exprData(a),$prototype:d},"$key");if(d.$links&&d.$links.$details&&(d=b.proto.parseExpression(d.$links.$details.$url,
{data:c.exprData(a),$prototype:d},"$url"),(a=b.sdata.parseSdataUri(d))&&a.query&&a.query.representation&&b.sdata.config.pages[a.query.representation]))e.url=d;return e};f.types._table_header=function(d,a,c,e){d.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"');d.push(">");d.push("<thead><tr>");var f=c.$properties,g=!0;a.forEach(function(a,e){f[a].$isHidden||(g?(g=!1,d.push('<th data-priority="persist">')):d.push('<th data-priority="'+e+'">'),d.push(b.helpers.htmlEncode(b.proto.parseExpression(f[a].$title,
{data:null,$prototype:c},"$title"))),d.push("</th>"))});e&&(d.push('<th data-priority="'+a.length+'"></th>'),d.push('<th data-priority="'+a.length+1+'"></th>'));d.push("</tr></thead>");d.push("<tbody>")};f.types._table_row=function(b,a,c,i,h,g,j){b.push("<tr>");var m=c.$properties,l=!0;a.forEach(function(a){var c=m[a];c.$isHidden||(l?b.push("<th>"):b.push("<td>"),"application/x-reference"===c.$type?(a=f.types.addReference(c,[i,i[a]],h),e._addLink(b,a,h)):b.push(i[a]),l?(b.push("</th>"),l=!1):b.push("</td>"))});
g&&(b.push("<td>"),b.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" data-index="'+j+'" data-action="edit" data-mini="true" data-icon="edit"'),b.push(">"+e.locale().ui.edit_item+"</a>"),b.push("</td>"),b.push("<td>"),b.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" " data-index="'+j+'" data-action="delete" data-mini="true"data-icon="delete"'),b.push(">"+e.locale().ui.remove_item+"</a>"),b.push("</td>"));b.push("</tr>")};f.types._table_end=
function(b){b.push("</tbody>");b.push("</table>")};f.types._cards=function(d,a,c,i,h,g,j){d.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"');d.push(">");d.push("<thead><tr>");d.push('<th data-priority="1"></th>');d.push('<th data-priority="persist"></th>');d.push("</tr></thead>");d.push("<tbody>");var m=c.$properties;a.forEach(function(a){var g=m[a.$bind];d.push("<tr>");d.push("<th>");d.push(b.helpers.htmlEncode(b.proto.parseExpression(g.$title,{data:null,$prototype:c},
"$title")));d.push("</th><td>");"application/x-reference"===g.$type?(a=f.types.addReference(g,i[a.$bind],h),e._addLink(d,a,h)):(a.$type=g.$type,d.push(b.proto.htmlValue(i,c,g,a)));d.push("</td>");d.push("</tr>")});g&&(d.push("<tr>"),d.push("<td>"),d.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" data-index="'+j+'" data-action="edit" data-mini="true" data-icon="edit"'),d.push(">"+e.locale().ui.edit_item+"</a>"),d.push("</td>"),d.push("<td>"),d.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" " data-index="'+
j+'" data-action="delete" data-mini="true"data-icon="delete"'),d.push(">"+e.locale().ui.remove_item+"</a>"),d.push("</td>"),d.push("</tr>"));d.push("</tbody>");d.push("</table>")};f.ArrayField={handler:function(d,a){var c=this,i=[],h=d.data||{},g=h.field;if(!c.getPageData())return a({html:"",options:{}});var j="$edit"===h.facet||"$create"===h.facet,m=g.$proto.$rtype,l=g.$proto.$protoparent,k=c.getValue(g.$bind,null,"application/x-reference"===m?null:[]),o=g.$proto.$item||g.$proto;if(j){var h={id:d.id+
"_"+g.$bind,data:{inline:!1,bind:g.$bind}},j=h.data,n;switch(m){case "application/x-reference":j.type="text";j.label=b.proto.parseExpression(l.$title,{data:null,$prototype:o},"$title");h.id=d.id+"_"+g.$bind;if(o.$links&&o.$links.$lookup&&o.$links.$lookup.$url)j.$lookupurl=b.proto.parseExpression(o.$links.$lookup.$url,{data:c.exprData(k),$prototype:o},"$url"),j.$lookupurl=j.$lookupurl+"&control="+b.helpers.encodeURIComponent(h.id);if(o.$isMandatory)j.$isMandatory=!0;n=e.controls.Lookup.createLookup(c,
h);n.id=h.id;n.uiClass="Lookup";n.scid="_"+g.$bind;break;case "application/x-array":switch(g.$proto.$type){case "application/x-reference":j.title=b.proto.parseExpression(l.$title,{data:null,$prototype:o},"$title");j.jmdata=b.proto.jqmDataArray();h.id=d.id+"_"+g.$bind;if(o.$links&&o.$links.$lookup&&o.$links.$lookup.$url)j.$lookupurl=b.proto.parseExpression(o.$links.$lookup.$url,{data:c.exprData(k),$prototype:o},"$url"),j.$lookupurl=j.$lookupurl+"&control="+b.helpers.encodeURIComponent(h.id);n=e.controls.ArrayRef.createArrayRef(c,
h,k);n.id=h.id;n.uiClass="ArrayRef";n.scid="_"+g.$bind;break;case "application/x-object":case "application/json":j.title=b.proto.execExpression(g.$title,g.$proto.$item||g.$proto);j.jmdata=b.proto.jqmDataArray();j.cards=g.cards;j.items=g.items;h.id=d.id+"_"+g.$bind;n=e.controls.ArrayObjectRef.createArrayObjectRef(c,h,k);n.id=h.id;n.uiClass="ArrayObjectRef";n.scid="_"+g.$bind;break;case "application/x-choice":var p={};o.$value.$enum.forEach(function(a){p[a.$value+""]=a.$title});k.forEach(function(a){i.push("<li>"+
b.helpers.htmlEncode(p[a+""])+"</li>")});break;default:k.forEach(function(a){i.push("<li>"+a||"</li>")})}}return n?a([n]):a(null)}i.push('<ul id="'+d.id+'" data-role="listview"');b.helpers.addJqmData(h,i);i.push(">");n="";switch(m){case "application/x-reference":(n=b.helpers.htmlEncode(b.helpers.htmlEncode(b.proto.execExpression(l.$title,l))))&&i.push('<li data-role="list-divider">'+n+"</li>");h=f.types.addReference(g.$proto,k,c);i.push("<li>");e._addLink(i,h,c);i.push("</li>");break;case "application/x-array":if((n=
b.helpers.htmlEncode(b.helpers.htmlEncode(b.proto.execExpression(g.$title,g.$proto.$item||g.$proto))))&&i.push('<li data-role="list-divider">'+n+"</li>"),k)switch(g.$proto.$type){case "application/x-reference":k.length&&k.forEach(function(a){a=f.types.addReference(g.$proto.$item||g.$proto,a,c);i.push("<li>");e._addLink(i,a,c);i.push("</li>")});break;case "application/x-object":case "application/json":g.cards?k.forEach(function(a,b){i.push("<li>");g.items&&f.types._cards(i,g.items,g.$proto,a,c,!1,
b);i.push("</li>")}):g.items&&(i.push("<li>"),i.push('<div class="ui-body">'),f.types._table_header(i,g.items,g.$proto),k.forEach(function(a,b){f.types._table_row(i,g.items,g.$proto,a,c,!1,b)}),f.types._table_end(i),i.push("</div>"),i.push("</li>"));break;case "application/x-choice":p={};o.$value.$enum.forEach(function(a){p[a.$value+""]=a.$title});k.forEach(function(a){i.push("<li>"+b.helpers.htmlEncode(p[a+""])+"</li>")});break;default:k.forEach(function(a){i.push("<li>"+a||"</li>")})}}i.push("</ul>");
return a({html:i.join(""),bind:h.bind,options:h})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Button={_typedButtons:{dialog_cancel:{jmdata:{"data-icon":"refresh","data-iconpos":"left"},defaults:{action:"dialog_cancel"}},dialog_ok:{jmdata:{"data-icon":"check","data-iconpos":"left"},defaults:{action:"dialog_ok"}},cancel:{jmdata:{"data-icon":"refresh","data-iconpos":"top"},defaults:{action:"cancel"}},action:{jmdata:{"data-icon":"gear","data-iconpos":"top"},defaults:{action:""}},add:{jmdata:{"data-iconpos":"top","data-icon":"add"}},
back:{jmdata:{"data-icon":"arrow-l"},defaults:{action:"back"}},save:{jmdata:{"data-iconpos":"top","data-icon":"check"},defaults:{action:"save"}},"delete":{jmdata:{"data-iconpos":"top","data-icon":"delete"},defaults:{action:"delete"}}},_stdActions:{dialog_cancel:function(){this.$page.dialog("close")},dialog_ok:function(){if(!this.checkData())return!1;var b=this.data,d=this.pageActions?this.pageActions.success:null;this.$page.dialog("close");d&&d(b)}},handler:function(f,d){var a=f.data||{},c={};a.controlId=
f.id;if(a.type){var i=e.controls.Button._typedButtons[a.type];i&&(b.extend(c,i.jmdata),i.defaults&&Object.keys(i.defaults).forEach(function(b){null==a[b]&&(a[b]=i.defaults[b])}))}a.jmdata&&b.extend(c,a.jmdata);b.extend(c,{"data-role":"button"});a.jmdata=c;return d({html:"",action:a.action,options:a})},events:function(f,d){var a=this;f.click(function(c){if(d&&d.action){if(d.options.disabled)return;d.options.disabled=!0;if(e.controls.Button._stdActions[d.action])e.controls.Button._stdActions[d.action].call(a);
else return c=a["action"+d.action],setTimeout(function(){d.options.disabled=!1},500),c.call(a,{success:function(){b.smobile.doBack(a)}});d.options.disabled=!1}c.preventDefault()})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.CheckBox={createCheckBox:function(e,d){var a=d.data||{},c=['<div data-role="fieldcontain" id="'+d.id+'">'];c.push('<input type="checkbox" name="'+d.id+'_i" id="'+d.id+'_i" ');var i=a.value||!1;a.bind&&(i=e.getValue(a.bind,null,!1));i&&c.push("checked");c.push("/>");c.push('<label for="'+d.id+'_i">'+b.helpers.htmlEncode(a.label)+"</label>");c.push("</div>");return{html:c.join(""),bind:a.bind,action:a.action,options:a}},handler:function(b,
d){return d(e.controls.CheckBox.createCheckBox(this,b))},events:function(b,d){var a=this,c=b.find("#"+d.id+"_i");c.change(function(){var b=a.afterChangeHnd(d);a.checkChange(d.id,c[0].checked,b)})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.List={handler:function(f,d){var a=this,c=[],i=f.data||[];c.push('<ul id="'+f.id+'" data-role="listview"');c.push(' data-inset="true"');c.push(">");(i.items||[]).forEach(function(d){d=d.data;c.push("<li");b.helpers.addJqmData(d,c);if(d.divider)c.push(' data-role="list-divider"'),c.push(">"),c.push(d.title);else{if(d.icon||d.menu)c.push(' class="'+(d.menu?e.ui.consts.menu_icon:e.ui.consts.normal_icon)+'"'),d.css=[d.menu?e.ui.consts.menu_icon:
e.ui.consts.normal_icon];c.push(">");var f="";d.menu&&(f=b.smobile.ui.menuItem(d.title,d.description,d.icon));d.url=e.ui.sdata_link(null,d);e._addLink(c,d,a,function(){c.push(f)})}c.push("</li>")});c.push("</ul>");return d({html:c.join(""),bind:i.bind,options:i})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.MultiField={handler:function(f,d){var a=this,c=f.data||{},i="$edit"===c.facet||"$create"===c.facet,h=a.getPageData();if(!h)return d({html:"",options:{}});if(i){var g=[];c.fields.forEach(function(c){var d=b.proto.getProto(h,c.$bind),i=null,j=c.$type,m={id:f.id+"_"+c.$bind,data:{inline:!1,bind:c.$bind}},r=m.data,u=a.getProtoDataValue(c.$bind,null,null);u&&(d=b.extend({},d,u));if(d.$isReadOnly)r.$isReadOnly=!0;u=b.proto.execExpression(d.$title,
d);switch(j){case "application/x-string":case "application/x-password":r.type="text";r.label=u;m.id=f.id+"_"+c.$bind;r.$minLength=d.$minLength;r.$maxLength=d.$maxLength;if("$email"==d.$format)r.type="email";else if("$url"==d.$format)r.type="url";else if("$phone"==d.$format)r.type="tel";if("application/x-password"===j)r.type="password";if(d.$isMandatory)r.$isMandatory=!0;i=e.controls.Edit.createEdit(a,m);i.id=m.id;i.uiClass="Edit";i.scid="_"+c.$bind;break;case "application/x-choice":var q=[];r.items=
q;r.$isMandatory=!0;d.$value.$enum.forEach(function(a){q.push({value:a.$value,title:a.$title})});r.label=u;m.id=f.id+"_"+c.$bind;i=e.controls.Combo.createCombo(a,m);i.id=m.id;i.uiClass="Combo";i.scid="_"+c.$bind;break;case "application/x-integer":case "application/x-real":case "application/x-decimal":r.type="number";r.decimals=0;if(null!=d.$scale)r.decimals=d.$scale;r.label=u;r.$minimum=d.$minimum;r.$maximum=d.$maximum;if(null!=d.$minimum&&null!=d.$maximum&&"application/x-integer"===j)r.type="range";
r.$isMandatory=!0;m.id=f.id+"_"+c.$bind;i=e.controls.Edit.createEdit(a,m);i.id=m.id;i.uiClass="Edit";i.scid="_"+c.$bind;break;case "application/x-boolean":r.label=u;m.id=f.id+"_"+c.$bind;i=e.controls.CheckBox.createCheckBox(a,m);i.id=m.id;i.uiClass="CheckBox";i.scid="_"+c.$bind;break;case "image":r.label=u;m.id=f.id+"_"+c.$bind;i=e.controls.Picture.createPicture(a,m);i.id=m.id;i.uiClass="Picture";i.scid="_"+c.$bind;break;case "application/x-date":r.type="date";r.label=u;r.$isMandatory=d.$isMandatory;
m.id=f.id+"_"+c.$bind;i=e.controls.Edit.createEdit(a,m);i.id=m.id;i.uiClass="Edit";i.scid="_"+c.$bind;break;case "application/x-time":r.type="time";r.label=u;r.$isMandatory=d.$isMandatory;m.id=f.id+"_"+c.$bind;i=e.controls.Edit.createEdit(a,m);i.id=m.id;i.uiClass="Edit";i.scid="_"+c.$bind;break;case "application/x-datetime":r.type="datetime",r.label=u,r.$isMandatory=d.$isMandatory,m.id=f.id+"_"+c.$bind,i=e.controls.Edit.createEdit(a,m),i.id=m.id,i.uiClass="Edit",i.scid="_"+c.$bind}i&&g.push(i)});
return g.length?d(g):d(null)}var j=[];j.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"><tbody>');j.push("<thead><tr>");j.push('<th data-priority="1"></th>');j.push('<th data-priority="persist"></th>');j.push("</tr></thead><tbody>");var m=b.proto.getProto(h);c.fields.forEach(function(c){var d=b.proto.getProto(h,c.$bind);j.push("<tr><td>");j.push("<strong>"+b.helpers.htmlEncode(b.proto.execExpression(d.$title,d))+"</strong>");j.push("</td><td>");j.push(b.proto.htmlValue(a.data,
m,d,c));j.push("</td><tr>")});j.push("</tbody></table>");return d({html:j.join(""),bind:c.bind,options:c})}}})(jQuery);(function(b){var e={};(b.smobile||{}).staticui=e;e.start=function(){var e=b.smobile.locale();return{$title:e.administration.title,content:{title:{uiClass:"Html",data:{html:"<div><center><h4>"+e.administration.welcome+"</h4></center></div>"}},menu:{uiClass:"MainMenu",data:{items:[]}}}}};e.about=function(){var e=b.smobile.locale();return{$title:e.administration.title,content:{title:{uiClass:"Html",data:{html:e.about}}}}};e.mainfooter=function(){b.smobile.locale();return{footer:{uiClass:"NavBar",data:{items:[{type:"mainmenu"},
{type:"setup"},{type:"help"}]}}}};e.appFooter=function(){return{footer:{uiClass:"NavBar",data:{items:[{type:"sync"},{type:"home"}]}}}};e.applications=function(){return{content:{apps:{uiClass:"AppsView"}}}};e.errors=function(){return{content:{title:{uiClass:"Html",data:{html:"<h1>"+b.smobile.locale().errorpagetitle+"</h1>"}},errors:{uiClass:"ErrorView"}}}};e.send=function(){return{$title:b.smobile.locale().sendpagetitle,content:{toSend:{uiClass:"SyncView"},doSync:{uiClass:"SyncCheck"},log:{uiClass:"ErrorView"}},
footer:{footer:{uiClass:"SyncFooter"}}}}})(jQuery);$(function(){var b=function(){$(window).width();var b="slide";$.mobile.defaultPageTransition="none"};b();$(window).bind("throttledresize",b);window.location.hash?($.mobile.$start=!0,$.mobile.initializePage()):setTimeout(function(){window.location.hash="#start";$.mobile.$start=!0;$.mobile.initializePage()},0)});
$(document).bind("pagebeforechange",function(b,e){if(window.location.hash){var f=!1,d;if("string"===typeof e.toPage)f=!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,d=e.toPage;else if($.mobile.$start)f=!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,d=window.location.href,e=null;if(!f&&e&&e.toPage.length&&"page-template"==e.toPage[0].id)e=null,d=window.location.href,f=!0;if(f){var a=$.mobile.path.parseUrl(d),c=$.smobile.pageName(a.hash);if(c){var i=$.mobile.activePage,h=!1,g=c.domid?
$("#"+c.domid):!1;if(g&&g.length){var f=$.smobile.pageController($(g[0])),j={transition:"none"};if($.sdata.config){b.preventDefault();if(f&&(h=c.page.isHome,f.needRefresh))f.needRefresh=!1,f.child&&f.doRefresh();var m=g.find(".s-m-notify-sync");if(m&&m.length)return $.sdata.getSyncCount({success:function(a){m.html(""+a);a?m.hasClass("s-m-hidden")&&m.removeClass("s-m-hidden"):m.hasClass("s-m-hidden")||m.addClass("s-m-hidden");$.mobile.changePage(g,j);h&&$.smobile.removeAllPages([g[0].id],!0)}});$.mobile.changePage(g,
j);h&&$.smobile.removeAllPages([g[0].id],!0)}else b.preventDefault(),$.mobile.changePage(g,j),$.smobile.removeAllPages([g[0].id],!0)}else{var l=e?e.options:{};l.allowSamePageTransition=!0;l.showLoadMsg=!0;$.mobile.loading("show",{theme:"a",text:$.smobile.locale().ui.loading});$.smobile.startDate=new Date;b.preventDefault();$.smobile.loadPage(a.hash,c,function(b,d,f){d?($.sdata.startLoad(),$.smobile.parseURL(a,c,function(a,f,g,h){if(h&&h.stop)$.sdata.endLoad();else{if(g&&($.sdata.endLoad(),$.mobile.loading("hide"),
c.page.id!=$.smobile.PAGES.errors.id)){if($.helpers.hasErrors())$.smobile.showErrors();else if(f&&$.smobile.showError(l,f||""),a)window.location.href=a;return}l.dataUrl=a;var a=$.smobile.createPage(c),j=a.$page;$.smobile.buildPage(b,i,j,d,f,h,c,a.$template,function(){var a=$.jqmData(j[0],"controller");if($.helpers.hasErrors()&&($.sdata.endLoad(),a&&!a.hasErrorView))return a.remove(),j.remove(),$.smobile.showErrors();!a.pageOptions.dialog&&l.dataUrl&&j.attr("data-url",$.smobile.hashOfUrl(l.dataUrl));
var b=e?e.options:{};if(null!=a.pageOptions.changeHash)b.changeHash=a.pageOptions.changeHash;$.mobile.changePage(j,b);a.bindData();$.sdata.endLoad()})}})):($.mobile.loading("hide"),c.page.id!=$.smobile.PAGES.errors.id&&($.helpers.hasErrors()?$.smobile.showErrors():f&&"object"===typeof f&&f.action?$.smobile.silentAction(f):$.smobile.showError(l,f||"")))})}}else if(f=$.smobile.actionName(a.hash))b.preventDefault(),$.smobile.execAction(a.hash,f,function(a){a&&$.smobile.refreshPage()})}}else b.preventDefault()});
$(document).bind("pagehide",function(b,e){if(window.location.hash&&b.target!=e.nextPage[0]){var f=$.jqmData(b.target,"controller"),d=$.jqmData(e.nextPage[0],"controller");if(f&&f.pageInfo&&f.pageInfo.page.cache)console.log("cache current page: this page can be cached");else{var a=$.smobile.pageIsDialog(e.nextPage);(a?0:$.smobile.pageIsDetail(e.nextPage))||a?d.child===f?$.smobile.removePage(b.target):console.log("cache current page: next page is  detail/dialog"):f&&(!f||!f.config||!(f.config.ui&&0<
f.config.ui.indexOf(".$query")))&&$.smobile.removePage(b.target)}}});(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.SDataList={refresh:function(b,d,a){var c=[];e.controls.SDataList.createItems(b,d,c);a.html(c.join("")).listview("refresh")},createItems:function(f,d,a){var c=f.getPageData(),i=b.proto.getProto(c),h=b.proto.getArticle(c,d.bind);f.getCurrentData();var g={icon:{},hint:{},title:{propName:"$value"},description:{propName:"$description"}},j=[];h?(b.proto.layoutParser({},h,"$article",[i],j),i=b.proto.getProto(c,d.bind),j.forEach(function(a){switch(a.$mobile){case "icon":g.icon.propName=
a.$bind;break;case "hint":g.hint.propName=a.$bind;break;case "title":g.title.propName=a.$bind;break;case "description":g.description.propName=a.$bind}})):i=b.proto.getProto(c,d.bind);Object.keys(g).forEach(function(a){a=g[a];if(a.propName)if(0==a.propName.indexOf("$")){if(a.expression=i[a.propName],a.expression)a.protoValue=!0}else a.expression=a.propName});var m=null;if(i.$links&&i.$links.$details)m=i.$links.$details.$url,i.$links.$details.$isHidden&&(m="");f.getValue(d.bind,null,[]).forEach(function(c,
h){var j={},n=g.description.protoValue?c[g.description.propName]:null,p=g.title.protoValue?c[g.title.propName]:null,r=g.icon.protoValue?c[g.icon.propName]:null,u=g.hint.protoValue?c[g.hint.propName]:null,n=null==n&&g.description.expression?b.proto.parseExpression(g.description.expression,{data:f.exprData(c),$prototype:i},g.description.propName):"",p=null==p&&g.title.expression?b.proto.parseExpression(g.title.expression,{data:f.exprData(c),$prototype:i},g.title.propName):"",r=null==r&&g.icon.expression?
b.proto.parseExpression(g.icon.expression,{data:f.exprData(c),$prototype:i},g.icon.propName):"",u=null==u&&g.hint.expression?b.proto.parseExpression(g.hint.expression,{data:f.exprData(c),$prototype:i},g.hint.propName):"";if(g.icon.expression&&(r&&"object"!=typeof r&&(r=null),r))if("image"===r.$type){var q=r.$url;if(!q&&!r.$value&&g.icon.propName&&i.$properties&&i.$properties[g.icon.propName])q=i.$properties[g.icon.propName].$url;r=q?b.proto.parseExpression(q,{data:f.exprData(c),$prototype:i},"$url"):
r.$value?"data:"+(r.$contentType||"image/jpeg")+";base64,"+r.$value:null}else r=null;var s=b.smobile.ui.sdataentry(p,n,g.icon.expression,r,g.hint.expression,u);a.push("<li");b.helpers.addJqmData(j,a);if(g.icon.expression)a.push(' class="'+e.ui.consts.normal_icon+'"'),j.css=[e.ui.consts.normal_icon];a.push(">");if(m)j.url=b.proto.parseExpression(m,{data:f.exprData(c),$prototype:i},"$url");if(d.$lookup)j.action="validate",j.actionParams=h+"";e._addLink(a,j,f,function(){a.push(s)})})},handler:function(f,
d){var a=[],c=f.data||{},i=this.getPageData();if(!i)return d({html:"",options:{}});var h=b.proto.getProto(i);b.proto.getArticle(i,c.bind);if(!h)return d({html:"",options:{}});a.push('<ul id="'+f.id+'" data-role="listview" data-filter="true"');b.helpers.addJqmData(c,a);a.push(">");e.controls.SDataList.createItems(this,c,a);a.push("</ul>");return d({html:a.join(""),bind:c.bind,options:c})},events:function(f,d){var a=this;d.options.$lookup&&f.click(function(c){c.preventDefault();if(c&&c.target){for(c=
c.target;c&&c.tagName&&"A"!=c.tagName.toUpperCase();)c=c.parentNode;if(!c)return;c=b(c).attr("data-action");if(""!=c&&(c=parseInt(c,10),a.getCurrentData()&&(c=a.getCurrentData().$resources[c],a.parent&&a.config&&a.config.url&&a.config.url.query&&a.config.url.query.control))){var d=a.parent.controls[a.config.url.query.control];if(d){var f=e.controls[d.uiClass];if(f.setValue)return f.setValue(a.parent,d,c,e.doBack)}}}e.doBack()});f.on("listviewbeforefilter",function(a,d){b(this);b(d.input).val();a.preventDefault()})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.NavBar={_typedItems:{sync:function(b){b.title=e.locale().ui.sync_item;b.hash=e.PAGES.send.id;b.icon="arrow-u"},help:function(b){b.title=e.locale().maintoolbar.help;b.hash=e.PAGES.about.id;b.icon="info"},next:function(b){b.title=e.locale().maintoolbar.next;b.icon="arrow-r";b.action="next"},previous:function(b){b.title=e.locale().maintoolbar.previous;b.icon="arrow-l";b.action="previous"},home:function(f){f.title=e.locale().maintoolbar.home;
f.hash=b.smobile.PAGES.home.id;f.icon="home"},setup:function(f){f.title=e.locale().maintoolbar.setup;f.hash=b.smobile.PAGES.apps.id;f.icon="plus"},mainmenu:function(f){f.title=e.locale().maintoolbar.home;f.hash=b.smobile.PAGES.start.id;f.icon="home"}},refresh:function(b,d,a){var d=d.actions||[],c=b.getCurrentData();d.forEach(function(b){var d=a.find("#"+b.id),b=b.action;"previous"===b?!c.$links||!c.$links.$previous?d.addClass("ui-disabled"):d.removeClass("ui-disabled"):"next"===b&&(!c.$links||!c.$links.$next?
d.addClass("ui-disabled"):d.removeClass("ui-disabled"))})},_handler:function(f,d,a,c){var i=d.data,h=i.items||[],g=['<div data-role="navbar" id="'+d.id+'"'];b.helpers.addJqmData(i,g);g.push(">");g.push("<ul>");var j=[];h.forEach(function(a){a.navbar=!0;if(a.type&&e.controls.NavBar._typedItems[a.type])e.controls.NavBar._typedItems[a.type](a);if(a.icon)a.jmdata=a.jmdata||{},a.jmdata["data-icon"]=a.icon;if(a.action){var h=d.id+"_"+a.action;j.push({id:h,action:a.action});g.push('<li id="'+h+'"')}else g.push('<li style="position:relative;"');
g.push('class="');g.push('"');g.push(">");if(a.bind&&a.url)h=f.getPageData(),a.url=b.proto.parseExpression(a.url,{data:f.exprData(),$prototype:b.proto.getProto(h)},"$url");if(h=e.ui.sdata_link(null,a))a.url=h;e._addLink(g,a,f,function(){g.push(a.title)});"sync"==a.type&&(g.push('<div class="s-m-notify-sync'),c||g.push(" s-m-hidden"),g.push('" data-role="none">'),g.push(c||"0"),g.push('</div">'));g.push("</li>")});g.push("</ul>");g.push("</div>");i={html:g.join(""),action:0<j.length,options:{actions:j.length?
j:null}};return a(i)},handler:function(f,d){var a=!1,c=this;(f.data.items||[]).forEach(function(b){"sync"==b.type&&(a=!0)});a&&b.sdata.config&&b.sdata.config.id?b.sdata.getSyncCount({success:function(a){e.controls.NavBar._handler(c,f,d,a)}}):e.controls.NavBar._handler(c,f,d,0)},events:function(e,d){var a=this;if(d.options.actions){var c=a.getCurrentData();d.options.actions.forEach(function(i){var h=e.find("#"+i.id),g=i.action;"previous"===g?(!c.$links||!c.$links.$previous)&&h.addClass("ui-disabled"):
"next"===g&&(!c.$links||!c.$links.$next)&&h.addClass("ui-disabled");h.length&&h.click(function(c){if(!d.options.disabled)d.options.disabled=!0,a["action"+g].call(a,{success:function(){b.smobile.doBack(a)}}),c.preventDefault(),setTimeout(function(){d.options.disabled=!1},500)})})}}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Lookup={createLookup:function(f,d){var a=d.data||{},c=f.getPageData(),c=b.proto.getProto(c,a.bind),i=['<div data-role="fieldcontain" id="'+d.id+'">'];i.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');i.push('<label id="'+d.id+'_l" class="ui-input-text" for="'+d.id+'_i">');if(a.$lookupurl){var h={url:a.$lookupurl};e._addLink(i,h,f,function(){i.push(b.helpers.htmlEncode(a.label)+(a.$isMandatory?
"*":""))})}else i.push(b.helpers.htmlEncode(a.label)+(a.$isMandatory?"*":""));i.push("</label>");i.push("<input ");i.push('type="text" name="'+d.id+'" id="'+d.id+'_i" ');i.push('value="');var g=f.getValue(a.bind,null,null),j="";if(!b.proto.useUuid(c)||h)j=g&&g.hasOwnProperty("$value")?g.$value:c.$value?b.proto.parseExpression(c.$value,{data:f.exprData(g),$prototype:c},"$value"):b.proto.parseExpression(c.$key,{data:f.exprData(g),$prototype:c},"$key");i.push(b.helpers.htmlEncode(j||""));i.push('"');
i.push("/>");i.push("</div>");a.$lookup=1;return{html:i.join(""),bind:a.bind,action:a.action,options:a}},refresh:function(e,d,a,c){a=b("#"+c+"_i");c=e.getPageData();c=b.proto.getProto(c,d.bind);e=b.proto.parseExpression(c.$value,{data:e.exprData(e.getValue(d.bind,null,null)),$prototype:c},"$value")||"";a.val(e)},setValue:function(e,d,a,c){var i=e.getPageData(),i=b.proto.getProto(i,d.options.bind),a=b.proto.getRefFromValue(a,i),h=!0,g=h="";(g=b.proto.useUuid(i))?h=a.$key||a.$uuid:(i.noRef=!0,h=b.proto.parseExpression(i.$key,
{data:b.proto.exprData(a),$prototype:i},"$key"),delete i.noRef);var j=e.getValue(d.options.bind,null,null),g=g?j?j.$key||j.$uuid:"":b.proto.parseExpression(i.$key,{data:e.exprData(j),$prototype:i},"$key");g!=h&&(b.proto.setRef(a,i,e.exprData(),d.options.bind),e.notifyChange(),e.setNeedRefresh());return c()},handler:function(b,d){return d(e.controls.Lookup.createLookup(this,b))},events:function(b,d){var a=this,c=b.find("#"+d.id+"_i");c.blur(function(){if(d.bind){var b=a.afterChangeHnd(d);a.checkChange(d.id,
{$value:c.val()},b)}})}};e.controls.Lookup.checkValue=e.controls.Edit.checkValue})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.ArrayRef={_createItem:function(f,d,a,c,i){f.push("<li>");f.push('<a href="#">');d=e.controls.types.addReference(d,a,i);f.push(b.helpers.htmlEncode(d.value));f.push("</a>");f.push('<a href="#" ');f.push('data-action="'+c+'"');f.push(">");f.push("</a>");f.push("</li>")},refresh:function(f,d,a,c){var i=f.getValue(d.bind,null,[]),h=f.getPageData(),g=b.proto.getProto(h,d.bind),j=[];j.push('<li data-role="list-divider">'+d.title+"</li>");
i.forEach(function(a,b){e.controls.ArrayRef._createItem(j,g,a,b,f)});d=b("#"+c+"_last").detach();a.html(j.join(""));a.append(d);a.listview("refresh")},createArrayRef:function(f,d,a){null==a&&(a=f.getValue(d.data.bind,null,[]));var c=d.data||{},i=f.getPageData(),h=b.proto.getProto(i,c.bind),g=[];g.push('<ul id="'+d.id+'" data-role="listview"');g.push(' data-inset="true" data-split-icon="delete"');b.helpers.addJqmData(c,g);g.push(">");g.push('<li data-role="list-divider">'+c.title+"</li>");a.forEach(function(a,
b){e.controls.ArrayRef._createItem(g,h,a,b,f)});g.push('<li id="'+d.id+'_last">');g.push('<div class="ui-block">');g.push('<a id="'+d.id+'_new" data-role="button" data-shadow="false" data-corners="false" data-mini="true" data-theme="d" data-icon="plus" data-iconpos="left" ');g.push('href="');g.push(e.ui.urlHref(c.$lookupurl,f));g.push('">');g.push(e.locale().ui.add_item);g.push("</a>");g.push("</li>");g.push("</ul>");c.$lookup=1;return{html:g.join(""),bind:c.bind,action:c.action,options:c}},setValue:function(e,
d,a,c){b("#"+d.id+"");var i=e.getPageData(),i=b.proto.getProto(i,d.options.bind),h=b.proto.getRefFromValue(a,i),g="",j="",m=b.proto.useUuid(i);m?g=h.$key||h.$uuid:(i.noRef=!0,g=b.proto.parseExpression(i.$key,{data:b.proto.exprData(h),$prototype:i},"$key"),delete i.noRef);for(var a=e.getValue(d.options.bind,null,[]),l=a.length;l--;)if(j=a[l],j=m?j.$key||j.$uuid:b.proto.parseExpression(i.$key,{data:e.exprData(j),$prototype:i},"$key"),j===g)return c();i=b.proto.setArrayRef(h,i,e.exprData(),d.options.bind);
a.push(i);e.setData(d.options.bind,a,null);e.notifyChange();e.setNeedRefresh();return c()},handler:function(b,d){return d(e.controls.ArrayRef.createArrayRef(this,b))},events:function(e,d){var a=this;e.click(function(c){if(c&&c.target){for(c=c.target;c&&c.tagName&&"A"!=c.tagName.toUpperCase();)c=c.parentNode;if((c=b(c).attr("data-action"))&&""!=c)c=parseInt(c,10),a.getValue(d.options.bind,null,[]).splice(c,1),a.notifyChange(),b(e.children()[c+1]).remove()}})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};var f=e.controls;f.ArrayObjectRef={_renderContent:function(d,a,c,e,h,g,j){a.title&&h.push('<li data-role="list-divider">'+a.title+"</li>");h.push("<li");j&&(e=b.helpers.uuid(),h.push(' id="'+e+'"'),j.push("#"+e));h.push(">");a.cards||(h.push('<div class="ui-body">'),f.types._table_header(h,a.items,c,!0,j));g.forEach(function(b,e){a.cards?f.types._cards(h,a.items||[],c,b,d,!0,e,j):f.types._table_row(h,a.items||[],c,b,d,!0,e,j)});a.cards||(f.types._table_end(h,
!0),h.push("</div>"));h.push("</li>")},_addLast:function(b,a,c,f,h){h.push('<li id="'+f+'_last">');h.push('<div class="ui-block">');h.push('<a id="'+f+'_new" data-role="button" data-shadow="false" data-action="new" data-corners="false" data-mini="true" data-theme="d" data-icon="plus" data-iconpos="left" ');h.push('href="#">');h.push(e.locale().ui.add_item);h.push("</a>");h.push("</li>")},refresh:function(d,a,c,e){var h=d.getValue(a.bind,null,[]),g=d.getPageData(),j=b.proto.getProto(g,a.bind),g=[],
m=[];f.ArrayObjectRef._renderContent(d,a,j,e,g,h,m);d=b("#"+e+"_last").detach();c.html(g.join(""));c.append(d);m.forEach(function(a){b(a).trigger("create")});c.listview("refresh")},createArrayObjectRef:function(d,a,c){null==c&&(c=d.getValue(a.data.bind,null,[]));var e=a.data||{},h=d.getPageData(),h=b.proto.getProto(h,e.bind),g=[];g.push('<ul id="'+a.id+'" data-role="listview"');g.push(' data-inset="true" data-split-icon="delete"');b.helpers.addJqmData(e,g);g.push(">");f.ArrayObjectRef._renderContent(d,
e,h,a.id,g,c,null);f.ArrayObjectRef._addLast(d,e,h,a.id,g,c);g.push("</ul>");return{html:g.join(""),bind:e.bind,action:e.action,options:e}},setValue:function(d,a,c,e){b("#"+a.id+"");return e()},handler:function(b,a){return a(f.ArrayRef.createArrayRef(this,b))},events:function(d,a){var c=this;d.click(function(d){var f;if(d&&d.target){for(var g=d.target;g&&g.tagName&&"A"!=g.tagName.toUpperCase();)g=g.parentNode;d=b(g).attr("data-action");if("delete"===d){var d=b(g).attr("data-index"),d=parseInt(d,10),
j=c.getValue(a.options.bind,null,[]);j.splice(d,1);c.notifyChange();for(d=a.options.cards?"TABLE":"TR";g&&g.tagName.toUpperCase()!=d;)g=g.parentNode;g&&b(g).remove()}else"edit"===d?(d=b(g).attr("data-index"),d=parseInt(d,10),j=c.getPageData(),g=b.proto.getProto(j,a.options.bind),j=c.getValue(a.options.bind,null,[]),f=[],a.options.cards?f=a.options.items||{}:a.options.items&&a.options.items.forEach(function(a){f.push({$bind:a})}),g=e.detailUiData(c,g,j[d],f),e.createDetail(g.uiData,j[d],c),c.setNeedRefresh()):
"new"===d&&(j=c.getPageData(),g=b.proto.getProto(j,a.options.bind),d=b.proto.proto2Instance(g),j=c.getValue(a.options.bind,null,[]),j.push(d),c.setData(a.options.bind,j,null),c.notifyChange(),f=[],a.options.cards?f=a.options.items||{}:a.options.items&&a.options.items.forEach(function(a){f.push({$bind:a})}),g=e.detailUiData(c,g,d,f),e.createDetail(g.uiData,d,c),c.setNeedRefresh())}})}}})(jQuery);
