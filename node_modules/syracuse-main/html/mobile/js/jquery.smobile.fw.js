(function(i){function c(a,b,h,d){return b.html?h?b&&b.list&&"application/x-reference"===h.$type?(a||(a=null),d.add(a),a=f.parseExpression(h.$item.$value,{data:d,$prototype:h.$item},"$value"),d.pop(),a||(a=""),l.htmlEncode(a+"")):j.htmlValue(null,null,h,{$type:h.$type},a,{useValue:!0,list:b.list,cssPrefix:b.cssPrefix}):l.htmlEncode(a+""):a}var j=i.proto||{},f=i.proto=j,l=i.helpers,d=i.scroller,a=function(a){this.stack=[];a&&this.stack.push(a)};a.prototype={push:function(a){this.stack.unshift(a)},data:function(){return this.stack.length?
this.stack[this.stack.length-1]:null},add:function(a){this.stack.push(a)},pop:function(){this.stack.splice(this.stack.length-1,1)},parent:function(a){a=this.stack.indexOf(a);return 0<a?this.stack[a-1]:null}};var b="application/x-string,application/x-password,application/x-integer,application/x-real,application/x-decimal,application/x-boolean,application/x-date,application/x-time,application/x-datetime,application/x-choice,image".split(",");j.isNumeric=function(a){return 0<=["application/x-integer",
"application/x-real","application/x-decimal"].indexOf(a)};j.formatDecimal=function(a,b,h,d){var c=0;if(b){if(b.$format)c=l.format2decimals(b.$format);else if(b.$scale)c=b.$scale;if(h&&d&&h.$properties&&h.$properties[d])if(h.$properties[d].$format)c=l.format2decimals(h.$properties[d].$format);else if(h.$properties[d].$scale)c=h.$properties[d].$scale;a=l.number2str(a,c)}return a};j.isExpression=function(a){return 0<=a.indexOf("{")};j.updproto=function(a,b){b&&Object.keys(b).forEach(function(h){"object"!==
typeof a[h]&&(a[h]=b[h])})};j.sdataKey={workingCopies:"$workingCopies"};j.exprData=function(e){return new a(e)};j.extractLinks=function(a,b,h,d){var c=["$lookup"];if(!a||!a.$links)return null;var f=[];Object.keys(a.$links).forEach(function(p){var l=a.$links[p];if(!(0<=c.indexOf(p)||d&&"$"===p.charAt(0))&&!l.$isHidden&&l.$url&&l.$title){var o=l.$method||"GET",o=o.toUpperCase();if(!(d&&"POST"!==o)){var p={name:p},s=j.exprData(h);p.$url=l.$url;p.$title=l.$shortTitle||l.$title;if(!d)p.url=j.parseExpression(l.$url,
{data:s,$prototype:b},"$url");p.$title=j.parseExpression(l.$title,{data:s,$prototype:b},"$title");p.$type=l.$type;p.$method=o;p.$parameters=l.$parameters;f.push(p)}}});return f.length?f:null};j.htmlValue=function(a,b,h,k,c,r){r=r||{};r.useValue||(c=a?a[k.$bind]:"");var p=a?j.exprData(a):null;if(h.$isHidden&&!r.list)return"";null===c&&(c="");switch(k.$type){case "application/x-password":case "application/x-string":if(r.list)return h.$format&&c&&"$phone"===h.$format?'<span class="s-m-phone">'+l.htmlEncode(c)+
"</span>":l.htmlEncode(c);if(h.$format&&c){if("$email"===h.$format)return'<a data-role ="none" class="s-m-email"  href="mailto:'+c+'">'+l.htmlEncode(c)+"</a>";if("$phone"===h.$format)return'<a class="s-m-phone" href="tel:'+c+'">'+l.htmlEncode(c)+"</a>"}return l.htmlEncode(c);case "application/x-integer":return null==c&&(c=""),l.htmlEncode(c+"");case "application/x-real":return null==c&&(c=""),l.htmlEncode(c+"");case "application/x-decimal":return c=j.formatDecimal(c,h,a,k),null==c&&(c=""),l.htmlEncode(c+
"");case "application/x-date":return c&&(c=d.formatDate(l.dateSettings.dateFormat,new Date(c))),l.htmlEncode(c+"");case "application/x-datetime":return c&&(c=d.formatDate(l.dateSettings.dateFormat,new Date(c))),l.htmlEncode(c||"");case "application/x-time":return l.htmlEncode(c||"");case "application/x-boolean":return r.cssPrefix?{value:c}:r.list?'<div class="ui-checkbox" style="display:inline"><center class="ui-icon ui-icon-checkbox-'+(c?"on":"off")+'"> </center></div>':'<span class="ui-checkbox"><center class="ui-icon ui-icon-checkbox-'+
(c?"on":"off")+'"> </center></span>';case "application/x-choice":b=h.$value.$enum;p=0;for(a=b.length;p<a;p++)if(b[p].$value===c)return h=f.execExpression(b[p].$title,h),r.cssPrefix?{value:c,title:l.htmlEncode(h)}:l.htmlEncode(h);break;case "image":if(c&&b){if(c.$value)return'<image class="s-image-detail" src="data:'+(c.$contentType||"image/jpeg")+";base64,"+c.$value+'"/>';r=c.$url;!r&&h.$url&&(r=j.parseExpression(h.$url,{data:p,$prototype:h},"$url"));if(r)return c=r,j.isExpression(r)&&(c=j.parseExpression(r,
{data:p,$prototype:b},"$url")),'<image class="s-image-detail" src="'+c+'"/>';if(c.$value)return'<image class="s-image-detail" src="data:'+(c.$contentType||"image/jpeg")+";base64,"+c.$value+'"/>'}}return null};j.settings={CollapsibleLayout:{jmdata:function(){return{"data-mini":"false","data-theme":"c","data-content-theme":"d","data-inset":"true","data-expanded-icon":"arrow-u","data-collapsed-icon":"arrow-d"}}},CollapsibleSetsLayout:{jmdata:function(){return{"data-mini":"false","data-theme":"a","data-content-theme":"a",
"data-inset":"true","data-expanded-icon":"arrow-u","data-collapsed-icon":"arrow-d"}}}};j.getArticle=function(a){var b=a.$article;if(b)return b;b=a.$prototype;return b.$article};j.extractFirstProp=function(a){var b=a.indexOf("}");0<=b&&(a=a.substring(0,b));b=a.indexOf("{");0<=b&&(a=a.substring(b+1));return a};j.getProto=function(a,b){if(!a)return{};if(!b)return a.$prototype||a.$;var h=a.$prototype;if(h=h&&h.$properties?h.$properties:a.$properties){if(h=h[b])switch(h.$type){case "application/x-array":h=
h.$item;if(h.$item)h=h.$item;break;case "application/x-reference":if(h.$item)h=h.$item;break;case "application/x-object":if(h.$item)h=h.$item}return h}return null};j.linkParents=function(a,b){if(a){var h=[];if(!a.$protoparent)a.$protoparent=b;if(!a.$rprotoparent)a.$rprotoparent=b;a.$properties&&Object.keys(a.$properties).forEach(function(b){b=a.$properties[b];switch(b.$type){case "application/x-array":b.$protoparent=a;b.$rprotoparent=a;b.$item.$rtype="application/x-array";b.$item.$protoparent=b;b.$item.$rprotoparent=
a;var g=b.$item;if(g&&g.$item)g=g.$item,g.$rprotoparent=a,g.$protoparent=b.$item,g.$rtype="application/x-array";h.push(g);break;case "application/x-reference":b.$protoparent=a;b.$rprotoparent=a;b.$item.$protoparent=b;b.$item.$rprotoparent=a;b.$item.$rtype="application/x-reference";h.push(b.$item);break;case "application/x-object":if(!b.$item)break;b.$protoparent=a;b.$rprotoparent=a;b.$item.$protoparent=b;b.$item.$rprotoparent=a;h.push(b.$item);b.$item.$rtype="application/x-object";break;default:b.$protoparent=
a,b.$rprotoparent=a}});h.forEach(function(h){j.linkParents(h,a)})}};j.useUuid=function(a){return"{$uuid}"===a.$key};j.getRefFromValue=function(a,b){if(!a)return null;var h={};if(j.useUuid(b))h.$uuid=a.$uuid,h.$key=a.$key||a.$uuid;Object.keys(b.$properties).forEach(function(b){h[b]=a[b]});return h};j.setArrayRef=function(a,b){if(j.useUuid(b))return a;var h={};Object.keys(b.$properties).forEach(function(c){if(b.$properties.$isReadOnly)a&&delete a[c];else{var d=(a?a[c]:"")||"",f=b[c];f||(f="{"+c+"}");
if(f&&!("{"!=f.charAt(0)||"}"!=f.charAt(f.length-1)))a&&delete a[c],c=f.substring(1,f.length-1),h[c]=d}});return h};j.formatValue=function(a,b){return b};j.proto2Value=function(a,b,h){switch(a.$type){case "application/x-password":case "application/x-string":h[b]="";break;case "application/x-decimal":case "application/x-real":h[b]=0;break;case "application/x-integer":h[b]=0;break;case "application/x-boolean":h[b]=!1;break;case "application/x-date":a=new Date;h[b]=l.date.checkString(a.toISOString());
break;case "application/x-datetime":a=new Date;h[b]=a.toISOString();break;case "application/x-time":a=l.Time.parse("00:00");h[b]=a.toISO();break;case "application/x-choice":h[b]=a.$value.$enum[0].$value}};j.proto2Instance=function(a){var b={};Object.keys(a.$properties).forEach(function(h){"$"!==h.charAt(0)&&j.proto2Value(a.$properties[h],h,b)});return b};j.setRef=function(a,b,h,c){var d=j.useUuid(b),f=h.data();d?f[c]=a:(Object.keys(b.$properties).forEach(function(h){if(b.$properties.$isReadOnly)a&&
delete a[h];else{var c=(a?a[h]:"")||"",d=b[h];d||(d="{"+h+"}");"{"!=d.charAt(0)||"}"!=d.charAt(d.length-1)||(a&&delete a[h],h=d.substring(1,d.length-1),b.$rprotoparent.$properties[h]&&(f[h]=c))}}),a?Object.keys(a).length&&(f[c]=a):delete f[c])};j._protoProp=function(a,b){if("$baseUrl"===b)return{value:l.baseUrl(),found:!0,stop:!0};var h=a;if("@"==b.charAt(0))for(;h;){if(h&&h.$localization&&h.$localization.hasOwnProperty(b))return{value:h.$localization[b],found:!0,stop:!0};h=h.$rprotoparent}else for(;h;){if(h.hasOwnProperty(b))return{value:h[b],
found:!0};h=h.$protoparent}return{found:!1}};j._dataProp=function(a,b,h){if("$baseUrl"===b)return{value:l.baseUrl(),found:!0,stop:!0};for(var c=a.data();c;){if(c.hasOwnProperty(b))return a=null,h&&h.$properties&&h.$properties[b]&&(a=h.$properties[b]),{value:c[b],found:!0,pi:a};c=a.parent(c)}return{value:"",found:!1}};j.execExpression=function(a,b,h,d,f){f=f||{};d=d||0;a=(a||"")+"";if(!d)if(0>a.indexOf("{")){if(h){var r=j._dataProp(h,a,b);if(r.found)return c(r.value||"",f,r.pi,h)}}else f.html&&(a=
l.htmlEncode(a));return a.replace(/\{(.*?)\}/g,function(r,i){var o,s;if(!d&&b&&!b.noRef&&b.$protoparent&&"application/x-reference"===b.$protoparent.$type){o=j._protoProp(b,i);if(o.found){if(o.stop)return s=o.value||"",c(s,f,null,null);if(0<=o.value.indexOf("{")){s=b;if(0<=o.value.indexOf("{"+i+"}"))s=b.$protoparent;if(f.html)o.value=l.htmlEncode(o.value);return j.execExpression(o.value,s,h,d+1,f)}o=h?j._dataProp(h,i,b):{found:!1};!o.found&&l.trace.expressions&&(l.log(a),l.log("Not found:"+i),l.log("----------------------------------"));
s=o.value||"";return c(s,f,o.pi,h)}o=h?j._dataProp(h,i,b):{found:!1};!o.found&&l.trace.expressions&&(l.log(a),l.log("Not found:"+i),l.log("----------------------------------"));s=o.value||"";return c(s,f,o.pi,h)}o=h?j._dataProp(h,i,b):{found:!1};if(o.found)return s=o.value||"",c(s,f,o.pi,h);o=b?j._protoProp(b,i):{found:!1};if(!o.found)return l.trace.expressions&&(l.log(a),l.log("Not found:"+i),l.log("----------------------------------")),s="",f.keepBrackets&&(s="{"+i+"}"),c(s,f,null,null);if(o.stop)return s=
o.value||"",c(s,f,null,null);if(0<=o.value.indexOf("{")){if(f.html)o.value=l.htmlEncode(o.value);return j.execExpression(o.value,b,h,d+1,f)}s=o.value||"";return c(s,f,null,null)})||""};j.parseExpression=function(a,b,h,c){if(!c)c={},c.url="$url"===h;return j.execExpression(a,b.$prototype,b.data,0,c)};j.uiCanGroupField=function(a){return 0<=b.indexOf(a.$type)||"application/x-reference"===a.$type};j.jqmDataArray=function(){return{"data-inset":"true","data-mini":"true","data-theme":"d","data-divider-theme":"e"}}})(jQuery);
(function(i){var c=i.helpers||{};i.helpers=c;c.trace={expressions:!1,sdata:!1,ajax:!1};c.log=function(a){window.console.log(a)};c.baseUrl=function(){return""};c.ui=c.ui||{};c.ui.consts={normal_icon:"s-m-icon-space",normal_icon_size:"s-m-icon-size",normal_image_size:"s-m-image-size",normal_noimage:"s-m-noimage",panel_icon:"s-m-panel-space",panel_icon_size:"s-m-panel-size",default_panel_name:"sage.empty",default_panel_class:"sage",menu_icon:"s-m-menu-space",menu_icon_size:"s-m-menu-size",default_menu_name:"sage.empty",
default_menu_class:"sage",default_icon_name:"sage.empty",default_icon_class:"sage"};c.cleanUp=function(a){Object.keys(a).forEach(function(b){var e=a[b];e&&"object"===typeof e&&!Array.isArray(e)&&c.cleanUp(e);a[b]=null})};c.alert=function(a,b,e){if(!e)return b();navigator.notification&&navigator.notification.alert?navigator.notification.alert(a,b):(alert(a),b())};(function(){if(!Array.isArray)Array.isArray=function(a){return null!=a&&null!=a.splice};if(!Function.prototype.bind)Function.prototype.bind=
function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),h=this,c=function(){},d=function(){return h.apply(this instanceof c?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;d.prototype=new c;return d};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[],h;for(h in a)Object.prototype.hasOwnProperty.call(a,
h)&&b.push(h);return b};var a=!1;try{isNaN(new Date("2011-11-08T23:00:00.000Z"))&&(a=!1)}catch(b){a=!1}Date.parseISO8601=a?function(a){return new Date(a)}:function(a){a=/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?)?)?$/.exec(a);if(null===a)throw Error("Invalid ISO String");var b=new Date;b.setUTCFullYear(+a[1]);b.setUTCMonth(a[3]?(a[3]>>0)-1:0);b.setUTCDate(a[5]>>0);b.setUTCHours(a[7]>>0);b.setUTCMinutes(a[8]>>0);b.setUTCSeconds(a[10]>>0);b.setUTCMilliseconds(a[12]>>
0);if(a[13]&&"Z"!==a[13]){var h=a[16]>>0,c=a[17]>>0,d="+"===a[15];b.setUTCHours((a[7]>>0)+d?-h:h);b.setUTCMinutes((a[8]>>0)+d?-c:c)}return b}})();c.online=function(){return!1===navigator.onLine?!1:!0};c.AutomaticSendBatch=function(){return!0};c.extend=function(a,b){for(var e in b)a[e]=b[e]};var j={http:1,db:2,exception:3,sdata:4,warning:3};c.slashAtEnd=function(a){a&&"/"!=a.charAt(a.length-1)&&(a+="/");return a};c.displayDateFormat="YYYY-MM-DD";c.http={parseCookie:function(a){var b={};(a||"").split(";").forEach(function(a){a=
a.split("=");2<=a.length&&a[0]&&a[1]&&(b[a[0].trim()]=a[1].trim())});return b},setCookie:function(a,b,e,c){!b&&""==b&&(c=new Date);try{window.document.cookie=a+"="+b+(null!=c?"; expires="+c.toGMTString():"")+(e?"; path="+e:"/")}catch(h){}}};c._extractDiag=function(a,b,e,c){var h=c?["warning","success"]:["error"];a.$diagnoses.forEach(function(a){if(0<=h.indexOf(a.severity)&&(e.errors.push({propName:b,message:a.$message||a.message,severity:a.severity}),e.defMsg))e.defMsg=!1,e.message=(b?b+": ":"")+
(a.$message||a.message)})};var f=function(a,b,e,d,h,k){h=h||{message:b,defMsg:!0,errors:[]};if(!a)return h;a.$diagnoses&&a.$diagnoses.length&&c._extractDiag(a,d,h,k);a.$properties&&Object.keys(a.$properties).forEach(function(b){var e=a.$properties[b];e.$diagnoses&&e.$diagnoses.length&&c._extractDiag(e,d?d+"."+b:b,h,k)});Object.keys(a).forEach(function(b){if("$"!==b.charAt(0)){var e=a[b];if(Array.isArray(e))for(var c=0,l=e.length;c<l;c++){var o=e[c];"object"===typeof o&&f(o,"",!1,d?d+"."+b+"["+c+"]":
b,h,k)}else"object"===typeof e&&f(e,"",!1,d?d+"."+b:b,h,k)}});return h};c.extractErrors=function(a){return f(a,"",!0,"",null)};c.extractWarns=function(a){return f(a,"",!0,"",null,!0)};c.getErrorMessage=function(a,b){if(a.$properties&&a.$properties[b]&&a.$properties[b].$diagnoses){var e=a.$properties[b].$diagnoses;if(e.length)for(var c=0,h=e.length;c<h;c++)if("error"===e[c].severity)return e[c].$message||e[c].message}return""};c.clearErrorMessage=function(a,b){a.$properties&&a.$properties[b]&&a.$properties[b].$diagnoses&&
delete a.$properties[b].$diagnoses};c.format=function(a,b){return a=a.replace(/\{([0-9]\})*/g,function(a,c){return b[parseInt(c)]})};c.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};c.incId=function(){if(!c._iid)c._iid=0;c._iid++;return c._iid+""};c.htmlEncode=function(a){return i("<div/>").text(a).html()};c.htmlDecode=function(a){return i("<div/>").html(a).text()};c.ERRORS=j;c.pushdbError=function(a){a&&
c.pushError({type:j.db,title:c.locale().ui.db_exception,data:{message:a.message}})};c.pushException=function(a,b){c.pushError({type:j.exception,title:c.locale().ui.app_exception,data:{message:a.message,solution:b}})};c.pushWarning=function(a,b){c.pushError({type:j.warning,title:a&&a.severity&&"success"===a.severity?c.locale().ui.app_success:c.locale().ui.app_warning,data:{message:a.message,solution:b}})};c.pushAjaxError=function(a,b,e,d,h){var k=e,h=h||"GET",f=null;if(0===a.status)return c.pushError({type:j.exception,
title:c.locale().ui.exception_offline,data:{message:c.locale().ui.check_net}});if("timeout"===b)return c.pushError({type:j.exception,title:c.locale().ui.exception_timeout,data:{message:c.locale().ui.check_net}});if(a.responseText&&0<a.responseText.indexOf("$diagnoses"))try{f=JSON.parse(a.responseText)}catch(r){}if(f&&f.$diagnoses&&f.$diagnoses.length)k=f.$diagnoses[0].$message||f.$diagnoses[0].message;else if(e&&e.message)k=e.message;else if(a.statusText)k=a.statusText;if(!k)k=c.locale().ui.unknownError;
200==a.status||201==a.status?c.pushError({type:j.exception,title:c.locale().ui.app_exception,data:{message:k}}):c.pushError({type:j.http,title:h+" "+d,data:{message:(a.status?a.status+" - ":"")+k}})};c._errkey=function(a){return a?"mobile_errors":"mobile_errors"};c._localStorage=!0;try{if(!window.sessionStorage)c._localStorage=!1}catch(l){c._localStorage=!1}c._pushError=function(a,b){var e=c._errkey(b);if(c._localStorage){var d=window.sessionStorage.getItem(e),d=d?JSON.parse(d):[];d.push(a);window.sessionStorage.setItem(e,
JSON.stringify(d))}else c[e]||(c[e]=[]),c[e].push(a)};c._hasErrors=function(a){a=c._errkey(a);return c._localStorage?(a=window.sessionStorage.getItem(a))?(a=JSON.parse(a),0<a.length):!1:c[a]&&c[a].length};c._clearErrors=function(a){a=c._errkey(a);c._localStorage?window.sessionStorage.removeItem(a):delete c[a]};c._lastErrors=function(a){a=c._errkey(a);return c._localStorage?(a=window.sessionStorage.getItem(a))?JSON.parse(a):null:c[a]};c.pushError=function(a){c._pushError(a,!1)};c.hasErrors=function(){return c._hasErrors(!1)};
c.clearErrors=function(){c._clearErrors(!1)};c.lastErrors=function(){return c._lastErrors(!1)};c.pushWarn=function(a){c._pushError(a,!0)};c.hasWarns=function(){return c._hasErrors(!0)};c.clearWarns=function(){c._clearErrors(!0)};c.lastWarns=function(){return c.lastErrors(!0)};c.each=function(a,b,c,d){a=a||[];if(!a.length)return c();if(null==c)return a.forEach(b);var d=d||1,h=0,f=0,u=a.length;(function p(){if(f==u&&!h)return c();for(;f<u&&h<d;){h++;var l=f++;b(a[l],l,function(){h--;p()})}})()};c.forEachKey=
function(a,b,e,d){if(e)return null==a?e():c.each(Object.keys(a),function(h,c,e){return b(h,a[h],e)},e,d);for(var h in a)b(h,a[h])};c.sdataURL2key=function(a){return(a=/^.*\(\'(.*)\'\)$/.exec(a))&&2==a.length?a[1]:""};c.applySDataSort=function(a,b){var c=null,c=1===a.length?function(b,h){var c=a[0],e=b[c.name],d=h[c.name];return e===d?0:e>d?c.asc?1:-1:c.asc?-1:1}:function(b,h){for(var c,e,d=0,f=a.length;d<f;d++){var l=a[d];c=b[l.name];e=h[l.name];if(c!=e)return c>e?l.asc?1:-1:l.asc?-1:1}return 0};
b.sort(c)};c.addJqmData=function(a,b,c,d,h){a.jmdata&&Object.keys(a.jmdata).forEach(function(f){if(!(c&&0>c.indexOf(f))){var l=a.jmdata[f],r="true"==a.jmdata||"false"==a.jmdata?"":'"';d?b.push(" "+h+l):b.push(" "+f+"="+r+l+r)}})};c.encodeURIComponent=function(a){return encodeURIComponent(a).replace(/\'/g,"%27")};c.encodeJsmQuery=function(a){return c.encodeURIComponent(a)};c.decodeJsmQuery=function(a){return 0<a.indexOf("=")?a:decodeURIComponent(a)};c.hashFirst=function(){return!0};c.sdataSort=function(a){if(a&&
a.orderBy){var b=a.orderBy.split(",");b.forEach(function(a,c){var a=a.trim(),h=a.split(" ");b[c]=2==h.length?{name:h[0],asc:"desc"!=h[1]}:{name:a,asc:!0}});return b}return null};c.number={decimalSep:".",thousandSep:" "};c.format2decimals=function(a){var b=0;a.split(";").forEach(function(a){var c=a.indexOf(".");0<=c&&(a=a.length-c-1,a>b&&(b=a))});return b};c.number2str=function(a,b){var a=(a||0).toFixed(b)+"",d=a.split(".");d[0]=d[0].replace(/\B(?=(\d{3})+(?!\d))/g,c.number.thousandSep);if(!b)return d[0];
2>d.length&&d.push("");return d.join(c.number.decimalSep)};var d=function(a){a=""+a;1==a.length&&(a="0"+a);return a};c.date={isoToDate:function(a){return Date.parseISO8601(a)},dateMY:function(a){return c.messages.monthsOfYear[a.getMonth()]+" "+a.getFullYear()},dateMY2:function(a,b){return c.messages.monthsOfYear[a]+" "+b},dateym:function(a){return a.getFullYear()+"-"+d(a.getMonth()+1)},str2dateym:function(a){a=c.date.isoToDate(a);return a.getFullYear()+"-"+d(a.getMonth()+1)},str2dateYM:function(a){a=
c.date.isoToDate(a);return c.date.dateMY(a)},dateTimeToLocalDate:function(a){return a.getFullYear()+"-"+d(a.getMonth()+1)+"-"+d(a.getDate())},checkString:function(a,b){if(!b)return a.substring(0,10);try{var c=a.substring(0,10);return b.substring(0,10)==c?b:c}catch(d){return b}},dateStringToIso:function(a){var b=(new Date).toISOString().substring(10);return Date.parseISO8601(a+b).toISOString()}}})(jQuery);
(function(i){var c=i.helpers||{};i.helpers=c;var j=i.scroller;c.Time=function(c){this._value=(c+31536E7)%86400};var f=function(c){c=c.toString();return 1==c.length?"0"+c:c};c.Time.prototype={hour:function(){return Math.floor(this._value/3600)},minute:function(){return Math.floor(this._value/60)%60},second:function(){return this._value%60},value:function(){return this._value},toISO:function(){return f(this.hour())+":"+f(this.minute())+":"+f(this.second())},format:function(){var l=this.hour(),d=this.minute(),
a=this.second(),b=c.dateSettings.timeFormat||"HH:ii",e=d+"",d=f(d),g=a+"",a=f(a),h=l+"",k=f(l);if(c.dateSettings.ampmText){var u="AM";13<l&&(l-=12,h=l+"",k=f(l),u="PM");return b.replace(/ii/,d).replace(/i/,e).replace(/ss/,a).replace(/s/,g).replace(/hh/,k).replace(/h/,h).replace(/A/,u)}return b.replace(/ii/,d).replace(/i/,e).replace(/ss/,a).replace(/s/,g).replace(/HH/,k).replace(/H/,h)}};c.Time.parse=function(f){f=f||"00:00";if(5!=f.length&&8!=f.length)throw Error("bad time format, expected hh:mm or hh:mm:ss, got "+
f);f=8==f.length?3600*parseInt(f.substring(0,2),10)+60*parseInt(f.substring(3,5),10)+parseInt(f.substring(6.8),10):3600*parseInt(f.substring(0,2),10)+60*parseInt(f.substring(3,5),10);return new c.Time(f)};c.Time.parseTime=function(f){var d=j.formatDate(c.dateSettings.dateFormat,new Date),f=j.parseDate(c.dateSettings.dateFormat+" "+c.dateSettings.timeFormat,d+" "+f),d=j.parseDate(c.dateSettings.dateFormat+" "+c.dateSettings.timeFormat,d+" "+(new c.Time("00:00")).format());return new c.Time((f-d)/1E3)};
c.lang2DateSettings=function(f,d){var a=new Date;c.dateSettings=c.dateSettings||{};c.dateSettings.ampmText=c.locale().datetime.amDesignator||c.locale().datetime.pmDesignator?"&nbsp;":"";if(f)c.dateSettings.dateFormat=f.toLowerCase();c.dateSettings.dateOrder=c.locale().datetime.dateElementOrder.replace(/m/,"mm").replace(/y/,"yy").replace(/d/,"dd");c.dateSettings.dayNames=c.locale().datetime.dayNames;c.dateSettings.dayNamesShort=c.locale().datetime.abbreviatedDayNames;c.dateSettings.monthNames=c.locale().datetime.monthNames;
c.dateSettings.monthNamesShort=c.locale().datetime.abbreviatedMonthNames;if(d)c.dateSettings.timeFormat=d.replace(/tt/g,"A").replace(/m/g,"i");c.dateSettings.yearText=c.locale().datetime.year;c.dateSettings.monthText=c.locale().datetime.month;c.dateSettings.dayText=c.locale().datetime.day;c.dateSettings.minuteText=c.locale().datetime.minutes;c.dateSettings.hourText=c.locale().datetime.hour;c.dateSettings.secText=c.locale().datetime.seconds;c.dateSettings.endYear=a.getFullYear()+20;c.dateSettings.timeFormat=
c.dateSettings.ampmText?c.dateSettings.timeFormat.replace(/H/g,"h"):c.dateSettings.timeFormat.replace(/h/g,"H");c.dateSettings.timeWheels=c.dateSettings.timeFormat.replace(/:/g,"").replace(/ /g,"")};c.lang2DateSettings("M/d/yyyy","h:mm tt");j&&j.setDefaults(c.dateSettings);c.authHeaders=null;c.addCustomHeaders=function(f,d){var a=c.language();a&&(f["Accept-Language"]=a);return c.authHeaders?c.authHeaders(f,d):!1}})(jQuery);(function(i){function c(a,b,h,m){var d,e;if(Array.isArray(a)){for(d=0,e=a.length;d<e;d++){var n=a[d];if(n&&"object"===typeof n&&(h&&h(n,a),(n=c(n,b,h,m))&&!m))return n}return null}if(d=b(a))return d;n=Object.keys(a);for(d=0,e=n.length;d<e;d++)if("_"!==n[d].charAt(0)){var g=a[n[d]];if(g&&"object"===typeof g&&(h&&h(g,a),g=c(g,b,h,m)))return g}return null}function j(a,b){a&&(Array.isArray(a)?a.forEach(function(a){if("object"===typeof a){var h=Array.isArray(a)?[]:{};b.push(h);j(a,h)}else b.push(a)}):
Object.keys(a).forEach(function(h){if(!("$rtype"===h||"$protoparent"===h||"$rprotoparent"===h)){var m=a[h];"object"===typeof m?(b[h]=Array.isArray(m)?[]:{},j(m,b[h])):b[h]=m}}))}function f(a){return a=c(a,function(a){return"$resources"===a.$bind?a.$cards&&a.$cards.$layout?a.$cards.$layout:a.$layout?a.$layout:a:null})}function l(a,b,h){if(!h.list)return null;var m="$title",c="$description";!a.$title&&a.$value?m="$value":a.$title&&a.$title===a.$description&&(c="");a={$layout:{$layoutType:"stack",$items:[{$bind:"$resources",
$format:"cards",$cards:{$layout:{$layoutType:"stack",$items:[{$bind:m,$isTitle:!0}]}}}]}};c&&a.$layout.$items[0].$cards.$layout.$items.push({$bind:c,$lines:2});if(b)h.design?a.$layout.$items[0].$cards.$layout.$items.push({$bind:b}):(h.$image=b,a.$image=b);return a}function d(a){if(a.$widths)a=a.$widths.split(",");else{if(!a.$items.length)return;for(var b=parseInt(1E4/a.$items.length,10)/100,h=a.$items.length,a=Array(h);h--;)a[h]=b+""}return a}function a(a,b,m,c,e,n,g,f){var t=d(a),k=["s-m-l-table"];
a.$theme&&k.push("ui-body-"+a.$theme.toLowerCase());b.push('<div class="'+k.join(" ")+'">');var o=t.length-1;t.forEach(function(d,t){var k=["s-m-l-row"];0===t&&t!==o?k.push("first"):0!==t&&t===o&&k.push("last");0>d.indexOf("%")&&0>d.indexOf("px")&&(d+="%");b.push('<div class="'+k.join(" ")+'" style="width:'+d+'">');f.root=!1;h(a.$items[t],b,m,c,e,n,g,f);b.push("</div>")});b.push("</div>")}function b(a){for(var b=a.$items.length;b--;)if(!a.$items[b].$bind&&!a.$items[b].$expression)return!1;return!0}
function e(a,m,c,d,e,n,g,f){var t=!b(a);a.$items.forEach(function(a){t?m.push('<div class="s-m-l-stack">'):f.defContainer="p";h(a,m,c,d,e,n,g,f);t?m.push("</div>"):f.defContainer=""})}function g(a,c,d,e,n,g,f,t){var k=!b(a)?"div":"p",k="div";c.push("<"+k+' class="s-m-l-inline">');a.$items.forEach(function(b){a.$sep&&c.push(m.htmlEncode(" "));h(b,c,d,e,n,g,f,t)});c.push("</"+k+">")}function h(b,m,c,d,n,f,k,o){var o=o||{},r=b.$layoutType;!r&&b.$items&&(r="stack");if(r)switch(r){case "stack":case "tabs":o.root=
!1;e(b,m,c,d,n,f,k,o);break;case "inline":o.root=!1;g(b,m,c,d,n,f,k,o);break;case "row":o.root=!1,a(b,m,c,d,n,f,k,o)}else if(b.$bind||b.$expression)if("cards"==b.$format)b=b.$cards.$layout,o.root=!1,h(b,m,c,d,n,f,k,o);else{f=o;c=[];d="span";if(f.defContainer)d=f.defContainer;if(b.$isTitle||"$title"===b.$bind&&!1!==b.$isTitle)d="h3",c.push("title");t(c,b);if(c.length||f.defContainer)c.push("s-m-style"),m.push("<"+d+' class="'+c.join(" ")+'">');f=b.$bind;b.$expression?f=b.$expression:f&&"$"===f.charAt(0)&&
(f="{"+f+"}");o="";!1===b.$isTitleHidden&&b.$bind&&(n&&n.$properties&&n.$properties[b.$bind]&&(o=n.$properties[b.$bind],o=s.parseExpression(o.$shortTitle||o.$title,{data:null,$prototype:n},"$title",{html:!0})),o&&m.push(o+": "));k=s.parseExpression(f,k,b.$bind||"",{html:!0,list:!0,onlyValue:!1,keepBrackets:!0,cssPrefix:b.$cssPrefix});b.$cssPrefix&&"object"===typeof k?(m.push('<span class="s-indicator '+b.$cssPrefix+"-"+k.value+'"></span>'),k.title?m.push(k.title):n&&n.$properties&&n.$properties[b.$bind]&&
(o=n.$properties[b.$bind],m.push(s.parseExpression(o.$shortTitle||o.$title,{data:null,$prototype:n},"$title",{html:!0})))):m.push(k);c.length&&m.push("</"+d+">")}}function k(a){a.iid++;for(a=a.iid+"";3>a.length;)a="0"+a;return"c_"+a}function u(a,b,h,m,c,d,e){a.$items&&u&&a.$items.forEach(function(a){var c=m.$properties[a.$bind];if(c){var n=k(h);s.uiCanGroupField(c)?b[n]={parent:e,uiClass:"SingleField",data:{facet:d.facet,$bind:a.$bind,$article:i.extend(!0,{},a)}}:"application/x-array"===c.$type&&
(b[n]={parent:e,uiClass:"ArrayField",data:{jmdata:s.jqmDataArray(),facet:d.facet,field:{$bind:a.$bind,$type:c.$type,$title:c.$shortTitle||c.$title,$proto:c.$item},$article:i.extend(!0,{},a)}})}})}function r(a,b,h,m,c,d,e){if(!a.$bind&&!a.$items&&a.$layout)return o(a.$layout,b,h,m,c,d,e,a);a.$items&&(a.$items[0].$bind?u(a,b,h,m,c,d,e):a.$items.forEach(function(n){return o(n,b,h,m,c,d,e,a)}))}function p(a,b,h,m,c,d,e){var n=[];a.$items.forEach(function(a){n.push(s.parseExpression(a.$title||"",c,"$title",
{html:!0}))});var g=k(h);b[g]={parent:e,layout:"TabsLayout",data:{tabs:n}};d.root=!1;a.$items.forEach(function(e,n){return o(e,b,h,m,c,d,g+"_"+n,a)})}function q(a,b,h,m,c,e,n){var g=d(a),f=k(h);b[f]={parent:n,layout:"RowLayout",data:{widths:g,responsive:a.$responsive,theme:a.$theme}};e.root=!1;a.$items.forEach(function(d,n){return o(d,b,h,m,c,e,f+"_"+n,a)})}function o(a,b,h,m,c,d,e){if(a){var n=a.$layoutType,g;!n&&a.$items&&(n="stack");g=a.$category;if("section"===g&&a.$layout&&a.$layout.$items&&
1===a.$layout.$items.length&&"block"===a.$layout.$items[0].$category)return o(a.$layout.$items[0],b,h,m,c,d,e,a.$layout);!n&&a.$items&&(n="stack");if(!a.$bind&&!a.$items&&a.$layout&&!g||a.$category&&!a.$title)return o(a.$layout,b,h,m,c,d,e,a);if(a.$category){n={size:6};n.jmdata=s.settings.CollapsibleLayout.jmdata(d.root);n.text=s.parseExpression(a.$title,c,"$title",{html:!0});if(a.$collapsed)n.collapsed=!0;g=k(h);b[g]={parent:e,layout:"CollapsibleLayout",data:n};d.root=!1;return o(a.$layout,b,h,m,
c,d,g,a)}if(n)switch(n){case "stack":r(a,b,h,m,c,d,e);break;case "tabs":p(a,b,h,m,c,d,e);break;case "row":if(null==a.$responsive&&a.$items[0]&&!a.$items[0].$bind)a.$responsive=!0;q(a,b,h,m,c,d,e)}}}i.proto=i.proto||{};var s=i.proto,m=i.helpers,n=s.auth||{};s.auth=n;s.auth.designMode=!0;s.auth.notifyParent=function(a,b){return b};n.defaultDetailArticle=function(a){var b={$layout:{$layoutType:"stack",$items:[]}},h=b.$layout.$items;Object.keys(a.$properties).forEach(function(b){a.$properties[b].$isHidden||
h.push({$bind:b})});return b};n.copyProto=function(a){var b={};j(a,b);return b};n.findSlayout=function(a,b,h){return!a?null:a=c(a,function(a){return a.$bind===b?h?a:a.$cards&&a.$cards.$layout?a.$cards.$layout:a.$layout?a.$layout:a:null})};n.checkQueryArticle=function(a,b,h){if(!h.list)return b;var m=null;Object.keys(a.$properties).forEach(function(b){var h=a.$properties[b];!m&&"image"===h.$type&&(m=b)});var d=null;b&&(h.noCache&&(b=i.extend(!0,{},b)),(d=f(b))||(b=null));if(b){if(m&&!b.$image&&!h.design){var e=
c(b,function(a){return a.$bind===m?a:null},function(a,b){a._parent=Array.isArray(b)?b._parent:b});if(e){if(h.$image=m,b.$image=m,e._parent)for(var n=e._parent,g=!0;g;)if(n.$items){var t=n.$items.indexOf(e);if(0<=t)if(n.$items.splice(t,1),n.$items.length){if(g=!1,"row"===n.$layoutType&&n.$widths){var k=n.$widths.split(","),o=parseFloat(k[t]);k.splice(t,1);t=parseFloat(k[0]);t+=o;k[0]=t+"%";n.$widths=k.join(",")}}else e=n,n=n._parent;else g=!1}else if(e=n,n=n._parent,!n)break}else b.$image="";c(b,function(){return null},
function(a){a._parent=null})}else h.$image=b.$image;b||(b=l(a,m,h))}else b=l(a,m,h);h.design||(b=d?d:f(b));return b};n.checkDesign=function(a,b,h){return h.list?n.checkQueryArticle(a.$properties.$resources.$item,b,h):b};var t=function(a,b){b.$theme&&a.push("theme"+b.$theme);b.$styles&&b.$styles.forEach(function(b){"aside"===b&&(b="ui-li-aside");a.push(b)});b.$lines&&a.push("s-line-"+b.$lines);b.$cssPrefix&&a.push("s-hasprefix")};n.mobileExtentions=t;n.compositionLayout=function(a,b,h){var m={cards:!1,
$items:[]},d=[];b&&b.$properties&&Object.keys(b.$properties).forEach(function(a){h&&0>h.indexOf(a)||b.$properties[a].$isHidden||d.push(a)});var e=!1,n=[];a&&(a.$cards||a.$layout)?(n=[],a.$cards&&(e=!0),c(a.$cards.$layout||a.$layout,function(a){return a.$bind?(0<=d.indexOf(a.$bind)&&n.push(a.$bind),!0):!1},null,!0)):n=d;!e&&5<n.length&&(e=!0);m.cards=e;n.forEach(function(a){m.$items.push({$bind:a})});return m};n.sdi=function(a,b,c,d,e,n,g){var f=m.ui.consts,t={data:d.exprData(n),$prototype:e};if(g.$image){b.push('<div class="'+
f.normal_image_size+" "+f.normal_noimage+'"');if(f=n[g.$image]){if(f.$value)f="data:"+(f.$contentType||"image/jpeg")+";base64,"+f.$value;else{f=f.$url;if(!f&&e.$properties&&e.$properties[g.$image])f=e.$properties[g.$image].$url;f=f?s.parseExpression(f,t,"$image"):null}f&&b.push(" style=\"background: transparent url('"+f.replace(/'/g,"\\'")+"') no-repeat center center; background-size: 100% 100%\"")}b.push("></div>")}h(a,b,c,d,e,n,t,{root:!0,list:!0})};n.detailArt2design=function(a,b,h,m){return o(a,
b,{iid:0},h,{data:null,$prototype:h},m,"root",null)}})(jQuery);(function(i){var c=i.helpers,j=i.proto,f=i.sdata||{};i.sdata=f;var l={vnd_sage:"syracuse",store_facet:"$edit",edit_facet:"$edit"};f.consts=l;f.capabilities={nativeDevice:!1,showSettings:!1,authRequired:!1,showSearch:!1,loadLocale:!1,installUrl:"",auth:null,localeLoader:null};c.baseUrl=function(){return f.config.baseUrl};(function(){var a=c.settings();a.sdata=a.sdata||{};if(!a.sdata.sdataHost)a.sdata.sdataHost="file:"===window.location.protocol.toLowerCase()?"":window.location.protocol+"//"+window.location.host;
f.sdataHost=a.sdata.sdataHost;c.settings("",a)})();f.sdataAdmin=function(){var a=c.settings();a.sdata=a.sdata||{};return a.sdata.sdataHost&&f.capabilities.installUrl?(f.sdataHost=a.sdata.sdataHost,a.sdata.sdataHost+f.capabilities.installUrl):""};var d=function(a){var b=a.entity;if(a.query&&a.query.representation)b=a.query.representation;return b},a=function(a){var b=a.indexOf(".");return 0<b?a.substr(0,b):a},b=function(a){var b=a.indexOf(".");return 0<b?a.substr(b+1):a};f.store=function(b){"object"!==
typeof b&&(b=f.parseSdataUri(b));if(b=d(b))if(b=a(b),f.config&&f.config.entities&&f.config.entities[b]&&f.config.entities[b].sync)return!0;return!1};f.cache=function(a){"object"!==typeof a&&(a=f.parseSdataUri(a));return(a=d(a))?(a=b(a),"$lookup"===a):!1};f.representation2facet=b;f.editUrl=function(a){"object"!==typeof a&&(a=f.parseSdataUri(a));a.editActivity=!0;if(a.query&&a.query.representation){var b=a.query.representation;if(0>b.indexOf("."))b=b+"."+l.edit_facet,a.query.representation=b}return f.getUri(a)};
f.url2proto=function(a){a=d(a);0>a.indexOf(".")&&(a=a+"."+l.store_facet);return f.config&&f.config.pages&&f.config.pages[a]?f.config.pages[a].$prototype:null};f.url2search=function(a){if(a&&a.query&&a.query.search){var b={},c=f.url2proto(a).$properties.$resources.$item.$properties;Object.keys(c).forEach(function(a){var h=c[a];"application/x-string"===h.$type&&h.$capabilities&&0<=h.$capabilities.indexOf("filter")&&(b[a]={$type:h.$type})});return b}return null};f.data2id=function(a,b,d){d=d||f.url2proto(a);
if(!d)return b.$uuid||"";return j.useUuid(d)?(b.$uuid=b.$uuid||c.uuid(),b.$uuid):j.parseExpression(d.$key,{data:j.exprData(b),$prototype:d},"$key")};f.data2url=function(b,e,g){var g=g||f.url2proto(b),r="";if(g)j.useUuid(g)?(e.$uuid=e.$uuid||c.uuid(),r=e.$uuid):r=j.parseExpression(g.$key,{data:j.exprData(e),$prototype:g},"$key");return f.entityUri(b)+"('"+r+"')?representation="+a(d(b))+"&appid="+f.config.id};f.bestProto=function(b){for(var b=a(d(b)),c=[{name:"$sync",detail:!0},{name:"$edit",detail:!0},
{name:"$details",detail:!0},{name:"$query",detail:!1},{name:"$lookup",detail:!1}],e=null,g=0,i=c.length;g<i;g++)if(e=f.config.pages[b+"."+c[g].name]){e=e.$prototype;if(!c[g].detail)e=e.$properties.$resources.$item;break}return e};f.url2local=function(b,c){var d=b.query;if(c)return d.representation;b.query={};if(d)b.query.representation=a(d.representation||"");var e=i.sdata.getUri(b);b.query=d;if(b.id||b.template)e=e+"&appid="+i.sdata.config.id;return e};f.url2entity=function(b){b=d(b);return a(b)};
f.createUrl=function(a,b,c){a=j.parseExpression(a,{data:j.exprData(c),$prototype:f.url2proto(b)},"$url");a=f.parseSdataUri(a);if(b.query&&b.query.representation)a.query=a.query||{},a.query.representation=b.query.representation;return i.sdata.getUri(a)};f.$url=function(a,b){b=b||a.$url;return a.$baseURI&&0>b.indexOf(a.$baseURI)?a.$baseURI+b:b};f.$purl=function(a){var a=a||"",b=f.config.baseUrl;return b&&0>a.indexOf(b)?b+a:a};f.STATUS={ORIGINAL:0,CREATED:1,MODIFIED:2,DELETED:3};f.TYPES={ENTITY:0,TEMPLATE:1,
UNKNOWN:10};f.options={statefulServerPrtocol:!0};f.funcs={yearMonth:function(a){return c.date.str2dateym(a)},yearMONTH:function(a){return c.date.str2dateYM(a)},thisMonth:function(a){var b=c.date.isoToDate(a),a=b.getFullYear(),b=b.getMonth(),d=new Date(new Date(a,b+2,1,0,0,0,0)-1/24/60/60/1E3);return"@"+(new Date(a,b+1,1,0,0,0,0)).toISOString()+"@ and @"+d.toISOString()+"@"},asString:function(a){return"'"+a.replace("'","''")+"'"}};var e=/^(.*)\(\'(.*)\'\)$/i;f.config={id:"",baseUrl:"",resources:{}};
var g={groups:{$count:function(){},$sum:function(){}},funcs:{month:function(a){return c.date.isoToDate(a).getMonth()},year:function(a){return c.date.isoToDate(a).getFullYear()}},_parseQuery:function(a){var b={};a&&a.replace(/([^&=;]*)=?([^&;]*)/g,function(a,h,c){h&&(b[h]=decodeURIComponent(c))});return b},_execSDATA:function(a,b){if(a.createActivity||a.editActivity)return g._startEditActivity(a,b);if(a.entity==j.sdataKey.workingCopies)return g._loadDraft(a,b);g.makeURL(a);return f.sendSDataRequest(a,
b)},makeURL:function(a){var b=[a.base,a.application,"/"+a.contract,"/"+a.dataset];b.push("/"+a.entity);a.id&&b.push("('"+a.id+"')");a.template&&b.push("/$template");a.createActivity&&b.push("/"+j.sdataKey.workingCopies);a.editActivity&&b.push("/"+j.sdataKey.workingCopies);if(a.createActivity||a.editActivity)if(a.query=a.query||{},!a.query.trackingId)a.query.trackingId=c.uuid();if(a.query){var d=Object.keys(a.query);d&&d.forEach(function(d,e){e?b.push("&"):b.push("?");b.push(d+"="+c.encodeURIComponent(a.query[d]))})}a.uri=
b.join("")},logSdata:function(a,b){c.trace.sdata&&(c.log(a),c.log((b.method||"GET")+": "+b.uri))},_loadDraft:function(a,b){f.loadDraft(a.id,function(a){if(!a)return b.success(null,{status:404});var h=a.data;h.$info={original_url:a.original_url};return b.success(h,{status:200})})},_startEditActivity:function(a,b){g.makeURL(a);g.logSdata("Virtual operation: Start edit activity ",a);var d=i.extend(d,a),e=i.extend(!0,{},a);delete e.query.trackingId;e.createActivity?delete e.createActivity:e.editActivity&&
delete e.editActivity;g._execSDATA(e,{success:function(l,q){q=q||{};g.makeURL(e);var o=e.uri;if(!l&&400<q.status&&e.template&&f.config){var s=f.url2proto(e);if(s)l=j.proto2Instance(s),q.status=200}if(300<q.status)return 404==q.status&&e.template&&c.pushException({message:c.format(c.locale().sdata.S404,[d.uri])},c.locale().actions.syncronize),b.success(null,q);s=!1;if(e.template){var l=l||{},m=f.url2proto(e),s=!0;if(m){if(j.useUuid(m))l.$uuid=c.uuid()}else l.$uuid=c.uuid()}else if(!l)return b.success(null,
q);l.$trackingId=a.query.trackingId;e.entity=j.sdataKey.workingCopies;e.template=!1;e.id=a.query.trackingId;g.makeURL(e);o={id:l.$trackingId,data:l,original_url:o};if(!s)o.original_data=i.extend(!0,{},l),delete o.original_data.$trackingId;f.createDraft(o,function(a){var m=i.extend(!0,{},a.data);m.$info={original_url:a.original_url};return b.success(m,{status:201,location:e.uri})})}})},_parseSE:function(a){var b={prefix:a,content:""};if((a=e.exec(a))&&3==a.length)b.prefix=a[1],b.content=a[2];return b},
parseSDataURL:function(a){var b=a.split("/sdata/"),c=null;if(2==b.length){c={base:b[0]+"/sdata/",query:{},sdata:"sdata",origUri:a};b=b[1].split("?");if(2==b.length)c.query=g._parseQuery(b[1]);var a=b[0].split("'"),d="";3===a.length?(a[1]=encodeURIComponent(decodeURIComponent(a[1])),d=a.join("'")):d=b[0];b=d.split("/");if(3>b.length)return null;c.application=b[0];c.contract=b[1];c.dataset=b[2];if(4>b.length)return c;c.entity=b[3];a=g._parseSE(c.entity);c.entity=a.prefix;c.id=a.content;if(4<b.length)if(a=
b[4],"$template"==a)c.template=!0;else if(a==j.sdataKey.workingCopies&&c.id)c.editActivity=!0;if(5<b.length&&(a=b[5],c.template&&a==j.sdataKey.workingCopies))c.createActivity=!0}return c}};f._cleanHeaders=function(a){a&&(delete a.$httpMethod,delete a.$httpStatus,delete a.$httpMessage,delete a.$httpLocation)};f.authenticate=function(a){if(c.online()){if(f.capabilities.authRequired&&f.capabilities.auth)return f.capabilities.auth(function(b,d){a(b,d,!c.online())});if(f.capabilities.loadLocale&&f.capabilities.localeLoader)return f.capabilities.localeLoader(function(){return a(null,
!1,!c.online())},!1)}return a(null,!1,!c.online())};f.execBatch=function(a,b,c){if(!a&&!c)return b.success();f.authenticate(function(d,e,g){if(e||g)b.success&&b.success();else return f._execBatch(a,b,c)})};f._execBatch=function(a,b,d){i.mobile.loading("show",{theme:"a",text:c.locale().ui.sending});var e=function(a){d({$reinstall:!0},null,function(){a.success()})},g=function(a){if(!c.hasErrors()&&d)return e({success:function(){i.mobile.loading("hide");if(a.success)return a.success()}});i.mobile.loading("hide");
if(a.success)return a.success()};if(!a)return g(b);c.each(Object.keys(a),function(b,d,e){var d=a[b],m=f.entityMeta(b),n=f.config.baseUrl+"/"+m.pluralType,g={$url:n+"/$batch?representation="+b+"."+l.store_facet,$resources:[]},k=[];d.forEach(function(a){var m;if(a.$info.status==i.sdata.STATUS.CREATED)k.push(a.$info),m=a,m.$httpMethod="POST",m.$url=n+"?representation="+b+"."+l.store_facet,delete m.$info;else if(a.$info.status==i.sdata.STATUS.MODIFIED)k.push(a.$info),m=a,m.$httpMethod="PUT",m.$httpifMatch=
m.$etag,delete m.$info;else if(a.$info.status==i.sdata.STATUS.DELETED){k.push(a.$info);m={$httpMethod:"DELETE"};m.$httpifMatch=a.$etag;m.$url=a.$info.url;var c=f.parseSdataUri(m.$url);if(a.$uuid)m.$uuid=a.$uuid;m.$key=c.id}m&&g.$resources.push(m)});g.$resources.length?(d={Accept:"application/json;vnd.sage="+l.vnd_sage},c.addCustomHeaders(d,!1),i.ajax({headers:d,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:g.$url,data:JSON.stringify(g),success:function(a){a.$resources?
c.each(a.$resources,function(a,b,m){var h=g.$resources[b],b=k[b].url,d;d=f.parseSdataUri(b);if("PUT"==h.$httpMethod)switch(a.$httpStatus){case 200:return f._cleanHeaders(a),i.sdata.updData(b,{data:a,original_data:null,status:i.sdata.STATUS.ORIGINAL,last_error:""},m);case 400:return f._cleanHeaders(a),d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.modify_before),f._cleanHeaders(h),i.sdata.updData(b,{$load:!0,data:a,status:i.sdata.STATUS.MODIFIED,last_error:d.message},
m);case 410:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.S410),f._cleanHeaders(a),i.sdata.delData(b,m);case 412:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.S412),f._cleanHeaders(a),i.sdata.updData(b,{data:a,original_data:null,status:i.sdata.STATUS.ORIGINAL,last_error:""},m);case 500:return d=c.extractErrors(a,a.$httpMessage),i.sdata.updData(b,{$load:!0,last_error:d.message},m);case 503:return d=
c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.S503),m();default:return c.pushException({message:c.locale().sdata.invalid_response},c.locale().sdata.invalid_response),m()}else if("POST"==h.$httpMethod)switch(a.$httpStatus){case 201:var e=f.createUrl(a.$httpLocation,d,a);return i.sdata.delData(b,function(){if(f.store(e))return i.sdata.insData(e,a,m);m()});case 202:return c.pushException({message:c.locale().post_ni}),m();case 400:return d=c.extractErrors(a,a.$httpMessage),
c.pushException({message:d.message},c.locale().sdata.modify_before),i.sdata.updData(b,{$load:!0,last_error:d.message},m);case 403:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.SC_canceled),i.sdata.undoUpdate(b,m);case 404:return d=c.extractErrors(a,a.$httpMessage),i.sdata.updData(b,{$load:!0,last_error:d.message},m);case 409:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.modify_before),i.sdata.updData(b,
{$load:!0,last_error:d.message},m);case 503:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.S503),m();case 500:return d=c.extractErrors(a,a.$httpMessage),i.sdata.updData(b,{$load:!0,last_error:d.message},m);default:return c.pushException({message:c.locale().sdata.invalid_response},c.locale().sdata.invalid_response),m()}else if("DELETE"==h.$httpMethod)switch(a.$httpStatus){case 200:case 410:return i.sdata.delData(b,m);case 400:return f._cleanHeaders(a),
d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.modify_before),d=c.extractErrors(a,a.$httpMessage),i.sdata.updData(b,{$load:!0,last_error:d.message},m);case 403:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.SD_canceled),i.sdata.undoUpdate(b,m);case 412:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.SD412),f._cleanHeaders(a),i.sdata.updData(b,{data:a,original_data:null,
status:i.sdata.STATUS.ORIGINAL,last_error:""},m);case 500:return f._cleanHeaders(a),d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.modify_before),d=c.extractErrors(a,a.$httpMessage),i.sdata.updData(b,{$load:!0,last_error:d.message},m);case 503:return d=c.extractErrors(a,a.$httpMessage),c.pushException({message:d.message},c.locale().sdata.S503),m();default:return c.pushException({message:c.locale().sdata.invalid_response},c.locale().sdata.invalid_response),
m()}m()},function(){e()}):e()},error:function(a,b,m){c.pushAjaxError(a,b,m,g.$url,"POST");e()}})):e()},function(){return g(b)})};f.createDraft=function(a,b){b(a)};f.saveDraft=function(a,b,d){d()};f.deleteDraft=function(a,b){b()};f.undoUpdate=function(a,b){b()};f.deleteDataByDraft=function(a,b){b()};f.updateDraft=function(){};f.loadDraft=function(a,b){b(null)};f.initData=function(a,b,d,c){c()};f.updData=function(a,b,d){d(null)};f.insData=function(a,b,d){d(null)};f.getSyncData=function(a){a(null)};
f.execWhere=function(){return!0};f.parseWhere=function(){return null};f.groupFunc=function(a){return!a?!1:null!=g.groups[a]};f._parseProp=function(a,b){var a=a.trim(),d={name:a,func:null};if(!b)return d;if(")"==a[a.length-1]){var c=a.indexOf("(");if(0<c)d.func=a.substr(0,c),d.name="$count"==d.func?"$count":a.substr(c+1,a.length-c-2)}return d};f.getFunc=function(a){return g.funcs[a]};f.applyFunc=function(a,b){var d=f.getFunc(b);return d?d(a):a};f.addSelected=function(a,b,d,c){b.forEach(function(b){if(b.group)if(c){if("$count"==
b.name)d.$count=1}else"$count"==b.name&&d.$count++;else if(c){var e=i.sdata.syncGetValue(a,b.name);b.func&&(e=i.sdata.applyFunc(e,b.func));var g=d;if(b.func)g[b.func+"("+b.name+")"]=e;else{for(var b=b.name.split("."),f=0,m=b.length-1;f<m;f++)g[b[f]]||(g[b[f]]={}),g=g[b[f]];g[b[b.length-1]]=e}}})};f.getSyncCount=function(a){f.getSyncDataCount(function(b){a(b)})};f.getSyncDataCount=function(a){a(0)};f.getModifiedData=function(a,b){b(null)};f.translateURL=function(a){var b;if(f.urlmap){if(b=f.urlmap.key.indexOf(a),
0<=b)return f.urlmap.value[b]}else f.hack_replace&&(b=a.indexOf(f.hack_replace.src),0==b&&(a=f.hack_replace.dst+a.substring(f.hack_replace.src.length)));0>a.indexOf("device=")&&(b=0>a.indexOf("?")?"?":"&",a=a+b+"device=phone");return a};f.post=function(a,b,d,e,g){var j=!1,o,s=function(m){c.trace.ajax&&c.log("POST "+a);var n={Accept:"application/json;vnd.sage="+l.vnd_sage};e&&i.extend(n,e);j=c.addCustomHeaders(n,m);var t=f.translateURL(a);i.ajax({headers:n,type:"POST",dataType:"json",data:JSON.stringify(b),
url:t,contentType:"application/json; charset=utf-8",success:function(b){if(f.hack_replace&&a!=t)var m=RegExp(f.hack_replace.src.replace(/\//g,"/"),"g"),b=JSON.parse(JSON.stringify(b).replace(m,f.hack_replace.dst));c.trace.ajax&&(c.log("Response: "),c.log(b));d(b)},error:function(b,m,e){if(g&&g.ignoreErrors)return d(null);if(401===n&&j)return o();c.pushAjaxError(b,m,e,a,"POST");var n=b?b.status:200;if(401===n)f.capabilities.resetInterval=!0;d(null)}})};o=function(){return s(!0)};s(!1)};f.GET=function(a,
b,d,e){var g=!1,j,o=function(o){c.trace.ajax&&c.log("GET "+a);var m={Accept:"application/json;vnd.sage="+l.vnd_sage};d&&i.extend(m,d);g=c.addCustomHeaders(m,o);var n=f.translateURL(a);i.ajax({headers:m,type:"GET",dataType:"json",url:n,timeout:e&&e.timeout?e.timeout:0,success:function(m,d,e){f.hack_replace&&a!=n&&(d=RegExp(f.hack_replace.src.replace(/\//g,"/"),"g"),m=JSON.parse(JSON.stringify(m).replace(d,f.hack_replace.dst)));c.trace.ajax&&(c.log("Response: "),c.log(m));e={status:e?e.status:200,location:e?
e.getResponseHeader("Location"):""};b(m,e)},error:function(m,d,n){c.trace.ajax&&(c.log(d),c.log(n),c.log(m));var o=m?m.status:200;if(401===o&&g)return j();if(e&&e.Authenticate&&401===o)return c.pushAjaxError(m,d,n,a,"GET"),m=m?m.getResponseHeader("WWW-Authenticate"):"",b(null,{status:o,"WWW-Authenticate":m});c.pushAjaxError(m,d,n,a,"GET");if(401===o)f.capabilities.resetInterval=!0;o={status:o,location:m?m.getResponseHeader("Location"):""};b(null,o)}})};j=function(){return o(!0)};o(!1)};f.applicationDetails=
function(a,b){var d={baseURL:a.baseURL},c=f.parseSdataUri(a.baseURL);d.applicationName=c.application;d.contractName=c.contract;d.endpointName=c.dataset;f.post(f.$url(a,a.url),d,function(a){b(a)})};f.syncGetValue=function(a,b){var d=b.split("."),c=!1,e=a;if(!a)return null;d.forEach(function(a){var h;if(!c){if((h=(e=e[a])?e.$key||e.$uuid:!1,a=h)&&f.loadCache&&f.loadCache[a])e=f.loadCache[a].data;c=null==e}});return e};f.applicationList=function(a){var b=f.sdataAdmin(),d=f.parseSdataUri(b);f.authenticate(function(c,
e,g){e||g?a.success&&a.success(null):f.GET(b,function(b){var c=[],m="";if(b&&b.$resources){if(b.$baseUrl)m=b.$baseUrl,delete b.$baseUrl;b.$resources.forEach(function(a){if(a&&a.endpoints&&a.endpoints.length){var b={url:a.installUrl,title:a.title,description:a.description||a.title,icon:a.icon||"",baseURL:d.base+a.applicationName+"/"+a.contract+"/",datasets:a.endpoints};if(m&&0>b.url.indexOf(m))b.url=m+b.url;if(b.url&&"/"==b.url.charAt(0))b.url=f.sdataHost+b.url;delete a.endpoints;c.push(b)}})}a.success&&
a.success(c)})})};f.removeFromDB=function(a,b){b()};f.clearSdata=function(a,b){b()};f.delData=function(a,b){b()};f.sendSDataRequest=function(a,b){g.logSdata("Real operation: Send SDATA request: ",a);var d=b.success;if(!f.store(a.uri))return f.getModifiedData(a,function(d){if(a.id){if(d&&d[a.id])return d[a.id].status===i.sdata.STATUS.DELETED?b.success(null,{status:404}):b.success(d[a.id].data,{status:200});f.execGetSData(a,b)}else if(!a.template&&d&&Object.keys(d).length){var c=!0,e=f.url2proto(a);
if(e&&e.$properties.$resources)e=e.$properties.$resources.$item,e=e.$item||e,c=j.useUuid(e);f.execGetSData(a,{success:function(a,h){if(a&&a.$resources)for(var m=a.$resources.length,n;m--;)if(n=a.$resources[m],n=c?n.$uuid||n.$key:j.parseExpression(e.$key,{data:j.exprData(n),$prototype:e},"$key"),d[n])d[n].status===i.sdata.STATUS.DELETED?a.$resources.splice(m,1):a.$resources[m]=d[n].data;b.success(a,h)}})}else f.execGetSData(a,b)});b.success=function(a,b){c.trace.ajax&&(c.log("Response: "),c.log(a));
d&&d(a,b)};f.execGetSData(a,b)};f.execGetSData=function(a,b){var d=f.store(a),e=!d&&f.cache(a),g=e&&!c.online(),g=e;if(!d&&!g)f.authenticate(function(d,m,c){if(m||c)return b.success();f.GET(a.uri,function(m,d){if(f.addCache&&e&&!a.query.where)return f.addCache(f.config.id,a.query.representation,(m?m.$resources:[])||[],function(){b.success(m,d)});b.success(m,d)})});else{if((d=f.url2proto(a))&&d.$properties&&d.$properties.$resources&&d.$properties.$resources.$item){if(a.query.where||a.query.filter){var l=
a.query.where||"";if(a.query.filter&&d&&d.$filters&&d.$filters[a.query.filter]){var o=d.$filters[a.query.filter].$where||"";o&&(l=l?l+" and "+o:o)}if(l)a.pwhere=f.parseWhere(l)}if(!a.query||!a.query.orderBy||d.$properties.$resources.$item.$defaultOrder)a.query=a.query||{},a.query.orderBy=d.$properties.$resources.$item.$defaultOrder}f.getSData(a,g,b.success)}};f.getSData=function(a,b,d){d&&d("Not found",{status:404})};f.addCache=function(a,b,d,c){c&&c()};f.execURL=function(a,b){f.config&&f.config.baseUrl&&
(a=f.$url({$baseURI:f.config.baseUrl},a));var d=g.parseSDataURL(a);d?g._execSDATA(d,b):b.success&&b.success("Not Implemented",{status:500})};f.parseSdataUri=function(a){return g.parseSDataURL(a)};f.getUri=function(a){g.makeURL(a);return a.uri};f.entityUri=function(b,d){var c=[b.base,b.application,"/"+b.contract,"/"+b.dataset];c.push("/"+b.entity);d&&b.query&&c.push("?representation="+a(b.query.representation||""));return c.join("")};f.getBaseUrl=function(a){return[a.base,a.application,"/"+a.contract,
"/"+a.dataset,"/"].join("")};f.entityMeta=function(a){return f.config.entities?f.config.entities[a]:null};f.getInstalledApps=function(a,b){b([])};f.startLoad=function(){};f.endLoad=function(){};f.getAppConfig=function(a,b){b(null)};f.saveAppConfig=function(a,b){b(null)};f.installApp=function(a,b){b(null,!0)};f.execSearch=function(a,b,d){for(var b=Object.keys(b),c=b.length,d=d.toUpperCase();c--;){var e=a[b[c]];if(e&&0<=e.toUpperCase().indexOf(d))return!0}return!1};f.downloadLocale=function(a,b){var d=
c.extractLang(a);return d?f.GET("./mobile/js/locale/mobile-"+d+".json",function(a){return a?(c.translate(d,a),b(d)):b("")}):b()}})(jQuery);(function(i){var c=i.helpers,j=i.sdata||{};i.sdata=j;var f={identifier:"identifier",operator:"operator",literal:"literal"};j.tokenType=f;(function(l){function d(a,b,d,c,e,m,n){this.code=a;this.text=b;this.precedence=d;this.isPrefix=c;this.isInfix=e;this.isAssociative=m;this.isPredicate=n}function a(){this.operators={};this.init()}function b(a,b,d,c,e){this.type=a;this.value=e;this.getRemainingText=function(){return b.substring(d,b.length)}}function e(a){this.children=null;if(a.operator)this.type=
"operator",this.value=a.operator,this.children=[],a.expression1&&this.children.push(a.expression1),a.expression2&&this.children.push(a.expression2);else if(a.expressionType&&(this.type=a.expressionType,this.value=a.value,this.svalue=a.svalue,this.dataType=a.dataType,"function"===this.type))this.children=[]}function g(a,b){if("identifier"==b.type)b.property=i.sdata.syncGetValue(a,b.value);else if("literal"==b.type)b.property="datetime"==b.dataType?b.svalue:b.value;else if(b.children)if("operator"==
b.type)switch(b.value.code){case "and":b.children.forEach(function(b){g(a,b)});b.property=b.children[0].property&&b.children[1].property;break;case "or":b.children.forEach(function(b){g(a,b)});b.property=b.children[0].property||b.children[1].property;break;case "between":b.children.forEach(function(b){g(a,b)});b.property=b.children[0].property>=b.children[1].property&&b.children[0].property<=b.children[2].property;break;case "=":b.children.forEach(function(b){g(a,b)});b.property=b.children[0].property==
b.children[1].property;break;case ".":g(a,b.children[0]);g(b.children[0].property,b.children[1]);b.property=b.children[1].property;break;default:b.property=null,b.children.forEach(function(b){g(a,b);if("literal"==b.type)b.property=null})}else if("function"==b.type){var d=[];b.children&&b.children.forEach(function(b){g(a,b);d.push(b.property)});var c=i.sdata.getFunc(b.value);if(c)b.property=c.apply(i.sdata,d)}}c.extend(d.prototype,{toString:function(){return this.text}});c.extend(a.prototype,{_createOp:function(a,
b,c,e,h,m,n){a=new d(a||b,b,c,e,h,m,n);this.operators[a.text]=a},init:function(){this._createOp(null,".",1,!1,!0,!0,!1);this._createOp(null,"not",2,!0,!1,!1,!1);this._createOp("*","mul",3,!1,!0,!0,!1);this._createOp("/","div",3,!1,!0,!0,!1);this._createOp("%","mod",3,!1,!0,!0,!1);this._createOp(null,"+",4,!1,!0,!0,!1);this._createOp(null,"-",4,!0,!0,!0,!1);this._createOp("=","eq",5,!1,!0,!1,!0);this._createOp("<>","ne",5,!1,!0,!1,!0);this._createOp("<","lt",5,!1,!0,!1,!0);this._createOp("<=","le",
5,!1,!0,!1,!0);this._createOp(">","gt",5,!1,!0,!1,!0);this._createOp(">=","ge",5,!1,!0,!1,!0);this._createOp(null,"between",5,!1,!0,!1,!0);this._createOp(null,"in",5,!1,!0,!1,!0);this._createOp(null,"like",5,!1,!0,!1,!0);this._createOp(null,"and",6,!1,!0,!0,!0);this._createOp(null,"or",7,!1,!0,!0,!0);this._createOp(null,"(",8,!0,!1,!1,!1);this._createOp(null,")",8,!1,!1,!1,!1);this._createOp(null,",",8,!1,!1,!1,!1)}});var h=new a;c.extend(b.prototype,{matches:function(a){return this.value instanceof
d&&this.value.code==a}});var k=new function(){this.tokenize=function(a){for(var d=[],c=0;c<a.length;){for(;c<a.length&&" "===a[c];)c++;var e=a[c];switch(e){case "@":for(var g=e=a,m=c,c=d,n=m+1,t=g.length;n<t&&!("@"==g[n]);)n++;if(n===g.length)throw Error("date constant not terminated:"+e.substring(m,e.length));g=g.substr(m+1,n-m-1);t=new Date(g);if(null!=t)e=new b(f.literal,e,m,n+1-m,t),e.dataType="datetime",e.svalue=g,c.push(e);c=n+1;break;case '"':case "'":a:{for(var n=e=a,g=c,c=d,t=n[g],m=g+1,
k="";m<n.length;){if(n[m]===t&&(m++,m===n.length||n[m]!==t)){e=new b(f.literal,e,g,m-g,k);e.dataType="string";c.push(e);c=m;break a}k+=n[m++]}throw Error("quoted string not terminated: "+e.substring(g));}break;case "-":case "+":case "(":case ")":case ",":d.push(new b(f.operator,a,c,1,h.operators[e]));c+=1;break;default:if(/[a-zA-Z%']/.test(e)){g=e=a;n=d;m=c+1;for(t=void 0;m<g.length&&/[a-zA-Z0-9_%.%']/.test(g[m]);)m++;g=g.substr(c,m-c);t=h.operators[g.toLowerCase()];null!=t?n.push(new b(f.operator,
e,c,m-c,t)):("true"===g||"false"===g||"null"===g?(t=new b(f.literal,e,c,m-c,g),t.dataType="bool"):(t=new b(f.identifier,e,c,m-c,g),t.dataType="word"),n.push(t));c=m}else if(/[0-9]/.test(e)){n=e=a;m=d;g=c+1;for(t=k=void 0;g<n.length&&/[0-9]/.test(n[g]);)g++;k=void 0;if(g<n.length&&"."===n[g]){for(g++;g<n.length&&/[0-9]/.test(n[g]);)g++;k=parseFloat(e.substring(c,g));t="float"}else k=parseInt(e.substring(c,g),10),t="int";k=new b(f.literal,e,c,g-c,k);k.dataType=t;m.push(k);c=g}else throw Error("invalid character: "+
a.substring(c));}}return d};return this};c.extend(e.prototype,{isPredicate:function(){switch(this.type){case "operator":return this.value.isPredicate;case "identifier":return!0;case "function":return!0;case "literal":return!1;default:throw Error("invalid expression type: "+this.type);}},toString:function(){if(null==this.children)return this.value.toString();var a=[];a.push("["+this.value.toString());for(var b=0;b<this.children.length;b++)a.push(" "+this.children[b].toString());a.push("]");return a.join("")}});
var j=new function(){function a(c,g,m){var n;a:{if(g[0]==c.length)throw Error("premature end of expression");n=c[g[0]];switch(n.type){case f.identifier:g[0]++;if(g[0]<c.length&&c[g[0]].matches("(")){g[0]++;var h=new e({expressionType:"function",value:n.value});b(c,n,g,h.children);n=h}else n=new e({expressionType:"identifier",value:n.value});break a;case f.literal:g[0]++;n=new e({expressionType:"literal",value:n.value,svalue:n.svalue,dataType:n.dataType});break a;case f.operator:h=n.value;if(!h.isPrefix)throw Error("invalid expression: expected beginning of term at "+
n.getRemainingText());g[0]++;b:switch(h.code){case "-":case "not":n=a(c,g,1);n=new e({operator:h,expression1:n});break b;case "(":n=a(c,g,h.precedence);if(g[0]==c.length||!c[g[0]].matches(")"))throw Error("invalid expression: expected ')' after "+c[g[0]-1].getRemainingText());g[0]++;break b;default:throw Error("internal error: bad prefix operator "+h.code);}break a;default:throw Error("internal error: bad token type "+n.type);}}for(;g[0]<c.length;){var k=c[g[0]],h=k.value instanceof d?k.value:null;
if(null==h||!h.isInfix||h.precedence>m)break;g[0]++;if("in"==h.code){if(g[0]===c.length||!c[g[0]].matches("("))throw Error("invalid expression: '(' expected after "+k.getRemainingText());g[0]++;n=new e({operator:h,expression1:n});b(c,k,g,n.children)}else if(k=a(c,g,h.precedence-1),n=new e({operator:h,expression1:n,expression2:k}),"between"==h.code){var l=c,i=g,k=n,j=h.precedence;if(i[0]==l.length||!l[i[0]].matches("and"))throw Error("invalid expression: expected 'and' after "+l[i[0]-1].getRemainingText());
i[0]++;l=a(l,i,j);k.children.push(l)}if(!h.isAssociative&&h.precedence==m)break}return n}function b(d,e,m,g){if(m[0]<d.length&&d[m[0]].matches(")"))m[0]++;else{for(;m[0]<d.length;){var h=a(d,m,c);g.push(h);if(m[0]<d.length&&d[m[0]].matches(")")){m[0]++;return}if(m[0]==d.length||!d[m[0]].matches(","))throw Error("invalid expression: expected ',' or ')' at "+d[m[0]].getRemainingText());m[0]++}throw Error("invalid function call syntax: argument missing after "+e.getRemainingText());}}var c=8;this.parse=
function(b){if(null==b||0==b.length)return null;var b=k.tokenize(b),d=[0],m=a(b,d,c);if(d[0]!=b.length)throw Error("invalid expression: unexpected token at "+b[d[0]].getRemainingText());return m};return this};l.parseWhere=function(a){return j.parse(a)};l.execWhere=function(a,b){if(null==b)return!0;g(a,b);return b.property}})(j)})(jQuery);(function(i){function c(){this.init()}function j(){this.init()}var f=i.helpers,l=i.proto,d=i.sdata;i.sdatadb=i.sdatadb||{};var a=function(a,b){return!a?(b(null,!0),!1):!0};if("webkitIndexedDB"in window)window.indexedDB=window.webkitIndexedDB,window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange,window.IDBDatabaseException=window.webkitIDBDatabaseException;var b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;if(b&&!window.IDBTransaction.READ_WRITE)window.IDBTransaction.READ_ONLY=
"readonly",window.IDBTransaction.READ_WRITE="readwrite";var e={migration:{columns:{version:{def:"version text"}}},draft:{columns:{id:{def:"id TEXT  PRIMARY KEY"},appid:{def:"appid TEXT"},original_url:{def:"original_url TEXT"},data:{def:"data TEXT"},original_data:{def:"original_data TEXT"}}},sdata:{columns:{appid:{def:"appid TEXT"},url:{def:"url TEXT PRIMARY KEY"},entity_url:{def:"entity_url TEXT"},data:{def:"data TEXT"},original_data:{def:"original_data TEXT"},status:{def:"status integer"},updated:{def:"updated TEXT"},
last_error:{def:"last_error TEXT"}}},sdatacache:{columns:{id:{def:"id TEXT"},appid:{def:"appid TEXT"},entity:{def:"entity TEXT"},data:{def:"data TEXT"}}},apps:{columns:{id:{def:"id TEXT PRIMARY KEY"},url:{def:"url TEXT"},title:{def:"title TEXT"},description:{def:"description TEXT"},icon:{def:"icon TEXT"},baseURL:{def:"baseURL TEXT"},version:{def:"version TEXT"},data:{def:"data TEXT"}}}},g=function(a){var b=["CREATE TABLE IF NOT EXISTS"];b.push(a);b.push("(");var d=e[a].columns;Object.keys(d).forEach(function(a,
m){b.push((m?",":"")+d[a].def)});b.push(")");return b.join(" ")},h=function(a,b){if(b)b.$info={status:a.status,last_error:a.last_error};return b},k=function(a,b,c,e,g,h,f){if(b&&d.execWhere(b,e.pwhere)&&(!f||d.execSearch(b,f,e.query.search)))if(e.pgroupBy){var o="",k="",a=!1;e.pgroupBy.forEach(function(a){var c=d.syncGetValue(b,a.name);a.func&&(c=d.applyFunc(c,a.func));o=o+k+c;k="#"});c=g.indexOf(o);0>c&&(a=!0,g.push(o),c=g.length-1,h[c+""]={});d.addSelected(b,e.pselected,h[c+""],a)}else b.$info=
{status:a.status,last_error:a.last_error},c.push(b)},u=function(a){if(!a.appid)a.appid=d.config.id;var b=d.parseSdataUri(a.url);if(0>a.url.indexOf("appid="))a.url=a.url+"&appid="+a.appid;delete b.id;delete b.query.appid;a.entity_url=d.getUri(b);a.data&&(delete a.data.$info,delete a.data.$trackingId);a.status=a.status||d.STATUS.ORIGINAL;a.updated=a.data?a.data.$updated||a.data.$updDate||(new Date).toISOString():(new Date).toISOString();a.last_error=a.last_error||""},r=function(a,b,c,e){h(b,c);delete a.query.appid;
c.$info.url=d.getUri(a);c.$info.title=l.parseExpression(e.$value,{data:l.exprData(c),$prototype:e},"$value");return c},p={version:3,_createObjectStore:function(a){a.objectStoreNames.contains("draft")&&a.deleteObjectStore("draft");a.objectStoreNames.contains("sdata")&&a.deleteObjectStore("sdata");a.objectStoreNames.contains("apps")&&a.deleteObjectStore("apps");a.objectStoreNames.contains("sdatacache")&&a.deleteObjectStore("apps");var b=a.createObjectStore("draft",{keyPath:"id"});b.createIndex("appid",
"appid",{unique:!1});b.createIndex("original_url","original_url",{unique:!1});b=a.createObjectStore("sdata",{keyPath:"url"});b.createIndex("appid","appid",{unique:!1});b.createIndex("entity_url","entity_url",{unique:!1});b.createIndex("status","status",{unique:!1});b=a.createObjectStore("apps",{keyPath:"id"});b.createIndex("url","url",{unique:!1});b=a.createObjectStore("sdatacache",{keyPath:"id"});b.createIndex("appid","appid",{unique:!1});b.createIndex("entity","entity",{unique:!1})},_openDB:function(a){try{var d=
b.open("sage-mge-test",p.version)}catch(c){f.pushException(c,f.locale().ui.no_db_support_sol);a(null,c);return}try{d.onupgradeneeded=function(a){p._createObjectStore(a.target.result||a.target.source)}}catch(e){}d.onsuccess=function(b){var d=b.target.result||b.target.source;!d.setVersion&&p.version!=d.version?(b=d.setVersion(p.version),b.onsuccess=function(){p._createObjectStore(d);a(d,void 0)},b.onerror=function(b){f.pushdbError(b);a(null,b)}):a(d,void 0)};d.onerror=function(b){f.pushdbError(b);a(null,
b)}},_getSDataByUrl:function(a,b,c){0>a.indexOf("appid=")&&(a=a+"&appid="+d.config.id);a=b.get(a);a.onerror=function(a){c(null,a)};a.onsuccess=function(a){c(a.target.result)}},_rmvSDataByUrl:function(a,b,c){0>a.indexOf("appid=")&&(a=a+"&appid="+d.config.id);a=b["delete"](a);a.onerror=function(a){c(null,a)};a.onsuccess=function(){c(null)}},_insData:function(b,d,c,e){if(a(b,e))return b=b.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata"),p._insertSdata({data:c,url:d},b,e)},_insertSdata:function(a,
b,d){u(a);try{var c=b.add(a);c.onerror=function(a){f.pushdbError(a);d(null,a)};c.onsuccess=function(){d(null)}}catch(e){f.pushdbError(e)}},_updSDataByUrl:function(a,b,d,c){u(b);a=d.put(b);a.onerror=function(a){c(null,a)};a.onsuccess=function(){c(null)}},_saveDraft:function(b,c,e,g){if(a(b,g)){var h=b.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(c);h.onsuccess=function(a){if(a.target.result){var a=a.target.result,h=d.parseSdataUri(a.original_url),f=b.transaction(["sdata",
"draft"],IDBTransaction.READ_WRITE),o=!1;if(h.template)o=!0,h.template=!1,h.id=d.data2id(h,a.data);h.createActivity=!1;h.editActivity=!1;var h=d.url2local(h),k={url:h,data:e,original_data:a.original_data};delete a.original_data;var l=f.objectStore("sdata");p._getSDataByUrl(h,l,function(a){if(a){if(a.status===d.STATUS.DELETED)return p._deleteDraft(b,f,c,function(){g({status:404})});if(a.status===d.STATUS.ORIGINAL||a.status===d.STATUS.MODIFIED){if(a.status===d.STATUS.ORIGINAL)k.original_data=i.extend(!0,
{},a.data),k.status=d.STATUS.MODIFIED;else if(a.status===d.STATUS.MODIFIED)k.original_data=i.extend(!0,{},a.original_data),k.status=d.STATUS.MODIFIED;delete k.data.$info;delete k.data.$trackingId;if(k.original_data&&(delete k.original_data.$info,delete k.original_data.$trackingId,JSON.stringify(k.original_data)===JSON.stringify(k.data)&&(delete k.original_data,k.status=d.STATUS.ORIGINAL,!d.store(k.url))))return p._rmvSDataByUrl(k.url,l,function(){p._deleteDraft(b,f,c,function(){g({status:200})})})}else k.status=
d.STATUS.CREATED;return p._updSDataByUrl(k.url,k,l,function(){p._deleteDraft(b,f,c,function(){g({status:200})})})}o?(k.status=d.STATUS.CREATED,delete k.original_data):k.status=d.STATUS.MODIFIED;delete k.data.$info;delete k.data.$trackingId;if(k.original_data&&(delete k.original_data.$info,delete k.original_data.$trackingId,JSON.stringify(k.original_data)===JSON.stringify(k.data)))return delete k.original_data,k.status=d.STATUS.ORIGINAL,p._deleteDraft(b,f,c,function(){g({status:404})});p._insertSdata(k,
l,function(){p._deleteDraft(b,f,c,function(){g({status:200})})})})}else g({status:404})};h.onerror=function(a){f.pushdbError(a);g({status:404},a)}}},_deleteDataByDraft:function(b,d,c){if(a(b,c)){var e=b.transaction(["draft","sdata"],IDBTransaction.READ_WRITE);try{var g=e.objectStore("draft").get(d);g.onsuccess=function(a){if(a.target.result){var a=a.target.result,g=a.original_url,h=e.objectStore("sdata");p._markSdataDeleted(g,h,a.original_data?a.original_data:a.data,function(){return p._deleteDraft(b,
e,d,function(){c(null)})})}else c(null)};g.onerror=function(){c(null)}}catch(h){f.pushdbError(h),c(null)}}},_markSdataDeleted:function(a,b,c,e){var a=d.parseSdataUri(a),g=!1;if(a.template)g=!0,a.template=!1,a.id=d.data2id(a,c);a.createActivity=!1;a.editActivity=!1;var h=d.url2local(a);p._getSDataByUrl(h,b,function(a){if(a){if(a.status===d.STATUS.DELETED)return e(null);if(a.status===d.STATUS.MODIFIED||a.status===d.STATUS.ORIGINAL)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:
a.data,original_data:null,status:d.STATUS.DELETED},p._updSDataByUrl(a.url,a,b,function(){return e(null)});if(a.status===d.STATUS.CREATED)return p._rmvSDataByUrl(h,b,function(){return e(null)})}else{if(g)return e(null);p._insertSdata({url:h,data:c,original_data:null,status:d.STATUS.DELETED},b,function(){return e(null)})}})},_deleteDraft:function(b,d,c,e){if(a(b,e)){d=d||b.transaction(["draft"],IDBTransaction.READ_WRITE);try{var g=d.objectStore("draft")["delete"](c);g.onsuccess=function(){e(null)};
g.onerror=function(a){f.pushdbError(a);e(null,a)}}catch(h){f.pushdbError(h),e(null,h)}}},_uninstallSdataCache:function(a,b,d,c){try{var e=b.index("appid"),g=IDBKeyRange.only(d),h=e.openCursor(g);h.onsuccess=function(b){b.target.result?(b=b.target.result,b["delete"](),b["continue"]()):p._uninstallSdata(a,d,c)};h.onerror=function(){p._uninstallSdata(a,d,c)}}catch(k){f.log(k)}},_uninstallDraft:function(a,b,d,c,e){try{var g=a.index("appid"),h=IDBKeyRange.only(c),k=g.openCursor(h);k.onsuccess=function(a){a.target.result?
(a=a.target.result,a["delete"](),a["continue"]()):p._uninstallSdataCache(b,d,c,e)};k.onerror=function(){p._uninstallSdataCache(b,d,c,e)}}catch(o){f.log(o)}},_uninstallSdata:function(a,b,d){a=a.index("appid");b=IDBKeyRange.only(b);try{var c=a.openCursor(b);c.onsuccess=function(a){a.target.result?(a=a.target.result,a["delete"](),a["continue"]()):d()};c.onerror=function(){d()}}catch(e){f.log(e)}},_updateDraft:function(b,d,c,e){if(a(b,e))try{var g=b.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(d);
g.onsuccess=function(a){if(a.target.result){var g=a.target.result;g.data=c;p._deleteDraft(b,null,d,function(d,c){if(c)return e(null,a);var h=b.transaction(["draft"],IDBTransaction.READ_WRITE).objectStore("draft").add(g);h.onsuccess=function(){e(null)};h.onerror=function(a){e(null,a)}})}else e(null)};g.oerror=function(a){e(null,a)}}catch(h){f.log(h)}},_insertDraft:function(b,d,c,e){if(a(b,e))b=d.objectStore("draft").add(c),b.onsuccess=function(){e(c)},b.onerror=function(a){f.pushdbError(a);e(null,
a)}},_getSData:function(b,c,e,g){if(a(b,g)){var o=b.transaction([e?"sdatacache":"sdata"],IDBTransaction.READ_ONLY),l,i=[],j={},b=d.url2local(c,e),o=o.objectStore(e?"sdatacache":"sdata");try{if(c.id||c.template)l=o.get(b),l.onsuccess=function(a){a.target.result&&a.target.result.status<d.STATUS.DELETED?g(h(a.target.result,a.target.result.data),{status:200}):g(null,{status:404})},l.onerror=function(){g(null,{status:404})};else if(c.entity){var s={$url:c.uri,$resources:[]},r=d.url2search(c),u=o.index(e?
"entity":"entity_url"),p=IDBKeyRange.only(b);l=u.openCursor(p);l.onsuccess=function(a){if(a=a.target.result)a.value.appid===d.config.id&&(e||a.value.status<d.STATUS.DELETED)&&k(a.value,a.value.data,s.$resources,c,i,j,r),a["continue"]();else{if(c.pgroupBy)for(var b in j)s.$resources.push(j[b]);b=s.$resources;(a=f.sdataSort(c.query))&&f.applySDataSort(a,b);g(s,{status:200})}};l.onerror=function(a){a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?g(s,{status:200}):g("",{status:500})}}}catch(q){f.log(q)}}},
_getModifiedData:function(b,c,e){if(a(b,e)){var b=b.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),g=d.config?d.config.id:"",h=d.entityUri(c,!0),c=IDBKeyRange.lowerBound(d.STATUS.ORIGINAL,!0),c=b.openCursor(c),f={};c.onsuccess=function(a){if(a=a.target.result){if(a.value.appid===g&&a.value.entity_url===h){var b=a.value.data,c=d.parseSdataUri(a.value.url);f[c.id]={data:b,status:a.value.status}}a["continue"]()}else e(f)};c.onerror=function(){e(f)}}},_getSyncData:function(b,
c,e){if(a(b,e)){var b=b.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),g=d.config?d.config.id:"",h=IDBKeyRange.lowerBound(d.STATUS.ORIGINAL,!0);if(c){var c=b.openCursor(h),f=0;c.onsuccess=function(a){(a=a.target.result)?(a.value.appid===g&&f++,a["continue"]()):e(f)};c.onerror=function(){e(0)}}else{var k=null,c=b.openCursor(h);c.onsuccess=function(a){if(a=a.target.result){if(a.value.appid===g){var b=d.parseSdataUri(a.value.url),c=d.url2entity(b);k=k||{};var m=
k[c]||[];k[c]=m;c=a.value.data;r(b,a.value,c,d.url2proto(b));m.push(c)}a["continue"]()}else e(k)};c.onerror=function(){e(null)}}}},_undoUpdate:function(b,c,e){if(a(b,e)){b=b.transaction(["sdata"],IDBTransaction.READ_WRITE);try{var g=b.objectStore("sdata");p._getSDataByUrl(c,g,function(a){if(a)return!d.store(c)||a.status===d.STATUS.CREATED?p._rmvSDataByUrl(c,g,function(){e(null)}):p._updSDataByUrl(c,{appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:d.STATUS.ORIGINAL},
g,function(){e(null)});e(null)})}catch(h){f.log(h)}}},_installApp:function(b,c,d){if(a(b,d)){var e=b.transaction(["apps"],IDBTransaction.READ_WRITE).objectStore("apps"),b=e.index("url"),g=IDBKeyRange.only(c.url),b=b.openCursor(g),h=function(){var a=e.add(c);a.onerror=function(a){f.pushdbError(a);d()};a.onsuccess=function(){d()}};b.onsuccess=function(a){if(a=a.target.result){if(a.value.baseURL==c.baseURL)a["delete"]();a["continue"]()}else h()};b.onerror=function(a){a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?
h():(f.pushdbError(a),d())}}},_removeSdataCache:function(a,b,c,d){try{var e=a.index("entity"),g=IDBKeyRange.only(b),h=e.openCursor(g);h.onsuccess=function(a){if(a.target.result){a=a.target.result;if(a.value.appid===c)a["delete"]();a["continue"]()}else d()};h.onerror=function(){d()}}catch(k){f.log(k)}},_addCache:function(b,c,d,e,g){if(a(b,g)){b=b.transaction(["sdatacache"],IDBTransaction.READ_WRITE);b.oncomplete=function(){g()};b.onerror=function(){g()};var h=!1,k=b.objectStore("sdatacache");return p._removeSdataCache(k,
d,c,function(){e.forEach(function(a){if(!h)a={data:a,appid:c,entity:d,id:f.uuid()},k.add(a).onerror=function(){h=!0}})})}},_clearSdata:function(b,c,d,e){a(b,e)&&(d||(d=b.transaction(["sdata"],IDBTransaction.READ_WRITE)),b=d.objectStore("sdata"),p._uninstallSdata(b,c,e))},_removeFromDB:function(b,c,d){if(a(b,d)){var e=b.transaction(["apps","draft","sdata","sdatacache"],IDBTransaction.READ_WRITE),b=e.objectStore("sdata"),g=e.objectStore("draft"),h=e.objectStore("sdatacache");p._uninstallDraft(g,b,h,
c,function(){var a=e.objectStore("apps")["delete"](c);a.onsuccess=function(){d()};a.onerror=function(a){if(a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR)return d();f.pushdbError(a);d()}})}},_getAppConfig:function(b,c,d){if(a(b,d))c=b.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").get(c),c.onsuccess=function(a){if(a=a.target.result){a.data.id=a.id;var c=i.extend(!0,{},a.data);c.$info={url:a.url,version:a.version,title:a.title,icon:a.icon};p._getInstalledApps(b,!1,function(a){c.applications=
a;d(c)})}else d(null)},c.onerror=function(a){f.pushdbError(a);d(null,a)}},_saveAppConfig:function(b,c,d){if(a(b,d)){var e=b.transaction(["apps"],IDBTransaction.READ_WRITE).objectStore("apps"),b=e.get(c.id),g=null;b.onsuccess=function(a){a=a.target.result;delete c.$info;a.data=c;g=i.extend(!0,{},a);a?(a=e.put(g),a.onsuccess=a.onerror=function(){d(null)}):d(null)};b.onerror=function(a){f.pushdbError(a);d(null,a)}}},_getInstalledApps:function(b,c,d){if(a(b,d)){var b=b.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").index("url").openCursor(),
e=[];b.onsuccess=function(a){if(a=a.target.result){var b=a.value;e.push({id:b.id,url:b.url,title:b.title,description:b.description,icon:b.icon,baseURL:b.baseURL,version:b.version});a["continue"]()}else d(e)};b.onerror=function(a){a.target.errorCode!=IDBDatabaseException.NOT_FOUND_ERR&&f.pushdbError(a);d(e)}}},_delData:function(b,c,d){a(b,d)&&(b=b.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata"),p._rmvSDataByUrl(c,b,d))},_updData:function(b,c,e,g){if(a(b,g)){var h=b.transaction(["sdata"],
IDBTransaction.READ_WRITE).objectStore("sdata");e.url=c;var f=function(){return e.status===d.STATUS.ORIGINAL&&!d.store(c)?p._rmvSDataByUrl(c,h,function(a,b){g(null,b)}):p._updSDataByUrl(c,e,h,function(a,b){g(null,b)})};e.$load?(delete e.$load,p._getSDataByUrl(e.url,h,function(a){Object.keys(e).forEach(function(b){a[b]=e[b]});e=a;f()})):f()}},_initData:function(b,c,e,g,h){if(a(b,h)){b=b.transaction(["sdata"],IDBTransaction.READ_WRITE);b.oncomplete=function(){h()};b.onerror=function(a){f.pushdbError(a);
h()};var k=!1,o=b.objectStore("sdata");e.forEach(function(a){if(!k)a={data:a,appid:c.id,url:d.data2url(c.url,a,c.$prototype)},u(a),o.add(a).onerror=function(){k=!0}})}},_loadDraft:function(b,c,d){if(a(b,d))try{var e=b.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(c);e.onsuccess=function(a){a.target.result?d(a.target.result):d(null)};e.onerror=function(a){f.pushdbError(a);d(null)}}catch(g){f.pushdbError(g),d(null,g)}},_createDraft:function(b,c,e){if(a(b,e)){c.appid=d.config.id;
var g=b.transaction(["draft"],IDBTransaction.READ_WRITE),h=g.objectStore("draft").index("original_url"),k=IDBKeyRange.only(c.original_url);try{var o=h.openCursor(k);o.onsuccess=function(a){if(a.target.result){a=a.target.result;if(a.value.appid===c.appid)a["delete"]();a["continue"]()}else p._insertDraft(b,g,c,e)};o.onerror=function(a){a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR&&p._insertDraft(b,null,c,e)}}catch(l){return f.pushdbError(l),e(null,l)}}}},q={_getSDataByUrl:function(a,b,c){0>
a.indexOf("appid=")&&(a=a+"&appid="+d.config.id);b.executeSql("SELECT * FROM sdata where url=?",[a],function(a,b){var d=b.rows;d&&d.length?(d=d.item(0),c({appid:d.appid,url:d.url,entity_url:d.entity_url,data:d.data?JSON.parse(d.data):null,original_data:d.original_data?JSON.parse(d.original_data):null,status:d.status,updated:d.updated,last_error:d.last_error})):c(null)},function(a,b){c(null,b)})},_rmvSDataByUrl:function(a,b,c){0>a.indexOf("appid=")&&(a=a+"&appid="+d.config.id);b.executeSql("DELETE FROM sdata where url=?",
[a],function(){c(null)},function(a,b){c(null,b)})},_insData:function(b,c,d,e){a(b,e)&&b.transaction(function(a){return q._insertSdata({data:d,url:c},a,e)},function(a,b){f.pushdbError(b);return e(null,b)})},_rmvEntityCache:function(a,b,c,d){c.executeSql("DELETE from sdatacache where appid=? and entity=?",[a,b],function(){d()},function(a,b){f.pushdbError(b);d()})},_addEntityCache:function(a,b,c,d){q._rmvEntityCache(a,b,d,function(){c.forEach(function(c){d.executeSql("INSERT INTO sdatacache(id, appid, entity, data) values(?, ?,?,?)",
[f.uuid(),a,b,c?JSON.stringify(c):""],function(){},function(a,b){f.pushdbError(b)})})})},_addCache:function(b,c,d,e,g){a(b,g)&&b.transaction(function(a){q._addEntityCache(c,d,e,a)},function(){g()},function(){g()})},_insertSdata:function(a,b,c,d){d?d.forEach(function(a){b.executeSql("INSERT INTO sdata(appid, url, entity_url, data, original_data,status, updated, last_error) values(?,?,?,?,?,?,?,?)",[a.appid,a.url,a.entity_url,a.data?JSON.stringify(a.data):"",a.original_data?JSON.stringify(a.original_data):
"",a.status,a.updated,a.last_error],function(){},function(a,b){f.pushdbError(b)})}):(u(a),b.executeSql("INSERT INTO sdata(appid, url, entity_url, data, original_data,status, updated, last_error) values(?,?,?,?,?,?,?,?)",[a.appid,a.url,a.entity_url,a.data?JSON.stringify(a.data):"",a.original_data?JSON.stringify(a.original_data):"",a.status,a.updated,a.last_error],function(){c(null)},function(a,b){f.pushdbError(b);c(null,b)}))},_updSDataByUrl:function(a,b,c,d){u(b);c.executeSql("Update sdata set appid=?, url=?, entity_url=?, data=?, original_data=? ,status=?, updated=?, last_error=? where url=?",
[b.appid,b.url,b.entity_url,b.data?JSON.stringify(b.data):"",b.original_data?JSON.stringify(b.original_data):"",b.status,b.updated,b.last_error,b.url],function(){d(null)},function(a,b){d(null,b)})},_saveDraft:function(b,c,e,g){a(b,g)&&q._execOpen(b,"SELECT * FROM draft where id=?",[c],function(a,h){if(h)return f.pushdbError(h),g({status:404});if(a&&a.length){var k=a.item(0),o=k.original_url,l=k.data?JSON.parse(k.data):null,j=k.original_data?JSON.parse(k.original_data):null,s=d.parseSdataUri(o);b.transaction(function(a){var h=
!1;if(s.template)h=!0,s.template=!1,s.id=d.data2id(s,l);s.createActivity=!1;s.editActivity=!1;var f=d.url2local(s),k={url:f,data:e,original_data:j};delete j;q._getSDataByUrl(f,a,function(e){if(e){if(e.status===d.STATUS.DELETED)return q._deleteDraft(b,a,c,function(){g({status:404})});if(e.status===d.STATUS.ORIGINAL||e.status===d.STATUS.MODIFIED){if(e.status===d.STATUS.ORIGINAL)k.original_data=i.extend(!0,{},e.data),k.status=d.STATUS.MODIFIED;else if(e.status===d.STATUS.MODIFIED)k.original_data=i.extend(!0,
{},e.original_data),k.status=d.STATUS.MODIFIED;delete k.data.$info;delete k.data.$trackingId;if(k.original_data&&(delete k.original_data.$info,delete k.original_data.$trackingId,JSON.stringify(k.original_data)===JSON.stringify(k.data)&&(delete k.original_data,k.status=d.STATUS.ORIGINAL,!d.store(k.url))))return q._rmvSDataByUrl(k.url,a,function(){q._deleteDraft(b,a,c,function(){g({status:200})})})}else k.status=d.STATUS.CREATED;return q._updSDataByUrl(k.url,k,a,function(){q._deleteDraft(b,a,c,function(){g({status:200})})})}h?
(k.status=d.STATUS.CREATED,delete k.original_data):k.status=d.STATUS.MODIFIED;delete k.data.$info;delete k.data.$trackingId;if(k.original_data&&(delete k.original_data.$info,delete k.original_data.$trackingId,JSON.stringify(k.original_data)===JSON.stringify(k.data)))return delete k.original_data,k.status=d.STATUS.ORIGINAL,q._deleteDraft(b,a,c,function(){g({status:404})});q._insertSdata(k,a,function(){q._deleteDraft(b,a,c,function(){g({status:200})})})})},function(a,b){f.pushdbError(b);return g(null,
b)})}else g({status:404})})},_droptables:function(b,c,d){if(a(b,d)){var e=function(a){f.each(["draft","sdata","apps"],function(b,c,d){a.executeSql("drop table if exists "+b,[],function(){d()},function(){d()})},function(){d(b)})};c?e(c):b.transaction(e)}},_createtables:function(b,c,d){if(a(b,d)){var e=function(a){f.each(["draft","sdata","apps","sdatacache"],function(b,c,d){a.executeSql(g(b),[],function(){d()},function(a,b){f.pushdbError(b);d()})},function(){d(b)})};c?e(c):b.transaction(e)}},_openDB:function(a){if(window.openDatabase){var b=
function(a,b){f.alert(b.message,function(){},!0)};try{var c=openDatabase("sage-mge-test","1.0","HTML 5 Database for Mobile",2E5)}catch(d){return f.pushException(d,f.locale().ui.no_db_support_sol),a(null)}if(!c)return f.pushException({message:f.locale().ui.no_db_support},f.locale().ui.no_db_support_sol),a(null);c?c.transaction(function(d){d.executeSql(g("migration"),[],function(d){d.executeSql("select version from migration",[],function(d,e){if(e.rows&&e.rows.length){if("3"==e.rows.item(0).version)return a(c);
q._droptables(c,d,function(){q._createtables(c,d,function(){d.executeSql("update migration set version=?",["3"],function(){return a(c)},b)})})}else d.executeSql("insert into migration (version) values (?)",[3],function(b){q._createtables(c,b,a)},b)},b)},b)}):f.alert("Failed to open the database on disk.  This is probably because the version was bad or there is not enough space left in this domain's quota",function(){},!0)}},_execOpen:function(b,c,d,e){if(a(b,e)){var g=function(a,b){f.pushdbError(b);
e(null,!0)};b.readTransaction(function(a){a.executeSql(c,d,function(a,b){e(b.rows)},g)},g)}},_execSQL:function(a,b,c,d,e){var g=e.fail;e.fail=function(a,b){f.pushdbError(b);g&&g()};var h=function(a,b){f.pushdbError(b);g&&g()};b?b.executeSql(c,d,function(){e.success()},e.fail):a.transaction(function(a){a.executeSql(c,d,function(){e.success()},e.fail)},h)},_insertDraft:function(b,c,d,e){a(b,e)&&q._execSQL(b,c,"INSERT INTO draft (id, appid, original_url, original_data,  data) values(?,?,?,?,?)",[d.id,
d.appid,d.original_url,d.original_data?JSON.stringify(d.original_data):"",JSON.stringify(d.data)],{success:function(){e(d)}})},_deleteDraft:function(b,c,d,e){a(b,e)&&q._execSQL(b,c,"DELETE from draft where id=?",[d],{success:function(){e(null)},fail:function(){e(null)}})},_markSdataDeleted:function(a,b,c,e){var a=d.parseSdataUri(a),g=!1;if(a.template)g=!0,a.template=!1,a.id=d.data2id(a,c);a.createActivity=!1;a.editActivity=!1;var h=d.url2local(a);q._getSDataByUrl(h,b,function(a){if(a){if(a.status===
d.STATUS.DELETED)return e(null);if(a.status===d.STATUS.MODIFIED||a.status===d.STATUS.ORIGINAL)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:d.STATUS.DELETED},q._updSDataByUrl(a.url,a,b,function(){return e(null)});if(a.status===d.STATUS.CREATED)return q._rmvSDataByUrl(h,b,function(){return e(null)})}else{if(g)return e(null);q._insertSdata({url:h,data:c,original_data:null,status:d.STATUS.DELETED},b,function(){return e(null)})}})},_deleteDataByDraft:function(b,
c,d){if(a(b,d)){var e=function(a,b){f.pushdbError(b);d(null,b)};b.transaction(function(a){a.executeSql("SELECT * FROM draft where id=?",[c],function(a,e){if(e&&e.rows&&e.rows.length){var g=e.rows.item(0),h=g.original_url,f=g.data?JSON.parse(g.data):null,g=g.original_data?JSON.parse(g.original_data):null;q._markSdataDeleted(h,a,g?g:f,function(){return q._deleteDraft(b,a,c,function(){d(null)})})}else d(null)},e)},e)}},_createDraft:function(b,c,e){if(a(b,e))c.appid=d.config.id,b.transaction(function(a){q._execSQL(b,
a,"DELETE from draft where original_url=? and appid=?",[c.original_url,c.appid],{success:function(){q._insertDraft(b,a,c,e)},fail:function(){q._insertDraft(b,a,c,e)}})},function(a,b){f.pushdbError(b);e(null,b)})},_updateDraft:function(b,c,d,e){a(b,e)&&q._execSQL(b,null,"UPDATE draft set data=? where id=?",[JSON.stringify(d),c],{success:e})},_getSData:function(b,c,e,g){if(a(b,g))try{var o=[],l={},i=d.url2local(c,e);if(c.id||c.template)b.readTransaction(function(a){a.executeSql("SELECT * FROM sdata where url=? and status<?",
[i,d.STATUS.DELETED],function(a,b){var c=b.rows;c.length?g(h(c.item(0),JSON.parse(c.item(0).data)),{status:200}):g(null,{status:404})})},function(){g(null,{status:404})});else if(c.entity){var j={$url:c.uri,$resources:[]};b.readTransaction(function(a){var b=d.url2search(c),h="SELECT * FROM sdata where entity_url=? and  appid=? and status<?",m=[i,d.config.id,d.STATUS.DELETED];e&&(h="SELECT * FROM sdatacache where entity=? and  appid=?",m=[i,d.config.id]);a.executeSql(h,m,function(a,d){var e=d.rows;
if(e.length){for(var h=0,m=e.length;h<m;h++){var i=e.item(h);k(i,JSON.parse(i.data),j.$resources,c,o,l,b)}if(c.pgroupBy)for(var t in l)j.$resources.push(l[t]);e=j.$resources;(h=f.sdataSort(c.query))&&f.applySDataSort(h,e)}g(j,{status:200})})},function(){g(j,{status:404})})}}catch(s){f.log(s)}},_loadDraft:function(b,c,d){a(b,d)&&q._execOpen(b,"SELECT * FROM draft where id=?",[c],function(a,b){if(b)return d(null);if(a.length){var c=a.item(0);d({appid:c.appid,id:c.id,original_url:c.original_url,data:JSON.parse(c.data)})}else d(null)})},
_getModifiedData:function(b,c,e){if(a(b,e)){var g={},c=d.entityUri(c,!0);q._execOpen(b,"SELECT * FROM sdata where status > ? and appid = ? and entity_url = ?",[d.STATUS.ORIGINAL,d.config?d.config.id:"",c],function(a,b){if(b)return e(g);if(a&&a.length)for(var c=0,h=a.length;c<h;c++){var f=a.item(c),m=JSON.parse(f.data),n=d.parseSdataUri(f.url);g[n.id]={data:m,status:f.status}}e(g)})}},_getSyncData:function(b,c,e){if(a(b,e)){var g=null,h=d.config?d.config.id:"";c?q._execOpen(b,"SELECT count(*) as sync FROM sdata where status > ? and appid = ?",
[d.STATUS.ORIGINAL,h],function(a,b){if(b)return e(0);a&&a.length?e(a.item(0).sync):e(0)}):q._execOpen(b,"SELECT * FROM sdata where status > ? and appid = ?",[d.STATUS.ORIGINAL,h],function(a,b){if(b)return e(null);if(a&&a.length){for(var c=0,h=a.length;c<h;c++){var f=a.item(c),m=d.parseSdataUri(f.url),n=d.url2entity(m);g=g||{};var k=g[n]||[];g[n]=k;n=JSON.parse(f.data);r(m,f,n,d.url2proto(m));k.push(n)}e(g)}else e(null)})}},_delData:function(b,c,d){a(b,d)&&b.transaction(function(a){return q._rmvSDataByUrl(c,
a,d)})},_installApp:function(b,c,d){a(b,d)&&b.transaction(function(a){var b=function(){a.executeSql("INSERT INTO apps(id, url, title, description, icon, baseURL, version, data) values(?,?,?,?,?,?,?,?)",[c.id,c.url,c.title,c.description,c.icon,c.baseURL,c.version,JSON.stringify(c.data)],function(){d()},function(a,b){f.pushdbError(b);d()})};a.executeSql("delete from apps where url=? and baseURL= ?",[c.url,c.baseURL],function(){b()},function(){b()})})},_clearSdata:function(b,c,d,e){if(a(b,e)){if(d)return q._execSQL(b,
d,"DELETE from sdata where appid=?",[c],{success:function(){e()},fail:function(){e()}});b.transaction(function(a){return q._execSQL(b,a,"DELETE from sdata where appid=?",[c],{success:function(){e()},fail:function(){e()}})},function(a,b){f.pushdbError(b);return e()})}},_removeFromDB:function(b,c,d){a(b,d)&&b.transaction(function(a){var e=function(){return q._execSQL(b,a,"DELETE from sdatacache where appid=?",[c],{success:function(){d()},fail:function(){d()}})},g=function(){return q._execSQL(b,a,"DELETE from apps where id=?",
[c],{success:function(){e()},fail:function(){e()}})};return q._clearSdata(b,c,a,function(){return q._execSQL(b,a,"DELETE from draft where appid=?",[c],{success:function(){g()},fail:function(){g()}})})},function(a,b){f.pushdbError(b);return d()})},_getAppConfig:function(b,c,d){a(b,d)&&q._execOpen(b,"SELECT * FROM apps where id=?",[c],function(a,c){c&&d(null);if(a&&a.length){var e=a.item(0),g=null;try{g=JSON.parse(e.data)}catch(h){}g=g||{};g.id=e.id;g.$info={url:e.url,version:e.version,title:e.title,
icon:e.icon};q._getInstalledApps(b,!1,function(a){g.applications=a;d(g)})}else d(null)})},_saveAppConfig:function(b,c,d){a(b,d)&&q._execOpen(b,"SELECT * FROM apps where id=?",[c.id],function(a,e){e&&d(null);if(a&&a.length){a.item(0);delete c.$info;var g=c.id;q._execSQL(b,null,"UPDATE apps set data=? where id=?",[JSON.stringify(c),g],{success:d})}else d(null)})},_getInstalledApps:function(b,c,d){if(a(b,d)){var e=[];q._execOpen(b,"SELECT * FROM apps ORDER BY url",[],function(a,b){if(b)return d(e);if(a&&
a.length)for(var c=0,g=a.length;c<g;c++){var h=a.item(c);e.push({id:h.id,url:h.url,title:h.title,description:h.description,icon:h.icon,baseURL:h.baseURL,version:h.version})}d(e)})}},_undoUpdate:function(b,c,e){a(b,e)&&b.transaction(function(a){q._getSDataByUrl(c,a,function(b){if(b)return!d.store(c)||b.status===d.STATUS.CREATED?q._rmvSDataByUrl(c,a,function(){e(null)}):q._updSDataByUrl(c,{appid:b.appid,url:b.url,data:b.original_data?b.original_data:b.data,original_data:null,status:d.STATUS.ORIGINAL},
a,function(){e(null)});e(null)})})},_updData:function(b,c,e,g){a(b,g)&&b.transaction(function(a){e.url=c;var b=function(){return e.status===d.STATUS.ORIGINAL&&!d.store(c)?q._rmvSDataByUrl(c,a,function(a,b){g(null,b)}):q._updSDataByUrl(c,e,a,function(a,b){g(null,b)})};e.$load?(delete e.$load,q._getSDataByUrl(e.url,a,function(a){Object.keys(e).forEach(function(b){a[b]=e[b]});e=a;b()})):b()})},_initData:function(b,c,e,g,h){if(a(b,h)){var f=[];e.forEach(function(a){a={data:a,appid:c.id,url:d.data2url(c.url,
a,c.$prototype)};u(a);f.push(a)});b.transaction(function(a){q._insertSdata(null,a,null,f)},function(){h()},function(){h()})}}};c.prototype={init:function(){},check:function(a,b){var c=this;if(b)return p._openDB(function(b){b||f.pushdbError({message:f.locale().ui.open_db_error});a(b)});c.db?a(c.db):p._openDB(function(b){c.db=b;c.db||f.pushdbError({message:f.locale().ui.open_db_error});a(c.db)})},createDraft:function(a,b){this.check(function(c){p._createDraft(c,a,b)})},updateDraft:function(a,b,c){this.check(function(d){p._updateDraft(d,
a,b,c)})},deleteDraft:function(a,b){this.check(function(c){p._deleteDraft(c,null,a,b)})},deleteDataByDraft:function(a,b){this.check(function(c){p._deleteDataByDraft(c,a,b)})},saveDraft:function(a,b,c){this.check(function(d){p._saveDraft(d,a,b,c)})},loadDraft:function(a,b){this.check(function(c){p._loadDraft(c,a,b)})},getSData:function(a,b,c){this.check(function(d){p._getSData(d,a,b,c)})},initData:function(a,b,c,d){this.check(function(e){p._initData(e,a,b,c,d)})},delData:function(a,b){this.check(function(c){p._delData(c,
a,b)})},undoUpdate:function(a,b){this.check(function(c){p._undoUpdate(c,a,b)})},installApp:function(a,b){this.check(function(c){p._installApp(c,a,b)})},removeFromDB:function(a,b){this.check(function(c){p._removeFromDB(c,a,b)})},clearSdata:function(a,b){this.check(function(c){p._clearSdata(c,a,null,b)})},addCache:function(a,b,c,d){this.check(function(e){p._addCache(e,a,b,c,d)})},getAppConfig:function(a,b){this.check(function(c){p._getAppConfig(c,a,b)})},saveAppConfig:function(a,b){this.check(function(c){p._saveAppConfig(c,
a,b)})},getInstalledApps:function(a,b){this.check(function(c){p._getInstalledApps(c,a,b)})},getSyncData:function(a){this.check(function(b){p._getSyncData(b,!1,a)})},getModifiedData:function(a,b){this.check(function(c){p._getModifiedData(c,a,b)})},getSyncCount:function(a){this.check(function(b){p._getSyncData(b,!0,a)})},updData:function(a,b,c){this.check(function(d){p._updData(d,a,b,c)})},insData:function(a,b,c){this.check(function(d){p.insData(d,a,b,c)})}};j.prototype={init:function(){},check:function(a,
b){var c=this;if(b)return q._openDB(function(b){b||f.pushdbError({message:f.locale().ui.open_db_error});a(b)});c.db?a(c.db):q._openDB(function(b){c.db=b;c.db||f.pushdbError({message:f.locale().ui.open_db_error});a(c.db)})},createDraft:function(a,b){this.check(function(c){q._createDraft(c,a,b)})},updateDraft:function(a,b,c){this.check(function(d){q._updateDraft(d,a,b,c)})},deleteDraft:function(a,b){this.check(function(c){q._deleteDraft(c,null,a,b)})},deleteDataByDraft:function(a,b){this.check(function(c){q._deleteDataByDraft(c,
a,b)})},saveDraft:function(a,b,c){this.check(function(d){q._saveDraft(d,a,b,c)})},loadDraft:function(a,b){this.check(function(c){q._loadDraft(c,a,b)})},getSData:function(a,b,c){this.check(function(d){q._getSData(d,a,b,c)})},initData:function(a,b,c,d){this.check(function(e){q._initData(e,a,b,c,d)})},delData:function(a,b){this.check(function(c){q._delData(c,a,b)})},undoUpdate:function(a,b){this.check(function(c){q._undoUpdate(c,a,b)})},getInstalledApps:function(a,b){this.check(function(c){q._getInstalledApps(c,
a,b)})},installApp:function(a,b){this.check(function(c){q._installApp(c,a,b)})},removeFromDB:function(a,b){this.check(function(c){q._removeFromDB(c,a,b)})},clearSdata:function(a,b){this.check(function(c){q._clearSdata(c,a,null,b)})},addCache:function(a,b,c,d){this.check(function(e){q._addCache(e,a,b,c,d)})},getAppConfig:function(a,b){this.check(function(c){q._getAppConfig(c,a,b)})},saveAppConfig:function(a,b){this.check(function(c){q._saveAppConfig(c,a,b)})},getSyncData:function(a){this.check(function(b){q._getSyncData(b,
!1,a)})},getSyncCount:function(a){this.check(function(b){q._getSyncData(b,!0,a)})},getModifiedData:function(a,b){this.check(function(c){q._getModifiedData(c,a,b)})},updData:function(a,b,c){this.check(function(d){q._updData(d,a,b,c)})},insData:function(a,b,c){this.check(function(d){q._insData(d,a,b,c)})}};if(b&&!window.openDatabase){var o=new c;d.createDraft=function(a,b){o.createDraft(a,b)};d.updateDraft=function(a,b,c){c||(c=function(){});o.updateDraft(a,b,c)};d.loadDraft=function(a,b){o.loadDraft(a,
b)};d.deleteDraft=function(a,b){o.deleteDraft(a,b)};d.saveDraft=function(a,b,c){o.saveDraft(a,b,c)};d.getSData=function(a,b,c){o.getSData(a,b,c)};d.initData=function(a,b,c,d){o.initData(a,b,c,d)};d.updData=function(a,b,c){o.updData(a,b,c)};d.insData=function(a,b,c){o.insData(a,b,c)};d.delData=function(a,b){o.delData(a,b)};d.deleteDataByDraft=function(a,b){o.deleteDataByDraft(a,b)};d.getSyncData=function(a){o.getSyncData(a)};d.getSyncDataCount=function(a){o.getSyncCount(a)};d.getModifiedData=function(a,
b){o.getModifiedData(a,b)};d.undoUpdate=function(a,b){o.undoUpdate(a,b)};d.getInstalledApps=function(a,b){o.getInstalledApps(a,b)};d.installApp=function(a,b){o.installApp(a,b)};d.getAppConfig=function(a,b){o.getAppConfig(a,b)};d.saveAppConfig=function(a,b){o.saveAppConfig(a,b)};d.removeFromDB=function(a,b){o.removeFromDB(a,b)};d.clearSdata=function(a,b){o.clearSdata(a,b)};d.addCache=function(a,b,c,d){o.addCache(a,b,c,d)}}else if(window.openDatabase){var s=new j;d.createDraft=function(a,b){s.createDraft(a,
b)};d.updateDraft=function(a,b,c){c||(c=function(){});s.updateDraft(a,b,c)};d.loadDraft=function(a,b){s.loadDraft(a,b)};d.deleteDraft=function(a,b){s.deleteDraft(a,b)};d.saveDraft=function(a,b,c){s.saveDraft(a,b,c)};d.getSData=function(a,b,c){s.getSData(a,b,c)};d.initData=function(a,b,c,d){s.initData(a,b,c,d)};d.updData=function(a,b,c){s.updData(a,b,c)};d.insData=function(a,b,c){s.insData(a,b,c)};d.delData=function(a,b){s.delData(a,b)};d.deleteDataByDraft=function(a,b){s.deleteDataByDraft(a,b)};d.getSyncData=
function(a){s.getSyncData(a)};d.getSyncDataCount=function(a){s.getSyncCount(a)};d.getModifiedData=function(a,b){s.getModifiedData(a,b)};d.undoUpdate=function(a,b){s.undoUpdate(a,b)};d.getInstalledApps=function(a,b){s.getInstalledApps(a,b)};d.installApp=function(a,b){s.installApp(a,b)};d.getAppConfig=function(a,b){s.getAppConfig(a,b)};d.saveAppConfig=function(a,b){s.saveAppConfig(a,b)};d.removeFromDB=function(a,b){s.removeFromDB(a,b)};d.clearSdata=function(a,b){s.clearSdata(a,b)};d.addCache=function(a,
b,c,d){s.addCache(a,b,c,d)}}})(jQuery);(function(i){var c=i.smobile||{},j=i.helpers,f=i.sdata,l=i.proto,d=/([^&=;]*)=?([^&;]*)/g;c._uiCache={};c.PAGES={start:{ui:"start.$static",useAppId:!1,isHome:!0,db:!1},errors:{ui:"errors.$static",useAppId:!1,db:!1},apperrors:{ui:"apperrors.$static",useAppId:2,db:!1,home:!0},home:{ui:"home.$static",useAppId:2,isHome:!0,db:!0,cache:!0},about:{ui:"about.$static",useAppId:!1,db:!1,home:!0},settings:{ui:"settings.$static",useAppId:!1,db:!1,home:!0},send:{ui:"send.$static",useAppId:2,home:!0},page:{useAppId:2,
db:!0,home:!0},dialog:{useAppId:1,db:!0,home:!1},apps:{ui:"applications.$static",useAppId:0,db:!1,home:!0}};Object.keys(c.PAGES).forEach(function(a){c.PAGES[a].id=a});c.pageIsDialog=function(a){return"dialog"===a.attr("data-"+i.mobile.ns+"role")};c.pageController=function(a){return i.jqmData(a[0],"controller")};c.pageIsDetail=function(a){return"detail"===i.jqmData(a[0],"detail")};c.hash_sep="-";i.smobile=c;c.PAGES.start.enhanceHandler=function(a,b){var d=a&&a.content&&a.content.menu&&a.content.menu.data&&
a.content.menu.data.items?a.content.menu.data.items:null;if(!d)return b(a);f.getInstalledApps(!1,function(e){var g=j.locale();e&&e.length?e.forEach(function(a){d.push({data:{title:a.title,description:a.description,icon:a.icon,hash:c.PAGES.home.id+c.hash_sep+j.encodeURIComponent(a.id)}})}):d.push({data:{title:g.applicationmanager.title,description:g.applicationmanager.description,icon:"dash.appmanager",hash:c.PAGES.apps.id}});b(a)})};c.PAGES.apps.enhanceHandler=function(a,b){var c=j.locale();if(a)a.$title=
c.applicationmanager.title;b(a)};c.linkDetailPage=function(a){return a.applicationId?c.PAGES.page.id+c.hash_sep+j.encodeURIComponent(a.applicationId):c.PAGES.page.id};var a=function(a){if(a.representation){var b=a.representation.split(".");if(2<=b.length)a.representation=b[0],a.facet=b[1]}};c.scrollIntoView=function(a){a=i("<div></div>").css({position:"absolute",top:i(a).offset().top-45}).appendTo("body");a[0].scrollIntoView();a.remove()};var b=function(b){var c={},b=j.decodeJsmQuery(b),e;e=b.indexOf("?");
0<e&&b.substring(e+1).replace(d,function(a,b,d){b&&(c[b]=decodeURIComponent(d))});if(c.url)if(c.dataurl="",e=c.url.indexOf("?"),0<=e)c.dataurl=c.url.substr(0,e),b=c.url.substr(e+1),b.replace(d,function(a,b,d){b&&(c[b]=decodeURIComponent(d))});else if(e=c.url.indexOf(".$dashboard"),0<=e)c.representation=c.url;a(c);return c},e=function(a){if(!a)return null;var b=0>a.indexOf("="),a="#"===a[0]?a.substring(1):a,b=a.indexOf(b?j.encodeJsmQuery("?"):"?");0<b&&(a=a.substring(0,b));var d={page:null},b=a.indexOf(c.hash_sep);
if(0<b){if(d.page=c.PAGES[a.substring(0,b)],d.application=decodeURIComponent(a.substr(b+1)),36<d.application.length)d.pageId=d.application.substr(37),d.application=d.application.substr(0,36)}else d.page=c.PAGES[a],d.application="";if(!d.page||2===d.page.useAppId&&!d.application)return null;if(1===d.page.useAppId&&!d.application)d.application=f.config?f.config.id:"";if(!d.pageId)d.pageId=j.uuid();d.pageName=d.page.id+(d.application?c.hash_sep+j.encodeURIComponent(d.application):"");d.domid=c.PAGES.home.id===
d.page.id?d.application:d.pageId;d.longPageName=c.PAGES.home.id===d.page.id?d.pageName:d.page.id+(d.application?c.hash_sep+j.encodeURIComponent(d.application+"-"+d.pageId):"");return d};c.ACTIONS={home:{name:"home",execute:function(a,b){c.goHome(null);b(null)}}};var g=function(a,b){if(a.before)b.push(a.before),a.before=null;if(a.html)b.push(a.html),a.html=null;a.childs&&a.childs.forEach(function(a){g(a,b)});if(a.after)b.push(a.after),a.after=null},h=function(a){for(var b in a)if("ErrorView"===a[b].uiClass)return!0;
return!1},k=function(a,b,c){Object.keys(b).forEach(function(d){var e=b[d],g=c[e.parent]||c.root;e.id=a.prefix+d;e.layout?(g=i.smobile.addLayout.apply(a,[g,e]),c[d]=g,g.childs&&g.childs.length&&g.childs.forEach(function(a){c[a.id]=a})):e.uiClass&&i.smobile.addControl.apply(a,[g,e,function(b){if(b&&Array.isArray(b))b.forEach(function(b){c[d+b.scid]=b;(b.bind||b.action)&&a.registerControl({id:e.id+b.scid,bind:b.bind,action:b.action,options:b.options,uiClass:b.uiClass,refresh:b.refresh})});else if(b&&
(c[d]=b,(b.bind||b.action)&&a.registerControl({id:e.id,bind:b.bind,action:b.action,options:b.options,uiClass:e.uiClass,refresh:b.refresh}),b.async))a.asyncs=a.asyncs||[],a.asyncs.push(b.async),b.async=null}])})},u=function(a,b){var d=[],e={"data-theme":"a","data-role":"button","data-inline":"true","data-corners":"false","data-iconshadow":"false","data-shadow":"false"};d.push('<div id="'+a.prefix+'headerright" data-type="horizontal" data-role="controlgroup" class="ui-btn-right">');b&&b.hbuttons&&b.hbuttons.forEach(function(b){b.jmdata=
b.jmdata||{};i.extend(b.jmdata,e);c._addLink(d,b,a,function(){d.push(j.htmlEncode(b.title))})});(!b||!b.roptions||!b.roptions.nopanel)&&d.push('<a id="'+a.prefix+'right_panel" href="#'+a.prefix+'rpanel" data-theme="a" data-role="button" data-inline="true" data-iconpos="notext" data-icon="bars" data-corners="false" data-iconshadow="false" data-shadow="false"> </a>');d.push("</div>");return d},r=function(a){var b=i.mobile.activePage;if(b){var d=c.pageController(b);if(d&&!d.disabled){for(a=a.target;a&&
a.tagName&&"A"!=a.tagName.toUpperCase()&&"BUTTON"!=a.tagName.toUpperCase();)a=a.parentNode;d.disabled=!0;if(a&&(b=i(a).attr("data-action"))){if(a=d.pageActions?d.pageActions[b]:null)return a.call(d,function(a){if(a)d.disabled=!1});(a=d["action"+b])&&a.call(d,{success:function(a,b,c){d.disabled=!1;!b&&!c&&i.smobile.doBack(d)}})}d.disabled=!0}}};c._loadStaticUI=function(a){return c.staticui[a]()};var p={menu2link:function(a,b){if("$representation"==a.linkType)b.entity=a.entity,b.representation=a.representation,
b.facet=a.facet||"$query",b.params=a.params||"";else if("$dashboard"==a.linkType)b.facet=a.facet||"$dashboard",b.dashboard=a.dashboard,b.facet="$dashboard"},representation2ui:function(a,b){var c={},d=!0;if("$dashboard"==a.facet)c={content:{menu:{uiClass:"MainMenu",data:{items:[]}}}},b.forEach(function(a){var b={title:a.title,description:a.description,icon:a.icon};p.menu2link(a,b);c.content.menu.data.items.push({data:b})}),c.$facet="$dashboard",d=!1;else if("$query"===a.facet||"$lookup"===a.facet){c=
{content:{items:{uiClass:"SDataList",data:{bind:"$resources"}}}};if("$lookup"===a.facet)c.options={detail:!0},c.content.items.data.$lookup=1;if(b&&b.$prototype&&b.$prototype.$title)c.$title=l.parseExpression(b.$prototype.$title,{data:null,$prototype:b.$prototype},"$title");c.$page=a.representation+"."+a.facet;c.$facet=a.facet;c.$representation=a.representation}else if("$details"==a.facet||"$edit"==a.facet||"$create"==a.facet){var c={content:{}},e=b.$article||b.$prototype.$article;e||(e=l.auth.defaultDetailArticle(b.$prototype,
{list:!1,facet:a.facet}));var g={};l.auth.detailArt2design(e,g,b.$prototype,{root:!0,list:!1,facet:a.facet});c.content=g;if(b&&b.$prototype&&b.$prototype.$title)c.$title=l.parseExpression(b.$prototype.$title,{data:null,$prototype:b.$prototype},"$title");c.$page=a.representation+"."+a.facet;c.$facet=a.facet;c.$representation=a.representation}else c=b;if(d&&c&&c.content)c.content.error={uiClass:"ErrorView"};return c},getCtxItems:function(a,b,c){var d={exclude:!1,items:[]};if(b=f.config.pages[b+"."+
a])if("$details"===a){if(b.$prototype.$links.$edit&&!b.$prototype.$links.$edit.$isHidden&&(a=l.parseExpression(b.$prototype.$links.$edit.$url,{data:l.exprData(c),$prototype:b.$prototype},"$url"),(a=f.parseSdataUri(a))&&a.query&&a.query.representation&&f.config.pages[a.query.representation]&&d.items.push({title:j.locale().ui.edit_item,icon:"edit",url:b.$prototype.$links.$edit.$url,bind:!0})),(c=l.extractLinks(b.$prototype,b.$prototype,c,!0))&&c.length){if(2<c.length)c.length=2;c.forEach(function(a){d.items.push({service:!0,
title:a.$title,icon:"gear",hash:"actionservice",bind:!0,link:{$title:a.$title,$url:a.$url,$method:a.$method,$parameters:a.$parameters}})})}}else if("$edit"===a||"$create"===a)d.exclude=!0,c=l.extractLinks(b.$prototype,b.$prototype,c,!0),d.items=[{title:j.locale().ui.cancel_item,action:"cancel",jmdata:{"data-icon":"refresh","data-transition":"none"}},{title:j.locale().ui.remove_item,action:"delete",jmdata:{"data-icon":"delete","data-transition":"none"}},{title:j.locale().ui.save_item,action:"save",
jmdata:{"data-icon":"check","data-transition":"none"}}],c&&c.length&&d.items.push({type:"services",items:c});return d},concatItems:function(a,b,c){if(a.exclude)return a.items||[];a.items=a.items||[];return a.items.concat(c,b)},enhanceFooter:function(a){var b=this.ui,c=this.footer,d=this.panel,e=this.rpanel;if(d)b.panel={left_panel:d};if(e)b.rpanel={right_panel:e};if(!b.footer&&(b.footer=c,b.footer)){if(c&&b&&b.$facet&&f.config)d=c.footer.data.items,e=f.config.footer,a=p.getCtxItems(b.$facet,b.$representation,
a),c.footer.data.items=p.concatItems(a,d,e);for(;4<c.footer.data.items.length;)c.footer.data.items.pop()}}};c.detailUiData=function(a,b,c,d,e){a={};if(d.$layout)d=d.$layout;else if(d.$cards)d=d.$cards;c=e&&e.readOnly;a.uiData=p.representation2ui({facet:c?"$details":"$edit",representation:"x-object"},{$prototype:b,$article:d});a.uiData.$prototype=b;a.uiData.footer={footer:{uiClass:"NavBar",data:{items:[{title:j.locale().ui.cancel_item,action:"cancel_detail",jmdata:{"data-icon":"refresh","data-transition":"back"}},
{title:j.locale().ui.ok_item,action:"save_detail",jmdata:{"data-icon":"check","data-transition":"back"}}]}}};if(e){c&&delete a.uiData.footer;if(e.actions)a.uiData.actions=e.actions,e.actions=null;e.canDelete&&a.uiData.footer.footer.data.items.push({title:j.locale().ui.remove_item,action:"delete_detail",jmdata:{"data-icon":"delete","data-transition":"none"}})}return a};var q=function(d,e,g){var h={},k=b(d,e.pageName);if(!k.representation&&e.page.ui)k.representation=e.page.ui,a(k);if(!k.representation)return g("",
null,null,null);var i=function(a,b,d){var l;if(e.page.db){var i=null,j=k.representation;if(e.page.isHome)k.representation=f.config.home,j=k.representation,k.facet="$dashboard";if("$dashboard"==k.facet)i=f.config.dashboards;else if(k.facet)j=k.representation+"."+k.facet,i=f.config.pages;if(i&&i[j])if(h=i[j],h=p.representation2ui(k,h)){l=p.enhanceFooter.bind({ui:h,footer:a,panel:b,rpanel:d});if(e.page.isHome)h.$title=f.config.title;if(e.page.enhanceHandler)e.page.enhanceHandler(h,function(a){return g(j,
a,null,l)});else return g(j,h,null,l)}else return g("",null,null,null);else return g("",null,null,null)}else{i=c._loadStaticUI(k.representation);if(!i)return g(k.representation,h,null,null);h=i;l=p.enhanceFooter.bind({ui:h,footer:a,panel:b,rpanel:d});if(e.page.enhanceHandler)e.page.enhanceHandler(h,function(a){return g(k.representation,a,null,l)});else return g(k.representation,h,null,l)}},r=function(a,b){var d=f.applications,e=a[a.length-1];d&&d.forEach(function(a){e.items.push({title:a.title,icon:a.icon,
hash:c.PAGES.home.id+c.hash_sep+j.encodeURIComponent(a.id)})});var d=j.locale(),g;g={code:"filtersort",load:!0,title:d.ui.filtersort,items:[]};b.push(g);g={code:"actions",load:!0,title:d.ui.services,items:[]};b.push(g);g={code:"links",load:!0,title:d.ui.links,items:[]};f.config.footer&&f.config.footer.forEach(function(a){var b={title:a.title,icon:a.icon};if(a=c.ui.sdata_link(null,a))b.url=a;g.items.push(b)});b.push(g);g={title:d.ui.sync_item,items:[]};g.items.push({type:"sync"});b.push(g)};(function(){var a=
null,b=null,d=null;2==e.page.useAppId&&(!f.config||f.config.id!=e.application)?f.getAppConfig(e.application,function(e){f.config=e;e=f.config.applications;delete f.config.applications;f.applications=e;if(!f.config)return g("",null,{action:"start"},null);f.config.pages&&Object.keys(f.config.pages).forEach(function(a){a=f.config.pages[a];a.$prototype&&l.linkParents(a.$prototype,null)});a=c.staticui.appFooter();b=c._loadStaticUI("apppanel");d=c._loadStaticUI("ctxpanel");r(b.data.items,d.data.items);
i(a,b,d)}):(e.page.useAppId?(a=c.staticui.appFooter(),b=c._loadStaticUI("apppanel"),d=c._loadStaticUI("ctxpanel"),r(b.data.items,d.data.items)):(f.config=null,b=c._loadStaticUI("mainpanel")),i(a,b,d))})()};c.removePage=function(a){var b=i.jqmData(a,"controller");b&&(j.log("Remove page"+(b?": "+b.pageInfo.page.id+"-"+(b.pageInfo.pageId||""):"")),b.remove());a=i(a);i.removeWithDependents(a)};c.removeAllPages=function(a){a=a||[];a.push("page-template");var b=i('div[data-role="page"]');if(b&&b.length)for(var d=
b.length,e;d--;)e=b[d],0>a.indexOf(e.id)&&c.removePage(e)};c.hashOfUrl=function(a){var b=a.indexOf("#");return 0<=b?a.substring(b):""};c.pageName=e;c.actionName=function(a){if(!a)return null;for(var b=Object.keys(c.ACTIONS),d=b.length;d--;){var e=b[d],g=a.indexOf(e);if(0===g||1===g)return c.ACTIONS[e]}return null};c.loadPage=function(a,b,c){q(a,b,c)};c.execAction=function(a,c,d){a=b(a,c.name);return c.execute(a,d)};c.buildPage=function(a,b,d,e,l,p,q,x,M){var N=d[0],D={root:{before:"",after:"",childs:[]}},
y=null,z={root:{before:"",after:"",childs:[]}},E={root:{before:"",after:"",childs:[]}},F={root:{before:"",after:"",childs:[]}},G={root:{before:"",after:"",childs:[]}},H=!1,I=!1;b&&b[0]&&(y=i.jqmData(b[0],"controller"));if(p.url)p.url=f.parseSdataUri(p.url);d.uiController({id:a,ui:a,entity:p.entity,inCreate:p.$createActivity,page:q,url:p.url});var v=i.jqmData(N,"controller");v.pageInfo=q;if(2===q.page.useAppId&&q.application)v.applicationId=q.application,v.homeRef="#"+c.PAGES.home.id+c.hash_sep+j.encodeURIComponent(v.applicationId);
else if(!1==q.page.useAppId)v.applicationId="",v.homeRef="#"+c.PAGES.start.id;if(e.$page)v.page=e.$page,delete e.$page;v.data=l||{};v.pageOptions=e.options||{};if(v.pageOptions.detail&&y&&(v.parent=y,y.child=v,v.applicationId=y.applicationId,e.$prototype))v.detailpagedata={$prototype:e.$prototype};var A=d.children(":jqmData(role=header)"),O=d.children(":jqmData(role=content)").children(".content-primary"),P=d.children(":jqmData(sagerole=footer)"),J=d.children(":jqmData(sagerole=panel)"),K=d.children(":jqmData(sagerole=rpanel)");
e.header=e.header||{};a={fpanel:{uiClass:"Button",data:{link:!0,hash:v.prefix+"panel",jmdata:{"data-inline":"true","data-iconpos":"notext","data-icon":"bars","data-corners":"false","data-iconshadow":"false","data-shadow":"false"}}},title:{uiClass:"Html",data:{html:"<h1></h1>"}}};v.parent&&delete a.fpanel;for(var L in e.header)a[L]=e.header[L];e.header=a;e.footer=e.footer||{};e.content=e.content||{};k(v,e.footer,E);k(v,e.header,z);e.panel&&(H=!0,k(v,e.panel,F));e.rpanel&&(I=!0,k(v,e.rpanel,G));h(e.content)?
v.hasErrorView=!0:j.clearErrors();k(v,e.content,D);var w=[],C;g(z.root,w);A.html(w.join(""));(z=A.find("h1"))&&z.length&&(C=e.$title||(v.data?v.data.$title:"")||"");C&&z.html(C);(function(){if(q.page.useAppId){var a=u(v,e);A.append(a.join(""))}w=[];g(D.root,w);O.html(w.join(""));w=[];g(E.root,w);P.html(w.join(""));H&&(w=[],g(F.root,w),J.html(w.join("")),J.on("panelbeforeopen",function(){var a=i.mobile.activePage;a&&(a=c.pageController(a))&&a.refreshPanel(!0)}));I&&(w=[],g(G.root,w),K.html(w.join("")),
K.on("panelbeforeopen",function(){var a=i.mobile.activePage;a&&(a=c.pageController(a))&&a.refreshPanel(!1)}));v.pageOptions.dialog?(d.removeAttr("data-"+i.mobile.ns+"role"),d.attr("data-"+i.mobile.ns+"role","dialog"),v.pageOptions.detail=!1):v.pageOptions.detail&&i.jqmData(d[0],"detail","detail");if(e.actions)for(var b in e.actions)v["action"+b]=e.actions[b];i("#"+d[0].id).length?d.remove():(x?d.insertBefore(x):d.appendTo(i("body")),A.click(r),M())})()};c.refreshPage=function(){return window.location.reload()};
c.goHome=function(a,b){var d="#"+c.PAGES.start.id;!a&&i.mobile.activePage&&(a=i.jqmData(i.mobile.activePage[0],"controller"));if(a&&a.applicationId)b=a.applicationId;b&&(d="#"+c.PAGES.home.id+c.hash_sep+j.encodeURIComponent(b));i.mobile.changePage(d,{allowSamePageTransition:!0,reverse:!0})};c.doBack=function(){i.mobile.back()};c.showErrors=function(a){if(a&&a.hasErrorView)return a.doRefresh();a="";a="#errors";if(f.config&&f.config.id)a=f.config.id,a="#apperrors-"+a;i.mobile.changePage(a,{allowSamePageTransition:!0})};
c.showSends=function(){f.config&&f.config.id&&i.mobile.changePage("#send-"+f.config.id,{allowSamePageTransition:!0})};c.createPage=function(a){var b=i("#page-template"),c=b.clone().attr("data-"+i.mobile.ns+"url",a.pageName).attr("id",a.domid);a.page.isHome&&!a.page.useAppId&&c.attr("data-"+i.mobile.ns+"theme","h");return{$page:c,$template:b}};c.createDialog=function(a,b){var d=e("#dialog"),g=c.createPage(d);if(a.footer)a.footer=null;var h={transition:"pop",role:"dialog",changeHash:!0};i.smobile.buildPage("dialog",
i.mobile.activePage,g.$page,a,b,{$createActivity:!0},d,g.$template,function(){var b=i.jqmData(g.$page[0],"controller"),c=g.$page.children("#panel-template");c.attr("id",b.prefix+"panel");c=g.$page.children("#right-panel-template");c.attr("id",b.prefix+"rpanel");g.$page.find(".s-m-footer").remove();if(a.actions)b.pageActions=a.actions,delete a.actions;i.mobile.changePage(g.$page,h);b.bindData()})};c.createDetail=function(a,b,d){a.options=a.options||{};a.options.detail=!0;var g=e(d?"#page-"+d.applicationId+
"-"+j.uuid():"#dialog"),h=c.createPage(g);h.$page.attr("data-url","#"+g.longPageName);var f={transition:"slide",changeHash:!0};i.smobile.buildPage("dialog",i.mobile.activePage,h.$page,a,b,{$createActivity:!0},g,h.$template,function(){var b=i.jqmData(h.$page[0],"controller"),c=h.$page.children("#panel-template");c.attr("id",b.prefix+"panel");c=h.$page.children("#right-panel-template");c.attr("id",b.prefix+"rpanel");if(d)b.options.url=d.options.url;if(a.actions)b.pageActions=a.actions,delete a.actions;
i.mobile.changePage(h.$page,f);b.bindData()})};c.showError=function(a,b){i.mobile.showPageLoadingMsg(i.mobile.pageLoadErrorMessageTheme,b||i.mobile.pageLoadErrorMessage,!0);setTimeout(i.mobile.hidePageLoadingMsg,3E3)};c.silentAction=function(a){"start"===a.action&&c.goHome(null)};c.addLayout=function(){return null};c.addControl=function(a,b,c){c()};c.setEvents=function(){return null};c.parseURL=function(a,d,e){var g={method:"GET"},h=b(a.search||a.hash,d.pageName),k=a.domain+a.pathname+(j.hashFirst()?
"#"+d.longPageName:"");if(!h.representation&&d.page.ui)h.representation=d.page.ui;var l={url:h.url};if(h.url&&"$dashboard"!==h.facet){var r={$title:h.title,$method:g.method,$init:null,$filter:null,$ui:h.ui,$type:h.type,success:function(b,g){var g=g||{},f=a.domain+a.pathname;g.location&&0!=g.location.indexOf("http")&&delete g.location;var i=g.location?g.location:h.url;l.url=i;if(300<g.status)return f=d.application?f+"#"+c.PAGES.home.id+c.hash_sep+d.application:f+"#"+c.PAGES.start.id,e(f,b,!0,l);if(100==
g.status)return l.stop=!0,e("",b,!1,{stop:!0});f="?url="+j.encodeURIComponent(i);f=k+j.encodeJsmQuery(f)+(j.hashFirst()?"":"#"+d.longPageName);return e(f,b,!1,l)}};g&&g.options&&i.extend(r,g.options);return f.execURL(h.url,r)}g=k;if("$dashboard"===h.facet&&h.url)g="?url="+j.encodeURIComponent(h.url),g=k+j.encodeJsmQuery(g)+(j.hashFirst()?"":"#"+d.longPageName),l.url=h.url;r=null;d.page&&!d.page.db&&!d.page.useAppId&&c.staticui[d.page.id+"_data"]&&(r=c.staticui[d.page.id+"_data"]());return e(g,r,!1,
l)};c.load=function(a,b,d){f.authenticate(function(e,g){if(g)d&&d();else return c._load(a,b,d)})};c._installDatainLocalDB=function(a,b){var c=!1,d={};j.each(a,function(a,b,e){if(c||j.hasErrors())return c=!0,e();var g=f.parseSdataUri(a.url),b=f.url2entity(g);if(d[b])return e();d[b]=!0;f.GET(a.url,function(b){if(c||j.hasErrors())return c=!0,e();if(b&&b.$resources&&b.$resources.length){if(a.cache)return f.addCache(a.appid,g.query.representation,b.$resources,e);var d=f.bestProto(g),h={id:a.appid,url:g,
$prototype:d};if(d)return f.initData(h,b.$resources,!0,e)}return e()})},function(){b&&b()})};c._saveAppsInDB=function(a,b,d,e,g,h){j.each(b,function(a,b,k){if(d||j.hasErrors())return d=!0,k();if(a.data){var i=[];a.data&&a.data.entities&&Object.keys(a.data.entities).forEach(function(b){var c=a.data.entities[b];c.sync||l.forceSync?(c.sync=!0,b={appid:a.id,url:a.baseURL+"/"+c.pluralType+"?representation="+b+".$bulk&role=",entity:a.baseURL+"/"+c.pluralType,config:a.data,representation:b},i.push(b)):a.data.pages&&
a.data.pages&&a.data.pages[b+".$lookup"]&&(b={appid:a.id,url:a.baseURL+"/"+c.pluralType+"?representation="+b+".$lookup&sync=cache&role=",entity:a.baseURL+"/"+c.pluralType,config:a.data,representation:b,cache:!0},i.push(b))})}f.installApp(a,function(b,r){r?d=!0:(g++,e&&e(g,h,"Done"));if(d||j.hasErrors())return d=!0,k();f.clearSdata(a.id,function(){f.config=a.data;f.config.id=a.id;f.config.$info={url:a.url,version:a.version,title:a.title,icon:a.icon};f.config.pages&&Object.keys(f.config.pages).forEach(function(a){a=
f.config.pages[a];a.$prototype&&l.linkParents(a.$prototype,null)});return c._installDatainLocalDB(i,k,!0)})})},function(){e&&e(h,h,"Done");a&&a()})};c._load=function(a,b,d){var e=[];if(a.$reinstall)if(delete a.$reinstall,f.config&&f.config.id){var g={};g.id=f.config.id;g.baseURL=f.config.baseUrl;g.description=f.config.description;g.url=f.config.$info.url;g.title=f.config.$info.title;g.icon=f.config.$info.icon;g.version=f.config.$info.version;e.push(g)}else return d();else g=a.datasets,delete a.datasets,
g.forEach(function(b){if(!1!==b.selected){var c=i.extend(!0,{},a);c.id=j.uuid();c.baseURL+=b.dataset;c.description=c.description+" ("+b.description+")";c.version=c.version||"0.000";e.push(c)}});var h=2*e.length+1,k=0;b&&b(0,h,"");var l=!1;j.each(e,function(a,c,d){if(l||j.hasErrors())return l=!0,d();f.applicationDetails(a,function(c){k++;b&&b(k,h,"Done");a.data=c;if(!c&&(l||j.hasErrors()))return l=!0,d();if(c)c.title=a.title,c.description=a.description,c.baseUrl=a.baseURL;return d()})},function(){if(l&&
d)return d();c._saveAppsInDB(d,e,!1,b,k,h)})}})(jQuery);
(function(i){var c=i.helpers,j=i.proto,f=i.sdata,l=i.smobile,d=function(a,b){this.$page=a;this.page=a[0];if(b.id)b.id=b.id.replace(/\./g,"_").replace(/\$/g,"_");var c=i.jqmData(this.page,"controller");c&&c.remove();i.jqmData(this.page,"controller",this);this.options=b;this.controls={};this.extraData={};return this.init()};d.prototype={defaults:{id:"empty"},init:function(){this.config=i.extend({},this.defaults,this.options);this.prefix=this.config.id+"_";this.prefix="F"+c.incId()+"_";this.ui=this.config.ui;
this.hasErrorView=!1;this.errors=[];return this},exprData:function(a){var b=j.exprData(),c=this;for(a&&(Array.isArray(a)?a.forEach(function(a){a&&b.push(a)}):b.push(a));;)if(b.push(c.data),c.parent&&c.$bind)c=c.parent;else break;return b},clearErrors:function(){this.errors.length=0},hasErrors:function(){return 0<this.errors.length},pushError:function(a){this.errors.push(a)},getPageData:function(){return!this.page?null:this.detailpagedata?this.detailpagedata:!f.config||!f.config.pages||!f.config.pages[this.page]?
null:f.config.pages[this.page]},getSortFields:function(){if(!this.page)return null;var a=this.page+"";if(0<a.indexOf(".$query")||0<a.indexOf(".$lookup")||0<a.indexOf(".$select")){var a=this.getPageData(),b=[];if(!a.$prototype||!a.$prototype.$properties)return;var c=a.$prototype.$properties.$resources.$item;Object.keys(c.$properties).forEach(function(a){var d=c.$properties[a];d.$isHidden||d.$capabilities&&0<=d.$capabilities.indexOf("sort")&&b.push({value:a,title:j.parseExpression(d.$shortTitle||d.$title,
{data:null,$prototype:c},"$title"),type:d.$type})});if(b.length)return b}return null},getFilterFields:function(a){if(!this.page)return null;var b=this.page+"";if(0<b.indexOf(".$query")||0<b.indexOf(".$lookup")||0<b.indexOf(".$select")){var b=this.getPageData(),c=[];if(!b.$prototype||!b.$prototype.$properties)return;var d=b.$prototype.$properties.$resources.$item;Object.keys(d.$properties).forEach(function(b){var f=d.$properties[b];if(!f.$isHidden){var l=f.$type;if(f.$capabilities&&0<=f.$capabilities.indexOf("filter")){if("application/x-reference"===
f.$type){if(!f.$item||!f.$item.$value)return;if(!j.useUuid(f.$item)){b=f.$item.$value.substring(1,f.$item.$value.length-1);if(!d.$properties[b])return;l=d.$properties[b].$type}}a?c.push({value:b,title:j.parseExpression(f.$shortTitle||f.$title,{data:null,$prototype:d},"$title"),type:l}):c.push({value:b,type:l})}}});if(c.length)return c}return null},afterChangeHnd:function(a){return a.options&&a.options.action&&this["action"+a.options.action]?(a=this["action"+a.options.action],a.bind(this)):null},checkData:function(){var a=
this,b,c;a.clearErrors();Object.keys(a.controls).forEach(function(d){var d=a.controls[d],h=l.controls[d.uiClass].checkValue;if(h){var f=i("#"+d.id);f&&(c=h.apply(a,[f,d]),!b&&c&&(b=c))}});return a.hasErrors()?(a.errorInView(b),!1):!0},errorInView:function(a){a&&a.$element&&a.$element.length&&l.scrollIntoView(a.$element[0])},checkChange:function(a,b,c){var d=this.controls[a];if(d&&d.bind){var h=d.options&&d.options.$lookup,a=this.getValue(d.bind,null,"");if(h){if(b){if(null!=b.$value)b[d.options.$display]=
b.$value,delete b.$value;""===b[d.options.$display]&&!b.$key&&!b.$uuid&&(b=null)}if(null===b)null!=a&&(this.setData(d.bind,b),this.notifyChange());else if(b.$key){if(!a||a.$key!=b.$key)this.setData(d.bind,b),this.notifyChange()}else if(b.$uuid){if(!a||a.$uuid!=b.$uuid)this.setData(d.bind,b),this.notifyChange()}else if(null!=b[d.options.$display]){if(!a||a[d.options.$display]!=b[d.options.$display])this.setData(d.bind,b),this.notifyChange()}else null!=a&&(this.setData(d.bind,null),this.notifyChange())}else a!=
b&&(this.setData(d.bind,b),this.notifyChange());if(c)return c()}if(c)return c()},editActivity:function(){return this.options&&this.options.url&&this.options.url.entity===j.sdataKey.workingCopies},draftId:function(){return this.options.url.id},notifyChange:function(){this.editActivity()&&!this.parent&&f.updateDraft(this.draftId(),this.data)},getDiagnoses:function(a){var b=this.data;if(!b)return null;b=b.$properties||b.$;if(!b)return null;b=b[a];if(!b)return null;b=b.$diagnoses;if(!b)return null;var c=
[];b.forEach(function(a){if("error"===a.severity&&c.indexOf(a.$message||a.message))c.push(a.$message||a.message)});return c.length?c:null},getValue:function(a,b,c){for(var b=b||this.data,d=a.split(".");d.length&&b;){a=d.shift();b=b[a]}null==b&&(b=c);return b},getProtoDataValue:function(a,b,c){if(b=b||this.data)b=b.$properties;for(var d=a.split(".");d.length&&b;){a=d.shift();b=b[a]}null==b&&(b=c);return b},allData:function(a){for(var b=this;b.parent;)b=b.parent;if(a)b.data=a;else return b.getCurrentData()},
serviceData:function(){for(var a=this;a.parent;)a=a.parent;return!a.editActivity()?null:a.getCurrentData()},getCurrentData:function(){return this.data},setData:function(a,b,c){for(var c=c||this.data,a=a.split("."),d=0,h=a.length-1;d<h;d++){var f=c[a[d]];f||(f={},c[a[d]]=f);c=f}c[a[a.length-1]]=b},actioncancel:function(a){if(this.editActivity())return f.deleteDraft(this.draftId(),a.success);a.success&&a.success()},actionsave:function(a){var b=this;if(!b.checkData())return a.success(null,!0);c.clearErrors();
if(b.editActivity())return f.saveDraft(b.draftId(),b.data,function(){b.removeCachePages();if(c.hasErrors())return a.success();b._sendLocalData(a.success)});a.success()},setNeedRefresh:function(a){var b=this;if(a){if(b&&b.parent)b.parent.needRefresh=!0}else for(;b;)b.needRefresh=!0,b=b.parent},doRefresh:function(){var a=this,b,c;Object.keys(a.controls).forEach(function(d){d=a.controls[d];if(d.uiClass){var h=i.smobile.controls[d.uiClass]?i.smobile.controls[d.uiClass].refresh:null;h&&d.id&&(c=h(a,d.options,
i("#"+d.id),d.id),!b&&c&&(b=c))}});a&&a.errorInView(b)},actionnext:function(a){var b=this,d=b.getCurrentData(),g=function(){a.success&&a.success(null,!1,!0)};d&&d.$links&&d.$links.$next?(d=j.parseExpression(d.$links.$next.$url,{data:null,$prototype:j.getProto(b.getPageData())},"$url"))?(i.mobile.loading("show",{theme:"a",text:c.locale().ui.loading}),f.execURL(d,{error:function(){i.mobile.loading("hide");g()},success:function(a){i.mobile.loading("hide");if(a)b.data=a,b.doRefresh();g()}})):g():g()},
actionprevious:function(a){var b=this,d=b.getCurrentData(),g=function(){a.success&&a.success(null,!1,!0)};d&&d.$links&&d.$links.$previous?(d=j.parseExpression(d.$links.$previous.$url,{data:null,$prototype:j.getProto(b.getPageData())},"$url"))?(i.mobile.loading("show",{theme:"a",text:c.locale().ui.loading}),f.execURL(d,{error:function(){i.mobile.loading("hide");g()},success:function(a){i.mobile.loading("hide");if(a)b.data=a,b.doRefresh();g()}})):g():g()},actionservice:function(a,b){var d=this,g=function(){a.success&&
a.success(null,!1,!0)};if(!c.online())return g();var h=d.getPageData();if(!b.url)return g();var k=null;b.$parameters&&(k={},Object.keys(b.$parameters).forEach(function(a){k[a]=j.parseExpression(b.$parameters[a],{data:d.exprData(),$prototype:j.getProto(h,b.bind)},"$parameters")}));var l=j.parseExpression(b.url,{data:d.exprData(k),$prototype:j.getProto(h,b.bind)},"$url");c.clearErrors();f.authenticate(function(a,h,i){(h||i)&&g();var a=d.serviceData(),j=!0;a||(a={},b.$parameters&&(a=k),j=!1);f.post(l,
a,function(a){var b=a;if(j)b=d.allData(),c.clearErrors(),b&&(d.allData(b),d.doRefresh(),d.notifyChange());else if(d.removeCachePages(),b=a)(a=c.extractErrors(b,""))&&a&&a.errors.length?a.errors.forEach(function(a){c.pushException(a,"")}):(a=c.extractWarns(b,""))&&a&&a.errors.length&&a.errors.forEach(function(a){c.pushWarning(a,"")});g()})})},installApplication:function(a,b){var d=!1;if(b){c.clearErrors();if(b.datasets)for(var g=b.datasets.length;g--&&!(d=!1!==b.datasets[g].selected););if(d){var h=
this;i.smobile.load(b,function(a,b){0==a&&b?i.mobile.loading("show",{theme:"a",text:c.locale().ui.installing}):a==b&&i.mobile.loading("hide")},function(){i.mobile.loading("hide");c.hasErrors()?(a.fail&&a.fail(),i.smobile.showErrors(h)):a.success&&a.success()})}else if(a.fail)return a.fail()}else if(a.fail)return a.fail()},removeApplication:function(a,b){c.clearErrors();var d=this;f.removeFromDB(b,function(){c.hasErrors()?i.smobile.showErrors(d):a.success&&a.success()})},_sendLocalData:function(a){var b=
this;!c.AutomaticSendBatch()||!c.online()?a&&a():f.getSyncData(function(d,g){if(!g&&d)return f.execBatch(d,{success:function(){c.hasErrors()?i.smobile.showSends(b):a&&a()}});a&&a()})},removeCachePages:function(){for(var a=this,b=[];;)if(a&&a.config&&a.config.page&&a.config.page.pageId&&b.push(a.config.page.pageId),a.parent&&a.$bind)a=a.parent;else break;i.smobile.removeAllPages(b)},actionsync:function(a){c.clearErrors();var b=this,d=b.resync,g=b.resync?i.smobile.load:null;delete b.resync;return f.execBatch(b.data,
{success:function(){if(c.hasErrors())a.success&&a.success(null,!0,!0),i.smobile.showErrors(b);else{if(d)return i.smobile.removeAllPages([b.config.page.pageId]),l.goHome(b);a.success&&a.success(null)}}},g)},actionresync:function(a){return this.actionsync(a)},actionundo:function(a){c.clearErrors();var b=this;b.data?c.each(Object.keys(b.data),function(a,d,h){(a=b.data[a])&&a.length?c.each(a,function(a,b,c){f.undoUpdate(a.$info.url,c)},h):h()},function(){a.success&&a.success()}):a.success&&a.success()},
actiondelete:function(a){var b=this;c.clearErrors();if(b.editActivity())return f.deleteDataByDraft(b.draftId(),function(){if(c.hasErrors())return a.success(null,!0);b._sendLocalData(function(){i.smobile.goHome(b)})});a.success&&a.success()},refreshPanel:function(a){(a=a?this.controls[this.prefix+"left_panel"]:this.controls[this.prefix+"right_panel"])&&a&&a.options.syncHandler&&a.options.syncHandler.bind(this)(a)},remove:function(){i.jqmRemoveData(this.page,"controller");this.page=this.$page=null;
if(this.pageInfo)this.pageInfo.page=null;if(this.options&&this.options.page)this.options.page=null;if(this.parent)this.data=this.parent=this.options=null;this.detailpagedata=this.child=this.extraData=null;c.cleanUp(this)},registerControl:function(a){this.controls[a.id]=a},controlByClass:function(a){for(var b in this.controls){var c=this.controls[b];if(c.uiClass==a)return c}return null},notifyAuthoring:function(a){switch(a){case "pageload":if(this.ui&&f.config&&f.config.pages[this.ui]&&j.auth.designMode){var a=
{name:this.ui},b=f.config.pages[this.ui];a.$authorUrl=b.$authorUrl;a.$prototype=j.auth.copyProto(b.$prototype);var b=j.getArticle(b),c=f.representation2facet(this.ui),b=j.auth.checkDesign(f.config.pages[this.ui].$prototype,b,{design:!0,list:"$query"==c||"$lookup"==c});j.auth.notifyParent("pageload",b,a)}}},bindData:function(a){var b=this;Object.keys(b.controls).forEach(function(a){var a=b.controls[a],c=i("#"+a.id);c&&l.setEvents.apply(b,[c,a])});b.$page.click(function(a){if(a&&a.target){for(var d=
a.target;d&&d.tagName&&"A"!==d.tagName.toUpperCase();)d=d.parentNode;d&&d.href&&0<=d.href.indexOf("#actionservice")&&(a.preventDefault(),(a=i(d).attr("data-action"))&&b.alinks&&b.alinks[a]&&b.actionservice({success:function(){c.hasErrors()&&(i.smobile.showErrors(b),c.clearErrors())}},b.alinks[a]))}});if(b.asyncs){for(var d=b.asyncs.length;d--;)b.asyncs[d](),b.asyncs[d]=null;b.asyncs=null}a&&a()}};i.fn.uiController=function(a){new d(this,a);return this}})(jQuery);(function(i){var c=i.smobile||{};i.smobile=c;var j=i.helpers,f={GroupLayout:function(c){var d=['<center><div id="'+c.id+'" data-role="controlgroup"'];j.addJqmData(c.data,d);d.push('">');return{before:d.join(""),after:"</div></center>",childs:[]}},FieldContainer:function(c){var d=['<div id="'+c.id+'" data-role="fieldcontain"'];j.addJqmData(c.data,d);d.push('">');return{before:d.join(""),after:"</div>",childs:[]}},CollapsibleLayout:function(c){var d=c.data,a=['<div id="'+c.id+'" data-role="collapsible"  data-iconpos="right" data-collapsed="'+
(d.collapsed?"true":"false")+'"'];a.push(' "data-expanded-icon": "arrow-u"');a.push(' "data-collapsed-icon": "arrow-d"');j.addJqmData(d,a);a.push("><h"+(c.size||3)+">"+(d.text||"")+"</h"+(c.size||3)+">");return{before:a.join(""),after:"</div>",childs:[]}},CollapsibleSetsLayout:function(c){var d=['<div id="'+c.id+'" data-role="collapsible-set"'];j.addJqmData(c.data,d);d.push(">");return{before:d.join(""),after:"</div>",childs:[]}},Block:function(c){var d=['<div id="'+c.id+'" data-role="controlgroup"'];
j.addJqmData(c.data,d);d.push('">');return{before:d.join(""),after:"</div>",childs:[]}},BlockBodyLayout:function(c){var d=['<div id="'+c.id+'" class="ui-body s-m-block'];j.addJqmData(c.data,d,["data-theme"],!0,"ui-body-");d.push('">');return{before:d.join(""),after:"</div>",childs:[]}},BlockLayout:function(c){var d=['<div id="'+c.id+'" class="'];j.addJqmData(c.data,d,["data-theme"],!0,"ui-body-");d.push('">');return{before:d.join(""),after:"</div>",childs:[]}},TabsLayout:function(c){var d=[],a=c.data;
d.push('<div id="'+c.id+'" data-role="collapsible-set" data-iconpos="right">');d.push(' "data-expanded-icon": "arrow-u"');d.push(' "data-collapsed-icon": "arrow-d"');var b={childs:[]},e=c.id.substring(this.prefix.length);a.tabs.forEach(function(a,d){var f=['<div id="'+c.id+"_"+d+'" data-role="collapsible"'];f.push(' "data-expanded-icon": "arrow-u"');f.push(' "data-collapsed-icon": "arrow-d"');d?f.push(">"):f.push(' data-collapsed="false">');f.push("<h"+(c.size||3)+">"+(a||"")+"</h"+(c.size||3)+">");
f={id:e+"_"+d,before:f.join(""),after:"</div>",childs:[]};b.childs.push(f)});b.before=d.join("");b.after="</div>";return b},RowLayout:function(c){var d=[],a=c.data,b=["s-m-l-table"];a.responsive&&b.push("responsive");a.theme&&b.push("ui-body-"+a.theme.toLowerCase());d.push('<div id="'+c.id+'" class="'+b.join(" ")+'">');var e={childs:[]},g=c.id.substring(this.prefix.length),h=a.widths.length-1;a.widths.forEach(function(b,d){0>b.indexOf("%")&&0>b.indexOf("px")&&(b+="%");var f="";switch(b){case "20%":f=
"s-proc-20";break;case "25%":f="s-proc-25";break;case "30%":f="s-proc-30";break;case "50%":f="s-proc-50";break;case "75%":f="s-proc-75";break;case "33%":case "33.33%":f="s-proc-33";break;case "66%":case "67%":case "66.66%":f="s-proc-67";break;case "70%":f="s-proc-70"}var i=["s-m-l-row"];0===d&&d!==h?i.push("first"):0!==d&&d===h&&i.push("last");a.responsive&&i.push("responsive");f&&i.push(f);i=['<div id="'+c.id+"_"+d+'" class="'+i.join(" ")+'"'];f||i.push(' style="width:'+b+';"');i.push(">");f={id:g+
"_"+d,before:i.join(""),after:"</div>",childs:[]};e.childs.push(f)});e.before=d.join("");e.after="</div>";return e}};c.addLayout=function(c,d){if(f[d.layout]){var a=f[d.layout].apply(this,[d]);a.layoutClass=d.layout;c.childs.push(a);return a}return null}})(jQuery);(function(i){var c=i.smobile||{};i.smobile=c;var j=i.helpers,f=i.proto,l=j.ui.consts;c.ui=c.ui||{};c.ui.menuItem=function(c,a,b){b=b||l.default_menu_name;a||(a=c||"");b=b.split(".");1==b.length&&b.splice(0,0,l.default_menu_class);return'<div class="'+l.menu_icon_size+" "+b.join(" ")+'"></div><h3>'+c+"</h3><p><strong>"+a+"</strong></p>"};c.ui.iconItem=function(c,a,b){b=b||l.default_icon_name;b=b.split(".");1==b.length&&b.splice(0,0,l.default_icon_class);return'<div class="'+l.normal_icon_size+" "+
b.join(" ")+'"></div><h3>'+c+"</h3><p><strong>"+a+"</strong></p>"};c.ui.panelItem=function(c,a,b,e){a=a||l.default_panel_name;a=a.split(".");1==a.length&&a.splice(0,0,l.default_panel_class);c='<div class="'+l.panel_icon_size+" "+a.join(" ")+'"></div>'+j.htmlEncode(c);b&&(c+='<p class="s-m-pspace">'+j.htmlEncode(b)+"</p>");null!=e&&(c+='<span class="s-m-notify-sync ui-li-count s-m-hidden">0</span>');return c};c.ui.sdata_link=function(c,a){var b="";if(a.url)b=a.url;else if(a.facet){var e={$role:i.sdata.config.role||
"",$baseUrl:i.sdata.config.baseUrl,$pluralType:a.entity,$representation:a.representation||""};"$dashboard"==a.facet?b=a.dashboard+".$dashboard":"$query"==a.facet?(b="{$baseUrl}/{$pluralType}?representation={$representation}.$query&role={role}"+(a.params?"&"+a.params:""),b=f.parseExpression(b,{data:f.exprData(e)},"$url")):"$create"==a.facet&&(b=".$create",i.sdata.config.pages[a.representation+b]||(b=".$edit"),b="{$baseUrl}/{$pluralType}/$template/$workingCopies?representation={$representation}"+b+
"&role={role}"+(a.params?"&"+a.params:""),b=f.parseExpression(b,{data:f.exprData(e)},"$url"))}return b};c.ui.urlHref=function(d,a){var b=[j.hashFirst()?"#"+c.linkDetailPage(a):""];b.push(j.encodeJsmQuery("?url="+j.encodeURIComponent(d)));b.push(j.hashFirst()?"":"#"+c.linkDetailPage(a));return b.join("")};c.controls={};c.ui.refreshErrors=function(c,a,b){c=c.getDiagnoses(a);b=i("#"+b+"_error");b.html(c?c.join("<br/>"):"");return c?b:null};c.ui.addErrors=function(c,a,b,e){e.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+
b+'_error">');(c=c.getDiagnoses(a))&&e.push(c.join("<br/>"));e.push("</div>")};c.ui.addLinks=function(c,a,b,e,g){c=a.getPageData();c=f.getProto(c);(e=f.extractLinks(e,c,a.getCurrentData(),!0))&&e.length&&e.forEach(function(c){a.alinks=a.alinks||{};var d=j.uuid();a.alinks[d]={bind:g,$title:c.$title,url:c.$url,$method:c.$method,$parameters:c.$parameters};b.push('<a href="#actionservice" data-role="button" data-action="'+d+'" data-iconpos="left" data-mini="true" data-theme="d" data-icon="gear" data-inline="true">'+
c.$title+"</a>")})};c._addLink=function(d,a,b,e){var g=a.css||[],h=!1;a.disabled&&g.push("ui-disabled");if(a.url||a.hash||a.action){h=!0;if(a.action)if("popup"===a.action)d.push('<a href="#'+a.popupId+'"'),d.push(' data-rel="popup"');else{if(d.push('<a href="#"'),!a.actionParams)a.actionParams=a.action}else if(a.hash){if(b.applicationId&&0>a.hash.indexOf(c.hash_sep)){var f=c.PAGES[a.hash];if(f&&2==f.useAppId)a.hash=a.hash+c.hash_sep+j.encodeURIComponent(b.applicationId)}a.navbar&&!b.applicationId&&
b.pageInfo.page.id==a.hash&&g.push("ui-btn-active");d.push('<a href="#'+a.hash+'"')}else"$external"==a.linkType?d.push('<a href="'+a.url+'"'):(d.push('<a href="'),d.push(c.ui.urlHref(a.url,b)),d.push('"'));a.actionParams&&d.push(" data-action='"+a.actionParams+"'");j.addJqmData(a,d);a.controlId&&d.push(' id="'+a.controlId+'"');g.length&&d.push(' class="'+g.join(" ")+'"');a.linkId&&d.push(" id='"+a.linkId+"'");d.push(">")}null!=a.value?(d.push(j.htmlEncode(a.value)),a.title&&d.push('<span class="s-m-linkdesc"> '+
j.htmlEncode(a.title)+"<span>")):e&&e();h&&d.push("</a>")};c.controls.Html={sync:!0,handler:function(c,a){var b=c.data,e={html:b.html,options:b};b.html=null;return a(e)}};c.addControl=function(d,a,b){var e=c.controls[a.uiClass];e&&e.handler?e.handler.apply(this,[a,function(a){a&&(Array.isArray(a)?a.forEach(function(a){d.childs.push(a)}):d.childs.push(a));b(a)},d.layoutClass]):b(null)};c.setEvents=function(d,a){var b=c.controls[a.uiClass];return b&&b.events?b.events.apply(this,[d,a]):null}})(jQuery);(function(i){var c=i.smobile;c.controls=c.controls||{};c.controls.MainMenu={sync:!0,handler:function(i,f){((i.data||{}).items||[]).forEach(function(c){c.data=c.data||{};c.data.menu=!0});return c.controls.List.handler.apply(this,[i,f])}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers;c.controls=c.controls||{};c.controls.Combo={createCombo:function(f,i){var d=i.data||{},a=['<div data-role="fieldcontain" id="'+i.id+'">'];c.ui.addErrors(f,d.bind,i.id,a);a.push('<label class="ui-input-text" for="'+i.id+'_i">'+d.label+": </label>");a.push('<select id="'+i.id+'_i"');j.addJqmData(d,a);a.push(">");var b=f.getValue(d.bind,null,null),e=b||d.value;d.items=d.items||[];if(null==b&&d.items.length)e=d.items[0].value,f.setData(d.bind,e);d.items.forEach(function(b){a.push('<option value="'+
b.value+'"'+(e==b.value?' selected="selected"':"")+">"+b.title+"</option>")});a.push("</select>");a.push("</div>");return{html:a.join(""),bind:d.bind,options:d}},sync:!0,handler:function(f,i){i(c.controls.Combo.createCombo(this,f))},checkValue:function(c,i){c.find("#"+i.id+"_i").find("option:selected").val();c.find("#"+i.id+"_error").html("")},refresh:function(f,i,d,a){return c.ui.refreshErrors(f,i.bind,a)},events:function(c,i){var d=this,a=c.find("#"+i.id+"_i");a.bind("change",function(){var b=a.find("option:selected").val(),
c=d.afterChangeHnd(i);d.getValue(i.bind,null,null)!=b&&(d.setData(i.bind,b),d.notifyChange(),c&&c(),(b=i.options.action&&d.pageActions?d.pageActions["action"+i.options.action]:null)&&b.bind(d)())})}}})(jQuery);(function(i){var c=i.smobile||{};i.smobile=c;var j=i.helpers,f=i.sdata,l=function(c){switch(c){case f.STATUS.CREATED:return"created";case f.STATUS.DELETED:return"deleted";case f.STATUS.MODIFIED:return"modified"}return""};c.controls.SyncView={create_buttons:function(d,a,b,e,g){if(d.data){var h={linkId:g+"_undo",title:j.locale().ui.sync_cancel_all,action:"undo",jmdata:{"data-iconpos":"top","data-icon":"delete","data-transition":"none"}};c._addLink(a,h,d,function(){a.push(j.htmlEncode(h.title))});e.push(h.linkId);
var f={linkId:g+"_sync",title:j.locale().ui.sync_send_all,action:"sync",jmdata:{"data-iconpos":"top","data-icon":"arrow-u","data-transition":"none"}};c._addLink(b,f,d,function(){b.push(j.htmlEncode(f.title))});e.push(f.linkId)}else{var i={linkId:g+"_install",title:j.locale().ui.sync_resync_data,action:"resync",jmdata:{"data-iconpos":"top","data-icon":"arrow-d","data-transition":"none"}};c._addLink(b,i,d,function(){b.push(j.htmlEncode(i.title))});e.push(i.linkId)}},create_items:function(d,a,b,e,g){var h=
0;Object.keys(a).forEach(function(k){var i=f.entityMeta(k);i&&(b.push('<li data-role="list-divider">'),b.push(i.title||k),b.push("</li>"),a[k].forEach(function(a){h++;b.push('<li data-role="fieldcontain"');var k=[],i="";k.push("ui-li-has-icon");k.push(j.ui.consts.normal_icon);k.length&&b.push(' class="'+k.join(" ")+'"');b.push(">");k=[];k.push('<div class="ui-li-icon ui-li-thumb s-m-status '+l(a.$info.status)+'"></div>');k.push(j.htmlEncode(a.$info.title||"..."));a.$info.last_error&&(k.push('<p class="s-m-error"><strong>'),
k.push(j.htmlEncode(a.$info.last_error)),k.push("</strong></p>"));a.$info.status==f.STATUS.DELETED?(b.push(k.join("")),b.push('<div class="ui-grid-a"><div class="ui-block-a">'),b.push('</div><div class="ui-block-b">'),i=g+"_"+h+"_cancel",e.push(i),b.push('<button data-iconpos="top" id="'+i+'" data-role="button" data-mini="true"  data-action="cancel" data-theme="f" data-icon="delete"')):(b.push(k.join("")),b.push('<div class="ui-grid-a"><div class="ui-block-a">'),i=g+"_"+h+"_detail",e.push(i),b.push('<a data-role="button" data-iconpos="top" id="'+
i+'" data-action="edit" data-role="button" data-mini="true" data-theme="f" data-icon="edit"'),b.push(' data-action-param="'+f.editUrl(a.$info.url)+'"'),b.push(' href="'+c.ui.urlHref(f.editUrl(a.$info.url),d)+'"'),b.push(">"),b.push(j.htmlEncode(j.locale().ui.edit_item)),b.push("</a>"),b.push('</div><div class="ui-block-b">'),i=g+"_"+h+"_cancel",e.push(i),b.push('<button data-iconpos="top" id="'+i+'" data-action="cancel" data-role="button" data-mini="true" data-theme="f" data-icon="delete"'));b.push(' data-action-param="'+
a.$info.url+'"');b.push(">");b.push(j.htmlEncode(j.locale().ui.cancel_item));b.push("</button>");b.push("</div></div>");b.push("</li>")}))})},events:function(d,a){var b=this;d.click(function(d){for(var e=d.target;e&&e.tagName&&"BUTTON"!=e.tagName.toUpperCase()&&"A"!=e.tagName.toUpperCase();)e=e.parentNode;if(e)if("cancel"===i(e).attr("data-action"))i(e).button("disable"),d=i(e).attr("data-action-param"),f.undoUpdate(d,function(){f.getSyncDataCount(function(a){i(e).button("enable");if(!a)return c.doBack(null);
b.doRefresh();j.clearErrors()})});else if(a.options.actions[e.id]){var k=b["action"+a.options.actions[e.id]];k&&(k.call(b,{success:function(a,c,d){!c&&!d&&i.smobile.doBack(b)}}),d.preventDefault())}});var e=d.find("#"+b.prefix+"reinstall_i");e.change(function(){b.resync=e[0].checked})},sync:!1,asyncHandler:function(){var d=this.controller,a=this.id;f.getSyncData(function(b,e){var g=[],h=[],f=[],l=[];if(!e)(d.data=b)&&c.controls.SyncView.create_items(d,b,g,h,a);var j=i("#"+a+"_ul");j.html(g.join(""));
j.listview("refresh");g=i("#"+a+"_b1");j=i("#"+a+"_b2");c.controls.SyncView.create_buttons(d,f,l,h,a);g.html(f.join(""));j.html(l.join(""));h.forEach(function(a){i("#"+a).button()})})},handler:function(d,a){var b=[];this.hasSyncView=!0;b.push('<form  id="'+d.id+'">');b.push('<ul id="'+d.id+'_ul" data-role="listview"');b.push(' data-inset="true"');b.push(">");b.push("</ul>");var e={id:this.prefix+"reinstall"};e.data={label:j.locale().ui.sync_sync_data,value:!1,action:" ",noform:!0};c.controls.CheckBox.handler.apply(this,
[e,function(a){b.push(a.html)}]);b.push('<div class="ui-grid-a"><div class="ui-block-a" id ="'+d.id+'_b1">');b.push('</div><div class="ui-block-b" id ="'+d.id+'_b2">');b.push("</div></div>");e={};e[d.id+"_undo"]="undo";e[d.id+"_sync"]="sync";e[d.id+"_install"]="resync";b.push("</form>");a({html:b.join(""),bind:" ",options:{actions:e},async:c.controls.SyncView.asyncHandler.bind({controller:this,id:d.id})})},refresh:function(d,a,b,e){var g=[],h=[],k=[],l=[],j=b.children("#"+e+"_ul");f.getSyncData(function(a,
b){if(!b)(d.data=a)&&c.controls.SyncView.create_items(d,a,g,h,e);j.html(g.join(""));var f=i("#"+e+"_b1"),s=i("#"+e+"_b2");c.controls.SyncView.create_buttons(d,k,l,h,e);f.html(k.join(""));s.html(l.join(""));h.forEach(function(a){i("#"+a).button()});j.listview("refresh")})}}})(jQuery);(function(i){var c=i.smobile||{};i.smobile=c;var j=i.helpers,f=i.sdata;c.controls.AppsView={_hasApp:function(c,d,a){for(var b=c.length;b--;){var e=c[b];if(e.url==d&&e.baseURL==a)return!0}return!1},_removeInstalled:function(f,d){if(!d||!d.length)return f;for(var a=f.length;a--;){for(var b=f[a],e=b.datasets.length;e--;)c.controls.AppsView._hasApp(d,b.url,b.baseURL+b.datasets[e].dataset)&&b.datasets.splice(e,1);b.datasets.length||f.splice(a,1)}return f},_addinstalled:function(c,d,a,b,e){var g,h,f=[];
c.data.remove={};e?(b=[],g=i("#"+d+"_remove_content"),h=i("#"+d+"_remove"),h.html(""),!a||!a.length?g.hasClass("s-m-hidden")||g.addClass("s-m-hidden"):g.hasClass("s-m-hidden")&&g.removeClass("s-m-hidden")):(b.push('<div id="'+d+'_remove_content" data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-d" data-expanded-icon="arrow-u"  data-collapsed="false" data-inset="true"'),(!a||!a.length)&&b.push(' class="s-m-hidden"'),b.push(">"),b.push("<h2>"+j.locale().applicationmanager.installed_apps+
"</h2>"),b.push('<ul id="'+d+'_remove" data-role="listview"'),b.push(' data-inset="false"'),b.push(">"));a&&a.length&&(a.forEach(function(a){c.data.remove[a.id]=a;b.push('<li data-role="fieldcontain"');b.push(' class="ui-li-has-icon '+j.ui.consts.menu_icon+'"');b.push(">");b.push('<div class="ui-grid-a"><div class="ui-block-a">');b.push(i.smobile.ui.menuItem(a.title,a.description,a.icon));b.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="g" data-icon="delete" id="'+
a.id+'_remove" data-inline="false">'+j.locale().applicationmanager.uninstall+"</button></div></div>");f.push({hid:a.id+"_remove",id:a.id});b.push("</li>")}),e&&(h.html(b.join("")),f.forEach(function(a){i("#"+a.hid).button()}),h.listview("refresh")));c.data.removeHtml={};f.forEach(function(a){c.data.removeHtml[a.hid]=a});e||(b.push("</ul>"),b.push("</div>"))},_addtoinstall:function(c,d,a,b,e){var g,h,f=[],u=[];c.data.install={};e?(b=[],g=i("#"+d+"_install_content"),h=i("#"+d+"_install"),h.html(""),
!a||!a.length?g.hasClass("s-m-hidden")||g.addClass("s-m-hidden"):g.hasClass("s-m-hidden")&&g.removeClass("s-m-hidden")):(b.push('<div id="'+d+'_install_content"  data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-d" data-expanded-icon="arrow-u" data-inset="true" data-collapsed="false"'),(!a||!a.length)&&b.push(' class="s-m-hidden"'),b.push(">"),b.push("<h2>"+j.locale().applicationmanager.available_apps+"</h2>"),b.push('<ul id="'+d+'_install" data-split-icon="plus" data-split-theme="d" data-role="listview"'),
b.push(' data-inset="false"'),b.push(">"));a&&a.length&&(a.forEach(function(a){a.id=j.uuid();b.push('<li data-role="fieldcontain"');b.push(' class="ui-li-has-icon '+j.ui.consts.menu_icon+'"');b.push(">");b.push('<div class="ui-grid-a"><div class="ui-block-a">');b.push(i.smobile.ui.menuItem(a.title,a.description,a.icon));b.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="f" data-icon="plus" id="'+a.id+'_install" data-inline="false">'+j.locale().applicationmanager.install+
"</button></div></div>");f.push({hid:a.id+"_install",id:a.id});if(a.datasets.length){var c=1==a.datasets.length;a.datasets.forEach(function(a){a.selected=c});a.datasets.forEach(function(c){c.$name=j.uuid();b.push("<form>");b.push('<input  data-mini="true" type="checkbox"'+(c.selected?' checked="true"':"")+' name="'+c.$name+'" id="'+c.$name+'" class="custom" />');b.push('<label for="'+c.$name+'">'+c.description+"</label>");b.push("</form>");u.push({hid:c.$name,id:a.id,dataset:c.$name})})}b.push("</li>")}),
e&&(h.html(b.join("")),f.forEach(function(a){i("#"+a.hid).button()}),u.forEach(function(a){i("#"+a.hid).checkboxradio()}),h.listview("refresh")));e||(b.push("</ul>"),b.push("</div>"));c.data.install={};c.data.installHtml={};f.forEach(function(a){c.data.installHtml[a.hid]=a});c.data.installCHtml={};u.forEach(function(a){c.data.installCHtml[a.hid]=a});a&&a.map(function(a){c.data.install[a.id]=a})},sync:!1,asynchandler:function(){var i=this.controller,d=this.id,a=[];f.getInstalledApps(!0,function(b){f.applicationList({success:function(e){e=
e||[];e=c.controls.AppsView._removeInstalled(e,b);c.controls.AppsView._addtoinstall(i,d,e,a,!0);c.controls.AppsView._addinstalled(i,d,b,a,!0);c.controls.AppsView.suppevents(i)}})})},handler:function(f,d){var a=[];this.data={};a.push('<div class="ui-body">');c.controls.AppsView._addtoinstall(this,f.id,[],a,!1);c.controls.AppsView._addinstalled(this,f.id,[],a,!1);a.push("</div>");return d({html:a.join(""),bind:" ",async:c.controls.AppsView.asynchandler.bind({controller:this,id:f.id})})},refresh:function(i,
d,a,b){var e=[];f.getInstalledApps(!0,function(a){f.applicationList({success:function(d){d=d||[];d=c.controls.AppsView._removeInstalled(d,a);c.controls.AppsView._addtoinstall(i,b,d,e,!0);c.controls.AppsView._addinstalled(i,b,a,e,!0);c.controls.AppsView.suppevents(i)}})})},suppevents:function(c){c.data.installCHtml&&Object.keys(c.data.installCHtml).forEach(function(d){i("#"+d).change(function(){for(var a=c.data.installCHtml[d],b=c.data.install[a.id],e=b.datasets.length;e--;){var g=b.datasets[e];if(g.$name===
a.dataset)g.selected=null==g.selected?!1:!g.selected}})})},events:function(f,d){var a=this,b=i("#"+d.id+"_install_content");i("#"+d.id+"_remove_content").click(function(b){b=b.target;if(!a.disabled)for(;b;){if(b.id){if(b=a.data.removeHtml[b.id])b=b.id,a.disabled=!0,a.removeApplication({success:function(){a.disabled=!1;i.smobile.goHome(a)},fail:function(){a.disabled=!1}},b,a.data.remove);break}b=b.parentNode}});b.click(function(b){b=b.target;if(!a.disabled)for(;b;){if(b.id){if(b=a.data.installHtml[b.id])b=
b.id,a.disabled=!0,a.installApplication({success:function(){a.disabled=!1;i.smobile.goHome(a)},fail:function(){a.disabled=!1}},a.data.install[b]);break}b=b.parentNode}});c.controls.AppsView.suppevents(a)}}})(jQuery);(function(i){var c=i.smobile||{};i.smobile=c;var j=i.helpers,f=function(c){switch(c){case j.ERRORS.http:return"http";case j.ERRORS.db:return"db";case j.ERRORS.exception:return"app";case j.ERRORS.sdata:return"sdata"}};c.controls.ErrorView={_additem:function(c,d){d.push("<li");var a=[];a.push("ui-li-has-icon");a.push(j.ui.consts.normal_icon);a.length&&d.push(' class="'+a.join(" ")+'"');d.push(">");d.push('<div class="'+j.ui.consts.normal_icon_size+" s-error "+f(c.type)+'"></div>');d.push(j.htmlEncode(c.title));
c.data.message=c.data.message||"";a=c.data.message.replace(/\r\n/g,"\n").split("\n");1<a.length?(d.push('<div data-role="collapsible" data-mini="true">'),d.push('<h3><span class="s-m-error">'+j.htmlEncode(a[0])+"</span></h3>"),a.shift(),d.push('<p class="s-m-error">'),d.push(a.join("<br />")),d.push("</p>"),d.push("</div>")):(d.push('<p class="s-m-error"><strong>'),d.push(j.htmlEncode(a[0])),d.push("</strong></p>"));d.push('<p class="s-m-info">');d.push(j.htmlEncode(c.data.solution));d.push("</p>");
d.push("</li>")},sync:!0,handler:function(f,d){var a=this,b=[],e=j.lastErrors();b.push('<ul id="'+f.id+'" data-role="listview"');b.push(' data-inset="true"');b.push(">");a.errorViewHasErrors=!1;e&&(e.forEach(function(d){c.controls.ErrorView._additem(d,b);a.errorViewHasErrors=!0}),j.clearErrors());b.push("</ul>");a.hasErrorView=!0;d({html:b.join(""),bind:!0})},refresh:function(f,d,a,b){var d=j.lastErrors(),e=[],g=!1;f.errorViewHasErrors=!1;d&&(d.forEach(function(a){g=!0;c.controls.ErrorView._additem(a,
e);f.errorViewHasErrors=!0}),a.html(e.join("")));a.find("div:jqmData(role='collapsible')").each(function(){i(this).collapsible()});a.listview("refresh");return g?{$element:a,id:b,uiClass:"ErrorView"}:null}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.scroller,l=i.proto;c.controls=c.controls||{};c.controls.Edit={_nativeToString:function(c,a){return"range"==a||"number"==a?(c||0)+"":"date"==a?!c?"":f.formatDate(j.dateSettings.dateFormat,c):"datetime"==a?!c?"":f.formatDate(j.dateSettings.dateFormat+"  "+j.dateSettings.timeFormat,c):"time"==a?c.format():c||""},_getvalue:function(d,a){var b=null;if("date"==d.type)if(b=a.getValue(d.bind,null,null),null!=b)try{b=Date.parseISO8601(b)}catch(e){b=new Date}else d.$isMandatory&&
a.config.inCreate&&(b=new Date);else if("time"==d.type){b=a.getValue(d.bind,null,0);try{b=j.Time.parse(b)}catch(g){b=new j.Time(0)}}else if("datetime"==d.type)if(b=a.getValue(d.bind,null,0),null!=b)try{b=Date.parseISO8601(b)}catch(h){b=new Date}else d.$isMandatory&&a.config.inCreate&&(b=new Date);else b="number"==d.type?a.getValue(d.bind,null,0):"range"==d.type?a.getValue(d.bind,null,0):a.getValue(d.bind,null,"");return c.controls.Edit._nativeToString(b,d.type)},createEdit:function(d,a){var b=a.data,
e=['<div data-role="fieldcontain" id="'+a.id+'">'],g=d.getProtoDataValue(b.bind);l.updproto(b,g);if("number"===b.type){if(null!=b.$minimum&&null!=b.$maximum&&(b.$minimum||b.$maximum))b.type="range"}else if("range"===b.type&&!b.$minimum&&!b.$maximum)b.type="number";c.ui.addErrors(d,b.bind,a.id,e);e.push('<label class="ui-input-text" for="'+a.id+'_i">'+j.htmlEncode(b.label)+(b.$isMandatory?"*":"")+"</label>");e.push("<input ");g=b.type||"text";if("date"==g||"time"==g||"datetime"==g)g="text";e.push('type="'+
g+'" name="'+a.id+'" id="'+a.id+'_i" ');b.$isReadOnly&&e.push('readonly="true" ');e.push('value="');g=c.controls.Edit._getvalue(b,d);e.push(j.htmlEncode(g));e.push('"');b.$pattern&&e.push(' pattern="'+b.$pattern+'"');null!=b.$minimum&&e.push(' min="'+b.$minimum+'"');null!=b.$maximum&&e.push(' max="'+b.$maximum+'"');b.$maxLength&&e.push(' maxlength="'+b.$maxLength+'"');b.$isMandatory&&e.push(' required="required"');e.push("/>");e.push("</div>");return{html:e.join(""),bind:b.bind,options:b}},refresh:function(d,
a,b,e){i("#"+e+"_i").val(c.controls.Edit._getvalue(a,d));return c.ui.refreshErrors(d,a.bind,e)},sync:!0,handler:function(d,a){return a(c.controls.Edit.createEdit(this,d))},checkValue:function(c,a){var b=c.find("#"+a.id+"_i"),e=c.find("#"+a.id+"_error");e.html("");var g=a.options;if(g.$isMandatory&&""===b[0].value)return b={field:c,message:j.format(j.locale().ui.mandatory_field,[g.label])},this.pushError(b),e.html(b.message),{$element:e,id:a.id,uiClass:"Edit"};if(g.$minLength&&b[0].value.length<g.$minLength)return b=
{field:c,message:j.format(j.locale().ui.minlength_field,[g.label])},this.pushError(b),e.html(b.message),{$element:e,id:a.id,uiClass:"Edit"}},_checkDateTime:function(c,a){var b=i("#"+c.id+"_i"),e,g,h,k=a.afterChangeHnd(c);if("date"==c.options.type){e=b.val();if(!e)return a.checkChange(c.id,e,k);try{e=f.parseDate(j.dateSettings.dateFormat,e)}catch(l){e=new Date}e=e.toISOString();g=a.getValue(c.bind,null,"");h=j.date.checkString(e,g);if(e!=h){var r=f.formatDate(j.dateSettings.dateFormat,j.date.isoToDate(e));
b.val(r)}g!=h&&a.checkChange(c.id,h,k)}else if("time"==c.options.type){e=b.val();g=a.getValue(c.bind,null,"");e||(e=j.Time.parse(g).format());try{e=j.Time.parseTime(e)}catch(p){e=j.Time.parse("00:00")}b.val(e.format());e=e.toISO();e!=g&&a.checkChange(c.id,e,k)}else if("datetime"==c.options.type){e=b.val();if(!e)return a.checkChange(c.id,e,k);try{e=f.parseDate(j.dateSettings.dateFormat+" "+j.dateSettings.timeFormat,e)}catch(q){e=new Date}e=e.toISOString();g=a.getValue(c.bind,null,"");r=f.formatDate(j.dateSettings.dateFormat+
" "+j.dateSettings.timeFormat,j.date.isoToDate(e));b.val(r);g!=e&&a.checkChange(c.id,e,k)}},_updNumber:function(c,a,b){var e=c.afterChangeHnd(b),g,h;(h=b.options.$minimum)||(h=0);g=c.getValue(b.bind,null,h);h=parseFloat(a[0].value);isNaN(h)&&(h=g);if("range"==b.options.type)if(h<b.options.$minimum)h=b.options.$minimum;else if(h>b.options.$maximum)h=b.options.$maximum;g=b.options.decimals;null==b.options.decimals&&b.options.bindDecimals&&(g=c.getValue(b.options.bindDecimals,null,0));null!=g&&(h=parseFloat(h.toFixed(g)));
a[0].value=h;c.checkChange(b.id,h,e)},events:function(d,a){var b=this,e=d.find("#"+a.id+"_i");"date"==a.options.type?e.scroller({preset:"date"}):"datetime"==a.options.type?e.scroller({preset:"datetime"}):"time"==a.options.type&&e.scroller({preset:"time"});"range"==a.options.type&&e.slider({stop:function(){c.controls.Edit._updNumber(b,e,a)}});e.blur(function(){var d=b.afterChangeHnd(a);a.bind&&("number"===a.options.type||"range"===a.options.type?c.controls.Edit._updNumber(b,e,a):"datetime"==a.options.type?
window.setTimeout(function(){c.controls.Edit._checkDateTime(a,b)},0):"time"==a.options.type?window.setTimeout(function(){c.controls.Edit._checkDateTime(a,b)},0):"date"==a.options.type?window.setTimeout(function(){c.controls.Edit._checkDateTime(a,b)},0):b.checkChange(a.id,e.val(),d))})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto;c.controls=c.controls||{};c.controls.Picture={_setPhoto:function(c,d,a,b){var e=d.find("#"+a.id+"_image"),g=d.find("#"+a.id+"_cont"),d=c.getPageData(),d=f.getProto(d,a.options.bind),h=function(){g.addClass("s-m-noimage");e.addClass("s-m-hidden");e[0].src=""};if(!d)return h();var k=function(){g.removeClass("s-m-noimage");e.removeClass("s-m-hidden")},b=b||(c?c.getValue(a.options.bind,null,null):null);null==b?h():(a=b.$url,!a&&d.$url&&(a=d.$url.replace(/\~\{\$uuid\}/,
""),a=f.parseExpression(a,{data:c.exprData(),$prototype:d},"$url")),b.$value?(e[0].src="data:"+(b.$contentType||"image/jpeg")+";base64,"+b.$value,k()):a?(f.isExpression(a)&&(a=f.parseExpression(a,{data:c.exprData(),$prototype:d},"$url")),e[0].src=a,k()):h())},createPicture:function(c,d){var a=d.data,b=[];b.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');a.label&&b.push(j.htmlEncode(a.label));b.push('<div id="'+d.id+'">');b.push('<div id="'+d.id+'_cont" class="ui-body s-m-image-container s-m-noimage" >');
b.push('<input id="'+d.id+'_input" class="s-hidden-file" accept="image/*" type="file" data-role="none" data-ajax="false" name="'+d.id+'_input"/>');b.push('<center><img class="s-m-image s-m-hidden" id="'+d.id+'_image" src="');b.push('"/></center>');b.push("</div>");b.push('<a id="'+d.id+'_file" data-theme="f" data-role="button" data-mini="true" data-icon="file" data-inline="false">'+j.locale().ui.picture_file+"</a>");b.push("</div>");return{html:b.join(""),bind:a.bind,options:a}},sync:!0,handler:function(f,
d){return d(c.controls.Picture.createPicture(this,d))},checkValue:function(c,d){var a=i("#"+d.id+"_error");a.html("");if(d.options.$isMandatory&&!this.getValue(d.options.bind,null,null)){var b={field:c,message:j.format(j.locale().ui.mandatory_field,[d.options.label])};this.pushError(b);a.html(b.message)}},events:function(f,d){var a=this,b=f.find("#"+d.id+"_file"),e=f.find("#"+d.id+"_input");b.bind("click",function(){f.find("#"+d.id+"_input").click()});e.bind("change",function(b){if(window.File&&window.FileReader&&
window.FileList&&window.Blob){var e=b.target.files,b={};if(e&&e.length&&(e=e[0],e.type.match("image.*"))){b.$contentType=e.type;b.$fileName=e.name;b.$type="image";var k=new FileReader;k.onload=function(b,e){return function(b){var g=b.target.result.indexOf("base64,");e.$value=0<g?b.target.result.substring(g+7):b.target.result;delete e.$url;c.controls.Picture._setPhoto(a,f,d,e);a.setData(d.options.bind,e);a.notifyChange()}}(e,b);k.readAsDataURL(e)}}});c.controls.Picture._setPhoto(a,f,d)}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto,l=i.sdata;c.controls=c.controls||{};var d=c.controls;d.types=d.types||{};d.types.addArray=function(a,b,c){return{value:j.locale().ui.array_detail,action:"show_detail",actionParams:JSON.stringify({action:"show_detail",$bind:a,$parentbind:b,$index:c})}};d.types.addReference=function(a,b,c,d,h){var d={},k=b,i,a=a.$item||a;b&&Array.isArray(b)?(h&&(i=b[0]),k=b[b.length-1]):i=b;if(i&&(i.$title||i.$description))d.title=i.$title||i.$description;if(f.useUuid(a)&&
!k)return d.value="",d;d.value=k&&k.hasOwnProperty("$value")?k.$value:a.$value?f.parseExpression(a.$value,{data:c.exprData(b),$prototype:a},"$value"):f.parseExpression(a.$key,{data:c.exprData(b),$prototype:a},"$key");if(a.$links&&a.$links.$details&&(a=f.parseExpression(a.$links.$details.$url,{data:c.exprData(b),$prototype:a},"$url"),b=l.parseSdataUri(a),l.url2proto(b)))d.url=a;return d};d.types._table_header=function(a,b,c,d){a.push('<table data-role="table" data-mode="reflow" class="s-m-table ui-responsive table-stroke"');
a.push(">");a.push("<thead><tr>");var h=c.$properties,k=!0;b.forEach(function(b,d){if(b&&b.$bind)b=b.$bind;h[b].$isHidden||(k?(k=!1,a.push('<th data-priority="persist">')):a.push('<th data-priority="'+d+'">'),a.push(j.htmlEncode(f.parseExpression(h[b].$shortTitle||h[b].$title,{data:null,$prototype:c},"$title"))),a.push("</th>"))});d&&(a.push('<th data-priority="'+b.length+'"></th>'),a.push('<th data-priority="'+b.length+1+'"></th>'));a.push("</tr></thead>");a.push("<tbody>")};d.types._table_row=function(a,
b,e,g,h,k,i){a.push("<tr>");var l=e.$properties,p=!0;b.forEach(function(b){if(b&&b.$bind)b=b.$bind;var k=l[b];k.$isHidden||(p?a.push("<th>"):a.push("<td>"),"application/x-reference"===k.$type?(b=d.types.addReference(k,[g[b],g],h,b,!0),c._addLink(a,b,h)):a.push(f.htmlValue(g,e,k,{$type:k.$type,$bind:b})),p?(a.push("</th>"),p=!1):a.push("</td>"))});k&&(a.push("<td>"),a.push('<a href="#" data-role="button"  data-index="'+i+'" data-action="edit" xdata-iconpos="notext" data-theme="f" data-mini="true" data-icon="edit"'),
a.push(">"+j.locale().ui.edit_item+"</a>"),a.push("</td>"),a.push("<td>"),a.push('<a href="#" data-role="button"  xdata-iconpos="notext" data-index="'+i+'" data-action="delete" data-theme="f" data-mini="true" data-icon="delete"'),a.push(">"+j.locale().ui.remove_item+"</a>"),a.push("</td>"));a.push("</tr>")};d.types._table_end=function(a){a.push("</tbody>");a.push("</table>")};d.types._cards=function(a,b,e,g,h,k,i,l){var p;a.push('<table data-role="table" data-mode="reflow" class="s-m-table tv ui-responsive table-stroke"');
a.push(">");a.push("<thead><tr>");a.push('<th class="s-m-header-empty" data-priority="1"></th>');a.push('<th class="s-m-header-empty" data-priority="persist"></th>');a.push("</tr></thead>");a.push("<tbody>");var q=e.$properties;b.forEach(function(b){var s=q[b.$bind];a.push("<tr>");a.push("<th>");a.push(j.htmlEncode(f.parseExpression(s.$shortTitle||s.$title,{data:null,$prototype:e},"$title")));a.push("</th><td>");"application/x-reference"===s.$type?(p=d.types.addReference(s,[g[b.$bind],g],h,b.$bind,
!0),c._addLink(a,p,h)):(b.$type=s.$type,!k&&"application/x-array"===s.$type?g&&g[b.$bind]&&g[b.$bind].length?(p=d.types.addArray(b.$bind,l,i),c._addLink(a,p,h)):a.push(" "):a.push(f.htmlValue(g,e,s,b)));a.push("</td>");a.push("</tr>")});k&&(a.push("<tr>"),a.push("<td>"),a.push('<a href="#" data-role="button"  xdata-iconpos="notext"  data-index="'+i+'" data-action="edit" data-theme="f" data-mini="true" data-icon="edit"'),a.push(">"+j.locale().ui.edit_item+"</a>"),a.push("</td>"),a.push("<td>"),a.push('<a href="#" data-role="button"  xdata-iconpos="notext"  data-index="'+
i+'" data-action="delete"  data-theme="f" data-mini="true" data-icon="delete"'),a.push(">"+j.locale().ui.remove_item+"</a>"),a.push("</td>"),a.push("</tr>"));a.push("</tbody>");a.push("</table>")};d.ArrayField={syncc:!0,handler:function(a,b){var e=this,g=[],h=a.data||{},k=h.field;delete h.field;if(!e.getPageData())return b({html:"",options:{}});var i="$edit"===h.facet||"$create"===h.facet,l=k.$proto.$rtype,p=k.$proto.$protoparent,q=e.getValue(k.$bind,null,"application/x-reference"===l?null:[]),o=
k.$proto.$item||k.$proto,s=h.$article;if(i){var h={id:a.id+"_"+k.$bind,data:{inline:!1,bind:k.$bind}},i=h.data,m;switch(l){case "application/x-reference":i.type="text";i.label=f.parseExpression(p.$shortTitle||p.$title,{data:null,$prototype:o},"$title");h.id=a.id+"_"+k.$bind;if(o.$links&&o.$links.$lookup&&o.$links.$lookup.$url)i.$lookupurl=f.parseExpression(o.$links.$lookup.$url,{data:e.exprData(q),$prototype:o},"$url");if(o.$isMandatory)i.$isMandatory=!0;m=c.controls.Lookup.createLookup(e,h);m.id=
h.id;m.uiClass="Lookup";m.scid="_"+k.$bind;break;case "application/x-array":switch(k.$proto.$type){case "application/x-reference":i.title=f.parseExpression(p.$shortTitle||p.$title,{data:null,$prototype:o},"$title");i.jmdata=f.jqmDataArray();h.id=a.id+"_"+k.$bind;if(o.$links&&o.$links.$lookup&&o.$links.$lookup.$url)i.$lookupurl=f.parseExpression(o.$links.$lookup.$url,{data:e.exprData(q),$prototype:o},"$url");m=c.controls.ArrayRef.createArrayRef(e,h,q);m.id=h.id;m.uiClass="ArrayRef";m.scid="_"+k.$bind;
break;case "application/x-object":case "application/json":i.title=f.execExpression(k.$shortTitle||k.$title,k.$proto.$item||k.$proto);i.jmdata=f.jqmDataArray();l=f.auth.compositionLayout(s,k.$proto.$item||k.$proto);i.cards=l.cards;i.items=l.$items;i.$article=s;h.id=a.id+"_"+k.$bind;m=c.controls.ArrayObjectRef.createArrayObjectRef(e,h,q);m.id=h.id;m.uiClass="ArrayObjectRef";m.scid="_"+k.$bind;break;default:i.title=f.execExpression(k.$shortTitle||k.$title,k.$proto.$item||k.$proto),i.jmdata=f.jqmDataArray(),
h.id=a.id+"_"+k.$bind,m=c.controls.ArraySimpleType.createArraySimpleType(e,h,q),m.id=h.id,m.uiClass="ArraySimpleType",m.scid="_"+k.$bind}}return m?b([m]):b(null)}g.push('<ul id="'+a.id+'" data-role="listview"');j.addJqmData(h,g);g.push(">");m="";var n;switch(l){case "application/x-reference":(m=j.htmlEncode(j.htmlEncode(f.execExpression(p.$shortTitle||p.$title,p))))&&g.push('<li data-role="list-divider">'+m+"</li>");n=d.types.addReference(k.$proto,q,e,k.$bind,!0);g.push("<li>");c._addLink(g,n,e);
g.push("</li>");break;case "application/x-array":if((m=j.htmlEncode(j.htmlEncode(f.execExpression(k.$shortTitle||k.$title,k.$proto.$item||k.$proto))))&&g.push('<li data-role="list-divider">'+m+"</li>"),q)switch(k.$proto.$type){case "application/x-reference":q.length&&q.forEach(function(a){n=d.types.addReference(k.$proto.$item||k.$proto,a,e);g.push("<li>");c._addLink(g,n,e);g.push("</li>")});break;case "application/x-object":case "application/json":var t=f.auth.compositionLayout(s,k.$proto.$item||
k.$proto);t.cards?q.forEach(function(a,b){g.push("<li>");t.$items&&d.types._cards(g,t.$items,k.$proto,a,e,!1,b,k.$bind);g.push("</li>")}):t.$items&&(g.push("<li>"),d.types._table_header(g,t.$items,k.$proto),q.forEach(function(a,b){d.types._table_row(g,t.$items,k.$proto,a,e,!1,b)}),d.types._table_end(g),g.push("</li>"));break;case "application/x-choice":var B={};o.$value.$enum.forEach(function(a){B[a.$value+""]=f.execExpression(a.$title,k.$proto)});q.forEach(function(a){g.push("<li>"+j.htmlEncode(B[a+
""])+"</li>")});break;default:q.forEach(function(a){g.push("<li>"+a||"</li>")})}}g.push("</ul>");return b({html:g.join(""),bind:!i,options:h})},events:function(a,b){var d=this;"$edit"===b.options.facet||"$create"===b.options.facet||a.click(function(a){if(a&&a.target){for(a=a.target;a&&a.tagName&&!("A"===a.tagName.toUpperCase());)a=a.parentNode;if(a&&(a=i(a).attr("data-action")))try{var a=JSON.parse(a),h=d.getPageData(),k=d.getValue(a.$parentbind,null,[]);if(k){var j=f.getProto(h,a.$parentbind);if(k&&
Array.isArray(k)&&0<=a.$index&&(k=k[a.$index]))if(h=k,h[a.$bind]=k[a.$bind],k&&k[a.$bind]){var l=f.auth.findSlayout(b.options.$article,a.$bind,!0),l=f.auth.compositionLayout(l,j,[a.$bind]),p=c.detailUiData(d,j,h,l,{readOnly:!0});c.createDetail(p.uiData,h,d)}}}catch(q){}}})}}})(jQuery);(function(i){var c=i.smobile;c.controls=c.controls||{};c.controls.Button={handler:function(j,f){var l=[],d=j.data||{},a={};d.controlId=j.id;d.jmdata&&i.extend(a,d.jmdata);d.link||i.extend(a,{"data-role":"button"});d.jmdata=a;c._addLink(l,d,this);return f({html:l.join(""),action:d.action,options:d})},sync:!0,events:function(c,f){var i=this;c.click(function(c){if(f&&f.action){if(f.options.disabled)return;f.options.disabled=!0;var a=i.pageActions?i.pageActions[f.action]:null;if(a)return a.call(i,function(a){if(a)f.options.disabled=
!1})}c.preventDefault()})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers;c.controls=c.controls||{};c.controls.CheckBox={createCheckBox:function(f,i){var d=i.data||{},a=d.noform?[]:['<form id="'+i.id+'">'];c.ui.addErrors(f,d.bind,i.id,a);a.push('<input type="checkbox" name="'+i.id+'_i" id="'+i.id+'_i" ');var b=d.value||!1;d.bind&&(b=f.getValue(d.bind,null,!1));b&&a.push("checked");a.push("/>");a.push('<label for="'+i.id+'_i">'+j.htmlEncode(d.label)+"</label>");d.noform||a.push("</form>");return{html:a.join(""),bind:d.bind,action:d.action,
options:d}},refresh:function(f,j,d,a){i("#"+a+"_i").attr("checked",f.getValue(j.bind,null,!1)).checkboxradio("refresh");return c.ui.refreshErrors(f,j.bind,a)},sync:!0,handler:function(f,i){return i(c.controls.CheckBox.createCheckBox(this,f))},events:function(c,i){var d=this,a=c.find("#"+i.id+"_i");a.change(function(){var b=d.afterChangeHnd(i);d.checkChange(i.id,a[0].checked,b)})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers;c.controls=c.controls||{};c.controls.List={sync:!0,handler:function(f,l){var d=this,a=[],b=f.data||[];a.push('<div class="ui-body">');a.push('<ul id="'+f.id+'" data-role="listview"');a.push(' data-inset="true"');a.push(">");(b.items||[]).forEach(function(b){b=b.data;a.push("<li");j.addJqmData(b,a);if(b.divider)a.push(' data-role="list-divider"'),a.push(">"),a.push(b.title);else{if(b.icon||b.menu)a.push(' class="'+(b.menu?j.ui.consts.menu_icon:j.ui.consts.normal_icon)+
'"'),b.css=[b.menu?j.ui.consts.menu_icon:j.ui.consts.normal_icon];a.push(">");var g="";b.menu&&(g=i.smobile.ui.menuItem(b.title,b.description,b.icon));b.url=c.ui.sdata_link(null,b);c._addLink(a,b,d,function(){a.push(g)})}a.push("</li>")});a.push("</ul>");a.push("</div>");return l({html:a.join(""),bind:b.bind,options:b})}}})(jQuery);(function(i){var c=i.smobile;c.controls=c.controls||{};var j=i.helpers,f=i.proto;c.controls.SingleField={sync:!0,handler:function(i,d){var a,b=i.data||{},e=this.getPageData();if(!e)return d({html:"",options:{}});var g=[],h="$edit"===b.facet||"$create"===b.facet,k=f.getProto(e,b.$bind),u=k;a=f.getProto(e);if("application/x-reference"===k.$rtype)u=k.$protoparent;var r=b.$article;if(h){r=b.$article;b.$article=null;var p=[],k=f.getProto(e,b.$bind);a=null;var q=k.$type||k.$rtype,e={id:i.id+"_"+b.$bind,
data:{inline:!1,bind:b.$bind}},h=e.data;if(k.$isReadOnly)h.$isReadOnly=!0;if(k.$isDisabled)h.$isDisabled=!0;u=f.parseExpression(u.$shortTitle||u.$title,{data:null,$prototype:u},"$title");switch(q){case "application/x-reference":h.type="text";a=this.getValue(b.$bind);h.label=u;h.$article=r;e.id=i.id+"_"+b.$bind;if(k.$links&&k.$links.$lookup&&k.$links.$lookup.$url)h.$lookupurl=f.parseExpression(k.$links.$lookup.$url,{data:this.exprData(a),$prototype:k},"$url");if(k.$isMandatory)h.$isMandatory=!0;a=
c.controls.Lookup.createLookup(this,e);a.id=e.id;a.uiClass="Lookup";a.scid="_"+b.$bind;break;case "application/x-string":case "application/x-password":h.type="text";h.label=u;e.id=i.id+"_"+b.$bind;h.$minLength=k.$minLength;h.$maxLength=k.$maxLength;h.$article=r;if("$email"==k.$format)h.type="email";else if("$url"==k.$format)h.type="url";else if("$phone"==k.$format)h.type="tel";if("application/x-password"===q)h.type="password";if(k.$isMandatory)h.$isMandatory=!0;a=c.controls.Edit.createEdit(this,e);
a.id=e.id;a.uiClass="Edit";a.scid="_"+b.$bind;break;case "application/x-choice":var o=[];h.items=o;h.$isMandatory=!0;h.$article=r;k.$value.$enum.forEach(function(a){o.push({value:a.$value,title:f.execExpression(a.$title,k)})});h.label=u;e.id=i.id+"_"+b.$bind;a=c.controls.Combo.createCombo(this,e);a.id=e.id;a.uiClass="Combo";a.scid="_"+b.$bind;break;case "application/x-integer":case "application/x-real":case "application/x-decimal":h.type="number";h.decimals=0;h.$article=r;if(null!=k.$format)h.decimals=
j.format2decimals(k.$format);else if(null!=k.$scale)h.decimals=k.$scale;h.label=u;if(null!=h.$article.$minimum)h.$minimum=h.$article.$minimum;if(null!=h.$article.$maximum)h.$maximum=h.$article.$maximum;if(null!=k.$minimum)h.$minimum=k.$minimum;if(null!=k.$maximum)h.$maximum=k.$maximum;if(null!=h.$minimum&&null!=h.$maximum&&(h.$minimum||h.$maximum))h.type="range";h.$isMandatory=!0;e.id=i.id+"_"+b.$bind;a=c.controls.Edit.createEdit(this,e);a.id=e.id;a.uiClass="Edit";a.scid="_"+b.$bind;break;case "application/x-boolean":h.label=
u;h.$article=r;e.id=i.id+"_"+b.$bind;a=c.controls.CheckBox.createCheckBox(this,e);a.id=e.id;a.uiClass="CheckBox";a.scid="_"+b.$bind;break;case "image":h.label=u;h.$article=r;e.id=i.id+"_"+b.$bind;a=c.controls.Picture.createPicture(this,e);a.id=e.id;a.uiClass="Picture";a.scid="_"+b.$bind;break;case "application/x-date":h.type="date";h.$article=r;h.label=u;h.$isMandatory=k.$isMandatory;e.id=i.id+"_"+b.$bind;a=c.controls.Edit.createEdit(this,e);a.id=e.id;a.uiClass="Edit";a.scid="_"+b.$bind;break;case "application/x-time":h.type=
"time";h.$article=r;h.label=u;h.$isMandatory=k.$isMandatory;e.id=i.id+"_"+b.$bind;a=c.controls.Edit.createEdit(this,e);a.id=e.id;a.uiClass="Edit";a.scid="_"+b.$bind;break;case "application/x-datetime":h.type="datetime",h.$article=r,h.label=u,h.$isMandatory=k.$isMandatory,e.id=i.id+"_"+b.$bind,a=c.controls.Edit.createEdit(this,e),a.id=e.id,a.uiClass="Edit",a.scid="_"+b.$bind}a&&p.push(a);return p.length?d(p):d(null)}e=!1;g.push("<div>");if(!r.$isTitleHidden){p=["s-m-style","s-m-label"];j.htmlEncode(f.execExpression(k.$shortTitle||
k.$title,k));if("image"===k.$type)r.$label=r.$label||{},r.$label.$styles=r.$label.$styles||[],r.$label.$styles.push("top");if(r.$label)f.auth.mobileExtentions(p,r.$label),e=r.$label.$after;e||(g.push('<label class="'+p.join(" ")+'">'),g.push(f.parseExpression(u.$shortTitle||u.$title||"",{data:null,$prototype:u},"$title",{html:!0})),g.push("</label>"))}var s=["s-m-style s-m-value"];f.auth.mobileExtentions(s,r);var h=function(){g.push('<div class="'+s.join(" ")+'"');r.$style&&g.push(' style="'+r.$style+
'"');g.push(">")},m=this.getProtoDataValue(b.$bind);if("application/x-reference"===k.$rtype)h(),a=this.getValue(b.$bind),a=c.controls.types.addReference(k,a,this,b.$bind,!0),c._addLink(g,a,this);else{var q={},n=!1;f.updproto(q,k);if(f.isNumeric(k.$type)){if(null!=r.$maximum)q.$maximum=r.$maximum;if(null!=r.$minimum)q.$minimum=r.$minimum;f.updproto(q,m);if(null!=q.$maximum&&null!=q.$minimum){m=this.data[b.$bind]||0;if(m<r.$minimum)m=r.$minimum;if(m>r.$maximum)m=r.$maximum;var n=!0,t=0;try{t=parseInt(1E4*
m/(r.$maximum-r.$minimum))/100}catch(B){}s.push("top");h();g.push('<div class= "s-m-slider"><div class="s-m-slider-ind" style="left:'+t+'%"><center>');g.push(f.htmlValue(this.data,a,q,{$bind:b.$bind,$type:k.$type},m,{useValue:!0}));g.push("</center></div></div>")}}n||(h(),g.push(f.htmlValue(this.data,a,q,{$bind:b.$bind,$type:k.$type})))}g.push("</div>");e&&(g.push('<label class="'+p.join(" ")+'">'),g.push(f.parseExpression(u.$shortTitle||u.$title||"",{data:null,$prototype:u},"$title",{html:!0})),
g.push("</label>"));g.push("</div>");return d({html:g.join(""),bind:b.bind,options:b})}}})(jQuery);(function(i){var c=i.smobile||{},j=i.helpers;c.staticui=c.staticui||{};i=c.staticui;i.start=function(){var c=j.locale();return{$title:c.administration.title,content:{title:{uiClass:"Html",data:{html:"<div><center><h4>"+c.administration.welcome+"</h4></center></div>"}},menu:{uiClass:"AppDashboard",data:{items:[]}}}}};i.about=function(){var c=j.locale();return{$title:c.administration.title,content:{cp:{layout:"BlockBodyLayout",data:{}},title:{uiClass:"Html",data:{html:c.about},parent:"cp"}}}};i.settings=
function(){return{$title:j.locale().administration.title,content:{cp:{layout:"BlockBodyLayout",data:{}},errors:{uiClass:"ErrorView",parent:"cp"}}}};i.apppanel=function(){j.locale();return{uiClass:"panelView",data:{items:[{title:"",items:[{type:"mainmenu"}]}]}}};i.ctxpanel=function(){j.locale();return{uiClass:"panelView",data:{items:[{title:"",items:[]}]}}};i.mainpanel=function(){j.locale();return{uiClass:"panelView",data:{title:"",items:[{items:[{type:"mainmenu"},{type:"setup"},{type:"help"},{type:"settings"}]}]}}};
i.appFooter=function(){return{footer:{uiClass:"NavBar",data:{items:[{type:"home"}]}}}};i.applications=function(){return{content:{apps:{uiClass:"AppsView"},cp:{layout:"BlockBodyLayout",data:{}},errors:{uiClass:"ErrorView",parent:"cp"}}}};i.apperrors=i.errors=function(){return{content:{cp:{layout:"BlockBodyLayout",data:{}},title:{uiClass:"Html",data:{html:"<center><h2>"+j.locale().errorpagetitle+"</h2></center>"},parent:"cp"},errors:{uiClass:"ErrorView",parent:"cp"}}}};i.send=function(){return{$title:j.locale().sendpagetitle,
content:{cp:{layout:"BlockBodyLayout",data:{}},log:{uiClass:"ErrorView",parent:"cp"},toSend:{uiClass:"SyncView",parent:"cp"}}}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto,l=f.auth,d=i.sdata;c.controls=c.controls||{};c.controls.SDataList={field2proto:function(a,b){var c=a.getPageData();return c&&c.$prototype&&c.$prototype.$properties&&c.$prototype.$properties.$resources&&c.$prototype.$properties.$resources.$item?c.$prototype.$properties.$resources.$item.$properties[b]:null},rightValue:function(a,b){var d=c.controls.SDataList.field2proto(a,b.field),g=b.value;switch(d.$type){case "application/x-password":case "application/x-string":return d=
g.replace(/'/g,"\\'"),"like"===b.op?d="%"+d+"%":"like_s"===b.op&&(d+="%"),"'"+d+"'";case "application/x-integer":return g;case "application/x-real":return g;case "application/x-decimal":return g;case "application/x-date":if(!g)break;return"@"+g+"@";case "application/x-datetime":return"@"+g+"@";case "application/x-boolean":return g?"true":"false";case "application/x-choice":return"application/x-string"===d.$value.$type?"'"+g.replace(/'/g,"\\'")+"'":g+"";case "application/x-reference":return d=g.replace(/'/g,
"\\'"),"'"+d+"'"}return null},refresh:function(a,b,d){var g=[];c.controls.SDataList.createItems(a,b,g);d.html(g.join("")).listview("refresh")},createItems:function(a,b,d){var g=a.getPageData();f.getProto(g);var h=f.getProto(g,b.bind),i={},u={list:!0,noCache:f.auth.designMode},r=f.getArticle(g,b.bind),r=l.checkQueryArticle(h,r,u),p=null;if(h.$links&&h.$links.$details)p=h.$links.$details.$url,h.$links.$details.$isHidden&&(p="");a.getValue(b.bind,null,[]).forEach(function(g,l){var s={},m=[];f.auth.sdi(r,
m,i,a,h,g,u);var n=m.join("");d.push("<li");j.addJqmData(s,d);if(u.$image)d.push(' class="'+j.ui.consts.normal_icon+'"'),s.css=[j.ui.consts.normal_icon];d.push(">");if(p)s.url=f.parseExpression(p,{data:a.exprData(g),$prototype:h},"$url");if(b.$lookup)s.action="validate",s.actionParams=l+"";c._addLink(d,s,a,function(){d.push(n)})})},sync:!0,handler:function(a,b){var e=[],g=a.data||{},h=this.getPageData();if(!h)return b({html:"",options:{}});var i=f.getProto(h),h=f.getArticle(h,g.bind);if(!i)return b({html:"",
options:{}});d.capabilities.showSearch?(e.push('<div class=""><table class="s-m-design" cellpadding="0" cellspacing="0" border="0"><tbody><tr>'),e.push('<td class="space"></td>'),e.push('<td class="all"><input id="'+a.id+'_search" data-type="text"  data-mini="true" /></td>'),e.push('<td class="space"></td>'),e.push('<td class="button"><a id="'+a.id+'_sbutton" href="#" data-role="button" data-mini="true" data-icon="search">'+j.locale().ui.search+"</a></td>"),e.push("</tr></tbody></table></div>")):
(e.push('<form class="s-m-space" id="'+a.id+'_search_form">'),e.push('<input id="'+a.id+'_search" data-type="search"  data-mini="true" />'),e.push("</form>"));if(!g.$lookup){var l=i.$filters;if(h&&h.$filters)l=h.$filters;if((h=l?Object.keys(l):null)&&h.length&&this.config&&this.config.url){var r=this.config.url,p=r.query&&r.query.filter?r.query.filter:"",q=""!=q;e.push('<div data-role="navbar" id = "'+a.id+'_filter"><ul>');h.forEach(function(a){var b=l[a];e.push('<li><a data-action-filter="'+a+'" href="#"');
q&&a==p&&(q=!1,e.push(' class="ui-btn-active"'));e.push(">");e.push(j.htmlEncode(f.parseExpression(b.$shortTitle||b.$title,{data:null,$prototype:i},"$title")));e.push("</a></li>")});e.push("</ul></div>")}}e.push('<ul id="'+a.id+'" data-role="listview" data-filter="false"');j.addJqmData(g,e);e.push(">");c.controls.SDataList.createItems(this,g,e);e.push("</ul>");return b({html:e.join(""),bind:g.bind,options:g})},_clickLookup:function(a){a.preventDefault();if(a&&a.target){for(a=a.target;a&&a.tagName&&
"A"!=a.tagName.toUpperCase();)a=a.parentNode;if(!a)return;a=i(a).attr("data-action");if(""!=a&&(a=parseInt(a,10),this.getCurrentData()&&(a=this.getCurrentData().$resources[a],this.parent&&this.config&&this.config.url&&this.config.url.query&&this.config.url.query.control))){var b=this.parent.controls[this.config.url.query.control];if(b){var d=c.controls[b.uiClass];if(d.setValue)return d.setValue(this.parent,b,a,c.doBack)}}}c.doBack()},events:function(a,b){var e=b.id;b.options.$lookup?a.click(c.controls.SDataList._clickLookup.bind(this)):
i("#"+e+"_filter").click(c.controls.SDataList._execFilter.bind({id:e,controller:this}));d.capabilities.showSearch?i("#"+e+"_sbutton").click(c.controls.SDataList._execSearch.bind({id:e,controller:this})):i("#"+e+"_search_form").submit(c.controls.SDataList._execSearch.bind({id:e,controller:this}))},_execUrl:function(a,b,c){d.getUri(a);i.mobile.loading("show",{theme:"a",text:j.locale().ui.loading});j.clearErrors();d.execURL(a.uri,{error:function(){i.mobile.loading("hide");c&&c()},success:function(d){i.mobile.loading("hide");
if(d)b.config.url=a,b.data=d,b.doRefresh();else if(j.hasErrors())b.config.url=a,b.data={$ressources:[]},b.doRefresh();c&&c()}})},_execSearch:function(a){var b=this.controller,d=this.id;a.preventDefault();a=b.config.url;d=i("#"+d+"_search")[0].value||"";if((a.query?a.query.search||"":"")!==d)d?(a.query=a.query||{},a.query.search=d):delete a.query.search,c.controls.SDataList._execUrl(a,b)},applyFilter:function(a,b){var d=a.config.url,g=a.extraData.filters,h=a.extraData.lastFilter||"",f="",i="";g&&g.forEach(function(b){"none"!==
b.op&&(b="("+b.field+" "+("like_s"===b.op?"like":b.op)+" "+c.controls.SDataList.rightValue(a,b)+")",f=f+i+b,i=" and ")});h!=f?(f?(d.query=d.query||{},d.query.where=f):d.query&&delete d.query.where,a.extraData.lastFilter=f,c.controls.SDataList._execUrl(d,a,b)):b()},_execFilter:function(a){var b=this.controller;a.preventDefault();for(var d=a.target;d&&d.tagName&&"A"!=d.tagName.toUpperCase();)d=d.parentNode;if(d&&(a=b.config.url,d=i(d).attr("data-action-filter")||"",(a.query?a.query.filter||"":"")!==
d))d?(a.query=a.query||{},a.query.filter=d):delete a.query.filter,c.controls.SDataList._execUrl(a,b)}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto,l=i.sdata;c.controls=c.controls||{};var d={sync:function(a){a.title=j.locale().ui.sync_item;a.hash=c.PAGES.send.id;a.icon="arrow-u"},help:function(a){a.title=j.locale().maintoolbar.help;a.hash=c.PAGES.about.id;a.icon="info"},settings:function(a){if(!l.capabilities.showSettings)a.hidden=!0;a.title=j.locale().maintoolbar.settings;a.hash=c.PAGES.settings.id;a.icon="gear"},next:function(a,b){a.title=j.locale().maintoolbar.next;a.icon="arrow-r";a.action=
"next";var c=b.getCurrentData();a.hidden=!(c&&c.$links&&c.$links.$next);a.refresh=!0},previous:function(a,b){a.title=j.locale().maintoolbar.previous;a.icon="arrow-l";a.action="previous";var c=b.getCurrentData();a.hidden=!(c&&c.$links&&c.$links.$previous);a.refresh=!0},home:function(a){a.title=j.locale().maintoolbar.home;a.hash=i.smobile.PAGES.home.id;a.icon="home"},setup:function(a){a.title=j.locale().maintoolbar.setup;a.hash=i.smobile.PAGES.apps.id;a.icon="plus"},services:function(a){a.title=j.locale().ui.actions_item;
a.icon="gear";a.action="popup";a.popupId=j.uuid()},mainmenu:function(a){a.title=j.locale().maintoolbar.home;a.hash=i.smobile.PAGES.start.id;a.icon="home"}};c.controls.NavBar={refresh:function(a,b,d,g){var h=[];if(b.canRefresh){a.getCurrentData();var h=[],f={actions:[],hafter:[],assync:null,canRefresh:!1};c.controls.NavBar.createitems(a,g,b.items,f,h,0,!1,b);b.actions=f.actions.length?f.actions:null;d=d.parent();d.html(h.join(""));d.trigger("create");d=i("#"+g);c.controls.NavBar.events.apply(a,[d,
{options:b}])}},createitems:function(a,b,e,g,h,i,l,r){r&&(h.push('<div data-role="navbar" id="'+b+'"'),j.addJqmData(r,h),h.push(">"));h.push('<ul id="'+b+'_ul">');e.forEach(function(e){e.navbar=!0;if(e.type&&d[e.type])d[e.type](e,a);if(e.refresh)g.canRefresh=!0;if(!e.hidden){if(e.icon)e.jmdata=e.jmdata||{},e.jmdata["data-icon"]=e.icon;var r="";e.action&&(r=b+"_"+e.action);e.action?(g.actions.push({id:r,action:e.action}),h.push('<li id="'+r+'"')):(h.push('<li style="position:relative;"'),r&&h.push(' id="'+
r+'"'));h.push(' class="');h.push('"');h.push(">");if(e.bind&&e.url)r=a.getPageData(),e.url=f.parseExpression(e.url,{data:a.exprData(),$prototype:f.getProto(r)},"$url");if(e.service&&e.link)a.alinks=a.alinks||{},r=j.uuid(),e.actionParams=r,a.alinks[r]={$title:e.link.$title,url:e.link.$url,$method:e.link.$method,$parameters:e.link.$parameters};if(r=c.ui.sdata_link(null,e))e.url=r;c._addLink(h,e,a,function(){h.push(j.htmlEncode(e.title))});if("sync"===e.type&&(r=b+"_sync",h.push('<div class="s-m-notify-sync'),
i||h.push(" s-m-hidden"),h.push('" id="'+r+'" data-role="none">'),h.push(i||"0"),h.push('</div">'),l))g.assync=c.controls.NavBar.asynchandler.bind({controller:a,id:r});"popup"===e.action&&(g.hafter.push('<div data-role="popup" id="'+e.popupId+'">'),g.hafter.push('<ul data-role="listview" data-inset="true" style="min-width:210px;">'),e.items.forEach(function(b){b.action="service";g.hafter.push("<li>");b.controlId=j.uuid();g.actions.push({id:b.controlId,action:b.action,url:b.$url,parameters:b.$parameters,
method:b.$method,popupId:e.popupId,bind:""});c._addLink(g.hafter,b,a,function(){g.hafter.push(j.htmlEncode(b.$title))});g.hafter.push("</li>")}),g.hafter.push("</ul></div>"));h.push("</li>")}});h.push("</ul>");r&&h.push("</div>")},_handler:function(a,b,d,g,h){var f=b.data,i=f.items||[],j={actions:[],hafter:[],assync:null,canRefresh:!1},l=[];c.controls.NavBar.createitems(a,b.id,i,j,l,g,h,f);a={html:l.join("")+j.hafter.join(""),action:0<j.actions.length,options:{actions:j.actions.length?j.actions:null,
jmdata:f.jmdata,canRefresh:j.canRefresh,items:i},async:j.assync};return d(a)},sync:!1,handler:function(a,b){var d=!1;(a.data.items||[]).forEach(function(a){"sync"===a.type&&(d=!0)});d&&l.config&&l.config.id?c.controls.NavBar._handler(this,a,b,0,!0):c.controls.NavBar._handler(this,a,b,0)},asynchandler:function(){var a=this.id;return l.getSyncCount(function(b){if(b){var c=i("#"+a);c.html(b+"");c.removeClass("s-m-hidden")}})},events:function(a,b){var c=this;a.click(function(a){var d=b.options;if(!d.disabled){d.disabled=
!0;for(var f=a.target;f&&f.tagName&&"LI"!=f.tagName.toUpperCase();)f=f.parentNode;if(f&&f.id){var j=null;d&&d.actions&&d.actions.forEach(function(a){a.id===f.id&&(j=a)});if(j){var l=c["action"+j.action];if(l){j.popupId&&i("#"+j.popupId).popup("close");l.call(c,{success:function(a,b,g){d.disabled=!1;!b&&!g&&i.smobile.doBack(c)}},j);a.preventDefault();return}}}d.disabled=!1}})}};c.controls.panelView={sync:!0,syncHandler:function(a){a.options.loaded||c.controls.panelView._create_items(a.options,this);
return l.getSyncCount(function(a){var c=i(".s-m-notify-sync");c.html(a+"");a?c.removeClass("s-m-hidden"):c.addClass("s-m-hidden")})},_create_items:function(a,b){var e=[],g=a.items||[];a.loaded=!0;g.forEach(function(g){if(g.code)switch(g.code){case "filtersort":var f=b.getFilterFields();f&&g.items.push({title:j.locale().ui.filter,icon:"filter",action:"filter"});if(f=b.getSortFields())a.sortItems=f,g.items.push({title:j.locale().ui.sort,icon:"sort",action:"sort"})}g.items&&g.items.length&&(g.title&&
e.push('<li data-role="list-divider">'+j.htmlEncode(g.title)+"</li>"),g.items.forEach(function(g){var h=null;if("sync"===g.type)a.syncHandler=c.controls.panelView.syncHandler,h=0;if(g.type&&d[g.type])d[g.type](g,b);g.jqData=g.jqData||"";e.push('<li class="ui-li-has-icon '+j.ui.consts.panel_icon+'"');e.push(' data-corners="false" data-role="fieldcontain" data-shadow="false" data-iconshadow="true" data-icon="false" data-iconpos="right" data-theme="g">');c._addLink(e,g,b,function(){e.push(c.ui.panelItem(g.title,
g.icon,g.description,h))});e.push("</li>")}))});g=i("#"+a.id);g.html(e.join(""));g.listview("refresh")},handler:function(a,b){var d=[],g=a.data||[];d.push('<ul id="'+a.id+'" data-role="listview"');d.push(' data-divider-theme="g"');d.push(' data-theme="g"');d.push(' data-inset="false"');d.push(' data-icon="false"');d.push(">");g.loaded=!1;g.syncHandler=c.controls.panelView.syncHandler;g.id=a.id;d.push("</ul>");return b({html:d.join(""),bind:!0,options:g})},events:function(a,b){var d=this;a.click(function(a){var h=
b.options;if(!h.disabled){h.disabled=!0;for(var f=a.target;f&&f.tagName&&"A"!=f.tagName.toUpperCase();)f=f.parentNode;f&&(f=i(f).attr("data-action"),"filter"===f?c.openFilterDlg&&(c.openFilterDlg(d,d.extraData.filters),a.preventDefault()):"sort"===f&&(c.openSortDlg&&(f=c.controls.SDataSorter._getOrderBy(d),c.openSortDlg(d,f,h.sortItems),a.preventDefault()),a.preventDefault()));h.disabled=!1}})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto;c.controls=c.controls||{};c.controls.Lookup={createLookup:function(i,d){var a=d.data||{},b=i.getPageData(),b=f.getProto(b,a.bind);if(a.$lookupurl)a.$lookupurl=a.$lookupurl+"&control="+j.encodeURIComponent(d.id);var e=['<div data-role="fieldcontain" id="'+d.id+'">'];c.ui.addErrors(i,a.bind,d.id,e);e.push('<label id="'+d.id+'_l" class="ui-input-text" for="'+d.id+'_i">');a.$lookupurl?c._addLink(e,{url:a.$lookupurl},i,function(){e.push(j.htmlEncode(a.label)+
(a.$isMandatory?"*":""))}):e.push(j.htmlEncode(a.label)+(a.$isMandatory?"*":""));e.push("</label>");e.push("<input ");e.push('type="text" name="'+d.id+'" id="'+d.id+'_i" ');e.push('value="');var g=i.getValue(a.bind,null,null),h="";if(!f.useUuid(b)||g)h=g&&g.hasOwnProperty("$value")?g.$value:b.$value?f.parseExpression(b.$value,{data:i.exprData(g),$prototype:b},"$value"):f.parseExpression(b.$key,{data:i.exprData(g),$prototype:b},"$key");e.push(j.htmlEncode(h||""));e.push('"');e.push("/>");e.push("</div>");
a.$lookup=1;return{html:e.join(""),bind:a.bind,action:a.action,options:a}},refresh:function(j,d,a,b){a=i("#"+b+"_i");if(d.refreshHandler)return d.refreshHandler(j,a,d.bind);var e=j.getPageData(),e=f.getProto(e,d.bind),e=f.parseExpression(e.$value,{data:j.exprData(j.getValue(d.bind,null,null)),$prototype:e},"$value")||"";a.val(e);return c.ui.refreshErrors(j,d.bind,b)},setValue:function(c,d,a,b){if(d.options.setValueHandler)return d.options.setValueHandler(c,a,b);var e=c.getPageData(),e=f.getProto(e,
d.options.bind),a=f.getRefFromValue(a,e),g=!0,h=g="";(h=f.useUuid(e))?g=a.$key||a.$uuid:(e.noRef=!0,g=f.parseExpression(e.$key,{data:f.exprData(a),$prototype:e},"$key"),delete e.noRef);var i=c.getValue(d.options.bind,null,null),h=h?i?i.$key||i.$uuid:"":f.parseExpression(e.$key,{data:c.exprData(i),$prototype:e},"$key");h!=g&&(f.setRef(a,e,c.exprData(),d.options.bind),c.notifyChange(),c.setNeedRefresh());return b()},sync:!0,handler:function(f,d){return d(c.controls.Lookup.createLookup(this,f))},events:function(c,
d){var a=this,b=c.find("#"+d.id+"_i");b.blur(function(){if(d.options.exitHandler)return d.options.exitHandler(a,b.val());if(d.bind){var c=a.afterChangeHnd(d);a.checkChange(d.id,{$value:b.val()},c)}})}};c.controls.Lookup.checkValue=c.controls.Edit.checkValue})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto;c.controls=c.controls||{};c.controls.ArrayRef={_createItem:function(f,d,a,b,e,g){f.push("<li>");f.push('<a href="#">');d=c.controls.types.addReference(d,a,e,g,!0);f.push(j.htmlEncode(d.value));d.title&&f.push('<span class="s-m-linkdesc"> '+j.htmlEncode(d.title)+"<span>");f.push("</a>");f.push('<a href="#" ');f.push('data-action="'+b+'"');f.push(">");f.push("</a>");f.push("</li>")},refresh:function(j,d,a,b){var e=j.getValue(d.bind,null,[]),g=j.getPageData(),
h=f.getProto(g,d.bind),k=[];d.$isTitleHidden||k.push('<li data-role="list-divider">'+d.title+"</li>");e.forEach(function(a,b){c.controls.ArrayRef._createItem(k,h,a,b,j,d.bind,!0)});b=i("#"+b+"_last").detach();a.html(k.join(""));a.append(b);a.listview("refresh")},createArrayRef:function(i,d,a){null==a&&(a=i.getValue(d.data.bind,null,[]));var b=d.data||{},e=i.getPageData(),g=f.getProto(e,b.bind);if(b.$lookupurl)b.$lookupurl=b.$lookupurl+"&control="+j.encodeURIComponent(d.id);var h=[];h.push('<ul id="'+
d.id+'" data-role="listview"');h.push(' data-inset="true" data-split-icon="delete" data-split-theme="d"');j.addJqmData(b,h);h.push(">");b.$isTitleHidden||h.push('<li data-role="list-divider">'+b.title+"</li>");a.forEach(function(a,d){c.controls.ArrayRef._createItem(h,g,a,d,i,b.bind)});h.push('<li id="'+d.id+'_last">');h.push('<div class="ui-block">');h.push('<a id="'+d.id+'_new" data-role="button" data-mini="true" data-theme="f" data-icon="plus" data-iconpos="left" ');h.push('href="');h.push(c.ui.urlHref(b.$lookupurl,
i));h.push('">');h.push(j.locale().ui.add_item);h.push("</a>");h.push("</li>");h.push("</ul>");c.ui.addLinks(d.id,i,h,g,d.data.bind);b.$lookup=1;return{html:h.join(""),bind:b.bind,action:b.action,options:b}},setValue:function(c,d,a,b){i("#"+d.id+"");var e=c.getPageData(),e=f.getProto(e,d.options.bind),g=f.getRefFromValue(a,e),h="",k="",j=f.useUuid(e);j?h=g.$key||g.$uuid:(e.noRef=!0,h=f.parseExpression(e.$key,{data:f.exprData(g),$prototype:e},"$key"),delete e.noRef);for(var a=c.getValue(d.options.bind,
null,[]),r=a.length;r--;)if(k=a[r],k=j?k.$key||k.$uuid:f.parseExpression(e.$key,{data:c.exprData(k),$prototype:e},"$key"),k===h)return b();if(e.$protoparent.$maxItems&&a.length>=e.$protoparent.$maxItems)return b();e=f.setArrayRef(g,e,c.exprData(),d.options.bind);a.push(e);c.setData(d.options.bind,a,null);c.notifyChange();c.setNeedRefresh();return b()},handler:function(f,d){return d(c.controls.ArrayRef.createArrayRef(this,f))},events:function(c,d){var a=this;c.click(function(b){if(b&&b.target){for(b=
b.target;b&&b.tagName&&"A"!=b.tagName.toUpperCase();)b=b.parentNode;if((b=i(b).attr("data-action"))&&""!=b)b=parseInt(b,10),a.getValue(d.options.bind,null,[]).splice(b,1),a.notifyChange(),i(c.children()[b+1]).remove()}})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto;c.controls=c.controls||{};var l=c.controls;l.ArrayObjectRef={_renderContent:function(c,a,b,e,g,f,i){a.title&&!a.$isTitleHidden&&g.push('<li data-role="list-divider">'+a.title+"</li>");g.push("<li");i&&(e=j.uuid(),g.push(' id="'+e+'"'),i.push("#"+e));g.push(">");a.cards||(g.push('<div class="ui-body">'),l.types._table_header(g,a.items,b,!0,i));f.forEach(function(e,f){a.cards?l.types._cards(g,a.items||[],b,e,c,!0,f,a.bind):l.types._table_row(g,a.items||
[],b,e,c,!0,f,i)});a.cards||(l.types._table_end(g,!0),g.push("</div>"));g.push("</li>")},_addLast:function(c,a,b,e,g){g.push('<li id="'+e+'_last">');g.push('<div class="ui-block">');g.push('<a id="'+e+'_new" data-role="button" data-action="new" data-mini="true" data-theme="f" data-icon="plus" data-iconpos="left" ');g.push('href="#">');g.push(j.locale().ui.add_item);g.push("</a>");g.push("</li>")},refresh:function(c,a,b,e){var g=c.getValue(a.bind,null,[]),h=c.getPageData(),k=f.getProto(h,a.bind),h=
[],j=[];l.ArrayObjectRef._renderContent(c,a,k,e,h,g,j);c=i("#"+e+"_last").detach();b.html(h.join(""));b.append(c);j.forEach(function(a){i(a).trigger("create")});b.listview("refresh")},createArrayObjectRef:function(d,a,b){null==b&&(b=d.getValue(a.data.bind,null,[]));var e=a.data||{},g=d.getPageData(),g=f.getProto(g,e.bind),h=[];h.push('<ul id="'+a.id+'" data-role="listview"');h.push(' data-inset="true" data-split-theme="d" data-split-theme="d"');j.addJqmData(e,h);h.push(">");l.ArrayObjectRef._renderContent(d,
e,g,a.id,h,b,null);l.ArrayObjectRef._addLast(d,e,g,a.id,h,b);h.push("</ul>");c.ui.addLinks(a.id,d,h,g,a.data.bind);return{html:h.join(""),bind:e.bind,action:e.action,options:e}},setValue:function(c,a,b,e){i("#"+a.id+"");return e()},sync:!0,handler:function(c,a){return a(l.ArrayObjectRef.createArrayObjectRef(this,c))},events:function(d,a){var b=this;d.click(function(d){if(d&&d.target){for(var g=d.target,h,k,j;g&&g.tagName&&"A"!=g.tagName.toUpperCase();)g=g.parentNode;d=i(g).attr("data-action");if("delete"===
d){d=i(g).attr("data-index");d=parseInt(d,10);b.getValue(a.options.bind,null,[]).splice(d,1);b.notifyChange();for(d=a.options.cards?"TABLE":"TR";g&&g.tagName.toUpperCase()!=d;)g=g.parentNode;g&&i(g).remove()}else if("edit"===d){d=i(g).attr("data-index");d=parseInt(d,10);g=b.getPageData();g=f.getProto(g,a.options.bind);k=b.getValue(a.options.bind,null,[]);h=a.options.$article;if(!h||!h.$layout&&!h.$cards)h={$bind:a.options.bind,$layout:{$items:a.options.items}};k=i.extend(!0,{},k[d]);j={canDelete:!1,
actions:{save_detail:function(){if(this.pageOptions&&this.pageOptions.info)this.parent.setNeedRefresh(),this.parent.getValue(this.pageOptions.info.bind,null,[])[this.pageOptions.info.index]=this.data,this.parent.notifyChange();i.smobile.doBack(this)},cancel_detail:function(){i.smobile.doBack(this)},delete_detail:function(){i.smobile.doBack(this)}}};g=c.detailUiData(b,g,k,h,j);g.uiData.options={info:{index:d,bind:a.options.bind}};c.createDetail(g.uiData,k,b)}else if("new"===d&&(g=b.getPageData(),g=
f.getProto(g,a.options.bind),d=b.getValue(a.options.bind,null,[]),!(g.$protoparent.$maxItems&&d.length>=g.$protoparent.$maxItems))){d=f.proto2Instance(g);h=a.options.$article;if(!h||!h.$layout&&!h.$cards)h={$bind:a.options.bind,$layout:{$items:a.options.items}};j={canDelete:!1,actions:{save_detail:function(){if(this.pageOptions&&this.pageOptions.info){this.parent.setNeedRefresh();var a=this.parent.getValue(this.pageOptions.info.bind,null,[]);a.push(this.data);this.parent.setData(this.pageOptions.info.bind,
a,null);this.parent.notifyChange()}i.smobile.doBack(this)},cancel_detail:function(){i.smobile.doBack(this)},delete_detail:function(){i.smobile.doBack(this)}}};g=c.detailUiData(b,g,d,h,j);g.uiData.options={info:{index:-1,bind:a.options.bind}};c.createDetail(g.uiData,d,b)}}})}}})(jQuery);(function(i){var c=i.smobile,j=i.helpers,f=i.proto;c.controls=c.controls||{};var l=c.controls;l.ArraySimpleType={_renderContent:function(c,a,b,e,g,h,i){a.title&&g.push('<li data-role="list-divider">'+a.title+"</li>");h&&h.length&&h.forEach(function(a,c){g.push("<li");if(i){var d=j.uuid();g.push(' id="'+d+'"');i.push("#"+d)}g.push(">");a=f.htmlValue(null,null,b,{$type:b.$type},a,{useValue:!0});g.push('<a href="#"> ');g.push(a);g.push("</a>");g.push('<a href="#" ');g.push('data-action="delete" data-index="'+
c+'"');g.push(">");g.push("</a>");g.push("</li>")})},_addLast:function(c,a,b,e,g){g.push('<li id="'+e+'_last">');g.push('<div class="ui-block">');g.push('<a id="'+e+'_new" data-role="button" data-action="new" data-mini="true" data-theme="f" data-icon="plus" data-iconpos="left" ');g.push('href="#">');g.push(j.locale().ui.add_item);g.push("</a>");g.push("</li>")},refresh:function(c,a,b,e){var g=c.getValue(a.bind,null,[]),h=c.getPageData(),k=f.getProto(h,a.bind),h=[],j=[];l.ArraySimpleType._renderContent(c,
a,k,e,h,g,j);c=i("#"+e+"_last").detach();b.html(h.join(""));b.append(c);j.forEach(function(a){i(a).trigger("create")});b.listview("refresh")},createArraySimpleType:function(d,a,b){null==b&&(b=d.getValue(a.data.bind,null,[]));var e=a.data||{},g=d.getPageData(),g=f.getProto(g,e.bind),h=[];h.push('<ul id="'+a.id+'" data-role="listview"');h.push(' data-inset="true" data-split-icon="delete" data-split-theme="d"');j.addJqmData(e,h);h.push(">");l.ArraySimpleType._renderContent(d,e,g,a.id,h,b,null);l.ArraySimpleType._addLast(d,
e,g,a.id,h,b);h.push("</ul>");c.ui.addLinks(a.id,d,h,g,a.data.bind);return{html:h.join(""),bind:e.bind,action:e.action,options:e}},setValue:function(c,a,b,e){return e()},sync:!0,handler:function(c,a){return a(l.ArraySimpleType.createArraySimpleType(this,c))},events:function(c,a){var b=this;c.click(function(c){if(c&&c.target){for(var d=c.target;d&&d.tagName&&"A"!=d.tagName.toUpperCase();)d=d.parentNode;var h=i(d).attr("data-action");if("delete"===h){h=i(d).attr("data-index");h=parseInt(h,10);c=b.getValue(a.options.bind,
null,[]);c.splice(h,1);for(b.notifyChange();d&&"LI"!==d.tagName.toUpperCase();)d=d.parentNode;d&&i(d).remove()}else"new"===h&&(c=b.getPageData(),c=f.getProto(c,a.options.bind),d={},f.proto2Value(c,"value",d),c=b.getValue(a.options.bind,null,[]),c.push(d.value),b.setData(a.options.bind,c,null),b.notifyChange())}})}}})(jQuery);(function(i){function c(){var b={$title:a.locale().ui.filter,content:{filter:{uiClass:"SDataFilter",data:{filters:[]}}},roptions:{nopanel:!0}};b.hbuttons=[{title:a.locale().ui.ok_item,action:"saveFilter",jmdata:{"data-icon":"check","data-transition":"none"}},{title:a.locale().ui.remove_item,action:"clearFilter",jmdata:{"data-icon":"delete","data-transition":"none"}}];b.actions={saveFilter:function(){var a=this;if(a&&a.parent&&(a.parent.extraData.filters=a.data.filters,d.controls.SDataList))return d.controls.SDataList.applyFilter(a.parent,
function(){i.smobile.doBack(a)});i.smobile.doBack(a)},clearFilter:function(){var a=this;if(a&&a.parent&&(a.parent.extraData.filters=null,d.controls.SDataList))return d.controls.SDataList.applyFilter(a.parent,function(){i.smobile.doBack(a)});i.smobile.doBack(a)}};return b}function j(){return{$title:a.locale().ui.sort,content:{sort:{uiClass:"SDataSorter",data:{items:[]}}},roptions:{nopanel:!0},actions:{sort:function(){var a=this;if(a&&a.parent&&(a.parent.extraData.filters=a.data.filters,d.controls.SDataList))return d.controls.SDataList.applyFilter(a.parent,
function(){i.smobile.doBack(a)});i.smobile.doBack(a)}}}}function f(a){switch(a){case "application/x-date":case "application/x-time":case "application/x-datetime":case "application/x-decimal":case "application/x-real":case "application/x-integer":return"none,gt,ge,lt,le,eq,ne".split(",");case "application/x-string":return"none,gt,ge,lt,le,eq,ne,like_s,like".split(",");case "application/x-reference":return["none","eq","ne"];default:return["none","eq","ne"]}}function l(b){if(b=f(b)){var c=[],d=a.locale().filters;
b.forEach(function(a){c.push({value:a,title:d[a]})});return{values:c,value:b[0]}}return null}var d=i.smobile,a=i.helpers,b=i.sdata,e=i.proto;d.controls=d.controls||{};d.openFilterDlg=function(a,b){var e=c(a);d.createDetail(e,{filters:b},a)};d.openSortDlg=function(a,b,c){var e=j(a);d.createDetail(e,{items:c,order:b},a)};d.controls.SDataSorter={_getOrderBy:function(a){var c=a.options.url,a=c.query.orderBy||"",c=b.url2proto(c);if(!a&&c.$properties.$resources.$item.$defaultOrder)a=c.$properties.$resources.$item.$defaultOrder;
if(a)var d=a.split(",")[0].split(" "),a=d[0],d=1<d.length?d[1].toLowerCase():"asc";return{orderBy:a,asc:d}},createSDataSorter:function(b,c){var d=c.data||{},e=b.data;e.items=e.items||[];var f=e.order||[],i=[];i.push('<ul data-role="listview" id="'+c.id+'"');i.push(' data-inset="true" data-theme="d"');i.push(">");e.items.forEach(function(b){i.push('<li data-icon="'+(b.value===f.orderBy?"asc"===f.asc?"arrow-d":"arrow-u":"false")+'"><a href="#" data-action="'+b.value+'">'+a.htmlEncode(b.title)+"</a></li>")});
i.push("</ul>");return{html:i.join(""),bind:" ",options:d}},handler:function(a,b){return b(d.controls.SDataSorter.createSDataSorter(this,a))},refresh:function(a,b,c){c.listview("refresh")},events:function(c,e){var f=this,j=f.parent;c.click(function(c){c.preventDefault();if(c&&c.target){for(c=c.target;c&&c.tagName&&"A"!==c.tagName.toUpperCase();)c=c.parentNode;if(c){var c=i(c).attr("data-action"),g=j.options.url,l=d.controls.SDataSorter._getOrderBy(j);l.orderBy===c?l.asc="asc"===l.asc?"desc":"asc":
(l.orderBy=c,l.asc="asc");l.orderBy=l.orderBy+" "+l.asc;g.query.orderBy=l.orderBy;b.getUri(g);i("#"+e.id+"_sortpopup").popup("close");i.mobile.loading("show",{theme:"a",text:a.locale().ui.loading});b.execURL(g.uri,{error:function(){i.mobile.loading("hide");i.smobile.doBack(f)},success:function(a){i.mobile.loading("hide");if(a)j.data=a,j.doRefresh();i.smobile.doBack(f)}})}}})}};d.controls.SDataFilter={_createItem:function(b,c,d){b.push("<li");b.push(' class="ui-li-has-icon '+a.ui.consts.normal_icon+
' filter_item"');b.push(">");b.push('<div class="s-m-filter '+c.op+'"></div>');b.push('<a href="#" ');b.push('data-action="edit" data-action-index="'+d+'">');b.push("<h3>"+a.htmlEncode(c.title||c.field)+"</h3>");b.push("<p>");b.push(a.htmlEncode(a.locale().filters[c.op]+' "'+c.valueTitle+'"'));b.push("</p>");b.push("</a>");b.push('<a href="#" ');b.push('data-action="delete" data-action-index="'+d+'"');b.push(">");b.push("</a>");b.push("</li>")},createSDataFilter:function(b,c){var e=c.data||{},f=b.data;
f.filters=f.filters||[];var i=[];i.push('<div id="'+c.id+'">');i.push('<ul data-role="listview" id="'+c.id+'_items"');i.push(' data-inset="true" data-theme="d" data-split-icon="delete" data-split-theme="d"');a.addJqmData(e,i);i.push(">");i.push('<li data-role="list-divider">'+a.locale().ui.filter+"</li>");f.filters.forEach(function(a,b){d.controls.SDataFilter._createItem(i,a,b)});i.push('<li id="'+c.id+'_footer">');i.push('<div class="ui-grid-a"><div class="ui-block-a">');i.push('</div><div class="ui-block-b">');
i.push('<a href="#'+c.id+'popupMenu" data-rel="popup" data-iconpos="top" data-mini="true" data-role="button" data-theme="f" data-icon="plus" id="'+c.id+'_new" data-inline="false">'+a.locale().ui.add_item+"</button>");i.push("</div></div>");i.push("</li>");i.push("</ul>");i.push("</div>");i.push('<div id="'+c.id+'popupMenu" data-corners="false" data-role="popup">');i.push('<ul data-mini="true" data-role="listview" style="min-width:210px;">');f=b.parent.getFilterFields(!0);e.filtersFields=f;f.forEach(function(b,
c){i.push('<li><a data-action-index="'+c+'">');i.push(a.htmlEncode(b.title));i.push("</a></li>")});i.push("</ul></div>");return{html:i.join(""),bind:" ",action:e.action,options:e}},handler:function(a,b){return b(d.controls.SDataFilter.createSDataFilter(this,a))},refresh:function(a,b,c,e){a=a.data;a.filters=a.filters||[];var f=[];a.filters.forEach(function(a,b){d.controls.SDataFilter._createItem(f,a,b)});a=i("#"+e+"_items");a.children(".filter_item").remove();i("#"+e+"_footer").before(f.join(""));
a.listview("refresh")},uidlg:function(b,c){var f=a.locale(),j=b.opvalues;b.opvalues=null;var l=d.controls.SDataList.field2proto(c.parent,b.fieldValue);if(l){f={$title:f.ui.filter,content:{cp:{layout:"BlockBodyLayout",data:{}},field:{uiClass:"Edit",data:{label:f.ui.filter_field,bind:"field",$isReadOnly:!0},parent:"cp"},op:{uiClass:"Combo",data:{label:f.ui.filter_op,bind:"op",items:j},parent:"cp"},value:{uiClass:"Edit",data:{label:f.ui.filter_val,bind:"value"},parent:"cp"},ok:{uiClass:"Button",data:{value:f.ui.save_item,
action:"savesettings",jmdata:{"data-icon":"check","data-iconpos":"left"}},parent:"cp"}},roptions:{nopanel:!0},actions:{savesettings:function(a){var c=this.data,d=this.parent.data.filters;if("application/x-choice"===l.$type)b.valueTitle=null,l.$value.$enum.forEach(function(a){if(a.$value===b.value)b.valueTitle=e.execExpression(a.$title,l)});c.newFilter?d.push({title:c.field,field:c.fieldValue,op:c.op,value:b.value,valueTitle:b.valueTitle?b.valueTitle:b.value,refresh:!0}):d[c.fi]={title:c.field,field:c.fieldValue,
op:c.op,value:b.value,valueTitle:b.valueTitle?b.valueTitle:b.value,refresh:!0};this.setNeedRefresh(!0);a(!1);i.smobile.doBack(this)}}};j=f.content.value;switch(l.$type){case "application/x-date":j.data.type="date";break;case "application/x-time":j.data.type="time";break;case "application/x-datetime":j.data.type="datetime";break;case "application/x-boolean":j.uiClass="CheckBox";j.data.label=b.field;break;case "application/x-reference":j.uiClass="Lookup";j.data.bind="valueTitle";j.data.$lookupurl=e.parseExpression(l.$item.$links.$lookup.$url,
{data:null,$prototype:l.$item},"$url");j.data.exitHandler=function(a,b){var c=a.data;if(b){if(b!=c.valueTitle)c.value=null,c.valueTitle=b}else c.value=null,c.valueTitle=""};j.data.setValueHandler=function(a,b,c){var d=a.data;if(b.$value)d.valueTitle=b.$value;d.value=b.$uuid;a.child.setNeedRefresh(!0);return c()};j.data.refreshHandler=function(a,b,c){b.val(a.data[c]||"")};break;case "application/x-choice":var p=[];l.$value.$enum.forEach(function(a){p.push({value:a.$value,title:e.execExpression(a.$title,
l)})});j.uiClass="Combo";j.data.items=p}i.smobile.createDetail(f,b,c)}},events:function(a,b){var c=this;a.click(function(a){if(a&&a.target){for(var b=a.target;b&&b.tagName&&!("A"===b.tagName.toUpperCase());)b=b.parentNode;if(b){var e;if(a=i(b).attr("data-action")){b=parseInt(i(b).attr("data-action-index"),10);e=c.data.filters[b];var f=d.controls.SDataList.field2proto(c.parent,e.field),f=l(f.$type);e={newFilter:!1,fi:b,fieldValue:e.field,field:e.title,op:e.op,value:e.value,opvalues:f.values};switch(a){case "edit":d.controls.SDataFilter.uidlg(e,
c);break;case "delete":c.data.filters.splice(b,1),c.doRefresh()}}}}});i("#"+b.id+"popupMenu").click(function(a){if(a&&a.target){for(a=a.target;a&&a.tagName&&!("A"===a.tagName.toUpperCase());)a=a.parentNode;if(a){a=parseInt(i(a).attr("data-action-index"),10);a=b.options.filtersFields[a];d.controls.SDataList.field2proto(c.parent,a.value);var e=l(a.type);d.controls.SDataFilter.uidlg({newFilter:!0,fieldValue:a.value,field:a.title,op:e.value,opvalues:e.values},c)}}})}}})(jQuery);$(function(){function i(){$(document).on("swipeleft",function(){var c=$.mobile.activePage;c&&(c=$.smobile.pageController(c))&&c.actionnext({})});$(document).on("swiperight",function(){var c=$.mobile.activePage;c&&(c=$.smobile.pageController(c))&&c.actionprevious({})});$(document).bind("pagebeforechange",function(c,f){var i=$.helpers,d=$.sdata;if(window.location.hash){var a=!1,b;if("string"===typeof f.toPage)a=!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,b=f.toPage;else if($.mobile.$start)a=
!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,b=window.location.href,f=null;if(!a&&f&&f.toPage.length&&"page-template"==f.toPage[0].id)f=null,b=window.location.href,a=!0;if(a){$.proto.auth.notifyParent("pagechange",null,{name:""});var e=$.mobile.path.parseUrl(b),g=$.smobile.pageName(e.hash);if(g){g&&g.page&&g.page.isHome&&$.mobile.urlHistory.clearForward();var h=$.mobile.activePage;b=!1;var k=g.domid?$("#"+g.domid):!1;if(k&&k.length){var a=$.smobile.pageController($(k[0])),u={transition:"none"};
if(d.config){c.preventDefault();if(a){a.notifyAuthoring("pageload");b=g.page.isHome;if(a.needRefresh)a.needRefresh=!1,a.child&&a.doRefresh();u.fromHashChange=!0;if(a.child)u.reverse=!0}$.mobile.changePage(k,u);b&&$.smobile.removeAllPages([k[0].id],!0)}else c.preventDefault(),$.mobile.changePage(k,u),$.smobile.removeAllPages([k[0].id],!0)}else{var r=f?f.options:{};r.allowSamePageTransition=!0;r.showLoadMsg=!0;$.mobile.loading("show",{theme:"a",text:i.locale().ui.loading});c.preventDefault();$.smobile.loadPage(e.hash,
g,function(a,b,c,j){if(!b)return $.mobile.loading("hide"),$.smobile.doBack(null);d.startLoad();$.smobile.parseURL(e,g,function(c,e,k,o){if(o&&o.stop)d.endLoad();else{if(k&&(d.endLoad(),$.mobile.loading("hide"),g.page.id!=$.smobile.PAGES.errors.id)){if(i.hasErrors())$.smobile.showErrors();else if(e&&$.smobile.showError(r,e||""),c)window.location.href=c;return}j&&j(e);r.dataUrl=c;var u=$.smobile.createPage(g),x=u.$page;$.smobile.buildPage(a,h,x,b,e,o,g,u.$template,function(){var a=$.jqmData(x[0],"controller"),
c=u.$page.children("#panel-template");c.attr("id",a.prefix+"panel");c=u.$page.children("#right-panel-template");c.attr("id",a.prefix+"rpanel");if(i.hasErrors()&&(d.endLoad(),a&&!a.hasErrorView))return a.remove(),x.remove(),$.smobile.showErrors();if(b.actions)a.pageActions=b.actions,b.actions=null;!a.pageOptions.dialog&&r.dataUrl&&x.attr("data-url",$.smobile.hashOfUrl(r.dataUrl));c=f?f.options:{};if(null!=a.pageOptions.changeHash)c.changeHash=a.pageOptions.changeHash;a.notifyAuthoring("pageload");
$.mobile.changePage(x,c);a.bindData();d.endLoad();a.hasErrorView&&a.errorViewHasErrors&&(c=a.controlByClass("ErrorView"))&&a.errorInView({$element:$("#"+c.id),id:c.id,uiClass:"ErrorView"})})}})})}}else if(a=$.smobile.actionName(e.hash))c.preventDefault(),$.smobile.execAction(e.hash,a,function(a){a&&$.smobile.refreshPage()})}}else c.preventDefault()});$(document).bind("pagehide",function(c,f){var i=$.helpers;if(window.location.hash&&c.target!=f.nextPage[0]){var d=$.jqmData(c.target,"controller"),a=
$.jqmData(f.nextPage[0],"controller");if(!d||!d.pageInfo||!d.pageInfo.page.cache){var b=$.smobile.pageIsDialog(f.nextPage);if((b?0:$.smobile.pageIsDetail(f.nextPage))||b)a.child===d?$.smobile.removePage(c.target):i.log("cache current page: next page is  detail/dialog");else if(d&&(!d||!d.config||!(d.config.ui&&0<d.config.ui.indexOf(".$query"))))d&&d.pageActions&&d.pageActions.close&&d.pageActions.close.apply(d),$.smobile.removePage(c.target)}}})}function c(){i();var c=function(){$(window).width();
var c="slide";$.mobile.defaultPageTransition="none"};c();$(window).bind("throttledresize",c);window.location.hash?($.mobile.$start=!0,$.mobile.initializePage()):setTimeout(function(){window.location.hash="#start";$.mobile.$start=!0;$.mobile.initializePage()},0)}$.sdata.capabilities.loadLocale&&$.sdata.capabilities.localeLoader?$.sdata.capabilities.localeLoader(function(){c()},!0):c()});
