(function(b){var e=b.proto||{};b.proto=e;var f=function(c){this.stack=[];c&&this.stack.push(c)};f.prototype={push:function(c){this.stack.unshift(c)},data:function(){return this.stack.length?this.stack[this.stack.length-1]:null},parent:function(c){c=this.stack.indexOf(c);return 0<c?this.stack[c-1]:null}};var d="application/x-string,application/x-password,application/x-integer,application/x-real,application/x-decimal,application/x-boolean,application/x-date,application/x-time,application/x-datetime,application/x-choice,image".split(",");
e.trace={expressions:!1};e.isExpression=function(c){return 0<=c.indexOf("{")};e.sdataKey={workingCopies:"$workingCopies"};e.exprData=function(c){return new f(c)};e.htmlValue=function(c,a,d,h){var f=c[h.$bind],j=b.proto.exprData(c),j=b.proto.exprData(c);if(d.$isHidden)return"";null===f&&(f="");switch(h.$type){case "application/x-password":case "application/x-string":return b.helpers.htmlEncode(f);case "application/x-integer":return b.helpers.htmlEncode(f+"");case "application/x-real":return b.helpers.htmlEncode(f+
"");case "application/x-decimal":return b.helpers.htmlEncode(f+"");case "application/x-date":return f&&(f=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,new Date(f))),b.helpers.htmlEncode(f+"");case "application/x-datetime":return b.helpers.htmlEncode(f+"");case "application/x-time":return b.helpers.htmlEncode(f+"");case "application/x-boolean":return'<div class="ui-icon ui-icon-shadow ui-icon-checkbox-'+(f?"on":"off")+'"></div>';case "application/x-choice":for(var c=e.getProto(a,h.$bind).$value.$enum,
h=0,l=c.length;h<l;h++)if(c[h].$value===f)return b.helpers.htmlEncode(c[h].$title);case "image":if(f){c=f.$url;!c&&d.$url&&(c=e.parseExpression(d.$url,{data:j,$prototype:d},"$url"));if(c)return d=c,e.isExpression(c)&&(d=e.parseExpression(c,{data:j,$prototype:a},"$url")),'<image class="s-image-detail" src="'+d+'"/>';if(f.$value)return'<image class="s-image-detail" src="data:'+(f.$contentType||"image/jpeg")+";base64,"+f.$value+'"/>'}}return null};e.getArticle=function(c){var a=c.$article;if(a)return a;
a=c.$prototype;return a.$article};e.extractFirstProp=function(c){var a=c.indexOf("}");0<=a&&(c=c.substring(0,a));a=c.indexOf("{");0<=a&&(c=c.substring(a+1));return c};e.getProto=function(c,a){if(!a)return c.$prototype||c.$;var b=c.$prototype;if(b=b&&b.$properties?b.$properties:c.$properties){if(b=b[a])switch(b.$type){case "application/x-array":b=b.$item;if(b.$item)b=b.$item;break;case "application/x-reference":if(b.$item)b=b.$item;break;case "application/x-object":if(b.$item)b=b.$item}return b}return null};
e.linkParents=function(c,a){if(c){var b=[];if(!c.$protoparent)c.$protoparent=a;if(!c.$rprotoparent)c.$rprotoparent=a;c.$properties&&Object.keys(c.$properties).forEach(function(a){a=c.$properties[a];switch(a.$type){case "application/x-array":a.$protoparent=c;a.$rprotoparent=c;a.$item.$rtype="application/x-array";a.$item.$protoparent=a;a.$item.$rprotoparent=c;var d=a.$item;if(d&&d.$item)d=d.$item,d.$rprotoparent=c,d.$protoparent=a.$item,d.$rtype="application/x-array";b.push(d);break;case "application/x-reference":a.$protoparent=
c;a.$rprotoparent=c;a.$item.$protoparent=a;a.$item.$rprotoparent=c;a.$item.$rtype="application/x-reference";b.push(a.$item);break;case "application/x-object":if(!a.$item)break;a.$protoparent=c;a.$rprotoparent=c;a.$item.$protoparent=a;a.$item.$rprotoparent=c;b.push(a.$item);a.$item.$rtype="application/x-object";break;default:a.$protoparent=c,a.$rprotoparent=c}});b.forEach(function(a){e.linkParents(a,c)})}};e.layoutParser=function(c,a,b,f,g){var j=c,c=!1;if(!a.$isHidden){var l=f.slice(),m=l[l.length-
1];if(a.$category&&a.$title)j.fields=j.fields||[],f={$isSection:!0,fields:[]},f.title=e.parseExpression(a.$title,{data:null,$prototype:m},"$title"),j.fields.push(f),j=f;if(a.$bind){m=m&&m.$properties?m.$properties[a.$bind]:null;if(!m||!m.$type||m.$isHidden)return;if("application/x-array"===m.$type)if("$resources"==a.$bind)l.push(m.$item);else{if(!m.$item)return;j.fields=j.fields||[];f={$type:m.$type,$bind:a.$bind,$title:m.$title,$proto:m.$item};j.fields.push(f);switch(m.$item.$type){case "application/x-reference":break;
case "application/json":case "application/x-object":var b={},k=[];l.push(m.$item);var n=a.$layout||a.$cards,o=!1;n&&(e.layoutParser(b,n,"",l,k),c=!0);k.length?a.$cards&&(o=!0):Object.keys(m.$item.$properties).forEach(function(a){"$"!==a.charAt(0)&&(m.$isHidden||k.push(a))});f.items=k;f.cards=o;if(!m.$item)return;break;default:d.indexOf(m.$item.$type);return}}else{if("application/x-object"!==m.$type)if("application/x-reference"===m.$type){if(!m.$item)return;m=m.$item;j.fields=j.fields||[];f={$type:"application/x-reference",
$bind:a.$bind,$title:m.$title,$proto:m};j.fields.push(f)}else if(!(0>d.indexOf(m.$type)))g&&g.push(a),j.fields=j.fields||[],f={$type:m.$type,$bind:a.$bind},j.fields.push(f);return}}c||Object.keys(a).forEach(function(c){var b=a[c];b&&(Array.isArray(b)?b.forEach(function(a){"object"==typeof a&&e.layoutParser(j,a,c,l,g)}):"object"==typeof b&&e.layoutParser(j,b,c,l,g))})}};e.useUuid=function(c){return"{$uuid}"===c.$key};e.getRefFromValue=function(c,a){if(!c)return null;var b={};if(e.useUuid(a))b.$uuid=
c.$uuid,b.$key=c.$key||c.$uuid;Object.keys(a.$properties).forEach(function(a){b[a]=c[a]});return b};e.setArrayRef=function(c,a){if(b.proto.useUuid(a))return c;var d={};Object.keys(a.$properties).forEach(function(b){if(a.$properties.isReadOnly)c&&delete c[b];else{var e=(c?c[b]:"")||"",f=a[b];f||(f="{"+b+"}");if(f&&!("{"!=f.charAt(0)||"}"!=f.charAt(f.length-1)))c&&delete c[b],b=f.substring(1,f.length-1),d[b]=e}});return d};e.setRef=function(c,a,d,e){var f=b.proto.useUuid(a),j=d.data();f?j[e]=c:(Object.keys(a.$properties).forEach(function(b){if(a.$properties.isReadOnly)c&&
delete c[b];else{var d=(c?c[b]:"")||"",e=a[b];e||(e="{"+b+"}");if(e&&!("{"!=e.charAt(0)||"}"!=e.charAt(e.length-1)))c&&delete c[b],b=e.substring(1,e.length-1),a.$rprotoparent.$properties[b]&&(j[b]=d)}}),c?Object.keys(c).length&&(j[e]=c):delete j[e])};e._protoProp=function(c,a){if("$baseUrl"===a)return{value:b.sdata.config.baseUrl,found:!0,stop:!0};var d=c;if("@"==a.charAt(0))for(;d;){if(d&&d.$localization&&d.$localization.hasOwnProperty(a))return{value:d.$localization[a],found:!0,stop:!0};d=d.$rprotoparent}else for(;d;){if(d.hasOwnProperty(a))return{value:d[a],
found:!0};d=d.$protoparent}return{found:!1}};e._dataProp=function(c,a){if("$baseUrl"===a)return{value:b.sdata.config.baseUrl,found:!0,stop:!0};for(var d=c.data();d;){if(d.hasOwnProperty(a))return{value:d[a],found:!0};d=c.parent(d)}return{value:"",found:!1}};e.execExpression=function(c,a,b,d){d=d||0;c=(c||"")+"";if(!d&&0>c.indexOf("{")&&b){var f=e._dataProp(b,c);if(f.found)return f.value}return c.replace(/\{(.*?)\}/g,function(f,g){var m;if(!d&&a&&!a.noRef&&a.$protoparent&&"application/x-reference"===
a.$protoparent.$type){m=e._protoProp(a,g);if(m.found){if(m.stop)return m.value||"";if(0<=m.value.indexOf("{")){var k=a;if(0<=m.value.indexOf("{"+g+"}"))k=a.$protoparent;return e.execExpression(m.value,k,b,d+1)}m=b?e._dataProp(b,g):{found:!1};!m.found&&e.trace.expressions&&(console.log(c),console.log("Not found:"+g),console.log("----------------------------------"));return m.value||""}m=b?e._dataProp(b,g):{found:!1};!m.found&&e.trace.expressions&&(console.log(c),console.log("Not found:"+g),console.log("----------------------------------"));
return m.value||""}m=b?e._dataProp(b,g):{found:!1};if(m.found)return m.value||"";m=a?e._protoProp(a,g):{found:!1};return!m.found?(e.trace.expressions&&(console.log(c),console.log("Not found:"+g),console.log("----------------------------------")),""):m.stop?m.value:0<=m.value.indexOf("{")?e.execExpression(m.value,a,b,d+1):m.value||""})||""};e.parseExpression=function(b,a){return e.execExpression(b,a.$prototype,a.data)};e.jqmDataArray=function(){return{"data-inset":"true","data-mini":"true","data-theme":"d",
"data-divider-theme":"e"}};e.generateForm=function(b,a,f,h,g,j){var l=!0,m=h,k=[],n=null;g&&(m="c"+a,a++,f[m]={layout:"BlockLayout",data:{jmdata:{"data-theme":"d"}},parent:h});b.fields&&b.fields.forEach(function(b){if(b.$isSection){var c=n=null;b.title&&(c={layout:"CollapsibleLayout",data:{facet:j,jmdata:{"data-inset":g?"false":"true"},text:b.title,collapsed:!1,size:6}});if(c){if(m)c.parent=m;var h="c"+a;a++;f[h]=c;b.fields&&b.fields.length&&(a=e.generateForm(b,a,f,h,!1,j));k.push(c)}}else if(l=!1,
c=null,0<=d.indexOf(b.$type)){if(!n){c={uiClass:"MultiField",data:{facet:j,fields:[]}};if(m)c.parent=m;h="e"+a;a++;n=f[h]=c}n.data.fields.push(b)}else{n=null;c={uiClass:"ArrayField",data:{facet:j,field:b}};c.data.jmdata=e.jqmDataArray();if(m)c.parent=m;h="e"+a;a++;f[h]=c}});if(g&&l)f[m].layout="CollapsibleSetsLayout",k.forEach(function(a,b){a.data.collapsed=0!=b});return a}})(jQuery);
(function(b){var e=b.helpers||{};(function(){if(!Array.isArray)Array.isArray=function(a){return null!=a&&null!=a.splice};if(!Function.prototype.bind)Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;
e.prototype=new d;return e};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};var a=!1;try{isNaN(new Date("2011-11-08T23:00:00.000Z"))&&(a=!1)}catch(b){a=!1}Date.parseISO8601=a?function(a){return new Date(a)}:function(a){var b=/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?)?)?$/.exec(a);if(null===b)throw Error("Invalid ISO String");
var c=new Date;c.setUTCFullYear(+b[1]);c.setUTCMonth(b[3]?(b[3]>>0)-1:0);c.setUTCDate(b[5]>>0);c.setUTCHours(b[7]>>0);c.setUTCMinutes(b[8]>>0);c.setUTCSeconds(b[10]>>0);c.setUTCMilliseconds(b[12]>>0);if(b[13]&&"Z"!==b[13]){var d=b[16]>>0,e=b[17]>>0,a="+"===b[15];c.setUTCHours((b[7]>>0)+a?-d:d);c.setUTCMinutes((b[8]>>0)+a?-e:e)}return c}})();if(!window.console)window.console={log:function(){}};b.helpers=e;b.helpers.extend=function(a,b){for(var c in b)a[c]=b[c]};var f={http:1,db:2,exception:3,sdata:4};
e.slashAtEnd=function(a){a&&"/"!=a.charAt(a.length-1)&&(a+="/");return a};e.displayDateFormat="YYYY-MM-DD";e._diag=function(a,b,c){if(a){var d=a.$diagnoses;if(d&&d.length)b?c[b]={message:d[0].message}:c.message=d[0].message;Object.keys(a).forEach(function(d){var f=a[d],g=f.$diagnoses;if(g&&g.length&&(c[d]={message:g[0].message},!c.message))c.message=d+": "+c[d].message;if("object"==typeof f&&(f.$||f.$properties))e._diag(f.$||f.$properties,b?b+"."+d:d,c)})}};e.http={parseCookie:function(a){var b={};
(a||"").split(";").forEach(function(a){a=a.split("=");2<=a.length&&a[0]&&a[1]&&(b[a[0].trim()]=a[1].trim())});return b},setCookie:function(a,b,c,d){!b&&""==b&&(d=new Date);try{window.document.cookie=a+"="+b+(null!=d?"; expires="+d.toGMTString():"")+(c?"; path="+c:"/")}catch(e){}}};e.extractErrors=function(a,b){var c={message:b};if(!a||!a.$&&!a.$properties)return c;e._diag(a.$||a.$properties,"",c);return c};e.format=function(a,b){return a=a.replace(/\{([0-9]\})*/g,function(a,c){return b[parseInt(c)]})};
e.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};e.htmlEncode=function(a){return b("<div/>").text(a).html()};e.htmlDecode=function(a){return b("<div/>").html(a).text()};e.FUNCS={H:function(a,b,c){return a?b+a+c:""},ERROR:function(a){return e.FUNCS.H(a,'<p class="ui-m-margin-0 ui-m-error"><strong>',"</strong><br/p>")},INFO:function(a){return e.FUNCS.H(a,'<p class="ui-m-margin-0 ui-m-ok">',"</p>")},
TITLE_LW:function(a){return e.FUNCS.H(a,'<p class="ui-m-margin-0"><strong>',"</strong></p>")}};e.ERRORS=f;e.pushdbError=function(a){e.pushError({type:f.db,title:e.messages.db_exception,data:{message:a.message}})};e.pushException=function(a,b){e.pushError({type:f.exception,title:e.messages.app_exception,data:{message:a.message,solution:b}})};e.pushAjaxError=function(a,c,d,g,j){var c=d,j=j||"GET",l=null;if(a.responseText&&0<a.responseText.indexOf("$diagnoses"))try{l=JSON.parse(a.responseText)}catch(m){}if(l&&
l.$diagnoses&&l.$diagnoses.length)c=l.$diagnoses[0].message;else if(d&&d.message)c=d.message;else if(a.statusText)c=a.statusText;if(!c)c=b.smobile.locale().ui.unknownError;200==a.status||201==a.status?e.pushError({type:f.exception,title:e.messages.app_exception,data:{message:c}}):e.pushError({type:f.http,title:j+" "+g,data:{message:(a.status?a.status+" - ":"")+c}})};e._errkey=function(a){return a?"mobile_errors":"mobile_errors"};e._localStorage=!0;try{if(!window.sessionStorage)e._localStorage=!1}catch(d){e._localStorage=
!1}e._pushError=function(a,b){var c=e._errkey(b);if(e._localStorage){var d=window.sessionStorage.getItem(c),d=d?JSON.parse(d):[];d.push(a);window.sessionStorage.setItem(c,JSON.stringify(d))}else e[c]||(e[c]=[]),e[c].push(a)};e._hasErrors=function(a){a=e._errkey(a);return e._localStorage?(a=window.sessionStorage.getItem(a))?(a=JSON.parse(a),0<a.length):!1:e[a]&&e[a].length};e._clearErrors=function(a){a=e._errkey(a);e._localStorage?window.sessionStorage.removeItem(a):delete e[a]};e._lastErrors=function(a){a=
e._errkey(a);return e._localStorage?(a=window.sessionStorage.getItem(a))?JSON.parse(a):null:e[a]};e.pushError=function(a){e._pushError(a,!1)};e.hasErrors=function(){return e._hasErrors(!1)};e.clearErrors=function(){e._clearErrors(!1)};e.lastErrors=function(){return e._lastErrors(!1)};e.pushWarn=function(a){e._pushError(a,!0)};e.hasWarns=function(){return e._hasErrors(!0)};e.clearWarns=function(){e._clearErrors(!0)};e.lastWarns=function(){return e.lastErrors(!0)};e.each=function(a,b,c,d){a=a||[];if(!a.length)return c();
if(null==c)return a.forEach(b);var d=d||1,e=0,f=0,m=a.length;(function n(){if(f==m&&!e)return c();for(;f<m&&e<d;){e++;var o=f++;b(a[o],o,function(){e--;n()})}})()};e.forEachKey=function(a,b,c,d){if(c)return null==a?c():e.each(Object.keys(a),function(c,d,e){return b(c,a[c],e)},c,d);for(var f in a)b(f,a[f])};e.sdataURL2key=function(b){return(b=/^.*\(\'(.*)\'\)$/.exec(b))&&2==b.length?b[1]:""};e.applySDataSort=function(b,c){c.sort(function(c,d){for(var e,f,i=0,k=b.length;i<k;i++){var n=b[i];e=c[n.name];
f=d[n.name];if(e!=f)return e>f?n.asc?1:-1:n.asc?-1:1}return 0})};e.addJqmData=function(b,c,d,e,f){b.jmdata&&Object.keys(b.jmdata).forEach(function(l){if(!(d&&0>d.indexOf(l))){var m=b.jmdata[l],k="true"==b.jmdata||"false"==b.jmdata?"":'"';e?c.push(" "+f+m):c.push(" "+l+"="+k+m+k)}})};e.encodeURIComponent=function(b){return encodeURIComponent(b).replace(/\'/g,"%27")};e.encodeJsmQuery=function(b){return e.encodeURIComponent(b)};e.decodeJsmQuery=function(b){return 0<b.indexOf("=")?b:decodeURIComponent(b)};
e.hashFirst=function(){return!0};e.sdataSort=function(b){if(b&&b.orderBy){var c=b.orderBy.split(",");c.forEach(function(b,a){var b=b.trim(),d=b.split(" ");c[a]=2==d.length?{name:d[0],asc:"desc"!=d[1]}:{name:b,asc:!0}});return c}return null};e.number={decimalSep:"",decimalSeparator:function(){if(e.decimalSep)return e.decimalSep;var b;b=(1.1).toLocaleString().substring(1,2);return e.decimalSep=b}};var c=function(b){b=""+b;1==b.length&&(b="0"+b);return b};e.date={isoToDate:function(b){return Date.parseISO8601(b)},
dateMY:function(b){return e.messages.monthsOfYear[b.getMonth()]+" "+b.getFullYear()},dateMY2:function(b,c){return e.messages.monthsOfYear[b]+" "+c},dateym:function(b){return b.getFullYear()+"-"+c(b.getMonth()+1)},str2dateym:function(b){b=e.date.isoToDate(b);return b.getFullYear()+"-"+c(b.getMonth()+1)},str2dateYM:function(b){b=e.date.isoToDate(b);return e.date.dateMY(b)},dateTimeToLocalDate:function(b){return b.getFullYear()+"-"+c(b.getMonth()+1)+"-"+c(b.getDate())},checkString:function(b,c){if(!c)return b;
try{var d=b.substring(0,10);return c.substring(0,10)==d?c:b}catch(e){return c}},dateStringToIso:function(b){var c=(new Date).toISOString().substring(10);return Date.parseISO8601(b+c).toISOString()}}})(jQuery);
(function(b){var e=b.helpers||{};b.helpers=e;b.helpers.Time=function(b){this._value=(b+31536E7)%86400};var f=function(b){b=b.toString();return 1==b.length?"0"+b:b};b.helpers.Time.prototype={hour:function(){return Math.floor(this._value/3600)},minute:function(){return Math.floor(this._value/60)%60},second:function(){return this._value%60},value:function(){return this._value},toISO:function(){return f(this.hour())+":"+f(this.minute())+":"+f(this.second())},format:function(){var b=this.hour(),c=this.minute(),
a=this.second(),i=e.dateSettings.timeFormat||"HH:ii",h=c+"",c=f(c),g=a+"",a=f(a),j=b+"",l=f(b);if(e.dateSettings.ampmText){var m="AM";13<b&&(b-=12,j=b+"",l=f(b),m="PM");return i.replace(/ii/,c).replace(/i/,h).replace(/ss/,a).replace(/s/,g).replace(/hh/,l).replace(/h/,j).replace(/A/,m)}return i.replace(/ii/,c).replace(/i/,h).replace(/ss/,a).replace(/s/,g).replace(/HH/,l).replace(/H/,j)}};b.helpers.Time.parse=function(d){d=d||"00:00";if(5!=d.length&&8!=d.length)throw Error("bad time format, expected hh:mm or hh:mm:ss, got "+
d);d=8==d.length?3600*parseInt(d.substring(0,2),10)+60*parseInt(d.substring(3,5),10)+parseInt(d.substring(6.8),10):3600*parseInt(d.substring(0,2),10)+60*parseInt(d.substring(3,5),10);return new b.helpers.Time(d)};b.helpers.Time.parseTime=function(d){var c=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,new Date),d=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,c+" "+d),c=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,
c+" "+(new b.helpers.Time("00:00")).format());return new b.helpers.Time((d-c)/1E3)};e.messages={http_error:"Http Error",app_exception:"Application Exception",db_exception:"Database Exception",nothing_to_send:"No changes to send.",menu_apps:"Root Menu",datasets:"Societies",entities:"Entities",resources:"Resources"};e.lang2DateSettings=function(d){var c=new Date;d||(d={amDesignator:"AM",pmDesignator:"PM",dateElementOrder:"mdy",dayNames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
abbreviatedDayNames:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),monthNames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),abbreviatedMonthNames:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),formatPatterns:{shortDate:"M/d/yyyy",shortTime:"h:mm tt"}});d={ampmText:d.amDesignator||d.pmDesignator?"&nbsp;":"",dateFormat:d.formatPatterns.shortDate.toLowerCase().replace(/yyyy/,"yy"),dateOrder:d.dateElementOrder.replace(/m/,"mm").replace(/y/,
"yy").replace(/d/,"dd"),dayNames:d.dayNames,dayNamesShort:d.abbreviatedDayNames,monthNames:d.monthNames,monthNamesShort:d.abbreviatedMonthNames,timeFormat:d.formatPatterns.shortTime.replace(/tt/g,"A").replace(/m/g,"i"),yearText:b.smobile.locale().datetime.year,monthText:b.smobile.locale().datetime.month,dayText:b.smobile.locale().datetime.day,minuteText:b.smobile.locale().datetime.minutes,hourText:b.smobile.locale().datetime.hour,secText:b.smobile.locale().datetime.seconds};d.endYear=c.getFullYear()+
20;d.timeFormat=d.ampmText?d.timeFormat.replace(/H/g,"h"):d.timeFormat.replace(/h/,"H");d.timeWheels=d.timeFormat.replace(/:/g,"").replace(/ /g,"");return d};e.dateSettings=e.lang2DateSettings(null);b.scroller&&b.scroller.setDefaults(e.dateSettings)})(jQuery);(function(b){var e=b.sdata||{};b.sdata=e;e.sdataHost=window.location.protocol+"//"+window.location.host;e.sdataAdmin=e.sdataHost+"/sdata/syracuse/collaboration/syracuse/dashboardDefs/$service/mobilePortlets";e.store=function(){return!1};e.$url=function(b,a){a=a||b.$url;return b.$baseURI&&0>a.indexOf(b.$baseURI)?b.$baseURI+a:a};e.$purl=function(b){var b=b||"",a=e.config.baseUrl;return a&&0>b.indexOf(a)?a+b:b};e.authName="none";e.authModule={authName:"none",checkConnected:function(b){return b.success()},
connect:function(b){return b.success()},connectedUser:function(){return{id:"",caption:""}},disconnect:function(b){return b.success()}};e.STATUS={ORIGINAL:0,CREATED:1,MODIFIED:2,DELETED:3};e.TYPES={ENTITY:0,TEMPLATE:1,UNKNOWN:10};e.options={statefulServerPrtocol:!0};e.funcs={yearMonth:function(c){return b.helpers.date.str2dateym(c)},yearMONTH:function(c){return b.helpers.date.str2dateYM(c)},thisMonth:function(c){var a=b.helpers.date.isoToDate(c),c=a.getFullYear(),a=a.getMonth(),d=new Date(new Date(c,
a+2,1,0,0,0,0)-1/24/60/60/1E3);return"@"+(new Date(c,a+1,1,0,0,0,0)).toISOString()+"@ and @"+d.toISOString()+"@"},asString:function(b){return"'"+b.replace("'","''")+"'"}};var f=/^(.*)\(\'(.*)\'\)$/i;e.config={id:"",baseUrl:"",resources:{}};var d={groups:{$count:function(){},$sum:function(){}},funcs:{month:function(c){return b.helpers.date.isoToDate(c).getMonth()},year:function(c){return b.helpers.date.isoToDate(c).getFullYear()}},_parseQuery:function(b){var a={};b&&b.replace(/([^&=;]*)=?([^&;]*)/g,
function(b,c,d){c&&(a[c]=decodeURIComponent(d))});return a},_execSDATA:function(c,a){if(c.createActivity||c.editActivity)return d._startEditActivity(c,a);if(c.entity==b.proto.sdataKey.workingCopies)return d._loadDraft(c,a);d.makeURL(c);return e.sendSDataRequest(c,a)},makeURL:function(c){var a=[c.base,c.application,"/"+c.contract,"/"+c.dataset];a.push("/"+c.entity);c.id&&a.push("('"+c.id+"')");c.template&&a.push("/$template");c.createActivity&&a.push("/"+b.proto.sdataKey.workingCopies);c.editActivity&&
a.push("/"+b.proto.sdataKey.workingCopies);if(c.createActivity||c.editActivity)if(c.query=c.query||{},!c.query.trackingId)c.query.trackingId=b.helpers.uuid();if(c.query){var d=Object.keys(c.query);d&&d.forEach(function(d,e){e?a.push("&"):a.push("?");a.push(d+"="+b.helpers.encodeURIComponent(c.query[d]))})}c.uri=a.join("")},logSdata:function(c,a){b.helpers.log&&(console.log(c),console.log((a.method||"GET")+": "+a.uri))},_protoFromschema:function(b){var a={};b&&Object.keys(b.properties).forEach(function(e){var f=
b.properties[e];"string"==f.type?a[e]="":"integer"==f.type?a[e]=0:"decimal"==f.type?a[e]=0:"boolean"==f.type?a[e]=!1:"object"==f.type?a[e]=d._protoFromschema(f):"object"==typeof f.type&&f.type.$ref&&(a[e]=null)});return a},_loadDraft:function(b,a){e.loadDraft(b.id,function(b){if(!b)return a.success(null,{status:404});var c=b.data;c.$info={original_url:b.original_url};return a.success(c,{status:200})})},_startEditActivity:function(c,a){d.makeURL(c,!0);d.logSdata("Virtual operation: Start edit activity ",
c);var f=b.extend(f,c),h=b.extend(!0,{},c);delete h.query.trackingId;h.createActivity?delete h.createActivity:h.editActivity&&delete h.editActivity;d._execSDATA(h,{success:function(g,j){h.query={representation:h.query.representation};d.makeURL(h,!0);var l=h.uri;if(300<j.status)return 404==j.status&&h.template&&b.helpers.pushException({message:b.helpers.format(b.smobile.locale().sdata.S404,[f.uri])},b.smobile.locale().actions.syncronize),a.success(null,j);if(!g.$key&&!g.$uuid)g.$uuid=b.helpers.uuid();
var m=!1;if(h.template&&(m=!0,!g.$key&&!g.$uuid))g.$uuid=b.helpers.uuid();g.$trackingId=c.query.trackingId;h.entity=b.proto.sdataKey.workingCopies;h.template=!1;h.id=c.query.trackingId;d.makeURL(h);l={id:g.$trackingId,data:g,representation:h.query.representation,original_url:l};if(!m)l.original_data=b.extend(!0,{},g),delete l.original_data.$trackingId;e.createDraft(l,function(c){var d=b.extend(!0,{},c.data);d.$info={original_url:c.original_url};return a.success(d,{status:201,location:h.uri})})}})},
_parseSE:function(b){var a={prefix:b,content:""};if((b=f.exec(b))&&3==b.length)a.prefix=b[1],a.content=b[2];return a},parseSDataURL:function(c){var a=c.split("/sdata/"),e=null;if(2==a.length){e={base:a[0]+"/sdata/",query:{},sdata:"sdata",origUri:c};a=a[1].split("?");if(2==a.length)e.query=d._parseQuery(a[1]);a=a[0].split("/");if(3>a.length)return null;e.application=a[0];e.contract=a[1];e.dataset=a[2];if(4>a.length)return e;e.entity=a[3];c=d._parseSE(e.entity);e.entity=c.prefix;e.id=c.content;if(4<
a.length)if(c=a[4],"$template"==c)e.template=!0;else if(c==b.proto.sdataKey.workingCopies&&e.id)e.editActivity=!0;if(5<a.length&&(c=a[5],e.template&&c==b.proto.sdataKey.workingCopies))e.createActivity=!0}return e}};e.initFromSchema=function(b){return d._protoFromschema(b)};e._cleanHeaders=function(b){b&&(delete b.$httpMethod,delete b.$httpStatus,delete b.$httpMessage,delete b.$httpLocation)};e.loadAuth=function(c){if(e.authName==e.authModule.authName)return c();var a="js/auth/jquery.smobile.auth."+
e.authName+".min.js";b.ajax({url:a,dataType:"script",success:function(){c()},error:function(d,e,f){b.helpers.pushAjaxError(d,e,f,a,"GET");c()}})};e.execBatch=function(b,a,d){if(!b&&!d)return a.success();e.loadAuth(function(){e.authModule.checkConnected({success:function(){return e._execBatch(b,a,d)},fail:function(){e.authModule.connect({success:function(){return e._execBatch(b,a,d)},fail:function(){a.success&&a.success()}})}})})};e._execBatch=function(c,a,d){b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.sending});
var f=function(b){d({$reinstall:!0},null,b.success)},g=function(c){if(!b.helpers.hasErrors()&&d)return f({success:function(){b.mobile.loading("hide");if(c.success)return c.success()}});b.mobile.loading("hide");if(c.success)return c.success()};if(!c)return g(a);b.sdata.useCacheCount=!1;b.helpers.each(Object.keys(c),function(a,d,f){var k=e.config.baseUrl+"/"+a,n={$url:k+"/$batch",$resources:[]},i=[];c[a].forEach(function(c){var a;if(c.$info.status==b.sdata.STATUS.CREATED)i.push(c.$info),a=c,a.$httpMethod=
"POST",a.$url=k,delete a.$info;else if(c.$info.status==b.sdata.STATUS.MODIFIED)i.push(c.$info),a=c,a.$httpMethod="PUT",a.$httpifMatch=a.$etag,delete a.$info;else if(c.$info.status==b.sdata.STATUS.DELETED)i.push(c.$info),a={$httpMethod:"DELETE"},a.$httpifMatch=c.$etag,a.$url=c.$info.$url,a.$uuid=c.$uuid,a.$key=c.$key;a&&n.$resources.push(a)});n.$resources.length?b.ajax({headers:{Accept:"application/json"},type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:n.$url,data:JSON.stringify(n),
success:function(c){c.$resources?b.helpers.each(c.$resources,function(c,a,d){var f=n.$resources[a],a=i[a],k=a.url,g;if("PUT"==f.$httpMethod){if(200==c.$httpStatus)return e._cleanHeaders(c),b.sdata.updData(k,{data:c,representation:"",original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(400==c.$httpStatus)return e._cleanHeaders(c),g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.modify_before),e._cleanHeaders(f),b.sdata.updData(k,
{$load:!0,data:c,representation:a.representation,status:b.sdata.STATUS.MODIFIED,last_error:g.message},d);if(410==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.S410),e._cleanHeaders(c),b.sdata.delData(k,d);if(412==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.S412),e._cleanHeaders(c),b.sdata.updData(k,{data:c,representation:"",
original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(500==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(503==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.S503),d()}else if("POST"==f.$httpMethod){if(201==c.$httpStatus){var h=c.$httpLocation;e._cleanHeaders(c);return b.sdata.delData(k,function(){console.log(h);e.store(h);
d()})}if(202==c.$httpStatus)b.helpers.pushException({message:b.smobile.locale().post_ni});else{if(400==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.modify_before),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(403==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.SC_canceled),b.sdata.undoUpdate(k,d);if(404==c.$httpStatus)return g=
b.helpers.extractErrors(c,c.$httpMessage),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(409==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.modify_before),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(503==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.S503),d();if(500==c.$httpStatus)return g=b.helpers.extractErrors(c,
c.$httpMessage),b.sdata.updData(k,{$load:!0,last_error:g.message},d)}}else if("DELETE"==f.$httpMethod){if(200==c.$httpStatus||410==c.$httpStatus)return b.sdata.delData(k,d);if(400==c.$httpStatus)return e._cleanHeaders(c),g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.modify_before),g=b.helpers.extractErrors(c,c.$httpMessage),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(403==c.$httpStatus)return g=b.helpers.extractErrors(c,
c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.SD_canceled),b.sdata.undoUpdate(k,d);if(412==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.SD412),e._cleanHeaders(c),b.sdata.updData(k,{data:c,representation:"",original_data:null,status:b.sdata.STATUS.ORIGINAL,last_error:""},d);if(500==c.$httpStatus)return e._cleanHeaders(c),g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},
b.smobile.locale().sdata.modify_before),g=b.helpers.extractErrors(c,c.$httpMessage),b.sdata.updData(k,{$load:!0,last_error:g.message},d);if(503==c.$httpStatus)return g=b.helpers.extractErrors(c,c.$httpMessage),b.helpers.pushException({message:g.message},b.smobile.locale().sdata.S503),d()}d()},function(){f()}):f()},error:function(c,a,d){b.helpers.pushAjaxError(c,a,d,n.$url,"POST");f()}}):f()},function(){return g(a)})};e.createDraft=function(b,a){a(b)};e.saveDraft=function(b,a,d){d()};e.deleteDraft=
function(b,a){a.success()};e.undoUpdate=function(b,a){a()};e.deleteDataByDraft=function(b,a){a()};e.updateDraft=function(){};e.loadDraft=function(b,a){a(null)};e.initData=function(b,a,d){d.success()};e.updData=function(b,a,d){d(null)};e.getSyncData=function(b){b(null)};e.execWhere=function(){return!0};e.parseWhere=function(){return null};e.groupFunc=function(b){return!b?!1:null!=d.groups[b]};e._parseProp=function(b,a){var b=b.trim(),d={name:b,func:null};if(!a)return d;if(")"==b[b.length-1]){var e=
b.indexOf("(");if(0<e)d.func=b.substr(0,e),d.name="$count"==d.func?"$count":b.substr(e+1,b.length-e-2)}return d};e.getFunc=function(b){return d.funcs[b]};e.applyFunc=function(b,a){var d=e.getFunc(a);return d?d(b):b};e.addSelected=function(c,a,d,e){a.forEach(function(a){if(a.group)if(e){if("$count"==a.name)d.$count=1}else"$count"==a.name&&d.$count++;else if(e){var f=b.sdata.syncGetValue(c,a.name);a.func&&(f=b.sdata.applyFunc(f,a.func));var l=d;if(a.func)l[a.func+"("+a.name+")"]=f;else{for(var a=a.name.split("."),
m=0,k=a.length-1;m<k;m++)l[a[m]]||(l[a[m]]={}),l=l[a[m]];l[a[a.length-1]]=f}}})};e._reduceFields=function(b,a,d,f){b&&b.props&&b.props.forEach(function(b){if(b.props)f=b.func?b.func:f,e._reduceFields(b,b.name,d,f);else{var c=a?f:b.func;a?d.push({name:a+"."+b.name,func:c,group:e.groupFunc(c)}):d.push({name:b.name,func:c,group:e.groupFunc(c)})}});return d};e.parseField=function(b,a,d){var c;var f=b.split(".");if(1<f.length&&(c=(a=a?e.config.entities[a]:null)&&a.$schema?a.$schema.properties:null,a=c))b=
f.shift(),a&&a[b]&&a[b].type&&a[b].type.$ref&&(b=e.parseSdataUri(a[b].type.$ref),e.config.entities[b.entity]&&(d[b.entity]=!0,e.parseField(f.join("."),b.entity,d)))};e.parseFields=function(b,a,d,f,g){var j=d?e.config.entities[d]:null,j=j&&j.$schema?j.$schema.properties:null,l=b||{entity:d,props:[]};a.split(",").forEach(function(b){var c=!1,b=e._parseProp(b,g);if("*"==b.name)l.all=!0;else if(0<b.name.indexOf("/")){var b=b.name.split("/"),a=b[0],d;j&&j[a]&&j[a].type&&j[a].type.$ref&&(d=e.parseSdataUri(j[a].type.$ref),
e.config.entities[d.entity]&&(c=!0));a={name:a,props:[]};if(c)f[d.entity]=!0,a.entity=d.entity;l.props.push(a);b.shift();e.parseFields(a,b.join("/"),c?d.entity:"",f,!1,!1)}else l.props.push(b)});return e._reduceFields(l,"",[],null)};e.execSelected=function(b){return b};e.getSyncCount=function(b){e.useCacheCount?b.success(e.syncCount):e.getSyncDataCount(function(a){e.syncCount=a;e.useCacheCount=!0;b.success(a)})};e.getSyncDataCount=function(b){b(0)};e.getModifiedData=function(b,a){a(null)};e.translateURL=
function(b){var a;if(e.urlmap){if(a=e.urlmap.key.indexOf(b),0<=a)return e.urlmap.value[a]}else e.hack_replace&&(a=b.indexOf(e.hack_replace.src),0==a&&(b=e.hack_replace.dst+b.substring(e.hack_replace.src.length)));return b};e.post=function(c,a,d,f,g){b.helpers.log&&console.log("POST "+c);var j={Accept:"application/json;vnd.sage=syracuse"};f&&b.extend(j,f);var l=e.translateURL(c);b.ajax({headers:j,type:"POST",dataType:"json",data:JSON.stringify(a),url:l,contentType:"application/json; charset=utf-8",
success:function(a){if(e.hack_replace&&c!=l)var f=RegExp(e.hack_replace.src.replace(/\//g,"/"),"g"),a=JSON.parse(JSON.stringify(a).replace(f,e.hack_replace.dst));b.helpers.log&&(console.log("Response: "),console.log(a));d(a)},error:function(a,e,f){if(g&&g.ignoreErrors)return d(null);b.helpers.pushAjaxError(a,e,f,c,"POST");d(null)}})};e.GET=function(c,a,d,f){b.helpers.log&&console.log("GET "+c);var g={Accept:"application/json;vnd.sage=syracuse"};d&&b.extend(g,d);var j=e.translateURL(c);b.ajax({headers:g,
type:"GET",dataType:"json",url:j,success:function(d,f,k){e.hack_replace&&c!=j&&(f=RegExp(e.hack_replace.src.replace(/\//g,"/"),"g"),d=JSON.parse(JSON.stringify(d).replace(f,e.hack_replace.dst)));b.helpers.log&&(console.log("Response: "),console.log(d));k={status:k?k.status:200,location:k?k.getResponseHeader("Location"):""};a(d,k)},error:function(d,e,k){if(f&&f.ignoreErrors)return a(null);b.helpers.pushAjaxError(d,e,k,c,"GET");d={status:d?d.status:200,location:d?d.getResponseHeader("Location"):""};
a(null,d)}})};e.applicationDetails=function(b,a){var d={baseURL:b.baseURL},f=e.parseSdataUri(b.baseURL);d.applicationName=f.application;d.contractName=f.contract;d.endpointName=f.dataset;e.post(e.$url(b,b.url),d,function(b){a(b)})};e.syncGetValue=function(b,a){var d=a.split("."),f=!1,g=b;if(!b)return null;d.forEach(function(b){var c;if(!f){if((c=(g=g[b])?g.$key||g.$uuid:!1,b=c)&&e.loadCache&&e.loadCache[b])g=e.loadCache[b].data;f=null==g}});return g};e.applicationList=function(b){var a=e.sdataAdmin,
d=e.parseSdataUri(a);e.GET(a,function(a){var f=[],j="";if(a&&a.$resources){if(a.$baseUrl)j=a.$baseUrl,delete a.$baseUrl;a.$resources.forEach(function(b){if(b&&b.endpoints&&b.endpoints.length){var c={url:b.installUrl,title:b.title,description:b.description||b.title,icon:b.icon||"",baseURL:d.base+b.applicationName+"/"+b.contract+"/",datasets:b.endpoints};if(j&&0>c.url.indexOf(j))c.url=j+c.url;if(c.url&&"/"==c.url.charAt(0))c.url=e.sdataHost+c.url;delete b.endpoints;f.push(c)}})}b.success&&b.success(f)})};
e.removeFromDB=function(b,a){a()};e.delData=function(b,a){a()};e.sendSDataRequest=function(c,a){d.logSdata("Real operation: Send SDATA request: ",c);var f={},h=a.success;if(e.store(c.uri)){if(!c.id&&!c.template&&c.query&&(c.query.selected||c.query._groupBy||c.query.where)){if(c.query.selected)c.pselected=e.parseFields(null,c.query.selected,c.entity,f,!0,!1);if(c.query._groupBy)c.pgroupBy=e.parseFields(null,c.query._groupBy,c.entity,f,!0,!0);if(c.query.where)c.pwhere=e.parseWhere(c.query.where,c.entity,
f);f=Object.keys(f);if(f.length)a.$prefetch=a.$prefetch||[],a.$prefetch=a.$prefetch.concat(f)}}else return e.getModifiedData(c,function(d){if(c.id){if(d&&d[c.id])return d[c.id].status===b.sdata.STATUS.DELETED?a.success(null,{status:404}):a.success(d[c.id].data,{status:200});e.execGetSData(c,a)}else if(d&&Object.keys(d).length){var f=!0,g=c.query&&c.query.representation?b.sdata.config.pages[c.query.representation]:null;if(g)g=g.$prototype.$properties.$resources.$item,g=g.$item||g,f=b.proto.useUuid(g);
e.execGetSData(c,{success:function(c,e){if(c&&c.$resources)for(var o=c.$resources.length,i;o--;)if(i=c.$resources[o],i=f?i.$uuid||i.$key:b.proto.parseExpression(g.$key,{data:b.proto.exprData(i),$prototype:g},"$key"),d[i])d[i].status===b.sdata.STATUS.DELETED?c.$resources.splice(o,1):c.$resources[o]=d[i].data;a.success(c,e)}})}else e.execGetSData(c,a)});var g=a.$prefetch&&!c.id&&!c.template&&!e.loadCache;g&&e.startLoad();a.success=function(c,a){g&&e.endLoad();b.helpers.log&&(console.log("Response: "),
console.log(c));h&&h(c,a)};a.$prefetch&&!c.id?b.helpers.each(a.$prefetch,function(b,a,f){b=d.parseSDataURL(c.base+c.application+"/"+c.contract+"/"+c.dataset+"/"+b);e.execGetSData(b,{success:function(b){b&&b.$resources&&b.$resources.forEach(function(b){e.loadCache[b.$key||b.$uuid]={data:b,headers:{status:200}}});return f()}})},function(){e.execGetSData(c,a)}):e.execGetSData(c,a)};e.execGetSData=function(c,a){var d=b.sdata.config.entities[c.entity]&&b.sdata.config.entities[c.entity].sync,f=!d&&b.sdata.offline&&
b.sdata.config.entities[c.entity]&&b.sdata.config.entities[c.entity].cache;!d&&!f?e.GET(c.uri,a.success):e.getSData(c,a)};e.getSData=function(b,a){a.success&&a.success("Not found",{status:404})};e.execURL=function(b,a){e.config&&e.config.baseUrl&&(b=e.$url({$baseURI:e.config.baseUrl},b));var f=d.parseSDataURL(b);f?d._execSDATA(f,a):a.success&&a.success("Not Implemented",{status:500})};e.parseSdataUri=function(b){return d.parseSDataURL(b)};e.getUri=function(b){d.makeURL(b);return b.uri};e.entityUri=
function(b){var a=[b.base,b.application,"/"+b.contract,"/"+b.dataset];a.push("/"+b.entity);return a.join("")};e.getBaseUrl=function(b){return[b.base,b.application,"/"+b.contract,"/"+b.dataset,"/"].join("")};e.entityMeta=function(b){return e.config.entities?e.config.entities[b]:null};e.getInstalledApps=function(b,a){a([])};e.startLoad=function(){};e.endLoad=function(){};e.getAppConfig=function(b,a){a(null)};e.installApp=function(b,a){a(null,!0)}})(jQuery);(function(b){var e=b.sdata||{};b.sdata=e;var f={identifier:"identifier",operator:"operator",literal:"literal"};e.tokenType=f;(function(d){function c(b,a,c,d,e,f,q){this.code=b;this.text=a;this.precedence=c;this.isPrefix=d;this.isInfix=e;this.isAssociative=f;this.isPredicate=q}function a(){this.operators={};this.init()}function e(b,a,c,d,f){this.type=b;this.value=f;this.getRemainingText=function(){return a.substring(c,a.length)}}function h(b){this.children=null;if(b.operator)this.type="operator",this.value=
b.operator,this.children=[],b.expression1&&this.children.push(b.expression1),b.expression2&&this.children.push(b.expression2);else if(b.expressionType&&(this.type=b.expressionType,this.value=b.value,this.svalue=b.svalue,this.dataType=b.dataType,"function"===this.type))this.children=[]}function g(a,c){if("identifier"==c.type)c.property=b.sdata.syncGetValue(a,c.value);else if("literal"==c.type)c.property="datetime"==c.dataType?c.svalue:c.value;else if(c.children)if("operator"==c.type)switch(c.value.code){case "and":c.children.forEach(function(b){g(a,
b)});c.property=c.children[0].property&&c.children[1].property;break;case "or":c.children.forEach(function(b){g(a,b)});c.property=c.children[0].property||c.children[1].property;break;case "between":c.children.forEach(function(b){g(a,b)});c.property=c.children[0].property>=c.children[1].property&&c.children[0].property<=c.children[2].property;break;case "=":c.children.forEach(function(b){g(a,b)});c.property=c.children[0].property==c.children[1].property;break;case ".":g(a,c.children[0]);g(c.children[0].property,
c.children[1]);c.property=c.children[1].property;break;default:c.property=null,c.children.forEach(function(b){g(a,b);if("literal"==b.type)b.property=null})}else if("function"==c.type){var d=[];c.children&&c.children.forEach(function(b){g(a,b);d.push(b.property)});var e=b.sdata.getFunc(c.value);if(e)c.property=e.apply(b.sdata,d)}}b.helpers.extend(c.prototype,{toString:function(){return this.text}});b.helpers.extend(a.prototype,{_createOp:function(b,a,d,e,f,s,q){b=new c(b||a,a,d,e,f,s,q);this.operators[b.text]=
b},init:function(){this._createOp(null,".",1,!1,!0,!0,!1);this._createOp(null,"not",2,!0,!1,!1,!1);this._createOp("*","mul",3,!1,!0,!0,!1);this._createOp("/","div",3,!1,!0,!0,!1);this._createOp("%","mod",3,!1,!0,!0,!1);this._createOp(null,"+",4,!1,!0,!0,!1);this._createOp(null,"-",4,!0,!0,!0,!1);this._createOp("=","eq",5,!1,!0,!1,!0);this._createOp("<>","ne",5,!1,!0,!1,!0);this._createOp("<","lt",5,!1,!0,!1,!0);this._createOp("<=","le",5,!1,!0,!1,!0);this._createOp(">","gt",5,!1,!0,!1,!0);this._createOp(">=",
"ge",5,!1,!0,!1,!0);this._createOp(null,"between",5,!1,!0,!1,!0);this._createOp(null,"in",5,!1,!0,!1,!0);this._createOp(null,"like",5,!1,!0,!1,!0);this._createOp(null,"and",6,!1,!0,!0,!0);this._createOp(null,"or",7,!1,!0,!0,!0);this._createOp(null,"(",8,!0,!1,!1,!1);this._createOp(null,")",8,!1,!1,!1,!1);this._createOp(null,",",8,!1,!1,!1,!1)}});var j=new a;b.helpers.extend(e.prototype,{matches:function(b){return this.value instanceof c&&this.value.code==b}});var l=new function(){this.tokenize=function(b){for(var c=
[],a=0;a<b.length;){for(;a<b.length&&" "===b[a];)a++;var d=b[a];switch(d){case "@":for(var g=d=b,s=a,a=c,q=s+1,r=g.length;q<r&&!("@"==g[q]);)q++;if(q===g.length)throw Error("date constant not terminated:"+d.substring(s,d.length));g=g.substr(s+1,q-s-1);r=new Date(g);if(null!=r)d=new e(f.literal,d,s,q+1-s,r),d.dataType="datetime",d.svalue=g,a.push(d);a=q+1;break;case '"':case "'":a:{for(var q=d=b,g=a,a=c,r=q[g],s=g+1,v="";s<q.length;){if(q[s]===r&&(s++,s===q.length||q[s]!==r)){d=new e(f.literal,d,g,
s-g,v);d.dataType="string";a.push(d);a=s;break a}v+=q[s++]}throw Error("quoted string not terminated: "+d.substring(g));}break;case "-":case "+":case "(":case ")":case ",":c.push(new e(f.operator,b,a,1,j.operators[d]));a+=1;break;default:if(/[a-zA-Z%']/.test(d)){g=d=b;q=c;s=a+1;for(r=void 0;s<g.length&&/[a-zA-Z0-9_%.%']/.test(g[s]);)s++;g=g.substr(a,s-a);r=j.operators[g.toLowerCase()];null!=r?q.push(new e(f.operator,d,a,s-a,r)):("true"===g||"false"===g||"null"===g?(r=new e(f.literal,d,a,s-a,g),r.dataType=
"bool"):(r=new e(f.identifier,d,a,s-a,g),r.dataType="word"),q.push(r));a=s}else if(/[0-9]/.test(d)){q=d=b;s=c;g=a+1;for(r=v=void 0;g<q.length&&/[0-9]/.test(q[g]);)g++;v=void 0;if(g<q.length&&"."===q[g]){for(g++;g<q.length&&/[0-9]/.test(q[g]);)g++;v=parseFloat(d.substring(a,g));r="float"}else v=parseInt(d.substring(a,g),10),r="int";v=new e(f.literal,d,a,g-a,v);v.dataType=r;s.push(v);a=g}else throw Error("invalid character: "+b.substring(a));}}return c};return this};b.helpers.extend(h.prototype,{isPredicate:function(){switch(this.type){case "operator":return this.value.isPredicate;
case "identifier":return!0;case "function":return!0;case "literal":return!1;default:throw Error("invalid expression type: "+this.type);}},toString:function(){if(null==this.children)return this.value.toString();var b=[];b.push("["+this.value.toString());for(var a=0;a<this.children.length;a++)b.push(" "+this.children[a].toString());b.push("]");return b.join("")}});var m=new function(){function a(b,e,s){var q;a:{if(e[0]==b.length)throw Error("premature end of expression");q=b[e[0]];switch(q.type){case f.identifier:e[0]++;
if(e[0]<b.length&&b[e[0]].matches("(")){e[0]++;var r=new h({expressionType:"function",value:q.value});d(b,q,e,r.children);q=r}else q=new h({expressionType:"identifier",value:q.value});break a;case f.literal:e[0]++;q=new h({expressionType:"literal",value:q.value,svalue:q.svalue,dataType:q.dataType});break a;case f.operator:r=q.value;if(!r.isPrefix)throw Error("invalid expression: expected beginning of term at "+q.getRemainingText());e[0]++;b:switch(r.code){case "-":case "not":q=a(b,e,1);q=new h({operator:r,
expression1:q});break b;case "(":q=a(b,e,r.precedence);if(e[0]==b.length||!b[e[0]].matches(")"))throw Error("invalid expression: expected ')' after "+b[e[0]-1].getRemainingText());e[0]++;break b;default:throw Error("internal error: bad prefix operator "+r.code);}break a;default:throw Error("internal error: bad token type "+q.type);}}for(;e[0]<b.length;){var g=b[e[0]],r=g.value instanceof c?g.value:null;if(null==r||!r.isInfix||r.precedence>s)break;e[0]++;if("in"==r.code){if(e[0]===b.length||!b[e[0]].matches("("))throw Error("invalid expression: '(' expected after "+
g.getRemainingText());e[0]++;q=new h({operator:r,expression1:q});d(b,g,e,q.children)}else if(g=a(b,e,r.precedence-1),q=new h({operator:r,expression1:q,expression2:g}),"between"==r.code){var i=b,o=e,g=q,m=r.precedence;if(o[0]==i.length||!i[o[0]].matches("and"))throw Error("invalid expression: expected 'and' after "+i[o[0]-1].getRemainingText());o[0]++;i=a(i,o,m);g.children.push(i)}if(!r.isAssociative&&r.precedence==s)break}return q}function d(b,c,f,q){if(f[0]<b.length&&b[f[0]].matches(")"))f[0]++;
else{for(;f[0]<b.length;){var r=a(b,f,e);q.push(r);if(f[0]<b.length&&b[f[0]].matches(")")){f[0]++;return}if(f[0]==b.length||!b[f[0]].matches(","))throw Error("invalid expression: expected ',' or ')' at "+b[f[0]].getRemainingText());f[0]++}throw Error("invalid function call syntax: argument missing after "+c.getRemainingText());}}var e=8;this.parse=function(c,d,s){if(null==c||0==c.length)return null;c=l.tokenize(c);c.forEach(function(a){a.type==f.identifier&&0<a.value.indexOf(".")&&b.sdata.parseField(a.value,
d,s)});var q=[0],r=a(c,q,e);if(q[0]!=c.length)throw Error("invalid expression: unexpected token at "+c[q[0]].getRemainingText());return r};return this};d.parseWhere=function(b,a,c){return m.parse(b,a,c)};d.execWhere=function(b,a){if(null==a)return!0;g(b,a);return a.property}})(e)})(jQuery);(function(b){function e(){this.init()}function f(){this.init()}b.sdatadb=b.sdatadb||{};var d=function(b,a){return!b?(a(null,!0),!1):!0};if("webkitIndexedDB"in window)window.indexedDB=window.webkitIndexedDB,window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange,window.IDBDatabaseException=window.webkitIDBDatabaseException;var c=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;if(c&&!window.IDBTransaction.READ_WRITE)window.IDBTransaction.READ_ONLY=
"readonly",window.IDBTransaction.READ_WRITE="readwrite";var a={migration:{columns:{version:{def:"version text"}}},draft:{columns:{id:{def:"id TEXT  PRIMARY KEY"},appid:{def:"appid TEXT"},original_url:{def:"original_url TEXT"},representation:{def:"representation TEXT"},data:{def:"data TEXT"},original_data:{def:"original_data TEXT"}}},sdata:{columns:{appid:{def:"appid TEXT"},url:{def:"url TEXT PRIMARY KEY"},entity_url:{def:"entity_url TEXT"},data:{def:"data TEXT"},original_data:{def:"original_data TEXT"},
status:{def:"status integer"},representation:{def:"representation TEXT"},updated:{def:"updated TEXT"},last_error:{def:"last_error TEXT"}}},apps:{columns:{id:{def:"id TEXT PRIMARY KEY"},url:{def:"url TEXT"},title:{def:"title TEXT"},description:{def:"description TEXT"},icon:{def:"icon TEXT"},baseURL:{def:"baseURL TEXT"},version:{def:"version TEXT"},data:{def:"data TEXT"}}}},i=function(b){var c=["CREATE TABLE IF NOT EXISTS"];c.push(b);c.push("(");var d=a[b].columns;Object.keys(d).forEach(function(b,
a){c.push((a?",":"")+d[b].def)});c.push(")");return c.join(" ")},h=function(a,c){var d=b.helpers.sdataSort(a.query);d&&b.helpers.applySDataSort(d,c)},g=function(a,c){return c.$modified?a.status!=b.sdata.STATUS.ORIGINAL:a.status>=b.sdata.STATUS.DELETED?!1:!0},j=function(b,a){if(a)a.$info={status:b.status,last_error:b.last_error};return a},l=function(a,c,d,e,f,g,k){if(c){if(!b.sdata.execWhere(c,e.pwhere))return k();if(e.pgroupBy){var n="",i="",a=!1;e.pgroupBy.forEach(function(a){var d=b.sdata.syncGetValue(c,
a.name);a.func&&(d=b.sdata.applyFunc(d,a.func));n=n+i+d;i="#"});d=f.indexOf(n);0>d&&(a=!0,f.push(n),d=f.length-1,g[d+""]={});b.sdata.addSelected(c,e.pselected,g[d+""],a)}else c.$info={status:a.status,last_error:a.last_error},d.push(c)}k()},m=function(a){a.appid=b.sdata.config.id;var c=b.sdata.parseSdataUri(a.url);if(0>a.url.indexOf("?appid="))a.url=a.url+"?appid="+b.sdata.config.id;delete c.id;delete c.query;a.entity_url=b.sdata.getUri(c);a.data&&(delete a.data.$info,delete a.data.$trackingId);a.status=
a.status||b.sdata.STATUS.ORIGINAL;a.updated=a.data?a.data.$updated||a.data.$updDate||(new Date).toISOString():(new Date).toISOString();a.last_error=a.last_error||"";a.representation=a.representation||""},k=function(a,c,d,e){j(c,d);delete a.query;d.$info.representation=c.representation;d.$info.url=b.sdata.getUri(a);d.$info.title=b.proto.parseExpression(e.$value,{data:b.proto.exprData(d),$prototype:e},"$value");return d},n={version:1,_createObjectStore:function(b){b.objectStoreNames.contains("draft")&&
b.deleteObjectStore("draft");b.objectStoreNames.contains("sdata")&&b.deleteObjectStore("sdata");b.objectStoreNames.contains("apps")&&b.deleteObjectStore("apps");var a=b.createObjectStore("draft",{keyPath:"id"});a.createIndex("appid","appid",{unique:!1});a.createIndex("original_url","original_url",{unique:!1});a=b.createObjectStore("sdata",{keyPath:"url"});a.createIndex("appid","appid",{unique:!1});a.createIndex("entity_url","entity_url",{unique:!1});a.createIndex("status","status",{unique:!1});a=
b.createObjectStore("apps",{keyPath:"id"});a.createIndex("url","url",{unique:!1})},_openDB:function(a){var d=!1;try{var e=c.open("sage-mge-test",n.version)}catch(f){b.helpers.pushException(f,b.smobile.locale().ui.no_db_support_sol);d||a(null,f);return}try{e.onupgradeneeded=function(b){d=!0;n._createObjectStore(b.target.result||b.target.source)}}catch(g){}e.onsuccess=function(c){var e=c.target.result||c.target.source;!e.setVersion&&n.version!=e.version?(c=e.setVersion(n.version),c.onsuccess=function(){n._createObjectStore(e);
d||a(e,void 0)},c.onerror=function(c){b.helpers.pushdbError(c);d||a(null,c)}):d||a(e,void 0)};e.onerror=function(c){b.helpers.pushdbError(c);d||a(null,c)}},_getSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c=c.get(a);c.onerror=function(b){d(null,b)};c.onsuccess=function(b){d(b.target.result)}},_rmvSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c=c["delete"](a);c.onerror=function(b){d(null,b)};c.onsuccess=function(){d(null)}},
_insertSdata:function(b,a,c){m(b);b=a.add(b);b.onerror=function(b){c(null,b)};b.onsuccess=function(){c(null)}},_updSDataByUrl:function(b,a,c,d){m(a);b=c.put(a);b.onerror=function(b){d(null,b)};b.onsuccess=function(){d(null)}},_saveDraft:function(a,c,e,f){if(d(a,f)){var g=a.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(c);g.onsuccess=function(d){if(d.target.result){var d=d.target.result,g=b.sdata.parseSdataUri(d.original_url),k=a.transaction(["sdata","draft"],IDBTransaction.READ_WRITE),
i=!1;if(g.template)i=!0,g.template=!1,g.id=d.data.$uuid;g.createActivity=!1;g.editActivity=!1;delete g.query;var g=b.sdata.getUri(g),h={url:g,representation:d.representation,data:e,original_data:d.original_data};delete d.original_data;var o=k.objectStore("sdata");n._getSDataByUrl(g,o,function(d){if(d){if(d.status===b.sdata.STATUS.DELETED)return n._deleteDraft(a,k,c,function(){f({status:404})});if(d.status===b.sdata.STATUS.ORIGINAL||d.status===b.sdata.STATUS.MODIFIED){if(d.status===b.sdata.STATUS.ORIGINAL)h.original_data=
b.extend(!0,{},d.data),h.status=b.sdata.STATUS.MODIFIED;else if(d.status===b.sdata.STATUS.MODIFIED)h.original_data=b.extend(!0,{},d.original_data),h.status=b.sdata.STATUS.MODIFIED;delete h.data.$info;delete h.data.$trackingId;if(h.original_data&&(delete h.original_data.$info,delete h.original_data.$trackingId,JSON.stringify(h.original_data)===JSON.stringify(h.data)&&(delete h.original_data,h.status=b.sdata.STATUS.ORIGINAL,!b.sdata.store(h.url))))return n._rmvSDataByUrl(h.url,o,function(){n._deleteDraft(a,
k,c,function(){f({status:200})})})}else h.status=b.sdata.STATUS.CREATED;return n._updSDataByUrl(h.url,h,o,function(){n._deleteDraft(a,k,c,function(){f({status:200})})})}i?(h.status=b.sdata.STATUS.CREATED,delete h.original_data):h.status=b.sdata.STATUS.MODIFIED;delete h.data.$info;delete h.data.$trackingId;if(h.original_data&&(delete h.original_data.$info,delete h.original_data.$trackingId,JSON.stringify(h.original_data)===JSON.stringify(h.data)))return delete h.original_data,h.status=b.sdata.STATUS.ORIGINAL,
n._deleteDraft(a,k,c,function(){f({status:404})});n._insertSdata(h,o,function(){n._deleteDraft(a,k,c,function(){f({status:200})})})})}else f({status:404})};g.onerror=function(a){b.helpers.pushdbError(a);f({status:404},a)}}},_deleteDataByDraft:function(b,a,c){if(d(b,c)){var e=b.transaction(["draft","sdata"],IDBTransaction.READ_WRITE);try{var f=e.objectStore("draft").get(a);f.onsuccess=function(d){if(d.target.result){var d=d.target.result,f=d.original_url,g=e.objectStore("sdata");n._markSdataSeleted(f,
g,d.original_data?d.original_data:d.data,function(){return n._deleteDraft(b,e,a,function(){c(null)})})}else c(null)};f.onerror=function(){c(null)}}catch(g){console.log(g)}}},_markSdataSeleted:function(a,c,d,e){var a=b.sdata.parseSdataUri(a),f=!1,g=a.query?a.query.representation:"";if(a.template)f=!0,a.template=!1,a.id=d.$uuid;delete a.query;a.createActivity=!1;a.editActivity=!1;var k=b.sdata.getUri(a);n._getSDataByUrl(k,c,function(a){if(a){if(a.status===b.sdata.STATUS.DELETED)return e(null);if(a.status===
b.sdata.STATUS.MODIFIED)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:b.sdata.STATUS.DELETED,representation:a.representation},n._updSDataByUrl(a.url,a,c,function(){return e(null)});if(a.status===b.sdata.STATUS.CREATED)return n._rmvSDataByUrl(k,c,function(){return e(null)})}else{if(f)return e(null);n._insertSdata({url:k,data:d,original_data:null,status:b.sdata.STATUS.DELETED,representation:g},c,function(){return e(null)})}})},_deleteDraft:function(a,
c,e,f){if(d(a,f)){c=c||a.transaction(["draft"],IDBTransaction.READ_WRITE);try{var g=c.objectStore("draft")["delete"](e);g.onsuccess=function(){f(null)};g.onerror=function(a){b.helpers.pushdbError(a);f(null,a)}}catch(k){b.helpers.pushdbError(k),f(null,k)}}},_uninstallDraft:function(b,a,c,d){try{var e=b.index("appid"),f=IDBKeyRange.only(c),g=e.openCursor(f);g.onsuccess=function(b){b.target.result?(b=b.target.result,b["delete"](),b["continue"]()):n._uninstallSdata(a,c,d)};g.onerror=function(){n._uninstallSdata(a,
c,d)}}catch(k){console.log(k)}},_uninstallSdata:function(b,a,c){b=b.index("appid");a=IDBKeyRange.only(a);try{var d=b.openCursor(a);d.onsuccess=function(b){b.target.result?(b=b.target.result,b["delete"](),b["continue"]()):c()};d.onerror=function(){c()}}catch(e){console.log(e)}},_updateDraft:function(b,a,c,e){if(d(b,e))try{var f=b.transaction(["draft"],IDBTransaction.READ_ONLY).objectStore("draft").get(a);f.onsuccess=function(d){if(d.target.result){var f=d.target.result;f.data=c;n._deleteDraft(b,null,
a,function(a,c){if(c)return e(null,d);var g=b.transaction(["draft"],IDBTransaction.READ_WRITE).objectStore("draft").add(f);g.onsuccess=function(){e(null)};g.onerror=function(b){e(null,b)}})}else e(null)};f.oerror=function(b){e(null,b)}}catch(g){console.log(g)}},_insertDraft:function(a,c,e,f){if(d(a,f))a=c.objectStore("draft").add(e),a.onsuccess=function(){f(e)},a.onerror=function(a){b.helpers.pushdbError(a);f(null,a)}},_getSData:function(a,c,e){if(d(a,e.success)){var f,a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata");
try{if(c.id||c.template)f=a.get(c.uri),f.onsuccess=function(b){b.target.result&&g(b.target.result,e)?e.success(j(b.target.result,b.target.result.data),{status:200}):e.success(null,{status:404})},f.onerror=function(){e.success(null,{status:404})};else if(c.entity){var k={$url:c.uri,$resources:[]},n={query:null},i=[],o={};b.extend(n,c);delete n.query;var m=b.sdata.getUri(n),p=a.index("entity_url"),t=IDBKeyRange.only(m);f=p.openCursor(t);f.onsuccess=function(b){var a=b.target.result;if(a)g(a.value,e)&&
l(a.value,a.value.data,k.$resources,c,i,o,function(){a["continue"]()});else{if(c.pgroupBy)for(var d in o)k.$resources.push(o[d]);h(c,k.$resources,e);e.success(k,{status:200})}};f.onerror=function(b){b.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?e.success(k,{status:200}):e.success("",{status:500})}}}catch(y){console.log(y)}}},_getModifiedData:function(a,c,e){if(d(a,e)){var a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),f=b.sdata.config?b.sdata.config.id:
"",g=b.sdata.entityUri(c),c=IDBKeyRange.lowerBound(b.sdata.STATUS.ORIGINAL,!0),c=a.openCursor(c),k={};c.onsuccess=function(a){if(a=a.target.result){if(a.value.appid===f&&a.value.entity_url===g){var c=a.value.data,d=b.sdata.parseSdataUri(a.value.url);k[d.id]={data:c,status:a.value.status}}a["continue"]()}else e(k)};c.onerror=function(){e(k)}}},_getSyncData:function(a,c,e){if(d(a,e)){var a=a.transaction(["sdata"],IDBTransaction.READ_ONLY).objectStore("sdata").index("status"),f=b.sdata.config?b.sdata.config.id:
"",g=IDBKeyRange.lowerBound(b.sdata.STATUS.ORIGINAL,!0);if(c){var c=a.openCursor(g),n=0;c.onsuccess=function(b){(b=b.target.result)?(b.value.appid===f&&n++,b["continue"]()):e(n)};c.onerror=function(){e(0)}}else{var h=null,c=a.openCursor(g);c.onsuccess=function(a){if(a=a.target.result){console.log(a.value.appid);if(a.value.appid===f){var c=b.sdata.parseSdataUri(a.value.url);h=h||{};var d=h[c.entity]||[];h[c.entity]=d;var g=a.value.data;k(c,a.value,g,b.sdata.config.pages[a.value.representation].$prototype);
d.push(g)}a["continue"]()}else e(h)};c.onerror=function(){e(null)}}}},_undoUpdate:function(a,c,e){if(d(a,e)){a=a.transaction(["sdata"],IDBTransaction.READ_WRITE);try{var f=a.objectStore("sdata");n._getSDataByUrl(c,f,function(a){if(a){if(!b.sdata.store(c)||a.status===b.sdata.STATUS.CREATED)return n._rmvSDataByUrl(c,f,function(){e(null)});a={appid:a.appid,url:a.url,data:a.original_data?JSON.parse(a.original_data):JSON.parse(a.data),original_data:null,status:b.sdata.STATUS.ORIGINAL,representation:a.representation};
return n._updSDataByUrl(c,a,f,function(){e(null)})}e(null)})}catch(g){console.log(g)}}},_installApp:function(a,c,e){if(d(a,e)){var f=a.transaction(["apps"],IDBTransaction.READ_WRITE).objectStore("apps"),a=f.index("url"),g=IDBKeyRange.only(c.url),a=a.openCursor(g),k=function(){var a=f.add(c);a.onerror=function(a){b.helpers.pushdbError(a);e()};a.onsuccess=function(){e()}};a.onsuccess=function(b){if(b=b.target.result){if(b.value.baseURL==c.baseURL)b["delete"]();b["continue"]()}else k()};a.onerror=function(a){a.target.errorCode==
IDBDatabaseException.NOT_FOUND_ERR?k():(b.helpers.pushdbError(a),e())}}},_removeFromDB:function(a,c,e){if(d(a,e)){var f=a.transaction(["apps","draft","sdata"],IDBTransaction.READ_WRITE),a=f.objectStore("sdata"),g=f.objectStore("draft");n._uninstallDraft(g,a,c,function(){var a=f.objectStore("apps")["delete"](c);a.onsuccess=function(){e()};a.onerror=function(a){if(a.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR)return e();b.helpers.pushdbError(a);e()}})}},_getAppConfig:function(a,c,e){if(d(a,
e))a=a.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").get(c),a.onsuccess=function(a){if(a=a.target.result){a.data.id=a.id;var c=b.extend(!0,{},a.data);c.$info={url:a.url,version:a.version,title:a.title,icon:a.icon};e(c)}else e(null)},a.onerror=function(a){b.helpers.pushdbError(a);e(null,a)}},_getInstalledApps:function(a,c,e){if(d(a,e)){var a=a.transaction(["apps"],IDBTransaction.READ_ONLY).objectStore("apps").index("url").openCursor(),f=[];a.onsuccess=function(b){if(b=b.target.result){var a=
b.value;f.push({id:a.id,url:a.url,title:a.title,description:a.description,icon:a.icon,baseURL:a.baseURL,version:a.version});b["continue"]()}else e(f)};a.onerror=function(a){a.target.errorCode!=IDBDatabaseException.NOT_FOUND_ERR&&b.helpers.pushdbError(a);e(f)}}},_delData:function(b,a,c){d(b,c)&&(b=b.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata"),n._rmvSDataByUrl(a,b,c))},_updData:function(a,c,e,f){if(d(a,f)){var g=a.transaction(["sdata"],IDBTransaction.READ_WRITE).objectStore("sdata");
e.url=c;var k=function(){return e.status===b.sdata.STATUS.ORIGINAL&&!b.sdata.store(c)?n._rmvSDataByUrl(c,g,function(b,a){f(null,a)}):n._updSDataByUrl(c,e,g,function(b,a){f(null,a)})};e.$load?(delete e.$load,n._getSDataByUrl(e.url,g,function(b){Object.keys(e).forEach(function(a){b[a]=e[a]});e=b;k()})):k()}},_initData:function(a,c,e,f){if(d(a,f.success)){var g=a.transaction(["sdata"],IDBTransaction.READ_WRITE);g.oncomplete=function(){};g.onabort=function(){};var k=!1,h=g.objectStore("sdata");if(e)return n._initData_one(a,
c,e,g,h,f);b.helpers.each(c,function(c,d,e){if(k)return e();if(f.setConfig)b.sdata.config={baseURL:c.$baseURI};return n._initData_one(a,c.value,c.data,g,h,{success:e,fail:function(){k=!0;return e()}})},function(){f.success&&f.success()})}},_initData_one:function(a,c,d,e,f,g){var k={success:function(){if(d){if(c.onlyOne)return n._addSdata(a,e,{data:d,url:c.url},f,{success:function(){g.success&&g.success()}});if(d.$resources){var k=d.$baseUrl;return b.helpers.each(d.$resources,function(c,d,g){c={data:c,
url:b.sdata.$purl(c.$url)};if(k)c.$baseURI=k;return n._addSdata(a,e,c,f,{success:function(){g()}})},function(){g.success(a)},10)}}g.success&&g.success()}},h;if(c.onlyOne)h=IDBKeyRange.only(c.url),h=f.openCursor(h);else{var i=f.index("entity_url");h=IDBKeyRange.only(c.url);h=i.openCursor(h)}h.onsuccess=function(b){(b=b.target.result)?(b["delete"](),b["continue"]()):k.success()};h.onerror=function(){k.success()}},_loadDraft:function(a,c,e){if(d(a,e)){a=a.transaction(["draft",IDBTransaction.READ_ONLY]).objectStore("draft");
try{var f=a.get(c);f.onsuccess=function(b){b.target.result?e(b.target.result):e(null)};f.onerror=function(a){b.helpers.pushdbError(a);e(null)}}catch(g){}}},_createDraft:function(a,c,e){if(d(a,e)){c.appid=b.sdata.config.id;var f=a.transaction(["draft"],IDBTransaction.READ_WRITE),g=f.objectStore("draft").index("original_url"),k=IDBKeyRange.only(c.original_url);try{var h=g.openCursor(k);h.onsuccess=function(b){if(b.target.result){b=b.target.result;if(b.value.appid===c.appid)b["delete"]();b["continue"]()}else n._insertDraft(a,
f,c,e)};h.onerror=function(b){b.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR&&n._insertDraft(a,null,c,e)}}catch(i){return b.helpers.pushdbError(i),e(null,i)}}}},o={_addSdata:function(b,a,c,e){d(b,e.success)&&(m(c),a.executeSql("INSERT INTO sdata(url, entity_url, data, original_data, sync_status, url_type, status, ui_url, ui_type, updated, last_error) values(?,?,?,?,?,?,?,?,?,?,?)",[c.url,c.entity_url,JSON.stringify(c.data),JSON.stringify(c.original_data),c.sync_status,c.url_type,c.status,
c.ui_url,c.ui_type,c.updated,c.last_error],function(){e.success()},function(){e.success()}))},_delSdata:function(b,a,c,e){d(b,e.success)&&a.executeSql("delete from sdata where url= ?",[c],function(){e.success()},function(){e.success()})},_getSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c.executeSql("SELECT * FROM sdata where url=?",[a],function(b,a){var c=a.rows;c&&c.length?(c=c.item(0),d({appid:c.appid,url:c.url,entity_url:c.entity_url,data:c.data?JSON.parse(c.data):
null,original_data:c.original_data?JSON.parse(c.original_data):null,status:c.status,representation:c.representation,updated:c.updated,last_error:c.last_error})):d(null)},function(b,a){d(null,a)})},_rmvSDataByUrl:function(a,c,d){a=0>a.indexOf("?appid=")?a+"?appid="+b.sdata.config.id:a;c.executeSql("DELETE FROM sdata where url=?",[a],function(){d(null)},function(b,a){d(null,a)})},_insertSdata:function(b,a,c){m(b);a.executeSql("INSERT INTO sdata(appid, url, entity_url, data, original_data,status, representation, updated, last_error) values(?,?,?,?,?,?,?,?,?)",
[b.appid,b.url,b.entity_url,b.data?JSON.stringify(b.data):"",b.original_data?JSON.stringify(b.original_data):"",b.status,b.representation,b.updated,b.last_error],function(){c(null)},function(b,a){c(null,a)})},_updSDataByUrl:function(b,a,c,d){m(a);c.executeSql("Update sdata set appid=?, url=?, entity_url=?, data=?, original_data=? ,status=?, representation=?, updated=?, last_error=? where url=?",[a.appid,a.url,a.entity_url,a.data?JSON.stringify(a.data):"",a.original_data?JSON.stringify(a.original_data):
"",a.status,a.representation,a.updated,a.last_error,a.url],function(){d(null)},function(b,a){d(null,a)})},_saveDraft:function(a,c,e,f){d(a,f)&&o._execOpen(a,"SELECT * FROM draft where id=?",[c],function(d,g){if(g)return b.helpers.pushdbError(g),f({status:404});if(d&&d.length){var k=d.item(0),h=k.original_url,n=k.representation,i=k.data?JSON.parse(k.data):null,m=k.original_data?JSON.parse(k.original_data):null,j=b.sdata.parseSdataUri(h);a.transaction(function(d){var g=!1;if(j.template)g=!0,j.template=
!1,j.id=i.$uuid;j.createActivity=!1;j.editActivity=!1;delete j.query;var k=b.sdata.getUri(j),h={url:k,representation:n,data:e,original_data:m};delete m;o._getSDataByUrl(k,d,function(e){if(e){if(e.status===b.sdata.STATUS.DELETED)return o._deleteDraft(a,d,c,function(){f({status:404})});if(e.status===b.sdata.STATUS.ORIGINAL||e.status===b.sdata.STATUS.MODIFIED){if(e.status===b.sdata.STATUS.ORIGINAL)h.original_data=b.extend(!0,{},e.data),h.status=b.sdata.STATUS.MODIFIED;else if(e.status===b.sdata.STATUS.MODIFIED)h.original_data=
b.extend(!0,{},e.original_data),h.status=b.sdata.STATUS.MODIFIED;delete h.data.$info;delete h.data.$trackingId;if(h.original_data&&(delete h.original_data.$info,delete h.original_data.$trackingId,JSON.stringify(h.original_data)===JSON.stringify(h.data)&&(delete h.original_data,h.status=b.sdata.STATUS.ORIGINAL,!b.sdata.store(h.url))))return o._rmvSDataByUrl(h.url,d,function(){o._deleteDraft(a,d,c,function(){f({status:200})})})}else h.status=b.sdata.STATUS.CREATED;return o._updSDataByUrl(h.url,h,d,
function(){o._deleteDraft(a,d,c,function(){f({status:200})})})}g?(h.status=b.sdata.STATUS.CREATED,delete h.original_data):h.status=b.sdata.STATUS.MODIFIED;delete h.data.$info;delete h.data.$trackingId;if(h.original_data&&(delete h.original_data.$info,delete h.original_data.$trackingId,JSON.stringify(h.original_data)===JSON.stringify(h.data)))return delete h.original_data,h.status=b.sdata.STATUS.ORIGINAL,o._deleteDraft(a,d,c,function(){f({status:404})});o._insertSdata(h,d,function(){o._deleteDraft(a,
d,c,function(){f({status:200})})})})},function(a,c){b.helpers.pushdbError(c);return f(null,c)})}else f({status:404})})},_droptables:function(a,c,e){if(d(a,e)){var f=function(c){b.helpers.each(["draft","sdata","apps"],function(b,a,d){c.executeSql("drop table if exists "+b,[],function(){d()},function(b,a){console.log(a);d()})},function(){e(a)})};c?f(c):a.transaction(f)}},_createtables:function(a,c,e){if(d(a,e)){var f=function(c){b.helpers.each(["draft","sdata","apps"],function(a,d,e){c.executeSql(i(a),
[],function(){e()},function(a,c){b.helpers.pushdbError(c);e()})},function(){e(a)})};c?f(c):a.transaction(f)}},_openDB:function(a){if(window.openDatabase){var c=function(b,a){alert(a.message)};try{var d=openDatabase("sage-mge-test","1.0","HTML 5 Database for Mobile",2E5)}catch(e){return b.helpers.pushException(e,b.smobile.locale().ui.no_db_support_sol),a(null)}if(!d)return b.helpers.pushException({message:b.smobile.locale().ui.no_db_support},b.smobile.locale().ui.no_db_support_sol),a(null);d?d.transaction(function(b){b.executeSql(i("migration"),
[],function(b){b.executeSql("select version from migration",[],function(b,e){if(e.rows&&e.rows.length){if("1"==e.rows.item(0).version)return a(d);o._droptables(d,b,function(){o._createtables(d,b,function(){b.executeSql("update migration set version=?",["1"],function(){return a(d)},c)})})}else b.executeSql("insert into migration (version) values (?)",[1],function(b){o._createtables(d,b,a)},c)},c)},c)}):alert("Failed to open the database on disk.  This is probably because the version was bad or there is not enough space left in this domain's quota")}},
_execOpen:function(a,c,e,f){if(d(a,f)){var g=function(a,c){b.helpers.pushdbError(c);f(null,!0)};a.readTransaction(function(b){b.executeSql(c,e,function(b,a){f(a.rows)},g)},g)}},_execSQL:function(a,c,d,e,f){var g=f.fail;f.fail=function(a,c){b.helpers.pushdbError(c);g&&g()};var k=function(a,c){b.helpers.pushdbError(c);g&&g()};c?c.executeSql(d,e,function(){f.success()},f.fail):a.transaction(function(b){b.executeSql(d,e,function(){f.success()},f.fail)},k)},_insertDraft:function(b,a,c,e){d(b,e)&&o._execSQL(b,
a,"INSERT INTO draft (id, appid, original_url, representation, original_data,  data) values(?,?,?,?,?,?)",[c.id,c.appid,c.original_url,c.representation,c.original_data?JSON.stringify(c.original_data):"",JSON.stringify(c.data)],{success:function(){e(c)}})},_deleteDraft:function(b,a,c,e){d(b,e)&&o._execSQL(b,a,"DELETE from draft where id=?",[c],{success:function(){e(null)},fail:function(){e(null)}})},_markSdataSeleted:function(a,c,d,e){var a=b.sdata.parseSdataUri(a),f=!1,g=a.query?a.query.representation:
"";if(a.template)f=!0,a.template=!1,a.id=d.$uuid;delete a.query;a.createActivity=!1;a.editActivity=!1;var k=b.sdata.getUri(a);o._getSDataByUrl(k,c,function(a){if(a){if(a.status===b.sdata.STATUS.DELETED)return e(null);if(a.status===b.sdata.STATUS.MODIFIED)return a={appid:a.appid,url:a.url,data:a.original_data?a.original_data:a.data,original_data:null,status:b.sdata.STATUS.DELETED,representation:a.representation},o._updSDataByUrl(a.url,a,c,function(){return e(null)});if(a.status===b.sdata.STATUS.CREATED)return o._rmvSDataByUrl(k,
c,function(){return e(null)})}else{if(f)return e(null);o._insertSdata({url:k,data:d,original_data:null,status:b.sdata.STATUS.DELETED,representation:g},c,function(){return e(null)})}})},_deleteDataByDraft:function(a,c,e){if(d(a,e)){var f=function(a,c){b.helpers.pushdbError(c);e(null,c)};a.transaction(function(b){b.executeSql("SELECT * FROM draft where id=?",[c],function(b,d){if(d&&d.rows&&d.rows.length){var f=d.rows.item(0),g=f.original_url,k=f.data?JSON.parse(f.data):null,f=f.original_data?JSON.parse(f.original_data):
null;o._markSdataSeleted(g,b,f?f:k,function(){return o._deleteDraft(a,b,c,function(){e(null)})})}else e(null)},f)},f)}},_createDraft:function(a,c,e){if(d(a,e))c.appid=b.sdata.config.id,a.transaction(function(b){o._execSQL(a,b,"DELETE from draft where original_url=? and appid=?",[c.original_url,c.appid],{success:function(){o._insertDraft(a,b,c,e)},fail:function(){o._insertDraft(a,b,c,e)}})},function(a,c){b.helpers.pushdbError(c);e(null,c)})},_updateDraft:function(b,a,c,e){d(b,e)&&o._execSQL(b,null,
"UPDATE draft set data=? where id=?",[JSON.stringify(c),a],{success:e})},_getSData:function(a,c,e){if(d(a,e.success))try{if(c.id||c.template)o._execOpen(a,"SELECT * FROM sdata where url=?",[c.uri],function(b,a){if(a)return e.success(null,{status:404});if(b.length&&g(b.item(0),e)){var c=b.item(0);e.success(j(c,JSON.parse(c.data)),{status:200})}else e.success(null,{status:404})});else if(c.entity){var f={$url:c.uri,$resources:[]},k={query:null},n=[],i={};b.extend(k,c);delete k.query;var m=b.sdata.getUri(k);
o._execOpen(a,"SELECT * FROM sdata where entity_url=?",[m],function(a,d){if(d)return e.success(f,{status:404});a.length?b.helpers.each(Array(a.length),function(b,d,k){b=a.item(d);return g(b,e)?l(b,JSON.parse(b.data),f.$resources,c,n,i,function(){k()}):k()},function(){if(c.pgroupBy)for(var b in i)f.$resources.push(i[b]);h(c,f.$resources,e);e.success(f,{status:200})}):e.success(f,{status:200})})}}catch(p){console.log(p)}},_loadDraft:function(b,a,c){d(b,c)&&o._execOpen(b,"SELECT * FROM draft where id=?",
[a],function(b,a){if(a)return c(null);if(b.length){var d=b.item(0);c({appid:d.appid,id:d.id,original_url:d.original_url,data:JSON.parse(d.data)})}else c(null)})},_getModifiedData:function(a,c,e){if(d(a,e)){var f={},c=b.sdata.entityUri(c);o._execOpen(a,"SELECT * FROM sdata where status > ? and appid = ? and entity_url = ?",[b.sdata.STATUS.ORIGINAL,b.sdata.config?b.sdata.config.id:"",c],function(a,c){if(c)return e(f);if(a&&a.length)for(var d=0,g=a.length;d<g;d++){var k=a.item(d),h=JSON.parse(k.data),
n=b.sdata.parseSdataUri(k.url);f[n.id]={data:h,status:k.status}}e(f)})}},_getSyncData:function(a,c,e){if(d(a,e)){var f=null,g=b.sdata.config?b.sdata.config.id:"";c?o._execOpen(a,"SELECT count(*) as sync FROM sdata where status > ? and appid = ?",[b.sdata.STATUS.ORIGINAL,g],function(b,a){if(a)return e(0);b&&b.length?e(b.item(0).sync):e(0)}):o._execOpen(a,"SELECT * FROM sdata where status > ? and appid = ?",[b.sdata.STATUS.ORIGINAL,g],function(a,c){if(c)return e(null);if(a&&a.length){for(var d=0,g=
a.length;d<g;d++){var h=a.item(d);f=f||{};var n=b.sdata.parseSdataUri(h.url),i=f[n.entity]||[];f[n.entity]=i;var o=JSON.parse(h.data);k(n,h,o,b.sdata.config.pages[h.representation].$prototype);i.push(o)}e(f)}else e(null)})}},_delData:function(b,a,c){d(b,c)&&b.transaction(function(b){return o._rmvSDataByUrl(a,b,c)})},_installApp:function(a,c,e){d(a,e)&&a.transaction(function(a){var d=function(){a.executeSql("INSERT INTO apps(id, url, title, description, icon, baseURL, version, data) values(?,?,?,?,?,?,?,?)",
[c.id,c.url,c.title,c.description,c.icon,c.baseURL,c.version,JSON.stringify(c.data)],function(){e()},function(a,c){b.helpers.pushdbError(c);e()})};a.executeSql("delete from apps where url=? and baseURL= ?",[c.url,c.baseURL],function(){d()},function(){d()})})},_removeFromDB:function(a,c,e){d(a,e)&&a.transaction(function(b){var d=function(){return o._execSQL(a,b,"DELETE from apps where id=?",[c],{success:function(){e()},fail:function(){e()}})},f=function(){return o._execSQL(a,b,"DELETE from draft where appid=?",
[c],{success:function(){d()},fail:function(){d()}})};return o._execSQL(a,b,"DELETE from sdata where appid=?",[c],{success:function(){f()},fail:function(){f()}})},function(a,c){b.helpers.pushdbError(c);return e()})},_getAppConfig:function(b,a,c){d(b,c)&&o._execOpen(b,"SELECT * FROM apps where id=?",[a],function(b,a){a&&c(null);if(b&&b.length){var d=b.item(0),e=null;try{e=JSON.parse(d.data)}catch(f){}e=e||{};e.id=d.id;e.$info={url:d.url,version:d.version,title:d.title,icon:d.icon};c(e)}else c(null)})},
_getInstalledApps:function(b,a,c){if(d(b,c)){var e=[];o._execOpen(b,"SELECT * FROM apps ORDER BY url",[],function(b,a){if(a)return c(e);if(b&&b.length)for(var d=0,f=b.length;d<f;d++){var g=b.item(d);e.push({id:g.id,url:g.url,title:g.title,description:g.description,icon:g.icon,baseURL:g.baseURL,version:g.version})}c(e)})}},_undoUpdate:function(a,c,e){d(a,e)&&a.transaction(function(a){o._getSDataByUrl(c,a,function(d){if(d)return!b.sdata.store(c)||d.status===b.sdata.STATUS.CREATED?o._rmvSDataByUrl(c,
a,function(){e(null)}):o._updSDataByUrl(c,{appid:d.appid,url:d.url,data:d.original_data?d.original_data:d.data,original_data:null,status:b.sdata.STATUS.ORIGINAL,representation:d.representation},a,function(){e(null)});e(null)})})},_updData:function(a,c,e,f){d(a,f)&&a.transaction(function(a){e.url=c;var d=function(){return e.status===b.sdata.STATUS.ORIGINAL&&!b.sdata.store(c)?o._rmvSDataByUrl(c,a,function(b,a){f(null,a)}):o._updSDataByUrl(c,e,a,function(b,a){f(null,a)})};e.$load?(delete e.$load,o._getSDataByUrl(e.url,
a,function(b){Object.keys(e).forEach(function(a){b[a]=e[a]});e=b;d()})):d()})},_initData:function(a,c,e,f){if(d(a,f.success)){if(!f.fail)f.fail=f.success;a.transaction(function(d){if(e)return o._initData_one(a,c,e,d,f);var g=!1;b.helpers.each(c,function(c,e,k){if(g)return k();if(f.setConfig)b.sdata.config={baseURL:c.$baseURI};return o._initData_one(a,c.value,c.data,d,{success:k,fail:function(){g=!0;return k()}})},function(){f.success&&f.success()})},f.fail)}},_initData_one:function(a,c,d,e,f){var g=
{success:function(){if(d){if(c.onlyOne)return o._addSdata(a,e,{data:d,url:c.url},{success:function(){f.success&&f.success()}});if(d.$resources)return b.helpers.each(d.$resources,function(c,d,f){return o._addSdata(a,e,{data:c,url:b.sdata.$purl(c.$url)},{success:function(){f()}})},function(){f.success()})}else f.success()},fail:function(){f.fail()}};return c.onlyOne?o._delSdata(a,e,c.url,g):e.executeSql("delete from sdata where entity_url= ?",[c.url],g.success,g.fail)}};e.prototype={init:function(){},
check:function(a,c){var d=this;if(c)return n._openDB(function(c){c||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(c)});d.db?a(d.db):n._openDB(function(c){d.db=c;d.db||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(d.db)})},createDraft:function(b,a){this.check(function(c){n._createDraft(c,b,a)})},updateDraft:function(b,a,c){this.check(function(d){n._updateDraft(d,b,a,c)})},deleteDraft:function(b,a){this.check(function(c){n._deleteDraft(c,null,b,a)})},
deleteDataByDraft:function(b,a){this.check(function(c){n._deleteDataByDraft(c,b,a)})},saveDraft:function(b,a,c){this.check(function(d){n._saveDraft(d,b,a,c)})},loadDraft:function(b,a){this.check(function(c){n._loadDraft(c,b,a)})},getSData:function(b,a){this.check(function(c){n._getSData(c,b,a)})},initData:function(b,a,c){this.check(function(d){n._initData(d,b,a,c)})},delData:function(b,a){this.check(function(c){n._delData(c,b,a)})},undoUpdate:function(b,a){this.check(function(c){n._undoUpdate(c,b,
a)})},installApp:function(b,a){this.check(function(c){n._installApp(c,b,a)})},removeFromDB:function(b,a){this.check(function(c){n._removeFromDB(c,b,a)})},getAppConfig:function(b,a){this.check(function(c){n._getAppConfig(c,b,a)})},getInstalledApps:function(b,a){this.check(function(c){n._getInstalledApps(c,b,a)})},getSyncData:function(b){this.check(function(a){n._getSyncData(a,!1,b)})},getModifiedData:function(b,a){this.check(function(c){n._getModifiedData(c,b,a)})},getSyncCount:function(b){this.check(function(a){n._getSyncData(a,
!0,b)})},updData:function(b,a,c){this.check(function(d){n._updData(d,b,a,c)})}};f.prototype={init:function(){},check:function(a,c){var d=this;if(c)return o._openDB(function(c){c||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(c)});d.db?a(d.db):o._openDB(function(c){d.db=c;d.db||b.helpers.pushdbError({message:b.smobile.locale().ui.open_db_error});a(d.db)})},createDraft:function(b,a){this.check(function(c){o._createDraft(c,b,a)})},updateDraft:function(b,a,c){this.check(function(d){o._updateDraft(d,
b,a,c)})},deleteDraft:function(b,a){this.check(function(c){o._deleteDraft(c,null,b,a)})},deleteDataByDraft:function(b,a){this.check(function(c){o._deleteDataByDraft(c,b,a)})},saveDraft:function(b,a,c){this.check(function(d){o._saveDraft(d,b,a,c)})},loadDraft:function(b,a){this.check(function(c){o._loadDraft(c,b,a)})},getSData:function(b,a){this.check(function(c){o._getSData(c,b,a)})},initData:function(b,a,c){this.check(function(d){o._initData(d,b,a,c)})},delData:function(b,a){this.check(function(c){o._delData(c,
b,a)})},undoUpdate:function(b,a){this.check(function(c){o._undoUpdate(c,b,a)})},getInstalledApps:function(b,a){this.check(function(c){o._getInstalledApps(c,b,a)})},installApp:function(b,a){this.check(function(c){o._installApp(c,b,a)})},removeFromDB:function(b,a){this.check(function(c){o._removeFromDB(c,b,a)})},getAppConfig:function(b,a){this.check(function(c){o._getAppConfig(c,b,a)})},getSyncData:function(b){this.check(function(a){o._getSyncData(a,!1,b)})},getSyncCount:function(b){this.check(function(a){o._getSyncData(a,
!0,b)})},getModifiedData:function(b,a){this.check(function(c){o._getModifiedData(c,b,a)})},updData:function(b,a,c){this.check(function(d){o._updData(d,b,a,c)})}};if(c&&!window.openDatabase){var t=new e;b.sdata.createDraft=function(a,c){b.sdata.useCacheCount=!1;t.createDraft(a,c)};b.sdata.updateDraft=function(a,c,d){b.sdata.useCacheCount=!1;d||(d=function(){});t.updateDraft(a,c,d)};b.sdata.loadDraft=function(b,a){t.loadDraft(b,a)};b.sdata.deleteDraft=function(a,c){b.sdata.useCacheCount=!1;t.deleteDraft(a,
c)};b.sdata.saveDraft=function(a,c,d){b.sdata.useCacheCount=!1;t.saveDraft(a,c,d)};b.sdata.getSData=function(b,a){t.getSData(b,a)};b.sdata.initData=function(a,c,d){b.sdata.useCacheCount=!1;t.initData(a,c,d)};b.sdata.updData=function(a,c,d){b.sdata.useCacheCount=!1;t.updData(a,c,d)};b.sdata.delData=function(a,c){b.sdata.useCacheCount=!1;t.delData(a,c)};b.sdata.deleteDataByDraft=function(a,c){b.sdata.useCacheCount=!1;t.deleteDataByDraft(a,c)};b.sdata.getSyncData=function(a){t.getSyncData(a)};b.sdata.getSyncDataCount=
function(a){t.getSyncCount(a)};b.sdata.getModifiedData=function(a,b){t.getModifiedData(a,b)};b.sdata.undoUpdate=function(a,c){b.sdata.useCacheCount=!1;t.undoUpdate(a,c)};b.sdata.getInstalledApps=function(a,b){t.getInstalledApps(a,b)};b.sdata.installApp=function(a,b){t.installApp(a,b)};b.sdata.getAppConfig=function(a,b){t.getAppConfig(a,b)};b.sdata.removeFromDB=function(a,b){t.removeFromDB(a,b)}}else if(window.openDatabase){var p=new f;b.sdata.createDraft=function(a,c){b.sdata.useCacheCount=!1;p.createDraft(a,
c)};b.sdata.updateDraft=function(a,c,d){b.sdata.useCacheCount=!1;d||(d=function(){});p.updateDraft(a,c,d)};b.sdata.loadDraft=function(a,b){p.loadDraft(a,b)};b.sdata.deleteDraft=function(a,c){b.sdata.useCacheCount=!1;p.deleteDraft(a,c)};b.sdata.saveDraft=function(a,c,d){b.sdata.useCacheCount=!1;p.saveDraft(a,c,d)};b.sdata.getSData=function(a,b){p.getSData(a,b)};b.sdata.initData=function(a,c,d){b.sdata.useCacheCount=!1;p.initData(a,c,d)};b.sdata.updData=function(a,c,d){b.sdata.useCacheCount=!1;p.updData(a,
c,d)};b.sdata.delData=function(a,c){b.sdata.useCacheCount=!1;p.delData(a,c)};b.sdata.deleteDataByDraft=function(a,c){b.sdata.useCacheCount=!1;p.deleteDataByDraft(a,c)};b.sdata.getSyncData=function(a){p.getSyncData(a)};b.sdata.getSyncDataCount=function(a){p.getSyncCount(a)};b.sdata.getModifiedData=function(a,b){p.getModifiedData(a,b)};b.sdata.undoUpdate=function(a,c){b.sdata.useCacheCount=!1;p.undoUpdate(a,c)};b.sdata.getInstalledApps=function(a,b){p.getInstalledApps(a,b)};b.sdata.installApp=function(a,
b){p.installApp(a,b)};b.sdata.getAppConfig=function(a,b){p.getAppConfig(a,b)};b.sdata.removeFromDB=function(a,b){p.removeFromDB(a,b)}}})(jQuery);(function(b){var e=b.smobile||{},f=/([^&=;]*)=?([^&;]*)/g;e._uiCache={};e.PAGES={start:{ui:"start.$static",useAppId:!1,db:!1,addBack:!1},errors:{ui:"errors.$static",useAppId:1,db:!1,addBack:!0},home:{ui:"home.$static",useAppId:2,isHome:!0,db:!0,addBack:!0,cache:!0},about:{ui:"about.$static",useAppId:!1,db:!1,addBack:!0,home:!0},send:{ui:"send.$static",useAppId:2,home:!0,addBack:!0},page:{useAppId:2,db:!0,addBack:!0,home:!0},dialog:{useAppId:1,db:!0,addBack:!0,home:!1},apps:{ui:"applications.$static",
useAppId:0,db:!1,addBack:!0,home:!0}};Object.keys(e.PAGES).forEach(function(a){e.PAGES[a].id=a});e.mainFooter=function(){return"mainfooter"};e.pageIsDialog=function(a){return"dialog"===a.attr("data-"+b.mobile.ns+"role")};e.pageController=function(a){return b.jqmData(a[0],"controller")};e.pageIsDetail=function(a){return"detail"===b.jqmData(a[0],"detail")};e.hash_sep="-";b.smobile=e;e.CONSTS={error_json:"error"};e.PAGES.start.enhanceHandler=function(a,c){var d=a&&a.content&&a.content.menu&&a.content.menu.data&&
a.content.menu.data.items?a.content.menu.data.items:null;if(!d)return c(a);b.sdata.getInstalledApps(!1,function(f){var g=e.locale();f&&f.length?f.forEach(function(a){d.push({data:{title:a.title,description:a.description,icon:a.icon,hash:e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(a.id)}})}):(d.push({data:{title:g.applicationmanager.title,divider:!0}}),d.push({data:{title:g.applicationmanager.title,description:g.applicationmanager.description,icon:"menu.appmanager",hash:e.PAGES.apps.id}}));
c(a)})};e.PAGES.apps.enhanceHandler=function(a,b){var c=e.locale();if(a)a.$title=c.applicationmanager.title;b(a)};e.linkDetailPage=function(a){return a.applicationId?e.PAGES.page.id+e.hash_sep+b.helpers.encodeURIComponent(a.applicationId):e.PAGES.page.id};var d=function(a){if(a.representation){var b=a.representation.split(".");if(2<=b.length)a.representation=b[0],a.facet=b[1]}},c=function(a){var c={},a=b.helpers.decodeJsmQuery(a),e=a.indexOf("?");0<e&&a.substring(e+1).replace(f,function(a,b,d){b&&
(c[b]=decodeURIComponent(d))});if(c.url&&(c.dataurl="",e=c.url.indexOf("?"),0<=e))c.dataurl=c.url.substr(0,e),a=c.url.substr(e+1),a.replace(f,function(a,b,d){b&&(c[b]=decodeURIComponent(d))});d(c);return c},a=function(a){if(!a)return null;var c=0>a.indexOf("="),a="#"===a[0]?a.substring(1):a,c=a.indexOf(c?b.helpers.encodeJsmQuery("?"):"?");0<c&&(a=a.substring(0,c));var d={page:null},c=a.indexOf(e.hash_sep);if(0<c){if(d.page=e.PAGES[a.substring(0,c)],d.application=decodeURIComponent(a.substr(c+1)),
36<d.application.length)d.pageId=d.application.substr(37),d.application=d.application.substr(0,36)}else d.page=e.PAGES[a],d.application="";if(!d.page||2===d.page.useAppId&&!d.application)return null;if(1===d.page.useAppId&&!d.application)d.application=b.sdata.config?b.sdata.config.id:"";if(!d.pageId)d.pageId=b.helpers.uuid();d.pageName=d.page.id+(d.application?e.hash_sep+b.helpers.encodeURIComponent(d.application):"");d.domid=e.PAGES.home.id===d.page.id?d.application:d.pageId;d.longPageName=e.PAGES.home.id===
d.page.id?d.pageName:d.page.id+(d.application?e.hash_sep+b.helpers.encodeURIComponent(d.application+"-"+d.pageId):"");return d};e.ACTIONS={"action-cancel":{name:"action-cancel",execute:function(a,c){b.sdata.undoUpdate(a.url,function(){b.sdata.getSyncDataCount(function(a){a?c(!0):(e.doBack(null),c(!1))})})}}};var i=function(a,b){a.before&&b.push(a.before);a.html&&b.push(a.html);a.childs&&a.childs.forEach(function(a){i(a,b)});a.after&&b.push(a.after)},h=function(a){for(var b in a)if("ErrorView"===a[b].uiClass)return!0;
return!1},g=function(a,c,d,e){b.helpers.each(Object.keys(c),function(e,f,g){var h=c[e],f=d[h.parent]||d.root;h.id=a.prefix+e;if(h.layout)return f=b.smobile.addLayout.apply(a,[f,h]),d[e]=f,f.childs&&f.childs.length&&f.childs.forEach(function(a){d[a.id]=a}),g();if(h.uiClass)b.smobile.addControl.apply(a,[f,h,function(b){b&&Array.isArray(b)?b.forEach(function(b){d[e+b.scid]=b;(b.bind||b.action)&&a.registerControl({id:h.id+b.scid,bind:b.bind,action:b.action,options:b.options,uiClass:b.uiClass,refresh:b.refresh})}):
b&&(d[e]=b,(b.bind||b.action)&&a.registerControl({id:h.id,bind:b.bind,action:b.action,options:b.options,uiClass:h.uiClass,refresh:b.refresh}));g()}]);else return g()},e)};e._loadStaticUI=function(a){return e.staticui[a]()};var j=function(c,d){var f=b.helpers.encodeURIComponent("?url="+b.helpers.encodeURIComponent(c)),g=a("#"+e.PAGES.dialog.id);return m(f,g,function(a,b){b&&delete b.footer;d(a,b)})},l={menu2link:function(a,b){if("$representation"==a.linkType)b.entity=a.entity,b.representation=a.representation,
b.facet=a.facet||"$query"},representation2ui:function(a,c){var d={};if("$dashboard"==a.facet)d={content:{menu:{uiClass:"MainMenu",data:{items:[]}}}},c.forEach(function(a){var b={title:a.title,description:a.description,icon:a.icon};l.menu2link(a,b);d.content.menu.data.items.push({data:b})}),d.$facet="$dashboard";else if("$query"===a.facet||"$lookup"===a.facet){d={content:{items:{uiClass:"SDataList",data:{bind:"$resources"}}}};if("$lookup"===a.facet)d.options={detail:!0},d.content.items.data.$lookup=
1;if(c&&c.$prototype&&c.$prototype.$title)d.$title=b.proto.parseExpression(c.$prototype.$title,{data:null,$prototype:c.$prototype},"$title");d.$page=a.representation+"."+a.facet;d.$facet=a.facet;d.$representation=a.representation}else if("$details"==a.facet||"$edit"==a.facet||"$create"==a.facet){var d={content:{}},e={};if(c.$article||c.$prototype.$article)b.proto.layoutParser(e,c.$article||c.$prototype.$article,"$article",[c.$prototype]);b.proto.generateForm(e,0,d.content,"",!1,a.facet);if(c&&c.$prototype&&
c.$prototype.$title)d.$title=b.proto.parseExpression(c.$prototype.$title,{data:null,$prototype:c.$prototype},"$title");d.$page=a.representation+"."+a.facet;d.$facet=a.facet;d.$representation=a.representation}else d=c;return d},getCtxItems:function(a,c,d,f){d={exclude:!1,items:[]};if(c=b.sdata.config.pages[c+"."+a])if("$details"===a)c.$prototype.$links.$edit&&!c.$prototype.$links.$edit.$isHidden&&(a=b.proto.parseExpression(c.$prototype.$links.$edit.$url,{data:null,$prototype:c.$prototype},"$url"),
a=b.sdata.parseSdataUri(a),a.query&&a.query.representation&&b.sdata.config.pages[a.query.representation]&&d.items.push({title:e.locale().ui.edit_item,icon:"edit",url:c.$prototype.$links.$edit.$url,bind:!0}));else if(("$edit"===a||"$create"===a)&&f&&f.url)b.sdata.parseSdataUri(f.url),d.exclude=!0,d.items=[{title:e.locale().ui.cancel_item,action:"cancel",jmdata:{"data-icon":"refresh","data-transition":"none"}},{title:e.locale().ui.remove_item,action:"delete",jmdata:{"data-icon":"delete","data-transition":"none"}},
{title:e.locale().ui.save_item,action:"save",jmdata:{"data-icon":"check","data-transition":"none"}}];return d},concatItems:function(a,b,c){if(a.exclude)return a.items||[];a.items=a.items||[];return a.items.concat(c,b)},enhanceFooter:function(a,c,d,e,f){if(!a.footer){if((a.footer=c)&&a&&a.$facet&&b.sdata.config){if("$query"===a.$facet||"$lookup"===a.$facet){a.footer.footer.data.items=c.footer.data.items=[{type:"previous"},{type:"home"},{type:"next"}];return}var e=c.footer.data.items,g=b.sdata.config.footer,
a=l.getCtxItems(a.$facet,a.$representation,f,d);c.footer.data.items=l.concatItems(a,e,g)}for(;4<c.footer.data.items.length;)c.footer.data.items.pop()}}};e.detailUiData=function(a,b,c,d){a={};a.uiData=l.representation2ui({facet:"$edit",representation:"x-object"},{$prototype:b,$article:{$items:d}});a.uiData.$prototype=b;return a};var m=function(a,f,g){var h={},i=c(a,f.pageName);if(!i.representation&&f.page.ui)i.representation=f.page.ui,d(i);if(!i.representation)return g("",null,null);var m=function(a){if(f.page.db){var c=
null,d=i.representation;if(f.page.isHome)i.representation=b.sdata.config.home,d=i.representation,i.facet="$dashboard";if("$dashboard"==i.facet)c=b.sdata.config.dashboards;else if(i.facet)d=i.representation+"."+i.facet,c=b.sdata.config.pages;if(c&&c[d])if(h=c[d],h=l.representation2ui(i,h)){l.enhanceFooter(h,a,i,f.page);if(f.page.isHome)h.$title=b.sdata.config.title;if(f.page.enhanceHandler)f.page.enhanceHandler(h,function(a){return g(d,a,null)});else return g(d,h,null)}else return g("",null,null);
else return g("",null,null)}else{c=e._loadStaticUI(i.representation);if(!c)return g(i.representation,h,null);h=c;l.enhanceFooter(h,a,i,f.page);if(f.page.enhanceHandler)f.page.enhanceHandler(h,function(a){return g(i.representation,a,null)});else return g(i.representation,h,null)}};(function(){var a=null;2==f.page.useAppId&&(!b.sdata.config||b.sdata.config.id!=f.application)?b.sdata.getAppConfig(f.application,function(c){b.sdata.config=c;if(!b.sdata.config)return g("",null,{action:"start"});b.sdata.config.pages&&
Object.keys(b.sdata.config.pages).forEach(function(a){a=b.sdata.config.pages[a];a.$prototype&&b.proto.linkParents(a.$prototype,null)});a=e.staticui.appFooter();m(a)}):(f.page.useAppId?a=e.staticui.appFooter():(delete b.sdata.config,b.sdata.useCacheCount=!1,a=e._loadStaticUI(e.mainFooter())),m(a))})()};e.removePage=function(a){var c=b.jqmData(a,"controller");console.log("Remove page"+(c?": "+c.pageInfo.page.id+"-"+(c.pageInfo.pageId||""):""));a=b(a);c&&c.remove();b.removeWithDependents(a)};e.removeAllPages=
function(a){a=a||[];a.push("page-template");var c=b('div[data-role="page"]');if(c&&c.length)for(var d=c.length,f;d--;)f=c[d],0>a.indexOf(f.id)&&e.removePage(f)};e.hashOfUrl=function(a){var b=a.indexOf("#");return 0<=b?a.substring(b):""};e.pageName=a;e.actionName=function(a){if(!a)return null;for(var b=Object.keys(e.ACTIONS),c=b.length;c--;){var d=b[c],f=a.indexOf(d);if(0===f||1===f)return e.ACTIONS[d]}return null};e.loadPage=function(a,b,c){m(a,b,c)};e.loadDialog=function(a,b){j(a,b)};e.execAction=
function(a,b,d){a=c(a,b.name);return b.execute(a,d)};e.buildPage=function(a,c,d,f,m,j,l,r,v){var C=d[0],z={root:{before:"",after:"",childs:[]}},w=null,A={root:{before:"",after:"",childs:[]}},B={root:{before:"",after:"",childs:[]}};c&&c[0]&&(w=b.jqmData(c[0],"controller"));if(j.url)j.url=b.sdata.parseSdataUri(j.url);d.uiController({id:a,ui:a,entity:j.entity,inCreate:j.$createActivity,page:l,url:j.url});var u=b.jqmData(C,"controller");u.pageInfo=l;if(2===l.page.useAppId)u.applicationId=l.application,
u.homeRef="#"+e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(u.applicationId);else if(!1==l.page.useAppId)u.applicationId="",u.homeRef="#"+e.PAGES.start.id;if(f.$page)u.page=f.$page,delete f.$page;u.data=m||{};u.pageOptions=f.options||{};if(u.pageOptions.detail&&w&&(u.parent=w,w.child=u,u.applicationId=w.applicationId,f.$prototype))u.detailpagedata={$prototype:f.$prototype};var x=d.children(":jqmData(role=header)"),y=d.children(":jqmData(role=content)").children(".content-primary"),D=d.children(":jqmData(sagerole=footer)");
f.header=f.header||{title:{uiClass:"Html",data:{html:"<h1></h1>"}}};f.footer=f.footer||{};f.content=f.content||{};g(u,f.footer,B,function(){g(u,f.header,A,function(){h(f.content)?u.hasErrorView=!0:b.helpers.clearErrors();g(u,f.content,z,function(){var a=[],c;i(A.root,a);x.html(a.join(""));(a=x.find("h1"))&&a.length&&(c=f.$title||(u.data?u.data.$title:"")||"");c&&a.html(c);l&&l.page&&l.page.home?x.append('<a href="'+(u.homeRef?u.homeRef:l.page.home)+'" data-'+b.mobile.ns+'icon="home" data-'+b.mobile.ns+
'iconpos="notext" data-'+b.mobile.ns+'direction="reverse" class="ui-btn-right jqm-home">'+e.locale().maintoolbar.home+"</a>"):l&&l.page&&l.page.id==e.PAGES.home.id&&x.append('<a href="#'+e.PAGES.start.id+'" data-'+b.mobile.ns+'icon="gear" data-'+b.mobile.ns+'iconpos="notext" data-direction="reverse" class="ui-btn-right jqm-home">'+e.locale().ui.root_menu_tip+"</a>");a=[];i(z.root,a);y.html(a.join(""));a=[];i(B.root,a);D.html(a.join(""));u.pageOptions.dialog?(d.removeAttr("data-"+b.mobile.ns+"role"),
d.attr("data-"+b.mobile.ns+"role","dialog"),u.pageOptions.detail=!1):u.pageOptions.detail&&b.jqmData(d[0],"detail","detail");if(f.actions)for(var g in f.actions)u["action"+g]=f.actions[g];r?d.insertBefore(r):d.appendTo(b("body"));v()})})})};e.refreshPage=function(){return b.mobile.changePage(window.location.hash,{allowSamePageTransition:!0,transition:"none"})};e.goHome=function(a,c){var d="#"+e.PAGES.start.id;if(a&&a.applicationId)c=a.applicationId;c&&(d="#"+e.PAGES.home.id+e.hash_sep+b.helpers.encodeURIComponent(c));
b.mobile.changePage(d,{allowSamePageTransition:!0,reverse:!0})};e.doBack=function(){b.mobile.back()};e.showErrors=function(a){if(a&&a.hasErrorView)return e.refreshPage();b.mobile.changePage("#errors",{allowSamePageTransition:!0})};e.createPage=function(a){var c=b("#page-template"),d=c.clone().attr("data-"+b.mobile.ns+"url",a.pageName).attr("id",a.domid);a.page.addBack&&d.attr("data-"+b.mobile.ns+"add-back-btn","true");return{$page:d,$template:c}};e.createDialog=function(c,d){var f=a("#dialog"),g=
e.createPage(f),h={transition:"pop",role:"dialog",changeHash:!0};b.smobile.buildPage("dialog",b.mobile.activePage,g.$page,c,d,{$createActivity:!0},f,g.$template,function(){var a=b.jqmData(g.$page[0],"controller");if(c.actions)a.pageActions=c.actions,delete c.actions;b.mobile.changePage(g.$page,h);a.bindData()})};e.createDetail=function(c,d,f){c.options=c.options||{};c.options.detail=!0;var g=a(f?"#page-"+f.applicationId+"-"+b.helpers.uuid():"#dialog"),h=e.createPage(g);h.$page.attr("data-url","#"+
g.longPageName);var i={transition:"slide",changeHash:!0};b.smobile.buildPage("dialog",b.mobile.activePage,h.$page,c,d,{$createActivity:!0},g,h.$template,function(){var a=b.jqmData(h.$page[0],"controller");if(f)a.options.url=f.options.url;if(c.actions)a.pageActions=c.actions,delete c.actions;b.mobile.changePage(h.$page,i);a.bindData()})};e.showError=function(a,c){b("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1>"+(c||b.mobile.pageLoadErrorMessage)+"</h1></div>").css({display:"block",
opacity:0.96,top:b(window).scrollTop()+100}).appendTo(a.pageContainer||document.body).delay(800).fadeOut(1E3,function(){b(this).remove()})};e.silentAction=function(a){"start"===a.action&&e.goHome(null)};e.addLayout=function(){return null};e.addControl=function(a,b,c){c()};e.setEvents=function(){return null};e.parseURL=function(a,d,f){var g={method:"GET"},h=c(a.search||a.hash,d.pageName),i=a.domain+a.pathname+(b.helpers.hashFirst()?"#"+d.longPageName:"");if(!h.representation&&d.page.ui)h.representation=
d.page.ui;var m={url:h.url};if(h.url){var j={$title:h.title,$method:g.method,$init:null,$filter:null,$ui:h.ui,$type:h.type,success:function(c,g){var j=a.domain+a.pathname;g.location&&0!=g.location.indexOf("http")&&delete g.location;var l=g.location?g.location:h.url;m.url=l;if(300<g.status)return j=d.application?j+"#"+e.PAGES.home.id+e.hash_sep+d.application:j+"#"+e.PAGES.start.id,f(j,c,!0,m);if(100==g.status)return m.stop=!0,f("",c,!1,{stop:!0});j="?url="+b.helpers.encodeURIComponent(l);j=i+b.helpers.encodeJsmQuery(j)+
(b.helpers.hashFirst()?"":"#"+d.longPageName);return f(j,c,!1,m)}};g&&g.options&&b.extend(j,g.options);return b.sdata.execURL(h.url,j)}return f(i+(b.helpers.hashFirst()?"":"#"+d.longPageName),null,!1,m)};e.load=function(a,c,d){b.sdata.loadAuth(function(){b.sdata.authModule.checkConnected({success:function(){return e._load(a,c,d)},fail:function(){b.sdata.authModule.connect({success:function(){return e._load(a,c,d)},fail:function(){d&&d()}})}})})};e._saveAppsInDB=function(a,c,d,e,f,g){b.helpers.each(c,
function(a,c,h){if(d||b.helpers.hasErrors())return d=!0,h();b.sdata.installApp(a,function(a,b){b||(f++,e&&e(f,g,"Done"));h()})},function(){e&&e(g,g,"Done");a&&a()})};e._load=function(a,c,d){var f=[];if(a.$reinstall)if(delete a.$reinstall,b.sdata.config&&b.sdata.config.id){var g={};g.id=b.sdata.config.id;g.baseURL=b.sdata.config.baseUrl;g.description=b.sdata.config.description;g.url=b.sdata.config.$info.url;g.title=b.sdata.config.$info.title;g.icon=b.sdata.config.$info.icon;g.version=b.sdata.config.$info.version;
f.push(g)}else return d();else g=a.datasets,delete a.datasets,g.forEach(function(c){if(!1!==c.selected){var d=b.extend(!0,{},a);d.id=b.helpers.uuid();d.baseURL+=c.dataset;d.description=d.description+" ("+c.description+")";d.version=d.version||"0.000";f.push(d)}});var h=2*f.length,i=0;b.helpers.each(f,function(a,d,e){b.sdata.applicationDetails(a,function(b){i++;c&&c(i,h,"Done");if(a.data=b)b.title=a.title,b.description=a.description,b.baseUrl=a.baseURL;return e()})},function(){e._saveAppsInDB(d,f,
!1,c,i,h)})}})(jQuery);
(function(b){var e=function(e,d){this.$page=e;this.page=e[0];if(d.id)d.id=d.id.replace(/\./g,"_").replace(/\$/g,"_");var c=b.jqmData(this.page,"controller");c&&c.remove();b.jqmData(this.page,"controller",this);this.options=d;this.controls={};return this.init()};e.prototype={defaults:{id:"empty"},init:function(){this.config=b.extend({},this.defaults,this.options);this.prefix=this.config.id+"_";this.ui=this.config.ui;this.hasErrorView=!1;this.errors=[];return this},exprData:function(e){var d=b.proto.exprData(),
c=this;for(e&&(Array.isArray(e)?e.forEach(function(a){a&&d.push(a)}):d.push(e));;)if(d.push(c.data),c.parent&&c.$bind)c=c.parent;else break;return d},clearErrors:function(){this.errors.length=0},hasErrors:function(){return 0<this.errors.length},pushError:function(b){this.errors.push(b)},getPageData:function(){return!this.page?null:this.detailpagedata?this.detailpagedata:!b.sdata.config||!b.sdata.config.pages||!b.sdata.config.pages[this.page]?null:b.sdata.config.pages[this.page]},afterChangeHnd:function(b){return b.options&&
b.options.action&&this["action"+b.options.action]?(b=this["action"+b.options.action],b.bind(this)):null},checkData:function(){var e=this;e.clearErrors();Object.keys(e.controls).forEach(function(d){var d=e.controls[d],c=b.smobile.controls[d.uiClass].checkValue;if(c){var a=b("#"+d.id);a&&c.apply(e,[a,d])}});return e.hasErrors()?!1:!0},checkChange:function(b,d,c){var a=this.controls[b];if(a&&a.bind){var e=a.options&&a.options.$lookup,b=this.getValue(a.bind,null,"");if(e){if(d){if(null!=d.$value)d[a.options.$display]=
d.$value,delete d.$value;""===d[a.options.$display]&&!d.$key&&!d.$uuid&&(d=null)}if(null===d)null!=b&&(this.setData(a.bind,d),this.notifyChange());else if(d.$key){if(!b||b.$key!=d.$key)this.setData(a.bind,d),this.notifyChange()}else if(d.$uuid){if(!b||b.$uuid!=d.$uuid)this.setData(a.bind,d),this.notifyChange()}else if(null!=d[a.options.$display]){if(!b||b[a.options.$display]!=d[a.options.$display])this.setData(a.bind,d),this.notifyChange()}else null!=b&&(this.setData(a.bind,null),this.notifyChange())}else b!=
d&&(this.setData(a.bind,d),this.notifyChange());if(c)return c()}if(c)return c()},editActivity:function(){return this.options&&this.options.url&&this.options.url.entity===b.proto.sdataKey.workingCopies},draftId:function(){return this.options.url.id},notifyChange:function(){this.editActivity()&&(this.parent?this.parent.notifyChange():b.sdata.updateDraft(this.draftId(),this.data))},getValue:function(b,d,c){for(var d=d||this.data,a=b.split(".");a.length&&d;){b=a.shift();d=d[b]}null==d&&(d=c);return d},
getProtoDataValue:function(b,d,c){if(d=d||this.data)d=d.$properties;for(var a=b.split(".");a.length&&d;){b=a.shift();d=d[b]}null==d&&(d=c);return d},getCurrentData:function(){return this.data},setData:function(b,d,c){for(var c=c||this.data,b=b.split("."),a=0,e=b.length-1;a<e;a++){var h=c[b[a]];h||(h={},c[b[a]]=h);c=h}c[b[b.length-1]]=d},actioncancel:function(e){if(this.editActivity())return b.sdata.deleteDraft(this.draftId(),e.success);e.success&&e.success()},actionsave:function(e){if(!this.checkData())return!1;
if(this.editActivity())return b.sdata.saveDraft(this.draftId(),this.data,e.success);e.success()},setNeedRefresh:function(){for(var b=this;b;)b.needRefresh=!0,b=b.parent},doRefresh:function(){var e=this;Object.keys(e.controls).forEach(function(d){d=e.controls[d];if(d.uiClass){var c=b.smobile.controls[d.uiClass]?b.smobile.controls[d.uiClass].refresh:null;c&&d.id&&c(e,d.options,b("#"+d.id),d.id)}})},actionnext:function(){var e=this,d=e.getCurrentData();if(d.$links&&d.$links.$next&&(d=b.proto.parseExpression(d.$links.$next.$url,
{data:null,$prototype:b.proto.getProto(e.getPageData())},"$url")))b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.loading}),b.sdata.execURL(d,{error:function(){b.mobile.loading("hide")},success:function(c){b.mobile.loading("hide");if(c)e.data=c,e.doRefresh()}})},actionprevious:function(){var e=this,d=e.getCurrentData();if(d.$links&&d.$links.$previous&&(d=b.proto.parseExpression(d.$links.$previous.$url,{data:null,$prototype:b.proto.getProto(e.getPageData())},"$url")))b.mobile.loading("show",
{theme:"a",text:b.smobile.locale().ui.loading}),b.sdata.execURL(d,{error:function(){b.mobile.loading("hide")},success:function(c){b.mobile.loading("hide");if(c)e.data=c,e.doRefresh()}})},installApplication:function(e,d){var c=!1;if(d){b.helpers.clearErrors();if(d.datasets)for(var a=0,i=d.datasets.length;a<i&&!(c=!1!==d.datasets[a].selected);a++);if(c){var h=this;b.smobile.load(d,function(a,c){0==a&&c?b.mobile.loading("show",{theme:"a",text:b.smobile.locale().ui.installing}):a==c&&b.mobile.loading("hide")},
function(){b.helpers.hasErrors()?b.smobile.showErrors(h):e.success&&e.success()})}else if(e.fail)return e.fail()}else if(e.fail)return e.fail()},removeApplication:function(e,d){b.helpers.clearErrors();var c=this;b.sdata.removeFromDB(d,function(){b.helpers.hasErrors()?b.smobile.showErrors(c):e.success&&e.success()})},actionsync:function(e){b.helpers.clearErrors();var d=this,c=d.resync?b.smobile.load:null;delete d.resync;return b.sdata.execBatch(d.data,{success:function(){b.helpers.hasErrors()?b.smobile.showErrors(d):
e.success&&e.success()}},c)},actionundo:function(e){b.helpers.clearErrors();var d=this;d.data?b.helpers.each(Object.keys(d.data),function(c,a,e){(c=d.data[c])&&c.length?b.helpers.each(c,function(a,c,d){b.sdata.undoUpdate(a.$info.url,d)},e):e()},function(){e.success&&e.success()}):e.success&&e.success()},actiondelete:function(e){b.helpers.clearErrors();if(this.editActivity())return b.sdata.deleteDataByDraft(this.draftId(),function(){b.helpers.hasErrors()?b.smobile.showErrors():e.success&&e.success()});
e.success&&e.success()},remove:function(){b.jqmRemoveData(this.page,"controller");delete this.$page;delete this.detailpagedata;delete this.page;delete this.controls;delete this.detail;delete this.parent},registerControl:function(b){this.controls[b.id]=b},controlByClass:function(b){for(var d in this.controls){var c=this.controls[d];if(c.uiClass==b)return c}return null},bindData:function(e){var d=this;Object.keys(d.controls).forEach(function(c){var c=d.controls[c],a=b("#"+c.id);a&&b.smobile.setEvents.apply(d,
[a,c])});e&&e()}};b.fn.uiController=function(b){new e(this,b);return this}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;var f={GroupLayout:function(d){var c=['<center><div id="'+d.id+'" data-role="controlgroup"'];b.helpers.addJqmData(d.data,c);c.push('">');return{before:c.join(""),after:"</div></center>",childs:[]}},FieldContainer:function(d){var c=['<div id="'+d.id+'" data-role="fieldcontain"'];b.helpers.addJqmData(d.data,c);c.push('">');return{before:c.join(""),after:"</div>",childs:[]}},CollapsibleLayout:function(d){var c=d.data,a=['<div id="'+d.id+'" data-role="collapsible" data-collapsed="'+
(c.collapsed?"true":"false")+'"'];b.helpers.addJqmData(c,a);a.push("><h"+(d.size||3)+">"+(c.text||"")+"</h"+(d.size||3)+">");return{before:a.join(""),after:"</div>",childs:[]}},CollapsibleSetsLayout:function(d){var c=['<div id="'+d.id+'" data-role="collapsible-set"'];b.helpers.addJqmData(d.data,c);c.push(">");return{before:c.join(""),after:"</div>",childs:[]}},Block:function(d){var c=['<div id="'+d.id+'" data-role="controlgroup"'];b.helpers.addJqmData(d.data,c);c.push('">');return{before:c.join(""),
after:"</div>",childs:[]}},BlockLayout:function(d){var c=['<div id="'+d.id+'" class="ui-body'];b.helpers.addJqmData(d.data,c,["data-theme"],!0,"ui-body-");c.push('">');return{before:c.join(""),after:"</div>",childs:[]}},GridLayout:function(d){var c=d.data,a=c.colCount||2;5<a&&(a=5);2>a&&(a=2);var e=c.rowCount||1;1>e&&(e=1);var f=["a","b","c","d","e"],g=['<div id="'+d.id+'"',' class="ui-grid-'+f[a-2]];b.helpers.addJqmData(c,g,["data-theme"],!0,"ui-body-");g.push('">');for(var c=c.cells||[],j={childs:[]},
l=0;l<e;l++)for(var m=0;m<a;m++){var k;a:{k=0;for(var n=c.length;k<n;k++){var o=c[k];if(o.col==m&&o.row==l){k=o;break a}}k=null}n=k||{};k={id:d.id.substring(this.prefix.length)+"_"+l+"_"+m};b.extend(k,n);n=['<div id="'+this.prefix+k.id+'"',' class="ui-block-'+f[m]];n.push('">');k={id:k.id,before:n.join(""),after:"</div>",childs:[]};j.childs.push(k)}j.before=g.join("");j.after="</div>";return j}};e.addLayout=function(b,c){if(f[c.layout]){var a=f[c.layout].apply(this,[c]);a.layoutClass=c.layout;b.childs.push(a);
return a}return null}})(jQuery);(function(b){var e=b.smobile||{},f={normal_icon:"s-m-icon-space",normal_icon_size:"s-m-icon-size",normal_noimage:"s-m-noimage",menu_icon:"s-m-menu-space",menu_icon_size:"s-m-menu-size",default_menu_name:"menu.empty",default_menu_class:"menu",default_icon_name:"sage.empty",default_icon_class:"sage"};e.ui=e.ui||{};e.ui.consts=f;e.ui.menuItem=function(b,c,a){a=a||f.default_menu_name;a=a.split(".");1==a.length&&a.splice(0,0,f.default_menu_class);return'<div class="'+f.menu_icon_size+" "+a.join(" ")+'"></div><h3>'+
b+"</h3><p><strong>"+c+"</strong></p>"};e.ui.iconItem=function(b,c,a){a=a||f.default_icon_name;a=a.split(".");1==a.length&&a.splice(0,0,f.default_icon_class);return'<div class="'+f.normal_icon_size+" "+a.join(" ")+'"></div><h3>'+b+"</h3><p><strong>"+c+"</strong></p>"};e.ui.sdataentry=function(b,c,a,e,h,g){h="";b||(b=c,c="");a&&(h='<div class="'+f.normal_icon_size+" "+f.normal_noimage+'"',e&&(h=h+" style=\"background: transparent url('"+e.replace(/'/g,"\\'")+"') no-repeat center center; background-size: 100% 100%\""),
h+="></div>");a="";g&&(a="<span class='ui-li-count'>"+g+"</span>");return h+""+b+""+(c?'<p class="s-m-margin-0">'+c+"</p>":"")+a};e.ui.sdata_link=function(d,c){var a="";if(!c.url&&c.facet){var e={$role:b.sdata.config.role||"",$baseUrl:b.sdata.config.baseUrl,$pluralType:c.entity,$representation:c.representation};"$query"==c.facet?a=b.proto.parseExpression("{$baseUrl}/{$pluralType}?representation={$representation}.$query&role={role}",{data:b.proto.exprData(e)},"$url"):"$create"==c.facet&&(a=b.proto.parseExpression("{$baseUrl}/{$pluralType}/$template/$workingCopies?representation={$representation}.$edit&role={role}",
{data:b.proto.exprData(e)},"$url"))}return a};e.ui.urlHref=function(d,c){var a=[b.helpers.hashFirst()?"#"+b.smobile.linkDetailPage(c):""];a.push(b.helpers.encodeJsmQuery("?url="+b.helpers.encodeURIComponent(d)));a.push(b.helpers.hashFirst()?"":"#"+b.smobile.linkDetailPage(c));return a.join("")};b.smobile=e;e.controls={};e._addLink=function(d,c,a,f){var h=c.css||[],g=!1;c.disabled&&h.push("ui-disabled");if(c.url||c.hash||c.action){g=!0;if(c.action)d.push('<a href="#"'),c.actionParams&&d.push("data-action='"+
c.actionParams+"'");else if(c.hash){if(a.applicationId&&0>c.hash.indexOf(b.smobile.hash_sep)){var j=b.smobile.PAGES[c.hash];if(j&&2==j.useAppId)c.hash=c.hash+b.smobile.hash_sep+b.helpers.encodeURIComponent(a.applicationId)}c.navbar&&!a.applicationId&&a.pageInfo.page.id==c.hash&&h.push("ui-btn-active");d.push('<a href="#'+c.hash+'"')}else"$external"==c.linkType?d.push('<a href="'+c.url+'"'):(d.push('<a href="'),d.push(e.ui.urlHref(c.url,a)),d.push('"'));b.helpers.addJqmData(c,d);c.controlId&&d.push(' id="'+
c.controlId+'"');h.length&&d.push(' class="'+h.join(" ")+'"');d.push(">")}null!=c.value?d.push(c.value):f&&f();g&&d.push("</a>")};e.controls.Html={handler:function(b,c){var a=b.data,e={html:a.html,options:a};delete a.html;return c(e)}};e.addControl=function(b,c,a){var f=e.controls[c.uiClass];f&&f.handler?f.handler.apply(this,[c,function(c){c&&(Array.isArray(c)?c.forEach(function(a){b.childs.push(a)}):b.childs.push(c));a(c)},b.layoutClass]):a(null)};e.setEvents=function(b,c){var a=e.controls[c.uiClass];
return a&&a.events?a.events.apply(this,[b,c]):null}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.MainMenu={handler:function(b,d){((b.data||{}).items||[]).forEach(function(b){b.data=b.data||{};b.data.menu=!0});return e.controls.List.handler.apply(this,[b,d])}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Combo={createCombo:function(e,d){var c=d.data||{},a=['<div data-role="fieldcontain" id="'+d.id+'">'];a.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');a.push('<label class="ui-input-text" for="'+d.id+'_i">'+c.label+": </label>");a.push('<select id="'+d.id+'_i"');b.helpers.addJqmData(c,a);a.push(">");var i=e.getValue(c.bind,null,null),h=i||c.value;c.items=c.items||[];if(null==i&&c.items.length)h=
c.items[0].value,e.setData(c.bind,h);c.items.forEach(function(b){a.push('<option value="'+b.value+'"'+(h==b.value?' selected="selected"':"")+">"+b.title+"</option>")});a.push("</select>");a.push("</div>");return{html:a.join(""),bind:c.bind,options:c}},handler:function(b,d){d(e.controls.Combo.createCombo(this,b))},checkValue:function(b,d){b.find("#"+d.id+"_i").find("option:selected").val();b.find("#"+d.id+"_error").html("")},xrefresh:function(e,d,c,a){var i=b("#"+e.id+"_i");i.empty();e=e.data||{};
e.items=d||[];var h=[];e.items.forEach(function(a){h.push('<option value="'+a.value+'"'+(c==a.value?' selected="selected"':"")+">"+a.title+"</option>")});i.html(h.join(""));i.selectmenu("refresh");a&&a()},events:function(b,d){var c=this,a=b.find("#"+d.id+"_i");a.bind("change",function(){var b=a.find("option:selected").val(),e=c.afterChangeHnd(d);c.getValue(d.bind,null,null)!=b&&(c.setData(d.bind,b),c.notifyChange(),e&&e())})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.SyncCheck={handler:function(b,a){b.data={label:e.locale().ui.sync_sync_data,value:!1,action:" "};return e.controls.CheckBox.handler.apply(this,[b,a])},events:function(b,a){var d=this,e=b.find("#"+a.id+"_i");e.change(function(){d.resync=e[0].checked})}};var f=function(c){switch(c){case b.sdata.STATUS.CREATED:return"created";case b.sdata.STATUS.DELETED:return"deleted";case b.sdata.STATUS.MODIFIED:return"modified"}return""},d=function(c){switch(c){case b.sdata.STATUS.CREATED:return b.smobile.locale().cancel_create;
case b.sdata.STATUS.DELETED:return b.smobile.locale().ui.cancel_delete;case b.sdata.STATUS.MODIFIED:return b.smobile.locale().cancel_update}return""};e.controls.SyncFooter={handler:function(c,a){var d=this;return b.sdata.getSyncCount({success:function(b){c.data=b?{items:[{title:e.locale().ui.sync_cancel_all,action:"undo",jmdata:{"data-icon":"delete","data-transition":"none"}},{title:e.locale().ui.sync_send_all,action:"sync",jmdata:{"data-icon":"arrow-u","data-transition":"none"}}]}:{items:[{title:e.locale().ui.sync_resync_data,
action:"sync",jmdata:{"data-icon":"arrow-d","data-transition":"none"}}]};return e.controls.NavBar.handler.apply(d,[c,a])}})},events:function(b,a){return e.controls.NavBar.events.apply(this,[b,a])}};e.controls.SyncView={handler:function(c,a){var i=this,h=[];i.hasSyncView=!0;var g=function(){h.push("</ul>");a({html:h.join(""),bind:" "})};b.sdata.getSyncData(function(a,l){if(l)return g(a);if(i.data=a)h.push('<ul id="'+c.id+'" data-role="listview" data-split-icon="back" data-split-theme="d"'),h.push(' data-inset="true"'),
h.push(">"),Object.keys(a).forEach(function(c){var g=b.sdata.entityMeta(c);g&&(h.push('<li data-role="list-divider">'),h.push(g.title||c),h.push("</li>"),a[c].forEach(function(a){h.push("<li");var c=[];c.push("ui-li-has-icon");c.length&&h.push(' class="'+c.join(" ")+'"');h.push(">");var g=[];g.push('<span class="ui-li-icon ui-li-thumb s-m-status '+f(a.$info.status)+'"></span>');g.push(b.helpers.htmlEncode(a.$info.title||"..."));a.$info.last_error&&(g.push('<p class="s-m-error"><strong>'),g.push(b.helpers.htmlEncode(a.$info.last_error)),
g.push("</strong></p>"));a.$info.status==b.sdata.STATUS.DELETED?(h.push('<a href="#">'),h.push(g.join("")),h.push("</a>")):(c={url:a.$info.url+"/"+b.proto.sdataKey.workingCopies+"?representation="+b.helpers.encodeURIComponent(a.$info.representation)},e._addLink(h,c,i,function(){h.push(g.join(""))}));h.push('<a href="#action-cancel'+b.helpers.encodeJsmQuery("?url="+b.helpers.encodeURIComponent(a.$info.url))+'">'+b.helpers.htmlEncode(d(a.$info.status))+"</a>");h.push("</li>")}))});g(a)})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.AppsView={handler:function(f,d){var c=this,a=[];c.data={};var i=function(a,b){if(!b||!b.length)return a;for(var c=a.length;c--;){for(var d=a[c],e=d.datasets.length;e--;){var f;a:{for(f=b.length;f--;){var h=b[f];if(h.url==d.url&&h.baseURL==d.baseURL+d.datasets[e].dataset){f=!0;break a}}f=!1}f&&d.datasets.splice(e,1)}d.datasets.length||a.splice(c,1)}return a},h=function(g){if(g&&g.length)a.push('<div data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d"  data-collapsed="false" data-inset="true">'),
a.push("<h2>"+e.locale().applicationmanager.installed_apps+"</h2>"),a.push('<ul id="'+f.id+'_remove" data-role="listview"'),a.push(' data-inset="false"'),a.push(">"),c.data.remove={},g.forEach(function(d){c.data.remove[d.id]=d;a.push('<li data-role="fieldcontain"');a.push(' class="ui-li-has-icon '+e.ui.consts.menu_icon+'"');a.push(">");a.push('<fieldset class="ui-grid-a"><div class="ui-block-a">');a.push(b.smobile.ui.menuItem(d.title,d.description,d.icon));a.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="b" data-icon="delete" id="'+
d.id+'_remove" data-inline="false">'+e.locale().applicationmanager.uninstall+"</button></div></fieldset>");a.push("</li>")}),a.push("</ul>"),a.push("</div>");d({html:a.join(""),bind:" "})};b.sdata.getInstalledApps(!0,function(d){b.sdata.applicationList({success:function(j){j=j||[];j=i(j,d);if(j.length)a.push('<div data-role="collapsible" data-theme="b" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" data-collapsed="false">'),a.push("<h2>"+e.locale().applicationmanager.available_apps+
"</h2>"),a.push('<ul id="'+f.id+'_install" data-split-icon="plus" data-role="listview"'),a.push(' data-inset="false"'),a.push(">"),j.forEach(function(c){c.id=b.helpers.uuid();a.push('<li data-role="fieldcontain"');a.push(' class="ui-li-has-icon '+e.ui.consts.menu_icon+'"');a.push(">");a.push('<fieldset class="ui-grid-a"><div class="ui-block-a">');a.push(b.smobile.ui.menuItem(c.title,c.description,c.icon));a.push('</div><div class="ui-block-b"><button data-iconpos="top" data-mini="true" data-theme="e" data-icon="plus" id="'+
c.id+'_install" data-inline="false">'+e.locale().applicationmanager.install+"</button></div></fieldset>");c.datasets.length&&c.datasets.forEach(function(c){c.$name=b.helpers.uuid();a.push('<input  data-mini="true" type="checkbox" checked="'+(c.selected?"true":"false")+'" name="'+c.$name+'" id="'+c.$name+'" class="custom" />');a.push('<label for="'+c.$name+'">'+c.description+"</label>")});a.push("</li>")}),a.push("</ul></div>"),a.push("</div>"),c.data.install={},j.map(function(a){c.data.install[a.id]=
a});h(d)}})})},events:function(){var e=this;e.data.install&&Object.keys(e.data.install).forEach(function(d){var c=e.data.install[d];c&&c.datasets&&c.datasets.length&&c.datasets.forEach(function(a){if(a.$name){var c=b("#"+a.$name);c&&c.length&&c.change(function(){a.selected=null==a.selected?!1:!a.selected})}});(d=b("#"+c.id+"_install"))&&d.length&&d.click(function(){if(!e.disabled){var a=c.id;e.disabled=!0;e.installApplication({success:function(){e.disabled=!1;b.smobile.goHome(e)},fail:function(){e.disabled=
!1}},e.data.install[a])}})});e.data.remove&&Object.keys(e.data.remove).forEach(function(d){var c=e.data.remove[d];(d=b("#"+c.id+"_remove"))&&d.length&&d.click(function(){e.disabled||e.removeApplication({success:function(){e.disabled=!1;b.smobile.goHome(e)},fail:function(){e.disabled=!1}},c.id,e.data.remove)})})}}})(jQuery);(function(b){var e=b.smobile||{};b.smobile=e;e.controls.ErrorView={handler:function(e,d){var c=[],a=b.helpers.lastErrors();a&&(c.push('<ul id="'+e.id+'" data-role="listview"'),c.push(' data-inset="true"'),c.push(">"),a.forEach(function(a){c.push("<li");var d=[];d.push("ui-li-has-icon");d.length&&c.push(' class="'+d.join(" ")+'"');c.push(">");c.push(b.helpers.FUNCS.TITLE_LW(a.title)+b.helpers.FUNCS.ERROR(a.data.message)+b.helpers.FUNCS.INFO(a.data.solution));c.push("</li>")}),c.push("</ul>"));this.hasErrorView=
!0;d({html:c.join("")})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Edit={_nativeToString:function(e,d){return"number"==d?(e||0)+"":"date"==d?!e?"":b.scroller.formatDate(b.helpers.dateSettings.dateFormat,e):"datetime"==d?!e?"":b.scroller.formatDate(b.helpers.dateSettings.dateFormat+"  "+b.helpers.dateSettings.timeFormat,e):"time"==d?e.format():e||""},_getvalue:function(f,d){var c=null;if("date"==f.type)if(c=d.getValue(f.bind,null,null),null!=c)try{c=Date.parseISO8601(c)}catch(a){c=new Date}else f.$isMandatory&&
d.config.inCreate&&(c=new Date);else if("time"==f.type){c=d.getValue(f.bind,null,0);try{c=b.helpers.Time.parse(c)}catch(i){c=new b.helpers.Time(0)}}else if("datetime"==f.type)if(c=d.getValue(f.bind,null,0),null!=c)try{c=Date.parseISO8601(c)}catch(h){c=new Date}else f.$isMandatory&&d.config.inCreate&&(c=new Date);else c="number"==f.type?d.getValue(f.bind,null,0):d.getValue(f.bind,null,"");return e.controls.Edit._nativeToString(c,f.type)},createEdit:function(f,d){var c=d.data,a=['<div data-role="fieldcontain" id="'+
d.id+'">'];a.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');a.push('<label class="ui-input-text" for="'+d.id+'_i">'+b.helpers.htmlEncode(c.label)+(c.$isMandatory?"*":"")+"</label>");a.push("<input ");var i=c.type||"text";if("date"==i||"time"==i||"datetime"==i)i="text";a.push('type="'+i+'" name="'+d.id+'" id="'+d.id+'_i" ');c.$isReadOnly&&a.push('readonly="true" ');a.push('value="');i=e.controls.Edit._getvalue(c,f);a.push(b.helpers.htmlEncode(i));a.push('"');
c.$pattern&&a.push(' pattern="'+c.$pattern+'"');c.$minimum&&a.push(' min="'+c.$minimum+'"');c.$maximum&&a.push(' max="'+c.$maximum+'"');c.$maxLength&&a.push(' maxlength="'+c.$maxLength+'"');c.$isMandatory&&a.push(' required="required"');a.push("/>");a.push("</div>");return{html:a.join(""),bind:c.bind,options:c}},refresh:function(f,d,c,a){b("#"+a+"_i").val(e.controls.Edit._getvalue(d,f))},handler:function(b,d){return d(e.controls.Edit.createEdit(this,b))},checkValue:function(f,d){var c=f.find("#"+
d.id+"_i"),a=f.find("#"+d.id+"_error");a.html("");var i=d.options;i.$isMandatory&&""===c[0].value?(c={field:f,message:b.helpers.format(e.locale().ui.mandatory_field,[i.label])},this.pushError(c),a.html(c.message)):i.$minLength&&c[0].value.length<i.$minLength&&(c={field:f,message:b.helpers.format(e.locale().ui.minlength_field,[i.label])},this.pushError(c),a.html(c.message))},_checkDateTime:function(e,d){var c=b("#"+e.id+"_i"),a,i,h,g=d.afterChangeHnd(e);if("date"==e.options.type){a=c.val();if(!a)return d.checkChange(e.id,
a,g);try{a=b.scroller.parseDate(b.helpers.dateSettings.dateFormat,a)}catch(j){a=new Date}a=a.toISOString();i=d.getValue(e.bind,null,"");h=b.helpers.date.checkString(a,i);if(a!=h){var l=b.scroller.formatDate(b.helpers.dateSettings.dateFormat,b.helpers.date.isoToDate(a));c.val(l)}i!=h&&d.checkChange(e.id,h,g)}else if("time"==e.options.type){a=c.val();i=d.getValue(e.bind,null,"");a||(a=b.helpers.Time.parse(i).format());try{a=b.helpers.Time.parseTime(a)}catch(m){a=b.helpers.Time.parse("00:00")}c.val(a.format());
a=a.toISO();a!=i&&d.checkChange(e.id,a,g)}else if("datetime"==e.options.type){a=c.val();if(!a)return d.checkChange(e.id,a,g);try{a=b.scroller.parseDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,a)}catch(k){a=new Date}a=a.toISOString();i=d.getValue(e.bind,null,"");l=b.scroller.formatDate(b.helpers.dateSettings.dateFormat+" "+b.helpers.dateSettings.timeFormat,b.helpers.date.isoToDate(a));c.val(l);i!=a&&d.checkChange(e.id,a,g)}},events:function(b,d){var c=this,a=b.find("#"+
d.id+"_i");"date"==d.options.type?a.scroller({preset:"date"}):"datetime"==d.options.type?a.scroller({preset:"datetime"}):"time"==d.options.type&&a.scroller({preset:"time"});a.blur(function(){var b=c.afterChangeHnd(d),f,g;if(d.bind)"number"==d.options.type?(f=c.getValue(d.bind,null,0),g=parseFloat(a[0].value),isNaN(g)&&(g=f),f=d.options.decimals,null==d.options.decimals&&d.options.bindDecimals&&(f=c.getValue(d.options.bindDecimals,null,0)),null!=f&&(g=parseFloat(g.toFixed(f))),a[0].value=g,c.checkChange(d.id,
g,b)):"datetime"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,c)},0):"time"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,c)},0):"date"==d.options.type?window.setTimeout(function(){e.controls.Edit._checkDateTime(d,c)},0):c.checkChange(d.id,a.val(),b)})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Picture={_setPhoto:function(e,d,c,a){var i=d.find("#"+c.id+"_image"),h=d.find("#"+c.id+"_cont"),g=function(){h.addClass("s-m-noimage");i.addClass("s-m-hidden");i[0].src=""},d=function(){h.removeClass("s-m-noimage");i.removeClass("s-m-hidden")},a=a||(e?e.getValue(c.options.bind,null,null):null);if(null==a)g();else if(a.$url){if((c=a.$url)&&b.proto.isExpression(c)&&e)c=e.getPageData(),g=b.proto.getProto(c),c=c?b.proto.parseExpression(a.$url,
{data:e.exprData(),$prototype:g},"$url"):"";i[0].src=c;d()}else a.$value?(i[0].src="data:"+(a.$contentType||"image/jpeg")+";base64,"+a.$value,d()):g()},createPicture:function(f,d){var c=d.data,a=[];a.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');c.label&&a.push(b.helpers.htmlEncode(c.label));a.push('<div id="'+d.id+'">');a.push('<div id="'+d.id+'_cont" class="ui-body s-m-image-container s-m-noimage" >');a.push('<input id="'+d.id+'_input" class="s-hidden-file" accept="image/*" type="file" data-role="none" data-ajax="false" name="'+
d.id+'_input"/>');a.push('<center><img class="s-m-image s-m-hidden" id="'+d.id+'_image" src=""/></center>');a.push("</div>");a.push('<a id="'+d.id+'_file" data-role="button" data-mini="true" data-icon="file" data-inline="true">'+e.locale().ui.picture_file+"</a>");a.push('<a id="'+d.id+'_photo"  data-role="button" data-mini="true" data-icon="photo" data-inline="true">'+e.locale().ui.picture_photo+"</a>");a.push("</div>");return{html:a.join(""),bind:c.bind,options:c}},handler:function(b,d){return d(e.controls.Picture.createPicture(this,
d))},checkValue:function(f,d){var c=b("#"+d.id+"_error");c.html("");if(d.options.$isMandatory&&!this.getValue(d.options.bind,null,null)){var a={field:f,message:b.helpers.format(e.locale().ui.mandatory_field,[d.options.label])};this.pushError(a);c.html(a.message)}},events:function(b,d){var c=this,a=b.find("#"+d.id+"_file"),i=b.find("#"+d.id+"_input");b.find("#"+d.id+"_photo").bind("click",function(){navigator.camera&&navigator.camera.getPicture?navigator.camera.getPicture(function(a){var g={$type:"image",
$value:a,$fileName:"picture.jpeg",$contentType:"image/jpeg"};c.setData(d.options.bind,a);e.controls.Photo._setPhoto(c,b,d,g)},function(){},{quality:50}):alert(e.locale().ui.picture_nocamera)});a.bind("click",function(){b.find("#"+d.id+"_input").click()});i.bind("change",function(a){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var g=a.target.files,a={};if(g&&g.length&&(g=g[0],g.type.match("image.*"))){a.$contentType=g.type;a.$fileName=g.name;a.$type="image";var i=new FileReader;
i.onload=function(a,g){return function(a){var h=a.target.result.indexOf("base64,");g.$value=0<h?a.target.result.substring(h+7):a.target.result;delete g.$url;e.controls.Picture._setPhoto(c,b,d,g);c.setData(d.options.bind,g);c.notifyChange()}}(g,a);i.readAsDataURL(g)}}});e.controls.Picture._setPhoto(c,b,d)}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};var f=e.controls;f.types=f.types||{};f.types.addReference=function(d,c,a){var e={},f=c,d=d.$item||d;c&&Array.isArray(c)&&(f=c[c.length-1]);if(b.proto.useUuid(d)&&!f)return e.value="",e;e.value=f&&f.hasOwnProperty("$value")?f.$value:d.$value?b.proto.parseExpression(d.$value,{data:a.exprData(c),$prototype:d},"$value"):b.proto.parseExpression(d.$key,{data:a.exprData(c),$prototype:d},"$key");if(d.$links&&d.$links.$details&&(d=b.proto.parseExpression(d.$links.$details.$url,
{data:a.exprData(c),$prototype:d},"$url"),(c=b.sdata.parseSdataUri(d))&&c.query&&c.query.representation&&b.sdata.config.pages[c.query.representation]))e.url=d;return e};f.types._table_header=function(d,c,a,e){d.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"');d.push(">");d.push("<thead><tr>");var f=a.$properties,g=!0;c.forEach(function(c,e){f[c].$isHidden||(g?(g=!1,d.push('<th data-priority="persist">')):d.push('<th data-priority="'+e+'">'),d.push(b.helpers.htmlEncode(b.proto.parseExpression(f[c].$title,
{data:null,$prototype:a},"$title"))),d.push("</th>"))});e&&(d.push('<th data-priority="'+c.length+'"></th>'),d.push('<th data-priority="'+c.length+1+'"></th>'));d.push("</tr></thead>");d.push("<tbody>")};f.types._table_row=function(b,c,a,i,h,g,j){b.push("<tr>");var l=a.$properties,m=!0;c.forEach(function(a){var c=l[a];c.$isHidden||(m?b.push("<th>"):b.push("<td>"),"application/x-reference"===c.$type?(a=f.types.addReference(c,[i,i[a]],h),e._addLink(b,a,h)):b.push(i[a]),m?(b.push("</th>"),m=!1):b.push("</td>"))});
g&&(b.push("<td>"),b.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" data-index="'+j+'" data-action="edit" data-mini="true" data-icon="edit"'),b.push(">"+e.locale().ui.edit_item+"</a>"),b.push("</td>"),b.push("<td>"),b.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" " data-index="'+j+'" data-action="delete" data-mini="true"data-icon="delete"'),b.push(">"+e.locale().ui.remove_item+"</a>"),b.push("</td>"));b.push("</tr>")};f.types._table_end=
function(b){b.push("</tbody>");b.push("</table>")};f.types._cards=function(d,c,a,i,h,g,j){d.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"');d.push(">");d.push("<thead><tr>");d.push('<th data-priority="1"></th>');d.push('<th data-priority="persist"></th>');d.push("</tr></thead>");d.push("<tbody>");var l=a.$properties;c.forEach(function(c){var g=l[c.$bind];d.push("<tr>");d.push("<th>");d.push(b.helpers.htmlEncode(b.proto.parseExpression(g.$title,{data:null,$prototype:a},
"$title")));d.push("</th><td>");"application/x-reference"===g.$type?(c=f.types.addReference(g,i[c.$bind],h),e._addLink(d,c,h)):d.push(i[c.$bind]);d.push("</td>");d.push("</tr>")});g&&(d.push("<tr>"),d.push("<td>"),d.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" data-index="'+j+'" data-action="edit" data-mini="true" data-icon="edit"'),d.push(">"+e.locale().ui.edit_item+"</a>"),d.push("</td>"),d.push("<td>"),d.push('<a href="#" data-role="button" data-shadow="false" data-corners="false" " data-index="'+
j+'" data-action="delete" data-mini="true"data-icon="delete"'),d.push(">"+e.locale().ui.remove_item+"</a>"),d.push("</td>"),d.push("</tr>"));d.push("</tbody>");d.push("</table>")};f.ArrayField={handler:function(d,c){var a=this,i=[],h=d.data||{},g=h.field;if(!a.getPageData())return c({html:"",options:{}});var j="$edit"===h.facet||"$create"===h.facet,l=g.$proto.$rtype,m=g.$proto.$protoparent,k=a.getValue(g.$bind,null,"application/x-reference"===l?null:[]),n=g.$proto.$item||g.$proto;if(j){var h={id:d.id+
"_"+g.$bind,data:{inline:!1,bind:g.$bind}},j=h.data,o;switch(l){case "application/x-reference":j.type="text";j.label=b.proto.parseExpression(m.$title,{data:null,$prototype:n},"$title");h.id=d.id+"_"+g.$bind;if(n.$links&&n.$links.$lookup&&n.$links.$lookup.$url)j.$lookupurl=b.proto.parseExpression(n.$links.$lookup.$url,{data:a.exprData(k),$prototype:n},"$url"),j.$lookupurl=j.$lookupurl+"&control="+b.helpers.encodeURIComponent(h.id);if(n.$isMandatory)j.$isMandatory=!0;o=e.controls.Lookup.createLookup(a,
h);o.id=h.id;o.uiClass="Lookup";o.scid="_"+g.$bind;break;case "application/x-array":switch(g.$proto.$type){case "application/x-reference":j.title=b.proto.parseExpression(m.$title,{data:null,$prototype:n},"$title");j.jmdata=b.proto.jqmDataArray();h.id=d.id+"_"+g.$bind;if(n.$links&&n.$links.$lookup&&n.$links.$lookup.$url)j.$lookupurl=b.proto.parseExpression(n.$links.$lookup.$url,{data:a.exprData(k),$prototype:n},"$url"),j.$lookupurl=j.$lookupurl+"&control="+b.helpers.encodeURIComponent(h.id);o=e.controls.ArrayRef.createArrayRef(a,
h,k);o.id=h.id;o.uiClass="ArrayRef";o.scid="_"+g.$bind;break;case "application/x-object":case "application/json":j.title=b.proto.execExpression(g.$title,g.$proto.$item||g.$proto);j.jmdata=b.proto.jqmDataArray();j.cards=g.cards;j.items=g.items;h.id=d.id+"_"+g.$bind;o=e.controls.ArrayObjectRef.createArrayObjectRef(a,h,k);o.id=h.id;o.uiClass="ArrayObjectRef";o.scid="_"+g.$bind;break;case "application/x-choice":var t={};n.$value.$enum.forEach(function(a){t[a.$value+""]=a.$title});k.forEach(function(a){i.push("<li>"+
b.helpers.htmlEncode(t[a+""])+"</li>")});break;default:k.forEach(function(a){i.push("<li>"+a||"</li>")})}}return o?c([o]):c(null)}i.push('<ul id="'+d.id+'" data-role="listview"');b.helpers.addJqmData(h,i);i.push(">");o="";switch(l){case "application/x-reference":(o=b.helpers.htmlEncode(b.helpers.htmlEncode(b.proto.execExpression(m.$title,m))))&&i.push('<li data-role="list-divider">'+o+"</li>");h=f.types.addReference(g.$proto,k,a);i.push("<li>");e._addLink(i,h,a);i.push("</li>");break;case "application/x-array":if((o=
b.helpers.htmlEncode(b.helpers.htmlEncode(b.proto.execExpression(g.$title,g.$proto.$item||g.$proto))))&&i.push('<li data-role="list-divider">'+o+"</li>"),k)switch(g.$proto.$type){case "application/x-reference":k.length&&k.forEach(function(b){b=f.types.addReference(g.$proto.$item||g.$proto,b,a);i.push("<li>");e._addLink(i,b,a);i.push("</li>")});break;case "application/x-object":case "application/json":g.cards?k.forEach(function(b,c){i.push("<li>");g.items&&f.types._cards(i,g.items,g.$proto,b,a,!1,
c);i.push("</li>")}):g.items&&(i.push("<li>"),i.push('<div class="ui-body">'),f.types._table_header(i,g.items,g.$proto),k.forEach(function(b,c){f.types._table_row(i,g.items,g.$proto,b,a,!1,c)}),f.types._table_end(i),i.push("</div>"),i.push("</li>"));break;case "application/x-choice":t={};n.$value.$enum.forEach(function(a){t[a.$value+""]=a.$title});k.forEach(function(a){i.push("<li>"+b.helpers.htmlEncode(t[a+""])+"</li>")});break;default:k.forEach(function(a){i.push("<li>"+a||"</li>")})}}i.push("</ul>");
return c({html:i.join(""),bind:h.bind,options:h})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Button={_typedButtons:{dialog_cancel:{jmdata:{"data-icon":"refresh","data-iconpos":"left"},defaults:{action:"dialog_cancel"}},dialog_ok:{jmdata:{"data-icon":"check","data-iconpos":"left"},defaults:{action:"dialog_ok"}},cancel:{jmdata:{"data-icon":"refresh","data-iconpos":"top"},defaults:{action:"cancel"}},action:{jmdata:{"data-icon":"gear","data-iconpos":"top"},defaults:{action:""}},add:{jmdata:{"data-iconpos":"top","data-icon":"add"}},
back:{jmdata:{"data-icon":"arrow-l"},defaults:{action:"back"}},save:{jmdata:{"data-iconpos":"top","data-icon":"check"},defaults:{action:"save"}},"delete":{jmdata:{"data-iconpos":"top","data-icon":"delete"},defaults:{action:"delete"}}},_stdActions:{dialog_cancel:function(){this.$page.dialog("close")},dialog_ok:function(){if(!this.checkData())return!1;var b=this.data,d=this.pageActions?this.pageActions.success:null;this.$page.dialog("close");d&&d(b)}},handler:function(f,d){var c=f.data||{},a={};c.controlId=
f.id;if(c.type){var i=e.controls.Button._typedButtons[c.type];i&&(b.extend(a,i.jmdata),i.defaults&&Object.keys(i.defaults).forEach(function(a){null==c[a]&&(c[a]=i.defaults[a])}))}c.jmdata&&b.extend(a,c.jmdata);b.extend(a,{"data-role":"button"});c.jmdata=a;return d({html:"",action:c.action,options:c})},events:function(f,d){var c=this;f.click(function(a){if(d&&d.action){if(d.options.disabled)return;d.options.disabled=!0;if(e.controls.Button._stdActions[d.action])e.controls.Button._stdActions[d.action].call(c);
else return a=c["action"+d.action],setTimeout(function(){d.options.disabled=!1},500),a.call(c,{success:function(){b.smobile.doBack(c)}});d.options.disabled=!1}a.preventDefault()})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.CheckBox={createCheckBox:function(e,d){var c=d.data||{},a=['<div data-role="fieldcontain" id="'+d.id+'">'];a.push('<input type="checkbox" name="'+d.id+'_i" id="'+d.id+'_i" ');var i=c.value||!1;c.bind&&(i=e.getValue(c.bind,null,!1));i&&a.push("checked");a.push("/>");a.push('<label for="'+d.id+'_i">'+b.helpers.htmlEncode(c.label)+"</label>");a.push("</div>");return{html:a.join(""),bind:c.bind,action:c.action,options:c}},handler:function(b,
d){return d(e.controls.CheckBox.createCheckBox(this,b))},events:function(b,d){var c=this,a=b.find("#"+d.id+"_i");a.change(function(){var b=c.afterChangeHnd(d);c.checkChange(d.id,a[0].checked,b)})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.List={handler:function(f,d){var c=this,a=[],i=f.data||[];a.push('<ul id="'+f.id+'" data-role="listview"');a.push(' data-inset="true"');a.push(">");(i.items||[]).forEach(function(d){d=d.data;a.push("<li");b.helpers.addJqmData(d,a);if(d.divider)a.push(' data-role="list-divider"'),a.push(">"),a.push(d.title);else{if(d.icon||d.menu)a.push(' class="'+(d.menu?e.ui.consts.menu_icon:e.ui.consts.normal_icon)+'"'),d.css=[d.menu?e.ui.consts.menu_icon:
e.ui.consts.normal_icon];a.push(">");var f="";d.menu&&(f=b.smobile.ui.menuItem(d.title,d.description,d.icon));d.url=e.ui.sdata_link(null,d);e._addLink(a,d,c,function(){a.push(f)})}a.push("</li>")});a.push("</ul>");return d({html:a.join(""),bind:i.bind,options:i})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.MultiField={handler:function(f,d){var c=this,a=f.data||{},i="$edit"===a.facet||"$create"===a.facet,h=c.getPageData();if(!h)return d({html:"",options:{}});if(i){var g=[];a.fields.forEach(function(a){var d=b.proto.getProto(h,a.$bind),i=null,j=a.$type,l={id:f.id+"_"+a.$bind,data:{inline:!1,bind:a.$bind}},p=l.data,s=c.getProtoDataValue(a.$bind,null,null);s&&(d=b.extend({},d,s));if(d.$isReadOnly)p.$isReadOnly=!0;s=b.proto.execExpression(d.$title,
d);switch(j){case "application/x-string":case "application/x-password":p.type="text";p.label=s;l.id=f.id+"_"+a.$bind;p.$minLength=d.$minLength;p.$maxLength=d.$maxLength;if("$email"==d.$format)p.type="email";else if("$url"==d.$format)p.type="url";else if("$phone"==d.$format)p.type="tel";if("application/x-password"===j)p.type="password";if(d.$isMandatory)p.$isMandatory=!0;i=e.controls.Edit.createEdit(c,l);i.id=l.id;i.uiClass="Edit";i.scid="_"+a.$bind;break;case "application/x-choice":var q=[];p.items=
q;p.$isMandatory=!0;d.$value.$enum.forEach(function(a){q.push({value:a.$value,title:a.$title})});p.label=s;l.id=f.id+"_"+a.$bind;i=e.controls.Combo.createCombo(c,l);i.id=l.id;i.uiClass="Combo";i.scid="_"+a.$bind;break;case "application/x-integer":case "application/x-real":case "application/x-decimal":p.type="number";p.decimals=0;if(null!=d.$scale)p.decimals=d.$scale;p.label=s;p.$minimum=d.$minimum;p.$maximum=d.$maximum;if(null!=d.$minimum&&null!=d.$maximum&&"application/x-integer"===j)p.type="range";
p.$isMandatory=!0;l.id=f.id+"_"+a.$bind;i=e.controls.Edit.createEdit(c,l);i.id=l.id;i.uiClass="Edit";i.scid="_"+a.$bind;break;case "application/x-boolean":p.label=s;l.id=f.id+"_"+a.$bind;i=e.controls.CheckBox.createCheckBox(c,l);i.id=l.id;i.uiClass="CheckBox";i.scid="_"+a.$bind;break;case "image":p.label=s;l.id=f.id+"_"+a.$bind;i=e.controls.Picture.createPicture(c,l);i.id=l.id;i.uiClass="Picture";i.scid="_"+a.$bind;break;case "application/x-date":p.type="date";p.label=s;p.$isMandatory=d.$isMandatory;
l.id=f.id+"_"+a.$bind;i=e.controls.Edit.createEdit(c,l);i.id=l.id;i.uiClass="Edit";i.scid="_"+a.$bind;break;case "application/x-time":p.type="time";p.label=s;p.$isMandatory=d.$isMandatory;l.id=f.id+"_"+a.$bind;i=e.controls.Edit.createEdit(c,l);i.id=l.id;i.uiClass="Edit";i.scid="_"+a.$bind;break;case "application/x-datetime":p.type="datetime",p.label=s,p.$isMandatory=d.$isMandatory,l.id=f.id+"_"+a.$bind,i=e.controls.Edit.createEdit(c,l),i.id=l.id,i.uiClass="Edit",i.scid="_"+a.$bind}i&&g.push(i)});
return g.length?d(g):d(null)}var j=[];j.push('<table data-role="table" data-mode="reflow" class="ui-responsive table-stroke"><tbody>');j.push("<thead><tr>");j.push('<th data-priority="1"></th>');j.push('<th data-priority="persist"></th>');j.push("</tr></thead><tbody>");j.push('<tr><td class="title"></td><td class="value"></td></tr>');var l=b.proto.getProto(h);a.fields.forEach(function(a){var d=b.proto.getProto(h,a.$bind);j.push("<tr><td>");j.push("<strong>"+b.helpers.htmlEncode(b.proto.execExpression(d.$title,
d))+"</strong>");j.push("</td><td>");j.push(b.proto.htmlValue(c.data,l,d,a));j.push("</td><tr>")});j.push("</tbody></table>");return d({html:j.join(""),bind:a.bind,options:a})}}})(jQuery);(function(b){var e={};(b.smobile||{}).staticui=e;e.start=function(){var e=b.smobile.locale();return{$title:e.administration.title,content:{title:{uiClass:"Html",data:{html:"<div><center><h4>"+e.administration.welcome+"</h4></center></div>"}},menu:{uiClass:"MainMenu",data:{items:[]}}}}};e.about=function(){var e=b.smobile.locale();return{$title:e.administration.title,content:{title:{uiClass:"Html",data:{html:e.about}}}}};e.mainfooter=function(){b.smobile.locale();return{footer:{uiClass:"NavBar",data:{items:[{type:"mainmenu"},
{type:"setup"},{type:"help"}]}}}};e.appFooter=function(){return{footer:{uiClass:"NavBar",data:{items:[{type:"sync"},{type:"home"}]}}}};e.applications=function(){return{content:{apps:{uiClass:"AppsView"}}}};e.errors=function(){return{content:{title:{uiClass:"Html",data:{html:"<h1>"+b.smobile.locale().errorpagetitle+"</h1>"}},errors:{uiClass:"ErrorView"}}}};e.send=function(){return{$title:b.smobile.locale().sendpagetitle,content:{toSend:{uiClass:"SyncView"},doSync:{uiClass:"SyncCheck"},log:{uiClass:"ErrorView"}},
footer:{footer:{uiClass:"SyncFooter"}}}}})(jQuery);$(function(){var b=function(){$(window).width();var b="slide";$.mobile.defaultPageTransition="none"};b();$(window).bind("throttledresize",b);window.location.hash?($.mobile.$start=!0,$.mobile.initializePage()):setTimeout(function(){window.location.hash="#start";$.mobile.$start=!0;$.mobile.initializePage()},0)});
$(document).bind("pagebeforechange",function(b,e){if(window.location.hash){var f=!1,d;if("string"===typeof e.toPage)f=!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,d=e.toPage;else if($.mobile.$start)f=!0,$.mobile.$start=!1,$.mobile.hashListeningEnabled=!0,d=window.location.href,e=null;if(!f&&e&&e.toPage.length&&"page-template"==e.toPage[0].id)e=null,d=window.location.href,f=!0;if(f){var c=$.mobile.path.parseUrl(d),a=$.smobile.pageName(c.hash);if(a){var i=$.mobile.activePage,h=!1,g=a.domid?
$("#"+a.domid):!1;if(g&&g.length){var f=$.smobile.pageController($(g[0])),j={transition:"none"};if($.sdata.config){b.preventDefault();if(f&&(h=a.page.isHome,f.needRefresh))f.needRefresh=!1,f.child&&f.doRefresh();var l=g.find(".s-m-notify-sync");if(l&&l.length)return $.sdata.getSyncCount({success:function(a){l.html(""+a);a?l.hasClass("s-m-hidden")&&l.removeClass("s-m-hidden"):l.hasClass("s-m-hidden")||l.addClass("s-m-hidden");$.mobile.changePage(g,j);h&&$.smobile.removeAllPages([g[0].id],!0)}});$.mobile.changePage(g,
j);h&&$.smobile.removeAllPages([g[0].id],!0)}else b.preventDefault(),$.mobile.changePage(g,j),$.smobile.removeAllPages([g[0].id],!0)}else{var m=e?e.options:{};m.allowSamePageTransition=!0;m.showLoadMsg=!0;$.mobile.loading("show",{theme:"a",text:$.smobile.locale().ui.loading});$.smobile.startDate=new Date;b.preventDefault();$.smobile.loadPage(c.hash,a,function(b,d,f){d?($.sdata.startLoad(),$.smobile.parseURL(c,a,function(c,f,g,h){if(h&&h.stop)$.sdata.endLoad();else{if(g&&($.sdata.endLoad(),$.mobile.loading("hide"),
a.page.id!=$.smobile.PAGES.errors.id)){if($.helpers.hasErrors())$.smobile.showErrors();else if(f&&$.smobile.showError(m,f||""),c)window.location.href=c;return}m.dataUrl=c;var c=$.smobile.createPage(a),j=c.$page;$.smobile.buildPage(b,i,j,d,f,h,a,c.$template,function(){var a=$.jqmData(j[0],"controller");if($.helpers.hasErrors()&&($.sdata.endLoad(),a&&!a.hasErrorView))return a.remove(),j.remove(),$.smobile.showErrors();!a.pageOptions.dialog&&m.dataUrl&&j.attr("data-url",$.smobile.hashOfUrl(m.dataUrl));
var b=e?e.options:{};if(null!=a.pageOptions.changeHash)b.changeHash=a.pageOptions.changeHash;$.mobile.changePage(j,b);a.bindData();$.sdata.endLoad()})}})):($.mobile.loading("hide"),a.page.id!=$.smobile.PAGES.errors.id&&($.helpers.hasErrors()?$.smobile.showErrors():f&&"object"===typeof f&&f.action?$.smobile.silentAction(f):$.smobile.showError(m,f||"")))})}}else if(f=$.smobile.actionName(c.hash))b.preventDefault(),$.smobile.execAction(c.hash,f,function(a){a&&$.smobile.refreshPage()})}}else b.preventDefault()});
$(document).bind("pagehide",function(b,e){if(window.location.hash&&b.target!=e.nextPage[0]){var f=$.jqmData(b.target,"controller"),d=$.jqmData(e.nextPage[0],"controller");if(f&&f.pageInfo&&f.pageInfo.page.cache)console.log("cache current page: this page can be cached");else{var c=$.smobile.pageIsDialog(e.nextPage);(c?0:$.smobile.pageIsDetail(e.nextPage))||c?d.child===f?$.smobile.removePage(b.target):console.log("cache current page: next page is  detail/dialog"):f&&$.smobile.removePage(b.target)}}});(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.SDataList={refresh:function(b,d,c){var a=[];e.controls.SDataList.createItems(b,d,a);c.html(a.join("")).listview("refresh")},createItems:function(f,d,c){var a=f.getPageData(),i=b.proto.getProto(a),h=b.proto.getArticle(a,d.bind);f.getCurrentData();var g={icon:{},hint:{},title:{propName:"$value"},description:{propName:"$description"}},j=[];h?(b.proto.layoutParser({},h,"$article",[i],j),i=b.proto.getProto(a,d.bind),j.forEach(function(a){switch(a.$mobile){case "icon":g.icon.propName=
a.$bind;break;case "hint":g.hint.propName=a.$bind;break;case "title":g.title.propName=a.$bind;break;case "description":g.description.propName=a.$bind}})):i=b.proto.getProto(a,d.bind);Object.keys(g).forEach(function(a){a=g[a];if(a.propName)if(0==a.propName.indexOf("$")){if(a.expression=i[a.propName],a.expression)a.protoValue=!0}else a.expression=a.propName});var l=null;if(i.$links&&i.$links.$details)l=i.$links.$details.$url,i.$links.$details.$isHidden&&(l="");f.getValue(d.bind,null,[]).forEach(function(a,
h){var j={},o=g.description.protoValue?a[g.description.propName]:null,t=g.title.protoValue?a[g.title.propName]:null,p=g.icon.protoValue?a[g.icon.propName]:null,s=g.hint.protoValue?a[g.hint.propName]:null,o=null==o&&g.description.expression?b.proto.parseExpression(g.description.expression,{data:f.exprData(a),$prototype:i},g.description.propName):"",t=null==t&&g.title.expression?b.proto.parseExpression(g.title.expression,{data:f.exprData(a),$prototype:i},g.title.propName):"",p=null==p&&g.icon.expression?
b.proto.parseExpression(g.icon.expression,{data:f.exprData(a),$prototype:i},g.icon.propName):"",s=null==s&&g.hint.expression?b.proto.parseExpression(g.hint.expression,{data:f.exprData(a),$prototype:i},g.hint.propName):"";if(g.icon.expression&&(p&&"object"!=typeof p&&(p=null),p))if("image"===p.$type){var q=p.$url;if(!q&&!p.$value&&g.icon.propName&&i.$properties&&i.$properties[g.icon.propName])q=i.$properties[g.icon.propName].$url;p=q?b.proto.parseExpression(q,{data:f.exprData(a),$prototype:i},"$url"):
p.$value?"data:"+(p.$contentType||"image/jpeg")+";base64,"+p.$value:null}else p=null;var r=b.smobile.ui.sdataentry(t,o,g.icon.expression,p,g.hint.expression,s);c.push("<li");b.helpers.addJqmData(j,c);if(g.icon.expression)c.push(' class="'+e.ui.consts.normal_icon+'"'),j.css=[e.ui.consts.normal_icon];c.push(">");if(l)j.url=b.proto.parseExpression(l,{data:f.exprData(a),$prototype:i},"$url");if(d.$lookup)j.action="validate",j.actionParams=h+"";e._addLink(c,j,f,function(){c.push(r)})})},handler:function(f,
d){var c=[],a=f.data||{},i=this.getPageData();if(!i)return d({html:"",options:{}});var h=b.proto.getProto(i);b.proto.getArticle(i,a.bind);if(!h)return d({html:"",options:{}});c.push('<ul id="'+f.id+'" data-role="listview" data-filter="true"');b.helpers.addJqmData(a,c);c.push(' data-inset="true"');c.push(">");e.controls.SDataList.createItems(this,a,c);c.push("</ul>");return d({html:c.join(""),bind:a.bind,options:a})},events:function(f,d){var c=this;d.options.$lookup&&f.click(function(a){a.preventDefault();
if(a&&a.target){for(a=a.target;a&&a.tagName&&"A"!=a.tagName.toUpperCase();)a=a.parentNode;if(!a)return;a=b(a).attr("data-action");if(""!=a&&(a=parseInt(a,10),c.getCurrentData()&&(a=c.getCurrentData().$resources[a],c.parent&&c.config&&c.config.url&&c.config.url.query&&c.config.url.query.control))){var d=c.parent.controls[c.config.url.query.control];if(d){var f=e.controls[d.uiClass];if(f.setValue)return f.setValue(c.parent,d,a,e.doBack)}}}e.doBack()});f.on("listviewbeforefilter",function(a,c){b(this);
b(c.input).val();a.preventDefault()})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.NavBar={_typedItems:{sync:function(b){b.title=e.locale().ui.sync_item;b.hash=e.PAGES.send.id;b.icon="arrow-u"},help:function(b){b.title=e.locale().maintoolbar.help;b.hash=e.PAGES.about.id;b.icon="info"},next:function(b){b.title=e.locale().maintoolbar.next;b.icon="arrow-r";b.action="next"},previous:function(b){b.title=e.locale().maintoolbar.previous;b.icon="arrow-l";b.action="previous"},home:function(f){f.title=e.locale().maintoolbar.home;
f.hash=b.smobile.PAGES.home.id;f.icon="home"},setup:function(f){f.title=e.locale().maintoolbar.setup;f.hash=b.smobile.PAGES.apps.id;f.icon="plus"},mainmenu:function(f){f.title=e.locale().maintoolbar.home;f.hash=b.smobile.PAGES.start.id;f.icon="home"}},refresh:function(b,d,c){var d=d.actions||[],a=b.getCurrentData();d.forEach(function(b){var d=c.find("#"+b.id),b=b.action;"previous"===b?!a.$links||!a.$links.$previous?d.addClass("ui-disabled"):d.removeClass("ui-disabled"):"next"===b&&(!a.$links||!a.$links.$next?
d.addClass("ui-disabled"):d.removeClass("ui-disabled"))})},_handler:function(f,d,c,a){var i=d.data,h=i.items||[],g=['<div data-role="navbar" id="'+d.id+'"'];b.helpers.addJqmData(i,g);g.push(">");g.push("<ul>");var j=[];h.forEach(function(c){c.navbar=!0;if(c.type&&e.controls.NavBar._typedItems[c.type])e.controls.NavBar._typedItems[c.type](c);if(c.icon)c.jmdata=c.jmdata||{},c.jmdata["data-icon"]=c.icon;if(c.action){var h=d.id+"_"+c.action;j.push({id:h,action:c.action});g.push('<li id="'+h+'"')}else g.push('<li style="position:relative;"');
g.push('class="');g.push('"');g.push(">");if(c.bind&&c.url)h=f.getPageData(),c.url=b.proto.parseExpression(c.url,{data:f.exprData(),$prototype:b.proto.getProto(h)},"$url");if(h=e.ui.sdata_link(null,c))c.url=h;e._addLink(g,c,f,function(){g.push(c.title)});"sync"==c.type&&(g.push('<div class="s-m-notify-sync'),a||g.push(" s-m-hidden"),g.push('" data-role="none">'),g.push(a||"0"),g.push('</div">'));g.push("</li>")});g.push("</ul>");g.push("</div>");i={html:g.join(""),action:0<j.length,options:{actions:j.length?
j:null}};return c(i)},handler:function(f,d){var c=!1,a=this;(f.data.items||[]).forEach(function(a){"sync"==a.type&&(c=!0)});c&&b.sdata.config&&b.sdata.config.id?b.sdata.getSyncCount({success:function(b){e.controls.NavBar._handler(a,f,d,b)}}):e.controls.NavBar._handler(a,f,d,0)},events:function(e,d){var c=this;if(d.options.actions){var a=c.getCurrentData();d.options.actions.forEach(function(i){var h=e.find("#"+i.id),g=i.action;"previous"===g?(!a.$links||!a.$links.$previous)&&h.addClass("ui-disabled"):
"next"===g&&(!a.$links||!a.$links.$next)&&h.addClass("ui-disabled");h.length&&h.click(function(a){if(!d.options.disabled)d.options.disabled=!0,c["action"+g].call(c,{success:function(){b.smobile.doBack(c)}}),a.preventDefault(),setTimeout(function(){d.options.disabled=!1},500)})})}}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.Lookup={createLookup:function(f,d){var c=d.data||{},a=f.getPageData(),a=b.proto.getProto(a,c.bind),i=['<div data-role="fieldcontain" id="'+d.id+'">'];i.push('<div class="s-m-state-block s-m-error" data-role="none" id="'+d.id+'_error"></div>');i.push('<label id="'+d.id+'_l" class="ui-input-text" for="'+d.id+'_i">');if(c.$lookupurl){var h={url:c.$lookupurl};e._addLink(i,h,f,function(){i.push(b.helpers.htmlEncode(c.label)+(c.$isMandatory?
"*":""))})}else i.push(b.helpers.htmlEncode(c.label)+(c.$isMandatory?"*":""));i.push("</label>");i.push("<input ");i.push('type="text" name="'+d.id+'" id="'+d.id+'_i" ');i.push('value="');var g=f.getValue(c.bind,null,null),j="";if(!b.proto.useUuid(a)||h)j=g&&g.hasOwnProperty("$value")?g.$value:a.$value?b.proto.parseExpression(a.$value,{data:f.exprData(g),$prototype:a},"$value"):b.proto.parseExpression(a.$key,{data:f.exprData(g),$prototype:a},"$key");i.push(b.helpers.htmlEncode(j||""));i.push('"');
i.push("/>");i.push("</div>");c.$lookup=1;return{html:i.join(""),bind:c.bind,action:c.action,options:c}},refresh:function(e,d,c,a){c=b("#"+a+"_i");a=e.getPageData();a=b.proto.getProto(a,d.bind);e=b.proto.parseExpression(a.$value,{data:e.exprData(e.getValue(d.bind,null,null)),$prototype:a},"$value")||"";c.val(e)},setValue:function(e,d,c,a){var i=e.getPageData(),i=b.proto.getProto(i,d.options.bind),c=b.proto.getRefFromValue(c,i),h=!0,g=h="";(g=b.proto.useUuid(i))?h=c.$key||c.$uuid:(i.noRef=!0,h=b.proto.parseExpression(i.$key,
{data:b.proto.exprData(c),$prototype:i},"$key"),delete i.noRef);var j=e.getValue(d.options.bind,null,null),g=g?j?j.$key||j.$uuid:"":b.proto.parseExpression(i.$key,{data:e.exprData(j),$prototype:i},"$key");g!=h&&(b.proto.setRef(c,i,e.exprData(),d.options.bind),e.notifyChange(),e.setNeedRefresh());return a()},handler:function(b,d){return d(e.controls.Lookup.createLookup(this,b))},events:function(b,d){var c=this,a=b.find("#"+d.id+"_i");a.blur(function(){if(d.bind){var b=c.afterChangeHnd(d);c.checkChange(d.id,
{$value:a.val()},b)}})}};e.controls.Lookup.checkValue=e.controls.Edit.checkValue})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};e.controls.ArrayRef={_createItem:function(f,d,c,a,i){f.push("<li>");f.push('<a href="#">');d=e.controls.types.addReference(d,c,i);f.push(b.helpers.htmlEncode(d.value));f.push("</a>");f.push('<a href="#" ');f.push('data-action="'+a+'"');f.push(">");f.push("</a>");f.push("</li>")},refresh:function(f,d,c,a){var i=f.getValue(d.bind,null,[]),h=f.getPageData(),g=b.proto.getProto(h,d.bind),j=[];j.push('<li data-role="list-divider">'+d.title+"</li>");
i.forEach(function(a,b){e.controls.ArrayRef._createItem(j,g,a,b,f)});d=b("#"+a+"_last").detach();c.html(j.join(""));c.append(d);c.listview("refresh")},createArrayRef:function(f,d,c){null==c&&(c=f.getValue(d.data.bind,null,[]));var a=d.data||{},i=f.getPageData(),h=b.proto.getProto(i,a.bind),g=[];g.push('<ul id="'+d.id+'" data-role="listview"');g.push(' data-inset="true" data-split-icon="delete"');b.helpers.addJqmData(a,g);g.push(">");g.push('<li data-role="list-divider">'+a.title+"</li>");c.forEach(function(a,
b){e.controls.ArrayRef._createItem(g,h,a,b,f)});g.push('<li id="'+d.id+'_last">');g.push('<div class="ui-block">');g.push('<a id="'+d.id+'_new" data-role="button" data-shadow="false" data-corners="false" data-mini="true" data-theme="d" data-icon="plus" data-iconpos="left" ');g.push('href="');g.push(e.ui.urlHref(a.$lookupurl,f));g.push('">');g.push(e.locale().ui.add_item);g.push("</a>");g.push("</li>");g.push("</ul>");a.$lookup=1;return{html:g.join(""),bind:a.bind,action:a.action,options:a}},setValue:function(e,
d,c,a){b("#"+d.id+"");var i=e.getPageData(),i=b.proto.getProto(i,d.options.bind),h=b.proto.getRefFromValue(c,i),g="",j="",l=b.proto.useUuid(i);l?g=h.$key||h.$uuid:(i.noRef=!0,g=b.proto.parseExpression(i.$key,{data:b.proto.exprData(h),$prototype:i},"$key"),delete i.noRef);for(var c=e.getValue(d.options.bind,null,[]),m=c.length;m--;)if(j=c[m],j=l?j.$key||j.$uuid:b.proto.parseExpression(i.$key,{data:e.exprData(j),$prototype:i},"$key"),j===g)return a();i=b.proto.setArrayRef(h,i,e.exprData(),d.options.bind);
c.push(i);e.setData(d.options.bind,c,null);e.notifyChange();e.setNeedRefresh();return a()},handler:function(b,d){return d(e.controls.ArrayRef.createArrayRef(this,b))},events:function(e,d){var c=this;e.click(function(a){if(a&&a.target){for(a=a.target;a&&a.tagName&&"A"!=a.tagName.toUpperCase();)a=a.parentNode;if((a=b(a).attr("data-action"))&&""!=a)a=parseInt(a,10),c.getValue(d.options.bind,null,[]).splice(a,1),c.notifyChange(),b(e.children()[a+1]).remove()}})}}})(jQuery);(function(b){var e=b.smobile;e.controls=e.controls||{};var f=e.controls;f.ArrayObjectRef={_renderContent:function(d,c,a,e,h,g,j){c.title&&h.push('<li data-role="list-divider">'+c.title+"</li>");h.push("<li");j&&(e=b.helpers.uuid(),h.push(' id="'+e+'"'),j.push("#"+e));h.push(">");c.cards||(h.push('<div class="ui-body">'),f.types._table_header(h,c.items,a,!0,j));g.forEach(function(b,e){c.cards?f.types._cards(h,c.items||[],a,b,d,!0,e,j):f.types._table_row(h,c.items||[],a,b,d,!0,e,j)});c.cards||(f.types._table_end(h,
!0),h.push("</div>"));h.push("</li>")},_addLast:function(b,c,a,f,h){h.push('<li id="'+f+'_last">');h.push('<div class="ui-block">');h.push('<a id="'+f+'_new" data-role="button" data-shadow="false" data-corners="false" data-mini="true" data-theme="d" data-icon="plus" data-iconpos="left" ');h.push('href="');h.push(e.ui.urlHref(c.$lookupurl,b));h.push('">');h.push(e.locale().ui.add_item);h.push("</a>");h.push("</li>")},refresh:function(d,c,a,e){var h=d.getValue(c.bind,null,[]),g=d.getPageData(),j=b.proto.getProto(g,
c.bind),g=[],l=[];f.ArrayObjectRef._renderContent(d,c,j,e,g,h,l);d=b("#"+e+"_last").detach();a.html(g.join(""));a.append(d);l.forEach(function(a){b(a).trigger("create")})},createArrayObjectRef:function(d,c,a){null==a&&(a=d.getValue(c.data.bind,null,[]));var e=c.data||{},h=d.getPageData(),h=b.proto.getProto(h,e.bind),g=[];g.push('<ul id="'+c.id+'" data-role="listview"');g.push(' data-inset="true" data-split-icon="delete"');b.helpers.addJqmData(e,g);g.push(">");f.ArrayObjectRef._renderContent(d,e,h,
c.id,g,a,null);f.ArrayObjectRef._addLast(d,e,h,c.id,g,a);g.push("</ul>");return{html:g.join(""),bind:e.bind,action:e.action,options:e}},setValue:function(d,c,a,e){b("#"+c.id+"");return e()},handler:function(b,c){return c(f.ArrayRef.createArrayRef(this,b))},events:function(d,c){var a=this;d.click(function(d){if(d&&d.target){for(var f=d.target;f&&f.tagName&&"A"!=f.tagName.toUpperCase();)f=f.parentNode;d=b(f).attr("data-action");if("delete"===d){var d=b(f).attr("data-index"),d=parseInt(d,10),g=a.getValue(c.options.bind,
null,[]);g.splice(d,1);a.notifyChange();for(d=c.options.cards?"TABLE":"TR";f&&f.tagName.toUpperCase()!=d;)f=f.parentNode;f&&b(f).remove()}else if("edit"===d){var d=b(f).attr("data-index"),d=parseInt(d,10),g=a.getPageData(),f=b.proto.getProto(g,c.options.bind),g=a.getValue(c.options.bind,null,[]),j=[];c.options.cards?j=c.options.items||{}:c.options.items&&c.options.items.forEach(function(a){j.push({$bind:a})});f=e.detailUiData(a,f,g[d],j);e.createDetail(f.uiData,g[d],a);a.setNeedRefresh()}}})}}})(jQuery);
