"use strict";
var config = require('syracuse-main/lib/nodeconfig').config;
var proxyManager = require('syracuse-studio/lib/dbgp/proxyManager');
var studio = require('syracuse-studio/lib/studioSession');

var studioConfig = config.studio || {};
var dbgpConfig = studioConfig.dbgp || {};
var tracer = require("syracuse-trace/lib/helper").getTracer("studio.helper");

exports.$exported = true;

exports.getDbgpProxyAddress = function(_) {
	var reverseIP = !! dbgpConfig.reverseIP;
	var cfg = proxyManager.getConfig(_, {
		resolveName: dbgpConfig.resolveName, // true by default
		resolveIP: dbgpConfig.resolveIP, // true by default
		reverseIP: reverseIP // false by default
	});
	var proxy = (!reverseIP && cfg.ip4Host) || cfg.host || cfg.ip4Host;
	tracer.debug && tracer.debug("getDbgpProxyAddress: result=" + proxy);
	return proxy;
};

exports.getStudioDbgpProxyAddress = function(_, id) {
	var info = studio.getStudioSessionInfo(_, id),
		proxy = info && info.debugProxy(_);
	tracer.debug && tracer.debug("getStudioDbgpProxyAddress: id=" + id + ", result=" + proxy);
	return proxy;
};