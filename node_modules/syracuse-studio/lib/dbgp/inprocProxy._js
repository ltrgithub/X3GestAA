"use strict";
var events = require('events');

var emiter = new events.EventEmitter();Â 
var writeQueues = {};

exports.open = function(_, idekey) {
	emiter.emit('open', idekey);
	return "dbgp.proxy.open " + idekey;
};

exports.sendPacket = function(_, idekey, xml) {
	emiter.emit('data', {
		idekey: idekey,
		xml: xml
	});
	return "dbgp.proxy.sendPacket " + idekey + ": " + xml;
};

exports.readCommand = function(_, idekey) {
	return "dbgp.proxy.readCommand " + idekey;
};

exports.sendCommand = function(_, idekey, cmd) {
	var wq = writeQueues[idekey] || (writeQueues[idekey] = []);
	wq.push(cmd);
};

exports.onData = function(cb) {
	emiter.on("data", cb);
};

exports.onOpen = function(cb) {
	emiter.on("open", cb);
};