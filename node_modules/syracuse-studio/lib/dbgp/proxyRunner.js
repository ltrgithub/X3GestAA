"use strict";
require('npm-shadow')();
// standalone proxy runner
var proxy = require('./proxy');
var config;
var dbgpConfig;

try {
	dbgpConfig = config = require("./config").config || {};
} catch (e) {
	try {
		config = require("../../../../nodelocal").config;
		config.streamline.fast = false;
		dbgpConfig = (config.studio || {}).dbgp || {};
	} catch (e) {
		dbgpConfig = config = {};
	}
}

var tracer = console.log;

process.on('uncaughtException', function(err) {
	tracer && tracer('proxyLauncher exception: ' + err.message + " at " + err.stack);
});
process.on('exit', function() {
	tracer && tracer('proxyLauncher exiting...');
});

proxy.startServer(function(err, port) {
	if (err)
		return console.error(err);
	tracer && tracer('Dbgp proxy starting on port ' + port + '...');
}, dbgpConfig);