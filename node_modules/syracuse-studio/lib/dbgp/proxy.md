
# Dbgp proxy server  
This server act as a forwarder for debug commands and responses.  
Debug commands are sent by Eclipse IDE.  
Response are sent by Adonix processes.  
The basis of the protocol is based on the [DBGP protocol](http://xdebug.org/docs-dbgp.php).  

## General workflow

* A `proxyinit` command is sent by the Eclipse IDE to register its uuid into the proxy  
* A `proxyinit` payload is returned by the proxy to the IDE 
* An `init` payload is sent by the adonix process to the proxy when a debug session starts  
* The debug session is registered by the proxy  
* The `init` payload is forwarded by the proxy to the IDE  
* The session is accepted or rejected by the IDE  
* If the session is accepted:  
 
  * The IDE debug context is started
  * Every debug command are sent to the proxy.
  * Command received by the proxy are forwarded to the adonix process  
  * Every payload sent by the adonix process to the proxy are forwarded to the IDE  
 

```
---------|                    |------------|                    |----------------
 Eclipse |                    | Dbgp Proxy |                    | x3 process
---------|                    |------------|                    |----------------
         | --- proxyinit -->> |            |                    |
         |                    |  Register  |                    |
         | <<- <proxyinit> -- |            |                    |
         |                    |            |                    |
 Accept  | <<--- <init> ----- |   <<---    | <<--- <init> ----- | start debug
   or    |                    |            |                    |
 Reject  |                    |            |                    |
         | -- feature_set ->> |   --->>    | -- feature_set ->> | 
         |                    |            |                    |
         | <<-- <response> -- |   <<---    | <<-- <response> -- | feature_set payload <response command="feature_set" feature_name="xxxx" ... />
         |                    |            |                    |
         | ---- step_in --->> |   --->>    | ---- step_in --->> | 
         |                    |            |                    |
         | <<-- <response> -- |   <<---    | <<-- <response> -- | step_in payload
         |                    |            |                    |
         |        ...         |            |        ...         |
```

## Message packets

The message packets are fully described in [DBGP message packets](http://xdebug.org/docs-dbgp.php#message-packets) section.  
We describe below some examples of the most relevant packets. The `[NULL]` string represent the null char `\0`.  
```
proxyinit -k 7f542ecb-a09a-4117-9a65-50f275098534 -m 1
[NULL]
```
```
404
[NULL]
<init idekey="b23efbcb-ddc3-4ffd-96fb-e29bdb94d261" fileuri="" session="com.sage.x3.xdt.dltk.debugger" 
      thread="2330794" parent="/produits/v170/SOLSUPV7/runtime" appid="sodaix02:17001/SUPERV/erbou/107175946" 
      language="X3" protocol_version="1.0">
  <engine version="17r.202"/>
  <author>Sage</author>
  <url><![CDATA[http://www.sage.com]]></url>
  <copyright><![CDATA[Copyright (c) 2000-2014 Sage]]></copyright>
</init>
[NULL]
```
```
feature_set -n max_children -i 0 -v 32
[NULL]
```
```
92
[NULL]
<response command="feature_set" transaction_id="0" feature_name="max_children" success="1"/>
[NULL]
```
