"use strict";

/* jshint -W079 */
/* jshint unused: false */
/* global QUnit: false, asyncTest: false, test: false, strictEqual: false, start: false, stop: false */
var helpers = require('syracuse-core/lib/helpers');
var nodeconfig = require('syracuse-main/lib/nodeconfig');
var flows = require('streamline/lib/util/flows');
var SadFsqFile = require('syracuse-adxadmin/lib/sadfsq/sadfsqFile').SadFsqFile;
var fs = require('fs');

var SadFsqClient = require('syracuse-adxadmin/lib/sadfsq/sadfsqClient').SadFsqClient;
var util = require('util');

var done;
QUnit.module(module.id, {
	setup: function() {},
	teardown: function() {
		if (done) {
			setTimeout(function() {
				process.kill(process.pid);
			}, 500);
		}
	}
});

var client;
asyncTest("Client class instanciation", function(_) {
	client = new SadFsqClient(_, "sodaix02", 17000, "apisu", "CRYPT:xkvvaTccvr", true);
	strictEqual(client.stream != null, true, "Stream is opened");
	start();
});

asyncTest("Get file info", function(_) {

	var options = {
		folder: "SUPERV",
		path: "tmp",
		name: "TCA_TEST",
		extension: "json"
	};
	var res = client.getFileInfo(_, options, "size");
	strictEqual(res && res.size, 439, "Size: " + res.size + " OK");
	res = client.getFileInfo(_, options, "stamp");
	console.log("Stamp: " + res.stamp);
	var date = new Date(res && res.stamp);
	strictEqual(date < Date.now(), true, "Stamp: " + date + " OK");
	start();
});






test("kill", function() {
	done = true;
	start();
});