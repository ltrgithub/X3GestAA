
# SadFsq Client  
SadFsq is provided by simple wrappers around standard POSIX functions.  
The module is using sadfsq protocol layer implemented in [SadFsqComm](./sadfsqComm.md).  
To use this module do require('syracuse-adxadmin/lib/sadfsq/sadfsqClient').SadFsqClient.  
All the methods are asynchronous.  
``` javascript
var SadFsqClient = require('syracuse-adxadmin/lib/sadfsq/sadfsqClient').SadFsqClient;
var sadfs = new SadFsqClient(_, "server", "port", "user", "password", secure);
```
* `server` is the hostname of the adxadmin server.  
* `port` is the port on adxadmin is listenning.  
* `user` is the system user to use for the connection.  
* `password` is the password corresponding to the user.  
* `secure` is boolean that define if the connection is secured by user/password.  


## General parameters  
In the following described functions, some general parameters would be necessary. This chapter describes these parameters.  

### File Options :  
Some following functions take in parameters `fileOptions`.  
This chapter describes how these options can be used.  
TODO.
-------------
### Flags :  
Some following functions take in parameters `flags`.  
This chapter describes how these options can be used.  
The flags argument points to a string. If the string is one of the following, the file shall be opened in the indicated mode. Otherwise, the behavior is undefined.  
* `r` or `rb` : Open file for reading.  
* `w` or `wb` : Truncate to zero length or create file for writing.  
* `a` or `ab` : Append; open or create file for writing at end-of-file.  
* `r+` or `rb+` or `r+b` : Open file for update (reading and writing).  
* `w+` or `wb+` or `w+b` : Truncate to zero length or create file for update.  
* `a+` or `ab+` or `a+b` : Append; open or create file for update, writing at end-of-file.  



## Functions

-------------
### open :
``` javascript
var fd = sadfs.open(_, fileOptions, flags);  
```
Retrieve informations from remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See [File Options](./sadfsqClient.md#File Options-). .   
* `flag` : a string that represent the open mode for the remote file. See [Flags](./sadfsqClient.md#flags-). 

Opening a file with read mode (`r` as the first character in the mode argument) shall fail if the file does not exist or cannot be read.  

Opening a file with append mode (`a` as the first character in the mode argument) shall cause all subsequent writes to the file to be forced to the then current end-of-file, regardless of intervening calls to `seek()` function.  

When a file is opened with update mode ('+' as the second or third character in the mode argument), both input and output may be performed on the associated stream. However, the application shall ensure that output is not directly followed by input without an intervening call to flush() or to a file positioning function as seek(), and input is not directly followed by output without an intervening call to a file positioning function, unless the input operation encounters end-of-file.  

If mode is `w`, `wb`, `a`, `ab`, `w+`, `wb+`, `w+b`, `a+`, `ab+`, or `a+b`, and the file did not previously exist, upon successful completion, `open()` shall mark for update the last data access, last data modification, and last file status change timestamps of the file and the last file status change and last data modification timestamps of the parent directory.  

If mode is `w`, `wb`, `a`, `ab`, `w+`, `wb+`, `w+b`, `a+`, `ab+`, or `a+b`, and the file did not previously exist, `open()` shall create a file.  

If mode is `w`, `wb`, `w+`, `wb+`, or `w+b`, and the file did previously exist, upon successful completion, `open()` shall mark for update the last data modification and last file status change timestamps of the file.  

Returns the file descriptor.  


-------------
## feof :
``` javascript
sadfs.feof(_, fd);  
```
return true if the current position in the remote file is End Of File.  

* `fd` is a file descriptor that identified the remote file.  

Returns the file descriptor.  


-------------
### rename :
``` javascript
sadfs.rename(_, oldOptions, newOptions);  
```
Open a remote file in system mode
Retrieve informations from remote file.  

* `oldOptions` is the object that represent the old sadFsq File options that you want to rename. See `fileOptions`.   
* `newOptions` is the object that represent the new sadFsq File options . See `fileOptions`.   
* `mod` can be :
   * TODO :
* `umask` can be :
   * TODO :

Returns the file descriptor or a diagnoses.  


-------------
### close :
``` javascript
var fd = sadfs.close(_, fd);  
```
Retrieve informations from remote file.  

* `fd` is an integer that represents the file descriptor.  

Return `null` or a diagnoses  


-------------
### stat :
``` javascript
var stats = sadfs.stat(_, fileOptions, attributes);  
```
Retrieve informations from remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See `fileOptions`.
* `attributes` is an array of strings that contains the attributes name.  
   Attributes can have the following values :  
   mode, ino, dev, rdev, nlink, uid, gid, size, atime, mtime, ctime.  
Returns a javascript object that contains attributes keys and values.  
``` json
   { 
      mode: 33188, // file mode  
      ino: 48064969, // inode number  
      dev: 0, // id of device containing a directory entry  
      rdev: 2114, // id of device if special char/block  
      nlink: 1, // number of links  
      uid: 85, // uid  
      gid: 100, // gid  
      size: 527, // file size in bytes  
      atime: Mon, 10 Oct 2011 23:24:11 GMT, // last time of access  
      mtime: Mon, 10 Oct 2011 23:24:11 GMT, // last time of modification  
      ctime: Mon, 10 Oct 2011 23:24:11 GMT // last time of file status change  
   }
``` 


-------------
### fstat :
``` javascript
var stats = sadfs.fstat(_, fd, attributes);  
```
This function is the same that `stat` but take a file descriptor as first parameter.  


-------------
### path :
``` javascript
var path = sadfs.path(_, fileOptions);  
```
Retrieve the full path of the remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See `fileOptions`.
Returns the the full path.  

-------------
### readFile :  
``` javascript  
var buf = sadfs.readFile(_, fileOptions, [options]);  
```
Retrieve informations from remote file.  

* `fileOptions` is the object that represent the sadFsq File options. See `fileOptions`.  
* `options` is the object that represent encoding and flag.  
    * encoding : a string that represent encoding ( 'utf-8', .... By default 'utf-8' )
    * flag : a string that represent the open mode for the remote file. See `Flags chapter`. 
    By default 'r'.  
  eg:  
``` javascript
   var options = {  
        encoding:"utf-8",
        flag : "r"
   };  
```
Returns the buffer that represents the content of the remote file.  


-------------
### read :  
``` javascript  
var buf = sadfs.read(_, fd, buffer, offset, length, position);  
```
Read data from the file specified by fd. 
* `buffer` is the buffer that the data will be written to.  
* `offset` is the offset in the buffer to start writing at.  
* `length` is an integer specifying the number of bytes to read.  
* `position` is an integer specifying where to begin reading from in the file. If position is null, data will be read from the current file position.  

Returns the size of red bytes.  

-------------
### getPosition :  
``` javascript  
var position = sadfs.getPosition(_, fd);  
```
Get the cursor position in the file specified by fd. 

-------------
### seek :  
``` javascript  
var position = sadfs.seek(_, fd, cursor, offset, [strict]);  
```
Change the cursor position in the file specified by fd. 

* `cursor` is the base of the move. (0: BOF, 1: Current position, 2: EOF)  
* `offset` is a number of bytes to ignore until the new position.  

* `strict` define if the position is allowed to be out of bounds. `true` by default.  

-------------
### unlink :  
``` javascript  
sadfs.unlink(_, fileOptions);  
```
Delete the remote file. 

* `fileOptions` is the object that represent the sadFsq File options. See `fileOptions`.  

-------------
### flush :  
``` javascript  
sadfs.flush(_, fileOptions);  
```
Force the buffers to be flushed into the file specified by fd without waiting for close.  

-------------
### lock :  
``` javascript  
sadfs.lock(_, fd, type, len, pos);  
```
Allows sections of the file specified by fd to be locked.  

* `fd` argument is an open file descriptor. The file descriptor must have Write permission in order to establish locks with this function call.  

* `type` argument is a control value that specifies the action to be taken. The permissible values for function are :  
   * 0: unlock previously locked section.  
   * 1: lock section for exclusive use.  
   * 2: test & lock section for exclusive use.  
   * 3: test section for other locks.  
* `len` argument is the number of contiguous bytes to be locked or unlocked.  

* `pos` define where the lock will start. Not including current byte.  
Force the buffers to be flushed into the file specified by fd without waiting for close.  
