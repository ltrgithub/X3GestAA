var program = require('commander');
var path = require('path');

var config = require('config');
var patchGenerator = require('./patchGenerator');

program
	.version("0.1.0", '-v, --version')
	.option('-p, --generatePatch', 'generate the patch file')
	.option('-l, --listFiles', 'list modified files')
	.option('-h, --displayHead', 'display head')
	.option('-t, --test', 'test')
	.parse(process.argv);

var t0 = Date.now();

if (program.displayHead) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	pg.getLastSyncdHead(_);
	pg.setLastSyncdHead(_, "lkj");
} else if (program.listFiles) {
	var pg = patchGenerator.newGenerator(_, config.scm);

	var files = pg.listModifiedFiles(_, '6805eee28575017abf79e870c74410a751d55a5d');
	files.forEach(function(item) { 
		console.log(item);
		//console.log(path.normalize(config.scm.solutionPath + '\\x\\' + item));
	});
} else if (program.test) {
	var pg = patchGenerator.newGenerator(_, config.scm);

	//var files = pg.listModifiedFiles(_, '6805eee28575017abf79e870c74410a751d55a5d');		
	var files = ["TEXT/COMMON/CLASSES/TCAWRKHISSUI.json"];
	pg.generatePatch(_, files, {oneFile:true, x3PatchToCompare:"C:/Temp/Patches/ACLA_TCAWRKHISSUI.dat"});
} else
	program.help();

console.log("execution completed in " + Math.round((Date.now() - t0) / 1000) + " seconds");


setTimeout(~_, 2000);
process.exit(0);
