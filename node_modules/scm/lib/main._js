var program = require('commander');
var path = require('path');

var config = require('config');
var patchGenerator = require('./patchGenerator');

program
	.version("0.1.0", '-v, --version')
	.option('-p, --generatePatch', 'generate the patch file')
	.option('-l, --listFiles', 'list modified files')
	.option('-h, --displaySyncdHead', 'display last sync\'d head')
	.option('-H, --displayGitHead', 'display git current head')
	.option('-s, --synchronize', 'synchronize')
	.option('-u, --unitTest', 'unit Test')
	.option('-t, --test', 'test')
	.parse(process.argv);

var t0 = Date.now();
if (program.displaySyncdHead) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	console.log("Last sync'd sha1 = " + pg.getLastSyncdSha1(_));

	//pg.setLastSyncdHead(_, "lkj");
} else if (program.synchronize) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	pg.synchronize(_);
} else if (program.displayGitHead) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	console.log("Git head = " + pg.getGitHead(_).sha1);
} else if (program.unitTest) {
	unitTest(_);
} else if (program.test) {
	var pg = patchGenerator.newGenerator(_, config.scm);


	//var files = pg.listModifiedFiles(_, '6805eee28575017abf79e870c74410a751d55a5d');		
	// var files = ["TEXT/SUPERV/CLASSES/ABANK.json"];
	// pg.generatePatch(_, files, {oneFile:true, x3PatchToCompare:"C:/Temp/Patches/ACLA_ABANK.dat"});

	//	var files = ["TEXT/COMMON/CLASSES/TCAWRKHISSUI.json"];
	// var files = ["TEXT/SUPERV/TABLES/ATABLE.json", "TEXT/SUPERV/TABLES/ABANK.json", "TEXT/SUPERV/TABLES/AABREV.json",
	// 	"TEXT/SUPERV/CLASSES/ATABLE.json", "TEXT/SUPERV/CLASSES/ABANK.json"
	// ];
	// pg.generatePatch(_, files, {oneFile:true, x3PatchToCompare:"C:/Temp/Patches/ACLA_TCAWRKHISSUI.dat"});

	// pg.generatePatch(_, ["TEXT/SUPERV/TABLES/ABANK.json"], {
	// 	oneFile: true,
	// 	x3PatchToCompare: "C:/Temp/Patches/ATB_ABANK.dat"
	// });




} else
	program.help();

console.log("execution completed in " + Math.round((Date.now() - t0) / 1000) + " seconds");


setTimeout(~_, 2000);
process.exit(0);


function unitTest(_) {
	var pg = patchGenerator.newGenerator(_, config.scm);

	pg.generatePatch(_, ["TEXT/SUPERV/CONTENTTYPES/ATYPE0.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ATYP_ATYPE0.dat"
	});
	pg.generatePatch(_, ["TEXT/SUPERV/ACTIVITYCODES/ABI.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACV_ABI.dat"
	});

	// tables
	pg.generatePatch(_, ["TEXT/SUPERV/TABLES/ABANK.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ATB_ABANK.dat"
	});
	pg.generatePatch(_, ["TEXT/COMMON/CLASSES/TCAWRKHISSUI.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACLA_TCAWRKHISSUI.dat"
	});
	pg.generatePatch(_, ["TEXT/SUPERV/CLASSES/ACTXPARAM.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACLA_ACTXPARAM.dat"
	});
	pg.generatePatch(_, ["TEXT/SUPERV/WINDOWS/OACLA.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AWI_OACLA.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/CONTEXTS/AFOLDER.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACTX_AFOLDER.dat"
	});
	pg.generatePatch(_, ["TEXT/SUPERV/CONTEXTS/AHISTO.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACTX_AHISTO.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/FUNCTIONS/ABATPAR.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AFC_ABATPAR.dat"
	});

	pg.generatePatch(_, ["TEXT/FA/GLOBVARS/G300CPFI.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AGB_G300CPFI.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/INQUIRIES/AJE.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACN_AJE.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/OBJECTS/AAA.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AOB_AAA.dat"
	});

	pg.generatePatch(_, ["TEXT/CHAPTERS/AAS/PARAMETERS/AASAUTNUM.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ADP_AASAUTNUM.dat"
	});

	pg.generatePatch(_, ["TEXT/FINANCE/PROCESSES/1099MISC.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ADC_1099MISC.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/REPORTS/ABLOB.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ARP_ABLOB.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/REPORTS/ACODIF.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ARP_ACODIF.dat"
	});

	// Representations
	pg.generatePatch(_, ["TEXT/SUPERV/REPRESENTATIONS/ABANK.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ASW_ABANK.dat"
	});

	// Representations
	pg.generatePatch(_, ["TEXT/SALES/REPRESENTATIONS/SQUOTE.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ASW_SQUOTE.dat"
	});

	// Representations : validate ASHWMENU sub table + validate ASHWLNK with empty CODLNK
	pg.generatePatch(_, ["TEXT/SUPERV/REPRESENTATIONS/CONTACTCRM.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ASW_CONTACTCRM.dat"
	});

	// Representations : validate ASHWMET sub table
	pg.generatePatch(_, ["TEXT/PURCHASES/REPRESENTATIONS/PPRICSEARCHM.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ASW_PPRICSEARCHM.dat"
	});

	// Representations : validate ASHWOPT sub table
	pg.generatePatch(_, ["TEXT/SALES/REPRESENTATIONS/SPRICCONF.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ASW_SPRICCONF.dat"
	});

	// Screens
	pg.generatePatch(_, ["TEXT/SUPERV/SCREENS/AAB1.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AMK_AAB1.dat"
	});

	// Screens : validate AMSKPAR sub table
	pg.generatePatch(_, ["TEXT/PURCHASES/SCREENS/PTH1.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AMK_PTH1.dat"
	});

	// Validate AMSKPAR sub table
	pg.generatePatch(_, ["TEXT/SUPERV/VIEWS/ADICADX.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/AVW_ADICADX.dat"
	});

	pg.generatePatch(_, ["TEXT/COMMON/MISCTABLES/6.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ADV_6.dat"
	});

	pg.generatePatch(_, ["TEXT/SUPERV/ACTIONS/ABIIMP.json"], {
		oneFile: true,
		x3PatchToCompare: "C:/Temp/Patches/ACT_ABIIMP.dat"
	});

}
