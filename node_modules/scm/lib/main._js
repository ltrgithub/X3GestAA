var program = require('commander');
var path = require('path');

var config = require('config');
var patchGenerator = require('./patchGenerator');

program
	.version("0.1.0", '-v, --version')
	.option('-h, --displaySyncdHead', 'display last sync\'d head')
	.option('-H, --displayGitHead', 'display git current head')
	.option('-s, --synchronize', 'incremental synchronization')
	.option('-S, --fullSynchronize', 'force full synchronization (not incremental)')
	.option('-t, --test', 'test')
	.parse(process.argv);

var t0 = Date.now();
if (program.displaySyncdHead) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	console.log("Last sync'd sha1 = " + pg.getLastSyncdSha1(_));

	//pg.setLastSyncdHead(_, "lkj");
} else if (program.synchronize) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	pg.synchronize(_);
} else if (program.fullSynchronize) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	pg.synchronize(_, {
		full: true
	});
} else if (program.displayGitHead) {
	var pg = patchGenerator.newGenerator(_, config.scm);
	console.log("Git head = " + pg.getGitHead(_).sha1);
} else if (program.test) {
	var pg = patchGenerator.newGenerator(_, config.scm);
} else
	program.help();

console.log("execution completed in " + Math.round((Date.now() - t0) / 1000) + " seconds");

// Temp hack to leave to time to ez-stream to flush the generated files. Should be removed ASAP
setTimeout(~_, 2000);
process.exit(0);


