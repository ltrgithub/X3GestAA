"use strict";
var helper = require('license-tool/lib/helper');
var fs = require('streamline-fs');
var util = require('util');
var globals = require('streamline/lib/globals');

module.exports = {
	$title: "Locales",
	$modes: "query,details",
	$properties: {
		code: {
			$title: "Code",
			$type: "application/x-string",
			$isMandatory: true,
		},
		title: {
			$title: "Title",
			$isMandatory: true,
			$type: "application/x-string"
		},
	},
	$load: function(_, key, query) {
		var locales = helper.loadLocales();
		key = key.toLowerCase();
		return {
			code: key,
			title: locales[key]
		};
	},
	// load a list of all instances. $uuid must be set!
	$list: function(_, query) {
		var localeObject = helper.loadLocales();
		var resources0 = Object.keys(localeObject).sort();

		var startIndex = +query.startIndex || 1;
		var endIndex = startIndex + (+query.count || 50) - 1;
		var resources = [];
		var upperBound = resources0.length;
		if (upperBound > endIndex) {
			resources.truncated = true;
			upperBound = endIndex;
		}
		for (var i = startIndex - 1; i < upperBound; i++) {
			var item = resources0[i];
			resources.push({
				code: item,
				title: localeObject[item],
				"$uuid": item
			});
		}
		return resources;
	},
};