"use strict";

var soapUtils = require('./soapUtils');
var types = require('syracuse-core/lib/types/allTypes');

function isRichMediaContent(type){
	var richMediaContentTypes = [
	                            "text/plain",
	                            "text/html",
	                            "text/xml",
	                            "image",
	                            "sound",
	                            "video",
	                            "application/octet-stream",
	                            "application/x-binary"
	                            ];
	return richMediaContentTypes.indexOf(type) !== -1;
}

exports.convertType = function(type){
	switch (type) {
		case "application/x-uuid":
		case "application/x-password":
		case "application/x-string":
			return "xs:string";
		case "application/x-integer":
			return "xs:integer";
		case "application/x-real":
			return "xs:float";
		case "application/x-decimal":
			return "xs:decimal";
		case "application/x-boolean":
			return "xs:boolean";
		case "application/x-date":
			return "xs:date";
		case "application/x-time":
			return "xs:time";
		case "application/x-datetime":
			return "xs:dateTime";
		default:
			if (isRichMediaContent(type)){
				return "b64";
			}else{
				return;
			}
	}
}

exports.convertValue = function(type, value){
	if (value == null)
		return "";
	switch (type) {
		case "application/x-date":
			return types.date.parse(value);
		case "application/x-time":
			return types.time.parse(value);
		case "application/x-datetime":
			return types.datetime.parse(value);
		case "application/x-uuid":
		case "application/x-password":
		case "application/x-choice":
		case "application/x-string":
			return value;
		case "application/x-integer":
			return parseInt(value);
		case "application/x-real":
		case "application/x-decimal":
			return parseFloat(value);
		case "application/x-boolean":
			return value == "true";
		case "application/x-json":
			return JSON.parse(value);
		default:
			if (isRichMediaContent(type)){
				return "b64";
			}else{
				return;
			}
	}
}


exports.formatJsonForJsxml = function(key, obj){
	var formatted;
	if (obj === null){
		formatted = {$: {"xsi:nil": "true"}};
	}else if (typeof obj === 'object'){
		if (Array.isArray(obj)){
			formatted = [];
			for (var i in obj){
				formatted.push(soapUtils.formatJsonForJsxml(subkey, obj[i]));
			}
		}else{
			formatted = {};
			for (var subkey in obj){
				formatted[subkey] = soapUtils.formatJsonForJsxml(subkey, obj[subkey]);
			}
		}
	}else{
		if (obj != null){
			formatted = {$value: obj.toString()};
		}
	}
	return formatted;
}

