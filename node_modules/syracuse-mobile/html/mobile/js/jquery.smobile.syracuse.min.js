(function(f){function o(a,c){if(null!=a.numberGroupSeparator)b.number.thousandSep=a.numberGroupSeparator;if(null!=a.numberDecimalSeparator)b.number.decimalSep=a.numberDecimalSeparator;b.lang2DateSettings(a.shortDate,a.shortTime,a.longTime);f.scroller&&f.scroller.setDefaults(b.dateSettings);k=!0;return c()}function l(a,c){var d=b.extractLang(a);if(!d)return d=b.extractLang(b.browserLanguage()),h.downloadLocale(d,function(d){d&&(b.setLanguage(d+"-"+d.toUpperCase()),b.lang2DateSettings(),f.scroller&&
f.scroller.setDefaults(b.dateSettings));j.userProfile.setLocale(a,c)});var e=b.currentLocale();if(d!==e)return h.downloadLocale(d,function(d){d&&(b.setLanguage(a),b.lang2DateSettings(),f.scroller&&f.scroller.setDefaults(b.dateSettings));j.userProfile.setLocale(a,c)});b.setLanguage(a);return c()}var b=f.helpers,h=f.sdata,j=f.smobile||{};j.staticui=j.staticui||{};var m=j.staticui,k=!1,i=h.capabilities;i.showSettings=!0;i.installUrl="/sdata/syracuse/collaboration/syracuse/dashboardDefs/$service/mobilePortlets";
i.authUrl="/sdata/syracuse/collaboration/syracuse/userProfiles/$service/current";i.loadLocale=!0;i.localeLoader=function(a,c){if(k&&!c)return a();if(!k&&b.online()&&(!i.authRequired||!i.auth))return h.GET(h.sdataHost+g.authurl,function(c){if(c){var e=c.selectedLocale;return o(e,function(){return l(e.code,a)})}l(b.language(),a)},null,{timeout:0});l(b.language(),a)};m.settings=function(){var a=b.locale();return{$title:a.administration.title,content:{cp:{layout:"BlockBodyLayout",data:{}},offline:{uiClass:"CheckBox",
data:{label:a.ui.offline,bind:"offline",action:"Offline"},parent:"cp"},c1:{uiClass:"CheckBox",data:{label:a.ui.saved_logon,bind:"autoLogon",action:"fixedLogin"},parent:"cp"},c11:{uiClass:"Html",data:{html:'<div class="s-m-fieldinfo">'+b.htmlEncode(a.ui.saved_logon_txt)+"</div>"},parent:"cp"},logonblock:{layout:"Block",data:{$isHidden:!1},parent:"cp"},c2:{uiClass:"Combo",data:{label:a.ui.auth_type,bind:"authType",value:"basic",items:[{value:"basic",title:"Basic"}]},parent:"logonblock"},e1:{uiClass:"Edit",
data:{label:a.ui.user,bind:"user"},parent:"logonblock"},pass:{uiClass:"Edit",data:{type:"password",label:a.ui.password,bind:"password"},parent:"logonblock"}},hbuttons:[{title:a.ui.save_item,action:"savesettings",jmdata:{"data-icon":"s-ok","data-transition":"back"}}],actions:{fixedLogin:function(){var a=f("#"+this.prefix+"logonblock");a&&a.toggleClass("s-m-hidden")},savesettings:function(a){var d=this.getValue(),e=b.settings();e.sdata=e.sdata||{};e.connect=e.connect||{};e.connect.authType=d.authType;
e.connect.autoLogon=d.autoLogon;e.connect.user=d.user;e.connect.password=d.password;e.offline=d.offline;b.settings("",e);b.setOffline(e.offline);f.smobile.removeAllPages([this.pageInfo.pageId]);f.smobile.goHome(this);a(!1)}}}};m.settings_data=function(){var a={},c=b.settings();c.sdata=c.sdata||{};c.connect=c.connect||{};a.autoLogon=c.connect.autoLogon;a.authType=c.connect.authType||"basic";a.user=c.connect.user||"";a.password=c.connect.password||"";a.offline=c.offline||!1;return a};m.language=function(){var a=
b.locale();return{$title:a.administration.title,content:{cp:{layout:"BlockBodyLayout",data:{}},c11:{uiClass:"Html",data:{html:a.change_language_warning},parent:"cp"},locale:{uiClass:"Combo",data:{label:a.ui.locale,bind:"locale",items:[]},parent:"cp"}},hbuttons:[{title:a.ui.save_item,action:"savelanguage",jmdata:{"data-icon":"s-ok","data-transition":"back"}}],actions:{savelanguage:function(){function a(){n&&n.doRefresh(!0);f.smobile.changePage("#langchanged",{allowSamePageTransition:!0,reverse:!0})}
function d(a,b){j.push(f.extend(!0,{},a));f.sdata.removeFromDB(a.id,b)}function e(){f.smobile.doinstall(j,{},function(a,c){0===a&&c?f.mobile.loading("show",{theme:"a",text:b.locale().ui.installing}):a===c&&f.mobile.loading("hide")},a)}function g(){h.getInstalledApps(!0,function(a){function b(c){c++;c===a.length?e():d(a[c],function(){b(c)})}b(-1)})}function i(){var a=n.getValue().locale,c=b.settings();c.locale=a;b.settings("",c);l(a,function(){g()})}var n=this,j=[],k=n.getValue(),m=b.settings();k.locale===
m.locale?(b.pushInfoMessage(b.locale().langnotchanged),f.smobile.changePage("#home",{allowSamePageTransition:!0,reverse:!0})):h.getSyncCount(function(a){a?(b.pushInfoMessage(b.locale().ui.rmvdrafts_lang),n.doRefresh()):i()})}}}};m.language_data=function(){var a={},c=b.settings();a.locale=c.locale||"en-US";return a};var g={lastCheck:null,checkInterval:0,authurl:i.authUrl,detect:function(a){var b="unknown";(a=a||"")&&(a=a.toUpperCase());0===a.indexOf("BASIC")?b="basic":0===a.indexOf("DIGEST")&&(b="digest");
return b},connect:function(a){var c=b.settings();c.connect=c.connect||{};b.clearErrors();if(i.resetInterval)g.lastCheck=null,i.resetInterval=!1;g.lastCheck&&new Date-g.lastCheck<g.checkInterval||h.GET(h.sdataHost+g.authurl,function(d,e){if(e&&401===e.status){if("basic"===g.detect(e["WWW-Authenticate"])){c.connect=c.connect||{};var f={Authorization:"Basic "+window.btoa((c.connect.user||"")+":"+(c.connect.password||""))};b.clearErrors();return h.GET(h.sdataHost+g.authurl,function(c){g.lastCheck=b.hasErrors()?
null:new Date;if(c&&!k){var d=c.selectedLocale;o(d,function(){return l(d.code,function(){return a(c,b.hasErrors())})})}l(b.language(),function(){return a(c,b.hasErrors())})},f,{Authenticate:!0})}g.lastCheck=null;return a(null,!0)}g.lastCheck=b.hasErrors()?null:new Date;return a(null,b.hasErrors())},{},{Authenticate:!0})}};h.capabilities.auth=function(a){return g.connect(a)};b.authHeaders=function(a,c){var d=b.settings();d.connect=d.connect||{};return d.connect.autoLogon&&"basic"===d.connect.authType&&
(a.Authorization="Basic "+window.btoa((d.connect.user||"")+":"+(d.connect.password||"")),c)?!0:!1}})(jQuery);
