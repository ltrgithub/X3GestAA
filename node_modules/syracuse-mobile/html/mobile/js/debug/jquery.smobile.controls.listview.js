"use strict";
(function($) {
	var that = $.smobile;
	var $helpers = $.helpers;
	that.controls = that.controls || {};
	that.controls.List = {
		sync: true,
		handler: function(c, after) {
			var controller = this;
			var html = [],
				options = c.data || [];
			html.push('<div class="ui-body">');
			html.push('<ul class="s-m-list"  id="' + c.id + '" data-role="listview"');
			html.push(' data-inset="true"');
			html.push('>');
			var items = options.items || [];
			items.forEach(function(item, index) {
				var cd = item.data;
				html.push('<li');
				$helpers.addJqmData(cd, html);
				if (cd.divider) {
					html.push(' data-role="list-divider"');
					html.push('>');
					html.push(cd.title);
				} else {
					if (cd.icon || cd.menu) {
						html.push(' class="' +  $helpers.ui.consts.normal_icon + '"');
						cd.css = [(cd.menu ? $helpers.ui.consts.menu_icon : $helpers.ui.consts.normal_icon)];
					}
					html.push('>');
					// create content
					var content = "";
					if (cd.menu) {
						content = $.smobile.ui.menuItem(cd.title, cd.description, cd.icon);
					}
					cd.url = that.ui.sdata_link(null, cd);
					that._addLink(html, cd, controller, function() {
						html.push(content);
					});
				}
				html.push('</li>');
			});
			html.push('</ul>');
			html.push('</div>');
			return after({
				html: html.join(''),
				bind: options.bind,
				options: options
			});
		}
	};
})(jQuery);