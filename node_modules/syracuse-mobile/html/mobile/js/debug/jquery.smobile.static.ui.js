"use strict";
(function($) {
	var that = $.smobile || {};
	var $helpers = $.helpers;
	that.staticui = that.staticui || {};
	var ui = that.staticui;
	ui.start = function() {
		var locale = $helpers.locale();
		return {
			"$title": locale.administration.title,
			"content": {
				"title": {
					"uiClass": "Html",
					"data": {
						"html": "<div><center><h4>" + locale.administration.welcome + "</h4></center></div>"
					}
				},
				"menu": {
					"uiClass": "AppDashboard",
					"data": {
						"items": []
					}
				}
			}
		};
	};
	ui.logout = function() {
		var locale = $helpers.locale();
		var loc = window.location.href;
		if (loc.indexOf('#') >= 0) loc = loc.substring(0, loc.indexOf('#'));
		var loc = loc + "?forcereload=" + new Date().getTime();
		return {
			"$title": locale.administration.title,
			"content": {
				"title": {
					"uiClass": "Html",
					"data": {
						"html": "<div><center><h4>" + $helpers.locale().logoutmsg + "</h4><br> <a href=\"" + loc + "\">Home</a></center></div>"
					}
				}
			}
		};
	};
	ui.langchanged = function() {
		var locale = $helpers.locale();
		var loc = window.location.href;
		if (loc.indexOf('#') >= 0) loc = loc.substring(0, loc.indexOf('#'));
		var loc = loc + "?forcereload=" + new Date().getTime();
		return {
			"$title": locale.administration.title,
			"content": {
				"title": {
					"uiClass": "Html",
					"data": {
						"html": "<div><center><h4>" + $helpers.locale().langchangedmsg + "</h4><br> <a href=\"" + loc + "\">" + $helpers.locale().langchangehome + "</a></center></div>"
					}
				}
			}
		};
	};
	ui.about = function() {
		var locale = $helpers.locale();
		var license = $.smobile.getLicenseInformation();
		var licenses = "";

		var getLabelAndValue = function(label, value) {
			return '<div class="s-m-style s-m-license-line"><label class="s-m-style s-m-license-label">' + $helpers.getLabel(label) + '</label><div class="s-m-style s-m-license-value">' + value + '</div></div>';

		};
		var version = null;
		license = null;
		license && license.forEach(function(lic) {
			// do not format date to locale settings, ISO cannonical is more safe and not likely to cause missinterpretations
			var startDate = lic.validFrom; // $helpers.date.toDateLocalized($helpers.date.isoToDate(lic.validFrom));
			var endDate = lic.expiryDate; // $helpers.date.toDateLocalized($helpers.date.isoToDate(lic.expiryDate));

			licenses = licenses + '<div class="s-m-style s-m-license-block">';
			licenses = licenses + getLabelAndValue("license.licensedTo", lic.licensedTo.name);
			licenses = licenses + getLabelAndValue("license.registrationNumber", lic.licensedTo.registrationNumber);
			licenses = licenses + getLabelAndValue("license.reference", lic.licensedTo.reference);

			// No info in license file yet
			// licenses = licenses +  getLabelAndValue("license.userLicense", '????');
			licenses = licenses + getLabelAndValue("license.installedBy", lic.reseller.name);

			// No info in license file yet
			//licenses = licenses +  getLabelAndValue("license.server", '????');
			licenses = licenses + getLabelAndValue("license.expiryDate", $helpers.format($helpers.getLabel("license.expiryDateValue"), [startDate, endDate]));
			licenses = licenses + '</div>';
			if (!version) {
				version = lic.productVersion;
			}
		});
		var html = '<div class="s-m-style s-m-about-box">' +
			$helpers.getLabel("about.text") +
			'<h5>' + $helpers.getLabel("about.update") + " " + version + '</h5>' +
			'<div data-role="tabs" id="aboutTabs">' +
			'  <div data-role="navbar">' +
			'    <ul id="aboutTabs">' +
			'    <li><a href="#" data-href="tabLic" class="ui-btn-active">' + $helpers.getLabel("about.license") + '</a></li>' +
			'    <li><a href="#" data-href="tabLeg">' + $helpers.getLabel("about.legal") + '</a></li>' +
			'    </ul>' +
			'  </div>' +
			'  <div id="tabLic">' +
			licenses +
			'  <div id="aboutVersionInfo" class="s-m-style s-m-license-block s-m-hidden">' +
			'    <hr>' +
			'    <div class="s-m-style s-m-license-line">' +
			'      <label class="s-m-style s-m-license-label">' + $helpers.getLabel("about.clientVersion") + '</label>' +
			'      <div class="s-m-style s-m-license-value">' + $helpers.buildDateString() + '</div>' +
			'    </div>' +
			'    <div class="s-m-style s-m-license-line">' +
			'      <div class="s-m-style s-m-license-value">' + navigator.userAgent + '</div>' +
			'    </div>' +
			'    <a class="s-m-hidden" data-role="button" href="#"></a>' +
			'  </div>' +
			'  </div>' +
			'  <div id="tabLeg" class="s-m-hidden"><p class="s-m-legaltext">' + $helpers.getLabel("about.legaltext") + '</p>' +
			'  </div>' +
			'</div>' +
			'</div>';
		return {
			"$title": $helpers.getLabel("administration.title"),
			"content": {
				"cp": {
					"layout": "BlockBodyLayout",
					"data": {}
				},
				"title": {
					"uiClass": "Html",
					"data": {
						"html": html
					},
					"parent": "cp"
				}
			}
		};
	};
	ui.apppanel = function(addback) {
		var r = {
			"uiClass": "panelView",
			"name": "apppanel",
			"data": {
				items: [{
					title: "",
					"items": [{
						"type": "mainmenu"
					}]
				}]
			}
		};
		if (addback === true) {
			r.data.items[0].items.push({
				"type": "back"
			});
		}
		return r;
	};
	ui.ctxpanel = function() {
		var locale = $helpers.locale();
		return {
			"uiClass": "panelView",
			"name": "ctxpanel",
			"data": {
				items: [{
					title: "",
					"items": []
				}]
			}
		};
	};

	ui.mainpanel = function() {
		var locale = $helpers.locale();
		return {
			"uiClass": "panelView",
			"name": "mainpanel",
			"data": {
				title: "",
				items: [{
					"items": [{
						"type": "mainmenu"
					}, {
						"type": "setup"
					}, {
						"type": "help"
					}, {
						"type": "settings"
					}, {
						"type": "language"
					}, {
						"type": "logout"
					}]
				}]
			}
		};

	};
	ui.applications = function() {
		return {
			"content": {
				"cp": {
					"layout": "BlockBodyLayout",
					"data": {}
				},
				"apps": {
					"uiClass": "AppsView"
				}
			}
		};
	};
	ui.apperrors = ui.errors = function() {
		var locale = $helpers.locale();
		return {
			"content": {
				"cp": {
					"layout": "BlockBodyLayout",
					"data": {}
				},
				"title": {
					"uiClass": "Html",
					"data": {
						"html": "<center><h2>" + locale.errorpagetitle + "</h2></center>"
					},
					"parent": "cp"
				}
			}
		};
	};
	ui.send = function() {
		var locale = $helpers.locale();
		return {
			"$title": locale.sendpagetitle,
			"content": {
				"cp": {
					"layout": "BlockBodyLayout",
					"data": {}
				},
				"toSend": {
					"uiClass": "SyncView",
					"parent": "cp"
				}
			}
		};
	};

})(jQuery);