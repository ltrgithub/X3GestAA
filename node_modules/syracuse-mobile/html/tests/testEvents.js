"use strict";

(function( ) {
	var sdataHost = (window.location.protocol.toLowerCase() === "file:") ? "" : (window.location.protocol + "//" + window.location.host);
	function logOnServer (msg, sync) {
		$.ajax({
			type: "GET",
			async: (sync !== true),
			url: sdataHost + "/sdata/syracuse/collaboration/syracuse/clientLogs/$service/log?text=" + encodeURIComponent(msg),
			success: function(xhr) { /* fire and forget */ }
		});
	};
	
	var lastlog = new Date();
	var num = 0, lastEvt, lastCpt=0,trace;
	function log(text){
		var now = new Date(), trace="";
		if (text != lastEvt){	
			trace += "\n" + (++num ) + ": " + text;
			if ((now.getTime() - lastlog.getTime()) > 1000){		
				trace += "\n******************";		
			}
			if (lastCpt>0){
			  trace += "\n" + num + " -> " + lastEvt + " - count=" + lastCpt;
			}	
			lastCpt = 0;
			lastEvt = text;
			$("#log").prepend(trace);
		}else{
		if(lastCpt==0){
			$("#log").prepend( "\n" + num + " -> start count");
		}
			lastCpt++;
		}
		lastlog = now;
	}
	var gestureEvts=["gesturestart", "gesturechange", "gestureend"];
	var touchEvts=["touchcancel", "touchend", "touchenter", "touchleave", "touchmove", "touchstart"];
	var mouseEvts=["mousedown", "mouseenter", "mousemove", "mouseout", "mouseleave", "mouseover", "mouseup", "mousewheel", "click", "dblclick"];
	var focusEvts=["focusin", "focusout", "focus"];
	var keyEvts=["keydown", "keypress", "keyup"];
	var miscEvts=["wheel", "blur", "change", "input", "orientationchange", "pagehide", "pageshow", "paste", "reset", "selection", "submit"];
	var allEvts=gestureEvts.concat(touchEvts).concat(mouseEvts).concat(focusEvts).concat(keyEvts).concat(miscEvts);



    $(document).ready(function() {
 
 		$(document.body).bind(allEvts.join(' '), function(evt){
 			log("body : " + evt.type)
 		});	
 		$("input").bind(allEvts.join(' '), function(evt){ 		
 			log($(evt.target).attr('id') + " : " + evt.type);
 			evt.stopPropagation();
 		});
 		
	});
})();
	