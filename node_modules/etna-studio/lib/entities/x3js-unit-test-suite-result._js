"use strict";

exports.entity = {
	$canDelete: true,
	$canCreate: true,
	$canEdit: false,
	$capabilities: "",
	$properties: {
		passed: {
			$title: "passed",
			$type: 'boolean',
			$compute: function(_, instance) {
				const results = instance.caseResults(_).toArray(_);
				return results.filter_(_, (_, res) => !res.passed(_)).length === 0;
			}
		},
		duration: {
			$title: "duration (ms)",
			$type: 'integer',
		}
	},
	$functions: {
		fill(_, result) {
			this.unitTest(_, result.unitTest);
			this.duration(_, result.result.stats.duration);
			const caseResults = this.caseResults(_);
			result.result.tests.forEach_(_, (_, t) => {
				caseResults.add(_).fill(_, t.title, t.duration,
					result.result.failures.filter(f => f.title === t.title).map(f => f.err)[0], !!result.result.pending.filter(f => f.title === t.title)[0]);
			});
		},
	},
	$relations: {
		unitTest: {
			$type: "x3jsUnitTest",
			$title: "unit test",
		},
		caseResults: {
			$type: "x3jsUnitTestCaseResults",
			$title: "case results",
			$isChild: true,
			$isReadOnly: true,
		},
	},
};