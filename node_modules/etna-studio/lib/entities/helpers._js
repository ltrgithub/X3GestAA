"use strict";

const entityHelper = require('etna/lib/api/entity-helper');
const classDescriptor = require('etna/lib/api/class-descriptor').descriptor;
const enumDescriptor = require('etna/lib/api/enum-descriptor').descriptor;
const messageDescriptor = require('etna/lib/api/message-descriptor').descriptor;

function synchronize(_, context, options) {
	entityHelper.fromCurrentSession(_, classDescriptor).synchronize(_, context, options);
	entityHelper.fromCurrentSession(_, enumDescriptor).synchronize(_, context, options);
	entityHelper.fromCurrentSession(_, messageDescriptor).synchronize(_, context, options);
}

exports.addCommonServices = function(entity) {
	Object.assign(entity.$services, {
		initialize: {
			$method: "POST",
			$isMethod: false,
			$facets: ["$query"],
			$title: "Initialize lists",
			$invocationMode: "async",
			$execute(_, context) {
				synchronize(_, context);
			}
		},
		reload: {
			$method: "POST",
			$isMethod: false,
			$facets: ["$query"],
			$title: "Reload sources",
			$invocationMode: "async",
			$execute(_, context) {
				synchronize(_, context, {
					onlyFiles: true
				});
			}
		},

	});
}