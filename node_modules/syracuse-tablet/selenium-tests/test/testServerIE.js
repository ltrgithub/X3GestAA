"use strict";

var webdriver = require('selenium-webdriver');

var until = webdriver.until;
var By = webdriver.By;

//=================================================================================================
//======================= Run with Serer local IE driver                         ==================
// java -jar selenium-server-standalone-2.44.0.jar -Dwebdriver.edge.driver=.\MicrosoftWebDriver.exe
//=================================================================================================
var expectedTitle = 'Sage X3 Mobile - Debug';



// --- connect to Server Local ------------------------------

var browser = new webdriver.Builder().usingServer('http://localhost:4444/wd/hub').
withCapabilities(webdriver.Capabilities.ie()).build();

browser.get('http://localhost:8124/syracuse-tablet/html/index_debug.html');
//Edge - crash  browser.manage().window().maximize(); 

//JS ?? browser.Manage().Timeouts().ImplicitlyWait(TimeSpan.FromSeconds(5));


//==================================== It works well with css  IE =============================================
var login_user = browser.wait(until.elementLocated(By.css('input[id="login-user"]')), 10000);
login_user.sendKeys("admin");
var login_password = browser.wait(until.elementLocated(By.css('input[id="login-password"]')), 10000);
login_password.sendKeys("admin");
var login_login = browser.wait(until.elementLocated(By.css('button[id="login-login"]')), 10000);
login_login.click();
//======================= okay for Edge ========================================================================
//var tiles = browser.wait(until.elementLocated(By.css('div[id="_welcome_MOBILEMENUGENERALVig45"]')), 10000);
//tiles.click();


var tiles1 = browser.wait(until.elementLocated(By.css('div[data-application-name="MOBILEMENUGENERAL"]')), 10000);
tiles1.click();



//var back = browser.wait(until.elementLocated(By.css('a[data-action="historyBack"]')), 10000);
//back.click();


var tilesx = browser.wait(until.elementLocated(By.css('div[data-gadget-id="2de96cd6-5294-4744-8a86-9d6b320c2f7b"]')), 30000);
tilesx.click();

//---- 5000 ok for query !!
setTimeout(function() {
	console.log('Before refresh ...');
}, 5000);

//-----------------------------
//--- it works for Edge !!! :-)
browser.navigate().refresh();


var tiles2 = browser.wait(until.elementLocated(By.css('div[data-application-name="MOBILE_APP_REQUEST"]')), 30000);
tiles2.click();


//-- query ok 1--
var query1 = browser.wait(until.elementLocated(By.css('div[data-gadget-id="78a42ea8-1566-4ac6-9497-f9308b021110"]')), 30000);
query1.click();

//-- detail ok 2--
var detail = browser.wait(until.elementLocated(By.css('div[data-action="chartDetail"]')), 30000);
detail.click();



//-- back button 
//var back2 = browser.wait(until.elementLocated(By.css('a[data-action="historyBack"]')), 10000);
//back2.click();


//-----------------------------
//--- it works for Edge also :-)
browser.navigate().refresh();


//----- menu quit panel ----------------------------------------------------------------
(browser.wait(until.elementLocated(By.css('a[href="#"][role="button"]')), 10000)).click();
(browser.wait(until.elementLocated(By.css('a.list-group-item > span.fa.fa-user')), 10000)).click();
(browser.wait(until.elementLocated(By.xpath('//button[@type="button"]')), 10000)).click();


// =============================================================================================================
browser.getTitle().then(function(title) {
	if (expectedTitle === title) {
		console.log("IE - Verification Successful - The correct title is displayed on the IE page.=" + title);
		console.log("IE - Quit() executed.");
	} else {
		console.log("##Verification Failed - An incorrect title is displayed on the web page.");
	}
});

browser.quit();