"use strict";

var UT = require("./../lib/ut");


describe("Welcome page cstmis", function() {
	// Tile to be customized
	function _pickFirstTile() {
		return UT.Dom.waitLocated(UT.Sel.Class("s-m-tile"), 500);
	};

	// Open browser, login, ensure browser is closed once all tests were executed
	UT.defaultBeforeAndAfter();

	it("Welcome page cstmis - Open panel", function() {
		this.timeout(5000);
		return UT.Dom.click(
				UT.Sel.DataAction("pageConfig"),
				null,
				UT.Dom.waitVisible$(UT.Sel.DataAction("configTile"), 500))
			.then(function() {
				// Wait for events to be hooked
				return UT.sleep(500);
			})
			.then(function() {
				return _pickFirstTile();
			})
			.then(function($$tile) {
				return UT.Dom.click(
					UT.Sel.DataAction("configTile"),
					$$tile,
					UT.sleep$(50));
			})
			.then(function() {
				return UT.App.waitModal("config-tile");
			});
	});

	it("Welcome page cstmis - Customize color and title", function() {
		this.timeout(2000);
		return UT.Dom.click(UT.Sel.DataAction("clickColor", "orange"))
			.then(function() {
				return UT.Dom.setValue(UT.Sel.Id("tile_title"), "Test case tile");
			});
	});

	it("Welcome page cstmis - Close panel", function() {
		this.timeout(5000);
		return UT.Dom.click(UT.Sel.DataAction("$validate"))
			.then(function() {
				return UT.Dom.click(UT.Sel.DataAction("cancelPageConfig"));
			});
	});

	it("Welcome page cstmis - Check result", function() {
		this.timeout(2000);
		return _pickFirstTile()
			.then(function($$tile) {

				return UT.Dom.getAttr($$tile, "class")
					.then(function(cls) {
						UT.assert(cls).contains("s-m-color-orange", "Color set on tile");
					})
					.then(function() {
						return UT.Dom.getText(UT.Sel.Css(".s-m-title > div"), $$tile);
					})
					.then(function(text) {
						UT.assertEquals(text, "Test case tile", "Tile title was set");
						// Could also be written as
						// UT.assert(text).equals("Test case tile", "Tile title was set");
					});
			});
	});
});