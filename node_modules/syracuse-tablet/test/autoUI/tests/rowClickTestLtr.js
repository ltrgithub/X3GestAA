"use strict";

var UT = require("./../lib/ut");

// Test if navigation from a query to a details facet works using AQMCRUDM
//--- Panel filter "desc/asc" -- after "desc/asc" show detail - HOME - Logout
describe("AQMCRUDM query row click and Menu-Filter-desc", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
	});

	it("Test detail page navigation row 1", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.Row(1), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 20000));
			})
	});
	//-- Back button --------------------------------------------------------------------------	
	it("Test detail page navigation back button", function() {
		this.timeout(10000);
		return UT.App.back();
	});
	//-- Menu Sort&filter --------------------------------------------------------------------------
	it("Test Sort&filter", function() {
		return UT.App.panelSortFilter();

	});
	//-- desc span[2]  asc span[3] ----------
	it("Test Sort desc", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-params='CODE']/span[2][@data-params='desc']"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//li[@data-params='CODE']/span[2][@data-params='desc']"))
					.then(function() {
						//--- Valide filter --------------------------------------------------------------
						return UT.Dom.click(UT.Sel.DataParams("apply"))
							.then(function() {
								// Simulate an error in order to click on nex event
								return UT.App.waitPage("[To improve]", 1000);
							});
					});
			});
	});
	//-------detail  row 2 after desc ------------------------------------------
	it("Test detail page navigation row 2", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.Row(2), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 20000));
			})
	});

	//-- Back button --------------------------------------------------------------------------	
	it("Test detail page navigation back button", function() {
		this.timeout(10000);
		return UT.App.back();
	});
	// ---------------------------------------------------------------------------------------
	//-- Menu Sort again--------------------------------------------------------------------
	// ---------------------------------------------------------------------------------------
	it("Test menu sort&filter again", function() {
		return UT.App.panelSortFilter();
	});
	//---------------------------------
	//-- asc span[3] ------------------
	//---------------------------------
	it("Test Sort asc", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-params='CODE']/span[3][@data-params='asc']"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//li[@data-params='CODE']/span[3][@data-params='asc']"))
					.then(function() {
						//--- Valide filter --------------------------------------------------------------
						return UT.Dom.click(UT.Sel.DataParams("apply"))
							.then(function() {
								// Simulate an error in order to click on nex event
								return UT.App.waitPage("[To improve]", 1000);
							});
					});
			});
	});
	it("Test detail page navigation row 1 again", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.Row(1), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 20000));
			})
	});
	//-- Welcome page ----------------------------------------------------------	
	it("Welcome page", function() {
		return UT.Dom.click(UT.Sel.DataAction("home"), null, UT.App.waitPage$("HOME", 10000))
			.then(function() {
				//-- Simulate an error in order to click on nex event
				return UT.App.waitPage("[To improve]", 1000);
			});
	});
	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: BigMac  icon ---------------------
	// ---------------------------------------------------------------------
	it("Logout for Sort desc/asc", function() {
		return UT.App.logout();
	});


});