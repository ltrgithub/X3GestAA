"use strict";

var UT = require("./../lib/ut");

// Test if navigation from a query to a details facet works using AQMCRUDM
describe("AQMCRUDM query row click and Menu-Filter-desc", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
	});

	it("Test detail page navigation row 1", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.Row(1), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 20000));
			})
	});


	//-- Back button ----------------------------------------------------------	
	it("Test detail page navigation back button", function() {
		this.timeout(10000);
		return UT.App.back();
	});

	//-- Menu filter ------------------------
	it("Test menu filter", function() {
		this.timeout(10000);
		return UT.Dom.waitLocated(UT.Sel.DataAction("actionArray", "panelfiltersort"), 12000)
			.then(function() {
				return UT.Dom.click(UT.Sel.DataAction("actionArray", "panelfiltersort"));
			})

	});
	//-- desc span[2]  asc span[3] ----------
	it("Test filter desc", function() {
		this.timeout(10000);
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-params='CODE']/span[2][@data-params='desc']"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//li[@data-params='CODE']/span[2][@data-params='desc']"))
					.then(function() {
						//--- Valide filter ---------------------------
						return UT.Dom.click(UT.Sel.DataParams("apply"))
							.then(function() {
								return UT.App.waitPage("AQMCRUDM.$query").then(function() {
									//-- not here -> doesn't work ?!!
									return UT.Dom.click(UT.Sel.DataAction("home"));
									//return UT.Dom.click(UT.Sel.Xpath("//a[@data-naction='home']/span[@class='fa fa-home']"));			                   
									//return UT.Dom.click(UT.Sel.Xpath("//a[@data-menuitem-id='$create']"),null,UT.App.waitPage("AQMCRUDM.$edit",3000));		                   
								});
							});
					});
			});

	});

	//-- Welcome page ----------------------------------------------------------	
	it("Welcome page", function() {
		this.timeout(10000);
		return UT.Dom.click(UT.Sel.DataAction("home"), null, UT.App.waitPage$("HOME", 10000));
	});

	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: BigMac  icon ---------------------
	// ---------------------------------------------------------------------
	//-- doesn't work here
	it("Logout for Filter desc", function() {
		return UT.App.logout();

	});



});