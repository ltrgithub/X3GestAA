"use strict";

var UT = require("./../lib/ut");

// Test if navigation from a query to a details facet works using AQMCRUDM
describe("AQMCRUDM authoring table", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "http://localhost:8124/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
			//testPageUrl: "http://po101512:8124/mobile2/$client/$local/$dataset/mobileDashboard('unitTestsDashboard')"
	});

	//-- Welcome page ----------------------------------------------------------	
	it("Welcome page", function() {
		return UT.Dom.click(UT.Sel.DataAction("home"), null, UT.App.waitPage$("HOME", 1000))
			.then(function() {
				//-- Simulate an error in order to click on next event
				return UT.App.waitPage("[To improve]", 1000);
			});
	});

	it("unitTests", function() {
		this.timeout(10000);
		return UT.Dom.waitLocated(UT.Sel.X3Field("unitTestsDashboard"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.X3Field("unitTestsDashboard"))
					.then(function() {
						return UT.App.waitPage("unitTestDashboard.$mobileDashboard", 1000);
					});
			});

	});

	it("Request sublevel", function() {
		this.timeout(10000);
		return UT.Dom.waitLocated(UT.Sel.X3Field("unitTestGraphicSubLevel"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.X3Field("unitTestGraphicSubLevel"))
					.then(function() {
						//-- 	for next event ----------------------		
						return UT.App.waitPage("[To improve]", 1300);
					});
			});

	});

	it("Page design open", function() {
		this.timeout(10000);
		return UT.Dom.waitLocated(UT.Sel.DataAction("openGlobalPanel"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.DataAction("openGlobalPanel")).then(function() {
						return UT.Dom.waitVisible(UT.Sel.DataAction("designPage"), 500);
					})
					.then(function() {
						return UT.Dom.click(UT.Sel.DataAction("designPage"));
					})
					.then(function() {
						return UT.Dom.waitLocated(UT.Sel.Id("authPanelControlType"), 1000)
							.then(function() {});
					});
			});
	});

	//-- panel left authoring GX3APP_QUERY_QAQTGRAP -------------------------------------------
	it("Test panel left Table click", function() {
		//return UT.App.selectAuthTreeElement("$resources")
		//.then (function() {		
		//});
		//===================================================		
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='GX3APP_QUERY_QAQTGRAP']/ul/li/ul/li[@data-s-ut-auth-elmt-id='$resources']"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='GX3APP_QUERY_QAQTGRAP']/ul/li/ul/li[@data-s-ut-auth-elmt-id='$resources']"))
					.then(function() {
						return UT.App.waitPage("[To improve]", 1000);
					});
			});

	});

	//-- panel left authoring Stat GX3APP_STAT_ZDOM -------------------------------------------
	//it("Test panel left Table click", function() {															
	//	return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='GX3APP_STAT_ZDOM']/ul/li/ul/li[@data-s-ut-auth-elmt-id='$resources']"), 1000)
	//	.then (function () {				
	//	return UT.Dom.click(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='GX3APP_STAT_ZDOM']/ul/li/ul/li[@data-s-ut-auth-elmt-id='$resources']"))
	//	.then(function() {
	//	    return UT.App.waitPage("[To improve]", 1000);
	//	});
	//	});		
	//});

	// ============================================================================						
	//-- Close  button authoring NOT Save -----------------------------------------
	// ============================================================================	
	it("Test close not Save button", function() {
		return UT.Dom.waitLocated(UT.Sel.Id("auth-btn-close-id"), 800).then(function() {
			//-- Close button "auth-btn-close-id" -------------- 	        
			return UT.Dom.click(UT.Sel.Id("auth-btn-close-id"))
				.then(function() {
					//----Modal Question yes/no : yes : quit no Save -------------------
					return UT.Dom.waitLocated(UT.Sel.DataAction2("yes"), 1000)
						.then(function() {
							return UT.Dom.click(UT.Sel.DataAction2("yes"))
								.then(function() {
									return UT.App.waitPage("[To improve]", 1000);
								});
						});

				});
		});
	});
	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: BigMac  icon ---------------------
	// ---------------------------------------------------------------------
	it("Logout for authoring", function() {
		return UT.App.logout();
	});

});