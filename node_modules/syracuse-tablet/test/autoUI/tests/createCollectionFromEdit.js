"use strict";

var UT = require("./../lib/ut");
//=========================================================================================
//============ Test using AQMCRUDM, Create Collection lines from Edit facet================
//========================================================================================= 
describe("AQMCRUDM Collection create", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
			//pagewait: "QA_DASHBOARD_AQMCRUDM.$mobileDashboard"
	});

	it("Read detail page row number 6", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.Row(6), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 9000));
			})
	});

	it("Get some values of the record", function() {
		var TEXTDES;
		var TDATE;
		return UT.Dom.getValue(UT.Sel.X3Field("TDATE")).then(function(text) {
			TDATE = text;
			UT.log("TDATE: " + text);
			return UT.Dom.getValue(UT.Sel.X3Field("TEXTDES0")).then(function(textdes) {
				UT.log("TEXTDES: " + textdes);
				UT.assertEquals(true, (textdes || "").indexOf("Manhattan modif") > -1, "Word: 'Manhattan modif' not found");
			})
		})

	});
	// ---------------------------------------------------------------------
	//------ Edit mode  ----------------------------------------------------
	// ---------------------------------------------------------------------
	it("Edit facet", function() {
		var $$$edit = UT.Sel.X3Link("$edit");
		return UT.Dom.waitLocated($$$edit, 1500).then(function() {
			return UT.Dom.click($$$edit, null, UT.App.waitPage$("AQMCRUDM.$edit", 2000));
		});
	});

	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});

	it("Click on sign plus (Addrow)..", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVADEVCOL1']/div[2]/table/tfoot/tr/td/div/a[@data-naction='addRow']"), 1500).then(function() {
			return UT.Dom.click(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVADEVCOL1']/div[2]/table/tfoot/tr/td/div/a[@data-naction='addRow']"), null, UT.App.waitPage$("noname", 2000));
		});
	});

	it("Set values for Second collection...", function() {
		return UT.Dom.setValue(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVCOL2SUBCODE']/div[2]/div//input[@class='s-m-meta form-control']"), "1200")
			.then(function() {
				return UT.Dom.setValue(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVCOL2TEXTDES']/div[2]/div//input[@class='s-m-meta form-control']"), "Description of key")
					.then(function() {
						return UT.Dom.setValue(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVCOL2SITE_REF']/div[2]/div//input[@class='s-m-meta form-control']"), "001A")
							.then(function() {
								return UT.Dom.setValue(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='PDATE_COL1']/div[2]/div//input[@class='s-m-meta form-control']"), "12/28/2016")
									.then(function() {
										//--- Validate the input of collection --------------------------------
										return UT.Dom.click(UT.Sel.Xpath("//a[@data-menuitem-id='accept']/i"));
									});

							});
					});
			});
	});
	//---- return to main page ----------------------------------------------------
	it("Waiting for browser finish..", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});

	it("Save.final..", function() {
		return UT.Dom.click(UT.Sel.Xpath("//a[@data-sdata-action-name='$save']"))
			.then(function() {
				//-- It is ok - click on this panel confirm -------------------------------------
				return UT.Dom.waitLocated(UT.Sel.Xpath("//span[@class='glyphicon glyphicon-remove']"), 1200)
					.then(function() {
						return UT.Dom.click(UT.Sel.Xpath("//span[@class='glyphicon glyphicon-remove']"))
					});

			});
	});
	it("Waiting for browser finish...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1500);
	});
	// ----------------------------------------------------------------------------
	//--- Edit mode again to remove the line created ------------------------------
	//------ Edit mode  -----------------------------------------------------------
	// ----------------------------------------------------------------------------
	it("Edit facet again", function() {
		var $$$edit = UT.Sel.X3Link("$edit");
		return UT.Dom.waitLocated($$$edit, 1500).then(function() {
			return UT.Dom.click($$$edit, null, UT.App.waitPage$("AQMCRUDM.$edit", 2000));
		});
	});
	it("Waiting for browser finish..", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1500);
	});

	// ------- Remove the line ----------------------------------------------------------
	it("Remove line...", function() {
		return UT.Dom.click(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='ADEVADEVCOL1']/div[2]/table/tbody/tr[2][@data-s-ut-row-idx='1']/td[9]/div/a[@data-params='rowDelete']"))
			.then(function() {
				return UT.App.waitPage("[To improve]", 500);
			});
	});

	it("Save.final again..", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//a[@data-sdata-action-name='$save']"), 1500).then(function() {
			return UT.Dom.click(UT.Sel.Xpath("//a[@data-sdata-action-name='$save']"))
				.then(function() {
					//-- It is ok - click on this panel confirm -------------------------------------
					return UT.Dom.waitLocated(UT.Sel.Xpath("//span[@class='glyphicon glyphicon-remove']"), 1200)
						.then(function() {
							return UT.Dom.click(UT.Sel.Xpath("//span[@class='glyphicon glyphicon-remove']"))
						});
				});
		});
	});

	it("Waiting for browser finish..", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 2000);
	});
	// ----------------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: Burger  icon ----------------------------
	// ----------------------------------------------------------------------------
	it("Logout of Edit facet", function() {
		return UT.App.logout();
	});

});