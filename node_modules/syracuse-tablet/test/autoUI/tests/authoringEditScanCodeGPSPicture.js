"use strict";

var UT = require("./../lib/ut");
//=================================================================================================
//============ Test using AQMCRUDM, Control ScanBarCode/GPS/Picture from Edit facet================
//================================================================================================= 
describe("AQMCRUDM Edit facet authoring", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
	});
	it("Waiting...", function() {
		// Simulate an error in order to click on nex event
		return UT.App.waitPage("[To improve]", 1000);
	});

	it("Read detail page row number 3(key 9)", function() {
		return UT.Dom.find(UT.Sel.Row(3), UT.Sel.X3Field("$resources"))
			.then(function($$gridRow) {
				return UT.Dom.click($$gridRow, null, UT.App.waitPage$("AQMCRUDM.$details", 10000))
					.then(function() {
						// Simulate an error in order to click on next event
						return UT.App.waitPage("[To improve]", 2000);
					})

			})

	});

	it("Get some values of the record", function() {
		var TEXTDES;
		var TDATE;
		return UT.Dom.getValue(UT.Sel.X3Field("TDATE")).then(function(text) {
			TDATE = text;
			UT.log("TDATE: " + text);
			return UT.Dom.getValue(UT.Sel.X3Field("TEXTDES0")).then(function(textdes) {
				UT.log("TEXTDES: " + textdes);
				UT.assertEquals(true, (textdes || "").indexOf("Updated ok modif yes") > -1, "Word: 'Updated ok modif yes' not found");
			})
		})

	});
	it("Waiting...", function() {
		// Simulate an error in order to click on nex event
		return UT.App.waitPage("[To improve]", 2000);
	});
	// ---------------------------------------------------------------------
	//------ Edit mode  ----------------------------------------------------
	// ---------------------------------------------------------------------
	it("Edit facet for ScanBarCode-GPS", function() {
		var $$$edit = UT.Sel.X3Link("$edit");
		return UT.Dom.waitLocated($$$edit, 2000).then(function() {
			return UT.Dom.click($$$edit, null, UT.App.waitPage$("AQMCRUDM.$edit", 9000));
		});
	});

	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});

	it("Page design open", function() {
		return UT.App.openDesignPage2().then(function() {
			UT.log("==>Page design open. Found.");
		});
	});
	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});
	// --  Description property -- check to ScanBarcode
	it("Description property for ScanBarCode", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='TEXTDES0']"), 3000).then(function() {
			return UT.Dom.click(UT.Sel.Xpath("//p[@title='TEXTDES0']"))
				.then(function() {
					return UT.Dom.waitLocated(UT.Sel.Xpath("//a[@aria-controls='collapse_auth_prop_scanBarcode']"), 2000).then(function() {
						return UT.Dom.click(UT.Sel.Xpath("//a[@aria-controls='collapse_auth_prop_scanBarcode']"))
							.then(function() {
								return UT.Dom.waitLocated(UT.Sel.Xpath("//label[@id='auth_opt_scanBarcode_true_lab']"))
									.then(function() {
										return UT.Dom.click(UT.Sel.Xpath("//label[@id='auth_opt_scanBarcode_true_lab']"));
									});

							});
					});
				});

		});
	});

	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});

	// --  Address line1 property -- check to GPS  yes
	it("Address line1 property for GPS", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//li[@data-s-ut-auth-elmt-id='ALIG1']"), 3000).then(function() {
			return UT.Dom.click(UT.Sel.Xpath("//p[@title='ALIG1']"))
				.then(function() {
					return UT.Dom.waitLocated(UT.Sel.Xpath("//a[@aria-controls='collapse_auth_prop_scanGPS']"), 2000).then(function() {
						return UT.Dom.click(UT.Sel.Xpath("//a[@aria-controls='collapse_auth_prop_scanGPS']"))
							.then(function() {
								return UT.Dom.waitLocated(UT.Sel.Xpath("//label[@id='auth_opt_scanGPS_true_lab']"))
									.then(function() {
										return UT.Dom.click(UT.Sel.Xpath("//label[@id='auth_opt_scanGPS_true_lab']"));
									});

							});
					});
				});

		});
	});

	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});

	// ============================================================================						
	//-- Close  button authoring NOT Save -----------------------------------------
	// ============================================================================		
	it("Close Not Save authoring button", function() {
		return UT.App.closeAuthNotSave().then(function() {
			UT.log("Close Not Save button. Found.");
		});
	});
	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});
	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: Burger  icon ---------------------
	// ---------------------------------------------------------------------
	it("Logout of Edit facet ScanBarCode-GPS", function() {
		return UT.App.logout();
	});

});