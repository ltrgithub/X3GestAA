"use strict";

var UT = require("./../lib/ut");
//---======================================================================================================= 
// Test using AQMCRUDM - Panel add/remove filter with value 40, afterward, click on $last, $first and Logout
//---======================================================================================================= 
describe("AQMCRUDM query add/remove filter", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
	});
	//-- Menu Filter --------------------------------------------------------------------------
	it("Test Filter link", function() {
		return UT.App.panelSortFilter();
	});
	//-- Filter add ----------
	it("Test Filter add value", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//a[contains(text(),'Filter')]"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//a[contains(text(),'Filter')]"))
					.then(function() {
						//--- Sign plus --------------------------------------------------------
						return UT.Dom.click(UT.Sel.DataParams("addFilter"))
							.then(function() {
								// wait query page
								return UT.App.waitPage("AQMCRUDM.$query", 1000)
									.then(function() {
										//return UT.Dom.setControlValue(UT.Sel.Xpath("//div[@class='s-m-value edit']"),"Code");					    
										return UT.Dom.waitLocated(UT.Sel.Xpath("//div[@class='s-m-value edit']"), 1000)
											.then(function() {
												return UT.Dom.click(UT.Sel.Xpath("//select[@class='form-control s-m-meta removeEmptyOption']/option[2]"))
													.then(function() {
														//--change OPERATORS to less than
														return UT.Dom.click(UT.Sel.Xpath("//div[@data-s-ut-field-x3name='OPERATORS']/div[2]/select/option[3]"))
															.then(function() {
																return UT.App.waitPage("[To improve]", 1000);
															});
													});
											});
									});

							});
					});
			});
	});
	// ---------------- Filter validate with less than value 40 setted ----------------------
	it("Filter validate", function() {
		//--- set value 40 to filter ---------------------------------------------------------
		return UT.Dom.setValue(UT.Sel.Xpath("//input[@class='s-m-meta form-control']"), "40")
			.then(function() {
				//---- validate criteria --------------------------------------------------------
				return UT.Dom.click(UT.Sel.DataParams("submitFilterEdit"))
					.then(function() {
						return UT.App.validateFilter();
					});
			});

	});

	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});
	it("Remove filter", function() {
		return UT.Dom.waitLocated(UT.Sel.Xpath("//i[@class='s-m-filtered fa fa-filter']"), 1000)
			.then(function() {
				return UT.Dom.click(UT.Sel.Xpath("//i[@class='s-m-filtered fa fa-filter']"))
					.then(function() {
						return UT.Dom.click(UT.Sel.DataParams("delete,0"))
							.then(function() {
								return UT.App.validateFilter();
							});
					});
			});

	});
	it("Waiting...", function() {
		// Simulate an error in order to click on next event
		return UT.App.waitPage("[To improve]", 1000);
	});
	//----- Pagination -----------------------------------------------------
	it("Test $last icon", function() {
		return UT.App.pagination("$last");
	});

	it("Test $first icon", function() {
		return UT.App.pagination("$first");
	});
	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: BigMac  icon ---------------------
	// ---------------------------------------------------------------------
	it("Logout add/remove filter", function() {
		return UT.App.logout();
	});


});