"use strict";

var UT = require("../ut");

describe("Welcome page customization", function() {
	before(function() {
		this.timeout(10000);
		return UT.login();
	});

	describe("Customization", function() {
		// Tile to be customized
		function _pickFirstTile() {
			return UT.DOM.waitLocated(UT.SEL.$$Class("s-m-tile"), 500);
		};

		it("Open panel", function() {
			this.timeout(2000);
			return UT.DOM.click(
				UT.SEL.$$DataAction("pageConfig"),
				null,
				UT.DOM.waitVisible$(UT.SEL.$$DataAction("configTile"), 500))
				.then(function() {
					// Wait for events to be hooked
					return UT.sleep(500);
				})
				.then(function() {
					return _pickFirstTile();
				})
				.then(function($tile) {
					return UT.DOM.click(
						UT.SEL.$$DataAction("configTile"),
						$tile,
						UT.sleep$(50));
				})
				.then(function() {
					return UT.App.waitModal("config-tile");
				});
		});

		it("Customize color and title", function() {
			this.timeout(2000);
			return UT.DOM.click(UT.SEL.$$DataAction("clickColor", "orange"))
				.then(function() {
					return UT.DOM.setValue(UT.SEL.$$Id("tile_title"), "Test case tile");
				});
		});

		it("Close panel", function() {
			this.timeout(1000);
			return UT.DOM.click(UT.SEL.$$DataAction("$validate"))
				.then(function() {
					return UT.DOM.click(UT.SEL.$$DataAction("cancelPageConfig"));
				});
		});

		it("Check result", function() {
			this.timeout(2000);
			return _pickFirstTile()
				.then(function($tile) {

					return UT.DOM.getAttr($tile, "class")
						.then(function(cls) {
							UT.assert(cls).contains("s-m-color-orange", "Color set on tile");
						})
						.then(function() {
							return UT.DOM.getText(UT.SEL.$$Css(".s-m-title > div"), $tile);
						})
						.then(function(text) {
							UT.assert(text).equals("Test case tile", "Tile title was set");
						});
				});
		});
	});

	after(function() {
		return UT.Driver.quit();
	});
});