"use strict";

var UT = require("./../lib/ut");

// Test if navigation from a query to a details facet works using AQMCRUDM
describe("AQMCRUDM authoring table", function() {
	UT.defaultBeforeAndAfter({
		testPageUrl: "{$hostPort}/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query"
	});

	it("Page design open", function() {
		this.timeout(10000);
		return UT.Dom.click(UT.Sel.DataAction("openGlobalPanel")).then(function() {
				return UT.Dom.waitVisible(UT.Sel.DataAction("designPage"), 500);
			})
			.then(function() {
				return UT.Dom.click(UT.Sel.DataAction("designPage"));
			})
			.then(function() {
				return UT.Dom.waitLocated(UT.Sel.Id("authPanelControlType"), 1000);
			});
	});


	//-- Save  button --------------------------------------------------------------			
	it("Test Save button", function() {
		this.timeout(10000);
		//-- Save button "auth-btn-save-id"  --       
		return UT.Dom.click(UT.Sel.Id("auth-btn-save-id"))
			.then(function() {
				return UT.Dom.waitLocated(UT.Sel.DataAction2("clickType", "personal_copy"), 3000)
					.then(function() {
						return UT.Dom.click(UT.Sel.DataAction2("clickType", "personal_copy"))
							.then(function() {
								return UT.Dom.click(UT.Sel.DataAction2("$validate"))
									.then(function() {
										//--- Saved succes. icon close to quit
										return UT.Dom.waitLocated(UT.Sel.DataAction2("$cancel"), 3000).then(function() {
											return UT.Dom.click(UT.Sel.DataAction2("$cancel")).then(function() {
												//Close button "auth-btn-close-id"  	        
												return UT.Dom.click(UT.Sel.Id("auth-btn-close-id"))
													.then(function() {
														//- Wait for $query page to become visible again
														return UT.App.waitPage("AQMCRUDM.$query");
													})
											})
										});
									})
							})

					})

			});
	});
	// ---------------------------------------------------------------------
	//------ Logout with span.fa.fa-bars: BigMac  icon ---------------------
	// ---------------------------------------------------------------------
	it("Logout for authoring", function() {
		return UT.App.logout();
	});

});