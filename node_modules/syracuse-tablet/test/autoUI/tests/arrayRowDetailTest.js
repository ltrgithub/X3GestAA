"use strict";

var UT = require("../ut");


describe("Check array row detail navigation", function() {
	// Open browser, login, ensure browser is closed once all tests were executed
	UT.defaultBeforeAndAfter();

	it("Navigate to test page", function() {
		this.timeout(20000);
		return UT.App.navToTestPage("testDefaultAQMCRUDM.$mobileDashboard")
		// Find grid and open vignette in full screen
		.then(function() {
			return UT.DOM.find(UT.SEL.$$Field("$resources"));
		})
			.then(function(grid) {
				return UT.DOM.click(UT.SEL.$$Row(0), grid, UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$query"));
			})
		// Click grid in fullscreen to go to details
		.then(function(grid) {
			return UT.DOM.find(UT.SEL.$$Field("$resources"));
		})
			.then(function(grid) {
				return UT.DOM.click(UT.SEL.$$Row(0), grid, UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$details"));
			});
	});

	it("Open and apply authoring", function() {
		this.timeout(15000);
		return UT.App.openDesignPage()
			.then(function() {
				return UT.App.selectAuthTreeElement("ADEVADEVICEL");
			})
			.then(function() {
				return UT.App.authSelectOption("arrayOptions", "showRowDetailLink");
			})
			.then(function() {
				return UT.App.closeDesignPage();
			});
	});

	it("Navigate to row detail page", function() {
		this.timeout(10000);
		return UT.DOM.find(UT.SEL.$$Field("ADEVADEVICEL"))
			.then(function(grid) {
				return UT.DOM.find(UT.SEL.$$Row(0), grid);
			})
			.then(function(row) {
				return UT.DOM.click(UT.SEL.$$DataAction("rowDetail"),
					row,
					UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$details.ADEVADEVICEL", 5000));
			})
			.then(function() {
				return UT.assertOk("Navigation to row detail successful");
			})
			.thenCatch(function() {
				return UT.assertFail("Navigation to row detail failed");
			});
	});
});