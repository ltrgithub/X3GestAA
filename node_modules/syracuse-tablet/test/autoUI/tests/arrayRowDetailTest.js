"use strict";

var UT = require("./../lib/ut");


describe("Check array row detail navigation", function() {
	// Open browser, login, ensure browser is closed once all tests were executed
	UT.defaultBeforeAndAfter();

	it("Navigate to test page", function() {
		this.timeout(20000);
		return UT.App.navToTestPage("testDefaultAQMCRUDM.$mobileDashboard")
			// Find grid and open vignette in full screen
			.then(function() {
				return UT.Dom.find(UT.Sel.X3Field("$resources"));
			})
			.then(function($$grid) {
				return UT.Dom.click(UT.Sel.Row(0), $$grid, UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$query"));
			})
			// Click grid in fullscreen to go to details
			.then(function() {
				return UT.Dom.find(UT.Sel.X3Field("$resources"));
			})
			.then(function($$grid) {
				return UT.Dom.click(UT.Sel.Row(0), $$grid, UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$details"));
			});
	});

	it("Open and apply authoring", function() {
		this.timeout(15000);
		return UT.App.openDesignPage()
			.then(function() {
				return UT.App.selectAuthTreeElement("ADEVADEVICEL");
			})
			.then(function() {
				return UT.App.authSelectOption("arrayOptions", "showRowDetailLink");
			})
			.then(function() {
				return UT.App.closeDesignPage();
			});
	});

	it("Navigate to row detail page", function() {
		this.timeout(10000);
		return UT.Dom.find(UT.Sel.X3Field("ADEVADEVICEL"))
			.then(function($$grid) {
				return UT.Dom.find(UT.Sel.Row(0), $$grid);
			})
			.then(function($$row) {
				return UT.Dom.click(UT.Sel.DataAction("rowDetail"),
					$$row,
					UT.App.waitPage$("x3.erp.SUPERV.AQMCRUDM.$details.ADEVADEVICEL", 5000));
			})
			.then(function() {
				return UT.assertOk("Navigation to row detail successful");
			});
		//			It's better to not thenCatch here, because if we catch, exception information will be lost, just bubble it up the stack		
		//			.thenCatch(function() {
		//				return UT.assertFail("Navigation to row detail failed");
		//			});
	});
});