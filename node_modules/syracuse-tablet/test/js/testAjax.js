"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("testAjax");
var testUtil = require('syracuse-tablet/test/js/testUtil');
var ajax = require('syracuse-tablet/html/js/ajax/ajax').getAjax().ajax;

exports.test = function() {
	var deferred = new $.Deferred();

	var testset;
	var testcase;
	var baseUrl = "http://10.72.100.30:8124";

	testset = testUtil.addTestset("Ajax test");
	testcase = testUtil.addTestcase(testset, "GET json file");

	var result = ajax("GET", baseUrl + "/syracuse-tablet/test/fixtures/dummyToGet.json", null, null);

	result.then(function(data, respHeaders) {
		testUtil.addResult(testcase, "Data returned", data != null);
		testUtil.addResult(testcase, "Status is 200 for existing file", respHeaders.status === 200);
		testUtil.addResult(testcase, "Message parsed correctly", data && data.success === true);
	}, function(status, respHeaders) {
		testUtil.addResult(testcase, "Request failed!", false);
	}).then(function() {
		result = ajax("GET", baseUrl + "/syracuse-tablet/test/fixtures/IDoNotExist.json", null, null);

		result.then(function(data, respHeaders) {
			testUtil.addResult(testcase, "Returned success also file is not there", true);
		}, function(status, respHeaders) {
			testUtil.addResult(testcase, "Status is 404 for non existent file", respHeaders.status === 404);
		}).then(function() {
			deferred.resolve();
		});
	}).then(function() {
		deferred.resolve();
	});

	return deferred.promise();
};