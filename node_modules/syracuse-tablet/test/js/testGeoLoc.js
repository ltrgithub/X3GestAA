"use strict";

var testUtil = require('syracuse-tablet/test/js/testUtil');
var winjs = require('syracuse-tablet/html/js/helpers/winjs');

exports.test = function() {
	var deferred = new $.Deferred();

	var testset;
	var testcase;

	testset = testUtil.addTestset("Geo location test");
	testcase = testUtil.addTestcase(testset, "Get location");

	// Only test on real device
	if (!winjs.isAvailable()) {
		testUtil.addResult(testcase, "Service not available, test ended, this is not an error", true);
		deferred.resolve();
		return deferred.promise();
	}

	winjs.callWinJS("geoLoc", "getLocation").then(function(data) {
		testUtil.addResult(testcase, "Getting location", data.valid);
		if (data.valid) {
			var src = "https://www.google.com/maps?q=" + data.latitude + "," + data.longitude;
			var res = testUtil.addResult(testcase, src, data.valid);
			$('<a href="' + src + '">' + src + '</a>').appendTo(res.$root);
		};
	}, function(error) {
		testUtil.addResult(testcase, "Error getting location", false, error);
	}).then(function() {
		deferred.resolve();
	});

	return deferred.promise();
};