"use strict";
var log = require('syracuse-tablet/html/js/helpers/logger').log;
var testUtil = require('syracuse-tablet/test/js/testUtil');

var parser = require('syracuse-tablet/html/js/sdata/parser').Parser;
var sdataUtil = require('syracuse-tablet/html/js/sdata/sdataUtil');

var resources = require('./resources');

exports.test = function() {
	var deferred = new $.Deferred();

	var testset = testUtil.addTestset("Sdata test");
	var testcase1 = testUtil.addTestcase(testset, "Where parameter to JSON object");
	var testcase2 = testUtil.addTestcase(testset, "Execwhere with expression '(login ge 'D') and (firstName ge 'G')'");

	// test case 1. test parse method
	var res = false;
	for (var ii = 1, jj = 3; ii < jj; ii++) {
		try {
			res = JSON.stringify(resources['expectedOutput' + ii]) === JSON.stringify(parser.parse(resources['input' + ii]));
			testUtil.addResult(testcase1, "WHERE param value '" + resources['input' + ii] + "' parsed !", res);
		} catch (e) {
			testUtil.addResult(testcase1, "An error occured during parse of WHERE param value '" + resources['input' + ii] + "'", res, e.message);
		}
	}

	// test case 2. test execWhere method (based on expectedOutput1)
	res = false;
	for (var ii = 1, jj = 3; ii < jj; ii++) {
		//res = sdataUtil.execWhere(resources["dataContext"+ii],resources.expectedOutput1) == resources["expectedMatch"+ii];
		//testUtil.addResult(testcase2, "With '"+JSON.stringify(resources["dataContext"+ii])+"', expected value is '"+resources["expectedMatch"+ii]+"'", res);
	}

	// test end
	deferred.resolve();
	return deferred.promise();
};