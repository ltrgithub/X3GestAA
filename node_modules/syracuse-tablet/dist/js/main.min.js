/*!
  * Bowser - a browser detector
  * https://github.com/ded/bowser
  * MIT License | (c) Dustin Diaz 2015
  */

/*!
 * Platform.js v1.3.1 <http://mths.be/platform>
 * Copyright 2014-2016 Benjamin Tan <https://d10.github.io/>
 * Copyright 2011-2013 John-David Dalton <http://allyoucanleet.com/>
 * Available under MIT license <http://mths.be/mit>
 */

/*!

 handlebars v4.0.5

Copyright (C) 2011-2015 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

/*
* jQuery Mobile v1.4.5
* http://jquerymobile.com
*
* Copyright 2010, 2014 jQuery Foundation, Inc. and other contributors
* Released under the MIT license.
* http://jquery.org/license
*
*/

/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */

/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */

define("syracuse-tablet/html/js/common/modules",["require","exports","module"],function(require,exports,module){var _modules={};exports.addModule=function(name,module){_modules[name]=module},exports.get=function(name){var module=_modules[name];if(!module)throw console.log("Modules:"+Object.keys(_modules)),new Error("No such module: "+name);return module},window.smModules=exports}),define("syracuse-tablet/html/js/helpers/jsutils",["require","exports","module"],function(require,exports,module){function bindFn(fn,context){var args=arguments.length>2?Array.prototype.splice.call(arguments,2):null;return function boundFn(){var callBackArgs=arguments;return args&&args.length>0&&args.forEach(function(a){Array.prototype.push.call(callBackArgs,a)}),fn.apply(context?context:this,callBackArgs)}}var _APP_RELEASE_REP="/dist/",_APP_DVLP_REP="/html/",_APP_RELEASE_INDEX="index.html",_APP_DVLP_INDEX="index_debug.html",_stringToHtml=function(str){return(str||"").replace(/\n/g,"<br>")},_strStartsWith=function(str,s){return!str||str.length==0||s==null||s.length===0||str.length<s.length?!1:s.length===1?str.charAt(0)===s.toString():str.indexOf(s.toString())===0},_strEndsWith=function(str,s){return!str||str.length==0||s==null||str.length<s.length?!1:(s=s.toString(),s.length===1?str.charAt(str.length-1)===s:str.lastIndexOf(s)===str.length-s.length)},_strCapitalize=function(str){return!str||str.length===0?str:str.charAt(0).toUpperCase()+str.slice(1)};window.exports||(window.exports=window);var _purlOptions={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","querystring","anchor"],q:{name:"query",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},_parseURL=function(str){str=str&&str.replace(/\?.*(\@)/g,function(m){return m.replace(/\@/g,"%40")});var o=_purlOptions,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=decodeURIComponent($2))}),uri},_urlToString=function(u){if(!u)return"";var url="";u.protocol&&u.host&&(url+=u.protocol+"://"+u.host,u.port.length!=0&&(url+=":"+u.port)),url+=u.directory?u.directory.trim():"",u.file&&(_strEndsWith(u.directory,"/")||(url+="/"),url+=u.file);var query="";for(var p in u.query)query.length!=0&&(query+="&"),query+=p+"="+encodeURIComponent(u.query[p]);return query.length!=0&&(url+="?"+query),u.anchor&&(url+="#"+u.anchor),url},_curUrl,_getCurrentUrl=function(){return _curUrl?_curUrl:(_curUrl=_parseURL(window.location.href),_curUrl)},_getUrlContextId=function(){var contextId,sessStorage=typeof window.sessionStorage!="undefined"?window.sessionStorage:null;sessStorage&&(contextId=sessStorage.getItem("__urlContext__"),sessStorage.removeItem("__urlContext__"));if(!contextId){var url=exports.getCurrentUrl();contextId=url.quey?url.query.context:null}return contextId},_setUrlContextId=function(){var sessStorage=typeof window.sessionStorage!="undefined"?window.sessionStorage:null;sessStorage&&sessStorage.removeItem("__urlContext__");var url=_parseURL(window.location.href);try{var contextId=url.query&&url.query.context;console.log("_setUrlContextId",contextId),sessStorage&&contextId&&contextId.trim().length>0&&(sessStorage.setItem("__urlContext__",contextId),delete url.query.context)}catch(e){}var file=url.file;url.file=url.path.indexOf(_APP_RELEASE_REP)>0?_APP_RELEASE_INDEX:_APP_DVLP_INDEX,url.path=url.path.replace(file,url.file),window.location.replace(_urlToString(url))},_isInstanceOf=function(o,name){if(o==null)return!1;var ctor=o.constructor;return ctor&&ctor.$smClasses?ctor.$smClasses.indexOf(name)>-1:!1},_addInheritanceInfo=function(ctor,parent){var classes=[],name=_getClassName(ctor);name&&classes.push(name);if(parent&&parent.$smClasses){var i;for(i=0;i<parent.$smClasses.length;i++)classes.push(parent.$smClasses[i])}ctor.$smClasses=classes},_getClassName=function(klass){if(!klass)return null;if(klass.name)return klass.name;if(klass.$smClasses&&klass.$smClasses.length>0)return klass.$smClasses[0];var ctorName=klass&&klass.toString();return ctorName=ctorName.match(/^function\s*([^\s(]+)/),ctorName&&ctorName.length>1?ctorName[1]:null},_isError=function(o){return o&&o instanceof Error?!0:o&&Error.prototype.toString===o.toString},_isDOMException=function(o){return o&&o.constructor&&o.constructor.name==="DOMException"},_stackRegexp,_cleanStack=function(stack,max,html){if(Array.isArray(stack))return stack;if(!_stackRegexp){var host=window.location.protocol+"//"+window.location.host,path=window.location.pathname.split("/").splice(0,2).join("/"),withPath=host+path,requirePath=host+"/requireJS"+path;_stackRegexp={r1:new RegExp(withPath,"g"),r2:new RegExp(requirePath,"g")}}max=max==null?5:max;if(stack){var array=stack.split&&stack.split("\n")||stack,res;array.length>0&&array.forEach(function(l){var pos1=l.lastIndexOf(".js");if(pos1>0){var pos2=l.lastIndexOf("/",pos1);pos1>0&&(res||(res=[]),res.push(l.substring(pos2)))}else res||(res=[]),res.push(l)}),!res&&_stackRegexp?stack=_stackRegexp?stack.replace(_stackRegexp.r1,"").replace(_stackRegexp.r2,""):stack:stack=res.join("\n")}else stack="";return stack=stack.split("\n"),max&&(res=[],stack.forEach(function(l){l.indexOf(".js")>-1?max>0&&(res.push(l),max--):res.push(l)}),stack=res.join(html?"<br>&nbsp&nbsp&nbsp&nbsp&nbsp":"\n")),stack},_convertToDiagnoses=function(e,html){e==null&&(e="No error message");if(typeof e=="string")return{$diagnoses:[{$severity:"error",$message:html?_stringToHtml(e):e}]};if(_isError(e)||_isDOMException(e))return{$diagnoses:[{$message:html?_stringToHtml(e.message):e.message,$stackTrace:_cleanStack(e.stack,null,html),$severity:"error"}]};if(e.$diagnoses&&Array.isArray(e.$diagnoses))return e;var res={$diagnoses:[]},diag={$severity:"error",$message:e.message||e.$message||e.$title||"No error message"};html&&(diag.$message=_stringToHtml(diag.$message)),res.$diagnoses.push(diag);var detail=e.detail;detail&&(_isError(detail)?(detail.message&&(diag.$stackTrace=(diag.$stackTrace?diag.$stackTrace+"\n":"")+detail.message),detail.stack&&(diag.$stackTrace=(diag.$stackTrace?diag.$stackTrace+"\n":"")+_cleanStack(detail.stack,null,html))):diag.$stackTrace=(diag.$stackTrace?diag.$stackTrace+"\n":"")+JSON.stringify(detail));var xe=e;while(xe.$exception!=null)_$exceptionAdd(res,xe.$exception,html),xe=xe.$exception;return res},_$exceptionAdd=function(res,$exception,html){if(!$exception)return;var msg=typeof $exception=="string"?$exception:$exception.message||$exception.$message,stk=$exception.stack;(msg||stk)&&res.$diagnoses.push({$message:html?_stringToHtml(msg):msg,$stackTrace:stk?_cleanStack(stk,null,html):"",$severity:"error"})},_getPropByPath=function(object,path,cache){if(path==null||object==null)return null;var pathStr,pathArray;if(Array.isArray(path)){if(path.length===0)return null;pathArray=path,pathStr=pathArray.join(".")}else pathArray=path.split("."),pathStr=path;if(cache&&cache[pathStr]!=null)return cache[pathStr];var data=object[pathArray[0]];for(var i=1;i<pathArray.length;i++){if(data==null)return null;if(!$.isPlainObject(data)==null)throw new Error("_getPropByPath - Unexpected non-plainobject");data=data[pathArray[i]]}return cache&&(cache[pathStr]=data),data};exports.concatArrays=function(){var args=[];for(var i=0;i<arguments.length;i++)arguments[i]!=null&&args.push(arguments[i]);return[].concat.apply([],args)},exports.getPropByPath=_getPropByPath,exports.addInheritanceInfo=_addInheritanceInfo,exports.isInstanceOf=_isInstanceOf,exports.isError=_isError,exports.isDOMException=_isDOMException,exports.cleanStack=_cleanStack,exports.convertToDiagnoses=_convertToDiagnoses,exports.bindFn=bindFn,exports.getCurrentUrl=_getCurrentUrl,exports.getUrlHost=function(url){url?$.isPlainObject(url)?url.protocol||(url=_getCurrentUrl()):url.smStartsWith("http")?url=exports.parseURL(url):url=_getCurrentUrl():url=_getCurrentUrl();var res=url.protocol+"://"+url.host;return url.port!=null&&(res+=":"+url.port),res},exports.getCurrentHostUrl=function(){return exports.getUrlHost(null)},exports.getUrlContextId=_getUrlContextId,exports.setUrlContextId=_setUrlContextId,exports.parseURL=_parseURL,exports.urlToString=_urlToString,exports.strStartsWith=_strStartsWith,exports.strEndsWith=_strEndsWith,exports.strCapitalize=_strCapitalize,exports.isReleaseVersion=function(){return document.location.href.indexOf("/index_debug.html")<0&&document.location.href.indexOf("/index_release.html")<0},exports.isDvlpVersion=function(){return window.location.href.indexOf("/index_debug.html")>-1||window.location.href.indexOf("/index_joined.html")>-1},exports.isTestEnvironment=function(){return window.location.href.indexOf("/syracuse-tablet/test/index.html")>-1},exports.getResourcesBasePath=function(){return exports.isReleaseVersion()?"/syracuse-tablet"+_APP_RELEASE_REP:"/syracuse-tablet"+_APP_DVLP_REP},exports.getClassName=_getClassName,exports.stringToDiagnoses=function(e){return{$diagnoses:[{$message:e}]}}}),define("syracuse-tablet/html/js/helpers/serverLog",["require","exports","module"],function(require,exports,module){function line(text){if(!text)return null;var now=new Date,trace=null;if(lastlog==null||now.getTime()-lastlog.getTime()>1e3)text="********Mobile********\n"+ ++num+": "+text,lastlog=now;return text}var sdataHost=window.location.protocol.toLowerCase()==="file:"?"":window.location.protocol+"//"+window.location.host,_logWriteUrl="/requireJS/log/write?text=",lastlog=new Date,num=0,lastlog,_maxLevel=0,_stdTypeToString=function(a,type){if(a==null)return null;type=type||typeof a;switch(type){case"number":case"string":case"boolean":return new String(a)}return null},_objectToString=function(a,level,flat){level=level==null?0:level;if(a==null)return null;if(typeof a!="object")return null;var res,v;if(Array.isArray(a)){res=[],a.forEach(function(b){v=_stdTypeToString(b),v?res.push(v):flat!==!0&&level<=_maxLevel&&(v=_objectToString(b,level+1),v&&res.push(v))});if(res.length==0)return null}else{res={};for(var p in a){var v=_stdTypeToString(a[p]);v?res[p]=v:flat!==!0&&level<=_maxLevel&&(v=_objectToString(a[p],level+1),v&&(res[p]=v))}$.isEmptyObject(res)&&(res=null)}return level==0?JSON.stringify(res,null,2):res},_argsToString=function(args,flat){var msg=[];for(var i=0;i<args.length;i++){var a=args[i];if(a==null)continue;var text=_stdTypeToString(a);text?msg.push(text):(text=_objectToString(a,0,flat),text&&msg.push(text))}return msg.length==0?null:msg.join(" ")},_log=function(msg){msg=line(msg);if(msg==null)return null;$.ajax({type:"GET",async:!1,url:sdataHost+_logWriteUrl+encodeURIComponent(msg),success:function(xhr){}})};exports.log=function(){_log(_argsToString(arguments,!1))},exports.logFlat=function(){_log(_argsToString(arguments,!0))}}),define("syracuse-tablet/html/js/helpers/logger",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/serverLog"],function(require,exports,module){function _getLogger(module,force){if(force!==!0)return null;var logger=function(){var text,errs;for(var i=0;i<arguments.length;i++)jsutils.isError(arguments[i])?(errs||(errs=[]),errs.push(arguments[i])):(text||(text=["["+module+"]: "]),text.push(arguments[i]));text&&text.length>1&&_log(text.join(" ")),errs&&errs.forEach(function(e){_log("["+module+"]: "+e.message),e.stack&&_log(jsutils.cleanStack(e.stack))})};return logger}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),serverLog=require("syracuse-tablet/html/js/helpers/serverLog"),_logOnServer=!1,_log;if(window.smNativeLogger&&window.smNativeLogger.log)_log=function(){var args=[];for(var i=0;i<arguments.length;i++)args.push(arguments[i]);window.smNativeLogger.log(args.join(""))};else{var _console=_logOnServer===!0?serverLog:window.console;_log=function(){if(!_console)return;var text=[];for(var i=0;i<arguments.length;i++){var a=arguments[i];a!=null&&(jsutils.isError(a)?_console&&_console.log&&_console.log(a.message,"\n",jsutils.cleanStack(a.stack)):text.push(a))}_console&&_console.log&&_console.log(text.join(text," "))}}window&&(window.logger=_log),exports.log=_log,exports.getLogger=_getLogger}),!function(name,definition){typeof module!="undefined"&&module.exports?module.exports=definition():typeof define=="function"&&define.amd?define("syracuse-tablet/html/deps/bowser/bowser",definition):this[name]=definition()}("bowser",function(){function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[1]||""}function getSecondMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[2]||""}var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),chromeBook=/CrOS/.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),result;/opera|opr/i.test(ua)?result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(ua)?result={name:"Yandex Browser",yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(ua)?(result={name:"Windows Phone",windowsphone:t},edgeVersion?(result.msedge=t,result.version=edgeVersion):(result.msie=t,result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(ua)?result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:chromeBook?result={name:"Chrome",chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(ua)?result={name:"Microsoft Edge",msedge:t,version:edgeVersion}:/chrome|crios|crmo/i.test(ua)?result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:iosdevice?(result={name:iosdevice=="iphone"?"iPhone":iosdevice=="ipad"?"iPad":"iPod"},versionIdentifier&&(result.version=versionIdentifier)):/sailfish/i.test(ua)?result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(ua)?result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(ua)?(result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)&&(result.firefoxos=t)):/silk/i.test(ua)?result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)}:android?result={name:"Android",version:versionIdentifier}:/phantom/i.test(ua)?result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)?result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(ua)?(result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(ua)&&(result.touchpad=t)):/bada/i.test(ua)?result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(ua)?result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier}:/safari/i.test(ua)?result={name:"Safari",safari:t,version:versionIdentifier}:result={name:getFirstMatch(/^(.*)\/(.*) /),version:getSecondMatch(/^(.*)\/(.*) /)},!result.msedge&&/(apple)?webkit/i.test(ua)?(result.name=result.name||"Webkit",result.webkit=t,!result.version&&versionIdentifier&&(result.version=versionIdentifier)):!result.opera&&/gecko\//i.test(ua)&&(result.name=result.name||"Gecko",result.gecko=t,result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i)),!result.msedge&&(android||result.silk)?result.android=t:iosdevice&&(result[iosdevice]=t,result.ios=t);var osVersion="";result.windowsphone?osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):iosdevice?(osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i),osVersion=osVersion.replace(/[_\s]/g,".")):android?osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i):result.webos?osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):result.blackberry?osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i):result.bada?osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i):result.tizen&&(osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i)),osVersion&&(result.osversion=osVersion);var osMajorVersion=osVersion.split(".")[0];if(tablet||iosdevice=="ipad"||android&&(osMajorVersion==3||osMajorVersion==4&&!mobile)||result.silk)result.tablet=t;else if(mobile||iosdevice=="iphone"||iosdevice=="ipod"||android||result.blackberry||result.webos||result.bada)result.mobile=t;return result.msedge||result.msie&&result.version>=10||result.yandexbrowser&&result.version>=15||result.chrome&&result.version>=20||result.firefox&&result.version>=20||result.safari&&result.version>=6||result.opera&&result.version>=10||result.ios&&result.osversion&&result.osversion.split(".")[0]>=6||result.blackberry&&result.version>=10.1?result.a=t:result.msie&&result.version<10||result.chrome&&result.version<20||result.firefox&&result.version<20||result.safari&&result.version<6||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6?result.c=t:result.x=t,result}var t=!0,bowser=detect(typeof navigator!="undefined"?navigator.userAgent:"");return bowser.test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if(typeof browserItem=="string"&&browserItem in bowser)return!0}return!1},bowser._detect=detect,bowser}),function(){function capitalize(string){return string=String(string),string.charAt(0).toUpperCase()+string.slice(1)}function cleanupOS(os,pattern,label){var data={6.4:"10",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return pattern&&label&&/^Win/i.test(os)&&(data=data[0,/[\d.]+$/.exec(os)])&&(os="Windows "+data),os=String(os),pattern&&label&&(os=os.replace(RegExp(pattern,"i"),label)),os=format(os.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").split(" on ")[0]),os}function each(object,callback){var index=-1,length=object?object.length:0;if(typeof length=="number"&&length>-1&&length<=maxSafeInteger)while(++index<length)callback(object[index],index,object);else forOwn(object,callback)}function format(string){return string=trim(string),/^(?:webOS|i(?:OS|P))/.test(string)?string:capitalize(string)}function forOwn(object,callback){for(var key in object)hasOwnProperty.call(object,key)&&callback(object[key],key,object)}function getClassOf(value){return value==null?capitalize(value):toString.call(value).slice(8,-1)}function isHostType(object,property){var type=object!=null?typeof object[property]:"number";return!/^(?:boolean|number|string|undefined)$/.test(type)&&(type=="object"?!!object[property]:!0)}function qualify(string){return String(string).replace(/([ -])(?!$)/g,"$1?")}function reduce(array,callback){var accumulator=null;return each(array,function(value,index){accumulator=callback(accumulator,value,index,array)}),accumulator}function trim(string){return String(string).replace(/^ +| +$/g,"")}function parse(ua){function getLayout(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getManufacturer(guesses){return reduce(guesses,function(result,value,key){return result||(value[product]||value[0,/^[a-z]+(?: +[a-z]+\b)*/i.exec(product)]||RegExp("\\b"+qualify(key)+"(?:\\b|\\w*\\d)","i").exec(ua))&&key})}function getName(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getOS(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(ua))&&(result=cleanupOS(result,pattern,guess.label||guess)),result})}function getProduct(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(ua)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(ua))&&((result=String(guess.label&&!RegExp(pattern,"i").test(guess.label)?guess.label:result).split("/"))[1]&&!/[\d.]+/.test(result[0])&&(result[0]+=" "+result[1]),guess=guess.label||guess,result=format(result[0].replace(RegExp(pattern,"i"),guess).replace(RegExp("; *(?:"+guess+"[_-])?","i")," ").replace(RegExp("("+guess+")[-_.]?(\\w)","i"),"$1 $2"))),result})}function getVersion(patterns){return reduce(patterns,function(result,pattern){return result||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(ua)||0)[1]||null})}function toStringPlatform(){return this.description||""}var context=root,isCustomContext=ua&&typeof ua=="object"&&getClassOf(ua)!="String";isCustomContext&&(context=ua,ua=null);var nav=context.navigator||{},userAgent=nav.userAgent||"";ua||(ua=userAgent);var isModuleScope=isCustomContext||thisBinding==oldRoot,likeChrome=isCustomContext?!!nav.likeChrome:/\bChrome\b/.test(ua)&&!/internal|\n/i.test(toString.toString()),objectClass="Object",airRuntimeClass=isCustomContext?objectClass:"ScriptBridgingProxyObject",enviroClass=isCustomContext?objectClass:"Environment",javaClass=isCustomContext&&context.java?"JavaPackage":getClassOf(context.java),phantomClass=isCustomContext?objectClass:"RuntimeObject",java=/\bJava/.test(javaClass)&&context.java,rhino=java&&getClassOf(context.environment)==enviroClass,alpha=java?"a":"α",beta=java?"b":"β",doc=context.document||{},opera=context.operamini||context.opera,operaClass=reOpera.test(operaClass=isCustomContext&&opera?opera["[[Class]]"]:getClassOf(opera))?operaClass:opera=null,data,arch=ua,description=[],prerelease=null,useFeatures=ua==userAgent,version=useFeatures&&opera&&typeof opera.version=="function"&&opera.version(),isSpecialCasedOS,layout=getLayout(["Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),name=getName(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel",{label:"SRWare Iron",pattern:"Iron"},"K-Meleon","Konqueror","Lunascape","Maxthon","Midori","Nook Browser","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser","Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),product=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nook","PlayBook","PlayStation 4","PlayStation 3","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),manufacturer=getManufacturer({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),os=getOS(["Windows Phone ","Android","CentOS","Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);layout&&(layout=[layout]),manufacturer&&!product&&(product=getProduct([manufacturer]));if(data=/\bGoogle TV\b/.exec(product))product=data[0];/\bSimulator\b/i.test(ua)&&(product=(product?product+" ":"")+"Simulator"),name=="Opera Mini"&&/\bOPiOS\b/.test(ua)&&description.push("running in Turbo/Uncompressed mode");if(/^iP/.test(product))name||(name="Safari"),os="iOS"+((data=/ OS ([\d_]+)/i.exec(ua))?" "+data[1].replace(/_/g,"."):"");else if(name=="Konqueror"&&!/buntu/i.test(os))os="Kubuntu";else if(manufacturer&&manufacturer!="Google"&&(/Chrome/.test(name)&&!/\bMobile Safari\b/i.test(ua)||/\bVita\b/.test(product)))name="Android Browser",os=/\bAndroid\b/.test(os)?os:"Android";else if(!name||(data=!/\bMinefield\b|\(Android;/i.test(ua)&&/\b(?:Firefox|Safari)\b/.exec(name)))name&&!product&&/[\/,]|^[^(]+?\)/.test(ua.slice(ua.indexOf(data+"/")+8))&&(name=null),(data=product||manufacturer||os)&&(product||manufacturer||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(os))&&(name=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(os)?os:data)+" Browser");(data=/\((Mobile|Tablet).*?Firefox\b/i.exec(ua))&&data[1]&&(os="Firefox OS",product||(product=data[1])),version||(version=getVersion(["(?:Cloud9|CriOS|CrMo|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",qualify(name),"(?:Firefox|Minefield|NetFront)"])),layout=="iCab"&&parseFloat(version)>3?layout=["WebKit"]:layout!="Trident"&&(data=/\bOpera\b/.test(name)&&(/\bOPR\b/.test(ua)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(ua)&&"WebKit"||!layout&&/\bMSIE\b/i.test(ua)&&(os=="Mac OS"?"Tasman":"Trident"))?layout=[data]:/\bPlayStation\b(?! Vita\b)/i.test(name)&&layout=="WebKit"&&(layout=["NetFront"]),name=="IE"&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(ua)||0)[1])?(name+=" Mobile",os="Windows Phone "+(/\+$/.test(data)?data:data+".x"),description.unshift("desktop mode")):/\bWPDesktop\b/i.test(ua)?(name="IE Mobile",os="Windows Phone 8+",description.unshift("desktop mode"),version||(version=(/\brv:([\d.]+)/.exec(ua)||0)[1])):name!="IE"&&layout=="Trident"&&(data=/\brv:([\d.]+)/.exec(ua))?(/\bWPDesktop\b/i.test(ua)||(name&&description.push("identifying as "+name+(version?" "+version:"")),name="IE"),version=data[1]):(name=="Chrome"||name!="IE")&&(data=/\bEdge\/([\d.]+)/.exec(ua))&&(name="Microsoft Edge",version=data[1],layout=["Trident"]);if(useFeatures){if(isHostType(context,"global")){java&&(data=java.lang.System,arch=data.getProperty("os.arch"),os=os||data.getProperty("os.name")+" "+data.getProperty("os.version"));if(isModuleScope&&isHostType(context,"system")&&(data=[context.system])[0]){os||(os=data[0].os||null);try{data[1]=context.require("ringo/engine").version,version=data[1].join("."),name="RingoJS"}catch(e){data[0].global.system==context.system&&(name="Narwhal")}}else typeof context.process=="object"&&(data=context.process)?(name="Node.js",arch=data.arch,os=data.platform,version=/[\d.]+/.exec(data.version)[0]):rhino&&(name="Rhino")}else getClassOf(data=context.runtime)==airRuntimeClass?(name="Adobe AIR",os=data.flash.system.Capabilities.os):getClassOf(data=context.phantom)==phantomClass?(name="PhantomJS",version=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch):typeof doc.documentMode=="number"&&(data=/\bTrident\/(\d+)/i.exec(ua))&&(version=[version,doc.documentMode],(data=+data[1]+4)!=version[1]&&(description.push("IE "+version[1]+" mode"),layout&&(layout[1]=""),version[1]=data),version=name=="IE"?String(version[1].toFixed(1)):version[0]);os=os&&format(os)}version&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(version)||/(?:alpha|beta)(?: ?\d)?/i.exec(ua+";"+(useFeatures&&nav.appMinorVersion))||/\bMinefield\b/i.test(ua)&&"a")&&(prerelease=/b/i.test(data)?"beta":"alpha",version=version.replace(RegExp(data+"\\+?$"),"")+(prerelease=="beta"?beta:alpha)+(/\d+\+?/.exec(data)||"")),name=="Fennec"||name=="Firefox"&&/\b(?:Android|Firefox OS)\b/.test(os)?name="Firefox Mobile":name=="Maxthon"&&version?version=version.replace(/\.[\d.]+/,".x"):name=="Silk"?(/\bMobi/i.test(ua)||(os="Android",description.unshift("desktop mode")),/Accelerated *= *true/i.test(ua)&&description.unshift("accelerated")):/\bXbox\b/i.test(product)?(os=null,product=="Xbox 360"&&/\bIEMobile\b/.test(ua)&&description.unshift("mobile mode")):(/^(?:Chrome|IE|Opera)$/.test(name)||name&&!product&&!/Browser|Mobi/.test(name))&&(os=="Windows CE"||/Mobi/i.test(ua))?name+=" Mobile":name=="IE"&&useFeatures&&context.external===null?description.unshift("platform preview"):(/\bBlackBerry\b/.test(product)||/\bBB10\b/.test(ua))&&(data=(RegExp(product.replace(/ +/g," *")+"/([.\\d]+)","i").exec(ua)||0)[1]||version)?(data=[data,/BB10/.test(ua)],os=(data[1]?(product=null,manufacturer="BlackBerry"):"Device Software")+" "+data[0],version=null):this!=forOwn&&product!="Wii"&&(useFeatures&&opera||/Opera/.test(name)&&/\b(?:MSIE|Firefox)\b/i.test(ua)||name=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(os)||name=="IE"&&(os&&!/^Win/.test(os)&&version>5.5||/\bWindows XP\b/.test(os)&&version>8||version==8&&!/\bTrident\b/.test(ua)))&&!reOpera.test(data=parse.call(forOwn,ua.replace(reOpera,"")+";"))&&data.name&&(data="ing as "+data.name+((data=data.version)?" "+data:""),reOpera.test(name)?(/\bIE\b/.test(data)&&os=="Mac OS"&&(os=null),data="identify"+data):(data="mask"+data,operaClass?name=format(operaClass.replace(/([a-z])([A-Z])/g,"$1 $2")):name="Opera",/\bIE\b/.test(data)&&(os=null),useFeatures||(version=null)),layout=["Presto"],description.push(data));if(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(ua)||0)[1]){data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data];if(name=="Safari"&&data[1].slice(-1)=="+")name="WebKit Nightly",prerelease="alpha",version=data[1].slice(0,-1);else if(version==data[1]||version==(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(ua)||0)[1]))version=null;data[1]=(/\bChrome\/([\d.]+)/i.exec(ua)||0)[1],data[0]==537.36&&data[2]==537.36&&parseFloat(data[1])>=28&&name!="IE"&&name!="Microsoft Edge"&&(layout=["Blink"]),!useFeatures||!likeChrome&&!data[1]?(layout&&(layout[1]="like Safari"),data=(data=data[0],data<400?1:data<500?2:data<526?3:data<533?4:data<534?"4+":data<535?5:data<537?6:data<538?7:data<601?8:"8")):(layout&&(layout[1]="like Chrome"),data=data[1]||(data=data[0],data<530?1:data<532?2:data<532.05?3:data<533?4:data<534.03?5:data<534.07?6:data<534.1?7:data<534.13?8:data<534.16?9:data<534.24?10:data<534.3?11:data<535.01?12:data<535.02?"13+":data<535.07?15:data<535.11?16:data<535.19?17:data<536.05?18:data<536.1?19:data<537.01?20:data<537.11?"21+":data<537.13?23:data<537.18?24:data<537.24?25:data<537.36?26:layout!="Blink"?"27":"28")),layout&&(layout[1]+=" "+(data+=typeof data=="number"?".x":/[.+]/.test(data)?"":"+")),name=="Safari"&&(!version||parseInt(version)>45)&&(version=data)}name=="Opera"&&(data=/\bzbov|zvav$/.exec(os))?(name+=" ",description.unshift("desktop mode"),data=="zvav"?(name+="Mini",version=null):name+="Mobile",os=os.replace(RegExp(" *"+data+"$"),"")):name=="Safari"&&/\bChrome\b/.exec(layout&&layout[1])&&(description.unshift("desktop mode"),name="Chrome Mobile",version=null,/\bOS X\b/.test(os)?(manufacturer="Apple",os="iOS 4.3+"):os=null),version&&version.indexOf(data=/[\d.]+$/.exec(os))==0&&ua.indexOf("/"+data+"-")>-1&&(os=trim(os.replace(data,""))),layout&&!/\b(?:Avant|Nook)\b/.test(name)&&(/Browser|Lunascape|Maxthon/.test(name)||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(name)&&layout[1])&&(data=layout[layout.length-1])&&description.push(data),description.length&&(description=["("+description.join("; ")+")"]),manufacturer&&product&&product.indexOf(manufacturer)<0&&description.push("on "+manufacturer),product&&description.push((/^on /.test(description[description.length-1])?"":"on ")+product),os&&(data=/ ([\d.+]+)$/.exec(os),isSpecialCasedOS=data&&os.charAt(os.length-data[0].length-1)=="/",os={architecture:32,family:data&&!isSpecialCasedOS?os.replace(data[0],""):os,version:data?data[1]:null,toString:function(){var version=this.version;return this.family+(version&&!isSpecialCasedOS?" "+version:"")+(this.architecture==64?" 64-bit":"")}}),(data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(arch))&&!/\bi686\b/i.test(arch)&&(os&&(os.architecture=64,os.family=os.family.replace(RegExp(" *"+data),"")),name&&(/\bWOW64\b/i.test(ua)||useFeatures&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform)&&!/\bWin64; x64\b/i.test(ua))&&description.unshift("32-bit")),ua||(ua=null);var platform={};return platform.description=ua,platform.layout=layout&&layout[0],platform.manufacturer=manufacturer,platform.name=name,platform.prerelease=prerelease,platform.product=product,platform.ua=ua,platform.version=name&&version,platform.os=os||{architecture:null,family:null,version:null,toString:function(){return"null"}},platform.parse=parse,platform.toString=toStringPlatform,platform.version&&description.unshift(version),platform.name&&description.unshift(name),os&&name&&(os!=String(os).split(" ")[0]||os!=name.split(" ")[0]&&!product)&&description.push(product?"("+os+")":"on "+os),description.length&&(platform.description=description.join(" ")),platform}var objectTypes={"function":!0,object:!0},root=objectTypes[typeof window]&&window||this,oldRoot=root,freeExports=objectTypes[typeof exports]&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global;freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var maxSafeInteger=Math.pow(2,53)-1,reOpera=/\bOpera/,thisBinding=this,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,toString=objectProto.toString;typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("syracuse-tablet/html/deps/platform/platform",[],function(){return parse()}):freeExports&&freeModule?forOwn(parse(),function(value,key){freeExports[key]=value}):root.platform=parse()}.call(this),define("syracuse-tablet/html/js/helpers/native/nativeExtCall",["require","exports","module","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){function _isSupportedTest(domain,method){var obj=window[domain],caller=obj&&obj[method];if(!caller)return log&&log("_isSupportedTest: No such method: window."+domain+"."+method),!1;var sup=caller.call(obj);return sup}function _callMethodTest(domain,method,param){var obj=window[domain],caller=obj&&obj[method];if(!caller)return log&&log("_callMethodTest: No such method: window."+domain+"."+method),null;var ret=caller.call(obj,param);return ret}function _fireMethodTest(domain,method,param){var obj=window[domain],caller=obj&&obj[method];if(!caller)return log&&log("_fireMethodTest: No such method: window."+domain+"."+method),null;caller.call(obj,param)}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeExtCall",!1),_isPromise=function(o){return o!=null&&typeof o=="object"&&typeof o.then=="function"&&typeof o.fail=="function"},_testMode=!1;exports.isNativeModeEnabled=function(){return window&&window.smNativeInterface||_testMode===!0},exports.getSupportedDB=function(){return window&&window.smNativeInterface&&window.smNativeInterface.getSupportedDB?window.smNativeInterface.getSupportedDB():$.smResolve(null)},exports.appStartsRunning=function(){window&&window.smNativeInterface&&window.smNativeInterface.appStartsRunning&&window.smNativeInterface.appStartsRunning()},exports.isSupported=function(domain,method){var sup=!1;domain=domain||"",method=method||"";var caller=window&&window.smNativeInterface&&window.smNativeInterface.isSupported;return caller&&!_testMode?sup=window.smNativeInterface.isSupported(domain,method):_testMode?sup=_isSupportedTest(domain,method):log&&log("Native: isSupported no such interface - "+domain+", "+method+")"),_isPromise(sup)?sup:$.smResolve(sup)};var _checkReturnedValue=function(ret){log&&log("--> Result callMethod ="+(ret||"").substr(0,100));if(ret==null||typeof ret!="string")return null;var trimed=ret.trim();if(trimed.length>2){var charFirst=trimed.charAt(0),charLast=trimed.charAt(trimed.length-1);if(charFirst=="{"&&charLast=="}"||charFirst=="["&&charLast=="]")try{ret=JSON.parse(trimed)}catch(e){}}return ret};exports.callMethod=function(domain,method,data){var ret=null,param=data;param!=null&&typeof param!="string"&&(param=JSON.stringify(param)),domain=domain||"",method=method||"",param=param||"",log&&log("Native: callMethod ("+domain+", "+method+"): "+param);var caller=window&&window.smNativeInterface&&window.smNativeInterface.callMethod;return caller&&!_testMode?ret=window.smNativeInterface.callMethod(domain,method,param):_testMode?ret=_callMethodTest(domain,method,param):log&&log("Native: callMethod no such interface"),_isPromise(ret)?ret.then(function(result){return _checkReturnedValue(result)}):$.smResolve(_checkReturnedValue(ret))},exports.fireMethod=function(domain,method,data){var param=data;param!=null&&typeof param!="string"&&(param=JSON.stringify(param)),domain=domain||"",method=method||"",param=param||"",log&&log("Native: fireMethod ("+domain+", "+method+"): "+param);var caller=window&&window.smNativeInterface&&window.smNativeInterface.fireMethod;caller&&!_testMode?window.smNativeInterface.fireMethod(domain,method,param):_testMode?_fireMethodTest(domain,method,param):log&&log("Native: fireMethod no such interface")},exports.init=function(testMode){_testMode=testMode===!0}}),define("syracuse-tablet/html/js/helpers/native/nativeJSCall",["require","exports","module","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeJSCall",!1);exports.init=function(){window.smJSCall||(window.smJSCall=function(objectName,methodName,jsonParam){try{log&&log("smJSCall (objectName): "+objectName),log&&log("smJSCall (methodName): "+methodName);var traceParam;if(jsonParam==null||$.isPlainObject(jsonParam))traceParam=JSON.stringify(jsonParam,null,2);else if(typeof jsonParam=="string")try{jsonParam=JSON.parse(jsonParam),traceParam=JSON.stringify(jsonParam,null,2)}catch(e){traceParam=jsonParam}else traceParam=jsonParam=new String(jsonParam);log&&log("smJSCall (jsonParam): "+(traceParam||"").substr(0,100));var obj=window[objectName];if(obj==null){log&&log("JS Object not found["+objectName+"] - Can't call method "+methodName);return}var method=obj&&obj[methodName],ret=method&&method.call(obj,jsonParam);return typeof ret!="string"&&(ret=""+ret),log&&log("smJSCall (return): "+ret),ret}catch(ex){throw log&&log(JSON.stringify(ex)),ex}})}}),define("syracuse-tablet/html/js/helpers/notifications",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("notifs"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_nameSpace="sm",_subscriptions={},_callCheck=function(object){return jsutils.isInstanceOf(object,"Page")&&!object.isActive()?!1:jsutils.isInstanceOf(object,"StructElmt")&&(object.controller==null||!object.controller.isActive())?!1:!0},_callHandler=function(callBack,object,args){if(!_callCheck(object))return;return setTimeout(function(){callBack.apply(object,args)},0)},_callHandlerSynch=function(callBack,object,args){if(!_callCheck(object))return;callBack.apply(object,args)},_publish=function(events){if(!events)throw new Error("No topic to publish");var events=typeof events=="string"?[events]:events;log&&log("Publish "+events.join(" - "));var args,subscription,subscription,res,count=0,array,objArgs,args=arguments,synch,callHandler;events.forEach(function(evt){synch=evt.smStartsWith("synch."),synch?(evt=evt.split("synch.")[1],callHandler=_callHandlerSynch):callHandler=_callHandler,array=_subscriptions[evt];if(array){array=array.slice();for(var i=0,l=array.length;i<l;i++)subscription=array[i],subscription.object?(objArgs||(objArgs=Array.prototype.slice.call(args,1)),res=callHandler(subscription.callBack,subscription.object,objArgs)):(args[0]=evt,res=callHandler(subscription.callBack,null,args)),count++}})},_publishEx=function(events,opts){if(!events)throw new Error("No topic to publish");var events=typeof events=="string"?[events]:events;log&&log("Publish "+events.join(" - "));var args,subscription,subscription,res,count=0,array,exclude=opts&&opts.exclude||[],objArgs,args=arguments,synch,callHandler;events.forEach(function(evt){synch=evt.smStartsWith("synch."),synch?(evt=evt.split("synch.")[1],callHandler=_callHandlerSynch):callHandler=_callHandler,array=_subscriptions[evt];if(array){array=array.slice();for(var i=0,l=array.length;i<l;i++)subscription=array[i],subscription.object?(!exclude||exclude.indexOf(subscription.object))<0&&(objArgs||(objArgs=Array.prototype.slice.call(args,2)),res=callHandler(subscription.callBack,subscription.object,objArgs)):(args[0]=evt,res=callHandler(subscription.callBack,null,args)),count++}})},_subscribe=function(object,events,priority){if(!events)throw new Error("Notification - No topic to publish");if(!object)throw new Error("Notification - Null object");priority=priority||10;var events=typeof events=="string"?[events]:events;log&&log("Subscribe "+events.join(" - ")+" - priority="+priority);var objectArray,removeIdx;events.forEach(function(evt){var callBackFct,callBackObj;if(typeof object=="function")callBackFct=object,callBackObj=null;else{callBackObj=object;var methodName=evt.split(".");if(methodName[0]!=_nameSpace)throw new Error("Notification - Bad event domain name");methodName=$.camelCase("notif-"+methodName.splice(1).join("-")),callBackFct=object[methodName];if(!callBackFct)throw new Error("Notification - Object must implement "+methodName)}var added=!1;objectArray=_subscriptions[evt];if(!objectArray)objectArray=_subscriptions[evt]=[];else{var removeIdx=-1;objectArray.some(function(o,idx){if(o&&(o.object===object||o.callBack===object))return removeIdx=idx,!0}),removeIdx>=0&&objectArray.splice(removeIdx,1)}var subscriptionInfo={callBack:callBackFct,object:callBackObj,priority:priority};for(var i=objectArray.length-1;i>=0;i--)if(objectArray[i].priority<=priority){objectArray.splice(i+1,0,subscriptionInfo),added=!0;break}added||objectArray.unshift(subscriptionInfo)})},_unsubscribe=function(object,events){events?typeof events=="string"&&(events=[events]):events=Object.keys(_subscriptions);var propToCheck=typeof object=="function"?"callBack":"object";events.forEach(function(evt){var array=_subscriptions[evt];if(array){var lg=array.length;for(var i=0,l=lg;i<l;i++)if(object==null||array[i][propToCheck]===object)array.splice(i,1),i--,l--}})},_reset=function(object,events){log&&log("Reset"),_unsubscribe(null,null)},_check=function(object){var res={};res.total=0;var propToCheck=typeof object=="function"?"callBack":"object";return Object.keys(_subscriptions).forEach(function(key){res.total+=_subscriptions[key].length;if(object==null)res[key]=_subscriptions[key].length;else{res[key]=0;var arr=_subscriptions[key];for(var i=0,l=arr.length;i<l;i++)arr[i][propToCheck]===object&&(res[key]=res[key]+1)}}),res};exports.check=_check,exports.reset=_reset,exports.subscribe=_subscribe,exports.unsubscribe=_unsubscribe,exports.publish=_publish,exports.publishEx=_publishEx}),define("syracuse-tablet/html/js/helpers/native/nativeShare",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/nativeExtCall","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeShare",!1),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),modules=require("syracuse-tablet/html/js/common/modules"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),_ShareManager=function(){this._currentDeferred=null,this._pendingUrl=null,this._isReady=!1,this.shareFinished=function(data){if(this._currentDeferred){var def=this._currentDeferred;this._currentDeferred=null,log&&log("Got share: "+JSON.stringify(data||{})),def.resolve(data)}},this.handleLink=function(data){log&&log("handleLink: "+JSON.stringify(data,null,2));var url=data&&data.Url;url&&(this._pendingUrl=url,this._gotoUrl())},this.notifNavigatedToPage=function(page){var name=page&&page.pageName;log&&log("DeepLink: navigated to: "+name),name!=null&&name!="logout"&&name!="login"&&(this._isReady=!0,this._gotoUrl())},this._gotoUrl=function(){if(!this._isReady||!this._pendingUrl)return;var url=this._pendingUrl;this._pendingUrl=null,modules.get("navHelper").gotoUrl(url)},notifications.subscribe(this,["sm.navigated.to.page"])};window.smShareJS||(window.smShareJS=new _ShareManager),exports.supports=function(capability){return capability==="share"?nativeExtCall.isSupported("smShare","sharePageLinkSupported"):$.smResolve(!1)},exports.sharePageLink=function(options){var param={Title:options.pageData.Title,Description:options.pageData.Description,DeepLink:options.pageData.DeepLink},data=JSON.stringify(param);return _ShareManager._currentDeferred=$.Deferred(),nativeExtCall.fireMethod("smShare","sharePageLink",data),_ShareManager._currentDeferred.promise()},exports.init=function(testMode){}}),define("syracuse-tablet/html/js/app/globals",["require","exports","module"],function(require,exports,module){var _authoringActive=!1;exports.fallbackLocaleCode="en-US",exports.getGlobalSettings=function(){return{"device-type":"auto"}},exports.getBuildTimeStamp=function(){return"???"},exports.setAuthoringActive=function(status){_authoringActive=status},exports.isAuthoringActive=function(){return _authoringActive};var _defMobileClientConfig={httpTimeout:6e5},_mobileClientConfig=$.extend(!0,null,_defMobileClientConfig);exports.getMobileClientConfig=function(path){var o=_mobileClientConfig;return path&&path.split(".").some(function(p){o=o[p];if(o==null)return!0}),o},exports.setMobileClientConfig=function(config){_mobileClientConfig=$.extend(!0,null,_defMobileClientConfig,config);if(_mobileClientConfig.httpTimeout==null||isNaN(_mobileClientConfig.httpTimeout))_mobileClientConfig.httpTimeout=_defMobileClientConfig.httpTimeout},exports.getHttpTimeout=function(url){return _mobileClientConfig.httpTimeout};var _offline=!1;exports.isOffline=function(){return _offline},exports.setOffline=function(status){_offline=status}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers",["require","exports","module","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var globals=require("syracuse-tablet/html/js/app/globals"),modules=require("syracuse-tablet/html/js/common/modules"),_handlebars={mailTo:' <a id ="testNativeMailto" href="mailto:?subject={{subject}}&body={{body}}" class="s-m-link">		<i class="fa fa-envelope">		</i>		<span>{{title}}</span>		</a>',handleLink:' <a id ="testNativeHandleLink" href="{{href}}" class="s-m-link">		<i class="fa fa-hand-pointer-o">		</i>		<span>{{title}}</span>		</a>'},_getHtml=function(tmpl,ctx){return Handlebars.compile(_handlebars[tmpl])(ctx)};exports.callAppNativeInterface=function(moduleName,actionName){var app=globals.getApplication();return app?app.nativeWrapperJSInterface.apply(app,arguments):null},exports.addTestEmail=function($$parent,options){if(!options)return;$(_getHtml("mailTo",{title:"Send email",subject:encodeURIComponent(options.subject||"No subject"),body:encodeURIComponent(options.url)})).appendTo($$parent),setTimeout(function(){$("#testNativeMailto").off().remove()},options.timeout||5e3)},exports.addHandleLink=function($$parent,options){if(!options)return null;var $$elmt=$(_getHtml("handleLink",{title:options.title||"HandleLink",href:options.url||"#"})).appendTo($$parent);return options.css&&$$elmt.css(options.css),options.clickHandler&&$$elmt.click(function(){options.clickHandler()}),setTimeout(function(){$("#testNativeHandleLink").off().remove()},options.timeout||5e3),$$elmt},exports.notify=function(title,text){modules.get("modal").notify({severityClass:"success",title:title,body:text,onlyWebapp:!0})}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestLiveTile",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeLiveTile"),testHelpers=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers"),_TestNativeWrapper=function(){this.addLiveTileSupported=function(){return!0},this.addLiveTile=function(options){if(!options)return;try{options=JSON.parse(options)}catch(e){return}console.log(JSON.stringify(options,null,2));var id=options.Id,title=[];options.Title&&title.push(options.Title),options.Description&&title.push(options.Description),title=title.join(" - "),setTimeout(function(){log&&log("LIVE TILE ADD - Succeeded - "+title),testHelpers.addHandleLink($(".s-m-footer-left"),{url:options.DeepLink.Url,timeout:1e4,title:title}).find("i").css({color:options.ForegroundColor||"white","background-color":options.BackgroundColor}),window.smLiveTileJS.addLiveTileFinished(null)},100)}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeLiveTile",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestLiveTile","syracuse-tablet/html/js/helpers/native/nativeExtCall"],function(require,exports,module){function _getTileDataStruct(options){var param={Id:options.id,Title:options.title,Description:options.description,BackgroundColor:options.backgroundColor,ForegroundColor:options.color,SdataUrl:options.sDataUrl,DeepLink:options.DeepLink,UserLogin:options.userLogin,BindArray:options.bind||"$resources",BindDetail:""};return param}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeLiveTile"),nativeTestLiveTile=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestLiveTile"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),_currentDeferred;window.smLiveTileJS||(window.smLiveTileJS={addLiveTileFinished:function(data){if(_currentDeferred){var def=_currentDeferred;_currentDeferred=null,log&&log("Command live tile add finished: "+JSON.stringify(data||{})),def.resolve(data)}}}),exports.supports=function(capability){return capability==="liveTile"?nativeExtCall.isSupported("smLiveTile","addLiveTileSupported"):$.smResolve(!1)},exports.addLiveTile=function(options){_currentDeferred=$.Deferred();var data=JSON.stringify(_getTileDataStruct(options));return nativeExtCall.fireMethod("smLiveTile","addLiveTile",data),_currentDeferred.promise()},exports.init=function(testMode){if(window&&window.smLiveTile)return;if(!testMode)return;return log&&log("Creating native Live Tile test wrapper"),window.smLiveTile=nativeTestLiveTile.create(),window.smLiveTile}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestMessages",["require","exports","module","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var testHelpers=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers"),modules=require("syracuse-tablet/html/js/common/modules"),_TestNativeWrapper=function(){this.toastMsgSupported=function(){return!0},this.toastMsg=function(options){options=JSON.parse(options);var notify={onlyWebapp:!0,title:options.Text2,message:options.Text2,severityClass:options.Severity};modules.get("modal").forceNotifyWebApp(notify)},this.scheduledMsgSupported=function(){return!0},this.scheduledMsg=function(data){data?(data=JSON.parse(data),testHelpers.notify(data.Text1&&data.Text2?data.Text1+" - "+data.Text2:data.Text1||data.Text2,data.ScheduleTime)):testHelpers.notify("Empty toast message")}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeMessages",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestMessages","syracuse-tablet/html/js/helpers/native/nativeExtCall"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeMsg"),nativeTestMessages=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestMessages"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),_currentDeferred;window.smMsgJS||(window.smMsgJS={}),exports.supports=function(capability){return capability==="toastMessages"?nativeExtCall.isSupported("smMsg","toastMsgSupported"):capability==="scheduleMessage"?nativeExtCall.isSupported("smMsg","scheduledMsgSupported"):$.smResolve(!1)},exports.showToastMessage=function(options){var data=JSON.stringify(options);nativeExtCall.fireMethod("smMsg","toastMsg",data)},exports.scheduledMsg=function(options){var data=JSON.stringify(options);nativeExtCall.fireMethod("smMsg","scheduledMsg",data)},exports.init=function(testMode){if(window&&window.smMsg)return;if(!testMode)return;return log&&log("Creating native msg test wrapper"),window.smMsg=nativeTestMessages.create(),window.smMsg}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestPenInput",["require","exports","module","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativePenInput"),_TestNativeWrapper=function(){this.getPenTextInputSupported=function(){return!0},this.getAnnotatedImageSupported=function(){return!0},this.getSignatureImageSupported=function(options){return!0},this.getPenTextInput=function(context){context=context?JSON.parse(context):{};var text=window.prompt(context.Title||"Enter the text",context.Value||""),data={Action:text==null||text.trim().length===0?"cancelled":"ok",Matches:text?text.split(" "):null};setTimeout(function(){window.smPenInputJS.penInputTextFinished(data)},50)},this.getAnnotatedImage=function(options){var img="";setTimeout(function(){var data={Action:"ok",ImageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGklEQVR42mOYacxANmIY1TyqeVTzqOaB1QwApdw+0KHEWp0AAAAASUVORK5CYII="};log&&log("Annotated Image GET "),window.smPenInputJS.penAnnotateImageFinished(data)},100)},this.getSignatureImage=function(options){var img="";setTimeout(function(){var data={Action:"ok",ImageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGklEQVR42mOYacxANmIY1TyqeVTzqOaB1QwApdw+0KHEWp0AAAAASUVORK5CYII="};log&&log("Signature Image GET "),window.smPenInputJS.penSignatureImageFinished(data)},100)}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/ui/uiUtils",["require","exports","module"],function(require,exports,module){var _empty=function(domNode){if(domNode)while(domNode.firstChild)domNode.removeChild(domNode.firstChild)},_toggleClass=function(item,css,show){if(item){var className=item.className;show?className.indexOf(css)<0&&(item.className=className+(" "+css)):item.className=className.replace(css,"")}},_waitDefOpts={className:"waiting-circles",elements:8,radius:30,auto:!0},_waitGlobal=null,_wait=function(waitObject,start){waitObject==null&&(_waitGlobal==null&&(_waitGlobal=_waitWheelCreate($(document.body))),waitObject=_waitGlobal),start?(waitObject.$$bckg.show(),_waitPluginStatus(waitObject.$$wheel,"enable")):(waitObject.$$bckg.hide(),_waitPluginStatus(waitObject.$$wheel,"disable"))},_waitWheelCreate=function($$parent,opts){var waitObject={$$bckg:$('<div class="waiting-background" style="display:none;z-index:2000"></div>'),$$wheel:$('<div class="waiting-wheel"  style="display:none;z-index:2000"></div>')};return waitObject.$$bckg.appendTo($$parent),waitObject.$$wheel.appendTo($$parent),_waitPluginCreate(waitObject.$$wheel,_waitDefOpts),waitObject},_waitPluginDestroy=function($$elmt){$$elmt&&$$elmt.data("waiting")&&($$elmt.waiting("destroy"),$$elmt.remove())},_waitPluginStatus=function($$elmt,status){$$elmt&&$$elmt.data("waiting")&&($$elmt.waiting(status),$$elmt[status==="disable"?"hide":"show"]())},_waitPluginCreate=function($$elmt,opts){if(!opts)throw new Error("opts is mandatory");return $$elmt&&$$elmt.waiting(opts),$$elmt},_waitWheelDestroy=function(waitObject){waitObject&&(_waitPluginDestroy(waitObject.$$wheel),waitObject.$$bckg&&waitObject.$$bckg.remove())},_createDomElement=function(tag,classList,content,attrList,parent){if(!tag)throw new Error("tag parameter is necessary !");var dom=document.createElement(tag);if(classList)if($.isArray(classList))$.each(classList,function(index,className){dom.className+=className+(index==classList.length-1?"":" ")});else{if(typeof classList!="string")throw new Error("classList parameter must be an array or a string");dom.className+=classList}dom.textContent=content?content:"";if(tag==="a"||tag==="img")attrList=attrList||{},attrList.draggable="false";return attrList&&$.each(attrList,function(key,value){dom.setAttribute(key,value)}),parent&&(parent.jquery?parent=parent.append(dom):parent.appendChild(dom)),dom},_appendTextNode=function(e,text){if(!e)return;var t=document.createTextNode(text||"");return e.jquery?e=e.append(t):e.appendChild(t),e},_buildDom=function(domDesc,parent){$.each(domDesc,function(nodeName,value){var dom=_createDomElement(nodeName,value.classList,value.textContent,value.attr,parent);value.children&&$.each(value.children,function(index,childElement){_buildDom(childElement,dom)})})};exports.empty=_empty,exports.toggleClass=_toggleClass,exports.waitWheelStart=function(waitObject){_wait(waitObject,!0)},exports.waitWheelStop=function(waitObject){_wait(waitObject,!1)},exports.waitWheelCreate=_waitWheelCreate,exports.waitWheelDestroy=_waitWheelDestroy,exports.waitPluginDestroy=_waitPluginDestroy,exports.waitPluginCreate=_waitPluginCreate,exports.waitPluginDisable=function($$elmt){_waitPluginStatus($$elmt,"disable")},exports.waitPluginEnable=function($$elmt){_waitPluginStatus($$elmt,"enable")},exports.createDomElement=_createDomElement,exports.buildDom=_buildDom,exports.appendTextNode=_appendTextNode,exports.triggerResizeInternal=function(opts){$(window).triggerHandler("resizeInternal",[opts])},exports.imgHeight2px=function(val){val=val||"small";switch(val){case"xsmall":return 25;case"small":return 50;case"medium":return 100;case"large":return 200;case"xlarge":return 300;default:return 100}},exports.objectToHtmlAttrs=function(obj){var html;for(var attr in obj){var val=obj[attr];if(val===null)continue;val!==""&&(val='="'+val+'"'),html?html+=" "+attr+val:html=attr+val}return html||""}}),define("syracuse-tablet/html/js/helpers/native/nativePenInput",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestPenInput","syracuse-tablet/html/js/helpers/native/nativeExtCall","syracuse-tablet/html/js/ui/uiUtils"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativePenInput",!1),nativeTestPenInput=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestPenInput"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),uiutils=require("syracuse-tablet/html/js/ui/uiUtils"),_currentInputDeferred;window.smPenInputJS||(window.smPenInputJS={penInputTextFinished:function(data){if(_currentInputDeferred){var def=_currentInputDeferred;_currentInputDeferred=null,log&&log("Got pen input: "+JSON.stringify(data||{})),def.resolve({action:data.Action,matches:data.Matches})}},penAnnotateImageFinished:function(data){uiutils.waitWheelStop();if(_currentInputDeferred){var def=_currentInputDeferred;_currentInputDeferred=null,def.resolve({action:data.Action,imageData:data.ImageData})}},penSignatureImageFinished:function(data){if(_currentInputDeferred){var def=_currentInputDeferred;_currentInputDeferred=null,def.resolve({action:data.Action,imageData:data.ImageData})}}}),exports.supports=function(capability){return log&&log("Pen check support: "+capability),capability==="penTextInput"?nativeExtCall.isSupported("smPenInput","getPenTextInputSupported"):capability==="penAnnotatedImage"?nativeExtCall.isSupported("smPenInput","getAnnotatedImageSupported"):capability==="penSignatureImage"?nativeExtCall.isSupported("smPenInput","getSignatureImageSupported"):$.smResolve(!1)},exports.getPenTextInput=function(options){options&&options.value!=null&&(options.value=""+options.value);var data=JSON.stringify({Title:options.title,Value:options.value});return _currentInputDeferred=$.Deferred(),nativeExtCall.fireMethod("smPenInput","getPenTextInput",data),_currentInputDeferred.promise()},exports.getAnnotatedImage=function(options){var data=JSON.stringify({Title:options.title,ImageData:options.imageData});return _currentInputDeferred=$.Deferred(),uiutils.waitWheelStart(),nativeExtCall.fireMethod("smPenInput","getAnnotatedImage",data),_currentInputDeferred.promise()},exports.getSignatureImage=function(options){var data=JSON.stringify({Title:options.title,Watermark:options.watermark!=null?""+options.watermark:"",MaxWidth:options.maxWidth!=null?+options.maxWidth:640,MaxHeight:options.maxHeight!=null?+options.maxHeight:480,WatermarkSize:options.watermarkSize!=null?+options.watermarkSize:16});return _currentInputDeferred=$.Deferred(),nativeExtCall.fireMethod("smPenInput","getSignatureImage",data),_currentInputDeferred.promise()},exports.init=function(testMode){if(window&&window.smPenInput)return;if(!testMode)return;return log&&log("Creating native Pen Input test wrapper"),window.smPenInput=nativeTestPenInput.create(),window.smPenInput}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestImage",["require","exports","module"],function(require,exports,module){var _TestNativeWrapper=function(){this.getPictureFromCameraSupported=function(){return!0},this.getScaledImageSupported=function(){return!0},this.getPictureFromCamera=function(options){setTimeout(function(){var data={Action:"ok",ImageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGklEQVR42mOYacxANmIY1TyqeVTzqOaB1QwApdw+0KHEWp0AAAAASUVORK5CYII="};window.smImageJS.getPictureFromCameraFinished(data)},100)},this.getScaledImage=function(options){setTimeout(function(){var data={Action:"ok",ImageData:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGklEQVR42mOYacxANmIY1TyqeVTzqOaB1QwApdw+0KHEWp0AAAAASUVORK5CYII="};window.smImageJS.getScaledImageFinished(data)},100)}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeImage",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestImage","syracuse-tablet/html/js/helpers/native/nativeExtCall"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeCamera"),nativeTestImage=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestImage"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),_currentDeferred;window.smImageJS||(window.smImageJS={getPictureFromCameraFinished:function(data){log&&log("Got image!");if(_currentDeferred){var def=_currentDeferred;_currentDeferred=null,log&&log("Got image: "+JSON.stringify(data||{})),def.resolve({action:data.Action,imageData:data.ImageData})}},getScaledImageFinished:function(data){log&&log("Got scaled image!");if(_currentDeferred){var def=_currentDeferred;_currentDeferred=null,log&&log("Got scaled image: "+JSON.stringify(data||{})),def.resolve({action:data.Action,imageData:data.ImageData,width:data.Width,height:data.Height})}}}),exports.supports=function(capability){return capability==="camera"?nativeExtCall.isSupported("smImage","getPictureFromCameraSupported"):capability==="imageScale"?nativeExtCall.isSupported("smImage","getScaledImageSupported"):$.smResolve(!1)},exports.getPictureFromCamera=function(options){var param={};return options&&options.resizeOptions!=null&&(param.resizeOptions={Width:options.resizeOptions.width,Height:options.resizeOptions.height,Mode:options.resizeOptions.mode}),_currentDeferred=$.Deferred(),nativeExtCall.fireMethod("smImage","getPictureFromCamera",param),_currentDeferred.promise()},exports.getScaledImage=function(options){var data={ImageData:options.imageData,Width:options.width,Height:options.height,Mode:options.mode};return _currentDeferred=$.Deferred(),nativeExtCall.fireMethod("smImage","getScaledImage",data),_currentDeferred.promise()},exports.init=function(testMode){if(window&&window.smImage)return;if(!testMode)return;return log&&log("Creating native image test wrapper"),window.smImage=nativeTestImage.create(),window.smImage}}),define("syracuse-tablet/html/js/helpers/locale",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getDecimalInfo(){var resources=_resources&&_resources[_currentLocale];if(!resources)return;return resources[_decimalInformationKey]}function _loadFile(path,file,locale,defLocale){function _load(){if(segs.length===0){var url=path+"/"+file+"-"+defLocale+".json";ajax.request(url).then(function(result){var data=result.data;data&&deferred.resolve(data),deferred.resolve({})}).fail(function(e){deferred.reject(e)})}else{var code=segs.join("-"),url=path+"/"+file+"-"+code+".json";ajax.request(url).then(function(result){var data=result.data;if(data){if(code!==defLocale){url=path+"/"+file+"-"+defLocale+".json",ajax.request(url).then(function(result){var dataEn=result.data;if(dataEn){var mergedStrings=$.extend(!0,{},dataEn,data);deferred.resolve(mergedStrings)}else deferred.resolve(data)}).fail(function(e){deferred.resolve(data)});return}deferred.resolve(data)}else segs.pop(),_load()}).fail(function(e){segs.pop(),_load()})}}var deferred=new $.Deferred,segs=locale.split("-"),loadedLocale,ajax=modules.get("ajax");return _load(),deferred.promise()}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),modules=require("syracuse-tablet/html/js/common/modules"),_currentLocale=null,_resources={},_datetimeInformationKey="$datetimeInformation",_decimalInformationKey="$decimalInformation",_upLocalePreferences,_txtRegexp=/\{([\w-]+)\}/g,_currentLocaleUser="*",_userProfileSettings={};exports.setLocaleByUserProfile=function(userProfile){var locale=userProfile.selectedLocale.code;return _currentLocaleUser=userProfile.user.login,_userProfileSettings=userProfile.selectedLocale,exports.setLocale(userProfile.selectedLocale.code)},exports.getLocale=function(locale){return _currentLocale==null?"en-GB":_currentLocale},exports.setLocale=function(locale){var deferred=new $.Deferred,resources=_resources&&_resources[locale];if(resources)_currentLocale=locale,deferred.resolve();else if(locale===_currentLocale)deferred.resolve();else{var rsrcPath=jsutils.getResourcesBasePath();_loadFile(rsrcPath+"js/resources","strings",locale,"en").then(function(data){_currentLocale=locale,_resources[locale]=data}).then(function(){return _loadFile(rsrcPath+"js/resources/locales","date",locale,"en-GB")}).then(function(data){_resources[locale][_datetimeInformationKey]=data}).then(function(){return _loadFile(rsrcPath+"js/resources/locales","decimal",locale,"en-GB")}).then(function(data){_resources[locale][_decimalInformationKey]=data}).then(function(){deferred.resolve()}).fail(function(e){deferred.resolve()})}return deferred.promise()},exports.text=function(key,args){var resources=_resources&&_resources[_currentLocale];if(!resources)return;var text=resources[key]||"Resource key not found["+key+"]";return args&&(Array.isArray(args)||(args=Array.prototype.slice.call(arguments,1)),text=text.replace(_txtRegexp,function(match,p1){var idx=+p1;return idx>=0&&idx<args.length?args[idx]:"?"})),text},exports.textNoFail=function(key,args){var resources=_resources&&_resources[_currentLocale];if(!resources||!resources[key])return null;var text=resources[key];return args&&(Array.isArray(args)||(args=Array.prototype.slice.call(arguments,1)),text=text.replace(_txtRegexp,function(match,p1){var idx=+p1;return idx>=0&&idx<args.length?args[idx]:"?"})),text},exports.textOpt=function(key){var resources=_resources&&_resources[_currentLocale];if(!resources)return;return resources[key]},exports.getDatetimeInfo=function(){var resources=_resources&&_resources[_currentLocale];if(!resources)return;return resources[_datetimeInformationKey]},exports.isCurrent=function(locale,strict){return!locale||!_currentLocale?!1:_currentLocale===locale?!0:strict?!1:locale.split("-")[0]===_currentLocale},exports.getDateFormat=function(){var di=exports.getDatetimeInfo();return _userProfileSettings.shortDate||di&&di.formatPatterns&&di.formatPatterns.shortDate||"dd/MM/yyyy"},exports.getDateTimeFormat=function(){var di=exports.getDatetimeInfo(),date=_userProfileSettings.shortDate||di&&di.formatPatterns&&di.formatPatterns.shortDate||"dd/MM/yyyy",time=_userProfileSettings.shortTime||di&&di.formatPatterns&&di.formatPatterns.shortTime||"HH:mm:ss";return date+" "+time},exports.getTimeFormat=function(){var di=exports.getDatetimeInfo();return _userProfileSettings.longTime||di&&di.formatPatterns&&di.formatPatterns.longTime||"HH:mm:ss"},exports.getTimeFormatShort=function(){var di=exports.getDatetimeInfo();return _userProfileSettings.shortTime||di&&di.formatPatterns&&di.formatPatterns.shortTime||"HH:mm"},exports.getNumberFormat=function(type){return type==="application/x-integer"?"#,##0":"#,##0.##"},exports.getNumberGroupSeparator=function(){var di=_getDecimalInfo(),gs=_userProfileSettings.numberGroupSeparator||di&&di.numberGroupSeparator||",";return gs},exports.getNumberDecimalSeparator=function(){var di=_getDecimalInfo(),ds=_userProfileSettings.numberDecimalSeparator||di&&di.numberDecimalSeparator||".";return ds},exports.getCurrentLocale=function(){return _currentLocale},exports.getCurrentLocaleHash=function(){return _currentLocale+"#"+_currentLocaleUser},exports.getProductLabels=function(){var data={};return data.brand=exports.text("global.label.brand"),data.product=exports.text("global.label.product"),data}}),define("syracuse-tablet/html/js/helpers/native/nativeVoiceCommands",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/native/nativeExtCall","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _setReadyForCommands(){!_readyForCommands&&_lastCommand!=null?(log&&log("Ready for voice commands, execute queue"),_readyForCommands=!0,_tryExecuteVoiceCommand(_lastCommand)):(log&&log("Ready for voice commands, no pendig commands in queue"),_readyForCommands=!0)}function _setPhraseList(titlesArray){var data=JSON.stringify({Phrase:"bookmark",PhraseList:titlesArray,Language:locale.getCurrentLocale().toLowerCase()});log&&log("Update voiceCommands: "+JSON.stringify(data,null,2)),nativeExtCall.fireMethod("smVoice","setPhraseList",data)}function _tryExecuteVoiceCommand(text){_lastCommand=text,_readyForCommands&&_currentVoiceCommands!=null&&(_executeVoiceCommand(_lastCommand),_lastCommand=null)}function _executeVoiceCommand(text){var command;log&&log("Execute command: "+text),_currentVoiceCommands.some(function(c){return command=c,c.title===text})?(log&&log("Execute command data: "+JSON.stringify(command)),_launchVoiceCommand(command)):log&&log("Execute command, no match: "+text)}function _launchVoiceCommand(command){var page=command&&command.page;page&&modules.get("navHelper").gotoUrl(page.$url,page.$method)}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeVoice",!1),locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),modules=require("syracuse-tablet/html/js/common/modules"),_currentVoiceCommands=null,_readyForCommands=!1,_lastCommand=null;window.smVoiceJS||(window.smVoiceJS={executeVoiceCommand:function(data){if(!data)return;_tryExecuteVoiceCommand(data.Text)}}),notifications.subscribe({notifNavigatedToPage:function(page){var name=page&&page.pageName;log&&log("Voice: navigated to: "+name),!_readyForCommands&&name!=null&&name!="logout"&&name!="login"&&_setReadyForCommands()}},"sm.navigated.to.page"),exports.supports=function(capability){return capability==="voiceCommands"?nativeExtCall.isSupported("smVoice","setPhraseListSupported"):$.smResolve(!1)},exports.updateVoiceCommands=function(commands){_currentVoiceCommands=commands,_setPhraseList(_currentVoiceCommands.map(function(item){return item.title}))},exports.init=function(testMode){if(window&&window.smVoice)return;return window.smVoice}}),define("syracuse-tablet/html/js/storage/localStorage",["require","exports","module","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("sessstorage"),_available=null,_isAvailable=function(){if(_available!==null)return _available;_available=!1;try{window.localStorage.setItem("__test_availability__","__test_availability__"),_available=!0}catch(e){}return _available},_getItem=function(key,removeAfter){if(!_isAvailable()){log&&log("local.unsupported.getItem("+key+"):"+val);return}var val=window.localStorage.getItem(key);return log&&log("local.getItem("+key+"):"+val),!0===removeAfter&&_removeItem(key),val},_setItem=function(key,value){if(!_isAvailable()){log&&log("local.unsupported.setItem("+key+"):"+value);return}return log&&log("local.setItem("+key+"):"+value),window.localStorage.setItem(key,value)},_removeItem=function(key){if(!_isAvailable()){log&&log("local.unspported.removeItem("+key+")");return}return log&&log("local.removeItem("+key+")"),window.localStorage.removeItem(key)};exports.removeItem=_removeItem,exports.setItem=_setItem,exports.getItem=_getItem}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestApp",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/storage/localStorage","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("X3WUPApp",!1),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),localStorage=require("syracuse-tablet/html/js/storage/localStorage"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),nativeHelpers=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestHelpers"),_closeAppliBtn='	<div id="x3wupappclosebtn" class="s-m-test-wrapper" title="Close application">		<a href="#" draggable="false" style= "color:#41a940";>		<i class="fa fa-power-off"></i>		</a>	</div>',_addCloseAppliBtn=function($$root){return $$root.find("#x3wupappclosebtn").off().remove(),$(Handlebars.compile(_closeAppliBtn)()).appendTo($$root)},_TestNativeWrapper=function(){this.nativeWrapperSupported=function(){return!0},this.openExternalLinkSupported=function(){return!0},this.hardwareBackButtonSupported=function(){return!0},this.notifApplicationReady=function(ok){localStorage.removeItem("$reconnectContext")},this.onClickCloseAppli=function(){this.onWebappUnloaded()},this.onWebappLoaded=function(){},this.onWebappUnloaded=function(){if(!window.smWrapperJS)return;try{this.setReconnectContext(nativeHelpers.callAppNativeInterface("nativeApp","applicationClosing")),setTimeout(function(){window.location.reload()},100)}catch(e){return console.log(e.stack),e.message}},this.webappConfigServer=function(){},this.webappSelectServer=function(){},this.setReconnectContext=function(context){try{log&&log("setReconnectContext",context),localStorage.setItem("$reconnectContext",context)}catch(e){log&&log("setReconnectContext",JSON.stringify(e))}},this.getReconnectContext=function(){try{var context=localStorage.getItem("$reconnectContext");return log&&log("getReconnectContext",context),context}catch(e){return log&&log("getReconnectContext",JSON.stringify(e)),null}},this.getReconnectToken=function(){try{var loginCookie=localStorage.getItem("$reconnectToken"),sidCookie=localStorage.getItem("$reconnectSid");return log&&log("getReconnectToken",loginCookie,sidCookie),$.smResolve(loginCookie,sidCookie)}catch(e){return log&&log("getReconnectToken",JSON.stringify(e)),$.smResolve(null,null)}},this.setReconnectToken=function(token){try{log&&log("setReconnectToken",token),token=token?JSON.parse(token):null;if(!token)return;localStorage.setItem("$reconnectToken",token.SyracuseSidLogin),localStorage.setItem("$reconnectSid",token.SyracuseSid),localStorage.setItem("$reconnectLoginName",token.LoginCookieName),localStorage.setItem("$reconnectSidName",token.SidCookieName)}catch(e){log&&log("setReconnectToken",JSON.stringify(e))}},this.appendHeaderTestCmds=function($$root){if(!$$root||!this.nativeWrapperSupported())return;_addCloseAppliBtn($$root).click(jsutils.bindFn(this.onClickCloseAppli,this))},notifications.subscribe(this,["sm.application.ready"])};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeApp",["require","exports","module","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestApp","syracuse-tablet/html/js/helpers/native/nativeExtCall","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var globals=require("syracuse-tablet/html/js/app/globals"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeWUPApp",!1),nativeTestApp=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestApp"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),modules=require("syracuse-tablet/html/js/common/modules");window.smWrapperJS||(window.smWrapperJS={backButtonPressed:function(){var app=modules.get("appController").App,canGoBack=app.canGoBack();return canGoBack?(modules.get("appController").App.goBack(),!0):!1},applicationClosing:function(){var currentAppState=modules.get("appController").App.nativeApplicationClosing();return currentAppState},applicationActivated:function(){modules.get("appController").App.nativeApplicationActivated()},connectivityChanged:function(connected){log&&log("connectivityChanged: "+connected),globals.setOffline(connected!=1,!1,!0)}}),exports.supports=function(capability){return capability==="nativeApp"?nativeExtCall.isSupported("smApp","nativeWrapperSupported"):capability==="hardwareBackButton"?nativeExtCall.isSupported("smApp","hardwareBackButtonSupported"):capability==="dispatcherListener"?nativeExtCall.isSupported("smApp","dispatcherListenerSupported"):capability==="extLink"?nativeExtCall.isSupported("smApp","openExternalLinkSupported"):capability==="nativeScrolling"?nativeExtCall.isSupported("smApp","nativeScrollingSupported"):$.smResolve(!1)},exports.openExternalLink=function(url){nativeExtCall.fireMethod("smApp","openExternalLink",url)},exports.getReconnectToken=function(){var deferred=$.Deferred();return nativeExtCall.callMethod("smApp","getReconnectToken").then(function(result){var loginCookie=null,sidCookie=null;result==null||typeof result=="string"?loginCookie=result:(loginCookie=result.loginCookie,sidCookie=result.sidCookie),deferred.resolve(loginCookie,sidCookie)}),deferred.promise()},exports.setReconnectToken=function(token,userLogin,sid,loginCookieName,sidCookieName){var data={};typeof token=="string"&&(data.SyracuseSidLogin=token,data.UserLogin=userLogin),typeof sid=="string"&&(data.SyracuseSid=sid),typeof loginCookieName=="string"&&(data.LoginCookieName=loginCookieName),typeof sidCookieName=="string"&&(data.SidCookieName=sidCookieName),nativeExtCall.fireMethod("smApp","setReconnectToken",data)},exports.getReconnectContext=function(){return nativeExtCall.callMethod("smApp","getReconnectContext")},exports.configServer=function(){nativeExtCall.fireMethod("smApp","configServer")},exports.selectServer=function(){nativeExtCall.fireMethod("smApp","selectServer")},exports.dispatcherNotifyAfter=function(link){nativeExtCall.fireMethod("smApp","dispatcherNotifyAfter",link)},exports.notifLoaded=function(){log&&log("notifLoaded"),nativeExtCall.fireMethod("smApp","webappLoaded")},exports.notifUnloaded=function(historyContext){log&&log("OnWebappUnloaded");if(window&&window.smApp&&window.smApp.onWebappUnloaded)return window.smApp.onWebappUnloaded(historyContext?JSON.stringify(historyContext,null,2):null)},exports.notifStartFail=function(msg){nativeExtCall.fireMethod("smApp","webappLoadFail",msg)},exports.init=function(testMode){if(window&&window.smApp)return;if(!testMode)return;return log&&log("Creating native nativeApp test wrapper"),window.smApp=nativeTestApp.create(),window.smApp}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestSensors",["require","exports","module"],function(require,exports,module){var _TestNativeWrapper=function(){this.getGPSCoordinatesSupported=function(){return!0},this.getGPSCoordinates=function(options){setTimeout(function(){var data={Latitude:Math.random()*100,Longitude:Math.random()*100,Succeeded:!0};window.smSensorsJS.getGPSCoordinatesFinished(data)},1e3)}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeSensors",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestSensors","syracuse-tablet/html/js/helpers/native/nativeExtCall"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeSensors",!1),nativeTestSensors=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestSensors"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),_currentDeferred;window.smSensorsJS||(window.smSensorsJS={getGPSCoordinatesFinished:function(data){log&&log("Got GPS");if(_currentDeferred){var def=_currentDeferred;_currentDeferred=null,log&&log("Got GPS: "+JSON.stringify(data||{})),def.resolve({latitude:data.Latitude,longitude:data.Longitude,succeeded:data.Succeeded,error:data.Error})}}}),exports.supports=function(capability){return capability==="GPS"?nativeExtCall.isSupported("smSensors","getGPSCoordinatesSupported"):$.smResolve(!1)},exports.getGPSCoordinates=function(){return _currentDeferred=$.Deferred(),nativeExtCall.fireMethod("smSensors","getGPSCoordinates"),_currentDeferred.promise()},exports.init=function(testMode){if(window&&window.smSensors)return;if(!testMode)return;return log&&log("Creating native gps test wrapper"),window.smSensors=nativeTestSensors.create(),window.smSensors}}),define("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestBarcode",["require","exports","module"],function(require,exports,module){var _TestNativeWrapper=function(){this.scanBarcodeSupported=function(){return!0},this.scanBarcode=function(options){var bc=window.prompt("Enter the barcode",""),data={Action:bc==null||bc.trim().length===0?"cancelled":"ok",Content:bc,Format:"QR_CODE"};setTimeout(function(){window.smBarcodeJS.scanBarcodeFinished(data)},100)}};exports.create=function(){return new _TestNativeWrapper}}),define("syracuse-tablet/html/js/helpers/native/nativeBarcode",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestBarcode","syracuse-tablet/html/js/helpers/native/nativeExtCall"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("nativeCamera",!1),nativeTestBarcode=require("syracuse-tablet/html/js/helpers/native/wrapperTest/nativeTestBarcode"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),_currentDeferred;window.smBarcodeJS||(window.smBarcodeJS={scanBarcodeFinished:function(data){log&&log("Got barcode: "+JSON.stringify(data||{}));if(_currentDeferred){var def=_currentDeferred;_currentDeferred=null,def.resolve({action:data.Action,content:data.Content,format:data.Format})}}}),exports.supports=function(capability){return capability==="scanBarcode"?nativeExtCall.isSupported("smBarcode","scanBarcodeSupported"):$.smResolve(!1)},exports.scanBarcode=function(options){var param={};return _currentDeferred=$.Deferred(),nativeExtCall.fireMethod("smBarcode","scanBarcode",param),_currentDeferred.promise()},exports.init=function(testMode){if(window&&window.smBarcode)return;if(!testMode)return;log&&log("Creating native barcode test wrapper"),window.smBarcode=nativeTestBarcode.create()}}),define("syracuse-tablet/html/js/helpers/native/native",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/native/nativeExtCall","syracuse-tablet/html/js/helpers/native/nativeJSCall","syracuse-tablet/html/js/helpers/native/nativeShare","syracuse-tablet/html/js/helpers/native/nativeLiveTile","syracuse-tablet/html/js/helpers/native/nativeMessages","syracuse-tablet/html/js/helpers/native/nativePenInput","syracuse-tablet/html/js/helpers/native/nativeImage","syracuse-tablet/html/js/helpers/native/nativeVoiceCommands","syracuse-tablet/html/js/helpers/native/nativeApp","syracuse-tablet/html/js/helpers/native/nativeSensors","syracuse-tablet/html/js/helpers/native/nativeBarcode"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("native",!1),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),nativeExtCall=require("syracuse-tablet/html/js/helpers/native/nativeExtCall"),nativeJSCall=require("syracuse-tablet/html/js/helpers/native/nativeJSCall"),_modules={nativeShare:require("syracuse-tablet/html/js/helpers/native/nativeShare"),nativeLiveTile:require("syracuse-tablet/html/js/helpers/native/nativeLiveTile"),nativeMessages:require("syracuse-tablet/html/js/helpers/native/nativeMessages"),nativePenInput:require("syracuse-tablet/html/js/helpers/native/nativePenInput"),nativeImage:require("syracuse-tablet/html/js/helpers/native/nativeImage"),nativeVoiceCommands:require("syracuse-tablet/html/js/helpers/native/nativeVoiceCommands"),nativeApp:require("syracuse-tablet/html/js/helpers/native/nativeApp"),nativeSensors:require("syracuse-tablet/html/js/helpers/native/nativeSensors"),nativeBarcode:require("syracuse-tablet/html/js/helpers/native/nativeBarcode")},_capabilities={nativeApp:"nativeApp",dispatcherListener:"nativeApp",hardwareBackButton:"nativeApp",nativeScrolling:"nativeApp",extLink:"nativeApp",share:"nativeShare",liveTile:"nativeLiveTile",scheduleMessage:"nativeMessages",toastMessages:"nativeMessages",penTextInput:"nativePenInput",penAnnotatedImage:"nativePenInput",penSignatureImage:"nativePenInput",camera:"nativeImage",imageScale:"nativeImage",voiceCommands:"nativeVoiceCommands",scanBarcode:"nativeBarcode",GPS:"nativeSensors"},_capabilitiesModules={},_testMode=!1,_testWrappers={};exports.isTestMode=function(){return _testMode},exports.hasCapability=function(capability){return exports.getModule(capability)!=null},exports.getModule=function(capability){return _capabilitiesModules[capability]},exports.callModule=function(capability,functionName){var module=exports.getModule(capability);if(!module||!module[functionName])return null;var args=Array.prototype.slice.call(arguments,2);return module[functionName].apply(null,args)},exports.appendHeaderTestCmds=function($$root){if(!exports.isTestMode())return;Object.keys(_testWrappers).forEach(function(name){var testWrapper=_testWrappers[name];if(testWrapper==null||!testWrapper.appendHeaderTestCmds)return;testWrapper.appendHeaderTestCmds($$root)})},exports.init=function(){return nativeJSCall.init(),nativeExtCall.appStartsRunning(),$.smResolve().then(function(){var _url=jsutils.getCurrentUrl();_testMode=_url.query&&_url.query.testNativeWrapper==="true",nativeExtCall.init(_testMode);for(var m in _modules)_modules[m].init&&(_testWrappers[m]=_modules[m].init(_testMode))}).then(function(){return $.smForEachPromise(Object.keys(_capabilities),function(capability){_capabilitiesModules[capability]=null;var moduleName=_capabilities[capability];if(moduleName==null)return log&&log("Native initialization","No module has been found for capability ["+capability+"]"),$.smResolve(!1);var module=_modules[moduleName];return module==null?(log&&log("Native initialization","Unknown native module ["+module+"]"),$.smResolve(!1)):module.supports==null?(log&&log("Native initialization","Module ["+moduleName+"] must implement 'supports' method"),$.smResolve(!1)):module.supports(capability)},function(capability,supported){supported===!0&&(_capabilitiesModules[capability]=_modules[_capabilities[capability]])})},!0)},exports.getSupportedDB=function(){return nativeExtCall.getSupportedDB()}}),define("syracuse-tablet/html/js/helpers/unitTestManager",["require","exports","module"],function(require,exports,module){var _$$appElemt=null,_pageUpdateCycle=1;exports.notifPageLoaded=function(step,page){if(!_$$appElemt)return;if(step=="before"){$("[data-s-ut-page-is-current]").removeAttr("data-s-ut-page-is-current");return}if(step=="after"){if(!page)return;page.$$elmt.attr("data-s-ut-page-name",page.pageName);if(page.isVignette())return;page.$$elmt.attr("data-s-ut-page-is-current",page.pageName);return}},exports.notifUserCtxChanged=function(ctx,endpoint){if(!_$$appElemt)return;_$$appElemt.removeAttr("data-s-ut-user-ctx");if(ctx&&endpoint){var data=[ctx.$user||"",ctx.$role||"",ctx.$lang||"",endpoint||""];_$$appElemt.attr("data-s-ut-user-ctx",data.join(","))}},exports.notifDeviceChanged=function(device,orientation){if(!_$$appElemt)return;_$$appElemt.attr("data-s-ut-device",device+","+orientation)},exports.arrayAddRowIndex=function($$elmt,idx){if(!_$$appElemt)return;$$elmt.attr("data-s-ut-row-idx",idx)},exports.addStructElmtId=function($$elmt,info){if(!_$$appElemt)return;$$elmt.attr("data-s-ut-elmt-id",info)},exports.authAddRightPanelId=function($$elmt,id){if(!_$$appElemt)return;id?$$elmt.attr("data-s-ut-auth-selected-elmt",id):$$elmt.removeAttr("data-s-ut-auth-selected-elmt")},exports.addBindAttribute=function(ctrl){if(!_$$appElemt)return;ctrl&&ctrl.$$elmt&&ctrl.$bind&&ctrl.$$elmt.attr("data-s-ut-field-x3name",ctrl.$bind)},exports.addPageData=function(page){if(!_$$appElemt)return;page&&page.$$elmt&&page.pageData&&(page.$$elmt.attr("data-s-ut-page-url",page.pageData.$url),page.$$elmt.attr("data-s-ut-page-method",page.pageData.$method))},exports.authAddTreeElmtId=function($$elmt,info){if(!_$$appElemt)return;$$elmt.attr("data-s-ut-auth-elmt-id",info)},exports.enable=function(){_$$appElemt=$("#s-m-app-id")},exports.setPageUpdateCycle=function($$page){_pageUpdateCycle+=1,$$page.attr("data-s-ut-update-cycle",_pageUpdateCycle)},window.$unitTestManager=exports,exports.blurFocusElmt=function(){$(":focus").blur()}}),define("syracuse-tablet/html/js/helpers/environment",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/deps/bowser/bowser","syracuse-tablet/html/deps/platform/platform","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/helpers/unitTestManager"],function(require,exports,module){function _initDefaultOsStyle(mobileDetect){var os=mobileDetect!=null&&mobileDetect.mobile()!=null?mobileDetect.os():"windows";switch(os){case"AndroidOS":return"android";case"WindowsMobileOS":case"WindowsPhoneOS":return"windows";case"iOS":return"ios";case"PalmOS":case"BlackBerryOS":case"MeeGoOS":case"MaemoOS":case"JavaOS":case"webOS":case"badaOS":case"BREWOS":case"SymbianOS":default:return"windows"}}function _initDesktopOs(mobileDetect){if(mobileDetect&&mobileDetect.mobile()!=null)return null;if(!_platform||!_platform.os||!_platform.os.family)return null;var family=_platform.os.family.toLowerCase();switch(family){case family.indexOf("windows"):return"windows";case"os x":return"osx";case"ubuntu":case"debian":case"fedora":case"red Hat":case"suse":return"linux";default:return null}}function _initBrowserName(mobileDetect){var res=mobileDetect&&mobileDetect.mobile()!=null?mobileDetect.userAgent():_bowser.name;return res?res.toLowerCase():"Not detected"}function _checkBrowserName(name){var res=!1;if(_environment.mobileDetect&&_environment.mobileDetect.mobile()!=null){res=_environment.mobileDetect.userAgent();if(!res)return!1;res=res.toLowerCase(),res=res==="ie"&&name==="msie"||res===name,res===!0&&log&&log(name,"detect by mobile-detect")}else _bowser!=null&&(res=_bowser[name]===!0,res===!0&&log&&log(name,"detect by bowser"));return res}function _defaultInit(){_bowser&&_bowser._detect&&(_bowser=_bowser._detect(window.navigator.userAgent)),_environment.mobileDetect=window.MobileDetect?new window.MobileDetect(window.navigator.userAgent):null;var isMobile=_environment.mobileDetect?_environment.mobileDetect.mobile()!=null:!1;_environment.currentDesktopOS=_initDesktopOs(_environment.mobileDetect),_environment.styleOS=_initDefaultOsStyle(_environment.mobileDetect),_environment.isMobile=isMobile,_environment.browserName=_initBrowserName(_environment.mobileDetect),_environment.osName=isMobile?_environment.mobileDetect.os():_environment.currentDesktopOS,_environment.osName&&(_environment.osName=_environment.osName.toLowerCase());try{var _url=jsutils.getCurrentUrl();_url.query!=null&&(_environment.isUnitTestMode=_url.query.unitTestMode==="true",_environment.isUnitTestMode===!0&&unitTestManager.enable(),_environment.isTestNativeWrapper=_url.query.testNativeWrapper==="true")}catch(e){}$(document.body).toggleClass("s-m-mobile-device",isMobile===!0).attr({"data-style":_environment.styleOS,"data-browser":_environment.browserName,"data-os":_environment.osName}),log&&(log("Is mobile",_environment.isMobile,"is TestNativeWrapper",_environment.isTestNativeWrapper),log("User agent Name",window.navigator.userAgent),log("Browser Name: ",_environment.browserName),log("Browser OS Name: ",_environment.osName),log("Browser OS Style: ",_environment.styleOS))}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("environment",!1),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_bowser=require("syracuse-tablet/html/deps/bowser/bowser"),_platform=require("syracuse-tablet/html/deps/platform/platform"),native=require("syracuse-tablet/html/js/helpers/native/native"),unitTestManager=require("syracuse-tablet/html/js/helpers/unitTestManager"),_environment={mobileDetect:null,currentDesktopOS:null,isMobile:!1,styleOS:"windows",osName:"windows",browserName:"",isTestNativeWrapper:!1,isNativeScrolling:!0,isUnitTestMode:!1};(function(){_defaultInit()})(),exports.getStyleOS=function(){return _environment.styleOS},exports.isOs=function(os){return os&&os.toLowerCase()===_environment.styleOS},exports.checkBrowserName=function(){var result=!1,name,bn;for(var i=0;i<arguments.length;i++)result=result||_checkBrowserName(arguments[i].toLowerCase());return result},exports.isDesktop=function(){return _environment.isMobile!==!0},exports.isMobile=function(){return _environment.isMobile===!0},exports.isNativeScrolling=function(){return _environment.isNativeScrolling===!0},exports.isTestNativeWrapper=function(){return exports.isDesktop()&&_environment.isTestNativeWrapper===!0},exports.isAutoUITestMode=function(){return _environment.isUnitTestMode===!0},exports.getUnitTestMgr=function(){return unitTestManager},exports.init=function(){_defaultInit(),native.hasCapability("nativeApp")?_environment.isNativeScrolling=native.hasCapability("nativeScrolling"):_environment.isNativeScrolling=exports.isMobile()};var _isNativeWrapper;exports.isNativeWrapper=function(){return _isNativeWrapper==null&&(_isNativeWrapper=native.hasCapability("nativeApp")),_isNativeWrapper}}),define("syracuse-tablet/html/js/utils/waiting",["require","exports","module"],function(require,exports,module){function _waitLocal(promise,$$parent){var deferred=$.Deferred(),$$container=$(_HTML);return $$parent.addClass("s-m-wc-waiting-parent"),$$parent.append($$container.show()),promise.then(function(){$$container.detach(),$$parent.removeClass("s-m-wc-waiting-parent"),deferred.resolve.apply(deferred,arguments)}).fail(function(){$$container.detach(),$$parent.removeClass("s-m-wc-waiting-parent"),deferred.reject.apply(deferred,arguments)}),deferred.promise()}function _waitGlobal(promise){var deferred=$.Deferred();return _pushWait(),promise.then(function(){_popWait(),deferred.resolve.apply(deferred,arguments)}).fail(function(){_popWait(),deferred.reject.apply(deferred,arguments)}),deferred.promise()}function _pushWait(){_count++,_count===1&&_showWait()}function _popWait(){_count--,_count<=0&&(_count=0,_hideWait())}function _showWait(){_ensureInitialized(),_$$container.is(":visible")||_$$container.css("display","table")}function _hideWait(){_ensureInitialized(),_$$container.is(":visible")&&_$$container.css("display","none")}function _ensureInitialized(){if(_$$container)return;var $$app=$("#s-m-app-id");_$$container=$(_HTML),$$app.append(_$$container)}var _HTML='<div style="display:none;z-index:10000" class="s-m-wc-waiting"><div></div></div>',_count=0,_$$container;exports.waitModal=function(promise,$$parent){return $$parent?_waitLocal(promise,$$parent):_waitGlobal(promise)},exports.reset=function(){_$$container&&(_$$container.detach(),_$$container=null),_count=0}}),define("syracuse-tablet/html/js/ui/siteLayout",["require","exports","module","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getWindowOrientation(){var width=$(window).width()/_getTransformScale(),height=$(window).height()/_getTransformScale(),ratio=width/height;return ratio<1?"portrait":"landscape"}function _layoutMainContainers(resizeEvt,opts){var firstCall=_lastUserAgent==null;_lastUserAgent==null&&(_lastUserAgent=navigator.userAgent.toLowerCase()),opts=opts||{},opts.resizeEvent=resizeEvt,opts.layout&&(_layoutParameters=$.extend(!0,{},_layoutParameters,opts.layout));var appClass=null,authPanelRightWidth=0,authPanelLeftWidth=0,authPanelHeaderHeight=0,authPanelFooterHeight=0,authPanelRightSplitterWidth=0,authPanelLeftSplitterWidth=0,$$authRight=$("#s-m-auth-panel-right-id"),$$authLeft=$("#s-m-auth-panel-left-id"),$$app=$("#s-m-app-id"),$$appContainer=$("#s-m-app-container-id");_internalParameters=$.extend(!0,{},_layoutParameters);var pageParams=_internalParameters.pageParameters;_internalParameters.authPanelRight.visible&&(authPanelRightWidth=_internalParameters.authPanelRight.width,authPanelRightSplitterWidth=_internalParameters.authPanelRight.splitterWidth,_layoutAuthPanelRight(),pageParams.forcePreview=!0),_internalParameters.authPanelLeft.visible&&(authPanelLeftWidth=_internalParameters.authPanelLeft.width,authPanelLeftSplitterWidth=_internalParameters.authPanelLeft.splitterWidth,_layoutAuthPanelLeft(),pageParams.forcePreview=!0),_internalParameters.authPanelHeader.visible&&(authPanelHeaderHeight=_internalParameters.authPanelHeader.height,_layoutAuthPanelHeader()),_internalParameters.authPanelFooter.visible&&(authPanelFooterHeight=_internalParameters.authPanelFooter.height,_layoutAuthPanelFooter());var applicationWidth=$(window).width()/_getTransformScale(),applicationWidth=applicationWidth-authPanelRightWidth-authPanelRightSplitterWidth-authPanelLeftWidth-authPanelLeftSplitterWidth,applicationHeight=$(window).height()/_getTransformScale(),applicationHeight=applicationHeight-authPanelHeaderHeight-authPanelFooterHeight,appView,forcePreview=pageParams.forcePreview===!0;$$app.parent().is(".s-m-device-wrapper")&&$$app.unwrap();if(forcePreview&&environment.isDesktop()){var template=pageParams.device?_deviceSizes[pageParams.device]:null;template||(template=_deviceSizes.nexus10);var wrapBorder=15;appView={left:0,top:0,width:pageParams.orientation==="landscape"?template.width:template.height,height:pageParams.orientation==="landscape"?template.height:template.width};var wrapH=appView.height+2*wrapBorder,wrapW=appView.width+2*wrapBorder;pageParams.forceAutoScale&&(pageParams.scale=Math.min(Math.min(applicationWidth/wrapW,applicationHeight/wrapH),1)),appView.left=Math.max((applicationWidth-wrapW*pageParams.scale)/2,0),appView.top=Math.max((applicationHeight-wrapH*pageParams.scale)/2,0),appClass=template.bootstrapTweakClass[pageParams.orientation];var $$wrapper=$('<section class="s-m-device-wrapper"></section>"'),wrapCss={top:appView.top+"px",left:appView.left+"px",width:wrapW+"px",height:wrapH+"px"};pageParams.scale!==1&&(wrapCss.transform="scale("+pageParams.scale+", "+pageParams.scale+")",wrapCss["transform-origin"]="left top"),$$wrapper.css(wrapCss),$$app.wrap($$wrapper),$$app.css({top:wrapBorder+"px",left:wrapBorder+"px",width:appView.width+"px",height:appView.height+"px",position:"absolute"})}else appView={left:0,top:0,width:applicationWidth,height:applicationHeight},pageParams.orientation=_currentOrientation,$$app.css({top:appView.top,left:appView.left,width:appView.width,height:appView.height});$$app.removeClass(_bootstrapTweakClasses.join(" ")),appClass&&$$app.addClass(appClass),$$appContainer.css({top:authPanelHeaderHeight,left:authPanelLeftWidth+authPanelLeftSplitterWidth,width:applicationWidth,height:applicationHeight}),$$appContainer.toggleClass("s-m-preview",forcePreview);var info={updateLayout:!0,application:appView,authoringUpdate:opts.authoringUpdate===!0,preserveScroll:opts.preserveScroll===!0||opts.authoringUpdate===!0,afterMainPageLoaded:opts.afterMainPageLoaded===!0};opts.resizeEvent&&(info.resizeEvent=opts.resizeEvent),info.orientationChanged=opts.orientationChanged,info.deviceChanged=opts.deviceChanged,environment.isAutoUITestMode()&&(firstCall||info.orientationChanged||info.deviceChanged)&&environment.getUnitTestMgr().notifDeviceChanged(_getDeviceType(),pageParams.orientation),_layoutInfo={application:appView,orientation:pageParams.orientation,deviceType:_getDeviceType()},notifications.publish("sm.main.layout.changed",info,pageParams.orientation,_getDeviceType())}function _layoutAuthPanelRight(){var width=$(window).width(),height=$(window).height(),$$auth=$("#s-m-auth-panel-right-id"),$$splitter=$("#s-m-auth-splitter-right-id"),authPanelHeaderHeight=0,authPanelFooterHeight=0;_internalParameters.authPanelHeader.visible&&(authPanelHeaderHeight=_internalParameters.authPanelHeader.height),_internalParameters.authPanelFooter.visible&&(authPanelFooterHeight=_internalParameters.authPanelFooter.height),$$auth.css({left:width-_internalParameters.authPanelRight.width,top:authPanelHeaderHeight,width:_internalParameters.authPanelRight.width,height:height-authPanelHeaderHeight-authPanelFooterHeight}),$$splitter.css({left:width-_internalParameters.authPanelRight.width-_internalParameters.authPanelRight.splitterWidth,top:authPanelHeaderHeight,width:_internalParameters.authPanelRight.splitterWidth,height:height-authPanelHeaderHeight-authPanelFooterHeight})}function _layoutAuthPanelLeft(){var width=$(window).width(),height=$(window).height(),$$auth=$("#s-m-auth-panel-left-id"),$$splitter=$("#s-m-auth-splitter-left-id"),authPanelHeaderHeight=0,authPanelFooterHeight=0;_internalParameters.authPanelHeader.visible&&(authPanelHeaderHeight=_internalParameters.authPanelHeader.height),_internalParameters.authPanelFooter.visible&&(authPanelFooterHeight=_internalParameters.authPanelFooter.height),$$auth.css({left:0,top:authPanelHeaderHeight,width:_internalParameters.authPanelLeft.width,height:height-authPanelHeaderHeight-authPanelFooterHeight}),$$splitter.css({left:_internalParameters.authPanelLeft.width,top:authPanelHeaderHeight,width:_internalParameters.authPanelLeft.splitterWidth,height:height-authPanelHeaderHeight-authPanelFooterHeight})}function _layoutAuthPanelHeader(){var width=$(window).width(),height=$(window).height(),$$auth=$("#s-m-auth-panel-header-id");$$auth.css({left:0,top:0,width:width,height:_internalParameters.authPanelHeader.height,overflow:"hidden"})}function _layoutAuthPanelFooter(){var width=$(window).width(),height=$(window).height(),$$auth=$("#s-m-auth-panel-footer-id");$$auth.css({left:0,top:height-_internalParameters.authPanelFooter.height,width:width,height:_internalParameters.authPanelFooter.height})}var globals=require("syracuse-tablet/html/js/app/globals"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),environment=require("syracuse-tablet/html/js/helpers/environment"),modules=require("syracuse-tablet/html/js/common/modules"),_getTransformScale=function(){var res=_internalParameters&&_internalParameters.pageParameters?_internalParameters.pageParameters.scale:null;return res==null||res<=0?1:res},_layoutInfo,_internalParameters,_lastWindowWidth,_lastWindowHeight;$(function(){_lastWindowWidth=$(window).width()/_getTransformScale(),_lastWindowHeight=$(window).height()/_getTransformScale()});var _getCurrentDeviceType=function(){var currentDeviceType,a=navigator.userAgent.toLowerCase();return a.indexOf("iphone")>=0?currentDeviceType="smartphone":a.indexOf("ipad")>=0?currentDeviceType="tablet":a.indexOf("mobile")>=0?currentDeviceType="smartphone":currentDeviceType="tablet",currentDeviceType},_deviceSizes={nexus5:{width:640,height:360,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-xs",landscape:"s-m-auth-col-simulate-sm"},deviceType:"smartphone",orientations:["portrait","landscape"]},nexus7:{width:960,height:600,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-sm",landscape:"s-m-auth-col-simulate-md"},deviceType:"tablet",orientations:["portrait","landscape"]},nexus10:{width:1280,height:800,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-sm",landscape:"s-m-auth-col-simulate-lg"},deviceType:"tablet",orientations:["portrait","landscape"]},ipad:{width:1024,height:768,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-sm",landscape:"s-m-auth-col-simulate-lg"},deviceType:"tablet",orientations:["portrait","landscape"]},iphone4:{width:480,height:320,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-xs",landscape:"s-m-auth-col-simulate-xs"},deviceType:"smartphone",orientations:["portrait","landscape"]},iphone5:{width:568,height:320,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-xs",landscape:"s-m-auth-col-simulate-xs"},deviceType:"smartphone",orientations:["portrait","landscape"]},iphone6:{width:667,height:375,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-xs",landscape:"s-m-auth-col-simulate-sm"},deviceType:"smartphone",orientations:["portrait","landscape"]},iphone6plus:{width:960,height:540,bootstrapTweakClass:{portrait:"s-m-auth-col-simulate-xs",landscape:"s-m-auth-col-simulate-md"},deviceType:"smartphone",orientations:["portrait","landscape"]}},_bootstrapTweakClasses=["s-m-auth-col-simulate-xs","s-m-auth-col-simulate-sm","s-m-auth-col-simulate-md","s-m-auth-col-simulate-lg"],_currentOrientation=_getWindowOrientation(),_splitterWidth=15,_layoutParameters={authPanelRight:{width:230,splitterWidth:_splitterWidth,visible:!1},authPanelLeft:{width:300,splitterWidth:_splitterWidth,visible:!1},authPanelHeader:{height:34},authPanelFooter:{height:34},pageParameters:{forcePreview:!1,forceAutoScale:!0,scale:1}};_layoutParameters.pageParameters.orientation=_currentOrientation,_layoutParameters.pageParameters.deviceType=_getCurrentDeviceType();var _heights={tablet:{header:50,footer:{opened:50,closed:20}},smartphone:{header:50,footer:{opened:0,closed:0}}};exports.onWindowOrientation=function(evt,opts){if(!evt||evt.orientation==null)return;opts=opts||{},opts.orientationChanged=evt.orientation!==_currentOrientation,opts.deviceChanged=!1,_currentOrientation=evt.orientation,setTimeout(function(){_layoutMainContainers(evt,opts)})};var _lastUserAgent=null;exports.onWindowResize=function(evt,opts){if(!evt)return;opts=opts||{},opts.orientationChanged=!1,opts.deviceChanged=!1;var userAgentChanged=_lastUserAgent==null||_lastUserAgent!==navigator.userAgent.toLowerCase();if(_internalParameters&&_internalParameters.pageParameters.forcePreview!==!0){if(environment.isDesktop()){var prev=_currentOrientation;_currentOrientation=_getWindowOrientation(),opts.orientationChanged=prev!==_currentOrientation}userAgentChanged&&(_lastUserAgent=navigator.userAgent.toLowerCase(),opts.deviceChanged=!0)}if(userAgentChanged){environment.init(),document.location.reload();return}environment.isDesktop()&&_layoutMainContainers(evt,opts);var width=$(window).width()/_getTransformScale(),height=$(window).height()/_getTransformScale();if(width===_lastWindowWidth&&height<=_lastWindowHeight){var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();currentPage&&currentPage.notifyScrollerUpdate(!0);return}if(width!==_lastWindowWidth||height>_lastWindowHeight)_lastWindowHeight=height;_lastWindowWidth=width,_layoutMainContainers(evt,opts)},exports.onWindowResizeInteral=function(evt,opts){if(!evt)return;opts=opts||{};var params=opts.layout?opts.layout.pageParameters:null;params&&params.orientation&&params.forcePreview&&(opts.orientationChanged=_currentOrientation!==params.orientation,_currentOrientation=params.orientation);if(params&&params.device&&params.forcePreview){var typ=_deviceSizes[params.device];typ=typ?typ.deviceType:"",opts.deviceChanged=typ!==_getDeviceType()}_layoutMainContainers(evt,opts)},exports.getDeviceTemplates=function(){return _deviceSizes};var _getDeviceType=function(){if(_internalParameters&&_internalParameters.pageParameters&&_internalParameters.pageParameters.forcePreview===!0){var device=_internalParameters.pageParameters.device;return device&&_deviceSizes[device]?_deviceSizes[device].deviceType:"tablet"}var settings=globals.getGlobalSettings();return settings==null||settings["device-type"]==="auto"?_getCurrentDeviceType():settings["device-type"]};exports.getDeviceType=_getDeviceType,exports.getPageOrientation=function(){return _internalParameters.pageParameters.orientation},exports.getCurrentLayoutSettings=function(){var o=$.extend(!0,{},_layoutParameters);return o},exports.getTransformScale=_getTransformScale,exports.splitterWidth=_splitterWidth,exports.onWindoReisze=_splitterWidth,exports.getLayoutInfo=function(){return _layoutInfo}}),define("syracuse-tablet/html/js/helpers/developmentPage",["require","exports","module","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/storage/localStorage","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _setActive(flag){localStorage.setItem("devPanelOpen",flag?"true":"false")}function _applyDelta(){try{var json=$("#s-m-delta-json-id").val(),obj=JSON.parse(json);console.log("Data: "),console.log(obj);var $$page=$(".s-m-page.s-m-full[data-controller-id]").first(),controllerId=$$page.attr("data-controller-id"),controller=modules.get("controller").findController(controllerId);console.log("Controller: "),console.log(controller),controller&&controller._mergeDelta(obj),console.log("Delta applied")}catch(e){alert(e.message)}}function _updateUrl(){var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage(),url=currentPage.pageData&&currentPage.pageData.$url,method=currentPage.pageData&&currentPage.pageData.$method||"GET",href=window.location.href,i=href.indexOf("?");i>-1&&(href=href.substr(0,i)),href=href+"?url="+encodeURIComponent(url),href=href+"&method="+encodeURIComponent(method),window.location.href=href}var uiutils=require("syracuse-tablet/html/js/ui/uiUtils"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),localStorage=require("syracuse-tablet/html/js/storage/localStorage"),modules=require("syracuse-tablet/html/js/common/modules"),_deltaExample='{\n   "WMENU": 3,\n  "$properties": {\n    "WMENU": {\n      "$isReadOnly": true\n    }\n  }\n}',_gotoExample={url:"http://localhost:8124/mobile2/x3/erp/GX3APP/AQMDEVICE?representation=AQMCRUDM.$query&count=50",method:"GET"},_template='	<div id="page_dev_mode" style="margin: 0; width: auto; position: absolute; z-index: 9999">     <div class="modal-dialog" style="margin: 0; width: auto;"> 		<div class="modal-content" style="width: auto;"> 		    <div class="modal-header"> 				<h4 class="modal-title">{{title}}</h4> 		    </div> 		    <div class="modal-body"> 				<div class="form-group"> 					<label>{{label_device}}</label>					<select class="form-control" id="dev-select-device"> 					{{#each devices}}						<option value="{{this.device}}.{{this.orientation}}" {{#if this.selected}}selected{{/if}}>						{{this.description}}						</option>					{{/each}}					</select>					<span class="input-group"> 						<input id="dev-device-scale" type="checkbox" {{#if scaleChecked}}checked{{/if}}>{{label_scale}} 					</span> 				</div> 				<div class="form-group"> 					<span class="input-group"> 						<input id="dev-cache" type="checkbox" {{#if cacheChecked}}checked{{/if}}>{{label_cache}} 	  				</span> 					<span class="input-group"> 						<input id="dev-app-force-update" type="checkbox" {{#if alwaysUpdateChecked}}checked{{/if}}>Always update apps 					</span> 				</div> 				<div class="form-group"> 					<label>Goto URL</label><br>					<input id="s-m-goto-url-id" value="{{gotoUrl}}"></input><br>					<input id="s-m-goto-method-id" value="{{gotoMethod}}"></input><br>					<button type="button" class="btn" id="btn-goto-id">Go</button> 					<button type="button" class="btn" id="btn-curl-id">Current url</button> 				</div> 				<div class="form-group"> 					<label>SData-Delta</label><br>					<textarea rows="8" cols="35" id="s-m-delta-json-id" style="white-space: nowrap;">{{deltaExample}}</textarea><br>					<button type="button" class="btn" id="btn-apply-delta-id">Apply</button> 				</div> 			</div> 		    <div class="modal-footer"> 				<button type="button" class="btn" id="btn_dev_close">{{label_close}}</button> 				<button type="button" class="btn btn-default" disabled="true" id="btn_dev_apply">{{label_apply}}</button>     			<button type="button" class="btn" id="btn_dev_ok">{{label_ok}}</button> 			</div> 		</div> 	</div> 	</div>',_show=function(){_setActive(!0);if($("#page_dev_mode").is(":visible"))return;var modalHtml=Handlebars.compile(_template),devs=siteLayout.getDeviceTemplates(),ctx={title:"Development settings",label_device:"Device",devices:[],label_scale:"Scale if needed",label_cache:"Disable caching",label_close:"Cancel",label_ok:"Ok",label_apply:"Apply",scaleChecked:localStorage.getItem("devPanelScale")==="true",cacheChecked:localStorage.getItem("devPanelCache")==="true",alwaysUpdateChecked:localStorage.getItem("alwaysUpdateChecked")==="true",deltaExample:_deltaExample,gotoUrl:_gotoExample.url,gotoMethod:_gotoExample.method};ctx.devices.push({device:"<No emulation>",orientation:"landscape",description:"<No emulation>"});for(var dev in devs)devs[dev].orientations.forEach(function(o){var devName=dev,orientName=o,opt={device:dev,orientation:o,description:devName+" ("+o+")"};ctx.devices.push(opt)});var lastDev=localStorage.getItem("devPanelDevice")||"<No emulation>.landscape";ctx.devices.forEach(function(d){d.selected=lastDev===d.device+"."+d.orientation}),modalHtml=modalHtml(ctx),$("body").append($(modalHtml));var $$page=$("#page_dev_mode");$$page.draggable(),$("#btn-apply-delta-id",$$page).on("click",function(){_applyDelta()}),$("#btn-goto-id",$$page).on("click",function(){var url=$("#s-m-goto-url-id").val(),method=$("#s-m-goto-method-id").val();modules.get("navHelper").gotoUrl(url,method).fail(function(e){console.log(e)})}),$("#btn-curl-id",$$page).on("click",function(){_updateUrl()}),$("#btn_dev_ok",$$page).on("click",function(){apply(),$$page.remove()}),$("#btn_dev_apply",$$page).on("click",function(){apply(),$("#btn_dev_apply",$$page).attr("disabled","true")}),$("#btn_dev_close",$$page).on("click",function(){_setActive(!1),$$page.remove()}),$("#dev-select-device",$$page).on("change",function(){$("#btn_dev_apply",$$page).removeAttr("disabled")}),$('input[type="checkbox"]',$$page).on("click",function(){$("#btn_dev_apply",$$page).removeAttr("disabled")});var apply=function(){var device=$$page.find("#dev-select-device").val(),dev=device.split("."),params={layout:{pageParameters:{}}};localStorage.setItem("devPanelDevice",device),device==="<No emulation>.landscape"?(params.layout.pageParameters.forcePreview=!1,params.layout.pageParameters.forceAutoScale=!1,params.layout.pageParameters.device="tablet",params.layout.pageParameters.orientation="landscape"):(params.layout.pageParameters.device=dev[0],params.layout.pageParameters.orientation=dev[1],params.layout.pageParameters.forcePreview=!0,$("#dev-device-scale",$$page).is(":checked")===!0?(params.layout.pageParameters.forceAutoScale=!0,localStorage.setItem("devPanelScale","true")):(params.layout.pageParameters.forceAutoScale=!1,localStorage.setItem("devPanelScale","false"))),$("#dev-cache",$$page).is(":checked")===!0?localStorage.setItem("devPanelCache","true"):localStorage.setItem("devPanelCache","false"),$("#dev-app-force-update",$$page).is(":checked")===!0?localStorage.setItem("alwaysUpdateChecked","true"):localStorage.setItem("alwaysUpdateChecked","false"),uiutils.triggerResizeInternal(params)};apply()};exports.restoreOnStartup=function(){localStorage.getItem("devPanelOpen")==="true"&&exports.show()},exports.show=_show}),define("syracuse-tablet/html/js/helpers/handlebarsHelpers",["require","exports","module"],function(require,exports,module){exports.registerHelpers=function(Handlebars){Handlebars.registerHelper("smCompare",function(lvalue,operator,rvalue,options){var operators,result;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");options===undefined&&(options=rvalue,rvalue=operator,operator="==="),operators={"==":function(l,r){return l==r},"===":function(l,r){return l===r},"!=":function(l,r){return l!=r},"!==":function(l,r){return l!==r},"<":function(l,r){return l<r},">":function(l,r){return l>r},"<=":function(l,r){return l<=r},">=":function(l,r){return l>=r},"typeof":function(l,r){return typeof l==r}};if(!operators[operator])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);return result=operators[operator](lvalue,rvalue),result?options.fn(this):options.inverse(this)})}}),!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("syracuse-tablet/html/deps/handlebars.min",[],b):"object"==typeof exports?exports.Handlebars=b():a.Handlebars=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(){var a=r();return a.compile=function(b,c){return k.compile(b,c,a)},a.precompile=function(b,c){return k.precompile(b,c,a)},a.AST=i["default"],a.Compiler=k.Compiler,a.JavaScriptCompiler=m["default"],a.Parser=j.parser,a.parse=j.parse,a}var e=c(1)["default"];b.__esModule=!0;var f=c(2),g=e(f),h=c(21),i=e(h),j=c(22),k=c(27),l=c(28),m=e(l),n=c(25),o=e(n),p=c(20),q=e(p),r=g["default"].create,s=d();s.create=d,q["default"](s),s.Visitor=o["default"],s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){b["default"]=function(a){return a&&a.__esModule?a:{"default":a}},b.__esModule=!0},function(a,b,c){function d(){var a=new h.HandlebarsEnvironment;return n.extend(a,h),a.SafeString=j["default"],a.Exception=l["default"],a.Utils=n,a.escapeExpression=n.escapeExpression,a.VM=p,a.template=function(b){return p.template(b,a)},a}var e=c(3)["default"],f=c(1)["default"];b.__esModule=!0;var g=c(4),h=e(g),i=c(18),j=f(i),k=c(6),l=f(k),m=c(5),n=e(m),o=c(19),p=e(o),q=c(20),r=f(q),s=d();s.create=d,r["default"](s),s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){b["default"]=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b},b.__esModule=!0},function(a,b,c){function d(a,b,c){this.helpers=a||{},this.partials=b||{},this.decorators=c||{},i.registerDefaultHelpers(this),j.registerDefaultDecorators(this)}var e=c(1)["default"];b.__esModule=!0,b.HandlebarsEnvironment=d;var f=c(5),g=c(6),h=e(g),i=c(7),j=c(15),k=c(17),l=e(k),m="4.0.5";b.VERSION=m;var n=7;b.COMPILER_REVISION=n;var o={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};b.REVISION_CHANGES=o;var p="[object Object]";d.prototype={constructor:d,logger:l["default"],log:l["default"].log,registerHelper:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple helpers");f.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(f.toString.call(a)===p)f.extend(this.partials,a);else{if("undefined"==typeof b)throw new h["default"]('Attempting to register a partial called "'+a+'" as undefined');this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]},registerDecorator:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple decorators");f.extend(this.decorators,a)}else this.decorators[a]=b},unregisterDecorator:function(a){delete this.decorators[a]}};var q=l["default"].log;b.log=q,b.createFrame=f.createFrame,b.logger=l["default"]},function(a,b){function c(a){return k[a]}function d(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function f(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return m.test(a)?a.replace(l,c):a}function g(a){return a||0===a?p(a)&&0===a.length?!0:!1:!0}function h(a){var b=d({},a);return b._parent=a,b}function i(a,b){return a.path=b,a}function j(a,b){return(a?a+".":"")+b}b.__esModule=!0,b.extend=d,b.indexOf=e,b.escapeExpression=f,b.isEmpty=g,b.createFrame=h,b.blockParams=i,b.appendContextPath=j;var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},l=/[&<>"'`=]/g,m=/[&<>"'`=]/,n=Object.prototype.toString;b.toString=n;var o=function(a){return"function"==typeof a};o(/x/)&&(b.isFunction=o=function(a){return"function"==typeof a&&"[object Function]"===n.call(a)}),b.isFunction=o;var p=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===n.call(a):!1};b.isArray=p},function(a,b){function c(a,b){var e=b&&b.loc,f=void 0,g=void 0;e&&(f=e.start.line,g=e.start.column,a+=" - "+f+":"+g);for(var h=Error.prototype.constructor.call(this,a),i=0;i<d.length;i++)this[d[i]]=h[d[i]];Error.captureStackTrace&&Error.captureStackTrace(this,c),e&&(this.lineNumber=f,this.column=g)}b.__esModule=!0;var d=["description","fileName","lineNumber","message","name","number","stack"];c.prototype=new Error,b["default"]=c,a.exports=b["default"]},function(a,b,c){function d(a){g["default"](a),i["default"](a),k["default"](a),m["default"](a),o["default"](a),q["default"](a),s["default"](a)}var e=c(1)["default"];b.__esModule=!0,b.registerDefaultHelpers=d;var f=c(8),g=e(f),h=c(9),i=e(h),j=c(10),k=e(j),l=c(11),m=e(l),n=c(12),o=e(n),p=c(13),q=e(p),r=c(14),s=e(r)},function(a,b,c){b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("blockHelperMissing",function(b,c){var e=c.inverse,f=c.fn;if(b===!0)return f(this);if(b===!1||null==b)return e(this);if(d.isArray(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):e(this);if(c.data&&c.ids){var g=d.createFrame(c.data);g.contextPath=d.appendContextPath(c.data.contextPath,c.name),c={data:g}}return f(b,c)})},a.exports=b["default"]},function(a,b,c){var d=c(1)["default"];b.__esModule=!0;var e=c(5),f=c(6),g=d(f);b["default"]=function(a){a.registerHelper("each",function(a,b){function c(b,c,f){j&&(j.key=b,j.index=c,j.first=0===c,j.last=!!f,k&&(j.contextPath=k+b)),i+=d(a[b],{data:j,blockParams:e.blockParams([a[b],b],[k+b,null])})}if(!b)throw new g["default"]("Must pass iterator to #each");var d=b.fn,f=b.inverse,h=0,i="",j=void 0,k=void 0;if(b.data&&b.ids&&(k=e.appendContextPath(b.data.contextPath,b.ids[0])+"."),e.isFunction(a)&&(a=a.call(this)),b.data&&(j=e.createFrame(b.data)),a&&"object"==typeof a)if(e.isArray(a))for(var l=a.length;l>h;h++)h in a&&c(h,h,h===a.length-1);else{var m=void 0;for(var n in a)a.hasOwnProperty(n)&&(void 0!==m&&c(m,h-1),m=n,h++);void 0!==m&&c(m,h-1,!0)}return 0===h&&(i=f(this)),i})},a.exports=b["default"]},function(a,b,c){var d=c(1)["default"];b.__esModule=!0;var e=c(6),f=d(e);b["default"]=function(a){a.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new f["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},a.exports=b["default"]},function(a,b,c){b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("if",function(a,b){return d.isFunction(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||d.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})})},a.exports=b["default"]},function(a,b){b.__esModule=!0,b["default"]=function(a){a.registerHelper("log",function(){for(var b=[void 0],c=arguments[arguments.length-1],d=0;d<arguments.length-1;d++)b.push(arguments[d]);var e=1;null!=c.hash.level?e=c.hash.level:c.data&&null!=c.data.level&&(e=c.data.level),b[0]=e,a.log.apply(a,b)})},a.exports=b["default"]},function(a,b){b.__esModule=!0,b["default"]=function(a){a.registerHelper("lookup",function(a,b){return a&&a[b]})},a.exports=b["default"]},function(a,b,c){b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("with",function(a,b){d.isFunction(a)&&(a=a.call(this));var c=b.fn;if(d.isEmpty(a))return b.inverse(this);var e=b.data;return b.data&&b.ids&&(e=d.createFrame(b.data),e.contextPath=d.appendContextPath(b.data.contextPath,b.ids[0])),c(a,{data:e,blockParams:d.blockParams([a],[e&&e.contextPath])})})},a.exports=b["default"]},function(a,b,c){function d(a){g["default"](a)}var e=c(1)["default"];b.__esModule=!0,b.registerDefaultDecorators=d;var f=c(16),g=e(f)},function(a,b,c){b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerDecorator("inline",function(a,b,c,e){var f=a;return b.partials||(b.partials={},f=function(e,f){var g=c.partials;c.partials=d.extend({},g,b.partials);var h=a(e,f);return c.partials=g,h}),b.partials[e.args[0]]=e.fn,f})},a.exports=b["default"]},function(a,b,c){b.__esModule=!0;var d=c(5),e={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(a){if("string"==typeof a){var b=d.indexOf(e.methodMap,a.toLowerCase());a=b>=0?b:parseInt(a,10)}return a},log:function(a){if(a=e.lookupLevel(a),"undefined"!=typeof console&&e.lookupLevel(e.level)<=a){var b=e.methodMap[a];console[b]||(b="log");for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];console[b].apply(console,d)}}};b["default"]=e,a.exports=b["default"]},function(a,b){function c(a){this.string=a}b.__esModule=!0,c.prototype.toString=c.prototype.toHTML=function(){return""+this.string},b["default"]=c,a.exports=b["default"]},function(a,b,c){function d(a){var b=a&&a[0]||1,c=r.COMPILER_REVISION;if(b!==c){if(c>b){var d=r.REVISION_CHANGES[c],e=r.REVISION_CHANGES[b];throw new q["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new q["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){function c(c,d,e){e.hash&&(d=o.extend({},d,e.hash),e.ids&&(e.ids[0]=!0)),c=b.VM.resolvePartial.call(this,c,d,e);var f=b.VM.invokePartial.call(this,c,d,e);if(null==f&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),f=e.partials[e.name](d,e)),null!=f){if(e.indent){for(var g=f.split("\n"),h=0,i=g.length;i>h&&(g[h]||h+1!==i);h++)g[h]=e.indent+g[h];f=g.join("\n")}return f}throw new q["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){function c(b){return""+a.main(e,b,e.helpers,e.partials,g,i,h)}var f=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],g=f.data;d._setup(f),!f.partial&&a.useData&&(g=j(b,g));var h=void 0,i=a.useBlockParams?[]:void 0;return a.useDepths&&(h=f.depths?b!==f.depths[0]?[b].concat(f.depths):f.depths:[b]),(c=k(a.main,c,e,f.depths||[],g,i))(b,f)}if(!b)throw new q["default"]("No environment passed to template");if(!a||!a.main)throw new q["default"]("Unknown template object: "+typeof a);a.main.decorator=a.main_d,b.VM.checkRevision(a.compiler);var e={strict:function(a,b){if(b in a)return a[b];throw new q["default"]('"'+b+'" not defined in '+a)},lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:o.escapeExpression,invokePartial:c,fn:function(b){var c=a[b];return c.decorator=a[b+"_d"],c},programs:[],program:function(a,b,c,d,e){var g=this.programs[a],h=this.fn(a);return b||e||d||c?g=f(this,a,h,b,c,d,e):g||(g=this.programs[a]=f(this,a,h)),g},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=o.extend({},b,a)),c},noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){c.partial?(e.helpers=c.helpers,e.partials=c.partials,e.decorators=c.decorators):(e.helpers=e.merge(c.helpers,b.helpers),a.usePartial&&(e.partials=e.merge(c.partials,b.partials)),(a.usePartial||a.useDecorators)&&(e.decorators=e.merge(c.decorators,b.decorators)))},d._child=function(b,c,d,g){if(a.useBlockParams&&!d)throw new q["default"]("must pass block params");if(a.useDepths&&!g)throw new q["default"]("must pass parent depths");return f(e,b,a[b],c,0,d,g)},d}function f(a,b,c,d,e,f,g){function h(b){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h=g;return g&&b!==g[0]&&(h=[b].concat(g)),c(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),h)}return h=k(c,h,a,g,d,f),h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function g(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a="@partial-block"===c.name?c.data["partial-block"]:c.partials[c.name],a}function h(a,b,c){c.partial=!0,c.ids&&(c.data.contextPath=c.ids[0]||c.data.contextPath);var d=void 0;if(c.fn&&c.fn!==i&&(c.data=r.createFrame(c.data),d=c.data["partial-block"]=c.fn,d.partials&&(c.partials=o.extend({},c.partials,d.partials))),void 0===a&&d&&(a=d),void 0===a)throw new q["default"]("The partial "+c.name+" could not be found");return a instanceof Function?a(b,c):void 0}function i(){return""}function j(a,b){return b&&"root"in b||(b=b?r.createFrame(b):{},b.root=a),b}function k(a,b,c,d,e,f){if(a.decorator){var g={};b=a.decorator(b,g,c,d&&d[0],e,f,d),o.extend(b,g)}return b}var l=c(3)["default"],m=c(1)["default"];b.__esModule=!0,b.checkRevision=d,b.template=e,b.wrapProgram=f,b.resolvePartial=g,b.invokePartial=h,b.noop=i;var n=c(5),o=l(n),p=c(6),q=m(p),r=c(4)},function(a,b){(function(c){b.__esModule=!0,b["default"]=function(a){var b="undefined"!=typeof c?c:window,d=b.Handlebars;a.noConflict=function(){return b.Handlebars===a&&(b.Handlebars=d),a}},a.exports=b["default"]}).call(b,function(){return this}())},function(a,b){b.__esModule=!0;var c={helpers:{helperExpression:function(a){return"SubExpression"===a.type||("MustacheStatement"===a.type||"BlockStatement"===a.type)&&!!(a.params&&a.params.length||a.hash)},scopedId:function(a){return/^\.|this\b/.test(a.original)},simpleId:function(a){return 1===a.parts.length&&!c.helpers.scopedId(a)&&!a.depth}}};b["default"]=c,a.exports=b["default"]},function(a,b,c){function d(a,b){if("Program"===a.type)return a;h["default"].yy=n,n.locInfo=function(a){return new n.SourceLocation(b&&b.srcName,a)};var c=new j["default"](b);return c.accept(h["default"].parse(a))}var e=c(1)["default"],f=c(3)["default"];b.__esModule=!0,b.parse=d;var g=c(23),h=e(g),i=c(24),j=e(i),k=c(26),l=f(k),m=c(5);b.parser=h["default"];var n={};m.extend(n,l)},function(a,b){var c=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(a,b,c,d,e,f,g){var h=f.length-1;switch(e){case 1:return f[h-1];case 2:this.$=d.prepareProgram(f[h]);break;case 3:this.$=f[h];break;case 4:this.$=f[h];break;case 5:this.$=f[h];break;case 6:this.$=f[h];break;case 7:this.$=f[h];break;case 8:this.$=f[h];break;case 9:this.$={type:"CommentStatement",value:d.stripComment(f[h]),strip:d.stripFlags(f[h],f[h]),loc:d.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:f[h],value:f[h],loc:d.locInfo(this._$)};break;case 11:this.$=d.prepareRawBlock(f[h-2],f[h-1],f[h],this._$);break;case 12:this.$={path:f[h-3],params:f[h-2],hash:f[h-1]};break;case 13:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!1,this._$);break;case 14:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!0,this._$);break;case 15:this.$={open:f[h-5],path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 16:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 17:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 18:this.$={strip:d.stripFlags(f[h-1],f[h-1]),program:f[h]};break;case 19:var i=d.prepareBlock(f[h-2],f[h-1],f[h],f[h],!1,this._$),j=d.prepareProgram([i],f[h-1].loc);j.chained=!0,this.$={strip:f[h-2].strip,program:j,chain:!0};break;case 20:this.$=f[h];break;case 21:this.$={path:f[h-1],strip:d.stripFlags(f[h-2],f[h])};break;case 22:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 23:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 24:this.$={type:"PartialStatement",name:f[h-3],params:f[h-2],hash:f[h-1],indent:"",strip:d.stripFlags(f[h-4],f[h]),loc:d.locInfo(this._$)};break;case 25:this.$=d.preparePartialBlock(f[h-2],f[h-1],f[h],this._$);break;case 26:this.$={path:f[h-3],params:f[h-2],hash:f[h-1],strip:d.stripFlags(f[h-4],f[h])};break;case 27:this.$=f[h];break;case 28:this.$=f[h];break;case 29:this.$={type:"SubExpression",path:f[h-3],params:f[h-2],hash:f[h-1],loc:d.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:f[h],loc:d.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:d.id(f[h-2]),value:f[h],loc:d.locInfo(this._$)};break;case 32:this.$=d.id(f[h-1]);break;case 33:this.$=f[h];break;case 34:this.$=f[h];break;case 35:this.$={type:"StringLiteral",value:f[h],original:f[h],loc:d.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(f[h]),original:Number(f[h]),loc:d.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===f[h],original:"true"===f[h],loc:d.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:d.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:d.locInfo(this._$)};break;case 40:this.$=f[h];break;case 41:this.$=f[h];break;case 42:this.$=d.preparePath(!0,f[h],this._$);break;case 43:this.$=d.preparePath(!1,f[h],this._$);break;case 44:f[h-2].push({part:d.id(f[h]),original:f[h],separator:f[h-1]}),this.$=f[h-2];break;case 45:this.$=[{part:d.id(f[h]),original:f[h]}];break;case 46:this.$=[];break;case 47:f[h-1].push(f[h]);break;case 48:this.$=[f[h]];break;case 49:f[h-1].push(f[h]);break;case 50:this.$=[];break;case 51:f[h-1].push(f[h]);break;case 58:this.$=[];break;case 59:f[h-1].push(f[h]);break;case 64:this.$=[];break;case 65:f[h-1].push(f[h]);break;case 70:this.$=[];break;case 71:f[h-1].push(f[h]);break;case 78:this.$=[];break;case 79:f[h-1].push(f[h]);break;case 82:this.$=[];break;case 83:f[h-1].push(f[h]);break;case 86:this.$=[];break;case 87:f[h-1].push(f[h]);break;case 90:this.$=[];break;case 91:f[h-1].push(f[h]);break;case 94:this.$=[];break;case 95:f[h-1].push(f[h]);break;case 98:this.$=[f[h]];break;case 99:f[h-1].push(f[h]);break;case 100:this.$=[f[h]];break;case 101:f[h-1].push(f[h])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function(a,b){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(b.yytext=b.yytext.substr(5,b.yyleng-9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(b.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return b.yytext=e(1,2).replace(/\\"/g,'"'),80;case 32:return b.yytext=e(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return b.yytext=b.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();b.__esModule=!0,b["default"]=c},function(a,b,c){function d(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=a}function e(a,b,c){void 0===b&&(b=a.length);var d=a[b-1],e=a[b-2];return d?"ContentStatement"===d.type?(e||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(d.original):void 0:c}function f(a,b,c){void 0===b&&(b=-1);var d=a[b+1],e=a[b+2];return d?"ContentStatement"===d.type?(e||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(d.original):void 0:c}function g(a,b,c){var d=a[null==b?0:b+1];if(d&&"ContentStatement"===d.type&&(c||!d.rightStripped)){var e=d.value;d.value=d.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),d.rightStripped=d.value!==e}}function h(a,b,c){var d=a[null==b?a.length-1:b-1];if(d&&"ContentStatement"===d.type&&(c||!d.leftStripped)){var e=d.value;return d.value=d.value.replace(c?/\s+$/:/[ \t]+$/,""),d.leftStripped=d.value!==e,d.leftStripped}}var i=c(1)["default"];b.__esModule=!0;var j=c(25),k=i(j);d.prototype=new k["default"],d.prototype.Program=function(a){var b=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var d=a.body,i=0,j=d.length;j>i;i++){var k=d[i],l=this.accept(k);if(l){var m=e(d,i,c),n=f(d,i,c),o=l.openStandalone&&m,p=l.closeStandalone&&n,q=l.inlineStandalone&&m&&n;l.close&&g(d,i,!0),l.open&&h(d,i,!0),b&&q&&(g(d,i),h(d,i)&&"PartialStatement"===k.type&&(k.indent=/([ \t]+$)/.exec(d[i-1].original)[1])),b&&o&&(g((k.program||k.inverse).body),h(d,i)),b&&p&&(g(d,i),h((k.inverse||k.program).body))}}return a},d.prototype.BlockStatement=d.prototype.DecoratorBlock=d.prototype.PartialBlockStatement=function(a){this.accept(a.program),this.accept(a.inverse);var b=a.program||a.inverse,c=a.program&&a.inverse,d=c,i=c;if(c&&c.chained)for(d=c.body[0].program;i.chained;)i=i.body[i.body.length-1].program;var j={open:a.openStrip.open,close:a.closeStrip.close,openStandalone:f(b.body),closeStandalone:e((d||b).body)};if(a.openStrip.close&&g(b.body,null,!0),c){var k=a.inverseStrip;k.open&&h(b.body,null,!0),k.close&&g(d.body,null,!0),a.closeStrip.open&&h(i.body,null,!0),!this.options.ignoreStandalone&&e(b.body)&&f(d.body)&&(h(b.body),g(d.body))}else a.closeStrip.open&&h(b.body,null,!0);return j},d.prototype.Decorator=d.prototype.MustacheStatement=function(a){return a.strip},d.prototype.PartialStatement=d.prototype.CommentStatement=function(a){var b=a.strip||{};return{inlineStandalone:!0,open:b.open,close:b.close}},b["default"]=d,a.exports=b["default"]},function(a,b,c){function d(){this.parents=[]}function e(a){this.acceptRequired(a,"path"),this.acceptArray(a.params),this.acceptKey(a,"hash")}function f(a){e.call(this,a),this.acceptKey(a,"program"),this.acceptKey(a,"inverse")}function g(a){this.acceptRequired(a,"name"),this.acceptArray(a.params),this.acceptKey(a,"hash")}var h=c(1)["default"];b.__esModule=!0;var i=c(6),j=h(i);d.prototype={constructor:d,mutating:!1,acceptKey:function(a,b){var c=this.accept(a[b]);if(this.mutating){if(c&&!d.prototype[c.type])throw new j["default"]('Unexpected node type "'+c.type+'" found when accepting '+b+" on "+a.type);a[b]=c}},acceptRequired:function(a,b){if(this.acceptKey(a,b),!a[b])throw new j["default"](a.type+" requires "+b)},acceptArray:function(a){for(var b=0,c=a.length;c>b;b++)this.acceptKey(a,b),a[b]||(a.splice(b,1),b--,c--)},accept:function(a){if(a){if(!this[a.type])throw new j["default"]("Unknown type: "+a.type,a);this.current&&this.parents.unshift(this.current),this.current=a;var b=this[a.type](a);return this.current=this.parents.shift(),!this.mutating||b?b:b!==!1?a:void 0}},Program:function(a){this.acceptArray(a.body)},MustacheStatement:e,Decorator:e,BlockStatement:f,DecoratorBlock:f,PartialStatement:g,PartialBlockStatement:function(a){g.call(this,a),this.acceptKey(a,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:e,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(a){this.acceptArray(a.pairs)},HashPair:function(a){this.acceptRequired(a,"value")}},b["default"]=d,a.exports=b["default"]},function(a,b,c){function d(a,b){if(b=b.path?b.path.original:b,a.path.original!==b){var c={loc:a.path.loc};throw new q["default"](a.path.original+" doesn't match "+b,c)}}function e(a,b){this.source=a,this.start={line:b.first_line,column:b.first_column},this.end={line:b.last_line,column:b.last_column}}function f(a){return/^\[.*\]$/.test(a)?a.substr(1,a.length-2):a}function g(a,b){return{open:"~"===a.charAt(2),close:"~"===b.charAt(b.length-3)}}function h(a){return a.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function i(a,b,c){c=this.locInfo(c);for(var d=a?"@":"",e=[],f=0,g="",h=0,i=b.length;i>h;h++){var j=b[h].part,k=b[h].original!==j;if(d+=(b[h].separator||"")+j,k||".."!==j&&"."!==j&&"this"!==j)e.push(j);else{if(e.length>0)throw new q["default"]("Invalid path: "+d,{loc:c});".."===j&&(f++,g+="../")}}return{type:"PathExpression",data:a,depth:f,parts:e,original:d,loc:c}}function j(a,b,c,d,e,f){var g=d.charAt(3)||d.charAt(2),h="{"!==g&&"&"!==g,i=/\*/.test(d);return{type:i?"Decorator":"MustacheStatement",path:a,params:b,hash:c,escaped:h,strip:e,loc:this.locInfo(f)}}function k(a,b,c,e){d(a,c),e=this.locInfo(e);var f={type:"Program",body:b,strip:{},loc:e};return{type:"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:f,openStrip:{},inverseStrip:{},closeStrip:{},loc:e}}function l(a,b,c,e,f,g){e&&e.path&&d(a,e);var h=/\*/.test(a.open);b.blockParams=a.blockParams;var i=void 0,j=void 0;if(c){if(h)throw new q["default"]("Unexpected inverse block on decorator",c);c.chain&&(c.program.body[0].closeStrip=e.strip),j=c.strip,i=c.program}return f&&(f=i,i=b,b=f),{type:h?"DecoratorBlock":"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:b,inverse:i,openStrip:a.strip,inverseStrip:j,closeStrip:e&&e.strip,loc:this.locInfo(g)}}function m(a,b){if(!b&&a.length){var c=a[0].loc,d=a[a.length-1].loc;c&&d&&(b={source:c.source,start:{line:c.start.line,column:c.start.column},end:{line:d.end.line,column:d.end.column}})}return{type:"Program",body:a,strip:{},loc:b}}function n(a,b,c,e){return d(a,c),{type:"PartialBlockStatement",name:a.path,params:a.params,hash:a.hash,program:b,openStrip:a.strip,closeStrip:c&&c.strip,loc:this.locInfo(e)}}var o=c(1)["default"];b.__esModule=!0,b.SourceLocation=e,b.id=f,b.stripFlags=g,b.stripComment=h,b.preparePath=i,b.prepareMustache=j,b.prepareRawBlock=k,b.prepareBlock=l,b.prepareProgram=m,b.preparePartialBlock=n;var p=c(6),q=o(p)},function(a,b,c){function d(){}function e(a,b,c){if(null==a||"string"!=typeof a&&"Program"!==a.type)throw new k["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var d=c.parse(a,b),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function f(a,b,c){function d(){var d=c.parse(a,b),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}function e(a,b){return f||(f=d()),f.call(this,a,b)}if(void 0===b&&(b={}),null==a||"string"!=typeof a&&"Program"!==a.type)throw new k["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var f=void 0;return e._setup=function(a){return f||(f=d()),f._setup(a)},e._child=function(a,b,c,e){return f||(f=d()),f._child(a,b,c,e)},e}function g(a,b){if(a===b)return!0;if(l.isArray(a)&&l.isArray(b)&&a.length===b.length){for(var c=0;c<a.length;c++)if(!g(a[c],b[c]))return!1;return!0}}function h(a){if(!a.path.parts){var b=a.path;a.path={type:"PathExpression",data:!1,depth:0,parts:[b.original+""],original:b.original+"",loc:b.loc}}}var i=c(1)["default"];b.__esModule=!0,b.Compiler=d,b.precompile=e,b.compile=f;var j=c(6),k=i(j),l=c(5),m=c(21),n=i(m),o=[].slice;d.prototype={compiler:d,equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||!g(d.args,e.args))return!1}b=this.children.length;for(var c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=b,this.stringParams=b.stringParams,this.trackIds=b.trackIds,b.blockParams=b.blockParams||[];var c=b.knownHelpers;if(b.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},c)for(var d in c)d in c&&(b.knownHelpers[d]=c[d]);return this.accept(a)},compileProgram:function(a){var b=new this.compiler,c=b.compile(a,this.options),d=this.guid++;return this.usePartial=this.usePartial||c.usePartial,this.children[d]=c,this.useDepths=this.useDepths||c.useDepths,d},accept:function(a){if(!this[a.type])throw new k["default"]("Unknown type: "+a.type,a);this.sourceNode.unshift(a);var b=this[a.type](a);return this.sourceNode.shift(),b},Program:function(a){this.options.blockParams.unshift(a.blockParams);for(var b=a.body,c=b.length,d=0;c>d;d++)this.accept(b[d]);return this.options.blockParams.shift(),this.isSimple=1===c,this.blockParams=a.blockParams?a.blockParams.length:0,this},BlockStatement:function(a){h(a);var b=a.program,c=a.inverse;b=b&&this.compileProgram(b),c=c&&this.compileProgram(c);var d=this.classifySexpr(a);"helper"===d?this.helperSexpr(a,b,c):"simple"===d?(this.simpleSexpr(a),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("blockValue",a.path.original)):(this.ambiguousSexpr(a,b,c),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(a){var b=a.program&&this.compileProgram(a.program),c=this.setupFullMustacheParams(a,b,void 0),d=a.path;this.useDecorators=!0,this.opcode("registerDecorator",c.length,d.original)},PartialStatement:function(a){this.usePartial=!0;var b=a.program;b&&(b=this.compileProgram(a.program));var c=a.params;if(c.length>1)throw new k["default"]("Unsupported number of partial arguments: "+c.length,a);c.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):c.push({type:"PathExpression",parts:[],depth:0}));var d=a.name.original,e="SubExpression"===a.name.type;e&&this.accept(a.name),this.setupFullMustacheParams(a,b,void 0,!0);var f=a.indent||"";this.options.preventIndent&&f&&(this.opcode("appendContent",f),f=""),this.opcode("invokePartial",e,d,f),this.opcode("append")},PartialBlockStatement:function(a){this.PartialStatement(a)},MustacheStatement:function(a){this.SubExpression(a),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(a){this.DecoratorBlock(a)},ContentStatement:function(a){a.value&&this.opcode("appendContent",a.value)},CommentStatement:function(){},SubExpression:function(a){h(a);var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ambiguousSexpr:function(a,b,c){var d=a.path,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),d.strict=!0,this.accept(d),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.path;b.strict=!0,this.accept(b),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.path,f=e.parts[0];if(this.options.knownHelpers[f])this.opcode("invokeKnownHelper",d.length,f);else{if(this.options.knownHelpersOnly)throw new k["default"]("You specified knownHelpersOnly, but used the unknown helper "+f,a);e.strict=!0,e.falsy=!0,this.accept(e),this.opcode("invokeHelper",d.length,e.original,n["default"].helpers.simpleId(e))}},PathExpression:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0],c=n["default"].helpers.scopedId(a),d=!a.depth&&!c&&this.blockParamIndex(b);d?this.opcode("lookupBlockParam",d,a.parts):b?a.data?(this.options.data=!0,this.opcode("lookupData",a.depth,a.parts,a.strict)):this.opcode("lookupOnContext",a.parts,a.falsy,a.strict,c):this.opcode("pushContext")},StringLiteral:function(a){this.opcode("pushString",a.value)},NumberLiteral:function(a){this.opcode("pushLiteral",a.value)},BooleanLiteral:function(a){this.opcode("pushLiteral",a.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(a){var b=a.pairs,c=0,d=b.length;for(this.opcode("pushHash");d>c;c++)this.pushParam(b[c].value);for(;c--;)this.opcode("assignToHash",b[c].key);this.opcode("popHash")},opcode:function(a){this.opcodes.push({opcode:a,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(a){a&&(this.useDepths=!0)},classifySexpr:function(a){var b=n["default"].helpers.simpleId(a.path),c=b&&!!this.blockParamIndex(a.path.parts[0]),d=!c&&n["default"].helpers.helperExpression(a),e=!c&&(d||b);if(e&&!d){var f=a.path.parts[0],g=this.options;g.knownHelpers[f]?d=!0:g.knownHelpersOnly&&(e=!1)}return d?"helper":e?"ambiguous":"simple"},pushParams:function(a){for(var b=0,c=a.length;c>b;b++)this.pushParam(a[b])},pushParam:function(a){var b=null!=a.value?a.value:a.original||"";if(this.stringParams)b.replace&&(b=b.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",b,a.type),"SubExpression"===a.type&&this.accept(a);else{if(this.trackIds){var c=void 0;if(!a.parts||n["default"].helpers.scopedId(a)||a.depth||(c=this.blockParamIndex(a.parts[0])),c){var d=a.parts.slice(1).join(".");this.opcode("pushId","BlockParam",c,d)}else b=a.original||b,b.replace&&(b=b.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",a.type,b)}this.accept(a)}},setupFullMustacheParams:function(a,b,c,d){var e=a.params;return this.pushParams(e),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.accept(a.hash):this.opcode("emptyHash",d),e},blockParamIndex:function(a){for(var b=0,c=this.options.blockParams.length;c>b;b++){var d=this.options.blockParams[b],e=d&&l.indexOf(d,a);if(d&&e>=0)return[b,e]}}}},function(a,b,c){function d(a){this.value=a}function e(){}function f(a,b,c,d){var e=b.popStack(),f=0,g=c.length;for(a&&g--;g>f;f++)e=b.nameLookup(e,c[f],d);return a?[b.aliasable("container.strict"),"(",e,", ",b.quotedString(c[f]),")"]:e}var g=c(1)["default"];b.__esModule=!0;var h=c(4),i=c(6),j=g(i),k=c(5),l=c(29),m=g(l);e.prototype={nameLookup:function(a,b){return e.isValidJavaScriptVariableName(b)?[a,".",b]:[a,"[",JSON.stringify(b),"]"]},depthedLookup:function(a){return[this.aliasable("container.lookup"),'(depths, "',a,'")']},compilerInfo:function(){var a=h.COMPILER_REVISION,b=h.REVISION_CHANGES[a];return[a,b]},appendToBuffer:function(a,b,c){return k.isArray(a)||(a=[a]),a=this.source.wrap(a,b),this.environment.isSimple?["return ",a,";"]:c?["buffer += ",a,";"]:(a.appendToBuffer=!0,a)},initializeBuffer:function(){return this.quotedString("")},compile:function(a,b,c,d){this.environment=a,this.options=b,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!d,this.name=this.environment.name,this.isChild=!!c,this.context=c||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(a,b),this.useDepths=this.useDepths||a.useDepths||a.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||a.useBlockParams;var e=a.opcodes,f=void 0,g=void 0,h=void 0,i=void 0;for(h=0,i=e.length;i>h;h++)f=e[h],this.source.currentLocation=f.loc,g=g||f.loc,this[f.opcode].apply(this,f.args);if(this.source.currentLocation=g,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new j["default"]("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend("var decorators = container.decorators;\n"),this.decorators.push("return fn;"),d?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var k=this.createFunctionContext(d);if(this.isChild)return k;var l={compiler:this.compilerInfo(),main:k};this.decorators&&(l.main_d=this.decorators,l.useDecorators=!0);var m=this.context,n=m.programs,o=m.decorators;for(h=0,i=n.length;i>h;h++)n[h]&&(l[h]=n[h],o[h]&&(l[h+"_d"]=o[h],l.useDecorators=!0));return this.environment.usePartial&&(l.usePartial=!0),this.options.data&&(l.useData=!0),this.useDepths&&(l.useDepths=!0),this.useBlockParams&&(l.useBlockParams=!0),this.options.compat&&(l.compat=!0),d?l.compilerOptions=this.options:(l.compiler=JSON.stringify(l.compiler),this.source.currentLocation={start:{line:1,column:0}},l=this.objectLiteral(l),b.srcName?(l=l.toStringWithSourceMap({file:b.destName}),l.map=l.map&&l.map.toString()):l=l.toString()),l},preamble:function(){this.lastContext=0,this.source=new m["default"](this.options.srcName),this.decorators=new m["default"](this.options.srcName)},createFunctionContext:function(a){var b="",c=this.stackVars.concat(this.registers.list);c.length>0&&(b+=", "+c.join(", "));var d=0;for(var e in this.aliases){var f=this.aliases[e];this.aliases.hasOwnProperty(e)&&f.children&&f.referenceCount>1&&(b+=", alias"+ ++d+"="+e,f.children[0]="alias"+d)}var g=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&g.push("blockParams"),this.useDepths&&g.push("depths");var h=this.mergeSource(b);return a?(g.push(h),Function.apply(this,g)):this.source.wrap(["function(",g.join(","),") {\n  ",h,"}"])},mergeSource:function(a){var b=this.environment.isSimple,c=!this.forceBuffer,d=void 0,e=void 0,f=void 0,g=void 0;return this.source.each(function(a){a.appendToBuffer?(f?a.prepend("  + "):f=a,g=a):(f&&(e?f.prepend("buffer += "):d=!0,g.add(";"),f=g=void 0),e=!0,b||(c=!1))}),c?f?(f.prepend("return "),g.add(";")):e||this.source.push('return "";'):(a+=", buffer = "+(d?"":this.initializeBuffer()),f?(f.prepend("return buffer + "),g.add(";")):this.source.push("return buffer;")),a&&this.source.prepend("var "+a.substring(2)+(d?"":";\n")),this.source.merge()},blockValue:function(a){var b=this.aliasable("helpers.blockHelperMissing"),c=[this.contextName(0)];this.setupHelperArgs(a,0,c);var d=this.popStack();c.splice(1,0,d),this.push(this.source.functionCall(b,"call",c))},ambiguousBlockValue:function(){var a=this.aliasable("helpers.blockHelperMissing"),b=[this.contextName(0)];this.setupHelperArgs("",0,b,!0),this.flushInline();var c=this.topStack();b.splice(1,0,c),this.pushSource(["if (!",this.lastHelper,") { ",c," = ",this.source.functionCall(a,"call",b),"}"])},appendContent:function(a){this.pendingContent?a=this.pendingContent+a:this.pendingLocation=this.source.currentLocation,this.pendingContent=a},append:function(){if(this.isInline())this.replaceStack(function(a){return[" != null ? ",a,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var a=this.popStack();this.pushSource(["if (",a," != null) { ",this.appendToBuffer(a,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,b,c,d){var e=0;d||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(a[e++])),this.resolvePath("context",a,e,b,c)},lookupBlockParam:function(a,b){this.useBlockParams=!0,this.push(["blockParams[",a[0],"][",a[1],"]"]),this.resolvePath("context",b,1)},lookupData:function(a,b,c){a?this.pushStackLiteral("container.data(data, "+a+")"):this.pushStackLiteral("data"),this.resolvePath("data",b,0,!0,c)},resolvePath:function(a,b,c,d,e){var g=this;if(this.options.strict||this.options.assumeObjects)return void this.push(f(this.options.strict&&e,this,b,a));for(var h=b.length;h>c;c++)this.replaceStack(function(e){var f=g.nameLookup(e,b[c],a);return d?[" && ",f]:[" != null ? ",f," : ",e]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(a,b){this.pushContext(),this.pushString(b),"SubExpression"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(a){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(a?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(a.ids)),this.stringParams&&(this.push(this.objectLiteral(a.contexts)),this.push(this.objectLiteral(a.types))),this.push(this.objectLiteral(a.values))},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},registerDecorator:function(a,b){var c=this.nameLookup("decorators",b,"decorator"),d=this.setupHelperArgs(b,a);this.decorators.push(["fn = ",this.decorators.functionCall(c,"",["fn","props","container",d])," || fn;"])},invokeHelper:function(a,b,c){var d=this.popStack(),e=this.setupHelper(a,b),f=c?[e.name," || "]:"",g=["("].concat(f,d);this.options.strict||g.push(" || ",this.aliasable("helpers.helperMissing")),g.push(")"),this.push(this.source.functionCall(g,"call",e.callParams))},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(this.source.functionCall(c.name,"call",c.callParams))},invokeAmbiguous:function(a,b){this.useRegister("helper");var c=this.popStack();this.emptyHash();var d=this.setupHelper(0,a,b),e=this.lastHelper=this.nameLookup("helpers",a,"helper"),f=["(","(helper = ",e," || ",c,")"];this.options.strict||(f[0]="(helper = ",f.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",f,d.paramsInit?["),(",d.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",d.callParams)," : helper))"])},invokePartial:function(a,b,c){var d=[],e=this.setupParams(b,1,d);a&&(b=this.popStack(),delete e.name),c&&(e.indent=JSON.stringify(c)),e.helpers="helpers",e.partials="partials",e.decorators="container.decorators",a?d.unshift(b):d.unshift(this.nameLookup("partials",b,"partial")),this.options.compat&&(e.depths="depths"),e=this.objectLiteral(e),d.push(e),this.push(this.source.functionCall("container.invokePartial","",d))},assignToHash:function(a){var b=this.popStack(),c=void 0,d=void 0,e=void 0;this.trackIds&&(e=this.popStack()),this.stringParams&&(d=this.popStack(),c=this.popStack());var f=this.hash;c&&(f.contexts[a]=c),d&&(f.types[a]=d),e&&(f.ids[a]=e),f.values[a]=b},pushId:function(a,b,c){"BlockParam"===a?this.pushStackLiteral("blockParams["+b[0]+"].path["+b[1]+"]"+(c?" + "+JSON.stringify("."+c):"")):"PathExpression"===a?this.pushString(b):"SubExpression"===a?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:e,compileChildren:function(a,b){for(var c=a.children,d=void 0,e=void 0,f=0,g=c.length;g>f;f++){d=c[f],e=new this.compiler;var h=this.matchExistingProgram(d);null==h?(this.context.programs.push(""),h=this.context.programs.length,d.index=h,d.name="program"+h,this.context.programs[h]=e.compile(d,b,this.context,!this.precompile),this.context.decorators[h]=e.decorators,this.context.environments[h]=d,this.useDepths=this.useDepths||e.useDepths,this.useBlockParams=this.useBlockParams||e.useBlockParams):(d.index=h,d.name="program"+h,this.useDepths=this.useDepths||d.useDepths,this.useBlockParams=this.useBlockParams||d.useBlockParams)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){var b=this.environment.children[a],c=[b.index,"data",b.blockParams];return(this.useBlockParams||this.useDepths)&&c.push("blockParams"),this.useDepths&&c.push("depths"),"container.program("+c.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},push:function(a){return a instanceof d||(a=this.source.wrap(a)),this.inlineStack.push(a),a},pushStackLiteral:function(a){this.push(new d(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),a&&this.source.push(a)},replaceStack:function(a){var b=["("],c=void 0,e=void 0,f=void 0;if(!this.isInline())throw new j["default"]("replaceStack on non-inline");var g=this.popStack(!0);if(g instanceof d)c=[g.value],b=["(",c],f=!0;else{e=!0;var h=this.incrStack();b=["((",this.push(h)," = ",g,")"],c=this.topStack()}var i=a.call(this,c);f||this.popStack(),e&&this.stackSlot--,this.push(b.concat(i,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;this.inlineStack=[];for(var b=0,c=a.length;c>b;b++){var e=a[b];if(e instanceof d)this.compileStack.push(e);else{var f=this.incrStack();this.pushSource([f," = ",e,";"]),this.compileStack.push(f)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();if(!a&&c instanceof d)return c.value;if(!b){if(!this.stackSlot)throw new j["default"]("Invalid stack pop");this.stackSlot--}return c},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,b=a[a.length-1];return b instanceof d?b.value:b},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return this.source.quotedString(a)},objectLiteral:function(a){return this.source.objectLiteral(a)},aliasable:function(a){var b=this.aliases[a];return b?(b.referenceCount++,b):(b=this.aliases[a]=this.source.wrap(a),b.aliasable=!0,b.referenceCount=1,b)},setupHelper:function(a,b,c){var d=[],e=this.setupHelperArgs(b,a,d,c),f=this.nameLookup("helpers",b,"helper"),g=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : {}");return{params:d,paramsInit:e,name:f,callParams:[g].concat(d)}},setupParams:function(a,b,c){var d={},e=[],f=[],g=[],h=!c,i=void 0;h&&(c=[]),d.name=this.quotedString(a),d.hash=this.popStack(),this.trackIds&&(d.hashIds=this.popStack()),this.stringParams&&(d.hashTypes=this.popStack(),d.hashContexts=this.popStack());var j=this.popStack(),k=this.popStack();(k||j)&&(d.fn=k||"container.noop",d.inverse=j||"container.noop");for(var l=b;l--;)i=this.popStack(),c[l]=i,this.trackIds&&(g[l]=this.popStack()),this.stringParams&&(f[l]=this.popStack(),e[l]=this.popStack());return h&&(d.args=this.source.generateArray(c)),this.trackIds&&(d.ids=this.source.generateArray(g)),this.stringParams&&(d.types=this.source.generateArray(f),d.contexts=this.source.generateArray(e)),this.options.data&&(d.data="data"),this.useBlockParams&&(d.blockParams="blockParams"),d},setupHelperArgs:function(a,b,c,d){var e=this.setupParams(a,b,c);return e=this.objectLiteral(e),d?(this.useRegister("options"),c.push("options"),["options=",e]):c?(c.push(e),""):e}},function(){for(var a="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),b=e.RESERVED_WORDS={},c=0,d=a.length;d>c;c++)b[a[c]]=!0}(),e.isValidJavaScriptVariableName=function(a){return!e.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)},b["default"]=e,a.exports=b["default"]},function(a,b,c){function d(a,b,c){if(f.isArray(a)){for(var d=[],e=0,g=a.length;g>e;e++)d.push(b.wrap(a[e],c));return d}return"boolean"==typeof a||"number"==typeof a?a+"":a}function e(a){this.srcFile=a,this.source=[]}b.__esModule=!0;var f=c(5),g=void 0;try{}catch(h){}g||(g=function(a,b,c,d){this.src="",d&&this.add(d)},g.prototype={add:function(a){f.isArray(a)&&(a=a.join("")),this.src+=a},prepend:function(a){f.isArray(a)&&(a=a.join("")),this.src=a+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),e.prototype={isEmpty:function(){return!this.source.length},prepend:function(a,b){this.source.unshift(this.wrap(a,b))},push:function(a,b){this.source.push(this.wrap(a,b))},merge:function(){var a=this.empty();return this.each(function(b){a.add(["  ",b,"\n"])}),a},each:function(a){for(var b=0,c=this.source.length;c>b;b++)a(this.source[b])},empty:function(){var a=this.currentLocation||{start:{}};return new g(a.start.line,a.start.column,this.srcFile)},wrap:function(a){var b=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return a instanceof g?a:(a=d(a,this,b),new g(b.start.line,b.start.column,this.srcFile,a))},functionCall:function(a,b,c){return c=this.generateList(c),this.wrap([a,b?"."+b+"(":"(",c,")"])},quotedString:function(a){return'"'+(a+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)){var e=d(a[c],this);"undefined"!==e&&b.push([this.quotedString(c),":",e])}var f=this.generateList(b);return f.prepend("{"),f.add("}"),f},generateList:function(a){for(var b=this.empty(),c=0,e=a.length;e>c;c++)c&&b.add(","),b.add(d(a[c],this));return b},generateArray:function(a){var b=this.generateList(a);return b.prepend("["),b.add("]"),b}},b["default"]=e,a.exports=b["default"]}])}),function(root,doc,factory){factory(root.jQuery,root,doc)}(this,document,function(jQuery,window,document,undefined){(function($,undefined){$.extend($.support,{orientation:"orientation"in window&&"onorientationchange"in window})})(jQuery),function($){$.event.special.throttledresize={setup:function(){$(this).bind("resize",handler)},teardown:function(){$(this).unbind("resize",handler)}};var throttle=250,handler=function(){curr=(new Date).getTime(),diff=curr-lastCall,diff>=throttle?(lastCall=curr,$(this).trigger("throttledresize")):(heldCall&&clearTimeout(heldCall),heldCall=setTimeout(handler,throttle-diff))},lastCall=0,heldCall,curr,diff}(jQuery),function($,window){function handler(){var orientation=get_orientation();orientation!==last_orientation&&(last_orientation=orientation,win.trigger(event_name))}var win=$(window),event_name="orientationchange",get_orientation,last_orientation,initial_orientation_is_landscape,initial_orientation_is_default,portrait_map={0:!0,180:!0},ww,wh,landscape_threshold;if($.support.orientation){ww=window.innerWidth||win.width(),wh=window.innerHeight||win.height(),landscape_threshold=50,initial_orientation_is_landscape=ww>wh&&ww-wh>landscape_threshold,initial_orientation_is_default=portrait_map[window.orientation];if(initial_orientation_is_landscape&&initial_orientation_is_default||!initial_orientation_is_landscape&&!initial_orientation_is_default)portrait_map={"-90":!0,90:!0}}$.event.special.orientationchange=$.extend({},$.event.special.orientationchange,{setup:function(){if($.support.orientation&&!$.event.special.orientationchange.disabled)return!1;last_orientation=get_orientation(),win.bind("throttledresize",handler)},teardown:function(){if($.support.orientation&&!$.event.special.orientationchange.disabled)return!1;win.unbind("throttledresize",handler)},add:function(handleObj){var old_handler=handleObj.handler;handleObj.handler=function(event){return event.orientation=get_orientation(),old_handler.apply(this,arguments)}}}),$.event.special.orientationchange.orientation=get_orientation=function(){var isPortrait=!0,elem=document.documentElement;return $.support.orientation?isPortrait=portrait_map[window.orientation]:isPortrait=elem&&elem.clientWidth/elem.clientHeight<1.1,isPortrait?"portrait":"landscape"},$.fn[event_name]=function(fn){return fn?this.bind(event_name,fn):this.trigger(event_name)},$.attrFn&&($.attrFn[event_name]=!0)}(jQuery,window)}),define("syracuse-tablet/html/deps/jqm-orientation",function(){}),function(factory){factory(jQuery)}(function($){function encode(s){return config.raw?s:encodeURIComponent(s)}function decode(s){return config.raw?s:decodeURIComponent(s)}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value))}function parseCookieValue(s){s.indexOf('"')===0&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return s=decodeURIComponent(s.replace(pluses," ")),config.json?JSON.parse(s):s}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value}var pluses=/\+/g,config=$.cookie=function(key,value,options){if(arguments.length>1&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires=="number"){var days=options.expires,t=options.expires=new Date;t.setMilliseconds(t.getMilliseconds()+days*864e5)}return document.cookie=[encode(key),"=",stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result=key?undefined:{},cookies=document.cookie?document.cookie.split("; "):[],i=0,l=cookies.length;for(;i<l;i++){var parts=cookies[i].split("="),name=decode(parts.shift()),cookie=parts.join("=");if(key===name){result=read(cookie,value);break}!key&&(cookie=read(cookie))!==undefined&&(result[name]=cookie)}return result};config.defaults={},$.removeCookie=function(key,options){return $.cookie(key,"",$.extend({},options,{expires:-1})),!$.cookie(key)}}),define("syracuse-tablet/html/deps/jquery.cookie",function(){}),define("syracuse-tablet/html/js/init/initThirdParty",["require","exports","module","syracuse-tablet/html/js/helpers/handlebarsHelpers","syracuse-tablet/html/deps/handlebars.min","syracuse-tablet/html/deps/jqm-orientation","syracuse-tablet/html/deps/jquery.cookie"],function(require,exports,module){var handlebarsHelpers=require("syracuse-tablet/html/js/helpers/handlebarsHelpers"),handlebars=require("syracuse-tablet/html/deps/handlebars.min");require("syracuse-tablet/html/deps/jqm-orientation"),require("syracuse-tablet/html/deps/jquery.cookie"),exports.init=function(){return window.Handlebars=handlebars,$.smResolve().then(function(){handlebarsHelpers.registerHelpers(window.Handlebars)})}}),define("syracuse-tablet/html/js/init/initStyles",["require","exports","module","syracuse-tablet/html/js/helpers/environment"],function(require,exports,module){function _isReleaseVersion(){return document.location.href.indexOf("/index_debug.html")<0&&document.location.href.indexOf("/index_release.html")<0}function _loadCss(file){var ref=document.createElement("link");ref.setAttribute("rel","stylesheet"),ref.setAttribute("type","text/css"),ref.setAttribute("href",file),document.getElementsByTagName("head")[0].appendChild(ref)}function _isSurfaceTablet(){navigator.userAgent.toLowerCase().indexOf("tablet pc")>-1&&navigator.userAgent.toLowerCase().indexOf("windows")>-1}var environment=require("syracuse-tablet/html/js/helpers/environment");exports.init=function(){return $.smResolve().then(function(){var os=environment.getStyleOS(),styles;styles=os;var cssPlatform="./css/gen/"+styles+(_isReleaseVersion()?".min":"")+".css";_loadCss(cssPlatform);var cssGeneral="./css/default"+(_isReleaseVersion()?".min":"")+".css";return _loadCss(cssGeneral),styles})}}),define("syracuse-tablet/html/js/ui/uiSettings",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_cache={},_lookAndFeel;exports.init=function(os){_cache={},_lookAndFeel=os,_settings.gen=$.extend(!0,{},_settings.def,_settings[os])},exports.getLookAndFeel=function(){return _lookAndFeel},exports.getProp=function(path,device,orientation){if(path==null||arguments.length===0)return null;var res=jsutils.getPropByPath(_settings.gen,path,_cache);return res==null?null:(device&&res[device]&&(res=res[device]),orientation&&res[orientation]&&(res=res[orientation]),typeof res=="function"&&(res=res.call(null,device,orientation),_cache[Array.isArray(path)?path.join("."):path]=res),res)};var _settings={ios:null,android:null,windows:null,def:{hubLayout:{groupSpacing:55,landscapeMinHeigth:function(){return exports.getProp("hubGroup.landscapeBaseSize")*4+exports.getProp("hubGroup.landscapePadY")*5+40}},hubGroup:{landscapeBaseSize:66,landscapePadX:8,landscapePadY:8,portraitPadX:8,portraitPadY:8,portraitWideMinWidth:570},footer:{height:{tablet:50,smartphone:62}},header:{height:50},navigationStackBar:{height:40},breadcrumbs:{height:25},chartDetailToolbar:{height:40},colors:{CELLDEFCOLOR:"darkgrey",TILEDEFCOLOR:"darkgrey"}}}}),define("syracuse-tablet/html/js/init/initLocale",["require","exports","module","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var locale=require("syracuse-tablet/html/js/helpers/locale");exports.init=function(){var lang="en-GB";return locale.setLocale(lang)}}),define("syracuse-tablet/html/js/common/helpers",["require","exports","module"],function(require,exports,module){exports.createDiag=function(payload,$severity,$message,$stackTrace){if(!payload||!$.isPlainObject(payload))payload={};return payload.$diagnoses=payload.$diagnoses||[],payload.$diagnoses.push({$severity:($severity||"error").toLowerCase(),$message:$message,$stackTrace:$stackTrace}),payload},exports.getValueByPath=function(jsonData,path){var segs=path.split("."),data=jsonData;for(var i=0;i<segs.length;i++)data=data==null?null:data[segs[i]];return data};var _office$Types=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.ms-excel","application/syracuse-excel-worksheet","application/syracuse-word-report","application/syracuse-word-mailmerge","application/syracuse-ppt-slide"];exports.isOfficeLink=function(info){return info&&info.$type&&_office$Types.indexOf(info.$type)>=0?!0:!1},exports.isPaginLink=function(name){return name==="$first"||name==="$previous"||name==="$next"||name==="$last"}}),define("syracuse-tablet/html/js/sdata/protocolHelpers",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _removeKeyFromUrl(url){return url.replace(/(\/\w+)(\(\S+\))(\/\$services|\?)/,"$1$3")}function _transformDashboard(datasetJson,prototypeJson,articleJson){var proto=$.extend(!0,{},prototypeJson),data=$.extend(!0,{},datasetJson);proto.$properties={},["dashboardName","title","description"].forEach(function(p){proto.$properties[p]=prototypeJson.$properties[p]}),proto.$title=datasetJson.title,data.$vignettes=data.vignettes,delete data.vignettes,delete data.$properties;var defaultArticle={$layoutType:"stack",$items:[]};for(var i=0,j=datasetJson.vignettes.length;i<j;i++){var vignette=datasetJson.vignettes[i],vid=vignette.persistentId,gadget=datasetJson.$mobileGadgets[vignette.gadget.$uuid];if(!gadget)throw new Error("Gadget not found "+vignette.gadget.$uuid);gadget.$clientContext=datasetJson.$clientContext;var prop=proto.$properties[vid]={$item:gadget};prop.$item.$uuid=vignette.gadget.$uuid,vignette.displayStyle==="$full"?prop.$type="application/x-vignette":prop.$type="application/x-vignette-link",prop.$title=prop.$item.$title,data[vid]=vignette.gadget.$uuid,defaultArticle.$items.push({$bind:vid})}return{datasetJson:data,prototypeJson:proto,articleJson:articleJson||defaultArticle}}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale");exports.getPageUrl=function(dataUrl,sdataResponse){var repr=exports.getReprFromUrl(dataUrl),baseUrl=exports.getHostPortFromUrl(dataUrl),endpoint=exports.getEndpointFromUrl(dataUrl);repr==="mobileDashboard.$details"&&sdataResponse&&(repr=sdataResponse.dashboardName+".$mobileDashboard",endpoint="syracuse.collaboration.syracuse");var url=baseUrl+"/sdata/syracuse/collaboration/syracuse/pages('"+endpoint+"."+repr+",$page,,mobile')";return $.smResolve(url)},exports.getPrototypeUrl=function(dataUrl){var repr=exports.getReprFromUrl(dataUrl),baseUrl=exports.getBaseUrlFromUrl(dataUrl),url=baseUrl+"/$prototypes('"+repr+"')";return url},exports.getReprInfoFromUrl=function(url){url=decodeURIComponent(url);var repr=/representation=(\S+?)\.(\$[a-zA-Z]+)/.exec(url);return repr&&repr.length>2?{representation:repr[1],facet:repr[2]}:null},exports.getReprFromUrl=function(url){var info=exports.getReprInfoFromUrl(url);return info?info.representation+"."+info.facet:null},exports.getEndpointFromUrl=function(url){if(!url.smStartsWith("http")){var fullurl="http://host";url.smStartsWith("/")||(fullurl+="/"),url=fullurl+url}var segs=url.split("/"),endpoint=segs.slice(4,7).join(".");return endpoint},exports.getBaseUrlFromUrl=function(url){var segs=url.split("/"),host=segs.slice(0,7).join("/");return host},exports.getKeyFromUrl=function(url){var keyOnly=/\('(.*?)'\)/.exec(url);if(keyOnly&&keyOnly[1]!=null)return keyOnly[1];var keyWithEq=/\((.*eq.*?)'(.*?)'\)/.exec(url);if(keyWithEq&&keyWithEq[2]!=null)return keyWithEq[2]},exports.getHostPort=function(){return exports.getHostPortFromUrl(window.location.href)},exports.getHostPortFromUrl=function(url){var segs=url.split("/"),host=segs.slice(0,3).join("/");return host},exports.getMobileAppUrl=function(appName){var php=exports.getHostPort(),appUrl=php+"/sdata/syracuse/collaboration/syracuse/mobileApplications(applicationName%20eq%20'"+appName+"')";return appUrl},exports.getLocalDashboardUrl=function(dashboardName){return exports.getHostPort()+"/mobile2/$client/$local/$dataset/mobileDashboard('"+dashboardName+"')"},exports.createActionData=function(dataset,$actionName,$action,workingCopy){var actionData={};if(workingCopy){actionData.data={},actionData.data.$actions={},actionData.data.$actions[$actionName]={$isRequested:!0},actionData.$url=dataset.getUrl(),actionData.data.$url=actionData.$url,actionData.data.$etag=dataset.getValue("$etag"),actionData.data.$uuid=dataset.getValue("$uuid"),actionData.$method="PUT";if($action.$parameters){var act=actionData.data.$actions[$actionName];act.$parameters={},Object.keys($action.$parameters).forEach(function(param){act.$parameters[param]=dataset.resolveExpression($action.$parameters[param])})}}else{var data=dataset.getData(workingCopy);actionData.data=data;var facet=dataset.getFacet(),$url=dataset.getUrl(!0);if($actionName==="$save")facet==="$create"?($url=_removeKeyFromUrl($url),actionData.$method="POST"):actionData.$method="PUT",actionData.$url=$url;else{if($actionName==="$abort")return null;$url=$url.replace("?","/$services/"+$actionName+"?"),$url=$url.replace("/sdata/","/mobile2/"),facet==="$create"?($url=_removeKeyFromUrl($url),actionData.$method="PUT"):actionData.$method="POST",actionData.$url=$url}}return actionData},exports.computeActionResult=function($actionName,response){var data=response.data,result={success:!1};if(!data)return result.$diagnoses[{$severity:"error",$message:"unexpected null data ["+$actionName+"]"}],result;var diags=[];data.$diagnoses&&data.$diagnoses.length>0&&(diags=diags.concat(data.$diagnoses)),data.$actions&&data.$actions[$actionName]&&data.$actions[$actionName].$diagnoses&&(diags=diags.concat(data.$actions[$actionName].$diagnoses));var errors=[],successes=[];return diags.forEach(function(diag){diag.$severity==="error"?errors.push(diag):(diag.$severity==="success"||diag.$severity==="info"||diag.$severity==="warning")&&successes.push(diag)}),errors.length>0?(result.$diagnoses=errors,result):successes.length>0?(result.$diagnoses=successes,result.success=!0,result):exports.hasFieldLevelErrors(data)?(result.$diagnoses=[{$severity:"error",$message:locale.text("action.error.field")}],result):(result.$diagnoses=[{$severity:"success",$message:locale.text("action.success")}],result.success=!0,result)},exports.hasFieldLevelErrors=function(data){function scanNode(node){if(!node)return!1;var errors;if(Array.isArray(node.$diagnoses)){errors=node.$diagnoses.some(function(diag){return diag.$severity==="error"});if(errors)return!0}if($.isPlainObject(node)){errors=Object.keys(node).some(function(key){return scanNode(node[key])});if(errors)return!0}else if(Array.isArray(node)){errors=node.some(function(item){return scanNode(item)});if(errors)return!0}return!1}return scanNode(data)},exports.checkTransform=function($url,prototypeJson,datasetJson,pageJson){var parsed=jsutils.parseURL($url),articleJson=pageJson.$article,viewsJson=pageJson.$views,rolesJson=[];pageJson.$roles&&pageJson.$roles.forEach(function(role){rolesJson.push({$uuid:role.$uuid})});var $mobileProtocol=(parsed.query&&parsed.query.$mobileProtocol)==="workingcopy"?"workingcopy":"stateless",$mobileEndpoint=parsed.query&&parsed.query.$mobileEndpoint,$mobileApplication=parsed.query&&parsed.query.$mobileApplication;datasetJson.$clientContext||(datasetJson.$clientContext={$mobileProtocol:$mobileProtocol,$mobileEndpoint:$mobileEndpoint,$mobileApplication:$mobileApplication});if(prototypeJson.$representation==="mobileApplication"){var $applicationName=datasetJson.applicationName,$savedCtx=datasetJson.$clientContext;$savedCtx.$mobileProtocol=datasetJson.onlineOnly===!0?"workingcopy":"stateless",$savedCtx.$mobileApplication=datasetJson.applicationName,datasetJson.useHomeGadget!==!0?(prototypeJson=prototypeJson.$mobileDashboardProto,datasetJson=datasetJson.$homeDashboard):datasetJson.$homeGadget&&(prototypeJson=datasetJson.$homeGadgetFetched.prototype,datasetJson=datasetJson.$homeGadgetFetched.dataset),articleJson=datasetJson.$page.$article,viewsJson=datasetJson.$page.$views,datasetJson.$page.$roles&&datasetJson.$page.$roles.forEach(function(role){rolesJson.push({$uuid:role.$uuid})}),datasetJson.$clientContext=$savedCtx}if(prototypeJson.$representation==="mobileDashboard"){var transformed=_transformDashboard(datasetJson,prototypeJson,articleJson);datasetJson=transformed.datasetJson,prototypeJson=transformed.prototypeJson,prototypeJson.$applicationName=$applicationName||null,articleJson=transformed.articleJson}var result={prototypeJson:prototypeJson,datasetJson:datasetJson,page:{$article:articleJson,$views:viewsJson,$roles:rolesJson}};return result},exports.adjustLinkProtocol=function($link,$mobileProtocol){return $mobileProtocol!=="workingcopy"&&$link.$url&&$link.$url.indexOf("$forceProtocol=true")<0&&($link=$.extend(!0,{},$link),$link.$method!=="DELETE"&&$link.$url.indexOf("$services")<0&&($link.$method="GET"),$link.$url.indexOf("/$workingCopies?")>-1&&($link.$url=$link.$url.replace("/$workingCopies?","?"))),$link},exports.addClientContext=function($url,$clientContext){var result=$url;for(var prop in $clientContext)if(result.indexOf(prop+"=")<0&&$clientContext[prop]){var delim=result.indexOf("?")>-1?"&":"?";result=result+delim+prop+"="+encodeURIComponent($clientContext[prop])}return result},exports.getPageName=function(url){var urlLC=url.toLowerCase();if(urlLC.indexOf("/mobiledashboard")>=0)return exports.getKeyFromUrl(url);if(urlLC.indexOf("html://")===0||urlLC.indexOf("child://")===0){var name=url.split("/")[2]||"";return["?","#"].forEach(function(c){var idx=name.indexOf(c);idx>=0&&(name=name.substr(0,idx))}),name}var rep=exports.getReprFromUrl(url);return rep||"unknown"},exports.transformOldDashboardUrl=function($link,dataset){var url=$link.$url;if(url.indexOf("/$mobileDashboards?dashboard=")>-1){try{var parsed=jsutils.parseURL(url),dashboard=parsed.query.dashboard,parameters=parsed.query.parameters,params=parameters&&parameters.split("&").map(function(param){var tmp=param.split("="),key=tmp[0],val=tmp[1];return val=dataset.resolveExpression(val),key+"="+val}).join("&"),baseUrl=exports.getHostPortFromUrl(url),url=baseUrl+"/sdata/syracuse/collaboration/syracuse/mobileDashboards(dashboardName eq '"+encodeURIComponent(dashboard)+"')?representation=mobileDashboard.$details";params&&(url=url+"&parameters="+encodeURIComponent(params)),$link.$url=url}catch(e){}return $link}return $link},exports.getDashboardParams=function(url){var obj={};try{var parsed=jsutils.parseURL(url),parameters=parsed.query.parameters;return parameters&&parameters.split("&").map(function(param){var tmp=param.split("=");obj[tmp[0]]={value:tmp[1]}}),obj}catch(e){}return null},exports.localEndpoint="$client.$local.$dataset",exports.isLocaleUrl=function(url){var parsed=jsutils.parseURL(url);return parsed.path.smStartsWith("/syracuse-tablet")?!0:exports.getEndpointFromUrl(url)===exports.localEndpoint}}),define("syracuse-tablet/html/js/common/ajax",["require","exports","module","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var helpers=require("syracuse-tablet/html/js/common/helpers"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),globals=require("syracuse-tablet/html/js/app/globals"),locale=require("syracuse-tablet/html/js/helpers/locale");exports.request=function(url,method,data,headers,options){options=options||{},method=method&&method.toUpperCase()||"GET";var timeout=options.timeout==null?globals.getHttpTimeout(url):options.timeout,acceptStatusCode=options.acceptStatusCode||[],lang=locale.getCurrentLocale()||"en-US",allHeaders={Accept:"application/json;vnd.sage=syracuse"};if(method==="POST"||method==="PUT")allHeaders["Content-Type"]="application/json";lang&&(allHeaders["Accept-Language"]=lang),headers&&$.extend(allHeaders,headers);var ajaxData={headers:allHeaders,type:method,url:url,timeout:timeout},parseJson=allHeaders.Accept.indexOf("application/json")>=0;parseJson&&(ajaxData.dataType="json");if(["PUT","POST"].indexOf(method)>=0&&data!=null){ajaxData.contentType=options.contentType||"application/json;charset=utf-8",ajaxData.data=data;if(ajaxData.contentType.indexOf("application/json")>=0&&typeof data=="object")try{ajaxData.data=JSON.stringify(data)}catch(e){return $.smReject(helpers.createDiag(null,"error",e.Message))}}var deferred=$.Deferred();return $.ajax(ajaxData).always(function(jqXHR,textStatus,jqXHRSuccess){var result;try{jqXHRSuccess&&jqXHRSuccess.getAllResponseHeaders&&(jqXHR=jqXHRSuccess);var status=jqXHR.status!=null?jqXHR.status:textStatus=="success"?200:500,regularSuccess=status>=200&&status<300||status===304;result={headers:{},status:status,success:regularSuccess||acceptStatusCode.indexOf(status)>=0};if(result.success&&parseJson){result.data=jqXHR.responseJSON;if(result.data==null&&regularSuccess){var txt=(jqXHR.responseText||"").trim();if(txt.length>0)try{result.data=JSON.parse(txt)}catch(e){deferred.reject(helpers.createDiag(null,"error","Error parsing HTTP response",e.message+"\nUrl: "+url+"\n"+jsutils.cleanStack(e.stack)));return}}else result.data&&result.data.mobileClientConfig&&globals.setMobileClientConfig(result.data.mobileClientConfig)}else result.data=parseJson&&jqXHR.responseJSON?jqXHR.responseJSON:jqXHR.responseText;var headerStr=jqXHR.getAllResponseHeaders();if(headerStr){var _rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,match;while(match=_rheaders.exec(headerStr))result.headers[match[1].toLowerCase()]=match[2]}var diags=null;if(result.success===!0)deferred.resolve(result);else if(status===0)result.offline=!0,deferred.reject(helpers.createDiag(result,"error",locale.text("client.offline")));else if(status===404){var message;result.data&&result.data.$diagnoses&&result.data.$diagnoses.length>0&&(message=result.data.$diagnoses[0].$message+" (Status 404)"),deferred.reject(helpers.createDiag(result,"error",message||locale.text("http404"),"url:"+url))}else status===401?(result.unauthenticated=!0,deferred.reject(helpers.createDiag(result,"error",locale.text("user.not.authenticated")))):(result.data&&result.data.$diagnoses?(diags=result,diags.$diagnoses=result.data.$diagnoses):diags=helpers.createDiag(result,"error","Error http "+status+" reading resource","url:"+url+"\n"+jqXHR.responseText),deferred.reject(diags))}catch(e){deferred.reject(helpers.createDiag(null,"error",e.message))}}),deferred.promise()}}),define("syracuse-tablet/html/js/helpers/utils",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_forceUseCache=function(){var url=jsutils.getCurrentUrl();return url.query&&url.query.forceUseCache==="true"},_forceDvlpMode=function(){var url=jsutils.getCurrentUrl();return url.query&&url.query.forceDvlpMode==="true"},_addClassMembers=function(klass,members){if(!klass||!members||!klass.prototype)return;var proto=klass.prototype;for(var name in members||{}){var member=members[name];typeof member.get=="function"||typeof member.set=="function"?Object.defineProperty(proto,name,member):proto[name]=member}},_defineClass=function(constructor,parent,members){return parent&&(constructor.prototype=Object.create(parent.prototype)),constructor.prototype.constructor=constructor,_addClassMembers(constructor,members),jsutils.addInheritanceInfo(constructor,parent),constructor},_UUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})},_getCurISODateTime=function(date){var currentdate=date||new Date,values=[currentdate.getFullYear(),4,currentdate.getMonth()+1,2,currentdate.getDate(),2,currentdate.getHours(),2,currentdate.getMinutes(),2,currentdate.getSeconds(),2],datetime;for(var i=0;i<values.length;i+=2){var val=""+values[i];while(val.length<values[i+1])val="0"+val;datetime?datetime+="-"+val:datetime=val}return datetime},_isoDateTimeToDate=function(stringDate){if(stringDate==null||typeof stringDate!="string")return new Date;var val=stringDate.split("-");return val.length!==6?new Date:new Date(val[0],parseInt(val[1],10)-1,val[2],val[3],val[4],val[5])},_getTimeFromString=function(stringDate){if(stringDate){var val=stringDate.split("-");return(new Date(val[0],parseInt(val[1],10)-1,val[2],val[3],val[4],val[5])).getTime()}return(new Date).getTime()},_domIdCpt=0,_domId=function(id){return id.replace(/([^\w-_])/g,"_")},_uidCpt=0,_readableuid=function(){return _domId($.camelCase((arguments.length>0?Array.prototype.join.call(arguments,"-")+"-":"")+_uidCpt++))},_unitTestId=function(){return arguments.length===0?null:Array.prototype.join.call(arguments,"-")},_qsParser=/([^&=;]*)=?([^&;]*)/g,_parseQueryString=function(qs){qs=qs||window.location.search;var res={},qs=decodeURIComponent(qs),ii=qs.indexOf("?");return ii>=0&&(qs=qs.substring(ii+1)),qs.replace(_qsParser,function($0,$1,$2){$1&&$1.length>0&&(res[$1]=decodeURIComponent($2))}),res},_exprRegExp=/\{(.*?)\}/g,_execExpression=function(expression,dataset,prototype,searchInParent,level,keepPlaceholder){level=level||0,expression=(expression||"")+"";var prevProp=null,res=expression.replace(_exprRegExp,function(match,prop){var empty=keepPlaceholder?match:"",val=dataset==null?null:dataset.getValue?dataset.getValue(prop,undefined,searchInParent):dataset[prop];return val!=null?val:prototype?prop.smStartsWith("@")?prototype.localization(prop)||"":(val=prototype.data(prop,dataset,null,!0),val!=null&&val.indexOf("{")>=0&&level<4?_execExpression(val,dataset,prototype,searchInParent,level+1,keepPlaceholder):val==null?empty:val):empty});return res||""},_extractCode=function($expression){return $expression+="",$expression.indexOf("{")>=0?$expression.slice(1,$expression.length-1):$expression},_isExpression=function(value){return $.type(value)!=="string"?!1:/^{@.*}$/.test(value)},_sanitizeArticle=function(article){function _walk(value){if(value==null||typeof value!="object")return;Object.keys(value).forEach(function(key){var v=value[key];key!=="$title"&&key!=="$titleOrig"||v==""||!!_isExpression(v)?_walk(v):delete value[key]})}if(!article)return article;var value=$.extend(!0,{},article);return _walk(value),value},_stopClickEvent=function(e){return e.shiftKey!==!0&&e.altKey!==!0},refTime=(new Date).getTime(),_timeLineCfg={ajax:!1,page:!1,pageLoader:!1,cacheUpdate:!1},_TimeLine=_defineClass(function(type,id){this.type=type,this.id=id},null,{log:function(step){var time=(new Date).getTime(),delta=this._prevTime==null?0:time-this._prevTime;this._prevTime=time,console.log(time-refTime,this.type,this.id,step,"elasped="+(time-this._start),"delta="+delta)},start:function(step){this._start=(new Date).getTime(),this.log(step?"start "+step:"start")},step:function(step){this.log(step)},stop:function(step){this.log(step?"stop "+step:"stop")},reset:function(){return this._prevTime=null,this._start=null,this}}),_getTimeLine=function(type,id,forceEnable){try{if(forceEnable===!1)return;if(forceEnable!==!0&&_timeLineCfg[type]!==!0)return null;if(type.indexOf("page")===-1&&id!=null){id+="";var p=id.indexOf("representation=");if(p>=0)id=id.substr(p+15);else{var p=id.indexOf("x3/erp/");if(p>=0)id=id.substr(p+7);else{var p=id.indexOf("collaboration/syracuse/");id=id.substr(p+23)}}id=decodeURIComponent(id)}return new _TimeLine(type,id)}catch(e){console.log(e)}},_hasProp=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},_areEqual=function(obj1,obj2,strict){if(strict?obj1===obj2:obj1==obj2)return!0;if(obj1==null||obj2==null)return!1;if(Array.isArray(obj1)&&Array.isArray(obj2)){if(obj1.length!=obj2.length)return!1;for(var i=0;i<obj1.length;i++)if(!_areEqual(obj1[i],obj2[i]))return!1;return!0}if(typeof obj1!="object"||typeof obj2!="object")return!1;var combined=$.extend({},obj1);$.extend(combined,obj2);for(var i in combined)if(_hasProp(combined,i)){var val1=obj1[i],val2=obj2[i];if(!_areEqual(val1,val2))return!1}return!0},_typeNamesByMime={},_regExpMimeToType=/-|\//g;exports.getTypeName=function(mime){var type=_typeNamesByMime[mime];if(!type){var a=mime.split(_regExpMimeToType);type=_typeNamesByMime[mime]=a[a.length-1]}return type},exports._checksum=function(text){var a=1,b=0;for(var index=0;index<text.length;++index)a=(a+text.charCodeAt(index))%65521,b=(b+a)%65521;return b<<16|a},exports.arrayInt=function(min,max){return Array(max-min+2).join().split(",").map(function(e,i){return min+i})},exports.isPromise=function(o){return o==null?!1:typeof o=="object"&&typeof o.then=="function"&&typeof o.fail=="function"},exports.toPromise=function(o){return exports.isPromise(o)?o:$.smResolve(o)},exports.areEqual=_areEqual,exports.stopClickEvent=_stopClickEvent,exports.extractCode=_extractCode,exports.isExpression=_isExpression,exports.sanitizeArticle=_sanitizeArticle,exports.UUID=_UUID,exports.defineClass=_defineClass,exports.addClassMembers=_addClassMembers,exports.readableuid=_readableuid,exports.domId=_domId,exports.unitTestId=_unitTestId,exports.parseQueryString=_parseQueryString,exports.getCurISODateTime=_getCurISODateTime,exports.isoDateTimeToDate=_isoDateTimeToDate,exports.getTimeFromString=_getTimeFromString,exports.parseExpression=function(expression,dataset,prototype,searchInParent,keepPlaceholder){return _execExpression(expression,dataset,prototype,searchInParent,0,keepPlaceholder)},exports.isLocalizationExits=function($localization,uiId){if(!$localization||!uiId)return!1;var uuid=uiId.match(/\{\@(\S+)\}/),count=0;return uuid=uuid&&uuid[1]||uiId,Object.keys($localization).forEach(function(key){$localization[key][uuid]&&$localization[key][uuid]!==""&&count++}),count>1},exports.removeLocalization=function($localization,uuid){return!$localization||!uuid?!1:(Object.keys($localization).forEach(function(key){$localization[key][uuid]&&delete $localization[key][uuid]}),$localization)},exports.setLocalization=function($localization,uuid,text){return $localization[locale.getCurrentLocale()]=$localization[locale.getCurrentLocale()]||{},$localization[locale.getCurrentLocale()][uuid]=text,$localization},exports.getNavigatorLanguage=function(def){return navigator.language||navigator.userLanguage||def},exports.sameLanguage=function(l1,l2){return!l1||!l2?!1:(l1=l1.toLowerCase(),l2=l2.toLowerCase(),l2===l1?!0:(l1=l1.split("-"),l2=l2.split("-"),l1[0]===l2[0]))},exports.splitSdataKey=function(key){return key&&key.split("~")};var _splitExp=/({)|(})/g;exports.sdataExtractKeyFields=function(key){if(key==null||key.length===0||!key.replace)return;return exports.splitSdataKey(key.replace(_splitExp,""))},exports.getPropByPath=jsutils.getPropByPath,exports.getTimeLine=_getTimeLine,exports.forceUseCache=_forceUseCache,exports.forceDvlpMode=_forceDvlpMode,exports.checkUrlHostAndPort=function(url){if(!url)return url;var URL=jsutils.parseURL(url);return!URL.protocol||!URL.host?(URL.protocol=jsutils.getCurrentUrl().protocol,URL.host=jsutils.getCurrentUrl().host,URL.port=jsutils.getCurrentUrl().port,jsutils.urlToString(URL)):url}}),define("syracuse-tablet/html/js/storage/storageInterface",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_statusCodes={OK:1,NOT_FOUND:2,ERROR:3};exports.Klass=utils.defineClass(function(infoString,databaseVersion){this.infoString=infoString,this.databaseName=exports.databaseName,this.databaseVersion=databaseVersion,this.useTestDatabase=!1,this.db=null},null,{getInfo:function(){return this.infoString},init:function(){throw new Error("Not implemented!")},query:function(opts){throw new Error("Not implemented!")},put:function(opts){throw new Error("Not implemented!")},read:function(opts){throw new Error("Not implemented!")},remove:function(opts){throw new Error("Not implemented!")},clearCollection:function(){throw new Error("Not implemented!")},computeCollectionSize:function(){throw new Error("Not implemented!")},clearDatabaseSupported:function(){return!1},draftOperation:function(op){},templateOperation:function(op){}}),exports.resultToString=function(result){if(!result)return"";if(jsutils.isError(result))return JSON.stringify(jsutils.convertToDiagnoses(result),null,2);var res=[];return result.$status&&res.push("status: "+result.$status),result.$message&&res.push("Message: "+result.$message),result.$exception&&result.$exception.message&&res.push("Exception: "+result.$exception.message),result.$exception&&result.$exception.stack&&res.push("Stack: "+result.$exception.stack),res.join("\n")},exports.buildResult=function(status,data,message,exception,metaData){var res={$status:status};return data&&(res.$data=data),metaData&&(res.$metaData=metaData),message&&(res.$message=message),exception&&(res.$exception=exception),status===_statusCodes.ERROR&&(res.$diagnoses=res.$diagnoses||[],res.$diagnoses.push({$severity:"error",$message:message})),res},exports.buildErrResult=function(message,exception){return exports.buildResult(_statusCodes.ERROR,null,message,exception)},exports.StatusCodes=_statusCodes,exports.databaseName="sage-tablet-db"}),define("syracuse-tablet/html/js/storage/storageWebSQLBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=storageInterface.Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("webSQL",!1),_databaseVersion=24,_databaseSize=2097152;exports.Klass=utils.defineClass(function(){Base.call(this,"WebSQL storage interface",_databaseVersion),this.databaseSize=_databaseSize},Base,{init:function(){var deferred=$.Deferred(),self=this;return $.smResolve().then(function(){return self.useTestDatabase=jsutils.isTestEnvironment(),self.databaseName=storageInterface.databaseName+(self.useTestDatabase?"-test":""),self.useTestDatabase===!1&&self.db?$.smResolve(storageInterface.StatusCodes.OK):self._openDB()}).then(function(status){deferred.resolve(status)}).fail(function(e){log&&log("Open database exception",JSON.stringify(storageInterface.buildErrResult(e),null,2));var msg=locale.text("db.err.init"),diags;if(jsutils.isError(e)||jsutils.isDOMException(e)){var diags=jsutils.convertToDiagnoses(e);diags.$diagnoses[0].$message=msg}else diags=storageInterface.buildErrResult(msg,e);deferred.reject(diags)}),deferred.promise()},_openDB:function(){var self=this;return $.smResolve().then(function(){var request;return log&&log("Open database, request version: "+self.databaseVersion),self.db=openDatabase(self.databaseName,7,"Database",self.databaseSize),self._readCurrentVersion().then(function(version){return log&&log("Current version: "+version),version===self.databaseVersion&&self.useTestDatabase!==!0?storageInterface.StatusCodes.OK:self._createTables().then(function(status){return self._writeCurrentVersion()})})})},_writeCurrentVersion:function(){var self=this,deferred=$.Deferred();return self._executeSql("DELETE FROM version",null).then(function(result){return self._executeSql("INSERT INTO version (version) values (?)",[_databaseVersion]).then(function(status){deferred.resolve(status)})}).fail(function(e){log&&log("_writeCurrentVersion exception",JSON.stringify(storageInterface.buildErrResult(e),null,2)),deferred.reject(storageInterface.buildErrResult("writeCurrentVersion",e))}),deferred.promise()},getTables:function(){return{}},_executeSql:function(sql,params){var deferred=$.Deferred(),self=this;try{self.db.transaction(function(tx){try{log&&log("SQL: "+sql),log&&log(params),tx.executeSql(sql,params,function(tx,result){deferred.resolve(result)},function(tx,error){deferred.reject(storageInterface.buildErrResult("DB error initializing database: "+self.sqlErrorToMessage(error,sql,params)))})}catch(e){deferred.reject(storageInterface.buildErrResult("error running SQL statement",e))}},function(error){deferred.reject(storageInterface.buildErrResult("DB transaction error: "+self.sqlErrorToMessage(error,sql,params)+". Try to reload the page"))})}catch(e){deferred.reject(storageInterface.buildErrResult("error running SQL statement",e))}return deferred.promise()},_readCurrentVersion:function(){var deferred=$.Deferred(),self=this;return self._executeSql("SELECT version FROM version",null).then(function(result){try{var len=result.rows.length;if(len===1){var version=result.rows.item(0).version;log&&log("Read version: "+version),deferred.resolve(+version)}deferred.resolve(-1)}catch(e){deferred.reject(storageInterface.buildErrResult("error reading database version",e))}}).fail(function(e1){log&&log("Creating version table"),self._executeSql("CREATE TABLE version (version TEXT)").then(function(status){deferred.resolve(-1)}).fail(function(e2){log&&log("Error creating version table",JSON.stringify(storageInterface.buildErrResult(e2),null,2)),deferred.reject(storageInterface.buildErrResult("error reading database version",e1))})}),deferred.promise()},_createTables:function(){var deferred=$.Deferred(),self=this,p=[],errors=[],nbExec=0,tables=this.getTables();for(var name in tables)nbExec+=tables[name].length;for(var name in tables)tables[name].forEach(function(descr){self._executeSql(descr).then(function(){nbExec--,nbExec===0&&(errors.length>0?deferred.reject(storageInterface.buildErrResult("Error creating database tables",errors.join("\n"))):deferred.resolve(storageInterface.StatusCodes.OK))},function(status){nbExec--,errors.push(status.$message),nbExec===0&&deferred.reject(storageInterface.buildErrResult("Error creating database tables",errors.join("\n")))})});return deferred.promise()},sqlErrorToMessage:function(error,sql,params){if(log){var e={};for(var p in error){if(typeof error[p]=="function")continue;if(error[p]=="object"&&(!Array.isArray(error[p])||!$.isPlainObject(error[p])))continue;e[p]=error[p]}log&&log("ERROR REQUEST:",sql),log&&log("ERROR PARAMS:",params),log&&log(JSON.stringify(e,null,2))}return"CODE: "+error.code+" MESSAGE: "+error.message},clearDatabaseSupported:function(){return!1}})}),define("syracuse-tablet/html/js/storage/storageWebSQLSData",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/storage/storageWebSQLBase","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=require("syracuse-tablet/html/js/storage/storageWebSQLBase").Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("webSQL",!1),_tables={sdata_meta:["DROP TABLE IF EXISTS sdata_meta","CREATE TABLE sdata_meta ( key text, collection text, endpoint text, context text, id text, etag text, last_read text, last_updated text)","DROP INDEX IF EXISTS sdata_meta_pk","CREATE UNIQUE INDEX sdata_meta_pk ON sdata_meta (key, collection, endpoint, context)","DROP INDEX IF EXISTS sdata_meta_id","CREATE UNIQUE INDEX sdata_meta_id ON sdata_meta (id)"],sdata_objects:["DROP TABLE IF EXISTS sdata_objects","CREATE TABLE sdata_objects ( id text, data text )","DROP INDEX IF EXISTS sdata_objects_pk","CREATE UNIQUE INDEX sdata_objects_pk ON sdata_objects (id)"]};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getTables:function(){var res=Base.prototype.getTables.call(this);return $.extend(res,_tables),res},put:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("PUT: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[opts.$key,opts.$collection,opts.$endpoint,context],insertData=function(metaData){self._executeSql("INSERT INTO sdata_objects (data, id) values (?, ?)",[JSON.stringify(opts.$data),metaData.$id]).then(function(){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,opts.$data))}).fail(function(status){deferred.reject(status)})},updateData=function(metaData){self._executeSql("UPDATE sdata_objects set data = ? where id = ?",[JSON.stringify(opts.$data),metaData.$id]).then(function(result){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,opts.$data))}).fail(function(status){deferred.reject(status)})};self._readMetaData(context,params).then(function(metaData){opts.$data&&opts.$data.$etag&&metaData&&metaData.$etag===opts.$data&&opts.$data.$etag?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,opts.$data)):metaData?(metaData.$etag=opts.$data.$etag,metaData.$lastUpdated=utils.getCurISODateTime(),self._writeMetaData(metaData).then(function(){updateData(metaData)}).fail(function(status){deferred.reject(status)})):(metaData={$key:opts.$key,$collection:opts.$collection,$endpoint:opts.$endpoint,$context:opts.$context,$etag:opts.$data.$etag,$lastUpdated:utils.getCurISODateTime()},self._writeMetaData(metaData).then(function(metaData){insertData(metaData)}).fail(function(status){deferred.reject(status)}))}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error writing to database",e))}finally{return deferred.promise()}},read:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("READ: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[opts.$key,opts.$collection,opts.$endpoint,context];self._readMetaData(context,params).then(function(metaData){metaData?self._executeSql("SELECT * FROM sdata_objects where id = ?",[metaData.$id]).then(function(result){try{result.rows.length<=0?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND)):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,JSON.parse(result.rows.item(0).data),null,null,{$lastRead:metaData.$lastRead,$lastUpdated:metaData.$lastUpdated}))}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}}).fail(function(status){deferred.reject(status)}):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND))}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},query:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("QUERY: ",JSON.stringify(opts));if(!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[opts.$collection,opts.$endpoint,context];self._executeSql("SELECT o.*, m.last_read, m.last_updated FROM sdata_objects o INNER JOIN sdata_meta m ON (o.id = m.id and m.collection = ? and m.endpoint = ? and m.context = ?)",params).then(function(result){var ret=[],meta=[];try{for(var i=0;i<result.rows.length;i++){var item=result.rows.item(i);ret.push(JSON.parse(item.data)),meta.push({$lastRead:item.last_read,$lastUpdated:item.last_updated})}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e));return}deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,ret,null,null,meta))}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},remove:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("REMOVE: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[opts.$key,opts.$collection,opts.$endpoint,context];self._removeMetaData(context,params).then(function(metaData){metaData?self._executeSql("DELETE FROM sdata_objects where id = ?",[metaData.$id]).then(function(){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK))}).fail(function(status){deferred.reject(status)}):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND))}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error writing to database",e))}finally{return deferred.promise()}},clearCollection:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("CLEAR: ",JSON.stringify(opts));if(!opts.$collection||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[context];self._executeSql("SELECT * FROM sdata_meta").then(function(result){var ret=[];try{for(var i=0;i<result.rows.length;i++){var item=result.rows.item(i);opts.$collection.test(item.collection)&&(!opts.$not_read_since||item.last_read<opts.$not_read_since)&&ret.push({$context:opts.$context,$collection:item.collection,$endpoint:item.endpoint,$key:item.key})}$.smForEachPromise(ret,function(item){return self.remove(item)}).then(function(){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK))}).fail(function(e){deferred.reject(e)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},computeCollectionSize:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("CHECK SIZE: ",JSON.stringify(opts));if(!opts.$collection||!opts.$context)throw new Error("Insufficient parameters");var context=JSON.stringify(opts.$context),params=[context];self._executeSql("SELECT m.collection, m.endpoint, m.key, m.last_read, d.data FROM sdata_meta m INNER JOIN sdata_objects d ON (d.id = m.id) where m.context = ? ",params).then(function(result){var returnData={numRecords:0,sizeRecords:0},ret=[];try{for(var i=0;i<result.rows.length;i++){var item=result.rows.item(i);opts.$collection.test(item.collection)&&(!opts.$not_read_since||item.last_read<opts.$not_read_since)&&(returnData.numRecords++,returnData.sizeRecords+=item.data.length)}deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,returnData))}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},_readMetaData:function(context,params,noUpdate){var deferred=$.Deferred(),self=this;try{var db=self.db;self._executeSql("SELECT * FROM sdata_meta where key = ? and collection = ? and endpoint = ? and context = ?",params).then(function(result){try{if(result.rows.length<=0)deferred.resolve(null);else{var item=result.rows.item(0),metaData={$key:item.key,$collection:item.collection,$endpoint:item.endpoint,$context:item.context,$id:item.id,$etag:item.etag,$lastRead:item.last_read,$lastUpdated:item.last_updated};log&&log("Read meta data: "+JSON.stringify(metaData)),noUpdate===!0?deferred.resolve(metaData):self._writeMetaData(metaData).then(function(){deferred.resolve(metaData)}).fail(function(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))})}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},_conflictMetaLock:function(metaId){var locked=!1;return this._lockedMeta?locked=this._lockedMeta.indexOf(metaId)>=0:this._lockedMeta=[],locked===!1&&this._lockedMeta.push(metaId),locked===!1},_conflictMetaWait:function(metaId,deferred,metaData){log&&log("!!CONFLICT WAIT",metaId),this._pendingMeta||(this._pendingMeta={});var stack=this._pendingMeta[metaId];stack||(stack=this._pendingMeta[metaId]=[]),stack.push({deferred:deferred,metaData:metaData})},_conflictMetaUnlock:function(metaId){var idx=this._lockedMeta.indexOf(metaId);idx>=0&&this._lockedMeta.splice(idx,1);var stack=this._pendingMeta?this._pendingMeta[metaId]:null;if(!stack)return;var data=stack.pop();stack.length===0&&delete this._pendingMeta[metaId];if(!data)return;log&&log("!!CONFLICT RETRY",metaId),this._writeMetaData(data.metaData).then(function(metaData){data.deferred.resolve(metaData)}).fail(function(status){data.deferred.reject(status)})},_writeMetaData:function(metaData){var deferred=$.Deferred(),self=this;try{var db=self.db;metaData.$lastRead=utils.getCurISODateTime();if(!metaData.$id){metaData.$id=utils.UUID();var metaId=[metaData.$key,metaData.$collection,metaData.$endpoint,JSON.stringify(metaData.$context)].join("-");self._conflictMetaLock(metaId)?self._executeSql("INSERT INTO sdata_meta (key, collection, endpoint, context, id, etag, last_read, last_updated) values (?, ?, ?, ?, ?, ?, ?, ?)",[metaData.$key,metaData.$collection,metaData.$endpoint,JSON.stringify(metaData.$context),metaData.$id,metaData.$etag,metaData.$lastRead,metaData.$lastUpdated]).then(function(){self._conflictMetaUnlock(metaId),deferred.resolve(metaData)}).fail(function(status){self._conflictMetaUnlock(metaId),deferred.reject(status)}):self._conflictMetaWait(metaId,deferred,metaData)}else self._executeSql("UPDATE sdata_meta set etag = ?, last_read = ?, last_updated = ? where id = ?",[metaData.$etag,metaData.$lastRead,metaData.$lastUpdated,metaData.$id]).then(function(result){deferred.resolve(metaData)}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error writing meta data",e))}finally{return deferred.promise()}},_removeMetaData:function(context,params){var deferred=$.Deferred(),self=this;try{self._readMetaData(context,params,!0).then(function(metaData){metaData?self._executeSql("DELETE FROM sdata_meta where id = ?",[metaData.$id]).then(function(){deferred.resolve(metaData)}).fail(function(status){deferred.reject(status)}):deferred.resolve(null)}).fail(function(status){deferred.reject(status)})}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}}})}),define("syracuse-tablet/html/js/storage/storageWebSQLDrafts",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/storage/storageWebSQLSData","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=require("syracuse-tablet/html/js/storage/storageWebSQLSData").Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("drafts",!1),_DRAFT_INSERT="INSERT INTO sdata_drafts (id, endpoint, representation, comment, status, errorMsg, dataSet, draftUrl, title, creation_date) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",_DRAFT_DELETE_ALL="DELETE FROM sdata_drafts",_DRAFT_DELETE="DELETE FROM sdata_drafts where id = ?",_DRAFT_READ="SELECT * FROM sdata_drafts where id = ?",_DRAFT_READ_LIST="SELECT id, endpoint, representation, comment, status, errorMsg, draftUrl, title, creation_date FROM sdata_drafts",_DRAFT_COUNT="SELECT COUNT(*) AS counter FROM sdata_drafts",_tables={sdata_drafts:["DROP TABLE IF EXISTS sdata_drafts","CREATE TABLE sdata_drafts ( id text, endpoint text, representation text, comment text, status text, errorMsg text, dataSet text, draftUrl text, title text, creation_date text)","DROP INDEX IF EXISTS sdata_drafts_id","CREATE UNIQUE INDEX sdata_drafts_id ON sdata_drafts (id)"]},_logError=function(title,status){log&&log(title+" ERROR"),log&&log(storageInterface.resultToString(status))};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getTables:function(){var res=Base.prototype.getTables.call(this);return $.extend(res,_tables),res},_draftReadInfo:function(item){if(!item)return null;try{return{id:item.id,endpoint:item.endpoint||"",representation:item.representation||"",comment:item.comment||"",status:item.status||"none",errorMsg:item.errorMsg||"",dataSet:item.dataSet?JSON.parse(item.dataSet):null,draftUrl:item.draftUrl||"",title:item.title||"",creation_date:item.creation_date}}catch(e){return log&&log("_draftReadInfo","KO",item.id),null}},_draftReadList:function(){var self=this;return self._executeSql(_DRAFT_READ_LIST).then(function(result){if(!result||!result.rows||result.rows.length==0)return[];var resources=[],rec;for(var i=0;i<result.rows.length;i++)rec=self._draftReadInfo(result.rows.item(i)),rec&&resources.push(rec);return log&&log("_draftReadList","OK"),resources}).fail(function(status){return _logError("_draftReadList",status),[]})},_draftRead:function(id){var self=this;return self._executeSql(_DRAFT_READ,[id]).then(function(result){return!result||!result.rows||result.rows.length==0?null:(log&&log("_draftRead",id,"OK"),self._draftReadInfo(result.rows.item(0)))}).fail(function(status){return _logError("_draftRead",status),null})},_draftDelete:function(id){var self=this;return self._executeSql(_DRAFT_DELETE,[id]).then(function(result){return log&&log("_draftDelete",id,result?"OK":"KO"),!0}).fail(function(status){return _logError("_draftDelete",status),!1})},_draftDeleteAll:function(){var self=this;return self._executeSql(_DRAFT_DELETE_ALL).then(function(result){return log&&log("_draftDeleteAll OK"),!0}).fail(function(status){return _logError("_draftDeleteAll",status),!1})},_draftSave:function(ctx){var self=this,deferred=$.Deferred();return!ctx||!ctx.id?(log&&log("_draftSave error","Invalid parameters"),deferred.reject(new Error("Invalid parameters"))):self._draftDelete(ctx.id).then(function(){return self._executeSql(_DRAFT_INSERT,[ctx.id,ctx.endpoint,ctx.representation,ctx.comment,ctx.status,ctx.errorMsg,JSON.stringify(ctx.dataSet),ctx.draftUrl,ctx.title,ctx.creation_date])}).then(function(){log&&log("_draftSave",ctx.id,"OK"),deferred.resolve(ctx)}).fail(function(status){_logError("_draftSave",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_draftCount:function(){return this._executeSql(_DRAFT_COUNT).then(function(result){return result&&result.rows.length>0?result.rows.item(0).counter:0}).fail(function(status){return _logError("_draftCount",status),0})},draftOperation:function(op){switch(op){case"draftSave":return this._draftSave(arguments[1]);case"draftDelete":return this._draftDelete(arguments[1]);case"draftDeleteAll":return this._draftDeleteAll();case"draftRead":return this._draftRead(arguments[1]);case"draftReadList":return this._draftReadList();case"draftCount":return this._draftCount(!1);default:return $.smReject(storageInterface.buildErrResult("Unknown Draft operation["+op+"]"))}}})}),define("syracuse-tablet/html/js/storage/storageWebSQLTemplates",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/storage/storageWebSQLDrafts","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=require("syracuse-tablet/html/js/storage/storageWebSQLDrafts").Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("templates",!1),_TMPL_INSERT="INSERT INTO sdata_templates (id, endpoint, representation, title, dataSet, creation_date) values (?, ?, ?, ?, ?, ?)",_TMPL_DELETE_ALL="DELETE FROM sdata_templates",_TMPL_DELETE="DELETE FROM sdata_templates where id = ?",_TMPL_READ="SELECT * FROM sdata_templates where id = ?",_TMPL_QUERY="SELECT id, endpoint, representation, title, creation_date FROM sdata_templates",_TMPL_COUNT="SELECT COUNT(*) AS counter FROM sdata_templates",_tables={sdata_templates:["DROP TABLE IF EXISTS sdata_templates","CREATE TABLE sdata_templates ( id text, endpoint text, representation text, title text, dataSet text, creation_date text)","DROP INDEX IF EXISTS sdata_templates","CREATE UNIQUE INDEX sdata_templates_id ON sdata_templates (id)"]},_logError=function(title,status){log&&log(title+" ERROR"),log&&log(storageInterface.resultToString(status))};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getTables:function(){var res=Base.prototype.getTables.call(this);return $.extend(res,_tables),res},_tmplReadInfo:function(item){if(!item)return null;try{return{id:item.id,endpoint:item.endpoint||"",representation:item.representation||"",title:item.title||"",dataSet:item.dataSet?JSON.parse(item.dataSet):null,creation_date:item.creation_date}}catch(e){return log&&log("_tmplReadInfo","KO",item.id),null}},_tmplQuery:function(representation,endpoint){var self=this,deferred=$.Deferred(),req=_TMPL_QUERY,params=[];if(representation||endpoint)req+=" where ",representation&&(req+="representation = ?",params.push(representation),endpoint&&(req+=" and ")),endpoint&&(req+="endpoint = ?",params.push(endpoint));return self._executeSql(req,params).then(function(result){log&&log("_tmplQuery","OK");if(!result||!result.rows||result.rows.length==0)return deferred.resolve([]);var resources=[],rec;for(var i=0;i<result.rows.length;i++)rec=self._tmplReadInfo(result.rows.item(i)),rec&&resources.push(rec);deferred.resolve(resources)}).fail(function(status){_logError("_tmplQuery",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_tmplRead:function(id){var self=this,deferred=$.Deferred();return self._executeSql(_TMPL_READ,[id]).then(function(result){log&&log("_tmplRead",id,"OK");if(!result||!result.rows||result.rows.length==0)return deferred.resolve(null);deferred.resolve(self._tmplReadInfo(result.rows.item(0)))}).fail(function(status){_logError("_tmplRead",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_tmplUpdate:function(id,ctx){var self=this;return self._tmplRead(id).then(function(result){if(!result||!ctx)return;return self._tmplSave($.extend(result,ctx),!1)})},_tmplDelete:function(id){var self=this,deferred=$.Deferred();return self._executeSql(_TMPL_DELETE,[id]).then(function(result){log&&log("_tmplDelete",id,result?"OK":"KO"),deferred.resolve()}).fail(function(status){_logError("_tmplDelete",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_tmplDeleteAll:function(){var self=this,deferred=$.Deferred();return self._executeSql(_TMPL_DELETE_ALL).then(function(result){log&&log("_tmplDeleteAll OK"),deferred.resolve()}).fail(function(status){_logError("_tmplDeleteAll",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_tmplSave:function(ctx,updateDate){var self=this,deferred=$.Deferred();return!ctx||!ctx.id?(log&&log("_tmplSave error","Invalid parameters"),deferred.reject(new Error("Invalid parameters"))):self._tmplDelete(ctx.id).then(function(){if(ctx["creation_date"]==null||updateDate)ctx.creation_date=utils.getCurISODateTime(new Date);return self._executeSql(_TMPL_INSERT,[ctx.id,ctx.endpoint,ctx.representation,ctx.title,JSON.stringify(ctx.dataSet),ctx.creation_date])}).then(function(){log&&log("_tmplSave",ctx.id,"OK"),deferred.resolve(ctx)}).fail(function(status){_logError("_tmplSave",status),deferred.reject(status.$exception||new Error(status.message))}),deferred.promise()},_tmplCount:function(){return this._executeSql(_TMPL_COUNT,[]).then(function(result){return result&&result.rows.length>0?result.rows.item(0).counter:0}).fail(function(status){return _logError("_tmplCount",status),0})},templateOperation:function(op){switch(op){case"save":return this._tmplSave(arguments[1],!0);case"delete":return this._tmplDelete(arguments[1]);case"deleteAll":return this._tmplDeleteAll();case"read":return this._tmplRead(arguments[1]);case"update":return this._tmplUpdate(arguments[1],arguments[2]);case"query":return this._tmplQuery(arguments[1],arguments[2],arguments[3]);case"readall":return this._tmplQuery(arguments[1]);case"count":return this._tmplCount();default:return $.smReject(storageInterface.buildErrResult("Unknown template operation["+op+"]"))}}})}),define("syracuse-tablet/html/js/storage/storageWebSQL",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/storage/storageWebSQLTemplates"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("webSQL",!1),environment=require("syracuse-tablet/html/js/helpers/environment"),_storageInterface=require("syracuse-tablet/html/js/storage/storageWebSQLTemplates").Klass;exports.getStorageInterface=function(){return _storageInterface},exports.isAvailable=function(){return environment.checkBrowserName("chrome")&&environment.isOs("ios")||environment.checkBrowserName("safari")&&environment.isOs("osx")?(log&&log("chrome on ios - force indexedDB"),null):window.openDatabase!=null}}),define("syracuse-tablet/html/js/storage/storageIndexedDBBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=storageInterface.Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("indexedDB",!0),_databaseVersion=25,_indexedDB=window.indexedDB||window.webkitIndexedDB,_logError=function(title,status){log&&log(title+" ERROR");if(!status)return;var request=status.target||status.currentTarget||status.originalTarget;if(request&&request.error&&request.error.message){log&&log((request.error.name?"["+request.error.name+"]":"")+request.error.message);return}log&&log(storageInterface.resultToString(status))};exports.Klass=utils.defineClass(function(){Base.call(this,"IndexedDB storage interface",_databaseVersion)},Base,{init:function(requester){var self=this;requester=requester||"",log&&log("_INIT "+requester);var deferred=$.Deferred(),step=jsutils.isTestEnvironment()?self._initTestDB():$.smResolve();return step.then(function(){return self.db?(log&&log("DATABASE ALREADY INITIALIZED!"),storageInterface.buildResult(storageInterface.StatusCodes.OK)):(log&&log("DATABASE INIT!"),self._openDB())}).then(function(status){log&&log("_openDB OK "+requester),deferred.resolve(status)}).fail(function(e){_logError("_openDB KO "+requester);var msg=locale.text("db.err.init"),err=self._eventToMessage(e);err&&err.toLowerCase().indexOf("versionerrror")>=0&&(msg+="\n"+locale.text("db.err.version")),deferred.reject(self._eventToDiagnose(msg,e))}),deferred.promise()},_initTestDB:function(requester){var self=this,deferred=$.Deferred();return $.smResolve().then(function(){self.db&&(self.db.close(),self.db=null),self.useTestDatabase=!0,self.databaseName=storageInterface.databaseName+"-test",log&&log("DATABASE IN TEST MODE! "+requester);var req=_indexedDB.deleteDatabase(self.databaseName);req.onsuccess=function(){deferred.resolve()},req.onerror=function(e){_logError("REQUEST ERROR! "+requester),deferred.reject(e)},req.onblocked=function(e){_logError("REQUEST BLOCKED! "+requester),deferred.reject(e)}}).fail(function(e){_logError("_initTestDB KO "+requester),deferred.reject(e)}),deferred.promise()},_openDB:function(){var deferred=$.Deferred(),self=this;if(self.useTestDatabase===!1&&self.db)deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK));else{var request;try{log&&log("Open database, request version: "+self.databaseVersion),request=_indexedDB.open(self.databaseName,self.databaseVersion),request.onupgradeneeded=function(e){log&&log("Open database, need upgrade"),self.db=e.target.result||e.target.source,self._createObjectStore()},request.onblocked=function(e){_logError("Open database, blocked",e),deferred.reject(e)},request.onsuccess=function(e){log&&log("Open database, success");var db=e.target.result||e.target.source;if(!db.setVersion&&self.databaseVersion!=db.version){log&&log("Open database, versions missmatch: "+self.DatabaseVersion+" != "+db.version);var sdv=db.setVersion(self.databaseVersion);sdv.onsuccess=function(e){log&&log("Open database, setting version, success"),self.db=db,self._createObjectStore(),log&&log("Open database, opened"),deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK))},sdv.onerror=function(e){log&&log("Open database, setting version, error",e),self.db=null,deferred.reject(e)}}else log&&log("Open database, opened"),self.db=db,deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK))},request.onerror=function(e){_logError("Open database, error",e),self.db=null,deferred.reject(e)}}catch(ex){_logError("Open database, exception",ex),self.db=null,deferred.reject(ex)}}return deferred.promise()},getObjectStores:function(){return{}},_createObjectStore:function(){var self=this,db=self.db;log&&log("Updating database");try{var objectStores=this.getObjectStores();Object.keys(objectStores).forEach(function(name){var os=objectStores[name];db.objectStoreNames.contains(name)&&(log&&log("Deleting objectStore: "+name),db.deleteObjectStore(name)),log&&log("Creating objectStore: "+name);var obj=db.createObjectStore(name,os.options);Object.keys(os.indexes).forEach(function(iname){var idx=os.indexes[iname];log&&log("Creating index: "+iname),obj.createIndex(iname,idx.key,idx.options)})})}catch(e){throw _logError("_createObjectStore, error",e),e}},_eventToMessage:function(event){var request=event.target||event.currentTarget||event.originalTarget;return request&&request.error&&request.error.message?(request.error.name?"["+request.error.name+"]":"")+request.error.message:JSON.stringify(event)},_eventToDiagnose:function(msg,e){if(jsutils.isError(e)||jsutils.isDOMException(e)){var diags=jsutils.convertToDiagnoses(e);return diags.$diagnoses[0].$message=msg+"\n"+diags.$diagnoses[0].$message,diags}var request=e.target||e.currentTarget||e.originalTarget,stack;return request&&request.error&&request.error.message?stack=(request.error.name?"["+request.error.name+"]":"")+request.error.message:stack=JSON.stringify(e,null,2),{$diagnoses:[{$severity:"error",$message:msg,$stackTrace:stack}]}},clearDatabaseSupported:function(){return!0},clearDatabase:function(){var self=this,deferred=$.Deferred();return $.smResolve().then(function(){var req=window.indexedDB.deleteDatabase(self.databaseName);req.onsuccess=function(){deferred.resolve(!0)},req.onerror=function(e){deferred.resolve(!1),console.log("Database deletion failed"),console.log(e)}}).fail(function(){deferred.resolve(!1)}),deferred.promise()}})}),define("syracuse-tablet/html/js/storage/storageIndexedDBSData",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/storage/storageIndexedDBBase","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/storage/storageIndexedDBBase").Klass,storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("sData",!1),IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException,READ_ONLY=IDBTransaction&&IDBTransaction.READ_ONLY||"readonly",READ_WRITE=IDBTransaction&&IDBTransaction.READ_WRITE||"readwrite",_objectStores={sdata:{options:{autoIncrement:!0},indexes:{read_write_one:{key:"key_collection_endpoint_context",options:{unique:!0}},read_write_all:{key:"collection_endpoint_context",options:{unique:!1}},read_write_ctx:{key:"context",options:{unique:!1}}}}};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getObjectStores:function(){var res=Base.prototype.getObjectStores.call(this);return $.extend(res,_objectStores),res},put:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("PUT: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=[opts.$key,opts.$collection,opts.$endpoint,context].join("_"),index=objectStore.index("read_write_one"),keyRange=IDBKeyRange.only(key),request=index.openCursor(keyRange),mustInsert=!0,datetime=utils.getCurISODateTime(),doInsert=function(){var obj={context:context,collection:opts.$collection,endpoint:opts.$endpoint,key:opts.$key,last_updated:datetime,last_read:datetime,key_collection_endpoint_context:key,collection_endpoint_context:[opts.$collection,opts.$endpoint,context].join("_"),data:opts.$data},reqt=objectStore.add(obj);reqt.onerror=function(event){deferred.reject(storageInterface.buildErrResult("error writing to database: "+self._eventToMessage(event)))},reqt.onsuccess=function(event){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,opts.$data))}};request.onsuccess=function(event){try{var cr=event.target.result;if(cr&&cr.value&&cr.value.data){if(opts.$data.$etag){var etag=cr.value&&cr.value.data.$etag;if(etag===opts.$data.$etag){deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,opts.$data));return}}cr["delete"](),cr["continue"]()}else doInsert()}catch(e){deferred.reject(storageInterface.buildErrResult("error writing to database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?doInsert():deferred.reject(storageInterface.buildErrResult("error writing to database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error writing to database",e))}finally{return deferred.promise()}},read:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("READ: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=[opts.$key,opts.$collection,opts.$endpoint,context].join("_"),index=objectStore.index("read_write_one"),keyRange=IDBKeyRange.only(key),request=index.openCursor(keyRange);request.onsuccess=function(event){try{var cr=event.target&&event.target.result&&event.target.result.value;cr?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,cr.data,null,null,{$lastRead:cr.last_read,$lastUpdated:cr.last_updated})):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND))}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND)):deferred.reject(storageInterface.buildErrResult("error reading from database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},query:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("QUERY: ",JSON.stringify(opts));if(!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=[opts.$collection,opts.$endpoint,context].join("_"),index=objectStore.index("read_write_all"),keyRange=IDBKeyRange.only(key),request=index.openCursor(keyRange),results=[],meta=[];request.onsuccess=function(event){try{var cr=event.target.result;if(cr){var data=cr.value.data;results.push(data),meta.push({$lastRead:cr.value.last_read,$lastUpdated:cr.value.last_updated}),cr["continue"]()}else deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,results,null,null,meta))}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,results,null,null,meta)):deferred.reject(storageInterface.buildErrResult("error reading from database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},remove:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("REMOVE: ",JSON.stringify(opts));if(!opts.$key||!opts.$collection||!opts.$endpoint||!opts.$context)throw new Error("Insufficient parameters");var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=[opts.$key,opts.$collection,opts.$endpoint,context].join("_"),index=objectStore.index("read_write_one"),keyRange=IDBKeyRange.only(key),request=index.openCursor(keyRange);request.onsuccess=function(event){try{var cr=event.target.result;cr?(cr["delete"](),deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK))):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND))}catch(e){deferred.reject(storageInterface.buildErrResult("error deleting from database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.NOT_FOUND)):deferred.reject(storageInterface.buildErrResult("error reading from database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error deleting from database",e))}finally{return deferred.promise()}},clearCollection:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("CLEAR: ",JSON.stringify(opts));var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=context,request=objectStore.openCursor(),records=[],deleteMatches=function(){$.smForEachPromise(records,function(rec){return self.remove({$context:opts.$context,$collection:rec.collection,$endpoint:rec.endpoint,$key:rec.key})}).then(function(){deferred.resolve()}).fail(function(e){deferred.reject(e)})};request.onsuccess=function(event){try{var cr=event.target.result;cr?(opts.$collection.test(cr.value.collection)&&(!opts.$not_read_since||cr.value.last_read<opts.$not_read_since)&&records.push(cr.value),cr["continue"]()):deleteMatches()}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?deleteMatches():deferred.reject(storageInterface.buildErrResult("error reading from database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}},computeCollectionSize:function(opts){var deferred=$.Deferred(),self=this;try{var db=self.db;log&&log("SIZE: ",JSON.stringify(opts));var tx=db.transaction(["sdata"],READ_WRITE),objectStore=tx.objectStore("sdata"),context=JSON.stringify(opts.$context),key=context,request=objectStore.openCursor(),returnData={numRecords:0,sizeRecords:0};request.onsuccess=function(event){try{var cr=event.target.result;cr?(opts.$collection.test(cr.value.collection)&&(!opts.$not_read_since||cr.value.last_read<opts.$not_read_since&&cr.value.context===key)&&(returnData.numRecords++,returnData.sizeRecords+=JSON.stringify(cr.value).length),cr["continue"]()):deferred.resolve(storageInterface.buildResult(storageInterface.StatusCodes.OK,returnData))}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}},request.onerror=function(event){IDBDatabaseException&&event.target.errorCode==IDBDatabaseException.NOT_FOUND_ERR?deferred.resolve():deferred.reject(storageInterface.buildErrResult("error reading from database: "+self._eventToMessage(event)))}}catch(e){deferred.reject(storageInterface.buildErrResult("error reading from database",e))}finally{return deferred.promise()}}})}),define("syracuse-tablet/html/js/storage/storageIndexedDBDrafts",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/storage/storageIndexedDBSData","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),Base=require("syracuse-tablet/html/js/storage/storageIndexedDBSData").Klass,storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("drafts",!0),IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException,READ_ONLY=IDBTransaction&&IDBTransaction.READ_ONLY||"readonly",READ_WRITE=IDBTransaction&&IDBTransaction.READ_WRITE||"readwrite",_objectStores={drafts:{options:{keyPath:"id",autoIncrement:!0},indexes:{}}},_logError=function(who,e){if(!log)return;log("INDEXED DB - ERROR");for(var i=0;i<arguments.length;i++){var e=arguments[i];if(typeof e=="string"){log(e);continue}if(e&&e.target&&IDBDatabaseException&&e.target.errorCode!=IDBDatabaseException.NOT_FOUND_ERR){log(JSON.stringify(e,null,2));continue}log(JSON.stringify(jsutils.convertToDiagnoses(e),null,2))}};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getObjectStores:function(){var res=Base.prototype.getObjectStores.call(this);return $.extend(res,_objectStores),res},_draftsObjectStore:function(readOpt){var tx=this.db.transaction(["drafts"],readOpt||READ_WRITE);return tx.oncomplete=function(event){log&&log("tx.oncomplete",JSON.stringify(event,null,2))},tx.onerror=function(event){log&&log("tx.onerror",JSON.stringify(event,null,2))},tx.objectStore("drafts")},_draftReadList:function(){var deferred=$.Deferred();try{var request=this._draftsObjectStore(READ_ONLY).openCursor(),result=[];request.onsuccess=function(event){var cursor=event.target.result;if(cursor){try{var data=cursor.value&&cursor.value.data?JSON.parse(cursor.value.data):null;data&&result.push(data)}catch(e){log&&log("_draftReadList","Error parsing data",e)}cursor.continue()}else log&&log("_draftReadList","OK"),deferred.resolve(result)},request.onerror=function(event){_logError("_draftReadList",event),deferred.resolve([])}}catch(e){log&&log("ERROR - _draftReadList",e),deferred.resolve([])}return deferred.promise()},_draftRead:function(id){var deferred=$.Deferred();try{var objectStore=this._draftsObjectStore(READ_ONLY),request=objectStore.get(id);request.onsuccess=function(event){try{var result=request.result&&request.result.data?JSON.parse(request.result.data):null;deferred.resolve(result),log&&log("_draftRead","OK")}catch(e){log&&log("_draftRead","Error parsing data",e),deferred.resolve(null)}},request.onerror=function(event){_logError("_draftRead",event),deferred.resolve(null)}}catch(e){log&&log("_draftRead",e),deferred.resolve(null)}return deferred.promise()},_draftDelete:function(id){var deferred=$.Deferred();try{var objectStore=this._draftsObjectStore(READ_WRITE),request=objectStore["delete"](id);request.onsuccess=function(event){log&&log("_draftDelete","OK"),deferred.resolve(!0)},request.onerror=function(event){_logError("_draftDelete",event),deferred.resolve(!1)}}catch(e){log&&log("_draftDelete",e),deferred.resolve(!1)}return deferred.promise()},_draftDeleteAll:function(){var deferred=$.Deferred();try{var objectStore=this._draftsObjectStore(READ_WRITE),request=objectStore.clear();request.onsuccess=function(event){log&&log("_draftDeleteAll","OK"),deferred.resolve(!0)},request.onerror=function(event){_logError("_draftDeleteAll",event),deferred.resolve(!1)}}catch(e){log&&log("_draftDeleteAll",e),deferred.resolve(!1)}return deferred.promise()},_draftSave:function(ctx){if(!ctx)return $.smResolve(null);var deferred=$.Deferred();try{var objectStore=this._draftsObjectStore(READ_WRITE),_put=function(created){var request=objectStore.put({id:ctx.id,data:JSON.stringify(ctx),creation_date:utils.getCurISODateTime(new Date)});request.onsuccess=function(event){log&&log("_draftSave","OK"),deferred.resolve(ctx,created)},request.onerror=function(event){_logError("_draftSave",event),deferred.resolve(null)}},request=objectStore.get(ctx.id);request.onsuccess=function(event){_put(!0)},request.onerror=function(event){_put(!1)}}catch(e){log&&log("ERROR _draftSave",e),deferred.resolve(null)}return deferred.promise()},_draftCount:function(notify){var deferred=$.Deferred();try{var objectStore=this._draftsObjectStore(READ_ONLY),request=objectStore.count();request.onsuccess=function(event){log&&log("_draftCount","OK",request.result),deferred.resolve(request.result)},request.onerror=function(event){_logError("_draftCount",event),deferred.resolve(0)}}catch(e){log&&log("ERROR _draftCount",e),deferred.resolve(0)}return deferred.promise()},draftOperation:function(op){switch(op){case"draftSave":return this._draftSave(arguments[1]);case"draftDelete":return this._draftDelete(arguments[1]);case"draftDeleteAll":return this._draftDeleteAll();case"draftRead":return this._draftRead(arguments[1]);case"draftReadList":return this._draftReadList();case"draftCount":return this._draftCount(!1);default:return $.smReject(storageInterface.buildErrResult("Unknown Draft operation["+op+"]"))}}})}),define("syracuse-tablet/html/js/storage/storageIndexedDBTemplates",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/storage/storageIndexedDBDrafts","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),Base=require("syracuse-tablet/html/js/storage/storageIndexedDBDrafts").Klass,log=require("syracuse-tablet/html/js/helpers/logger").getLogger("templates",!1),IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException,READ_ONLY=IDBTransaction&&IDBTransaction.READ_ONLY||"readonly",READ_WRITE=IDBTransaction&&IDBTransaction.READ_WRITE||"readwrite",_objectStores={edittemplates:{options:{keyPath:"id",autoIncrement:!0},indexes:{repandep:{key:["representation","endpoint"],options:{unique:!1}}}}},_logError=function(who,e){if(!log)return;log("INDEXED DB - ERROR");for(var i=0;i<arguments.length;i++){var e=arguments[i];if(typeof e=="string"){log(e);continue}if(e&&e.target&&IDBDatabaseException&&e.target.errorCode!=IDBDatabaseException.NOT_FOUND_ERR){log(JSON.stringify(e,null,2));continue}log(JSON.stringify(jsutils.convertToDiagnoses(e),null,2))}};exports.Klass=utils.defineClass(function(){Base.call(this)},Base,{getObjectStores:function(){return $.extend(Base.prototype.getObjectStores.call(this),_objectStores)},_tmplOnError:function(deferred,event,fail,value,caller){_logError(caller,event),fail?deferred.reject({$diagnoses:[{$message:"IndexedDB Error - "+caller,$stackTrace:this._eventToMessage(event)}]}):deferred.resolve(value)},_tmplObjectStore:function(readOpt){var tx=this.db.transaction("edittemplates",readOpt||READ_WRITE);return tx.oncomplete=function(event){log&&log("tx.oncomplete",JSON.stringify(event,null,2))},tx.onerror=function(event){log&&log("tx.onerror",JSON.stringify(event,null,2))},tx.objectStore("edittemplates")},_tmplGetObject:function(id,fail){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),request=self._tmplObjectStore(READ_ONLY).get(id);return request.onsuccess=function(event){deferred.resolve(request.result)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,null,"_tmplGetObject")},deferred.promise()})},_tmplGetAllObjects:function(fail,filter){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),request=self._tmplObjectStore(READ_ONLY).openCursor(),result=[];return request.onsuccess=function(event){var cursor=event.target.result;cursor?(cursor.value&&(filter==null||filter(cursor.value)===!0)&&result.push(cursor.value),cursor.continue()):deferred.resolve(result)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,[],"_tmplGetAllObjects")},deferred.promise()})},_tmplPutObject:function(data,updateDate,fail){var self=this;return $.smResolve().then(function(){if(!data||!data.id)return fail?$.smReject({$diagnoses:[{$message:"_tmplPutObject - Invalid parameters"}]}):null;var deferred=$.Deferred(),id=data.id,objectStore=self._tmplObjectStore(READ_WRITE),_put=function(created){data=$.extend(!0,{},data);if(data["creation_date"]==null||updateDate)data.creation_date=utils.getCurISODateTime(new Date);var request=objectStore.put(data);request.onsuccess=function(event){deferred.resolve(data,created)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,null,"_tmplPutObject")}},request=objectStore.get(id);return request.onsuccess=function(event){_put(!0)},request.onerror=function(event){_put(!1)},deferred.promise()})},_tmplDeleteObject:function(id,fail){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),request=self._tmplObjectStore(READ_WRITE)["delete"](id);return request.onsuccess=function(event){deferred.resolve(!0)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,!1,"_tmplDeleteObject")},deferred.promise()})},_tmplDeleteAllObjects:function(id,fail){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),request=self._tmplObjectStore(READ_WRITE).clear();return request.onsuccess=function(event){deferred.resolve(!0)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,!1,"_tmplDeleteAllObjects")},deferred.promise()})},_tmplCountAllObjects:function(fail){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),request=self._tmplObjectStore(READ_ONLY).count();return request.onsuccess=function(event){deferred.resolve(request.result)},request.onerror=function(event){self._tmplOnError(deferred,event,fail,0,"_tmplCountAllObjects")},deferred.promise()})},_tmplReadInfo:function(data){if(!data)return null;try{return{id:data.id,endpoint:data.endpoint||"",representation:data.representation||"",title:data.title||"",dataSet:data.dataSet,creation_date:data.creation_date}}catch(e){return log&&log("_tmplReadInfo","KO",data.id),null}},_tmplQueryWidthCompoundIndex:function(representation,endpoint,fail){var self=this;return $.smResolve().then(function(){var deferred=$.Deferred(),objectStore=self._tmplObjectStore(READ_ONLY),request;if(representation||endpoint){var index=objectStore.index("repandep");request=index.openCursor(IDBKeyRange.only([representation,endpoint]))}else request=objectStore.openCursor();var result=[],data;return request.onsuccess=function(event){var cursor=event.target.result;cursor&&cursor.value?(result.push(cursor.value),cursor.continue()):(log&&log("_tmplQuery - OK"),deferred.resolve(result))},request.onerror=function(event){self._tmplOnError(deferred,event,fail,[],"_tmplGetAllObjects")},deferred.promise()})},_tmplQuery:function(representation,endpoint,fail){return this._tmplGetAllObjects(fail,function(value){return representation!=null&&representation!=value.representation?!1:endpoint!=null&&endpoint!=value.endpoint?!1:!0})},_tmplRead:function(id){return this._tmplGetObject(id,!1)},_tmplUpdate:function(id,ctx){var self=this;return self._tmplRead(id).then(function(result){if(!result||!ctx)return;return self._tmplSave($.extend(result,ctx),!1)})},_tmplDelete:function(id){return this._tmplDeleteObject(id,!1)},_tmplDeleteAll:function(){return this._tmplDeleteAllObjects(!1)},_tmplSave:function(ctx,updateDate){var self=this;return!ctx||!ctx.id?(log&&log("_tmplSave error","Invalid parameters"),$.smReject(new Error("Invalid parameters"))):self._tmplDelete(ctx.id).then(function(){return self._tmplPutObject(ctx,updateDate,!1)}).then(function(){return log&&log("_tmplSave",ctx.id,"OK"),ctx}).fail(function(status){return _logError("_tmplSave",status),$.smReject(status.$exception||new Error(status.message))})},_tmplCount:function(){return this._tmplCountAllObjects()},templateOperation:function(op){switch(op){case"save":return this._tmplSave(arguments[1],!0);case"delete":return this._tmplDelete(arguments[1]);case"deleteAll":return this._tmplDeleteAll(arguments[1],arguments[2]);case"read":return this._tmplRead(arguments[1]);case"update":return this._tmplUpdate(arguments[1],arguments[2]);case"query":return this._tmplQuery(arguments[1],arguments[2],arguments[3]);case"readall":return this._tmplQuery(arguments[1]);case"count":return this._tmplCount();default:return $.smReject(storageInterface.buildErrResult("Unknown template operation["+op+"]"))}}})}),define("syracuse-tablet/html/js/storage/storageIndexedDB",["require","exports","module","syracuse-tablet/html/js/storage/storageIndexedDBTemplates"],function(require,exports,module){var _storageInterface=require("syracuse-tablet/html/js/storage/storageIndexedDBTemplates").Klass;exports.getStorageInterface=function(){return _storageInterface},exports.isAvailable=function(){var indexedDB=window.indexedDB||window.webkitIndexedDB;return indexedDB!=null}}),define("syracuse-tablet/html/js/storage/storage",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/storage/storageInterface","syracuse-tablet/html/js/storage/storageWebSQL","syracuse-tablet/html/js/storage/storageIndexedDB"],function(require,exports,module){function _getStorageImpl(noFail){if(_storageImpl)return _storageImpl;_impls.some(function(impl){impl=_modules[impl];if(impl.isAvailable()){var ctor=impl.getStorageInterface();return _storageImpl=new ctor,!0}return!1});if(_storageImpl==null&&noFail!==!0)throw new Error("No storage interface (indexedDB or WebSQL) has been found");return _storageImpl}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("storage",!1),storageInterface=require("syracuse-tablet/html/js/storage/storageInterface"),_modules={webSQL:require("syracuse-tablet/html/js/storage/storageWebSQL"),indexedDB:require("syracuse-tablet/html/js/storage/storageIndexedDB")},_impls=["webSQL","indexedDB"],_storageImpl;exports.getStorage=_getStorageImpl,exports.StatusCodes=storageInterface.StatusCodes,exports.init=function(supportedDB){if(supportedDB==null)_getStorageImpl();else{log&&log("Force supported DB="+supportedDB);var impl=_modules[supportedDB];if(!impl||!impl.isAvailable())throw new Error("Storage interface ("+supportedDB+") is not supported");var ctor=impl.getStorageInterface();_storageImpl=new ctor}return log&&log("DATABASE="+_storageImpl.infoString),_storageImpl.init()}}),define("syracuse-tablet/html/js/sdata/cache/metaDataCache",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/storage/storage","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/storage/localStorage"],function(require,exports,module){function _alwaysUpdateApps(){return localStorage.getItem("alwaysUpdateChecked")==="true"}function _getStorage(){return _storage||(_storage=modules.get("storage").getStorage()),_storage}function _getMetaDataContext(){return modules.get("appController").App.getCacheContext()}function _getMetaData(metaType,endpoint,key){return _getStorage().read({$context:_getMetaDataContext(),$collection:"$meta_"+metaType,$endpoint:endpoint,$key:key}).then(function(result){return result.$status===storageModule.StatusCodes.OK?result.$data:null})}function _putMetaData(metaType,endpoint,key,data){return _getStorage().put({$context:_getMetaDataContext(),$collection:"$meta_"+metaType,$endpoint:endpoint,$key:key,$data:data})}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("metaData",!1),ajax=require("syracuse-tablet/html/js/common/ajax"),modules=require("syracuse-tablet/html/js/common/modules"),protocolHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),storageModule=require("syracuse-tablet/html/js/storage/storage"),waiting=require("syracuse-tablet/html/js/utils/waiting"),localStorage=require("syracuse-tablet/html/js/storage/localStorage"),_storage,_cachedAppVersions={};exports.clearCachedApps=function(){log&&log("clearCachedApps"),_cachedAppVersions={}},exports.tryGetApp=function(appName,endpoint){log&&log("Try get app: "+appName+" on "+endpoint);var name=endpoint+"."+appName,appInMemory=_cachedAppVersions[name];return appInMemory?(log&&log("In memory app: "+appName+" on "+endpoint),$.smResolve(appInMemory)):$.smResolve().then(function(){return _getMetaData("appHeader","$local",name)}).then(function(appData){return log&&log("App in cache: "+(appData!==null)),appData?(delete appData.$isUpToDate,_cachedAppVersions[name]=appData):delete _cachedAppVersions[name],appData})},exports.isAppUpToDate=function(appData,endpoint){log&&log("isAppUpToDate: "+appData.versionNumber);var url=protocolHelpers.getMobileAppUrl(appData.applicationName),appDataRemote,name=endpoint+"."+appData.applicationName,appInMemory=_cachedAppVersions[name]=_cachedAppVersions[name]||appData;if(appInMemory.$isUpToDate)return $.smResolve(!0);var d=$.Deferred();return log&&log("Check app up to date: "+appData.applicationName),ajax.request(url).fail(function(result){result.offline?(log&&log("Offline, assume up to date"),d.resolve(!0)):d.reject(result)}).then(function(result){appDataRemote=result.data}).then(function(){log&&log("Local version: "+appData.versionNumber),log&&log("Remote version: "+appDataRemote.versionNumber),appDataRemote.versionNumber===appData.versionNumber?(appInMemory=_cachedAppVersions[name]=appDataRemote,appInMemory.$isUpToDate=!0,_alwaysUpdateApps()?(log&&log("Update forced by development flag"),d.resolve(!1)):d.resolve(!0)):(appInMemory.$isUpToDate=!1,d.resolve(!1))}),d.promise()},exports.installApp=function(appName,endpoint){var url=protocolHelpers.getMobileAppUrl(appName),appMetaDataUrl=url+"/$service/applicationMetaData?endpoint="+endpoint,appData;log&&log("Installing app: "+appName);var install=$.smResolve().then(function(){return log&&log("Fetching meta data: "+appName),ajax.request(appMetaDataUrl)}).then(function(result){return appData=result.data,log&&log("Saving header: "+appName+" on "+endpoint+" Mode: "+(appData.$application.onlineOnly?"workingcopy":"stateless")),_putMetaData("appHeader","$local",endpoint+"."+appName,appData.$application)}).then(function(){var $pages=appData.$pages||{};return $.smForEachPromise(Object.keys($pages),function(page){var $page=$pages[page].$page,article=$page.$article,views=$page.$views,prototype=$page.$prototype;return $.smResolve().then(function(){if(article)return log&&log("Saving page: "+page),_putMetaData("page","$local",page,{$article:article,$views:views})}).then(function(){if(prototype)return delete prototype.$article,log&&log("Saving prototype: "+page),_putMetaData("prototype","$local",page,prototype)})})}).then(function(){var $dashboards=appData.$dashboards||{};return $.smForEachPromise(Object.keys($dashboards),function(dashboard){var $dashboard=$dashboards[dashboard];return $.smResolve().then(function(){return log&&log("Saving dashboard: "+dashboard),_putMetaData("dashboard","$local",dashboard,$dashboard)})})}).then(function(){var appHeader=appData.$application,name=endpoint+"."+appHeader.applicationName;return log&&log("Saving header: "+name+" Version: "+appHeader.versionNumber),appHeader.$isUpToDate=!0,_cachedAppVersions[name]=appHeader,_putMetaData("appHeader","$local",name,appHeader)});return waiting.waitModal(install)},exports.getPage=function(pageName){return log&&log("Read meta data (page): "+pageName),_getMetaData("page","$local",pageName).then(function(page){if(page)return log&&log("Cache hit"),page;log&&log("Cache miss")})},exports.getPrototype=function(prototypeName){return log&&log("Read meta data (prototype): "+prototypeName),_getMetaData("prototype","$local",prototypeName).then(function(proto){if(proto)return log&&log("Cache hit"),proto;log&&log("Cache miss")})},exports.initApplicationsList=function(){var self=this;return ajax.request("/sdata/syracuse/collaboration/syracuse/mobileApplications/$service/availableApplications").then(function(result){if(result.data)return _putMetaData("applications","$local","$applications",result.data.$resources);throw new Error("Empty applications list")})},exports.getApplicationsList=function(){return log&&log("Read meta data (applications list): "),_getMetaData("applications","$local","$applications").then(function(appList){if(appList)return log&&log("Cache hit"),appList;log&&log("Cache miss")})},exports.getDashboard=function(dashboardName){log&&log("Read meta data (dashboard): "+dashboardName)},exports.putArticle=function(page,article,views){return _putMetaData("page","$local",page,{$article:article,$views:views})},exports.putPrototype=function(prototypeName,data){return _putMetaData("prototype","$local",prototypeName,data)}}),define("syracuse-tablet/html/js/helpers/sharedContext",["require","exports","module","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){function _getOpenContextUrl(ctxUuid){var url=$.extend({},jsutils.getCurrentUrl());return ctxUuid&&(url.query||(url.query={}),url.query.url="contextId://"+ctxUuid),jsutils.urlToString(url)}var ajax=require("syracuse-tablet/html/js/common/ajax"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),defaultLifeSpan=240;exports.storeSharedContext=function(context){return ajax.request("/sdata/syracuse/collaboration/syracuse/mobileSharedContexts?representation=mobileSharedContext.$edit","POST",{linkCtx:JSON.stringify(context),lifespan:defaultLifeSpan}).then(function(result){return result.data.$uuid})},exports.readSharedContext=function(uuid){var deferred=$.Deferred();return ajax.request("/sdata/syracuse/collaboration/syracuse/mobileSharedContexts('"+uuid+"')?representation=mobileSharedContext.$details").then(function(result){var data=result.data&&result.data.linkCtx,obj=null;try{obj=data&&JSON.parse(data)}catch(e){}deferred.resolve(obj)}).fail(function(){deferred.resolve(null)}),deferred.promise()},exports.createContextFromPage=function(page){return{$url:page.pageData.$url,$method:page.pageData.$method,$savedCtx:page.savedCtxCreate()}},exports.createPageLoadDataFromContext=function(context){return{$url:context.$url,$method:context.$method,pageOptions:{savedCtx:context.$savedCtx}}},exports.getNavContextUrlByPage=function(page){return $.smResolve().then(function(){return exports.createContextFromPage(page)}).then(function(context){return exports.storeSharedContext(context)}).then(function(uuid){return"contextId://"+uuid})},exports.getFullContextUrlByPage=function(page){return $.smResolve().then(function(){return exports.createContextFromPage(page)}).then(function(context){return exports.storeSharedContext(context)}).then(function(uuid){return _getOpenContextUrl(uuid)})}}),define("syracuse-tablet/html/js/app/navigationHelper",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/helpers/sharedContext"],function(require,exports,module){function _checkNavigation(url,method){return $.smResolve().then(function(){var currentPage=modules.get("navStack").getMainStack().getTopPage(),parsedUrl=jsutils.parseURL(url);return currentPage?currentPage.onGotoUrlAction(!1,parsedUrl):$.smResolve(!0)}).then(function(kontinue){if(kontinue===!1)return!1;try{var parsed=jsutils.parseURL(url);if(parsed&&parsed.query){var appName;parsed.query.representation==="mobileApplication.$details"?appName=protoHelpers.getKeyFromUrl(url):parsed.query.$mobileApplication&&(appName=parsed.query.$mobileApplication);var endpoint=parsed.query.$mobileEndpoint;if(appName&&endpoint)return _checkMobileApplication(appName,endpoint)}}catch(Exception){return!0}}).then(function(okToNavigate){return okToNavigate!==!1})}function _checkMobileApplication(appName,endpoint){return $.smResolve().then(function(){return metaDataCache.tryGetApp(appName,endpoint)}).then(function(appData){return appData===null?_installMobileApplication(appName,endpoint):_updateMobileApplication(appName,endpoint,appData)})}function _installMobileApplication(appName,endpoint){var installConfirmed=!0;return $.smResolve().then(function(){return installConfirmed?metaDataCache.installApp(appName,endpoint).then(function(){return!0}):!1})}function _updateMobileApplication(appName,endpoint,appData){var updateConfirmed=!0;return $.smResolve().then(function(){return metaDataCache.isAppUpToDate(appData,endpoint)}).then(function(isUpToDate){return isUpToDate?!0:updateConfirmed?metaDataCache.installApp(appName,endpoint).then(function(){return!0}):!0})}function _fetchContext(uuid){return sharedContext.readSharedContext(uuid).then(function(context){return context&&sharedContext.createPageLoadDataFromContext(context)})}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),waiting=require("syracuse-tablet/html/js/utils/waiting"),modules=require("syracuse-tablet/html/js/common/modules"),environment=require("syracuse-tablet/html/js/helpers/environment"),locale=require("syracuse-tablet/html/js/helpers/locale"),helpers=require("syracuse-tablet/html/js/common/helpers"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),sharedContext=require("syracuse-tablet/html/js/helpers/sharedContext");exports.gotoUrl=function(url,method,pageOptions,loadOptions){loadOptions=loadOptions||{};var navStack=loadOptions.navStack||modules.get("navStack").getMainStack(),changedToBusy=navStack.setBusy(!0);if(!changedToBusy)return $.smResolve(null);if(method==null)try{var parsedUrl=jsutils.parseURL(url),$method=parsedUrl&&parsedUrl.query&&parsedUrl.query.$method;$method&&(method=$method)}catch(e){}var deferred=$.Deferred(),checkRestoreContext;url.indexOf("contextId://")===0?checkRestoreContext=_fetchContext(url.substr(12)).then(function(contextPageData){if(!contextPageData)return $.smReject(helpers.createDiag(null,"error",locale.text("invalid.link")));url=contextPageData.$url,method=contextPageData.$method,pageOptions=contextPageData.pageOptions,loadOptions={}}):url.indexOf("context://")===0?checkRestoreContext=$.smResolve().then(function(){var contextPageData;try{contextPageData=JSON.parse(decodeURIComponent(url.substr(10)))}catch(e){}if(!contextPageData)return $.smReject(helpers.createDiag(null,"error",locale.text("invalid.link")));url=contextPageData.$url,method=contextPageData.$method,pageOptions=contextPageData.pageOptions,loadOptions={}}):checkRestoreContext=$.smResolve();var pageCreateData={};return checkRestoreContext.then(function(){return url.toLowerCase().indexOf("html://home")>=0?pageCreateData.name="HOME":url.toLowerCase().indexOf("html://mock")>=0?(url=protoHelpers.getLocalDashboardUrl("MOCK"),pageCreateData.name="MOCK"):url.indexOf("{$hostPort}")===0&&(url=url.replace("{$hostPort}",protoHelpers.getHostPort())),pageCreateData.options=$.extend(!0,{},pageOptions),pageCreateData.url=url,pageCreateData.method=method,_checkNavigation(url,method)}).then(function(okToNavigate){if(okToNavigate===!0){environment.isAutoUITestMode()&&environment.getUnitTestMgr().notifPageLoaded("before");var loadingPromise=modules.get("pageFactory").createPage(pageCreateData);return waiting.waitModal(loadingPromise,loadOptions.$$waitParent)}return null}).then(function(newPage){return!newPage||newPage.destroyed===!0?null:navStack.pushPage(newPage,pageCreateData)}).then(function(page){environment.isAutoUITestMode()&&environment.getUnitTestMgr().notifPageLoaded("after",page),notifications.publish("sm.navigated.to.page",page),deferred.resolve(page)}).always(function(){changedToBusy&&navStack.setBusy(!1)}).fail(function(error){loadOptions.noError!==!0?modules.get("modal").asynchError(null,error).always(function(){deferred.resolve(null);if(loadOptions.noRedirectOnError==1)return;var target="html://home",pageOptions={},method="GET";error&&error.unauthenticated?target="html://login":loadOptions.firstPage===!0?target="html://home":error&&error.offline?navStack.getTopPage()==null?(target="html://login",pageOptions.offline=!0):target=null:target="html://home",target&&exports.gotoUrl(target,method,pageOptions,{noRedirectOnError:!0})}):deferred.reject(error)}),deferred.promise()}}),define("syracuse-tablet/html/js/app/navigationPageStack",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),environment=require("syracuse-tablet/html/js/helpers/environment"),modules=require("syracuse-tablet/html/js/common/modules"),locale=require("syracuse-tablet/html/js/helpers/locale"),_id=1,_stacks={},_mainStack,NavigationPageStack=utils.defineClass(function NavigationPageStack($$elmt){this.id=String(_id++),this.$$elmt=$$elmt,this.$$elmt.attr("data-nav-stack-id",this.id),_stacks[this.id]=this,this._itemId=1,this._pageStack=[],this._topPage=null,this._isBusy=!1},null,{destroy:function(){this.$$elmt=null,delete _stacks[this.id],this._pageStack&&this._pageStack.forEach(function(page){page.page&&page.page.destroy()}),this._pageStack=null},getTopPage:function(){return this._topPage},isFirstPageHome:function(){if(this._pageStack.length>0){var stackItem=this._pageStack[0];return stackItem.pageType==="home"}},isEmpty:function(){return this.count()==0},count:function(){return this._pageStack==null?0:this._pageStack.length},_getTopStackItem:function(){if(this._pageStack.length>0){var stackItem=this._pageStack[this._pageStack.length-1];return stackItem}},getStackItems:function(){return this._pageStack},goBack:function(){var prevPage=this._getPrevPageInHistory();return prevPage?this.goBackToId(prevPage.id):$.smResolve()},canGoBack:function(){return this._getPrevPageInHistory()!=null},_getPrevPageInHistory:function(){var prevPage=null,list=this._pageStack.slice();list.pop();while(!prevPage&&list.length>0)prevPage=list.pop(),prevPage.noHistory&&(prevPage=null);return prevPage},_popTopStackItem:function(){if(this._pageStack.length>0){var stackItem=this._pageStack[this._pageStack.length-1];return this._pageStack=this._pageStack.slice(0,-1),stackItem}},goBackToId:function(id){function _closeTopPage(stackItem){var close=$.Deferred(),page=stackItem.page,step;page?step=page.onGotoUrlAction(!0):step=$.smResolve(!0);var closeAllowed;return step.then(function(_closeAllowed){closeAllowed=_closeAllowed;if(!closeAllowed){close.resolve(!1);return}return self._popTopStackItem(),$.smResolve().then(function(){if(page)return page.hide()}).then(function(){if(page)return page.destroy()}).then(function(){return _checkCurrent()})}).fail(function(e){close.reject(e)}).then(function(){closeAllowed&&close.resolve(!0)}),close.promise()}function _checkCurrent(){return $.smResolve().then(function(){var top=self._getTopStackItem();if(top!=null&&top.id!==id)return _closeTopPage(top);if(top!=null)return self._activateTopPage()})}var self=this;id=Number(id);if(isNaN(id))throw new Error("Bad id : Number expected");return _checkCurrent()},_activateTopPage:function(){var self=this,top=self._getTopStackItem(),getPage;if(top!=null){var cached=top.page!=null;return cached!==!0?getPage=modules.get("pageFactory").createPage(top.pageCreateData).then(function(page){return top.page=page,self._renderPage(page)}):getPage=$.smResolve(top.page),getPage.then(function(page){return self._topPage=top.page,top.page.show(cached)}).then(function(){environment.getUnitTestMgr().notifPageLoaded("after",self._topPage)})}return $.smReject(locale.text("no.top.page"))},_renderPage:function(page){var self=this;return $.smResolve().then(function(){return self._topPage=page,page.set$$container(self.$$elmt),page.build()}).then(function(){environment.isAutoUITestMode()&&environment.getUnitTestMgr().addPageData(page)})},pushPage:function(page,pageCreateData){var self=this,first;if(!page)return $.smResolve(null);page.isRootPage()&&(this._pageStack.forEach(function(stackItem){stackItem.page&&stackItem.page.destroy()}),this._pageStack=[]);var prevStackItem=self._getTopStackItem(),prevPage=prevStackItem&&prevStackItem.page;return prevPage?page.options.isChild?first=$.smResolve().then(function(){return prevPage.hide()}):first=$.smResolve().then(function(){return prevPage.hide()}).then(function(){prevStackItem.pageCreateData.options.savedCtx=prevPage.savedCtxCreate(),prevPage.destroy(),prevStackItem.page=null}):first=$.smResolve(),first.then(function(){self._itemId=self._itemId+1;var item={id:self._itemId,page:page,title:page.getPageTitle(),pageCreateData:pageCreateData,noHistory:page.isNoHistory(),pageType:self._pageType(page)};self._pageStack.push(item),self.manageBrowserHistory&&window.history.pushState(item.id,null,null)}).then(function(){return self._renderPage(page)}).then(function(){return page.show()}).then(function(){return page})},_pageType:function(page){if(!page||!page.isSData())return;return page.isHome()?"home":page.isDashboard()?"dashboard":page.isChartDetail()?"chartDetail":page.controller.getFacet()},replaceCurrentPageData:function(page,callback){var self=this,topItem=self._getTopStackItem();topItem.page=page;var pageCreateData=topItem.pageCreateData;pageCreateData=callback(pageCreateData),topItem.pageCreateData=pageCreateData,topItem.title=page.getPageTitle()},setBusy:function(busy){var old=this._isBusy;return this._isBusy=busy,old!==busy},isBusy:function(busy){return this._isBusy},filterTopPage:function(filterCb){for(var i=this._pageStack.length-1;i>=0;i--){var page=this._pageStack[i]&&this._pageStack[i].page;if(page&&filterCb(page)===!0)return page}}});exports.getMainStack=function(){return _mainStack||(_mainStack=exports.getStackForElmt($("#s-m-app-id")),_mainStack.manageBrowserHistory=!0),_mainStack},exports.getStackForElmt=function($$elmt){var id=$$elmt.attr("data-nav-stack-id"),stack;return id&&(stack=_stacks[id]),stack||(stack=new NavigationPageStack($$elmt)),stack},exports.findClosest=function($$elmt){var $$stack=$$elmt.closest("[data-nav-stack-id]"),id=$$stack.attr("data-nav-stack-id");if(id)return _stacks[id]}}),define("syracuse-tablet/html/js/sdata/prototype",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/helpers"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),helpers=require("syracuse-tablet/html/js/common/helpers"),Prototype=utils.defineClass(function Prototype(json,parent){this.json=json,this.parent=parent,this.root=parent&&parent.root||this,this._initRefFields()},null,{destroy:function(){this.root=null,this.parent=null,this.json=null},propExists:function($bind){return(this.json.$properties&&this.json.$properties[$bind])!=null},propGetType:function($bind){return this.propExists($bind)?this.json.$properties[$bind].$type:null},propGetFormat:function($bind){return this.propExists($bind)?this.json.$properties[$bind].$format:null},propGetProto:function($bind){return this.propExists($bind)?new Prototype(this.json.$properties[$bind],this):null},propGetProtoItem:function($bind){var $item;return this.propExists($bind)?$item=this.json.$properties[$bind].$item:$item=this.json.$item,$item?new Prototype($item,this):null},getProto$Item:function($bind){return new Prototype(this.json.$item,this)},propIsSimple:function($bind){return this.propExists($bind)?!this.propIsArray($bind)&&!this.propIsReference($bind)&&!this.propIsImage($bind)&&!this.propIsText($bind)&&!this.propIsDocument($bind)&&!this.propIsBinary($bind):null},propIsText:function($bind){var t=this.propGetType($bind);return t&&t.split("/")[0]=="text"},propIsImage:function($bind){return this.propGetType($bind)==="image"},propIsArray:function($bind){return this.propGetType($bind)==="application/x-array"},propIsDocument:function($bind){return this.propGetType($bind)==="application/x-document"},propIsBinary:function($bind){return this.propGetType($bind)==="application/x-binary"},propIsSingleArray:function($bind){if(!this.propExists($bind)||!this.propIsArray($bind))return!1;var isSimple=!this.json.$properties[$bind].$item.$properties||this.json.$properties[$bind].$item.$type==="application/x-reference"?!0:!1;return isSimple},isSingleArray:function(){var isSingle=!this.json.$item.$properties||this.json.$item.$type==="application/x-reference"?!0:!1;return isSingle},propIsReference:function($bind){return this.propGetType($bind)==="application/x-reference"},isReference:function(){return this.json.$type==="application/x-reference"},propIsRefValue:function($bind){return this.propExists($bind)?(this.json.$properties[$bind].$item&&this.json.$properties[$bind].$item.$refPropertyName)!=null?!0:!1:!1},propGetRefProperty:function($bind){return this.propExists($bind)?this.json.$properties[$bind].$item.$refPropertyName:null},propGetRefValueName:function($bind){return this.propExists($bind)?this.json.$properties[$bind].$item.$refValueName:null},resolveExpression:function(exp,isUrl,extraData){var self=this,rescan=!0,max=20;if(exp==null)return exp;while(rescan&&max-->0&&exp.replace)rescan=!1,exp=exp.replace(/\{(\S+?)\}/g,function(m,g1,idx){var value,encode=isUrl&&idx>0&&exp.charAt(idx-1)==="=";if(extraData&&g1 in extraData)value=extraData[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value));else if(g1 in self.json)value=self.json[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value));else if(self.root!=self&&g1 in self.root.json)value=self.root.json[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value));else if(g1.charAt(0)==="@"){value=self.root.json.$localization&&self.root.json.$localization[g1];if(value===null||value===undefined)value=m}else value=m;return value});return exp},_initRefFields:function(){var props=this.json.$properties;if(!props)return;for(var p in props)this.propIsReference(p)&&this._initRefField(p)},_initRefField:function($bind){var proto=this.json.$properties[$bind],$item=proto.$item;if(!$item)return;$item.$refValueName=$item.$lookupKeyName=$bind;if($item.$value&&typeof $item.$value=="string"){var vals=/{([^}]+)}/g.exec($item.$value);if(vals&&vals.length==2){var $lookupKeyName=vals[1];$item.$lookupKeyName=$lookupKeyName;if($item[$lookupKeyName]){var $refValueName=$item[$lookupKeyName].replace(/[{}]/g,"").trim();if(this.propExists($refValueName)||$item.$properties&&$item.$properties[$refValueName])$item.$refValueName=$refValueName}$item.$refValueName||($item.$refValueName=$lookupKeyName)}}$item.$refValueName&&this.propExists($item.$refValueName)&&($item.$refValueType=this.propGetType($item.$refValueName),this.json.$properties[$item.$refValueName].$item=this.json.$properties[$item.$refValueName].$item||{},this.json.$properties[$item.$refValueName].$item.$refPropertyName=$bind)},getFacet:function(){var facet=/\.(\$\w+)/.exec(this.json.$type);return facet=facet&&facet.length>1&&facet[1],facet},getType:function(){return this.json.$type},getRepresentation:function(){var rep=this.json.$representation;return!rep&&this.json.$type&&(rep=this.json.$type.split("."),rep.length>1&&rep[0]=="{$baseType}"&&(rep=rep.slice(1).join("."))),rep},getValueByPath:function(path,resolve,isUrl,extraData){var val=helpers.getValueByPath(this.json,path);return val!=null&&resolve&&(val=this.resolveExpression(val,isUrl,extraData)),val},getFieldValueType:function($bind){var $properties=this.json.$properties||this.parent&&this.parent.json.$properties;if(!$properties)return;var prop=$properties[$bind],$type=prop&&prop.$type?prop.$type:"application/x-string";return $type==="application/x-quantity"?(prop.$value&&($type=prop.$value.$type),$type=$type||"application/x-integer"):$type==="application/x-reference"&&(prop.$item&&($type=prop.$item.$refValueType),$type=$type||"application/x-string"),$type},getFieldValueName:function($bind){return this.propIsReference($bind)?this.propGetRefValueName($bind):$bind},getFieldUpdateUrl:function($bind){var $properties=this.json.$properties||this.parent&&this.parent.json.$properties;if(!$properties)return;var prop=$properties[$bind];return prop.$url},createNew:function(json){return new Prototype(json,this)},getUnitFieldInfo:function(){var self=this,res={};res.$unit=self.json.$unit;if(typeof res.$unit=="object")res.unitBindName="$unit",res.unitFieldProto=self.createNew($.extend({},self.$unit));else if(typeof res.$unit=="string"){res.unitBindName=res.$unit;var parent=self.parent;while(parent){var unitProto=parent.json.$properties[res.$unit];if(unitProto){res.unitFieldProto=self.createNew($.extend({},unitProto));break}parent=parent.parent}}return res},clone:function(){var json=$.extend(!0,{},this.json);return new Prototype(json,this.parent)},isFacet:function(){return Array.prototype.indexOf.call(arguments,this.getFacet())>=0},isCube:function(){if(this._isCube==null){var p=this;while(p!=null&&this._isCube==null){if(p.json.$url!=null&&p.json.$url.trim().length!=0){var res=/representation=.*\.\$(\w+)[&]*/.exec(p.json.$url);res!=null&&res.length==2&&(this._isCube=res[1]=="cube")}p=p.parent}this._isCube=this._isCube==null?!1:this._isCube}return this._isCube},isQuery:function(){return this.isFacet("$query")},isWorkingCopyFacet:function(){return this.isFacet("$edit")||this.isFacet("$create")},isLookup:function(){return this.isFacet("$lookup")},isRequest:function(){return this.json.codeRequest!=null&&this.json.codeRequest.length>0},isStatistics:function(){return this.json.codeStat!=null&&this.json.codeStat.length>0},isQueryLikeFacet:function(){return this.isQuery()||this.isLookup()||this.isCube()||this.isRequest()},isApplication:function(){return this.json.$applicationName&&this.json.$applicationName!=""},data:function(prop,dataContext,ignoreParent,noResolve){if(!prop||prop.length==0)return null;var val=this.json[prop];if(val==null){ignoreParent==null&&["$title","$description"].indexOf(prop)>-1&&(ignoreParent=!0);var pVal=ignoreParent!==!0&&this.parent?this.parent.data(prop,dataContext,null,!0):val;return pVal!=null&&(this.json[prop]=pVal),pVal}return noResolve?val:this.resolveExpression(val,!1,dataContext)},hasCapability:function(cap){return this.json.$capabilities&&this.json.$capabilities.indexOf(cap)>-1||!1},getPropertyNames:function(){return this.json.$properties?Object.keys(this.json.$properties):[]},getPropertyData:function(name,prop){if(!name||name.length===0)return null;var o=this.json.$properties&&this.json.$properties[name];return!o||!prop?o:this.resolveExpression(o[prop])},chartGetNbMeasures:function(){var res=0,measures=this.getValueByPath("$cube.$measures");return measures&&Object.keys(measures).forEach(function(key){res++}),res},chartGetMeasureInfo:function(){var res={},prop,props=this.getValueByPath("$item.$properties"),measures=this.getValueByPath("$cube.$measures");return measures&&Object.keys(measures).forEach(function(key){prop=props[key],prop.$bind=key,res[key]=prop}),res},getProperties:function(select){var props=this.json.$properties,$properties=[];return Object.keys(props).forEach(function(v){select(props[v],v)&&($properties[v]=$.extend(!0,{},props[v],{}))}),$properties}});exports.Prototype=Prototype}),define("syracuse-tablet/html/js/controllers/controller",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/native/native"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),native=require("syracuse-tablet/html/js/helpers/native/native"),_controllerId=1,_controllers={};exports.Controller=utils.defineClass(function Controller(parent){this.id=_controllerId++,_controllers[this.id]=this,this.uiAdapter=parent?parent.uiAdapter:null,this._controlsById={},this._controlsWithContext=[],this._menuItemContainersById={},this._childrenControllers={},this.parent=parent,this.root=parent&&parent.root||this,parent&&parent.registerController(this)},null,{destroy:function(){if(this.destroyed===!0)return;this.destroyed=!0,delete _controllers[this.id],this.root=null,this._childrenControllers&&(this.destroyChildren(),this._childrenControllers=null),this.parent&&(this.parent.unregisterController(this),this.parent=null),this._controlsById&&this.forEachControl(function(c){c.destroy()}),this._controlsById=null,this._menuItemContainersById=null,this._controlsWithContext=null,this.uiAdapter=null},destroyChildren:function(){if(this._childrenControllers){for(var key in this._childrenControllers)this._childrenControllers[key]&&this._childrenControllers[key].destroy();this._childrenControllers={}}},registerController:function(controller){if(!controller)return;this._childrenControllers[controller.id]=controller},unregisterController:function(controller){if(!controller||!this._childrenControllers)return;delete this._controlsById[controller.id]},getControl:function(ctrlId){return this._controlById(ctrlId)},getControlForEvent:function(ctrlId,eventName){var ctrl=this.getControl(ctrlId);return!ctrl&&this.parent&&(ctrl=this.parent.getControlForEvent(ctrlId)),ctrl},getControlsByType:function($types){Array.isArray($types)||($types=[$types]);var res=[];return this.forEachControl(function(c){$types.indexOf(c.$type)>=0&&res.push(c)}),res},registerControl:function(ctrl){this._controlsById[ctrl.id]=ctrl,ctrl.onMenuItemChanged&&(this._menuItemContainersById[ctrl.id]=ctrl),ctrl.savedCtxCreate&&this._controlsWithContext.push(ctrl)},unregisterControl:function(ctrl){delete this._controlsById[ctrl.id],delete this._menuItemContainersById[ctrl.id];var idx=this._controlsWithContext.indexOf(ctrl);idx>=0&&this._controlsWithContext.splice(idx,1)},_controlById:function(ctrlId){return this._controlsById[ctrlId]},setUIAdapter:function(uiAdapter){this.uiAdapter=uiAdapter},_showNotification:function(title,message,severity){if(this.uiAdapter&&this.uiAdapter._showNotification)return this.uiAdapter._showNotification(title,message,severity)},_askConfirmation:function($confirm){return this.uiAdapter&&this.uiAdapter._askConfirmation?this.uiAdapter._askConfirmation($confirm):$.smResolve("yes")},_updateRequestCount:function(count){if(this.uiAdapter&&this.uiAdapter._updateRequestCount)return this.uiAdapter._updateRequestCount(count)},onDataActionClicked:function(dataAction,dataParams,event){var method="_act"+$.camelCase("-"+dataAction);func=this[method];if(func)return func.call(this,dataParams,event);var page=modules.get("navStack").getMainStack().getTopPage();if(page&&page[method])return page[method].call(page,dataParams,event);var app=modules.get("appController").App,func=app[method];if(func)return func.call(app,dataParams,event)},onMenuItemChanged:function($itemName,$bind,metaData){var ids=Object.keys(this._menuItemContainersById);for(var i=0,j=ids.length;i<j;i++){var id=ids[i],ctrl=this._menuItemContainersById[id];ctrl&&ctrl.onMenuItemChanged($itemName,$bind,metaData)}},isRoot:function(){return this!=null&&this==this.root},gotoUrl:function($url,$method,pageOptions,loadOptions){return modules.get("navHelper").gotoUrl($url,$method,pageOptions,loadOptions)},_actOpenExternalLink:function(url){var nativeExtLink=native.getModule("extLink");nativeExtLink?nativeExtLink.openExternalLink(url):window.open(url)},findController:function(controllerId){return exports.findController(controllerId)},forEachControl:function(cb){if(!this._controlsById)return;var self=this;Object.keys(this._controlsById).some(function(key,idx){var c=self._controlsById[key];return c?cb(c,idx)==1:!1})},savedCtxCreate:function(opts){var self=this,ctxCtrls=[];return self._controlsWithContext.forEach(function(ctrl,idx){var ctrlCtx=ctrl.savedCtxCreate(opts);ctrlCtx&&ctxCtrls.push(ctrlCtx)}),ctxCtrls},savedCtxRestore:function(ctrlsCtx){if(!ctrlsCtx)return;var self=this;ctrlsCtx.forEach(function(ctrlCtx,idx){var ctrl=self._controlsWithContext[idx];ctrl&&ctrl.savedCtxRestore&&ctrl.savedCtxRestore(ctrlCtx)})},savedCtxIndexOf:function(ctrl){return this._controlsWithContext==null?-1:this._controlsWithContext.indexOf(ctrl)},showNavigationStackBar:function(){return!1}}),exports.findController=function(id){return _controllers[id]},exports.findControllerByDom=function($$elmt){var $$controller=$$elmt.closest("[data-controller-id]"),controllerId=$$controller.attr("data-controller-id");return exports.findController(controllerId)},exports.findControlByDom=function($$elmt){var controller=exports.findControllerByDom($$elmt);if(controller){var $$ctrl=$$elmt.closest(".s-m-ctrl"),ctrlId=$$ctrl.attr("id");if(ctrlId)return controller.getControl(ctrlId)}}}),define("syracuse-tablet/html/js/app/eventListener",["require","exports","module","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/controllers/controller","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/ui/uiUtils"],function(require,exports,module){function _eventHandler(event,eventName){var $$target=$(event.target),controlRequest=!1,$$nevent;$$target.attr("data-nevent")!=null?$$nevent=$$target:($$nevent=$$target.closest("[data-nevent-ctrl-"+eventName+"]"),$$nevent.length>0?controlRequest=!0:$$nevent=$$target.closest("[data-nevent]"));if($$nevent==null||$$nevent.length==0)return;if(eventName==="click"){var time=(new Date).getTime();if(_lastClick>0&&time-_lastClick<_CLICKDELAY)return;_lastClick=time,$$nevent.attr("disabled","true"),setTimeout(function(){try{$$nevent.removeAttr("disabled")}catch(e){}},_CLICKDELAY)}var $$ctrl;$$nevent.hasClass("s-m-ctrl")?$$ctrl=$$nevent:$$ctrl=$$nevent.closest(".s-m-ctrl");var $$controller=$$nevent.is("[data-controller-id]")?$$nevent:$$ctrl.is("[data-controller-id]")?$$ctrl:$$ctrl.closest("[data-controller-id]"),controllerId=$$controller.attr("data-controller-id"),controller=controllerId&&controllerModule.findController(controllerId),ctrlId=$$ctrl.attr("id"),ctrl=ctrlId&&controller&&controller.getControlForEvent(ctrlId,eventName),handled=!1;if(controlRequest&&ctrl){var dataAction=$$nevent.attr("data-naction"),method="on"+eventName.smCapitalize(),func=ctrl[method],args=[],params;dataAction&&$$nevent.is("select")?(method="_act"+dataAction.smCapitalize(),func=ctrl[method],params=$$nevent.val(),params&&typeof params=="string"&&(params=params.split(","),params.forEach(function(p,idx){args.push(p.trim())}))):args.push(event),func&&(handled=func.apply(ctrl,args));if(handled)return}if(eventName!=="click")return;if(ctrl&&controller){var page=ctrl.page.parentPage||ctrl.page;if(page.controller.configActive&&!$$target.attr("data-naction")&&!ctrl.isPanel&&ctrl.$type!=="hubgroup")return;var $linkName=$$nevent.attr("data-sdata-link-name"),$linkBind=$$nevent.attr("data-sdata-link-bind");if($linkName){ctrl.onSdataLinkClicked?ctrl.onSdataLinkClicked($linkName,$linkBind):controller.onSdataLinkClicked&&controller.onSdataLinkClicked($linkName,$linkBind);return}var $actionName=$$nevent.attr("data-sdata-action-name");if($actionName){ctrl.onSdataActionClicked?ctrl.onSdataActionClicked($actionName):controller.onSdataActionClicked&&controller.onSdataActionClicked($actionName);return}}var dataAction=$$nevent.attr("data-naction");if(dataAction){var args=[],tmp=$.camelCase("-"+dataAction);tmp.indexOf("-")===0&&(tmp=tmp.substr(1));var method="_act"+tmp,objectToCall;if(ctrl&&ctrl[method])objectToCall=ctrl;else if(ctrl&&ctrl.onDataActionClicked)args.push(dataAction),method="onDataActionClicked",objectToCall=ctrl;else if(controller&&controller[method])objectToCall=controller;else if(controller&&controller.onDataActionClicked)args.push(dataAction),method="onDataActionClicked",objectToCall=controller;else{var navStack=modules.get("navStack").findClosest($$nevent),page=navStack&&navStack.getTopPage();if(page&&page[method])objectToCall=page;else{var app=modules.get("appController").App;app&&app[method]&&(objectToCall=app)}}if(objectToCall&&method){var dataParams=$$nevent.attr("data-params")||"";dataParams=dataParams.split(","),dataParams.forEach(function(p,idx){args.push(p.trim())}),args.push(event),objectToCall[method].apply(objectToCall,args)}return}}var environment=require("syracuse-tablet/html/js/helpers/environment"),modules=require("syracuse-tablet/html/js/common/modules"),controllerModule=require("syracuse-tablet/html/js/controllers/controller"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),uiutils=require("syracuse-tablet/html/js/ui/uiUtils"),_CLICKDELAY=300,_lastClick=0;exports.registerEvents=function($$container){$(window).on("resize",siteLayout.onWindowResize),environment.isMobile()&&($.event.special.orientationchange.setup(),$(window).on("orientationchange",siteLayout.onWindowOrientation)),$(window).on("resizeInternal",siteLayout.onWindowResizeInteral),$(window).bind("popstate",function(event){var state=event.originalEvent.state;state?modules.get("appController").App.onBrowserBackButton(event):event.preventDefault()}),$$container.on("click","[data-nevent]:not(select):not(.disabled):not([disabled])",function(e){_eventHandler(e,"click")}),$$container.on("change","select[data-nevent]:not(.disabled):not([disabled])",function(e){_eventHandler(e,"click")}),["blur","focus","change","click","input"].forEach(function(eventName){$$container.on(eventName,"[data-nevent-ctrl-"+eventName+"]:not(.disabled):not([disabled])",function(e){_eventHandler(e,eventName)})})},exports.getDataActionAttrs=function(controllerId,action,params,asHtml){var attrs={href:"#","data-nevent":"","data-controller-id":controllerId,"data-naction":action||"","data-params":params||""};return asHtml?uiutils.objectToHtmlAttrs(attrs):attrs},exports.getSdataLinkAttrs=function(controllerId,$linkName,$bind,asHtml){var attrs={href:"#","data-nevent":"","data-sdata-link-name":$linkName,"data-sdata-link-bind":$bind};return asHtml?uiutils.objectToHtmlAttrs(attrs):attrs},exports.getSdataActionAttrs=function(controllerId,$actionName,asHtml){var attrs={href:"#","data-nevent":"","data-sdata-action-name":$actionName};return asHtml?uiutils.objectToHtmlAttrs(attrs):attrs}}),define("syracuse-tablet/html/js/controls/ctrlBase",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/app/eventListener"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),globals=require("syracuse-tablet/html/js/app/globals"),utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),localeModule=require("syracuse-tablet/html/js/helpers/locale"),environment=require("syracuse-tablet/html/js/helpers/environment"),eventListener=require("syracuse-tablet/html/js/app/eventListener");exports.CtrlBase=utils.defineClass(function CtrlBase(controller,$type,article,options){this.options=options||{},this.controller=controller,this.$type=$type,this.typeName=utils.getTypeName($type),this.article=article||{},this.children=null,this.parent=null,this.destroyed=!1,this.id=this.createId(this.typeName),this.page=null,controller.registerControl(this)},null,{destroy:function(){this.destroyed=!0,this.page=null,this.controller&&this.controller.unregisterControl(this),this.controller=null,this.destroyChildren(),notifications.unsubscribe(this),this.$$elmt&&(this.$$elmt.unbind(),this.$$elmt.remove(),this.$$elmt=null),this.parent&&(this.parent.removeChild(this),this.parent=null)},removeChild:function(ctrl){if(!this.children)return;var idx=this.children.indexOf(ctrl);idx>-1&&this.children.splice(idx,1)},destroyChildren:function(){if(!this.children)return;for(var i=this.children.length-1;i>=0;i--)this.children[i]&&this.children[i].destroy();this.children=[]},createId:function(typeName){return utils.readableuid(typeName)},set$$container:function($$container){this.$$container=$$container},buildHtml:function(classes){throw new Error("Controll does not implement buildHtml")},createRootElement:function(classList){if(!this.$$container)throw new Error("No container set for rendering");var domElement=uiUtils.createDomElement(this.getRootElementTag(),classList,null,{id:this.id}),$$elmt=$(domElement);return this.setRootElement($$elmt,this.$$container),environment.isAutoUITestMode()&&environment.getUnitTestMgr().addBindAttribute(this),$$elmt},getRootElementTag:function(){return"div"},setRootElement:function($$elmt,$$parent){if(!$$parent.jquery)throw new Error("Invalid parent");if(!$$elmt.jquery)throw new Error("Invalid root");this.$$elmt=$$elmt,this.$$elmt.appendTo($$parent);if(environment.isAutoUITestMode()){var i=this.getUnitTestId();i&&environment.getUnitTestMgr().addStructElmtId(this.$$elmt,i)}return this.$$elmt},afterRender:function(){this.children&&this.children.forEach(function(child){child.afterRender()})},getAuthoring:function(path,defValue){var val=utils.getPropByPath(this.article,path);return val!=null?val:defValue},getArticle:function(){return this.article},getAuthArticle:function(){var authArticle={},nodeArticle=this.getArticle();return Object.keys(nodeArticle).forEach(function(key){key!=="$items"&&(authArticle[key]=nodeArticle[key])}),authArticle},getAuthState:function(dirtyKeys){return null},setAuthState:function(state){},isRoot:function(){return this.parent==null||this.parent===this.controller},isVisible:function(){return this.$$elmt&&this.$$elmt.is(":visible")},isHidden:function(){return!this.isVisible()},setFocus:function(){this.makeVisible()},makeVisible:function(){if(!this.page||!this.$$elmt)return;this.page.makeVisible(this.$$elmt)},show:function(){this.$$elmt&&this.$$elmt.show()},hide:function(){this.$$elmt&&this.$$elmt.hide()},appendStructElmt:function(c){if(!c)return;this.children||(this.children=[]),c.parent=this,this.children.push(c)},getNbChilds:function(){return this.children&&this.children.length>0},getIndexOfChild:function(child){var idx=-1;return this.children&&this.children.some(function(c){return idx+=1,c===child?!0:!1}),idx},getChildByIndex:function(idx){return this.children&&this.children[idx]},addChildBefore:function(ctrl,nextChild){var added=!1,_children=[];this.children&&this.children.forEach(function(c){nextChild&&c.id===nextChild.id&&(_children.push(ctrl),added=!0),c.id!==ctrl.id&&_children.push(c)}),added||_children.push(ctrl),this.children=_children},removeChildRef:function(c){var _children=[];this.children&&this.children.forEach(function(child){child.id!==c.id&&_children.push(child)}),this.children=_children},getPathInTree:function(){var ctrl=this,path=[],parent=this.parent;parent==null&&this.page&&this.page.parentVignette&&(parent=this.page.parentVignette.parent,path.push(0));while(parent){var idx=parent.getIndexOfChild(ctrl);path.push(idx),ctrl=parent,parent=ctrl.parent,parent==null&&ctrl.page&&ctrl.page.parentVignette&&(path.push(0),ctrl=ctrl.page.parentVignette,parent=ctrl.parent)}return path.reverse(),path},findChildByPath:function(path){if(!path)return;var node=this;return path.some(function(idx){if(jsutils.isInstanceOf(node,"CtrlVignette")){var page=node.getTopPage();return node=page&&page.rootLayout,!1}node=node&&node.getChildByIndex(+idx);if(!node)return!0}),node},getArticleText:function(property,value){if(!this.article[property]&&!value)return"";var self=this,$articleLocalizationDashboard;self.page.parentVignette&&($articleLocalizationDashboard=self.page.parentVignette.$articleLocalization);var locale=localeModule.getCurrentLocale(),prop=self.article[property]||value,text=prop&&prop.replace(/\{\@(\S+)\}/g,function(m,g){var localization=self.$articleLocalization[locale],fallback=self.$articleLocalization[globals.fallbackLocaleCode],match=localization&&localization[g]||fallback&&fallback[g]||$articleLocalizationDashboard&&$articleLocalizationDashboard[locale]&&$articleLocalizationDashboard[locale][g]||$articleLocalizationDashboard&&$articleLocalizationDashboard[globals.fallbackLocaleCode]&&$articleLocalizationDashboard[globals.fallbackLocaleCode][g];return match===null||match===undefined?m:match});return text&&prop===text&&(text=this.controller.dataset.prototype.resolveExpression(text)),text||""},getArticleTextUUID:function(property){if(!this.article[property]||this.article[property].indexOf("{@")<0)return"";var uuid=this.article[property].match(/\{\@(\S+)\}/);return uuid&&uuid[1]},getUnitTestId:function(){return null},getUnitTestMsg:function(){return this.article&&this.article.$unitTest?this.article.$unitTest.message:null},getDataActionAttrs:function(dataAction,dataParams){return eventListener.getDataActionAttrs(this.controller.id,dataAction,dataParams)},isControl:function(){return!0},isLayout:function(){return!1},isArrayChart:function(){return!1},isAuthoringPropAllowed:function(property,value){return!0},isVignette:function(){return!1},excludeChildrenFromAuthoring:function(){return!1},setBuildOption:function(optionName,optionValue){optionValue!=null?this.options[optionName]=optionValue:delete this.options[optionName]},setBuildOptionPerClass:function(className,optionName,optionValue){jsutils.isInstanceOf(this,className)&&this.setBuildOption(optionName,optionValue),this.children&&this.children.forEach(function(c){c.setBuildOptionPerClass(className,optionName,optionValue)})},tryGetPage:function(){var page=this.controller.uiAdapter;return page?(jsutils.isInstanceOf(page,"PageBase")||(page=page.page),page):null}})}),define("syracuse-tablet/html/js/controls/ctrlSdataBase",["require","exports","module","syracuse-tablet/html/js/controls/ctrlBase","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/app/eventListener","syracuse-tablet/html/js/helpers/environment"],function(require,exports,module){function _genHtmlCtrlLink(proto,dao,options,cb){var self=this;options=options||{};var html=[],url=proto.data("$url"),tag=options.tag||"a",css=options.css||"a";if(url&&url.length)html.push("<"),html.push(tag),html.push(' href="'+url+'"'),css&&html.push(' class="'+css+'"'),html.push(">");else{var action=proto.data("$action")||self.prototype.data("$navigation");if(action){html.push("<"),html.push(tag),html.push(' href="#"');for(var p in action)html.push(" "+p+'="'+encodeURIComponent(dao?dao.parseExpression(action[p]):action[p])+'"');css&&html.push(' class="'+css+'"'),html.push(">")}}return cb&&cb(html),html.length>1&&(html.push("</"),html.push(tag),html.push(">")),html.join("")}var Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase,globals=require("syracuse-tablet/html/js/app/globals"),utils=require("syracuse-tablet/html/js/helpers/utils"),native=require("syracuse-tablet/html/js/helpers/native/native"),eventListener=require("syracuse-tablet/html/js/app/eventListener"),environment=require("syracuse-tablet/html/js/helpers/environment");exports.CtrlSdataBase=utils.defineClass(function CtrlSdataBase(controller,article,prototype,options){this.$bind=article.$bind,Base.call(this,controller,prototype.getType(),article,options),this.prototype=prototype,this.$isEditMode=controller.isEditMode(),this._nativeCapabilities=this._initNativeCapabilities(options)},Base,{destroy:function(){var self=this;Base.prototype.destroy.call(self),self.prototype=null},createId:function(typeName){return utils.readableuid(this.$bind,typeName.substr(0,3))},buildHtml:function(classes){classes=classes||[],classes.push("s-m-control"),classes.push("s-m-ctrl");var $theme=this.getAuthoring("$theme");$theme&&$theme!=="none"&&classes.push("s-m-theme-"+$theme),this.createRootElement(classes),environment.isAutoUITestMode()&&environment.getUnitTestMgr().addBindAttribute(this)},afterRender:function(){},applyMetaData:function(metaData){},getMetaData:function(metaProp){var meta=this.controller.getMetaData(this.$bind);return meta&&(metaProp?meta[metaProp]:meta)},getTitle:function(){var ttl=this.article&&this.article.$title||this.prototype.getValueByPath("$title",!0)||"";return ttl.length===0&&globals.isAuthoringActive()&&this.prototype.isFacet("details","edit")&&(ttl=this.$bind),ttl},getSdataLinkAttrs:function($linkName){return eventListener.getSdataLinkAttrs(this.controller.id,$linkName,this.$bind)},getDataActionAttrs:function(action,params){return eventListener.getDataActionAttrs(this.controller.id,action,params)},getUnitTestId:function(){return this.$bind?utils.unitTestId(this.$bind):utils.unitTestId(this.typeName)},_initNativeCapabilities:function(options){if(!options||!options.nativeCapabilities)return null;var res={};for(var capability in options.nativeCapabilities)res[capability]=options.nativeCapabilities[capability]===!0&&native.hasCapability(capability)===!0;return res},getNativeCapabilities:function(){return this._nativeCapabilities}}),exports.genHtmlCtrlLink=_genHtmlCtrlLink}),define("syracuse-tablet/html/js/helpers/types/date",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _padLeft(str,len,ch){str=str?str.toString():"";if(!ch||ch.length==0)ch=" ";while(str.length<len)str=ch+str;return str}function DateObj(value){this._value=value}function _dayName(weekDay,abbrev){return abbrev?_dateInfo().abbreviatedDayNames[weekDay]:_dateInfo().dayNames[weekDay]}function _monthName(month,abbrev){return abbrev?_dateInfo().abbreviatedMonthNames[month-1]:_dateInfo().monthNames[month-1]}function _pad2(val){var s=val.toString();return s.length==1?"0"+s:s}function _toOffset(date){var year=date.year,month=date.month,day=date.day,y=month<=2?year-1:year,n4=Math.floor(y/4)-Math.floor(492.5),n100=Math.floor(y/100)-Math.floor(19.7),n400=Math.floor(y/400)-Math.floor(4.925),nLeap=n4-n100+n400;return(year-1970)*365+nLeap+_monthOffsets[month-1]+day-1}function _fromOffset(offset){var julian=2440588+offset,l=julian+68569,n=Math.floor(4*l/146097);l-=Math.floor((146097*n+3)/4);var i=Math.floor(4e3*(l+1)/1461001);l=l-Math.floor(1461*i/4)+31;var j=Math.floor(80*l/2447),day=l-Math.floor(2447*j/80);l=Math.floor(j/11);var month=j+2-12*l,year=100*(n-49)+i+l;return new DateObj(year*1e4+month*100+day)}function _make(year,month,day){return new DateObj(year*1e4+month*100+day)}function _isLeap(year){return year%4===0&&(year%100!==0||year%400===0)}function _daysInMonth(year,month){return month==2?_isLeap(year)?29:28:_monthLengths[month-1]}function _isWorkDay(weekDay){return weekDay!=0&&weekDay!=6}function _amDesignator(){return _dateInfo().amDesignator||"AM"}function _pmDesignator(){return _dateInfo().pmDesignator||"PM"}function _walkFormat(format,map){function count(i){var ch=format[i],k=1;while(format[i+k]===ch)k++;return k}var i=0,len=format.length;while(i<len){var c=format[i];switch(c){case"'":i++;var literal="";for(;i<len;i++)if(format[i]==="'"){i++;if(format[i]!=="'")break;literal+="'"}else literal+=format[i];map.literal(literal);break;case"d":case"M":case"y":var repeat=count(i);map[c](repeat),i+=repeat;break;default:map.literal(c),i++}}}function _parse(str,format){function parseInteger(max){if(!/\d/.test(str[j]))throw new Error(locale.text("date.notNumber",str.substring[j]));var beg=j++;while(j<beg+max&&/\d/.test(str[j]))j++;return parseInt(str.substring(beg,j),10)}function parseName(names){for(var k=0;k<names.length;k++){var name=names[k],len=name.length;if(str.substring(j,j+len).toUpperCase()==name.toUpperCase())return j+=len,k}throw new Error(locale.text("date.unknown",str.substring(j)))}var day,weekday,month,year,j=0;return _walkFormat(format,{literal:function(literal){if(str.substring(j,j+literal.length)!==literal)throw new Error(locale.text("date.wrongFormat",literal,str.substring(j)));j+=literal.length},d:function(arg){switch(arg){case 1:case 2:day=parseInteger(2);break;case 3:weekday=parseName(_dateInfo().abbreviatedDayNames);break;case 4:weekday=parseName(_dateInfo().dayNames);break;default:throw new Error(locale.text("date.badDay",format.substring(j)))}},M:function(arg){switch(arg){case 1:case 2:month=parseInteger(2);break;case 3:month=parseName(_dateInfo().abbreviatedMonthNames)+1;break;case 4:month=parseName(_dateInfo().monthNames)+1;break;default:throw new Error(locale.text("date.badDay",format.substring(j)))}},y:function(arg){switch(arg){case 2:year=parseInteger(2),year=year<40?2e3+year:1900+year;break;case 4:year=parseInteger(4),year=year>99?year:year<40?2e3+year:1900+year;break;default:throw new Error(locale.text("date.badYear",format.substring(j)))}}}),_make(year,month,day)}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_dateInfo=locale.getDatetimeInfo;exports.validate=function(value,constraints,errors){if(value==null){if(constraints.$isMandatory)return errors.push(locale.text("date.valMan"));if(!constraints.$isNullable)return errors.push(locale.text("date.valNull"));return}if(!(value instanceof DateObj)){errors.push(locale.text("date.valDate"));return}if(!(value.month>=1&&value.month<=12)){errors.push(locale.text("date.invMonth"));return}if(!(value.day>=1&&value.day<=_daysInMonth(value.year,value.month))){errors.push(locale.text("date.invDay"));return}};var _monthOffsets=[0,31,59,90,120,151,181,212,243,273,304,334],_monthLengths=[31,28,31,30,31,30,31,31,30,31,30,31];exports.amDesignator=_amDesignator,exports.pmDesignator=_pmDesignator,utils.defineClass(DateObj,null,{year:{get:function(){return Math.floor(this._value/1e4)}},month:{get:function(){return Math.floor(this._value/100)%100}},day:{get:function(){return this._value%100}},weekDay:{get:function(){return(2440589+_toOffset(this))%7}},yearDay:{get:function(){var month=this.month,leap=month>2&&_isLeap(this.year)?1:0;return _monthOffsets[month-1]+leap+this.day}},week:{get:function(){var begOfWeek1=_make(this.year,1,4).begOfWeek(1);return Math.floor((7+_toOffset(this)-_toOffset(begOfWeek1))/7)}},valueOf:function(){return this.toString()},compare:function(date){return this._value-date._value},equals:function(date){return this._value===date._value},between:function(begin,end){return begin._value<=this._value&&this._value<=end._value},isLeapYear:function(){return _isLeap(this.year)},isWorkDay:function(){return _isWorkDay(this.weekDay)},daysInMonth:function(){return _daysInMonth(this.year,this.month)},begOfYear:function(){return _make(this.year,1,1)},endOfYear:function(){return _make(this.year,12,31)},begOfQuarter:function(){return _make(this.year,Math.floor((this.month-1)/3)*3+1,1)},endOfQuarter:function(){return this.begOfQuarter().addMonths(2).endOfMonth()},begOfMonth:function(){return _make(this.year,this.month,1)},endOfMonth:function(){return _make(this.year,this.month,this.daysInMonth())},sameMonth:function(day){return day=Math.min(day,this.daysInMonth()),_make(this.year,this.month,day)},pastDay:function(day,includeThis){var delta=day-this.day;return delta>0||delta==0&&!includeThis?this.addMonths(-1).sameMonth(day):this.sameMonth(day)},futureDay:function(day,includeThis){var delta=day-this.day;return delta<0||delta==0&&!includeThis?this.addMonths(1).sameMonth(day):this.sameMonth(day)},pastMonth:function(month,includeThis){var delta=this.month-month;return delta=delta==0?includeThis?0:12:delta>0?delta:delta+12,this.addMonths(-delta)},futureMonth:function(month,includeThis){var delta=month-this.month;return delta=delta==0?includeThis?0:12:delta>0?delta:delta+12,this.addMonths(delta)},begOfWeek:function(startDay){var delta=this.weekDay-(startDay||0);return delta==0?this:delta>0?this.addDays(-delta):this.addDays(-delta-7)},endOfWeek:function(startDay){return this.begOfWeek(startDay).addDays(6)},sameWeek:function(weekDay,startDay){return this.begOfWeek(startDay).futureWeekDay(weekDay,!0)},pastWeekDay:function(weekDay,includeThis){var result=this.begOfWeek(weekDay);return!includeThis&&result.equals(this)?this.addWeeks(-1):result},futureWeekDay:function(weekDay,includeThis){return this.pastWeekDay(weekDay,!includeThis).addWeeks(1)},addYears:function(years){if(years==0)return this;var year=this.year+years,month=this.month,day=Math.min(this.day,_daysInMonth(year,month));return _make(year,month,day)},addMonths:function(months){if(months==0)return this;var self=this,day=self.day,month0=self.month-1,year=self.year;month0+=months,year+=Math.floor(month0/12);var month=(month0+12e4)%12+1,monthLen=_daysInMonth(year,month);return day=day<monthLen?day:monthLen,_make(year,month,day)},addWeeks:function(weeks){return this.addDays(7*weeks)},addDays:function(days){return days==0?this:_fromOffset(_toOffset(this)+days)},daysDiff:function(date){return _toOffset(this)-_toOffset(date)},add:function(delta){return this.addYears(delta.years||0).addMonths(delta.months||0).addWeeks(delta.weeks||0).addDays(delta.days||0)},toString:function(format){var self=this;if(format==null){var str=self._value.toString();return str=_padLeft(str,8,"0"),str.substring(0,4)+"-"+str.substring(4,6)+"-"+str.substring(6,8)}var result="";return _walkFormat(format,{literal:function(lit){result+=lit},d:function(repeat){switch(repeat){case 1:result+=self.day.toString();break;case 2:result+=_pad2(self.day);break;case 3:result+=_dayName(self.weekDay,!0);break;case 4:result+=_dayName(self.weekDay);break;default:throw new Error(locale.text("date.formatd",repeat))}},M:function(repeat){switch(repeat){case 1:result+=self.month.toString();break;case 2:result+=_pad2(self.month);break;case 3:result+=_monthName(self.month,!0);break;case 4:result+=_monthName(self.month);break;default:throw new Error(locale.text("date.formatM",repeat))}},y:function(repeat){switch(repeat){case 2:result+=self.year.toString().substring(2,4);break;case 4:result+=self.year.toString();break;default:throw new Error(locale.text("date.formatM",repeat))}}}),result},at:function(time,millisecond){throw new Error(locale.text("date.notInstalled"))},toJsDate:function(utc){return utc?new Date(Date.UTC(this.year,this.month-1,this.day)):new Date(this.year,this.month-1,this.day)},isNull:function(){return this._value==0}}),exports.monthName=_monthName,exports.monthFromName=function(name){var n=_dateInfo().monthNames,m=_dateInfo().abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s)return i+1;return-1},exports.dayName=_dayName,exports.weekDayFromName=function(name){var n=_dateInfo().dayNames,m=_dateInfo().abbreviatedDayNames,o=_dateInfo().shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s)return i;return-1},exports.isLeap=_isLeap,exports.daysInMonth=_daysInMonth,exports.today=function(utc){return exports.fromJsDate(new Date,utc)},exports.parse=function(str,format){if(str==null)throw new Error(locale.text("date.dateNull"));if(format==null){if(str.length!=10)throw new Error(locale.text("date.badFormat",str));var value=parseInt(str.replace(/-/g,""),10);return new DateObj(value)}return _parse(str,format)},exports.walkFormat=_walkFormat,exports.fromJsDate=function(jsDate,utc){return utc?_make(jsDate.getUTCFullYear(),jsDate.getUTCMonth()+1,jsDate.getUTCDate()):_make(jsDate.getFullYear(),jsDate.getMonth()+1,jsDate.getDate())},exports.fromInternalValue=function(value){return new DateObj(value)},exports.makeInWeek=function(year,week,wday){var dday=wday?wday-1:6;return _make(year,1,4).begOfWeek(1).addDays(7*(week-1)+dday)},exports.isDate=function(obj){return obj instanceof DateObj},exports.sunday=0,exports.Sunday=0,exports.monday=1,exports.Monday=1,exports.tuesday=2,exports.Tuesday=2,exports.wednesday=3,exports.Wednesday=3,exports.thursday=4,exports.Thursday=4,exports.friday=5,exports.Friday=5,exports.saturday=6,exports.Saturday=6,exports.make=_make,exports.getLocalShortDate=function(dateISOString){if(!dateISOString||dateISOString.length<6)return"";var tmp=dateISOString.split("-"),d=_make(+tmp[0],+tmp[1],+tmp[2]);return d.toString(locale.getDateFormat())}}),define("syracuse-tablet/html/js/helpers/types/time",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function Time(value){value=(value+31536e7)%86400,this._value=value}function _pad2(val){var s=val.toString();return s.length==1?"0"+s:s}function _parse2(str,beg,end){return parseInt(str.substring(beg,end),10)}function _make(hour,minute,second){return new Time(hour*3600+(minute||0)*60+(second||0))}function _amDesignator(){return _dateInfo().amDesignator||"AM"}function _pmDesignator(){return _dateInfo().pmDesignator||"AM"}function _walkFormat(format,map){function count(i){var ch=format[i],k=1;while(format[i+k]===ch)k++;return k}var i=0,len=format.length;while(i<len){var c=format[i];switch(c){case"'":i++;var literal="";for(;i<len;i++)if(format[i]==="'"){i++;if(format[i]!=="'")break;literal+="'"}else literal+=format[i];map.literal(literal);break;case"H":case"h":case"m":case"s":case"t":var repeat=count(i);map[c](repeat),i+=repeat;break;default:map.literal(c),i++}}}function _parse(str,format){function parseInteger(max){if(!/\d/.test(str[j]))throw new Error(locale.text("time.noNumber",str.substring[j]));var beg=j++;while(j<beg+max&&/\d/.test(str[j]))j++;return parseInt(str.substring(beg,j),10)}function parseName(names){for(var k=0;k<names.length;k++){var name=names[k],len=name.length;if(str.substring(j,j+len).toUpperCase()==name.toUpperCase())return j+=len,k}throw new Error(locale.text("time.unknown",str.substring(j)))}function from12to24(mode,index){switch(mode[index]){case mode[0]:hour=hour===12?0:hour;break;case mode[1]:hour>=1&&hour<=11&&(hour+=12)}}var hour,minute,second,timeMode,abbrTimeMode,timeModes=[_amDesignator(),_pmDesignator()],abbrTimeModes=[timeModes[0].substring(0,1),timeModes[1].substring(0,1)],j=0;_walkFormat(format,{literal:function(literal){if(str.substring(j,j+literal.length)!==literal)throw new Error(locale.text("time.wrongFormat",literal,str.substring(j)));j+=literal.length},H:function(arg){switch(arg){case 1:case 2:hour=parseInteger(2);break;default:throw new Error(locale.text("time.badHour",format.substring(j)))}},h:function(arg){switch(arg){case 1:case 2:hour=parseInteger(2);break;default:throw new Error(locale.text("time.badHour",format.substring(j)))}},m:function(arg){switch(arg){case 2:minute=parseInteger(2);break;default:throw new Error(locale.text("time.badMin",format.substring(j)))}},s:function(arg){switch(arg){case 2:second=parseInteger(2);break;default:throw new Error(locale.text("time.badSec",format.substring(j)))}},t:function(arg){switch(arg){case 1:abbrTimeMode=parseName(abbrTimeModes);break;case 2:timeMode=parseName(timeModes);break;default:throw new Error(locale.text("time.badMarker",format.substring(j)))}}});if(timeMode!=null||abbrTimeMode!=null){if(hour>12)throw new Error(locale.text("time.badHourVal",hour,timeMode));var mode=timeMode!=null?timeModes:abbrTimeModes,index=timeMode!=null?timeMode:abbrTimeMode;from12to24(mode,index)}return _make(hour,minute,second)}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_dateInfo=locale.getDatetimeInfo;exports.validate=function(value,constraints,errors){if(value==null){if(constraints.$isMandatory)return errors.push(locale.text("time.valMan"));if(!constraints.$isNullable)return errors.push(locale.text("time.valNull"));return}if(!(value instanceof Time)){errors.push(locale.text("time.valTime"));return}},utils.defineClass(Time,null,{hour:{get:function(){return Math.floor(this._value/3600)}},minute:{get:function(){return Math.floor(this._value/60)%60}},second:{get:function(){return this._value%60}},value:{get:function(){return this._value}},valueOf:function(){return this.toString()},compare:function(time){return this._value-time._value},equals:function(time){return this._value===time._value},between:function(begin,end){return begin._value<=this._value&&this._value<=end._value},begOfDay:function(){return _make(0,0,0)},endOfDay:function(){return _make(23,59,59)},begOfHour:function(){return _make(this.hour,0,0)},endOfHour:function(){return _make(this.hour,59,59)},begOfMinute:function(){return _make(this.hour,this.minute,0)},endOfMinute:function(){return _make(this.hour,this.minute,59)},toString:function(format){var self=this;if(format==null)return _pad2(self.hour)+":"+_pad2(self.minute)+":"+_pad2(self.second);var result="";return _walkFormat(format,{literal:function(lit){result+=lit},H:function(repeat){switch(repeat){case 1:result+=self.hour;break;case 2:result+=_pad2(self.hour);break;default:throw new Error(locale.text("time.formatH",repeat))}},h:function(repeat){switch(repeat){case 1:var hour=self.hour;hour===0?result+=12:result+=hour>12?hour-12:hour;break;case 2:var hour=self.hour;hour===0?result+=12:result+=hour>12?_pad2(hour-12):_pad2(hour);break;default:throw new Error(locale.text("time.formath",repeat))}},m:function(repeat){switch(repeat){case 2:result+=_pad2(self.minute);break;default:throw new Error(locale.text("time.formatm",repeat))}},s:function(repeat){switch(repeat){case 2:result+=_pad2(self.second);break;default:throw new Error(locale.text("time.formats",repeat))}},t:function(repeat){switch(repeat){case 1:result+=self.hour<12?_amDesignator().substring(0,1):_pmDesignator().substring(0,1);break;case 2:result+=self.hour<12?_amDesignator():_pmDesignator();break;default:throw new Error(locale.text("time.formata",repeat))}}}),result},secondsDiff:function(t){return this._value-t._value},addHours:function(hours){return hours==0?this:new Time(this._value+hours*3600)},addMinutes:function(minutes){return minutes==0?this:new Time(this._value+minutes*60)},addSeconds:function(seconds){return seconds==0?this:new Time(this._value+seconds)},add:function(delta){return this.addHours(delta.hours||0).addMinutes(delta.minutes||0).addSeconds(delta.seconds||0)},isNull:function(){return this._value==0}}),exports.make=_make,exports.fromSeconds=function(seconds){return new Time(seconds)},exports.fromJsDate=function(js,utc){return utc?_make(js.getUTCHours(),js.getUTCMinutes(),js.getUTCSeconds()):_make(js.getHours(),js.getMinutes(),js.getSeconds())},exports.now=function(utc){return exports.fromJsDate(new Date,utc)},exports.parse=function(str,format){if(str==null)throw new Error(locale.text("time.isNull"));if(format==null){if(str.length!=5&&str.length!=8)throw new Error(locale.text("time.badFormat",str));var value=str.length==8?_parse2(str,0,2)*3600+_parse2(str,3,5)*60+_parse2(str,6,8):_parse2(str,0,2)*3600+_parse2(str,3,5)*60;return new Time(value)}return _parse(str,format)},exports.amDesignator=_amDesignator,exports.pmDesignator=_pmDesignator}),define("syracuse-tablet/html/js/helpers/types/datetime",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/types/date","syracuse-tablet/html/js/helpers/types/time","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _pad2(val){var s=val.toString();return s.length==1?"0"+s:s}function _pad3(val){var s=val.toString();switch(s.length){case 1:return"00"+s;case 2:return"0"+s;default:return s}}function Datetime(value,tzOffset){this._value=value,tzOffset!=null&&(this._tzOffset=tzOffset)}function _ms(dt){return(dt._value+63072e9)%1e3}function _utc(dt){var utc=dt._utc;if(!utc){var d=new Date(dt._value);utc=d.getUTCFullYear()*1e4*1e5+(d.getUTCMonth()+1)*100*1e5+d.getUTCDate()*1e5+d.getUTCHours()*3600+d.getUTCMinutes()*60+d.getUTCSeconds(),d._utc=utc}return utc}function _local(dt){var local=dt._local;if(!local){var d=new Date(dt._value);local=d.getFullYear()*1e4*1e5+(d.getMonth()+1)*100*1e5+d.getDate()*1e5+d.getHours()*3600+d.getMinutes()*60+d.getSeconds(),d._local=local}return local}function _formatTzOffset(offset,len){var s="-";offset<0&&(s="+",offset=-offset);var hr=Math.round(offset/60),min=offset-hr*60;return s+=len>1?_pad2(hr):hr,s+=len>2||min?":"+(len>1?_pad2(min):min):"",s}function _parseIso(str){var year=0,month=0,day=0,hours=0,minutes=0,seconds=0,ms=0,offset=0,convertError=!0,d=/(\d{4})-(\d{2})-(\d{2})([T\s]?)(\d{2})?(:)?(\d{2})?(:)?(\d{2})?(\.(\d{3}))?(Z)?(([+-])(\d{2}))?(.*$)/.exec(str);if(d){convertError=!1,year=+d[1],month=d[2]-1,day=+d[3],hours=+(d[5]||0),minutes=+(d[7]||0),seconds=+(d[9]||0),ms=+(d[11]||0);if(d[12]==="Z"){d[14]==="-"?offset=(d[15]||0)*60:d[14]==="+"&&(offset=-(d[15]||0)*60);var utc=Date.UTC(year,month,day,hours,minutes+offset,seconds,ms);return new Datetime(utc)}var jsDate=new Date(year,month,day,hours,minutes+offset,seconds,ms);return new Datetime(jsDate.getTime(),jsDate.getTimezoneOffset())}if(convertError)throw new Error(locale.text("datetime.noParse",str))}function _make(year,month,day,hour,minute,second,millis){var jsDate=new Date(year,month-1,day,hour||0,minute||0,second||0,millis||0);return new Datetime(jsDate.getTime(),jsDate.getTimezoneOffset())}function _makeUtc(year,month,day,hour,minute,second,millis){var jsDate=new Date(Date.UTC(year,month-1,day,hour||0,minute||0,second||0,millis||0));return new Datetime(jsDate.getTime(),jsDate.getTimezoneOffset())}function _walkFormat(format,map){function count(i){var ch=format[i],k=1;while(format[i+k]===ch)k++;return k}var i=0,len=format.length;while(i<len){var c=format[i];switch(c){case"'":i++;var literal="";for(;i<len;i++)if(format[i]==="'"){i++;if(format[i]!=="'")break;literal+="'"}else literal+=format[i];map.literal(literal);break;case"H":case"h":case"m":case"s":case"S":case"t":case"d":case"M":case"y":var repeat=count(i);map[c](repeat),i+=repeat;break;default:map.literal(c),i++}}}function _parse(str,format){function parseInteger(max){if(!/\d/.test(str[j]))throw new Error(locale.text("datetime.noNumber",str.substring[j]));var beg=j++;while(j<beg+max&&/\d/.test(str[j]))j++;return parseInt(str.substring(beg,j),10)}function parseName(names){for(var k=0;k<names.length;k++){var name=names[k],len=name.length;if(str.substring(j,j+len).toUpperCase()==name.toUpperCase())return j+=len,k}throw new Error(locale.text("datetime.unknown",str.substring(j)))}function from12to24(mode,index){switch(mode[index]){case mode[0]:hour=hour===12?0:hour;break;case mode[1]:hour>=1&&hour<=11&&(hour+=12)}}var day,weekday,month,year,hour,minute,second,millis,timeMode,abbrTimeMode,timeModes=[date.amDesignator(),date.pmDesignator()],abbrTimeModes=[timeModes[0].substring(0,1),timeModes[1].substring(0,1)],j=0;_walkFormat(format,{literal:function(literal){if(str.substring(j,j+literal.length)!==literal)throw new Error(locale.text("datetime.formatMis",literal,str.substring(j)));j+=literal.length},d:function(arg){switch(arg){case 1:case 2:day=parseInteger(2);break;case 3:weekday=parseName(_dateInfo().abbreviatedDayNames);break;case 4:weekday=parseName(_dateInfo().dayNames);break;default:throw new Error(locale.text("datetime.badDay",format.substring(j)))}},M:function(arg){switch(arg){case 1:case 2:month=parseInteger(2);break;case 3:month=parseName(_dateInfo().abbreviatedMonthNames)+1;break;case 4:month=parseName(_dateInfo().monthNames)+1;break;default:throw new Error(locale.text("datetime.badDay",format.substring(j)))}},y:function(arg){switch(arg){case 2:year=parseInteger(2),year=year<40?2e3+year:1900+year;break;case 4:year=parseInteger(4),year=year>99?year:year<40?2e3+year:1900+year;break;default:throw new Error(locale.text("datetime.badYear",format.substring(j)))}},H:function(arg){switch(arg){case 1:case 2:hour=parseInteger(2);break;default:throw new Error(locale.text("datetime.badHour",format.substring(j)))}},h:function(arg){switch(arg){case 1:case 2:hour=parseInteger(2);break;default:throw new Error(locale.text("datetime.badHour",format.substring(j)))}},m:function(arg){switch(arg){case 2:minute=parseInteger(2);break;default:throw new Error(locale.text("datetime.badMin",format.substring(j)))}},s:function(arg){switch(arg){case 2:second=parseInteger(2);break;default:throw new Error(locale.text("datetime.badSec",format.substring(j)))}},t:function(arg){switch(arg){case 1:abbrTimeMode=parseName(abbrTimeModes);break;case 2:timeMode=parseName(timeModes);break;default:throw new Error(locale.text("datetime.badMarker",format.substring(j)))}}});if(timeMode!=null||abbrTimeMode!=null){if(hour>12)throw new Error(locale.text("datetime.badHourVal",hour,timeMode));var mode=timeMode!=null?timeModes:abbrTimeModes,index=timeMode!=null?timeMode:abbrTimeMode;from12to24(mode,index)}return _make(year,month,day,hour,minute,second,millis)}function _getIndexOfZ(format){function count(i){var ch=format[i],k=1;while(format[i+k]===ch)k++;return k}var i=0,len=format.length;while(i<len){var c=format[i];if(c==="'"){i++;var literal="";for(;i<len;i++)if(format[i]==="'"){i++;if(format[i]!=="'")break;literal+="'"}else literal+=format[i]}else{if(c==="Z")return i;i++}}}var utils=require("syracuse-tablet/html/js/helpers/utils"),date=require("syracuse-tablet/html/js/helpers/types/date"),time=require("syracuse-tablet/html/js/helpers/types/time"),locale=require("syracuse-tablet/html/js/helpers/locale"),_dateInfo=locale.getDatetimeInfo;exports.validate=function(value,constraints,errors){if(value==null){if(constraints.$isMandatory)return errors.push(locale.text("datetime.valMand"));if(!constraints.$isNullable)return errors.push(locale.text("datetime.valNull"));return}if(!(value instanceof Datetime)){errors.push(locale.text("datetime.valDT"));return}if(!(value.month>=1&&value.month<=12)){errors.push(locale.text("datetime.valMon"));return}if(!(value.day>=1&&value.day<=date.daysInMonth(value.year,value.month))){errors.push(locale.text("datetime.valDay"));return}},exports.Datetime=utils.defineClass(Datetime,null,{date:{get:function(){return date.fromInternalValue(Math.floor(_local(this)/1e5))}},time:{get:function(){return time.fromSeconds(_local(this)%1e5)}},year:{get:function(){return this.date.year}},month:{get:function(){return this.date.month}},day:{get:function(){return this.date.day}},weekDay:{get:function(){return this.date.weekDay}},yearDay:{get:function(){return this.date.yearDay}},hour:{get:function(){return this.time.hour}},minute:{get:function(){return this.time.minute}},second:{get:function(){return this.time.second}},millisecond:{get:function(){return _ms(this)}},utcDate:{get:function(){return date.fromInternalValue(Math.floor(_utc(this)/1e5))}},utcTime:{get:function(){return time.fromSeconds(_utc(this)%1e5)}},utcYear:{get:function(){return this.utcDate.year}},utcMonth:{get:function(){return this.utcDate.month}},utcDay:{get:function(){return this.utcDate.day}},utcWeekDay:{get:function(){return this.utcDate.weekDay}},utcYearDay:{get:function(){return this.utcDate.yearDay}},utcHour:{get:function(){return this.utcTime.hour}},utcMinute:{get:function(){return this.utcTime.minute}},utcSecond:{get:function(){return this.utcTime.second}},utcMillisecond:{get:function(){return _ms(this)}},value:{get:function(){return this._value}},timezoneOffset:{get:function(){return this._tzOffset==null&&(this._tzOffset=this.toJsDate().getTimezoneOffset()),this._tzOffset}},compare:function(dt){return this._value-dt._value},equals:function(dt){return this._value===dt._value},between:function(begin,end){return begin._value<=this._value&&this._value<=end._value},addYears:function(years){return this.date.addYears(years).at(this.time,this.millisecond)},addMonths:function(months){return this.date.addMonths(months).at(this.time,this.millisecond)},addWeeks:function(weeks){return this.date.addWeeks(weeks).at(this.time,this.millisecond)},addDays:function(days){return this.date.addDays(days).at(this.time,this.millisecond)},addHours:function(hours){return new Datetime(this._value+hours*3600*1e3)},addMinutes:function(minutes){return new Datetime(this._value+minutes*60*1e3)},addSeconds:function(seconds){return new Datetime(this._value+seconds*1e3)},addMilliseconds:function(millis){return new Datetime(this._value+millis)},addDayFractions:function(fraction){return new Datetime(this._value+fraction*86400*1e3)},millisDiff:function(dt){return this._value-dt._value},begOfMonth:function(){return _make(this.year,this.month,1)},begOfWeek:function(startDay){var delta=this.weekDay-(startDay||0);return delta==0?this:delta>0?this.addDays(-delta):this.addDays(-delta-7)},add:function(delta){return this.addYears(delta.years||0).addMonths(delta.months||0).addWeeks(delta.weeks||0).addDays(delta.days||0).addHours(delta.hours||0).addMinutes(delta.minutes||0).addSeconds(delta.seconds||0).addMillis(delta.millis||0)},toString:function(format){var self=this;if(format==null)return(new Date(this._value)).toISOString();var utc=_getIndexOfZ(format),_date=utc?self.utcDate:self.date,_time=utc?self.utcTime:self.time,result="";return _walkFormat(format,{literal:function(lit){result+=lit},H:function(repeat){switch(repeat){case 1:result+=_time.hour.toString();break;case 2:result+=_pad2(_time.hour);break;default:throw new Error(locale.text("datetime.formatH",repeat))}},h:function(repeat){switch(repeat){case 1:result+=_time.hour<13?_time.hour:_time.hour-12;break;case 2:result+=_pad2(_time.hour<13?_time.hour:_time.hour-12);break;default:throw new Error(locale.text("datetime.formath",repeat))}},m:function(repeat){switch(repeat){case 2:result+=_pad2(_time.minute);break;default:throw new Error(locale.text("datetime.formatm",repeat))}},s:function(repeat){switch(repeat){case 2:result+=_pad2(self.second);break;default:throw new Error(locale.text("datetime.formats",repeat))}},t:function(repeat){switch(repeat){case 1:result+=self.hour<12?_dateInfo().amDesignator.substring(0,1):_dateInfo().pmDesignator.substring(0,1);break;case 2:result+=self.hour<12?_dateInfo().amDesignator:_dateInfo().pmDesignator;break;default:throw new Error(locale.text("datetime.formata",repeat))}},d:function(repeat){switch(repeat){case 1:result+=_date.day.toString();break;case 2:result+=_pad2(_date.day);break;case 3:result+=date.dayName(_date.weekDay,!0);break;case 4:result+=date.dayName(_date.weekDay);break;default:throw new Error(locale.text("datetime.formatd",repeat))}},M:function(repeat){switch(repeat){case 1:result+=_date.month.toString();break;case 2:result+=_pad2(_date.month);break;case 3:result+=date.monthName(_date.month,!0);break;case 4:result+=date.monthName(_date.month);break;default:throw new Error(locale.text("datetime.formatM",repeat))}},y:function(repeat){switch(repeat){case 2:result+=_date.year.toString().substring(2,4);break;case 4:result+=_date.year.toString();break;default:throw new Error(locale.text("datetime.formaty",repeat))}},S:function(repeat){repeat===3?result+=_pad3(self.millisecond):new Error(locale.text("datetime.formatS",repeat))}}),result},toJsDate:function(){return new Date(this._value)},withoutTimezoneOffset:function(){return new Datetime(this._value)},isNull:function(){return this._value==0}}),exports.now=function(withMillis){var jsDate=new Date,millis=jsDate.getTime();return withMillis||(millis=Math.floor(millis/1e3)*1e3),new Datetime(millis,jsDate.getTimezoneOffset())},exports.parse=function(str,format){if(str==null)throw new Error(locale.text("datetime.isNull"));return format==null?_parseIso(str):_parse(str,format)},exports.fromJsDate=function(jsDate){return new Datetime(jsDate.getTime(),jsDate.getTimezoneOffset())},exports.isDatetime=function(obj){return obj instanceof Datetime},exports.fromInternalValue=function(value){return new Datetime(value)},exports.dayName=function(weekDay,abbrev){return abbrev?_dateInfo().abbreviatedDayNames[weekDay]:_dateInfo().dayNames[weekDay]},exports.monthName=function(month,abbrev){return abbrev?_dateInfo().abbreviatedMonthNames[month-1]:_dateInfo().monthNames[month-1]},exports.make=_make,exports.makeUtc=_makeUtc,date.make(1,1,1).constructor.prototype.at=function(time,millisecond){return exports.make(this.year,this.month,this.day,time.hour,time.minute,time.second,millisecond)},exports.sunday=0,exports.Sunday=0,exports.monday=1,exports.Monday=1,exports.tuesday=2,exports.Tuesday=2,exports.wednesday=3,exports.Wednesday=3,exports.thursday=4,exports.Thursday=4,exports.friday=5,exports.Friday=5,exports.saturday=6,exports.Saturday=6,exports.walkFormat=_walkFormat}),define("syracuse-tablet/html/js/helpers/types/numberFormat",["require","exports","module","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function FormatObj(prefix,postfix,properties){this.prefix=prefix,this.postfix=postfix,this.properties=properties}function _processDirective(directive,fObj){var f=new FormatObj(fObj.prefix,fObj.postfix,fObj.properties),hasDecimalSeparator,hasGroupSeparator,dsIndex=directive.indexOf("."),gsIndex=directive.indexOf(",");f.properties.hasDecimalSeparator=hasDecimalSeparator=dsIndex>-1,f.properties.hasGroupSeparator=hasGroupSeparator=gsIndex>-1;if(hasDecimalSeparator){var decimal=directive.substring(dsIndex+1);f.properties.mandatoryAfter=decimal.indexOf("0")>-1?decimal.match(/0/g).length:0,f.properties.maxAfter=decimal.length}hasGroupSeparator&&(f.properties.groupSize=hasDecimalSeparator?dsIndex-gsIndex-1:directive.substring(gsIndex+1).length);var integer=hasDecimalSeparator?directive.substring(0,dsIndex):directive;return f.properties.mandatoryBefore=integer.indexOf("0")>-1?integer.match(/0/g).length:0,f.properties.directive=directive,f.properties.hasPercent=directive.indexOf("%")>-1,f.properties.hasPermil=directive.indexOf("‰")>-1,f.properties.hasSignFormat=directive.indexOf("+")>-1&&directive.indexOf("+")===0,f}function _walkFormat(format,map){function count(i){var ch=format[i],k=1;while(validDir.indexOf(format[i+k])>-1)k++;return k}var i=0,len=format.length,validDir="0#.,%‰+";while(i<len){var c=format[i];switch(c){case"'":i++;var literal="";for(;i<len;i++)if(format[i]==="'"){i++;if(format[i]!=="'")break;literal+="'"}else literal+=format[i];map.literal(literal);break;case"0":case"#":case".":case"%":case"‰":case"+":var directiveLength=count(i);map.directive(i,i+directiveLength),i+=directiveLength;break;case";":map.listSeparator(),i++;break;default:map.literal(c),i++}i===len&&map.listSeparator()}}function _addSeparator(num,gs,size){var result="",len=num.length,c="",count=0;for(var i=len-1;i>=0;i--)c=num[i],result+=c,++count,count%size===0&&i>0&&(result+=gs);return result.split("").reverse().join("")}function _format(val,format){var prefix,postfix,j=0,formatsList=[],directiveProcessed=!1,f=new FormatObj("","",{});_walkFormat(format,{literal:function(literal){directiveProcessed?f.postfix+=literal:f.prefix+=literal},directive:function(beg,end){var directive=format.substring(beg,end);f=_processDirective(directive,f),directiveProcessed=!0},listSeparator:function(){directiveProcessed=!1,formatsList.push(f),f=new FormatObj("","",{}),prefix="",postfix=""}});var flen=formatsList.length;switch(flen){case 1:return _formatNumber(val,formatsList[0]);case 2:case 3:return val===0?_formatZero(formatsList[2]):val<0?_formatNumber(val.toString().substring(1),formatsList[1]):_formatNumber(val,formatsList[0]);default:throw new Error(flen===0?locale.text("numberFormat.noFormat"):locale.text("numberFormat.manyFormat"))}}function _formatZero(fObj){return fObj.prefix}function _formatNumber(num,fObj){var res="",gs=locale.getNumberGroupSeparator(),ds=locale.getNumberDecimalSeparator(),directive=fObj.properties.directive;num=fObj.properties.hasPercent?num*100:num,num=fObj.properties.hasPermil?num*1e3:num;if(directive==null)return num;if(fObj.properties.hasDecimalSeparator){var decimalPart="",maxAfter=fObj.properties.maxAfter,decimalFormat=directive.substr(directive.indexOf(".")+1,maxAfter),decimalValue=num%1,decimalString=""+decimalValue.toFixed(maxAfter);decimalString=decimalString.substring(decimalString.indexOf(".")+1);for(var i=0;i<maxAfter;i++){var f=decimalFormat.charAt(i),n=decimalString.charAt(i);if(f==="0")decimalPart+=n;else if(f==="#"&&n!=="0")decimalPart+=n;else if(f==="#"&&n==="0"){var notParsed=decimalString.substring(i);if(!notParsed.match("[1-9]"))break;decimalPart+=n}}res=decimalPart?ds+decimalPart:res}else num=Math.round(num);var intPart=num<0?""+Math.ceil(num):""+Math.floor(num);intPart=intPart.replace(/[^\d]+/g,"");var intFormat=directive.indexOf(".")===-1?directive:directive.substring(0,directive.indexOf("."));if(intPart.length<fObj.properties.mandatoryBefore){var missing=fObj.properties.mandatoryBefore-intPart.length,toAdd="";for(var i=0;i<missing;i++)toAdd+="0";intPart=toAdd+intPart}return fObj.properties.hasGroupSeparator&&fObj.properties.groupSize<intPart.length&&(intPart=_addSeparator(intPart,gs,fObj.properties.groupSize)),intPart=parseInt(intPart,10)===0&&fObj.properties.mandatoryBefore===0?"":intPart,intPart=intPart&&num<0?"-"+intPart:intPart,res=intPart+res,res=fObj.properties.hasSignFormat&&num>0?"+"+res:res,res+=fObj.properties.hasPercent?"%":"",res+=fObj.properties.hasPermil?"‰":"",fObj.prefix+res+fObj.postfix}function _parse(str,format){var prefix,postfix,j=0,formatsList=[],directiveProcessed=!1,f=new FormatObj("","",{});return _walkFormat(format,{literal:function(literal){directiveProcessed?f.postfix+=literal:f.prefix+=literal},directive:function(beg,end){var directive=format.substring(beg,end);f=_processDirective(directive,f),directiveProcessed=!0},listSeparator:function(){directiveProcessed=!1,formatsList.push(f),f=new FormatObj("","",{}),prefix="",postfix=""}}),_parseFormats(str,formatsList)}function _parseFormats(str,formatsList,negative){var flen=formatsList.length,num,gs=locale.getNumberGroupSeparator(),ds=locale.getNumberDecimalSeparator();switch(flen){case 1:var fObj=formatsList[0],formatNumber=str,integerPart,decimalPart,prefix=fObj.prefix,postfix=fObj.postfix;formatNumber=prefix?formatNumber.substring(prefix.length):formatNumber,formatNumber=postfix?formatNumber.substring(0,formatNumber.length-postfix.length):formatNumber;var splitted=formatNumber.split(ds);if(splitted.length>2)throw new Error(locale.text("numberFormat.oneSep",formatNumber));integerPart=splitted[0]?splitted[0].match(/[0-9]/g).join(""):"0",decimalPart=splitted.length>1?splitted[1].match(/[0-9]/g).join(""):"",num=parseFloat(decimalPart?integerPart+"."+decimalPart:integerPart),num=formatNumber.charAt(0)==="-"?parseFloat("-"+num):num,num=fObj.properties.hasPercent?num/100:num,num=fObj.properties.hasPermil?num/1e3:num,num=negative?parseFloat("-"+num):num;break;case 2:case 3:var validFormat="1234567890"+ds+gs+"%‰-+",len=formatsList.length,slen=str.length;for(var i=0;i<len;i++){var f=formatsList[i],prefix=f.prefix,postfix=f.postfix,prefixDefined=prefix?!0:!1,postfixDefined=postfix?!0:!1,pre,post;pre=prefixDefined?str.substring(0,prefix.length):"",post=postfixDefined?str.substring(slen-postfix.length):"";if(prefixDefined&&!postfixDefined&&pre.indexOf(prefix)>-1||prefixDefined&&postfixDefined&&pre.indexOf(prefix)>-1&&post.indexOf(postfix)>-1||!prefixDefined&&postfixDefined&&post.indexOf(postfix)>-1||!prefixDefined&&!postfixDefined&&validFormat.indexOf(str.charAt(0))>-1&&validFormat.indexOf(str.charAt(slen-1))>-1)break}var flist=[];flist.push(formatsList[i]);switch(i){case 0:num=_parseFormats(str,flist);break;case 1:num=_parseFormats(str,flist,!0);break;case 2:num=0;break;default:throw new Error(locale.text("numberFormat.cannotParse"))}break;default:throw new Error(flen===0?locale.text("numberFormat.noFormat"):locale.text("numberFormat.manyFormats"))}return num}var locale=require("syracuse-tablet/html/js/helpers/locale");exports.format=function(val,format){if(isNaN(val))throw new Error(locale.text("numberFormat.notNumber",val));if(format==null){val=val.toString();var dsIndex=val.indexOf("."),hasDecimal=dsIndex>-1,intPart=hasDecimal?val.substring(0,dsIndex):val,decimalPart=hasDecimal?val.substring(dsIndex+1):"",gs=locale.getNumberGroupSeparator()||"",ds=hasDecimal?locale.getNumberDecimalSeparator()||".":"";return _addSeparator(intPart,gs,3)+ds+decimalPart}return _format(val,format)},exports.parse=function(str,format){return str?format==null?parseFloat(str):_parse(str,format):0}}),define("syracuse-tablet/html/js/helpers/formatApi",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/types/date","syracuse-tablet/html/js/helpers/types/datetime","syracuse-tablet/html/js/helpers/types/time","syracuse-tablet/html/js/helpers/types/numberFormat"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),date=require("syracuse-tablet/html/js/helpers/types/date"),datetime=require("syracuse-tablet/html/js/helpers/types/datetime"),time=require("syracuse-tablet/html/js/helpers/types/time"),numberFormat=require("syracuse-tablet/html/js/helpers/types/numberFormat"),_cache={},_cacheLocaleHash;exports.getFormatter=function($type,$format){if($format=="$url")return null;var ctor=_formatters[$type];if(!ctor)return null;var curLocaleHash=locale.getCurrentLocaleHash();curLocaleHash!==_cacheLocaleHash&&(_cacheLocaleHash=curLocaleHash,_cache={});var cache=_cache[$type];cache||(cache=_cache[$type]={});var key=$format||"noformat",fmt=cache[key];return fmt?fmt:(fmt=new ctor($type,$format),cache[key]=fmt,fmt)};var Formatter=utils.defineClass(function($type,$format){this.$format=$format,this.$type=$type},null,{_isEmpty:function(value){return value==null?!0:(value=""+value,value=value.trim(),value===""?!0:!1)},formatValue:function(value,editMode){return value},formatValueEdit:function(value){return this.formatValue(value,!0)},parseValue:function(value,errors){errors.push("No parser for this type, return this dummy error to not override value by null")},getFormat:function(){return this.format}}),DateFormatter=utils.defineClass(function($type,$format){Formatter.call(this,$type,$format),this.format=locale.getDateFormat(),this.twoDigitYearSwitch=40},Formatter,{_isEmpty:function(value){return value==null?!0:(value=""+value,value=value.trim(),value===""?!0:value==="0000-00-00"?!0:!1)},_checkShortYear:function(year){if(year.year){var y=year.year;y<100&&year.add({years:y<this.twoDigitYearSwitch?2e3:1900})}else year=year>99?year:year<this.twoDigitYearSwitch?2e3+year:1900+year;return year},formatValue:function(value,editMode){if(this._isEmpty(value))return"";var p=value.split(/[^\d]+/),format;if(p.length>=3){p[0]=this._checkShortYear(+p[0]);var d=date.make(+p[0],+p[1],+p[2]);format=d.toString(this.format)}else format=value;return format},parseValue:function(value,errors){var fmt;if(this._isEmpty(value))return"";try{fmt=date.parse(value,this.format),fmt=this._checkShortYear(fmt)}catch(e){return errors.push(locale.text("field.invalidInput",[this.format])),value}return fmt.toString("yyyy-MM-dd")},validateValue:function(value,errors){var fmt;if(this._isEmpty(value))return"";try{fmt=date.parse(value,this.format),date.validate(fmt,{},errors)}catch(e){errors.push(locale.text("field.invalidInput",[this.format]))}return errors.length===0}}),DateTimeFormatter=utils.defineClass(function($type,$format){DateFormatter.call(this,$type,$format),this.format=locale.getDateTimeFormat()},DateFormatter,{_isEmpty:function(value){return value==null?!0:(value=""+value,value=value.trim(),value===""?!0:value==="0000-00-00T00:00:00Z"?!0:!1)},formatValue:function(value,editMode){if(this._isEmpty(value))return editMode===!0?datetime.now().toString(this.format):"";var p=value.split(/[^\d]+/),format;if(p.length>=6){p[0]=this._checkShortYear(+p[0]);var d=datetime.make(+p[0],+p[1],+p[2],+p[3],+p[4],+p[5]);format=d.toString(this.format)}else format=value;return format},parseValue:function(value,errors){var fmt;if(this._isEmpty(value))return"";try{fmt=datetime.parse(value,this.format),fmt=this._checkShortYear(fmt)}catch(e){return errors.push(locale.text("field.invalidInput",[this.format])),value}return fmt.toString("yyyy-MM-ddTHH:mm:ss.SSS")+"Z"}}),TimeFormatter=utils.defineClass(function($type,$format){Formatter.call(this,$type,$format),this.$format==="TT"?this.format=locale.getTimeFormat():this.format=locale.getTimeFormatShort()},Formatter,{formatValue:function(value,editMode){if(this._isEmpty(value))return"";var p=value.split(/[^\d]+/),format;if(p.length>=2){var t=time.make(+p[0],+p[1],+p[2]);format=t.toString(this.format)}else format=value;return format},parseValue:function(value,errors){if(this._isEmpty(value))return"";var p=value.split(/[^\d]+/);if(p.length>=1){var t=time.make(+p[0],+p[1],+p[2]);return t.toString("HH:mm:ss")}}}),NumberFormatter=utils.defineClass(function($type,$format){Formatter.call(this,$type,$format),this.format=this.$format||locale.getNumberFormat(this.$type)},Formatter,{formatValue:function(value,editMode){if(this._isEmpty(value))return"";var format=numberFormat.format(value,this.format);return format},parseValue:function(value,errors){if(this._isEmpty(value))return"";try{var fmt=numberFormat.parse(value,this.format)}catch(e){return errors.push(locale.text("field.invalidInput",[this.format])),value}return fmt}}),_formatters={"application/x-integer":NumberFormatter,"application/x-decimal":NumberFormatter,"application/x-real":NumberFormatter,"application/x-date":DateFormatter,"application/x-time":TimeFormatter,"application/x-datetime":DateTimeFormatter}}),define("syracuse-tablet/html/js/controls/validator",["require","exports","module","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var locale=require("syracuse-tablet/html/js/helpers/locale"),_validator={validate:function(ctrl,value,errors,constraints){var proto=ctrl.prototype,ok=!0;for(var i=0;i<constraints.length;i++){var c=constraints[i],prop=null;ctrl&&ctrl.getMetaData&&(prop=ctrl.getMetaData(c));if(prop!=null){var fn=_validator[c];fn?ok=fn(value,errors,prop)&&ok:(errors.push({$severity:"error",$message:locale.text("field.unknownConstraint",[c])}),ok=!1)}}return ok},$isMandatory:function(value,errors,constraint){return!constraint||value!=null&&value!==""?!0:(errors.push({$severity:"error",$message:locale.text("field.valMand")}),!1)},$pattern:function(value,errors,constraint){var self=this;if(value&&constraint){var re=new RegExp(constraint);if(!re.test(value))return errors.push({$severity:"error",$message:locale.text("field.patternError",[constraint])}),!1}return!0},$minimum:function(value,errors,constraint){var self=this;return value!=null&&value<constraint?(errors.push({$severity:"error",$message:locale.text("field.minimum",[constraint])}),!1):!0},$maximum:function(value,errors,constraint){var self=this;return value!=null&&value>constraint?(errors.push({$severity:"error",$message:locale.text("field.maximum",[constraint])}),!1):!0},$exclusiveMinimum:function(value,errors,constraint){var self=this;return value!=null&&value<=constraint?(errors.push({$severity:"error",$message:locale.text("field.exclusiveMinimum",[constraint])}),!1):!0},$exclusiveMaximum:function(value,errors,constraint){var self=this;return value!=null&&value>=constraint?(errors.push({$severity:"error",$message:locale.text("field.exclusiveMaximum",[constraint])}),!1):!0},$minLength:function(value,errors,constraint){var self=this;return!value||value.length<constraint?(errors.push({$severity:"error",$message:locale.text("field.minLength",[constraint])}),!1):!0},$maxLength:function(value,errors,constraint){var self=this;return value&&value.length>constraint?(errors.push({$severity:"error",$message:locale.text("field.maxLength",[constraint])}),!1):!0},$precision:function(value,errors,constraint){var self=this;if(value){var txt=(""+value).split(".").join("");if(txt.length>constraint)return errors.push({$severity:"error",$message:locale.text("field.precision",[constraint])}),!1}return!0},$scale:function(value,errors,constraint){var self=this;if(value){var txt=(""+value).split(".");txt=txt&&txt[1]||"";if(txt.length>constraint)return errors.push({$severity:"error",$message:locale.text("field.scale",[constraint])}),!1}return!0}};exports.Validator=_validator}),define("syracuse-tablet/html/js/ui/fontUtils",["require","exports","module"],function(require,exports,module){var _paginBtns={$first:"glyphicon glyphicon-step-backward",$previous:"glyphicon glyphicon-chevron-left",$next:"glyphicon glyphicon-chevron-right",$last:"glyphicon glyphicon-step-forward"},_tileIcons=["adjust","adn","ambulance","anchor","android","angellist","apple","archive","asterisk","automobile","ban","bank","barcode","bell","bicycle","binoculars","bitbucket","bolt","book","bookmark","briefcase","building","bullhorn","bullseye","calculator","calendar","camera","certificate","chain","child","circle","clipboard","codepen","cog","cogs","columns","compass","dashboard","database","envelope","exclamation","eye","fax","file","flag","flash","folder","globe","heart","home","image","inbox","info","institution","key","laptop","leaf","legal","lock","magic","money","paperclip","phone","plane","rocket","search","shield","sitemap","sliders","star","steam","stethoscope","stop","suitcase","th","tumblr","twitch","twitter","umbrella","warning","wrench"],_getIconByName=function(name){switch(name){case"$multiSelection":return"glyphicon glyphicon-list-alt";case"$cancelMultiSel":case"$cancelEdit":return"fa fa-undo";case"$edit":return"fa fa-edit";case"$query":return"fa fa-list";case"$save":return"fa fa-save";case"$details":return"fa fa-level-down";case"$delete":return"fa fa-trash-o";case"$create":return"fa fa-plus-square";case"$image-sign":return"fa fa-pencil";case"$image-camera":return"fa fa-camera";case"$image-ink":return"fa fa-paint-brush";case"appUpdate":return"fa fa-history";case"appSetup":return"fa fa-download";case"gear":return"fa fa-gear";case"expand":return"fa fa-expand";case"compress":return"fa fa-compress";case"GPSPicker":return"fa fa-dot-circle-o";case"scanBarcodePicker":return"fa fa-barcode";case"penTextInputPicker":return"fa fa-pencil-square-o";case"$apply":return"fa fa-check";case"$refresh":return"fa fa-save";case"lookupPicker":return"glyphicon glyphicon-eye-open";case"datePicker":return"glyphicon glyphicon-calendar";case"timePicker":return"glyphicon glyphicon-time";case"clientTestApplication":return"fa fa-th"}return _tileIcons.indexOf(name)>-1?"fa fa-"+name:""};exports.getIconByName=_getIconByName,exports.checkBoxIcon=function(val){return["glyphicon",val?"glyphicon-ok":"glyphicon-remove"]},exports.phoneFieldIcon=function(){return"fa fa-phone"},exports.emailFieldIcon=function(){return"fa fa-envelope-o"},exports.documentFieldIcon=function(){return"fa fa-file-text"},exports.binaryFieldIcon=function(){return"fa fa-file-0"},exports.paginationIcon=function(linkName){return _paginBtns[linkName]},exports.layoutExpandCollapseIcon=function(collapse,advancedTheme){return collapse?advancedTheme?"fa fa-ellipsis-h":"fa fa-chevron-down":advancedTheme?"fa fa-times":"fa fa-chevron-up"},exports.dashboardIcon=function(name){if(name==="removeTile")return"fa fa-trash-o";if(name==="editTile")return"fa fa-pencil";if(name==="moveTile")return"fa fa-sitemap";if(name==="dashboardList")return"fa fa-list-ul";if(name==="templateList")return"fa fa-list-ul";if(name==="addGroup")return"fa fa-sitemap";if(name==="addHiddenTile")return"fa fa-th-large";if(name==="moveGroupAfter")return"fa fa-arrow-left";if(name==="moveGroupBefore")return"fa fa-arrow-right";if(name==="removeGroup")return"fa fa-trash-o";if(name==="emptyTile")return"fa fa-exclamation-triangle"},exports.tableActionIcon=function(name){return name==="rowEdit"?"fa fa-pencil-square-o":name==="rowDetail"?"fa fa-hand-o-right":name==="rowDelete"?"fa fa-remove":name==="rowAdd"?"fa fa-plus":"fa fa-question"},exports.sortIcon=function(name){if(name==="asc")return"fa fa-long-arrow-up";if(name==="none")return"fa fa-times";if(name==="desc")return"fa fa-long-arrow-down"},exports.filterIcon=function(name){if(name==="panel")return"fa fa-bars";if(name==="filtered")return"fa fa-filter";if(name==="edit")return"fa fa-pencil";if(name==="delete")return"fa fa-times";if(name==="separator")return"fa fa-plus"},exports.sortFilterTab=function(name){if(name==="sort")return"fa fa-arrows-v";if(name==="filter")return"fa fa-filter";if(name==="memo")return"fa fa-star";if(name==="apply")return"fa fa-check"},exports.getTileIconList=function(){return _tileIcons};var _arrayStatusIconNames=["thumbs-down","thumbs-o-down","thumbs-up","thumbs-o-up","hand-o-down","hand-o-up","lock","unlock","unlock-alt","smile-o","meh-o","check","check-circle","check-circle-o","check-square","check-square-o","square","square-o","circle","circle-thin","circle-o","close","comment","comment-o","comments","comments-o","photo","film","barcode","bars","plus","plus-circle","plus-square","plus-square-o","minus","minus-circle","minus-square","minus-square-o","question","question-circle","trash","trash-o","info","info-circle","flag","flag-checkered","flag-o","female","male","mars","venus","user","users","user-plus","user-times","user-secret","facebook-official","file","file-o","dollar","eur","gbp","yen","rub","rupee","shekel","cny","ils","inr","krw","money","turkish-lira","won","envelope-square","envelope-o","envelope","exclamation","exclamation-circle","exclamation-triangle"],_arrayStatusIcons=null,_getArrayStatusIconList=function(){return _arrayStatusIcons==null&&(_arrayStatusIcons=[],_arrayStatusIconNames.forEach(function(name){_arrayStatusIcons.push({css:"fa fa-"+name,name:name})})),_arrayStatusIcons};exports.getArrayStatusIconList=_getArrayStatusIconList,exports.getArrayStatusDefIcon=function(){return{name:"circle",css:"fa fa-circle"}};var _arrayActionsIconNames=_arrayStatusIconNames.slice(0),_arrayActionsIcons=null,_getPageActionIcon=function(){return _arrayActionsIcons==null&&(_arrayActionsIconNames=_arrayActionsIconNames.concat(["download","save","undo","edit","history","eraser","reply","refresh"]),_arrayActionsIcons=[],_arrayActionsIconNames.forEach(function(name){_arrayActionsIcons.push({css:"fa fa-"+name,name:name})})),_arrayActionsIcons};exports.getPageActionIcon=_getPageActionIcon;var _emptyImageIconNames=["image","user","users","warning","file-movie-o","file-image-o","paperclip","film"],_emptyImageIcons=null;exports.getEmptyImageIconList=function(){return _emptyImageIcons==null&&(_emptyImageIcons=[],_emptyImageIconNames.forEach(function(name){_emptyImageIcons.push({css:"fa fa-"+name,name:name})})),_emptyImageIcons},exports.getEmptyImageDefIcon=function(){return{name:"image",css:"fa fa-image"}},exports.getEmptyFileDefIcon=function(){return{name:"file",css:"fa fa-file"}};var _urlIconNames=["globe","map-marker","street-view","road","link","cloud","database","bed","cutlery","glass","train","subway","taxi","ship","plane"],_urlIcons=null;exports.getUrlIconList=function(){return _urlIcons==null&&(_urlIcons=[],_urlIconNames.forEach(function(name){_urlIcons.push({css:"fa fa-"+name,name:name})})),_urlIcons},exports.getUrlDefIcon=function(){return{name:"Url",css:"fa fa-globe"}};var _colImageIconNames=["image","user","users","warning","file-movie-o","file-image-o","paperclip","film"],_colImageIcons=null;exports.getColImageIconList=function(){return _colImageIcons==null&&(_colImageIcons=[],_colImageIconNames.forEach(function(name){_colImageIcons.push({css:"fa fa-"+name,name:name})})),_colImageIcons},exports.getColImageDefIcon=function(emptyImage){return{name:"image",css:emptyImage===!0?"fa fa-times":"fa fa-image"}},exports.getCarouselIcon=function(what){return what=="left"?"glyphicon glyphicon-chevron-left":what=="right"?"glyphicon glyphicon-chevron-right":""};var _panelActionIconMap={home:"fa fa-home",pin:"fa fa-star-o",unpin:"fa fa-star",openactionspanel:"fa fa-ellipsis-h",switchContext:"fa fa-caret-down",mail:"fa fa-envelope",share:"fa fa-share-alt",settings:"fa fa-gear",about:"fa fa-info-circle",development:"fa fa-wrench",logout:"fa fa-sign-out",drafts:"fa fa-building-o",designPage:"fa fa-thumb-tack",nativeShare:"fa fa-share-alt",accept:"fa fa-check",cancel:"fa fa-reply",$save:"fa fa-save",$edit:"fa fa-edit",$delete:"fa fa-trash-o",$create:"fa fa-plus-square",$query:"fa fa-list",multiSelection:"fa fa-arrow-left",multiSelectionRunExit:"fa fa-times",multiSelectionRunStop:"fa fa-stop",search:"fa fa-search",sortFilter:"fa fa-filter",pageConfig:"fa fa-pencil",addGroup:"fa fa-sitemap",myDashboardTemplates:"fa fa-list-ul",myAvailableTemplates:"fa fa-list-ul",myDashboard:"fa fa-chevron-left",showEditTemplates:"fa fa-file-text-o",showEditTemplatesEmpty:"fa fa-file-o",draftsRunStop:"fa fa-stop",draftsRunSynch:"fa fa-upload",draftsRemove:"fa fa-trash"};exports.panelActionIcon=function(name){return _panelActionIconMap[name]||""}}),define("syracuse-tablet/html/js/sdata/datasetUtils",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),utils=require("syracuse-tablet/html/js/helpers/utils"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("DataProcessor",!1);exports.checkQueryFullPage=function(prototype,$linkName){if($linkName!=="$queryfullpage")return null;if(!prototype.root||!prototype.root.isFacet("$query"))throw new Error("$query facte expected for $queryfullpage link");return{$title:"$queryfullpage",$target:"",$type:"application/json;vnd.sage=syracuse",$method:"GET",$url:prototype.root.data("$url")}},exports.isDisabled=function(metaData){return metaData&&(metaData.$isReadOnly===!0||metaData.$isDisabled===!0)},exports.DataProcessor=function(){this._walkArray=function(o,operation,result){if(!o)return;var self=this;o.forEach(function(e){typeof e=="object"&&(operation&&operation.addRowId&&(e.$uuid=utils.UUID()),self._walk(e,operation,result))})},this._walkPlainObject=function(o,operation,result){if(!o)return;var p=Object.keys(o),e,name,walkInside;for(var ii=0,jj=p.length;ii<jj;ii++){name=p[ii],e=o[name],walkInside=!0;for(var opName in operation)this[opName]&&(walkInside=this[opName](operation[opName],o,name,result));walkInside&&typeof e=="object"&&this._walk(e,operation,result)}},this._walk=function(o,operation,result){if(!o||!operation)return;typeof o=="object"&&(Array.isArray(o)?this._walkArray(o,operation,result):$.isPlainObject(o)&&this._walkPlainObject(o,operation,result))},this.process=function(operation,data){var result;return log!=null&&(result={startTime:(new Date).getTime()}),this._walk(data,operation,result),log!=null&&result&&(log("getActionPayload - operations - Elsaped=",(new Date).getTime()-result.startTime,"ms"),log("Result: ",JSON.stringify(result,null,2))),result},this.renewAllIds=function(context,o,name,result){return typeof o=="object"&&o.$uuid&&(o.$uuid=utils.UUID()),!0}};var _datasetImplems={};exports.getImplementation=function(name){return _datasetImplems[name]},exports.setImplementation=function(klass){klass&&(_datasetImplems[jsutils.getClassName(klass)]=klass)},exports.templateAddRowId=function(data){var dataProcessor=new exports.DataProcessor;return dataProcessor.process({addRowId:{}},data),data},exports.renewAllIds=function(data){var dataProcessor=new exports.DataProcessor;return dataProcessor.process({renewAllIds:{}},data),data}}),define("syracuse-tablet/html/js/controls/fields/ctrlFieldBase",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/controls/validator","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/sdata/datasetUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,globals=require("syracuse-tablet/html/js/app/globals"),environment=require("syracuse-tablet/html/js/helpers/environment"),utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),validator=require("syracuse-tablet/html/js/controls/validator").Validator,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),modules=require("syracuse-tablet/html/js/common/modules"),native=require("syracuse-tablet/html/js/helpers/native/native"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("ctrlFieldBase",!1),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),_label_pos=["top","left"],_texr_align=["right","left","center"],_nativeCapabilityAutoring={scanBarcode:"$scanBarcode",GPS:"$scanGPS"};exports.CtrlFieldBase=utils.defineClass(function CtrlFieldBase(controller,article,prototype,options){Base.call(this,controller,article,prototype,options),options.noEdit===!0&&(this.$isEditMode=!1),this.formatter=formatApi.getFormatter(this.$type,this.prototype.getValueByPath("$format"))},Base,{destroy:function(){Base.prototype.destroy.call(this),this.formatter=null},onValueChanged:function(){this.refreshValue();var errors=[];this.validateValue(this.getValue(),errors),this.controller.setClientDiagnoses(this.$bind,errors),this.renderDiagnoses()},refreshValue:function(){if(!this.$$elmt)return;if(!this.$$value)return;this.buildFieldValue(),this.checkEmptyValue()},onMetaChanged:function(){if(!this.$$elmt)return!1;var meta=this.getMetaData();return this.applyMetaData(meta)},getValue:function(){var value=this.controller.getValue(this.$bind);return value},setValue:function(value){this.controller.setValue(this.$bind,value)},setFieldValue:function(value){this.setDisplayValue(this.getFormattedValue(value)),this.setValue(value)},setFieldValueFromSelector:function(value){this.$isEditMode&&this.clearClientDiagnoses(),this.setFieldValue(value)},getFormattedValue:function(value){if(!this.formatter)return value==null?"":new String(value);try{return this.$isEditMode===!0?this.formatter.formatValueEdit(value):this.formatter.formatValue(value)}catch(e){return this.controller.setClientDiagnoses(this.$bind,[{$severity:"error",$message:e.message}]),this.renderDiagnoses(),""}},parseValue:function(value,errors){return this.formatter?this.formatter.parseValue(value,errors):value},buildHtml:function(classes){classes=classes||[],classes.push("s-m-field"),this.cssType&&classes.push(this.cssType),this.getAuthoring("$value.$valueFirst",!1)&&classes.push("s-m-valueFirst"),Base.prototype.buildHtml.call(this,classes),this._oldValue=this.getValue(),this.buildFieldTitle(),this.buildFieldValue(),this._applyLabelAuthoring(),this.applyMetaData(this.getMetaData()),this.renderDiagnoses(),this.checkEmptyValue(),this._checkNumVisiblePickers()},createMainInput:function(value,type,attrs,$$parent){type=type||"text",this._addNativePickers();var checkBox="checkbox"===type,css=["s-m-meta"];attrs=attrs||{},attrs.type=type;var element="input";return"text"===type?(css.push("form-control"),attrs["data-nevent-ctrl-blur"]="",attrs.value=value):"textplain"===type?(element="textarea",css.push("form-control"),attrs["data-nevent-ctrl-blur"]=""):checkBox&&(attrs["data-nevent-ctrl-click"]=""),this.options.notifyFocus===!0&&(attrs["data-nevent-ctrl-focus"]=""),this.$$input=$(uiUtils.createDomElement(element,css,null,attrs)).prependTo(this._$$inputGroup||$$parent||this.$$value),checkBox&&this.$$input.prop("checked",value),this.$$input},buildFieldTitle:function(){this.$$elmt.removeClass("s-m-title-hidden");if(this.getAuthoring("$isTitleHidden")){this.$$elmt.addClass("s-m-title-hidden");return}if(this.options.displayCtx==="table"||this.options.noTitle===!0)return;var ttl=(this.getTitle()||"").trim();ttl.length>0&&(this.getMetaData("$isMandatory")===!0&&(ttl+="*"),this.$$title=$(uiUtils.createDomElement("div",["s-m-title"],ttl,null,this.$$elmt))),ttl.length||this.$$elmt.addClass("s-m-title-hidden")},_ensure$$value:function(){this.$$value||this._create$$value()},_create$$value:function(){var classes=["s-m-value"];return this.$isEditMode&&classes.push("edit"),this.$$value=$(uiUtils.createDomElement("div",classes,null,null,this.$$elmt)),this.$$value},_clear$$value:function(){this.$$value&&this.$$value.empty(),this.$$input=null,this._$$inputGroup=null,this._$$inputGroupBtn=null},appendTextValue:function(value){if(value==null)return;typeof value!="string"&&(value=value.toString?value.toString():"??Can't display??"),value=value.trim(),value.length>0&&uiUtils.appendTextNode(this.$$value,value)},checkEmptyValue:function(forceEmpty){if(this.$isEditMode)return;this.$$elmt.css("display",""),this.isEmpty=forceEmpty===!0||this.$$value==null||this.$$value.is(":empty"),this.$$elmt.toggleClass("s-m-empty",this.isEmpty);if(!this.isEmpty)return;if(this.getAuthoring("$hideIfEmpty")===!0){this.$$elmt.css("display","none");return}this.getAuthoring("$labelPosition")==="top"&&(this._ensure$$value(),this.$$value.html("&nbsp;"))},_applyLabelAuthoring:function(){var val=this.getAuthoring("$labelPosition");this.$$elmt.removeClass("s-m-top"),val=="top"&&this.$$elmt.addClass("s-m-top"),this.$$elmt.removeClass("s-m-left s-m-right s-m-center"),val==="top"&&(val=this.getAuthoring("$labelAlign"),val!=null&&_texr_align.indexOf(val)>=0&&this.$$elmt.addClass("s-m-"+val))},_ensureInputGroup:function(){var $$input;this._$$inputGroup||($$input=this.$$input?this.$$input.detach():null,this._$$inputGroup=$('<div class="input-group"/>').appendTo(this.$$value)),this._$$inputGroupBtn||(this._$$inputGroupBtn=$('<span class="input-group-btn"/>').appendTo(this._$$inputGroup)),$$input&&$$input.prependTo(this._$$inputGroup)},addPickerSdataLink:function($linkName,icon){this._ensureInputGroup();var attrs=this.getSdataLinkAttrs($linkName),$$picker=$('<button class="btn btn-default s-m-meta"><span class="'+icon+'"></span></button>');return $.each(attrs,function(key,value){$$picker.attr(key,value)}),$$picker.appendTo(this._$$inputGroupBtn)},addPicker:function(type,icon){this._ensureInputGroup();var $$picker=$('<button data-control-id="'+this.id+'" data-nevent="" data-naction="'+type+'Picker" class="btn btn-default s-m-meta"><span class="'+icon+'"></span></button>');return $$picker.appendTo(this._$$inputGroupBtn)},applyMetaData:function(metaData){Base.prototype.applyMetaData.call(this,metaData);if(metaData==null)return;if(this.$isEditMode){var $$e=this.$$elmt.find(".s-m-meta");$$e.length>0&&($$e.is("input")&&!$$e.is(".btn")?($$e[metaData.$isReadOnly===!0?"attr":"removeAttr"]("readonly",""),$$e[metaData.$isDisabled===!0?"attr":"removeAttr"]("disabled","")):$$e[datasetUtils.isDisabled(metaData)?"attr":"removeAttr"]("disabled",""))}return(this.article.$isHidden!=null||metaData.$isHidden!=null)&&this.$$elmt.toggleClass("s-m-hidden",this.article.$isHidden===!0||metaData.$isHidden===!0),this.renderDiagnoses()},renderDiagnoses:function(){if(!this.$$elmt)return!1;this.$$elmt.removeClass("error info warning"),this.$$message&&this.$$message.empty();var diags=this.controller.getDiagnoses(this.$bind),nbErrors=0;if(diags.length>0){this.options.displayCtx!=="table"&&(this.$$message||(this.$$message=$('<span class="s-m-message"/>').appendTo(this.$$elmt)));var self=this;diags.forEach(function(diag){self.options.displayCtx!=="table"&&self.$$message.append($("<p class=s-m-"+diag.$severity+">").text(diag.$message)),diag.$severity==="error"&&nbErrors++})}return this.$$elmt.toggleClass("error",nbErrors>0),!0},clearClientDiagnoses:function(){this.controller.setClientDiagnoses(this.$bind,[]),this.renderDiagnoses()},_checkNumVisiblePickers:function(){if(!this._$$inputGroupBtn)return;var $$pickers=$("button",this._$$inputGroupBtn),count=0;$.each($$pickers,function(idx,picker){$(picker).css("display")!=="none"&&(count+=1)}),this._$$inputGroupBtn.toggle(count>0)},setDisplayValue:function(value){this.$$input&&this.$$input.val(value)},notifAuthClose:function(){if(!this.$$elmt)return;for(var p in _nativeCapabilityAutoring)this.$$elmt.find('button[data-action="'+p+'Picker"]').toggle(this.isNativeCapabilityEnabled(p,!1));this._checkNumVisiblePickers()},notifAuthSetPage:function(){if(!this.$$elmt)return;for(var p in _nativeCapabilityAutoring)this.$$elmt.find('button[data-action="'+p+'Picker"]').toggle(this.isNativeCapabilityEnabled(p,!0));this._checkNumVisiblePickers()},onFocus:function(justCheck){notifications.publish("sm.field.focus",this)},onBlur:function(){this.validateInput()},validateInput:function(){this.clearClientDiagnoses();if(!this.$$input)return this.renderDiagnoses(),!0;var value=this.$$input.val(),errors=[];return value=this.parseValue(value,errors),errors.length===0&&(this.validateValue(value,errors),this.setDisplayValue(this.getFormattedValue(value)),errors.length===0&&this.setValue(value)),this.controller.setClientDiagnoses(this.$bind,errors),this.renderDiagnoses(),errors.length==0},validateValue:function(value,errors){return validator.validate(this,value,errors,["$isMandatory"])},setFocus:function(){Base.prototype.setFocus.call(this);if(this.$isEditMode&&this.acceptFocus()){var $$elmt=this.getFocusElmt();$$elmt&&$$elmt.is("input, select")?($$elmt.focus(),$$elmt.select()):notifications.publish("sm.field.focus",this)}},getFocusElmt:function(){return this.$$input},acceptFocus:function(){return this.getFocusElmt()!=null},isNativeCapabilityEnabled:function(capability,authoringOnly){var res;authoringOnly=authoringOnly===!0;if(authoringOnly===!0&&globals.isAuthoringActive()){var authoring=this.getNativeCapabilityAuthoring(capability);res=authoring!=null&&this.article[authoring]===!0}else if(this._nativeCapabilities==null||this._nativeCapabilities[capability]!==!0)res=!1;else{var authoring=this.getNativeCapabilityAuthoring(capability);res=authoring==null||this.article[authoring]===!0}return res=res===!0,log&&log("isNativeCapabilityEnabled: "+capability+" ("+authoringOnly+"): "+res),res},addNativePicker:function(nativeCapability){return this.addPicker(nativeCapability,fontUtils.getIconByName(nativeCapability+"Picker"))},_getNativePicker:function(){return this._nativeCapabilities?this.isNativeCapabilityEnabled("scanBarcode")?"scanBarcode":this.isNativeCapabilityEnabled("GPS")?"GPS":this.isNativeCapabilityEnabled("penTextInput")?"penTextInput":null:null},_addNativePickers:function(){if(!this._nativeCapabilities)return;if(environment.isMobile()){var nativeCapability=this._getNativePicker();nativeCapability&&this.addNativePicker(nativeCapability);return}var self=this;["penTextInput","GPS","scanBarcode"].forEach(function(nativeCapability){self.addNativePicker(nativeCapability).toggle(self.isNativeCapabilityEnabled(nativeCapability,!0))}),notifications.subscribe(this,["sm.auth.close","sm.auth.set.page"])},getNativeCapabilityAuthoring:function(capability){return!this.options||this.options.nativeCapabilities==null||this.options.nativeCapabilities[capability]!==!0?null:_nativeCapabilityAutoring[capability]},_actPenTextInputPicker:function(){var self=this;native.getModule("penTextInput").getPenTextInput({title:self.getTitle(),value:self.getValue()}).then(function(data){if(data.action==="ok"&&data.matches&&data.matches.length){var values=[];data.matches.forEach(function(val){val=self.parseValue(val),(val!=null||val!="")&&values.push(val)});if(values.length===0)return;values=self.typeName==="string"?values.join(" "):values[0],self.setFieldValue(values)}})},_actGPSPicker:function(){var self=this;native.getModule("GPS").getGPSCoordinates().then(function(data){data.succeeded===!0?self.setFieldValue(data.latitude+", "+data.longitude):modules.get("modal").notify({severityClass:"error",title:locale.text("gps.error")})}).fail(function(){})},_actScanBarcodePicker:function(){var self=this;native.getModule("scanBarcode").scanBarcode().then(function(data){data.action==="ok"?self.setFieldValue(data.content):data.action==="cancelled"?modules.get("modal").notify({severityClass:"info",title:locale.text("barcode.cancelled")}):modules.get("modal").notify({severityClass:"error",title:locale.text("barcode.error")})}).fail(function(){})}})}),define("syracuse-tablet/html/js/controls/fields/ctrlAlphanum",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/controls/validator","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),validator=require("syracuse-tablet/html/js/controls/validator").Validator,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils");exports.CtrlAlphaNum=utils.defineClass(function CtrlAlphaNum(controller,article,prototype,options){options=options||{},options.nativeCapabilities={penTextInput:!0,GPS:!0,scanBarcode:!0},Base.call(this,controller,article,prototype,options)},Base,{validateValue:function(value,errors){var ok=Base.prototype.validateValue.call(this,value,errors);return ok&&validator.validate(this,value,errors,["$pattern","$minLength","$maxLength"])},buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var value=this.getFormattedValue(this.getValue());this.$isEditMode?this.createMainInput(value):this.appendTextValue(value)}});var CtrlAlphaNum=exports.CtrlAlphaNum;exports.CtrlPhone=utils.defineClass(function CtrlPhone(controller,article,prototype,options){CtrlAlphaNum.call(this,controller,article,prototype,options),this.cssType="s-m-phone"},CtrlAlphaNum,{buildFieldValue:function(){if(this.$isEditMode)CtrlAlphaNum.prototype.buildFieldValue.call(this);else{var value=this.getFormattedValue(this.getValue()),link=uiUtils.createDomElement("span",null,"",this.getDataActionAttrs("openExternalLink","tel:"+value));value&&(link.appendChild(uiUtils.createDomElement("span",fontUtils.phoneFieldIcon())),$(link).append(value)),this.$$elmt.append(link)}}}),exports.CtrlEmail=utils.defineClass(function CtrlEmail(controller,article,prototype,options){CtrlAlphaNum.call(this,controller,article,prototype,options),this.cssType="s-m-email"},CtrlAlphaNum,{buildFieldValue:function(){if(this.$isEditMode)CtrlAlphaNum.prototype.buildFieldValue.call(this);else{var value=this.getFormattedValue(this.getValue()),link=uiUtils.createDomElement("span",null,"",this.getDataActionAttrs("openExternalLink","mailto:"+value));value&&(link.appendChild(uiUtils.createDomElement("span",fontUtils.emailFieldIcon())),$(link).append(value)),this.$$elmt.append(link)}}}),exports.CtrlUrl=utils.defineClass(function CtrlUrl(controller,article,prototype,options){CtrlAlphaNum.call(this,controller,article,prototype,options),this.cssType="s-m-url"},CtrlAlphaNum,{buildFieldValue:function(){this._ensure$$value();if(this.$isEditMode)CtrlAlphaNum.prototype.buildFieldValue.call(this);else{var value=this.getFormattedValue(this.getValue());if(value){this.$$value.append(uiUtils.createDomElement("span",null,value));var icon=uiUtils.createDomElement("span",["s-m-icon-link",this._getDefaultIcon()],null,this.getDataActionAttrs("openExternalLink",value));this.$$value.append(icon)}}},_getDefaultIcon:function(){var css="s-m-icon-"+(this.article.$urlIconSize||"small")+" ";return css+(this.article.$urlIcon||fontUtils.getUrlDefIcon()).css}})}),define("syracuse-tablet/html/js/controls/fields/ctrlCheckbox",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/sdata/datasetUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils");exports.CtrlCheckbox=utils.defineClass(function CtrlCheckbox(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var val=this.getValue();if(val==null&&!this.$isEditMode)return;val=val===!0,this.$isEditMode?this.createMainInput(val,"checkbox"):this.getAuthoring("$displayAs")==="text"?this.$$value.text(locale.text(val===!0?"yes":"no")):this.$$value.append(uiUtils.createDomElement("span",fontUtils.checkBoxIcon(val)))},onClick:function(evt){var self=this;return evt.preventDefault(),evt.stopPropagation(),setTimeout(function(){var checked=!self.$$input.prop("checked");self.$$input.prop("checked",checked),self.setValue(checked)},50),!0},applyMetaData:function(metaData){Base.prototype.applyMetaData.call(this,metaData);var $$input=this.$$value&&this.$$value.find("input");datasetUtils.isDisabled(metaData)?$$input.attr("disabled",""):$$input.removeAttr("disabled")}})}),define("syracuse-tablet/html/js/controls/fields/ctrlSwitch",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),locale=require("syracuse-tablet/html/js/helpers/locale");exports.CtrlSwitch=utils.defineClass(function CtrlSwitch(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{destroy:function(){this.$$panel&&(this.$$panel.bootstrapSwitch("destroy"),this.$$panel=null),Base.prototype.destroy.call(this)},buildFieldValue:function(){this._ensure$$value();var val=this.getValue();if(val==null)return;val=val===!0;if(this.$isEditMode){var attrs={type:"checkbox"};this.$$panel=$(uiUtils.createDomElement("input","",null,attrs,this.$$value)),this.$$panel.bootstrapSwitch("state",val===!0,!0),this.$$panel.bootstrapSwitch("onText",locale.text("auth.switcher.onText")),this.$$panel.bootstrapSwitch("offText",locale.text("auth.switcher.offText")),this.$$panel.bootstrapSwitch("size","small"),this.$$panel.bootstrapSwitch("onColor","default"),this.$$panel.bootstrapSwitch("offColor","default"),this.$$panel.bootstrapSwitch("onSwitchChange",jsutils.bindFn(this.onSwitchChange,this))}else this.$$value.append(uiUtils.createDomElement("span",fontUtils.checkBoxIcon(val)))},onSwitchChange:function(){this.setValue(this.$$panel.bootstrapSwitch("state"))}})}),define("syracuse-tablet/html/js/controls/fields/ctrlCombo",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/sdata/datasetUtils"],function(require,exports,module){function _compareEnum(enum1,enum2){if(!enum1||!enum2)return!1;if(enum1.length!=enum2.length)return!1;for(var i=0,l=enum1.length;i<l;i++){if(enum1.$value!=enum2.$value)return!1;if(enum1.$title!=enum2.$title)return!1}return!0}var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils");exports.CtrlCombo=utils.defineClass(function CtrlCombo(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{buildFieldValue:function(fieldSlot,buildOptions){this._ensure$$value(),this._updateList(!1)},refreshValue:function(buildOptions){this._updateList(!0)},applyMetaData:function(metaData){Base.prototype.applyMetaData.call(this,metaData),this._updateList(metaData,!0)},_updateList:function(valueChanged,metaDataChanged){var self=this;if(!self.$$value)return;var metaData=this.getMetaData();this._isDisabled=datasetUtils.isDisabled(metaData);var newList=metaData&&metaData.$value?metaData.$value.$enum:null;if(valueChanged!==!0&&_compareEnum(newList,self._choiceList)&&metaDataChanged!==!0)return;self.$$value.empty(),self._choiceList=$.extend(!0,[],newList),self.$isEditMode?(self.$format=metaData&&metaData.$format||"$combo",self.$format=="$radios"?self._renderRadios(metaData):self._renderCombo(metaData)):self._choiceList.length>0&&self._renderReadOnly(metaData)},_renderRadios:function(metaData){var self=this;if(self._choiceList.length<0)return;var value=self.currentValue=self.getValue();$.each(self._choiceList,function(index,choiceItem){var choiceItemDom=uiUtils.createDomElement("div",["s-m-field-radio-item"]),inputDom=uiUtils.createDomElement("input",["s-m-field-choice-radio","s-m-meta"],null,{type:"radio",value:index,"data-sdata-value":choiceItem.$value,name:"s-m-radio-"+self.id,"data-nevent-ctrl-click":""});value&&choiceItem.$value==value?inputDom.setAttribute("checked",!0):self._isDisabled&&inputDom.setAttribute("disabled",!0);var parsedTitle=self.prototype.resolveExpression(choiceItem.$title),titleDom=uiUtils.createDomElement("div",["s-m-field-choice-radio-title"],parsedTitle);self.$$value[0].appendChild(inputDom),self.$$value[0].appendChild(titleDom)})},_renderCombo:function(metaData){var self=this;if(self._choiceList.length<0)return;var value=self.currentValue=self.getValue(),selectDom=uiUtils.createDomElement("select",["form-control","s-m-meta"],null,{"data-nevent-ctrl-change":""}),selected=!1,opts=[],optDom;$.each(self._choiceList,function(index,choiceItem){var parsedTitle=self.prototype.resolveExpression(choiceItem.$title);optDom=uiUtils.createDomElement("option",null,parsedTitle,{value:choiceItem.$value},null),choiceItem.$value==value&&(optDom.setAttribute("selected",!0),selected=!0),opts.push(optDom)}),self.$$value[0].appendChild(selectDom),datasetUtils.isDisabled(metaData)?selectDom.setAttribute("disabled",!0):selectDom.removeAttribute("disabled"),selected||(opts.length>0&&(opts.push(uiUtils.createDomElement("option",["empty"],"",{value:"",selected:!0},null)),metaData&&metaData.$isMandatory&&$(selectDom).addClass("removeEmptyOption")),value!=null&&(this.controller.setClientDiagnoses(this.$bind,[{$severity:"error",$message:locale.text("unexpected.value",[" ("+value+")"])}]),this.renderDiagnoses())),opts.forEach(function(opt){selectDom.appendChild(opt)})},_renderReadOnly:function(metaData){var self=this,value=self.currentValue=self.getValue();value=self._getChoiceTitle(value),value=self.prototype.resolveExpression(value),self.appendTextValue(value)},_getChoiceTitle:function(value){var res;return $.each(this._choiceList,function(index,choice){res=choice.$value==value?choice.$title:res;if(res)return!1}),res},getChoiceTitles:function(){var res=[],self=this;return $.each(this._choiceList,function(index,choice){res.push({$value:choice.$value,title:self.prototype.resolveExpression(choice.$title)})}),res},setDisplayValue:function(value){var self=this;if(value==self.currentValue)return;if(!self.$isEditMode)return;if(self.$format!=="$radios")return;$.each(self.$$elmt.find("input"),function(idx,input){$(input).attr("data-sdata-value")===value?input.checked=!0:(input.checked=!1,self._isDisabled&&(input.disabled=!0))})},setFieldValue:function(value){this.setDisplayValue(value),this.currentValue=value,this.setValue(value)},onClick:function(evt){var $$t=$(evt.target);return this.$format==="$radios"&&this.setFieldValue(this._getChoiceValue($(evt.target))),!0},_getChoiceValue:function($$elmt){return $$elmt.attr("data-sdata-value")},onChange:function(evt){var $$t=$(evt.target);$$t.is("select")&&$$t.is(".removeEmptyOption")&&$$t.removeClass("removeEmptyOption").find("option.empty").remove(),this.setFieldValue(evt.target.value)}})}),define("syracuse-tablet/html/js/controls/fields/ctrlNumeric",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/validator","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),validator=require("syracuse-tablet/html/js/controls/validator").Validator,locale=require("syracuse-tablet/html/js/helpers/locale");exports.CtrlNumeric=utils.defineClass(function CtrlNumeric(controller,article,prototype,options){options=options||{},options.nativeCapabilities={penTextInput:!0},Base.call(this,controller,article,prototype,options)},Base,{buildFieldValue:function(){var self=this;this._ensure$$value(),this._clear$$value(),this.$$value.addClass("s-m-numeric");var value=self.getFormattedValue(self.getValue());self.$isEditMode?self.createMainInput(value):self.appendTextValue(value)},parseValue:function(value,errors){var self=this;if(self.formatter){var format=self.formatter.getFormat();if(format){var gs=locale.getNumberGroupSeparator(),ds=locale.getNumberDecimalSeparator();format.indexOf(",")<0&&gs&&gs.length>0&&(value=value.replace(new RegExp("\\"+gs,"g"),ds)),format.indexOf(",")>0&&format.indexOf(".")>0&&gs&&gs.length>0&&value.indexOf(gs)>-1&&value.indexOf(ds)<0&&(value=value.replace(new RegExp(gs,"g"),ds))}}return Base.prototype.parseValue.call(self,value,errors)},validateValue:function(value,errors){var self=this,ok=Base.prototype.validateValue.call(self,value,errors);return ok=validator.validate(self,value,errors,["$minimum","$maximum","$exclusiveMinimum","$exclusiveMaximum","$precision"])&&ok,self.$type!=="application/x-integer"&&(ok=validator.validate(self,value,errors,["$scale"])&&ok),ok}})}),define("syracuse-tablet/html/js/controls/fields/ctrlQuantity",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules");exports.CtrlQuantity=utils.defineClass(function CtrlQuantity(controller,article,prototype,options){options=options||{},options.nativeCapabilities={penTextInput:!0},Base.call(this,controller,article,prototype,options),this.unitFieldInfo=prototype.getUnitFieldInfo(),this.displayUnit=!1,this.unitFieldInfo&&this.unitFieldInfo.unitFieldProto&&!this.unitFieldInfo.unitFieldProto.json.$isExcluded&&(this.displayUnit=options&&options.displayCtx!=="table"),this.unitCtrl=null},Base,{initFormatter:function(){var valueProto=this.prototype.data("$value");return!valueProto||!valueProto.$type?null:Base.prototype.initFormatter.call(this,valueProto.$type,valueProto.$format)},destroy:function(){Base.prototype.destroy.call(this),this.unitCtrl&&(this.unitCtrl.destroy(),this.unitCtrl=null)},buildHtml:function(classes){classes=classes||[],classes.push("s-m-qty"),Base.prototype.buildHtml.call(this,classes),this.displayUnit&&(this.unitCtrl=modules.get("ctrlFactory").createControl(this.controller,{$bind:this.unitFieldInfo.unitBindName,$noAuthoring:!0},this.parent,this.unitFieldInfo.unitFieldProto,{isUnit:!0}),this.unitCtrl.set$$container(this.$$value),this.unitCtrl.buildHtml())},buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var value=this.getFormattedValue(this.getValue());this.$isEditMode?this.createMainInput(value):this.appendTextValue(value)}})}),define("syracuse-tablet/html/js/controls/fields/ctrlReference",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/sdata/datasetUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils");exports.CtrlReference=utils.defineClass(function CtrlReference(controller,article,prototype,options){this.isUnit=options.isUnit===!0,options.nativeCapabilities={scanBarcode:!this.isUnit},Base.call(this,controller,article,prototype,options),this.isUnit?(this.$isEditMode=!1,this.cssType="s-m-unit"):this.cssType="s-m-ref",this._isNumeric=!1},Base,{initFormatter:function(){var type=this.prototype.getFieldValueType(this.$bind);return type==null||type.length===0?null:Base.prototype.initFormatter.call(this,type,null)},getValue:function(prop){var val=this.getObjectValue()[prop||"$value"];return val==null?"":val},getObjectValue:function(){var val=Base.prototype.getValue.call(this);if(val===null||typeof val!="object")val={$value:val};return val.$description||(val.$description=""),val.$title||(val.$title=""),val},buildFieldTitle:function(){if(this.isUnit)return;Base.prototype.buildFieldTitle.call(this)},buildFieldValue:function(){var self=this;this._ensure$$value(),this._clear$$value(),self.formatter&&self.formatter.$type==="application/x-integer"&&self.$$value.addClass("s-m-numeric");if(self.$isEditMode)self.buildEditValue(self.getValue());else{var val=self.getObjectValue();self.isUnit?self.buildUnitValue(self.$$value,val.$value,val.$description,val.$title):self.buildDetailValue(self.getFormattedValue(val.$value),val.$description,val.$title)}},buildEditValue:function(value){var $lookuplink=datasetUtils.isDisabled(this.getMetaData())?null:this.prototype.getValueByPath("$item.$links.$lookup");$lookuplink&&this.addPickerSdataLink("$lookup",fontUtils.getIconByName("lookupPicker")),this.createMainInput(this.getFormattedValue(value))},buildDetailValue:function(value,descr,title){var self=this,$$container=this.options.displayCtx!=="table"?self.addDetailLink(self.$$value):self.$$value;if(value.length>0){var descContent,$refDescFormat=self.getAuthoring("$refDescFormat");switch($refDescFormat){case"title":descContent=title;break;case"desctitle":descContent=self._combineTexts(descr,title);break;case"titledesc":descContent=self._combineTexts(title,descr);break;default:descContent=descr}var $$desc=$("<div>").addClass("s-m-descr").text(descContent);if(self.getAuthoring("$refValueDisplay")===!1)$$container.append($$desc);else{var $refDescPosition=self.getAuthoring("$refDescPosition");if($refDescPosition==null||$refDescPosition.length===0)$refDescPosition=self.options.displayCtx==="table"?"bottom":"right";var $$value=$("<div>").addClass("s-m-ref-val").text(value),arr;switch($refDescPosition){case"bottom":$$container.append($$value).append($$desc);break;case"left":$$container.append($$desc).append($$value),arr=[$$value,$$desc],$.each(arr,function(index,$$ee){$$ee.css("display","inline-block")}),$$desc.css("padding-right","5px");break;case"top":$$container.append($$desc).append($$value);break;case"none":$$container.append($$value);break;case"right":default:arr=[$$value,$$desc],$$container.append($$value).append($$desc),$.each(arr,function(index,$$ee){$$ee.css("display","inline-block")}),$$desc.css("padding-left","5px")}}}},buildUnitValue:function($$parentElmt,value,descr,title){var self=this,label=descr.length>0?descr:title.length>0?title:value;label=value||"",label&&label.toLowerCase&&(label=label.toLowerCase().smCapitalize()),uiUtils.createDomElement("span",["s-m-descr"],label,null,self.addDetailLink($$parentElmt)||$$parentElmt)},addDetailLink:function($$parentElmt){var self=this;if(self.options.displayCtx==="card")return;return self.prototype.getValueByPath("$item.$links.$details")?$(uiUtils.createDomElement("span",null,null,self.getSdataLinkAttrs("$details"),$$parentElmt)):$$parentElmt},setDisplayValue:function(value){var strData;$.isPlainObject(value)?strData=value.$value||"":strData=value||"",Base.prototype.setDisplayValue.call(this,strData)},onSdataLinkClicked:function($linkName){var self=this,$link=this.prototype.getValueByPath("$item.$links."+$linkName)||{};if(!$link)return;var $url=$link.$url,$method=$link.$method;if(!$url)return;if($linkName==="$lookup"){var $lookupWhere=this.prototype.getValueByPath("$item.$autoLookWhere"),whereElements;$lookupWhere&&$.each($lookupWhere,function(property,valueProperty){var fieldValue=self.controller.getValue(valueProperty);fieldValue!=null&&(whereElements=whereElements||[],whereElements.push("("+property+" eq '{"+valueProperty+"}')"))});var autoLookupWhere=whereElements&&whereElements.join(" and ");autoLookupWhere&&$url.indexOf("where=")<0&&($url.indexOf("?")<0?$url=$url+"?where="+autoLookupWhere:$url=$url+"&where="+autoLookupWhere),$url=this.controller.dataset.resolveExpression($url,!0),this.controller.gotoUrl($url,$method,{isChild:!0,lookup:{controllerId:this.controller.id,$bind:this.$bind,$lookupKeyName:this.prototype.getValueByPath("$item.$lookupKeyName")}})}else $url=this.controller.dataset.resolveExpression($url,!0),this.controller.gotoUrl($url,$method)},_combineTexts:function(el1,el2){var res;return res=el1&&el2?el1===el2?el1:el1+"-"+el2:el1||el2||"",res}})}),define("syracuse-tablet/html/js/ui/rect",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),_Klass=utils.defineClass(function rect(top,left,height,width){this.top=top,this.left=left,this.setHeight(height),this.setWidth(width)},null,{isPointInside:function(x,y){return(x==null||x>=this.left&&x<=this.right)&&(y==null||y>=this.top&&y<=this.bottom)},isEvtInside:function(evt,rectOffset){if(evt.type.smStartsWith("touch"))if(evt.changedTouches&&evt.changedTouches.length===1)evt=evt.changedTouches[0];else{if(!evt.touches||evt.touches.length!==1)return!0;evt=evt.touches[0]}var y=rectOffset!=null&&rectOffset.top!=null?evt.pageY-rectOffset.top:evt.pageY,x=rectOffset!=null&&rectOffset.left!=null?evt.pageX-rectOffset.left:evt.pageX;return this.isPointInside(x,y)},intersectsWith:function(rect){return this.left<=rect.right&&rect.left<this.right&&this.top<rect.bottom&&rect.top<this.bottom},contains:function(rect){return rect==null?!0:this.isPointInside(rect.left,rect.top)&&this.isPointInside(rect.right,rect.bottom)},equals:function(rect,justSize){return rect.width===this.width&&rect.height===this.height?justSize===!0||rect.top===this.top&&rect.left===this.left:!1},intersectRect:function(rect,relative){if(!this.intersectsWith(rect))return null;var top=Math.max(this.top,rect.top),left=Math.max(this.left,rect.left),right=Math.min(this.right,rect.right),bottom=Math.min(this.bottom,rect.bottom);return new _Klass(relative?0:top,relative?0:left,bottom-top,right-left)},checkHeight:function(rect){return rect?this.height===rect.height?0:this.height>rect.height?1:-1:!1},checkWidth:function(what,rect){return rect?this.width===rect.width?0:this.width>rect.width?1:-1:!1},setHeight:function(h){this.height=Math.max(h,0),this.bottom=this.top+this.height},setWidth:function(w){this.width=Math.max(w,0),this.right=this.left+this.width},moveLeft:function(l){this.left=this.left+l,this.right=this.width+this.left},moveTop:function(l){this.top=this.top+l,this.bottom=this.height+this.top},toString:function(){return"t:"+this.top+" l:"+this.left+" r:"+this.right+" b:"+this.bottom+" h:"+this.height+" w:"+this.width},toRelative:function(offet){return offet==null&&(offet={}),offet.top==null&&(offet.top=0),offet.left==null&&(offet.left=0),new _Klass(offet.top,offet.left,this.height,this.width)},showInDocument:function(options){var scale=modules.get("siteLayout").getTransformScale();options=options||{};var pos="fixed",$$parent=$(document.body),$$elmt=$('<div class = "s-m-rect">').appendTo($$parent).css({position:pos,top:this.top+"px",left:this.left+"px",height:this.height*scale+"px",width:this.width*scale+"px",backgroundColor:options.color,zIndex:options.zIndex!=null?options.zIndex:undefined});return options.timeout!=null&&setTimeout(function(){$$elmt.remove()},options.timeout),$$elmt},clone:function(){return new _Klass(this.top,this.left,this.height,this.width)},applyTransformScale:function(scale,clone){if(scale==null||scale<=0||typeof scale!="number")return;var res=clone===!0?this.clone():this;return res.width=res.width*scale,res.height=res.height*scale,res}}),_meths={outer:["outerWidth","outerHeight"],inner:["innerWidth","innerHeight"],computed:["width","height"],fixed:"position",relative:"offset"};exports.elmtRect=function($$elmt,typeRect,position){var scale=modules.get("siteLayout").getTransformScale();position=position||"relative",typeRect=typeRect||"outer";var o=$$elmt[_meths[position]](),m=_meths[typeRect],height=$$elmt[m[1]](),width=$$elmt[m[0]](),rect=new _Klass(o.top,o.left,height/scale,width/scale);if(typeRect==="computed"&&position==="relative"){var outW=$$elmt.outerWidth(),outH=$$elmt.outerHeight();outW>width&&rect.moveLeft((outW-width)*scale/2),outH>height&&rect.moveTop((outH-height)*scale/2)}return rect},exports.newRect=function(top,left,height,width){return new _Klass(top,left,height,width)}}),function(window,document,exportName,undefined){function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){return Array.isArray(arg)?(each(arg,context[fn],context),!0):!1}function each(obj,iterator,context){var i;if(!obj)return;if(obj.forEach)obj.forEach(iterator,context);else if(obj.length!==undefined){i=0;while(i<obj.length)iterator.call(context,obj[i],i,obj),i++}else for(i in obj)obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}function extend(dest,src,merge){var keys=Object.keys(src),i=0;while(i<keys.length){if(!merge||merge&&dest[keys[i]]===undefined)dest[keys[i]]=src[keys[i]];i++}return dest}function merge(dest,src){return extend(dest,src,!0)}function inherit(child,base,properties){var baseP=base.prototype,childP;childP=child.prototype=Object.create(baseP),childP.constructor=child,childP._super=baseP,properties&&extend(childP,properties)}function bindFn(fn,context){return function boundFn(){return fn.apply(context,arguments)}}function boolOrFn(val,args){return typeof val==TYPE_FUNCTION?val.apply(args?args[0]||undefined:undefined,args):val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,!1)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,!1)})}function hasParent(node,parent){while(node){if(node==parent)return!0;node=node.parentNode}return!1}function inStr(str,find){return str.indexOf(find)>-1}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey)return src.indexOf(find);var i=0;while(i<src.length){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find)return i;i++}return-1}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){var results=[],values=[],i=0;while(i<src.length){var val=key?src[i][key]:src[i];inArray(values,val)<0&&results.push(src[i]),values[i]=val,i++}return sort&&(key?results=results.sort(function sortUniqueArray(a,b){return a[key]>b[key]}):results=results.sort()),results}function prefixed(obj,property){var prefix,prop,camelProp=property[0].toUpperCase()+property.slice(1),i=0;while(i<VENDOR_PREFIXES.length){prefix=VENDOR_PREFIXES[i],prop=prefix?prefix+camelProp:property;if(prop in obj)return prop;i++}return undefined}function uniqueId(){return _uniqueId++}function getWindowForElement(element){var doc=element.ownerDocument;return doc.defaultView||doc.parentWindow}function Input(manager,callback){var self=this;this.manager=manager,this.callback=callback,this.element=manager.element,this.target=manager.options.inputTarget,this.domHandler=function(ev){boolOrFn(manager.options.enable,[manager])&&self.handler(ev)},this.init()}function createInputInstance(manager){var Type,inputClass=manager.options.inputClass;return inputClass?Type=inputClass:SUPPORT_POINTER_EVENTS?Type=PointerEventInput:SUPPORT_ONLY_TOUCH?Type=TouchInput:SUPPORT_TOUCH?Type=TouchMouseInput:Type=MouseInput,new Type(manager,inputHandler)}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length,changedPointersLen=input.changedPointers.length,isFirst=eventType&INPUT_START&&pointersLen-changedPointersLen===0,isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen===0;input.isFirst=!!isFirst,input.isFinal=!!isFinal,isFirst&&(manager.session={}),input.eventType=eventType,computeInputData(manager,input),manager.emit("hammer.input",input),manager.recognize(input),manager.session.prevInput=input}function computeInputData(manager,input){var session=manager.session,pointers=input.pointers,pointersLength=pointers.length;session.firstInput||(session.firstInput=simpleCloneInputData(input)),pointersLength>1&&!session.firstMultiple?session.firstMultiple=simpleCloneInputData(input):pointersLength===1&&(session.firstMultiple=!1);var firstInput=session.firstInput,firstMultiple=session.firstMultiple,offsetCenter=firstMultiple?firstMultiple.center:firstInput.center,center=input.center=getCenter(pointers);input.timeStamp=now(),input.deltaTime=input.timeStamp-firstInput.timeStamp,input.angle=getAngle(offsetCenter,center),input.distance=getDistance(offsetCenter,center),computeDeltaXY(session,input),input.offsetDirection=getDirection(input.deltaX,input.deltaY),input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1,input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0,computeIntervalInputData(session,input);var target=manager.element;hasParent(input.srcEvent.target,target)&&(target=input.srcEvent.target),input.target=target}function computeDeltaXY(session,input){var center=input.center,offset=session.offsetDelta||{},prevDelta=session.prevDelta||{},prevInput=session.prevInput||{};if(input.eventType===INPUT_START||prevInput.eventType===INPUT_END)prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0},offset=session.offsetDelta={x:center.x,y:center.y};input.deltaX=prevDelta.x+(center.x-offset.x),input.deltaY=prevDelta.y+(center.y-offset.y)}function computeIntervalInputData(session,input){var last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp,velocity,velocityX,velocityY,direction;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=last.deltaX-input.deltaX,deltaY=last.deltaY-input.deltaY,v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x,velocityY=v.y,velocity=abs(v.x)>abs(v.y)?v.x:v.y,direction=getDirection(deltaX,deltaY),session.lastInterval=input}else velocity=last.velocity,velocityX=last.velocityX,velocityY=last.velocityY,direction=last.direction;input.velocity=velocity,input.velocityX=velocityX,input.velocityY=velocityY,input.direction=direction}function simpleCloneInputData(input){var pointers=[],i=0;while(i<input.pointers.length)pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)},i++;return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(pointersLength===1)return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};var x=0,y=0,i=0;while(i<pointersLength)x+=pointers[i].clientX,y+=pointers[i].clientY,i++;return{x:round(x/pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){return x===y?DIRECTION_NONE:abs(x)>=abs(y)?x>0?DIRECTION_LEFT:DIRECTION_RIGHT:y>0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.atan2(y,x)*180/Math.PI}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)-getAngle(start[1],start[0],PROPS_CLIENT_XY)}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)}function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS,this.evWin=MOUSE_WINDOW_EVENTS,this.allow=!0,this.pressed=!1,Input.apply(this,arguments)}function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS,this.evWin=POINTER_WINDOW_EVENTS,Input.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS,this.evWin=SINGLE_TOUCH_WINDOW_EVENTS,this.started=!1,Input.apply(this,arguments)}function normalizeSingleTouches(ev,type){var all=toArray(ev.touches),changed=toArray(ev.changedTouches);return type&(INPUT_END|INPUT_CANCEL)&&(all=uniqueArray(all.concat(changed),"identifier",!0)),[all,changed]}function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS,this.targetIds={},Input.apply(this,arguments)}function getTouches(ev,type){var allTouches=toArray(ev.touches),targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&allTouches.length===1)return targetIds[allTouches[0].identifier]=!0,[allTouches,allTouches];var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)});if(type===INPUT_START){i=0;while(i<targetTouches.length)targetIds[targetTouches[i].identifier]=!0,i++}i=0;while(i<changedTouches.length)targetIds[changedTouches[i].identifier]&&changedTargetTouches.push(changedTouches[i]),type&(INPUT_END|INPUT_CANCEL)&&delete targetIds[changedTouches[i].identifier],i++;if(!changedTargetTouches.length)return;return[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",!0),changedTargetTouches]}function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler),this.mouse=new MouseInput(this.manager,handler)}function TouchAction(manager,value){this.manager=manager,this.set(value)}function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE))return TOUCH_ACTION_NONE;var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X),hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);return hasPanX&&hasPanY?TOUCH_ACTION_PAN_X+" "+TOUCH_ACTION_PAN_Y:hasPanX||hasPanY?hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y:inStr(actions,TOUCH_ACTION_MANIPULATION)?TOUCH_ACTION_MANIPULATION:TOUCH_ACTION_AUTO}function Recognizer(options){this.id=uniqueId(),this.manager=null,this.options=merge(options||{},this.defaults),this.options.enable=ifUndefined(this.options.enable,!0),this.state=STATE_POSSIBLE,this.simultaneous={},this.requireFail=[]}function stateStr(state){return state&STATE_CANCELLED?"cancel":state&STATE_ENDED?"end":state&STATE_CHANGED?"move":state&STATE_BEGAN?"start":""}function directionStr(direction){return direction==DIRECTION_DOWN?"down":direction==DIRECTION_UP?"up":direction==DIRECTION_LEFT?"left":direction==DIRECTION_RIGHT?"right":""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;return manager?manager.get(otherRecognizer):otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}function PanRecognizer(){AttrRecognizer.apply(this,arguments),this.pX=null,this.pY=null}function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}function PressRecognizer(){Recognizer.apply(this,arguments),this._timer=null,this._input=null}function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}function TapRecognizer(){Recognizer.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Hammer(element,options){return options=options||{},options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset),new Manager(element,options)}function Manager(element,options){options=options||{},this.options=merge(options,Hammer.defaults),this.options.inputTarget=this.options.inputTarget||element,this.handlers={},this.session={},this.recognizers=[],this.element=element,this.input=createInputInstance(this),this.touchAction=new TouchAction(this,this.options.touchAction),toggleCssProps(this,!0),each(options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]),item[3]&&recognizer.requireFailure(item[3])},this)}function toggleCssProps(manager,add){var element=manager.element;each(manager.options.cssProps,function(value,name){element.style[prefixed(element.style,name)]=add?value:""})}function triggerDomEvent(event,data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,!0,!0),gestureEvent.gesture=data,data.target.dispatchEvent(gestureEvent)}var VENDOR_PREFIXES=["","webkit","moz","MS","ms","o"],TEST_ELEMENT=document.createElement("div"),TYPE_FUNCTION="function",round=Math.round,abs=Math.abs,now=Date.now,_uniqueId=1,MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,SUPPORT_TOUCH="ontouchstart"in window,SUPPORT_POINTER_EVENTS=prefixed(window,"PointerEvent")!==undefined,SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent),INPUT_TYPE_TOUCH="touch",INPUT_TYPE_PEN="pen",INPUT_TYPE_MOUSE="mouse",INPUT_TYPE_KINECT="kinect",COMPUTE_INTERVAL=25,INPUT_START=1,INPUT_MOVE=2,INPUT_END=4,INPUT_CANCEL=8,DIRECTION_NONE=1,DIRECTION_LEFT=2,DIRECTION_RIGHT=4,DIRECTION_UP=8,DIRECTION_DOWN=16,DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT,DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN,DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,PROPS_XY=["x","y"],PROPS_CLIENT_XY=["clientX","clientY"];Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END},MOUSE_ELEMENT_EVENTS="mousedown",MOUSE_WINDOW_EVENTS="mousemove mouseup";inherit(MouseInput,Input,{handler:function MEhandler(ev){var eventType=MOUSE_INPUT_MAP[ev.type];eventType&INPUT_START&&ev.button===0&&(this.pressed=!0),eventType&INPUT_MOVE&&ev.which!==1&&(eventType=INPUT_END);if(!this.pressed||!this.allow)return;eventType&INPUT_END&&(this.pressed=!1),this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:INPUT_TYPE_MOUSE,srcEvent:ev})}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL},IE10_POINTER_TYPE_ENUM={2:INPUT_TYPE_TOUCH,3:INPUT_TYPE_PEN,4:INPUT_TYPE_MOUSE,5:INPUT_TYPE_KINECT},POINTER_ELEMENT_EVENTS="pointerdown",POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";window.MSPointerEvent&&(POINTER_ELEMENT_EVENTS="MSPointerDown",POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"),inherit(PointerEventInput,Input,{handler:function PEhandler(ev){var store=this.store,removePointer=!1,eventTypeNormalized=ev.type.toLowerCase().replace("ms",""),eventType=POINTER_INPUT_MAP[eventTypeNormalized],pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType,isTouch=pointerType==INPUT_TYPE_TOUCH,storeIndex=inArray(store,ev.pointerId,"pointerId");eventType&INPUT_START&&(ev.button===0||isTouch)?storeIndex<0&&(store.push(ev),storeIndex=store.length-1):eventType&(INPUT_END|INPUT_CANCEL)&&(removePointer=!0);if(storeIndex<0)return;store[storeIndex]=ev,this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev}),removePointer&&store.splice(storeIndex,1)}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},SINGLE_TOUCH_TARGET_EVENTS="touchstart",SINGLE_TOUCH_WINDOW_EVENTS="touchstart touchmove touchend touchcancel";inherit(SingleTouchInput,Input,{handler:function TEhandler(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];type===INPUT_START&&(this.started=!0);if(!this.started)return;var touches=normalizeSingleTouches.call(this,ev,type);type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length===0&&(this.started=!1),this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}});var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";inherit(TouchInput,Input,{handler:function MTEhandler(ev){var type=TOUCH_INPUT_MAP[ev.type],touches=getTouches.call(this,ev,type);if(!touches)return;this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev})}}),inherit(TouchMouseInput,Input,{handler:function TMEhandler(manager,inputEvent,inputData){var isTouch=inputData.pointerType==INPUT_TYPE_TOUCH,isMouse=inputData.pointerType==INPUT_TYPE_MOUSE;if(isTouch)this.mouse.allow=!1;else if(isMouse&&!this.mouse.allow)return;inputEvent&(INPUT_END|INPUT_CANCEL)&&(this.mouse.allow=!0),this.callback(manager,inputEvent,inputData)},destroy:function destroy(){this.touch.destroy(),this.mouse.destroy()}});var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction"),NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined,TOUCH_ACTION_COMPUTE="compute",TOUCH_ACTION_AUTO="auto",TOUCH_ACTION_MANIPULATION="manipulation",TOUCH_ACTION_NONE="none",TOUCH_ACTION_PAN_X="pan-x",TOUCH_ACTION_PAN_Y="pan-y";TouchAction.prototype={set:function(value){value==TOUCH_ACTION_COMPUTE&&(value=this.compute()),NATIVE_TOUCH_ACTION&&(this.manager.element.style[PREFIXED_TOUCH_ACTION]=value),this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];return each(this.manager.recognizers,function(recognizer){boolOrFn(recognizer.options.enable,[recognizer])&&(actions=actions.concat(recognizer.getTouchAction()))}),cleanTouchActions(actions.join(" "))},preventDefaults:function(input){if(NATIVE_TOUCH_ACTION)return;var srcEvent=input.srcEvent,direction=input.offsetDirection;if(this.manager.session.prevented){srcEvent.preventDefault();return}var actions=this.actions,hasNone=inStr(actions,TOUCH_ACTION_NONE),hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y),hasPanX=inStr(actions,TOUCH_ACTION_PAN_X);if(hasNone||hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL)return this.preventSrc(srcEvent)},preventSrc:function(srcEvent){this.manager.session.prevented=!0,srcEvent.preventDefault()}};var STATE_POSSIBLE=1,STATE_BEGAN=2,STATE_CHANGED=4,STATE_ENDED=8,STATE_RECOGNIZED=STATE_ENDED,STATE_CANCELLED=16,STATE_FAILED=32;Recognizer.prototype={defaults:{},set:function(options){return extend(this.options,options),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"recognizeWith",this))return this;var simultaneous=this.simultaneous;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),simultaneous[otherRecognizer.id]||(simultaneous[otherRecognizer.id]=otherRecognizer,otherRecognizer.recognizeWith(this)),this},dropRecognizeWith:function(otherRecognizer){return invokeArrayArg(otherRecognizer,"dropRecognizeWith",this)?this:(otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),delete this.simultaneous[otherRecognizer.id],this)},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this))return this;var requireFail=this.requireFail;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),inArray(requireFail,otherRecognizer)===-1&&(requireFail.push(otherRecognizer),otherRecognizer.requireFailure(this)),this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);return index>-1&&this.requireFail.splice(index,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){function emit(withState){self.manager.emit(self.options.event+(withState?stateStr(state):""),input)}var self=this,state=this.state;state<STATE_ENDED&&emit(!0),emit(),state>=STATE_ENDED&&emit(!0)},tryEmit:function(input){if(this.canEmit())return this.emit(input);this.state=STATE_FAILED},canEmit:function(){var i=0;while(i<this.requireFail.length){if(!(this.requireFail[i].state&(STATE_FAILED|STATE_POSSIBLE)))return!1;i++}return!0},recognize:function(inputData){var inputDataClone=extend({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone])){this.reset(),this.state=STATE_FAILED;return}this.state&(STATE_RECOGNIZED|STATE_CANCELLED|STATE_FAILED)&&(this.state=STATE_POSSIBLE),this.state=this.process(inputDataClone),this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)&&this.tryEmit(inputDataClone)},process:function(inputData){},getTouchAction:function(){},reset:function(){}},inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return optionPointers===0||input.pointers.length===optionPointers},process:function(input){var state=this.state,eventType=input.eventType,isRecognized=state&(STATE_BEGAN|STATE_CHANGED),isValid=this.attrTest(input);if(isRecognized&&(eventType&INPUT_CANCEL||!isValid))return state|STATE_CANCELLED;if(isRecognized||isValid)return eventType&INPUT_END?state|STATE_ENDED:state&STATE_BEGAN?state|STATE_CHANGED:STATE_BEGAN;return STATE_FAILED}}),inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction,actions=[];return direction&DIRECTION_HORIZONTAL&&actions.push(TOUCH_ACTION_PAN_Y),direction&DIRECTION_VERTICAL&&actions.push(TOUCH_ACTION_PAN_X),actions},directionTest:function(input){var options=this.options,hasMoved=!0,distance=input.distance,direction=input.direction,x=input.deltaX,y=input.deltaY;return direction&options.direction||(options.direction&DIRECTION_HORIZONTAL?(direction=x===0?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT,hasMoved=x!=this.pX,distance=Math.abs(input.deltaX)):(direction=y===0?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN,hasMoved=y!=this.pY,distance=Math.abs(input.deltaY))),input.direction=direction,hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||!(this.state&STATE_BEGAN)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX,this.pY=input.deltaY;var direction=directionStr(input.direction);direction&&this.manager.emit(this.options.event+direction,input),this._super.emit.call(this,input)}}),inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN)},emit:function(input){this._super.emit.call(this,input);if(input.scale!==1){var inOut=input.scale<1?"in":"out";this.manager.emit(this.options.event+inOut,input)}}}),inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[TOUCH_ACTION_AUTO]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTime=input.deltaTime>options.time;this._input=input;if(!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)this.reset();else if(input.eventType&INPUT_START)this.reset(),this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.time,this);else if(input.eventType&INPUT_END)return STATE_RECOGNIZED;return STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(input){if(this.state!==STATE_RECOGNIZED)return;input&&input.eventType&INPUT_END?this.manager.emit(this.options.event+"up",input):(this._input.timeStamp=now(),this.manager.emit(this.options.event,this._input))}}),inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN)}}),inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var direction=this.options.direction,velocity;return direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)?velocity=input.velocity:direction&DIRECTION_HORIZONTAL?velocity=input.velocityX:direction&DIRECTION_VERTICAL&&(velocity=input.velocityY),this._super.attrTest.call(this,input)&&direction&input.direction&&input.distance>this.options.threshold&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.direction);direction&&this.manager.emit(this.options.event+direction,input),this.manager.emit(this.options.event,input)}}),inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTouchTime=input.deltaTime<options.time;this.reset();if(input.eventType&INPUT_START&&this.count===0)return this.failTimeout();if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END)return this.failTimeout();var validInterval=this.pTime?input.timeStamp-this.pTime<options.interval:!0,validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp,this.pCenter=input.center,!validMultiTap||!validInterval?this.count=1:this.count+=1,this._input=input;var tapCount=this.count%options.taps;if(tapCount===0)return this.hasRequireFailures()?(this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.interval,this),STATE_BEGAN):STATE_RECOGNIZED}return STATE_FAILED},failTimeout:function(){return this._timer=setTimeoutContext(function(){this.state=STATE_FAILED},this.options.interval,this),STATE_FAILED},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==STATE_RECOGNIZED&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Hammer.VERSION="2.0.4",Hammer.defaults={domEvents:!1,touchAction:TOUCH_ACTION_COMPUTE,enable:!0,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:!1}],[PinchRecognizer,{enable:!1},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var STOP=1,FORCED_STOP=2;Manager.prototype={set:function(options){return extend(this.options,options),options.touchAction&&this.touchAction.update(),options.inputTarget&&(this.input.destroy(),this.input.target=options.inputTarget,this.input.init()),this},stop:function(force){this.session.stopped=force?FORCED_STOP:STOP},recognize:function(inputData){var session=this.session;if(session.stopped)return;this.touchAction.preventDefaults(inputData);var recognizer,recognizers=this.recognizers,curRecognizer=session.curRecognizer;if(!curRecognizer||curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)curRecognizer=session.curRecognizer=null;var i=0;while(i<recognizers.length)recognizer=recognizers[i],session.stopped!==FORCED_STOP&&(!curRecognizer||recognizer==curRecognizer||recognizer.canRecognizeWith(curRecognizer))?recognizer.recognize(inputData):recognizer.reset(),!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)&&(curRecognizer=session.curRecognizer=recognizer),i++},get:function(recognizer){if(recognizer instanceof Recognizer)return recognizer;var recognizers=this.recognizers;for(var i=0;i<recognizers.length;i++)if(recognizers[i].options.event==recognizer)return recognizers[i];return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this))return this;var existing=this.get(recognizer.options.event);return existing&&this.remove(existing),this.recognizers.push(recognizer),recognizer.manager=this,this.touchAction.update(),recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",this))return this;var recognizers=this.recognizers;return recognizer=this.get(recognizer),recognizers.splice(inArray(recognizers,recognizer),1),this.touchAction.update(),this},on:function(events,handler){var handlers=this.handlers;return each(splitStr(events),function(event){handlers[event]=handlers[event]||[],handlers[event].push(handler)}),this},off:function(events,handler){var handlers=this.handlers;return each(splitStr(events),function(event){handler?handlers[event].splice(inArray(handlers[event],handler),1):delete handlers[event]}),this},emit:function(event,data){this.options.domEvents&&triggerDomEvent(event,data);var handlers=this.handlers[event]&&this.handlers[event].slice();if(!handlers||!handlers.length)return;data.type=event,data.preventDefault=function(){data.srcEvent.preventDefault()};var i=0;while(i<handlers.length)handlers[i](data),i++},destroy:function(){this.element&&toggleCssProps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},extend(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:STATE_FAILED,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,inherit:inherit,bindFn:bindFn,prefixed:prefixed}),typeof define==TYPE_FUNCTION&&define.amd?define("syracuse-tablet/html/deps/hammerjs-2.0.4/hammer",[],function(){return Hammer}):typeof module!="undefined"&&module.exports?module.exports=Hammer:window[exportName]=Hammer}(window,document,"Hammer"),define("syracuse-tablet/html/js/helpers/scroller/scrollerBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/rect"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),uiRect=require("syracuse-tablet/html/js/ui/rect"),_scrolId=0,_Klass=utils.defineClass(function scroller($$elmt,options){this.options=options=$.extend(!0,{},options),this.name=options.name||"scroller-"+_scrolId++,this.$$elmt=$$elmt,this.isPageScroller=options.isPageScroller===!0,this._initDir(options.direction),this.scrollMax=options.valMax!=null?options.valMax:options.scrollMax!=null?options.scrollMax:0,this.restoredScroll=null},null,{destroy:function(){this.reset(),this.$$elmt=null},isNative:function(){return!1},_initDir:function(dir){if(dir==null){if(this.dir!=null)return;this.dir="v";return}this.dir=dir},init:function(viewRect,dir,scrollMax,preserveScroll){if(viewRect==null)throw new Error("Unexpected null viewRect");var scroll=this.getScroll();preserveScroll===!0&&this.restoredScroll==null&&scroll!=null&&scroll!==this.scrollMax&&(this.restoredScroll=scroll),this.reset(!0),this._initDir(dir),scrollMax!=null&&(this.scrollMax=scrollMax),this.viewRect=viewRect,this._doInit(viewRect,dir,scrollMax,preserveScroll);var refreshed=!1;preserveScroll===!0&&this.restoredScroll!=null&&(refreshed=this.adjust(this.restoredScroll)),refreshed||this._refresh(this.restoredScroll,!0),this.restoredScroll=null,this.$$elmt.removeClass("scrollDisabled").addClass("scrollEnabled")},_doInit:function(viewRect,dir,scrollMax,preserveScroll){throw new Error("Not implemented")},isInitialized:function(){return this.$$elmt!=null&&this.viewRect!=null},reset:function(dontResetValue){dontResetValue!==!0&&this._refresh(this.scrollMax),this.viewRect=null,this.$$elmt&&this.$$elmt.removeClass("scrollEnabled").addClass("scrollDisabled")},_refresh:function(scroll,force){throw new Error("Not implemented")},savedCtxCreate:function(opts){return{scroll:opts==null||opts.noScroll!==!0?this.getScroll():null}},savedCtxRestore:function(ctx,refresh){refresh=!0;if(ctx==null||ctx.scroll==null)return;refresh&&this.isInitialized()?this._refresh(ctx.scroll):this.restoredScroll=ctx.scroll},getOffset:function(){return{top:this.dir=="v"?this.getScroll():0,left:this.dir=="h"?this.getScroll():0}},makeVisible:function($$e){throw new Error("Not implemented")},autoScroll:function(value){throw new Error("Not implemented")},getScroll:function(value){throw new Error("Not implemented")},getScrollMin:function(){throw new Error("Not implemented")},checkViewRect:function(viewRect,preserveScroll){var reset=!0;if(viewRect&&this.$$elmt){var val=this.getScroll();this._scrollToBeginning();var myRect=uiRect.elmtRect(this.$$elmt,"computed"),intersectRect=viewRect.intersectRect(myRect,!1);intersectRect!=null&&(preserveScroll&&(this.resoredVal=val),this.init(intersectRect,null,null),reset=!1,preserveScroll&&this.adjust())}reset&&this.reset()},_scrollToBeginning:function(){this._refresh(this.scrollMax)},adjust:function(restoredScroll){throw new Error("Not implemented")}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/helpers/scroller/hammerScroller",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/deps/hammerjs-2.0.4/hammer","syracuse-tablet/html/js/helpers/scroller/scrollerBase","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("scroll",!1),utils=require("syracuse-tablet/html/js/helpers/utils"),uiRect=require("syracuse-tablet/html/js/ui/rect"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),Hammer=require("syracuse-tablet/html/deps/hammerjs-2.0.4/hammer"),Base=require("syracuse-tablet/html/js/helpers/scroller/scrollerBase").Klass,modules=require("syracuse-tablet/html/js/common/modules"),_getMainScrollOffset=function(){var $$elmt=$("#s-m-app-id");return{top:$$elmt.length>0?$$elmt.scrollTop():0,left:$$elmt.length>0?$$elmt.scrollLeft():0}},_isEvtDirection=function(evt,dir,forceTrueIfNull){if(evt==null)return forceTrueIfNull===!0;if(evt.angle==null)throw new Error("this is not a hammer.js event");return evt.angle>45&&evt.angle<135||evt.angle<-45&&evt.angle>-135?dir=="v":dir=="h"},_stopClickEvent=function(mgr,evt,reason){log&&log("Clicked canceled",reason,mgr.id),evt.stopPropagation(),evt.preventDefault(),evt.$stop=!0},_lastClickTO=400,_slowDown=!0,_slowDownTO=10,_velocityToDist=function(velocity){var v=Math.abs(Math.round(velocity*4));return Math.max(1,v*v/2)},_consts={pan:{v:"panup pandown panstart panend",h:"panleft panright panstart panend"},dir:{v:Hammer.DIRECTION_VERTICAL,h:Hammer.DIRECTION_HORIZONTAL},upEvt:{v:"panup",h:"panleft"}},_Klass=utils.defineClass(function HammerScroller($$elmt,options,parentMgr){options=options||{},Base.call(this,$$elmt,options),this.id=$$elmt.closest("[id]").attr("id"),this.parentMgr=parentMgr,this.hammer=new Hammer(this.$$elmt.get(0)),this._evtsEnabled=!1},Base,{init:function(viewRect,dir,scrollMax,preserveScroll){Base.prototype.init.call(this,viewRect,dir,scrollMax,preserveScroll)},_initDir:function(dir){Base.prototype._initDir.call(this,dir),this.upEvtType=_consts.upEvt[this.dir]},_doInit:function(viewRect,dir,scrollMax,preserveScroll){this.hammer.get("pan").set({threshold:0,direction:_consts.dir[this.dir]}),this.hammer.get("press").set({time:1}),this._panHandler=Hammer.bindFn(this._onPan,this),this._pressHandler=Hammer.bindFn(this._onPress,this),this._clickHandler=Hammer.bindFn(this._onClick,this),this.$$elmt.on("click",this._clickHandler),this._originalRect=uiRect.elmtRect(this.$$elmt),this._originalScrollOffset=this.isPageScroller?null:_getMainScrollOffset(),this._enableEvents(!0)},_enableEvents:function(yes){if(!this.hammer)return;var wasDisabled=this._evtsEnabled===!1;yes===!0&&this._evtsEnabled!==!0&&(this._evtsEnabled=!0,this.hammer.on(_consts.pan[this.dir],this._panHandler),this.hammer.on("press",this._pressHandler),this.$$elmt.addClass("s-m-scroll"+this.dir)),yes===!1&&this._evtsEnabled!==!1&&(this._evtsEnabled=!1,this.hammer&&(this.hammer.off(_consts.pan[this.dir],this._panHandler),this.hammer.off("press",this._pressHandler)),this.$$elmt.removeClass("s-m-scroll"+this.dir)),wasDisabled||(this.panStart=!1,this._stopSlowingDown(),this.cancelClick=!1,this.lastClickAllowed=null)},reset:function(dontResetValue){Base.prototype.reset.call(this,dontResetValue),this._enableEvents(!1),this.$$elmt&&this.$$elmt.off("click",this._clickHandler),this.panStart=!1,this._stopSlowingDown(),this.cancelClick=!1,this.lastClickAllowed=null,this.val=null,this.isLocked=!1},destroy:function(){Base.prototype.destroy.call(this),this.hammer&&(this.hammer.destroy(),this.hammer=null),this._panHandler=null,this._pressHandler=null,this._toggleRect(!1),this._clickHandler=null,notifications.unsubscribe(this)},_refresh:function(scroll,force){if(!this.$$elmt)return;this._setScroll(scroll),this.dir=="v"?this.$$elmt.css({top:this.getScroll()+"px"}):this.$$elmt.css({left:this.getScroll()+"px"})},_getScrollOffset:function(){if(this.isPageScroller||this._originalScrollOffset==null)return null;var o=_getMainScrollOffset();return{top:o.top-this._originalScrollOffset.top,left:o.left-this._originalScrollOffset.left}},_toggleRect:function(remove){if(this._$$viewRect)this._$$viewRect.remove(),this._$$viewRect.off("click",this._clickHandler),this._$$viewRect=null;else if(remove!==!1){this._$$viewRect=this.viewRect.showInDocument();var o=this._getScrollOffset();o&&this._$$viewRect.css({marginTop:"+="+o.top,marginLeft:"+="+o.left}),this._$$viewRect.on("click",this._clickHandler)}},_onClick:function(evt){log&&log("onClick Status","slowingDown:",this.slowingDown,"panStart:",this.panStart,"cancelClick:",this.cancelClick,"lastClickAllowed:",this.lastClickAllowed?(new Date).getTime()-this.lastClickAllowed:null),evt.$stop=!1;if(evt.shiftKey)return this._toggleRect(),_stopClickEvent(this,evt,"Show rectangle");if(this._evtsEnabled===!1)return;if(this.slowingDown)return _stopClickEvent(this,evt,"slowing down");if(this.cancelClick)return this.cancelClick=!1,_stopClickEvent(this,evt,"Click canceled");if(this.lastClickAllowed!=null&&(new Date).getTime()-this.lastClickAllowed<0)return this.lastClickAllowed=null,_stopClickEvent(this,evt,"Last click timeout");if(this.parentMgr&&this.parentMgr.dir!=this.dir){this.parentMgr._onClick(evt);if(evt.$stop===!0)return _stopClickEvent(this,evt,"Parent stopped click")}log&&log("onClick not stopped")},_onPress:function(evt){this.lastPress=(new Date).getTime(),this.slowingDown&&(this._stopSlowingDown(),this.cancelClick=!0),this.parentMgr&&(this.parentMgr.isLocked=!1),log&&log(this.id,"onPress","slowingDown="+this.slowingDown,"panStart="+this.panStart,"cancelClick ="+this.cancelClick,"lastClickAllowed ="+this.lastClickAllowed)},_onPan:function(evt){log&&log(this.id,evt.type,this.dir,_isEvtDirection(evt,this.dir),"isLocked",this.isLocked);if(!_isEvtDirection(evt,this.dir))return;if(this.isLocked===!0)return;try{if(evt.type==="panstart")log&&log(evt.type),this.panStart=!0,this.cancelClick=!0,this._stopSlowingDown(),this.parentMgr&&this.parentMgr.dir===this.dir&&(this.parentMgr.isLocked=!0);else if(evt.type==="panend"){log&&log(evt.type),this.panStart=!1,_slowDown&&this.lastVelocity!=null?(this.lastVelocity=Math.abs(this.lastVelocity),this.lastVelocity>.3&&this.lastVelocity<1?this.lastVelocity=1:this.lastVelocity=Math.min(this.lastVelocity,2),this.lastVelocity>=1?(this.slowingDown=!0,this._slowDown(this.lastVelocity,this.lastUp),this.lastVelocity=this.lastUp=null):this.parentMgr&&(this.parentMgr.isLocked=!1)):(this.lastClickAllowed=(new Date).getTime()+_lastClickTO,this.parentMgr&&(this.parentMgr.isLocked=!1));return}var up=evt.type===this.upEvtType||evt.type==="panstart"&&evt.deltaY<0;this._move(_velocityToDist(evt.velocity),up)?(this.lastVelocity=Math.abs(evt.velocity),this.lastUp=up):this.lastVelocity=this.lastUp=null}catch(e){return console.log(JSON.stringify(jsutils.convertToDiagnoses(e),null,2)),!1}},_stopSlowingDown:function(){this.slowingDown=!1,this.parentMgr&&(this.parentMgr.isLocked=!1)},_slowDown:function(v,up){var self=this;if(self.panStart||!self.slowingDown){this._stopSlowingDown();return}if(v<1){this._stopSlowingDown();return}self._move(_velocityToDist(v),up)?setTimeout(function(){self._slowDown(v,up)},_slowDownTO):this._stopSlowingDown()},_move:function(dist,up){if(!this.isInitialized()||dist==0)return;try{var scroll=this.getScroll(),val=up?scroll-dist:scroll+dist,valMin=this.getScrollMin();val=Math.max(Math.min(this.scrollMax,val),valMin);if(val===this.scrollMax||val===valMin){log&&log(this.id,"end scrolling"),this.lastClickAllowed=(new Date).getTime()+_lastClickTO,this.cancelClick=!1;if(scroll===val)return!1}return this._refresh(val),!0}catch(e){return console.log(JSON.stringify(jsutils.convertToDiagnoses(e),null,2)),!1}},makeVisible:function($$e,smoothOffset){var scale=modules.get("siteLayout").getTransformScale(),prop=this.dir==="v"?"top":"left",size=this.dir==="v"?"height":"width";if(!$$e||!this.isInitialized()||!this._evtsEnabled||$$e.closest(this.$$elmt).length===0)return;this.slowingDown&&(this._stopSlowingDown(),this.cancelClick=!0);var smooth=smoothOffset!=null;smoothOffset=smooth?smoothOffset:0,scale!=0&&scale!=1&&(smoothOffset*=1/scale);var o=$$e.offset();o[prop]=o[prop]+smoothOffset;var viewRectProp=this.viewRect[prop]*scale,viewRectSize=this.viewRect[size]*scale;this.$$elmt.css("visibility","hidden");var f=o[prop]>viewRectProp?-1:1,stopPos=Math.max(viewRectProp+viewRectSize-$$e[size](),viewRectProp+viewRectSize/2),step=f*(smooth?20:50),stop=!1;while(!stop){var pos=$$e.offset()[prop]+smoothOffset;stop=f>0?pos>stopPos:pos<stopPos,stop||this._refresh(this.getScroll()+step)}var valMin=this.getScrollMin();this.getScroll()<valMin&&this._refresh(valMin),this.getScroll()>this.scrollMax&&this._refresh(this.scrollMax),this.$$elmt.css("visibility","visible")},autoScroll:function(value){this._move(Math.abs(value),value<0)},getScrollMin:function(){var prop=this.dir=="v"?"height":"width",x=this.$$elmt[prop](),scale=modules.get("siteLayout").getTransformScale();return scale>0&&scale!=1&&(x*=1/scale),Math.min(this.scrollMax-x+this.viewRect[prop]-30,this.scrollMax)},_setScroll:function(v){if(v==null||isNaN(v))v=this.scrollMax;this.val=v},getScroll:function(){return this.val},adjust:function(restoredScroll){if(!this.isInitialized())return!1;var elmtRect=uiRect.elmtRect(this.$$elmt);if(this.viewRect.contains(elmtRect))this._refresh(this.scrollMax);else{restoredScroll=restoredScroll==null?this.getScroll():restoredScroll,restoredScroll>this.scrollMax&&(restoredScroll=this.scrollMax);var prop=this.dir=="v"?"height":"width",valmin=this.scrollMax-elmtRect[prop]+this.viewRect[prop];restoredScroll<valmin&&(restoredScroll=this.getScrollMin()),this._refresh(restoredScroll)}return!0}});exports.Klass=_Klass,exports.Hammer=Hammer,exports.isEvtDirection=_isEvtDirection}),define("syracuse-tablet/html/js/helpers/scroller/nativeScroller",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/scroller/scrollerBase","syracuse-tablet/html/js/ui/rect"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/helpers/scroller/scrollerBase").Klass,uiRect=require("syracuse-tablet/html/js/ui/rect"),_consts={dirToAxis:{v:"y",h:"x"},dirToOtherAxis:{v:"x",h:"y"}},_Klass=utils.defineClass(function NativeScroller($$elmt,options){Base.call(this,$$elmt,options)},Base,{isNative:function(){return!0},_doInit:function(viewRect,dir,scrollMax,preserveScroll){var css={};css["overflow-"+_consts.dirToAxis[this.dir]]="auto",css["overflow-"+_consts.dirToOtherAxis[this.dir]]="hidden",this.$$elmt.addClass("isScrollElmt").parent().css(css).addClass("isScrollWrapper");var css={};if(this.scrollMax===0&&this.options.nopadding!==!0){var prop=this.dir==="h"?"right":"bottom";css["padding-"+prop]="10px"}var prop=this.dir==="h"?"width":"height",valProp=this.viewRect[prop];this.$$elmt.parent()[prop](valProp).css(css)},reset:function(dontResetValue){var wasInitialized=this.isInitialized();Base.prototype.reset.call(this,dontResetValue);if(!this.$$elmt||!wasInitialized)return;var prop=this.dir==="h"?"width":"height";this.$$elmt.parent().css(prop,"100%")},getScroll:function(){return this.$$elmt?this.$$elmt.parent()[this.dir==="h"?"scrollLeft":"scrollTop"]():this.scrollMax},_refresh:function(scroll,force){if(!this.$$elmt)return;if(scroll==null&&force!==!0)return;scroll=Math.max(scroll==null?this.scrollMax:scroll,this.scrollMax);var cur=this.getScroll();if(cur===scroll&&force!==!0)return;this.$$elmt.parent()[this.dir==="h"?"scrollLeft":"scrollTop"](scroll)},makeVisible:function($$e){if(!$$e||$$e.length===0||$$e.is(":visible")||!$$e.get(0).scrollIntoView)return;$$e.get(0).scrollIntoView(!1)},autoScroll:function(value){this.isInitialized()?this._refresh(value,!0):this.restoredScroll=value},getScrollMin:function(){return this.$$elmt?this.$$elmt.height():0},adjust:function(restoredScroll){return this.isInitialized()?(this.viewRect.contains(uiRect.elmtRect(this.$$elmt))?this._refresh(this.scrollMax):this._refresh(restoredScroll==null?this.getScroll():restoredScroll),!0):!1}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers",["require","exports","module","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/helpers/scroller/hammerScroller","syracuse-tablet/html/js/helpers/scroller/nativeScroller"],function(require,exports,module){var uiRect=require("syracuse-tablet/html/js/ui/rect"),environment=require("syracuse-tablet/html/js/helpers/environment"),_scrollerId=1,_ctor={desktop:require("syracuse-tablet/html/js/helpers/scroller/hammerScroller").Klass,"native":require("syracuse-tablet/html/js/helpers/scroller/nativeScroller").Klass},_createSimpleScroller=function($$elmt){var $$scrolls=$$elmt.find(".s-m-scroll-element"),i,scrollers={};for(i=0;i<$$scrolls.length;i++){_scrollerId++;var $$se=$($$scrolls[i]),$$wrapper=$$se.parent(),dir=$$wrapper.hasClass("s-m-scroll-wrapper-h")?"h":"v";$$wrapper.attr("data-scroller-id",_scrollerId);var parentScroller=null,$$parentScroller=$$wrapper.parent().closest(".s-m-scroll-wrapper");$$parentScroller.length>0&&(parentScroller=scrollers[$$parentScroller.attr("data-scroller-id")]);var css={};css["overflow-"+dir]="auto",$$wrapper.css(css);var gestureMgr=_newScroller($$se,{direction:dir,valMax:0,name:"_scroller_"+_scrollerId,isPageScroller:!1},parentScroller);scrollers[_scrollerId]=gestureMgr,gestureMgr.reset();var scrollRect=uiRect.elmtRect($$se,"outer"),wrapperRect=uiRect.elmtRect($$wrapper,"outer"),viewRect=wrapperRect.intersectRect(scrollRect);viewRect&&!viewRect.contains(scrollRect)&&gestureMgr.init(viewRect)}return scrollers},_newScroller=function($$elmt,options,parentMgr,forceNative){var name;environment.isNativeScrolling()||forceNative?name="native":name="desktop";var Klass=_ctor[name];if(!Klass)throw new Error("Scroller not initialized");return $$elmt.addClass(name+"Scroll"),new Klass($$elmt,options,parentMgr)};exports.newScroller=_newScroller,exports.createSimpleScroller=_createSimpleScroller}),define("syracuse-tablet/html/js/ui/modals/modalDialog",["require","exports","module","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var globals=require("syracuse-tablet/html/js/app/globals"),utils=require("syracuse-tablet/html/js/helpers/utils"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),uiRect=require("syracuse-tablet/html/js/ui/rect"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),modules=require("syracuse-tablet/html/js/common/modules"),_dialogTpl='	<div class="modal {{displayFlags.modalClass}}" tabindex="-1" role="dialog">	<div class="modal-dialog">	<div class="modal-content"> 		{{{header}}} 		{{{headerContent}}} 		<div class="modal-body">{{{content}}}</div> 		{{{footer}}} 	</div> 	</div>	</div>',_openModalsPromises=[],_Klass=utils.defineClass(function BaseModal(){var self=this,site=modules.get("siteLayout");self.deviceType=site.getDeviceType(),self.displayFlags={modalClass:""},notifications.subscribe(this,["sm.main.layout.changed"])},null,{destroy:function(){this.$$elmt&&(this.$$elmt.unbind(),this.$$elmt.remove()),this._checkShowNextModal(),notifications.unsubscribe(this)},_checkShowNextModal:function(){_openModalsPromises.shift(),_openModalsPromises.length>0&&_openModalsPromises[0].resolve(this)},_getTemplates:function(){return{std:{},tablet:{},smartphone:{}}},_getDataContext:function(){return{}},_onValidate:function(){},_onCancel:function(){},_getResult:function(){},_onAction:function(action,param){},_compileTpl:function(){var self=this,htmlTpls=self._getTemplates(),htmlTpl=htmlTpls[self.deviceType]||htmlTpls.std,tpl={header:Handlebars.compile(htmlTpl.header),headerContent:htmlTpl.headerContent?Handlebars.compile(htmlTpl.headerContent):"",content:Handlebars.compile(htmlTpl.content),footer:Handlebars.compile(htmlTpl.footer)};return tpl},_getWrapperTemplate:function(){return Handlebars.compile(_dialogTpl)},_ensureParent:function(){var self=this,parentName=globals.isAuthoringActive()?"s-m-modal-parent-auth":"s-m-modal-parent",$$parent=$("#"+parentName),site=modules.get("siteLayout");$$parent.length<1&&($$parent=$("<div>"),$$parent.attr("id",parentName),globals.isAuthoringActive()?$("body").append($$parent):($("#s-m-app-container-id").css({width:"100%",height:"100%"}),$("#s-m-app-id").show().addClass("s-m-modal-parent "+site.getDeviceType()+" "+site.getPageOrientation()).append($$parent))),self.$$parent=$$parent,self.$$parent.addClass(site.getDeviceType()+" "+site.getPageOrientation())},_createDOM:function(){var self=this;self.$$elmt=$(self.html)},getDisplayFlags:function(){var self=this;return self.displayFlags},_hookEvents:function(){var self=this;self.$$elmt.on("shown.bs.modal",self._onShow.bind(self)),self.$$elmt.on("hide.bs.modal",self._onHide.bind(self)),self.$$elmt.delegate("[data-action]","click",self._onButton.bind(self))},_attachDOM:function(){var self=this;self.$$parent.toggle(!0),self.$$parent.append(self.$$elmt),self.$$elmt.modal({keyboard:!1,backdrop:"static"})},_onShow:function(evt){var self=this;self.$$elmt.css("padding-left",""),self._calcSize();var app=modules.get("appController").App;app&&(app.onModalOpened(),self._initScrollers(),notifications.subscribe(self,"sm.main.layout.changed"))},notifMainLayoutChanged:function(info,orientation,deviceType){},_onHide:function(evt){var self=this;self.$$parent.toggle(!1);var app=modules.get("appController").App;app&&app.onModalClosed(),self.deferred.resolve(self._getResult()),self.destroy()},_onButton:function(evt){var self=this,$$t=$(evt.currentTarget),param=$$t.attr("data-params"),act=$$t.attr("data-action");if(act){evt.preventDefault(),evt.stopPropagation();var res;act==="$validate"?res=self._onValidate():act==="$cancel"?res=self._onCancel():res=self._onAction(act,param),utils.toPromise(res).then(function(res){res!==!1&&self.$$elmt.modal("hide")})}else self.$$elmt.modal("hide")},show:function(forceDisplay){var self=this,startShow=new $.Deferred;return forceDisplay===!0&&(_openModalsPromises=[]),_openModalsPromises.push(startShow),(_openModalsPromises.length===1||forceDisplay===!0)&&startShow.resolve(),self.deferred=new $.Deferred,startShow.then(function(previousDlog){return $.smResolve().then(function(){return self._getDataContext()}).then(function(data){return self.data=data,previousDlog&&utils.areEqual(self.data,previousDlog.data)?!0:!1})}).then(function(stop){if(stop===!0){self.destroy();return}self.template=self._compileTpl();var outerTpl=self._getWrapperTemplate(),header=self.template.header(self.data),footer=self.template.footer(self.data),headerContent=self.template.headerContent?self.template.headerContent(self.data):"";header.length>0&&(header='<div class="modal-header">'+header+"</div>"),footer.length>0&&(footer='<div class="modal-footer">'+footer+"</div>"),headerContent.length>0&&(headerContent='<div class="modal-header-content">'+headerContent+"</div>"),self.html=outerTpl({header:header,headerContent:headerContent,content:self.template.content(self.data),footer:footer,displayFlags:self.getDisplayFlags()}),self._ensureParent(),self._createDOM(),self._hookEvents(),self._attachDOM()}).fail(function(e){_openModalsPromises=[],self.deferred.reject(e)}),self.deferred.promise()},_initScrollers:function(){scroller.createSimpleScroller(this.$$elmt)},_calcSize:function(){var self=this,df=self.getDisplayFlags(),$$content=self.$$elmt.find(".modal-content"),$$header=self.$$elmt.find(".modal-header"),$$body=self.$$elmt.find(".modal-body"),$$footer=self.$$elmt.find(".modal-footer"),$$headerContent=self.$$elmt.find(".modal-header-content"),header=$$header.length>0?uiRect.elmtRect($$header,"outer").height:0,footer=$$footer.length>0?uiRect.elmtRect($$footer,"outer").height:0,headerContent=$$headerContent.length>0?uiRect.elmtRect($$headerContent,"outer").height:0;$$headerContent.css({top:header}),$$body.css({top:header+headerContent,height:$$content.height()-header-footer-headerContent})}}),_checkMsg=function(msg){return msg?msg.replace(/\n/g,"<br>"):""};exports.checkMsg=_checkMsg,exports.ModalBase=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalDiagnoses",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/scroller/hammerScroller","syracuse-tablet/html/js/ui/siteLayout"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),uiRect=require("syracuse-tablet/html/js/ui/rect"),hammerScroller=require("syracuse-tablet/html/js/helpers/scroller/hammerScroller"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),_templateAll={header:'		<div class="modal-title {{severity}}">{{title}}</div>',content:'		<div class="s-m-modal-diag-content">			{{#each diags}} 				<message id="s-m-msg-block-{{id}}" role="alert" style="display:{{this.display}}"> 					<div style="white-space: pre-line; user-select: initial;">{{this.message}}</div> 					{{#if stack}} 						<section>							<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">								<stack name="s-m-scroll-element stack" class="s-m-msg-stack-content"> 									{{{this.stack}}} 								</stack> 							</div> 						</section>					{{/if}} 				</message> 			{{/each}}		</div>		<div class="s-m-modal-diag-goto">			{{#each diags}}				<a id="s-m-msg-goto-{{id}}" data-action="goto" data-params="{{id}}">					<i class="fa fa-circle-o" data-action="goto" data-params="{{id}}"></i>				</a>			{{/each}}		</div>',footer:'		<buttons>		{{#if showmore}}			<button type="button" id="s-m-msg-stacks" class="btn btn-default" data-action="more">{{stackShow}}</button>		{{/if}}			<button type="button" class="btn btn-default" data-action="$cancel">{{close}}</button>		</buttons>		'},_Klass=utils.defineClass(function ModalDiagnoses(title,diag){var self=this;modalDialog.ModalBase.call(self),self.title=title,self.diag=diag,self.diagId=0,self.curMsg=0},modalDialog.ModalBase,{destroy:function(){var self=this;this._destroySwiper(),this._gestureMgrMap&&!$.isEmptyObject(this._gestureMgrMap)&&($.each(this._gestureMgrMap,function(key,gestureMgr){gestureMgr.destroy()}),this._gestureMgrMap=null),modalDialog.ModalBase.prototype.destroy.call(self)},_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="diagnoses tablet":displayFlags.modalClass="diagnoses mobile",displayFlags},_getDataContext:function(){var self=this,ctx={close:locale.text("modal.btn.close").toUpperCase()||"CLOSE",stackShow:locale.text("modal.diagnoses.btnstack_show").toUpperCase(),severity:"info",diags:[],showmore:!1};return self.diag.$diagnoses.forEach(function(d){var sev;d.$severity==="success"||d.$severity==="info"||d.$severity==="warning"?sev=d.$severity:(sev="danger",ctx.severity="error");var ctxDiag={id:self.diagId,display:self.diagId===0?"block":"none",message:d.$message,severity:sev,severityLabel:locale.text("severity."+sev)};if(d.$stackTrace){var a=d.$stackTrace.split("\n");a.length>20&&(a.length=20,a.push("...")),ctxDiag.stack=a.join("<br>"),ctx.showmore=!0}ctx.diags.push(ctxDiag),self.diagId++}),self.title=self.title||(ctx.severity==="error"?locale.text("modal.error.ttl"):locale.text("modal.info.ttl")),ctx.title=self.title,ctx},_onAction:function(action,param){var self=this;switch(action){case"next":self._next();break;case"prev":self._prev();break;case"more":self._more();break;case"goto":self._goTo(param)}return!1},_goTo:function(id){var self=this;for(var ii=0,jj=self.diagId;ii<jj;ii++)$("#s-m-msg-block-"+ii,self.$$elmt).css("display",ii==id?"block":"none");self.curMsg=parseInt(id,10),self._updateButtons()},_next:function(){var self=this;self.curMsg<self.diagId-1&&($("#s-m-msg-block-"+self.curMsg,self.$$elmt).css("display","none"),self.curMsg++,$("#s-m-msg-block-"+self.curMsg,self.$$elmt).css("display","block"),self._updateButtons())},_prev:function(){var self=this;self.curMsg>0&&($("#s-m-msg-block-"+self.curMsg,self.$$elmt).css("display","none"),self.curMsg--,$("#s-m-msg-block-"+self.curMsg,self.$$elmt).css("display","block"),self._updateButtons())},_more:function(){var self=this,$$btn=$("#s-m-msg-stacks",self.$$elmt),$$parent=$("#s-m-msg-block-"+self.curMsg),$$stackSection=$("section",self.$$elmt);$$stackSection.css("display")==="none"?($$stackSection.css("display","block"),$$btn.text(locale.text("modal.diagnoses.btnstack_hide").toUpperCase()),self._handleGesture()):($$stackSection.css("display","none"),$$btn.text(locale.text("modal.diagnoses.btnstack_show").toUpperCase()))},notifMainLayoutChanged:function(info,orientation,deviceType){info.orientationChanged&&this._css(orientation,deviceType)},_css:function(orientation,deviceType){if(deviceType!=="smartphone")return;var $$modalDialog=$(".modal-dialog",this.$$elmt);orientation==="portrait"?$$modalDialog.css("margin-top","50%"):$$modalDialog.css("margin-top","")},_updateButtons:function(){var self=this;for(var ii=0,jj=self.diagId;ii<jj;ii++){var $$navDot=$("a#s-m-msg-goto-"+ii+" i",self.$$elmt);$$navDot.toggleClass("fa-circle",ii==self.curMsg),$$navDot.toggleClass("fa-circle-o",ii!==self.curMsg)}self.diagId>1?$(".modal-title",self.$$elmt).text(self.title+" ("+(self.curMsg+1)+"/"+self.diagId+")"):$(".s-m-modal-diag-goto",self.$$elmt).css("display","none")},_onShow:function(evt){var self=this;self._updateButtons(),self._css(siteLayout.getPageOrientation(),siteLayout.getDeviceType()),self._checkSize(),self.diagId>1&&self._initSwiper()},_handleGesture:function(){var self=this;self._gestureMgrMap=self._gestureMgrMap||{};if(!self._gestureMgrMap["gestureMgr"+self.curMsg]){var $$scrollElmt=$(".s-m-msg-stack-content",$("#s-m-msg-block-"+self.curMsg,self.$$elmt)),$$wrapper=$(".s-m-scroll-wrapper",$("#s-m-msg-block-"+self.curMsg,self.$$elmt));self._gestureMgrMap["gestureMgr"+self.curMsg]=scroller.newScroller($$scrollElmt,{direction:"v"});var scrollRect=uiRect.elmtRect($$wrapper,"outer");self._gestureMgrMap["gestureMgr"+self.curMsg].init(scrollRect)}},_onSwipe:function(evt){if(hammerScroller.isEvtDirection(evt,"v"))return;var self=this;setTimeout(function(){var next=evt?evt.type==="swipeleft":null;next?self._next():self._prev()})},_destroySwiper:function(){var self=this;self.hammer&&(self.hammer.destroy(),self.hammer=null)},_initSwiper:function(){var self=this;self._destroySwiper(),self.hammer=new hammerScroller.Hammer($(".s-m-modal-diag-content",self.$$elmt).get(0)),self.hammer.get("swipe").set({direction:hammerScroller.Hammer.DIRECTION_HORIZONTAL}),this.hammer.on("swipeleft swiperight",hammerScroller.Hammer.bindFn(self._onSwipe,self))},_checkSize:function(){var self=this,$$app=$("#s-m-app-id"),$$stacks=$("message > section",self.$$elmt),maxHeight=this.$$elmt.height()-(parseInt($(".modal-dialog",this.$$elmt).css("marginTop"),10)+$(".modal-dialog",this.$$elmt).height()+10);$$stacks.css({"max-height":maxHeight+"px"})}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalConfirm",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/siteLayout"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),locale=require("syracuse-tablet/html/js/helpers/locale"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),_templateAll={header:'		<div class="modal-title">{{title}}</div>',content:'			<div class="s-m-modal-content">				{{message}}			</div>',footer:'		<buttons class="pull-right"> 		<button type="button" class="btn btn-default" data-action="yes">{{yes}}</button> 		<button type="button" class="btn btn-default" data-action="no">{{no}}</button>		</buttons>'},_Klass=utils.defineClass(function ModalConfirm(message,action,isSimpleConfirm){var self=this;modalDialog.ModalBase.call(self),self.message=message,self.action=action,self.isSimpleConfirm=isSimpleConfirm},modalDialog.ModalBase,{_getTemplates:function(){var self=this;return{std:_templateAll}},_onShow:function(evt){var self=this;self._css(siteLayout.getPageOrientation(),siteLayout.getDeviceType())},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="confirm tablet":displayFlags.modalClass="confirm mobile",displayFlags},_getDataContext:function(){var self=this,ctx={};return ctx.title=self.isSimpleConfirm?null:locale.text("modal.confirm.ttl"),ctx.message=self.action?modalDialog.checkMsg(locale.text("modal.confirm.msg",[self.action])):modalDialog.checkMsg(self.message),ctx.yes=locale.text("yes").toUpperCase(),ctx.no=locale.text("no").toUpperCase(),ctx},_onAction:function(action,param){var self=this;return self.selectedAction=action,!0},_getResult:function(){var self=this;return self.selectedAction},notifMainLayoutChanged:function(info,orientation,deviceType){info.orientationChanged&&this._css(orientation,deviceType)},_css:function(orientation,deviceType){if(deviceType!=="smartphone")return;var $$modalDialog=$(".modal-dialog",this.$$elmt);orientation==="portrait"?$$modalDialog.css("margin-top","50%"):$$modalDialog.css("margin-top","")}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalField",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),locale=require("syracuse-tablet/html/js/helpers/locale"),_templateAll={header:'		<buttons class="pull-right"> 			<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 		</buttons> 		<div class="modal-title">{{title}}</div>',content:"{{{domBody}}}",footer:""},_Klass=utils.defineClass(function ModalField(title,domBody,cb){var self=this;modalDialog.ModalBase.call(self),self.title=title||"Warning",self.domBody=domBody,self.cb=cb},modalDialog.ModalBase,{destroy:function(){modalDialog.ModalBase.prototype.destroy.call(this),this.domBody=null,this.cb=null},_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="field tablet":displayFlags.modalClass="field mobile",displayFlags},_getDataContext:function(){var self=this;return{title:self.title,domBody:self.domBody,close:locale.text("modal.btn.close")}},_onShow:function(evt){var self=this;modalDialog.ModalBase.prototype._onShow.call(self,evt),self._execCb(self.cb,"shown.bs.modal",self.$$elmt)},_onCancel:function(){return!0},_onHide:function(evt){var self=this;modalDialog.ModalBase.prototype._onHide.call(self,evt),self._execCb(self.cb,"hide.bs.modal",self.$$elmt)},_execCb:function(cb,msg,data){if(!cb||arguments.length==0)return;var cb=arguments[0],args=Array.prototype.slice.call(arguments,1);cb.apply(null,args)}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modal",["require","exports","module","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/modals/modalDiagnoses","syracuse-tablet/html/js/ui/modals/modalConfirm","syracuse-tablet/html/js/ui/modals/modalField","syracuse-tablet/html/js/helpers/environment"],function(require,exports,module){var locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),native=require("syracuse-tablet/html/js/helpers/native/native"),modules=require("syracuse-tablet/html/js/common/modules"),ModalDiagnoses=require("syracuse-tablet/html/js/ui/modals/modalDiagnoses").Modal,ModalConfirm=require("syracuse-tablet/html/js/ui/modals/modalConfirm").Modal,ModalField=require("syracuse-tablet/html/js/ui/modals/modalField").Modal,environment=require("syracuse-tablet/html/js/helpers/environment"),_templates={actionMessage:'		<div class="s-m-act-msg {{severityClass}}">			<a draggable="false" href="#"><span class="glyphicon glyphicon-remove"></span></a>			<header>				<div>{{title}}</div>			</header>			<section>				<article>{{message}}</article>			</section>			<footer></footer>		</div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)},_execCb=function(cb,msg,data){if(!cb||arguments.length==0)return;var cb=arguments[0],args=Array.prototype.slice.call(arguments,1);cb.apply(null,args)},_asynchDiagnoses=function(title,diag,forceDisplay){var modal=new ModalDiagnoses(title,diag);return modal.show()},_asynchError=function(title,e){var error=e;title!=null&&typeof title!="string"&&(error=title,title=null);var diag;return diag=jsutils.convertToDiagnoses(error),title==null&&error&&error.$title&&(title=error.$title),_asynchDiagnoses(title,diag)};exports.asynchError=_asynchError;var _error=function(title,e,cb){var error=e,callBack=cb;title!=null&&typeof title!="string"&&(error=title,title=null),typeof e=="function"&&(callBack=e);var diag;return diag=jsutils.convertToDiagnoses(error),title==null&&error&&error.$title&&(title=error.$title),_diagnoses(title,diag,callBack)},_diagnoses=function(title,diag,cb,forceDisplay){var modal=new ModalDiagnoses(title,diag);modal.show(forceDisplay===!0).then(function(result){cb&&cb(result)})},_info=function(title,text,cb){var infoDiag={$diagnoses:[{$severity:"info",$message:text}]};_diagnoses(title,infoDiag,cb)},_warning=function(title,text,cb){_diagnoses(title,{$diagnoses:[{$severity:"warning",$message:text}]},cb)},_confirm=function(action,cb){var modal=new ModalConfirm(null,action);modal.show().then(function(result){cb&&(result==="yes"||result==="no")&&cb(result,"yes"===result)})},_simpleConfirm=function(message,cb){var modal=new ModalConfirm(message,null,!0);modal.show().then(function(result){cb&&(result==="yes"||result==="no")&&cb(result,"yes"===result)})};exports.simpleConfirmPromise=function(options){var deferred=$.Deferred(),modal=new ModalConfirm(options.message,null,!0);return modal.show().then(function(result){(result==="yes"||result==="no")&&deferred.resolve({action:result})}),deferred.promise()};var _field=function(title,domBody,cb){var modal=new ModalField(title,domBody,cb);modal.show()},_notificationHandler=function(options){function toggle(){$$actionModal.toggleClass("show")}function clear(){toggle(),setTimeout(function(){$$actionModal.remove(),options.$$parentSlot.children().length==0&&options.$$parentSlot.hide()},300)}var stop=!1;$(document.body).find(".s-m-act-msg."+options.severityClass).each(function(index){var $e=$(this);if($e.find("div:contains('"+options.title+"')").length>0&&$e.find("div:contains('"+options.body+"')").length>0)return stop=!0,!1});if(stop)return;var h=_getHtml("actionMessage",{title:options.title,message:options.body,severityClass:options.severityClass}),isClosing,$$actionModal=$(h);options.$$parentSlot.prepend($$actionModal),options.$$parentSlot.show();var $$closer=$$actionModal.find("a"),delay=options.delay||"medium";delay=delay==="short"?800:delay==="long"?6e3:3e3,$$closer.bind("click",function(){clear(),isClosing=!0}),setTimeout(function(){toggle()},50);var toggleTimeout=setTimeout(function(){isClosing||clear()},delay)};exports.notify=function(options){var nativeToastMsg=native.hasCapability("toastMessages")===!0;(!environment.isOs("ios")||!nativeToastMsg)&&options!=null&&options.onlyWebapp===!0&&(nativeToastMsg=!1),nativeToastMsg===!0?native.getModule("toastMessages").showToastMessage({Text1:options.title,Text2:options.body,Severity:options.severityClass}):exports.forceNotifyWebApp(options)},exports.forceNotifyWebApp=function(options){if(!options)return;options.$$parentSlot=options.$$parentSlot||modules.get("appController").App.getMessageSlot(),_notificationHandler(options)},exports.noConnectionModal=function(){return _error(locale.text("action.title.offline"),locale.text("action.needs.net"))},exports.createGeneralErrorDiag=function(source){return{$diagnoses:[{$message:locale.text("technical.error.message"),$severity:"error",$stackTrace:JSON.stringify(source)}]}},exports.error=_error,exports.info=_info,exports.warning=_warning,exports.diagnoses=_diagnoses,exports.field=_field,exports.confirm=_confirm,exports.simpleConfirm=_simpleConfirm}),define("syracuse-tablet/html/js/ui/datetimeSelectors/monthChoice",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/types/date"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),_dateApi=require("syracuse-tablet/html/js/helpers/types/date"),_Klass=utils.defineClass(function(){},null,{create:function(parentSlot,dateValue,handler){this.parent=parentSlot,this.handler=handler,this.domItem=document.createElement("nav"),this.domItem.className="s-calendar-quick-list",this._dateValue=dateValue;var table=document.createElement("table");table.className="s-calendar-month-choice";var tbody=document.createElement("tbody");for(var ii=0;ii<6;ii++){var row=document.createElement("tr");row.appendChild(this.drawCell(ii+1,_dateApi.monthName(ii+1,!0),this._dateValue.month)),row.appendChild(this.drawCell(ii+7,_dateApi.monthName(ii+7,!0),this._dateValue.month)),tbody.appendChild(row)}table.appendChild(tbody),this.domItem.appendChild(table),this.parent.appendChild(this.domItem),this.bindEvents(!0)},drawCell:function(value,text,selValue){var td=document.createElement("td");return td.className="s-calendar-my-item",td.syraOnClick="onMonthClick",td.syraValue=value,td.textContent=text,value==selValue&&(td.className+=" s-calendar-select",this.selectedCell=td),td},toggle:function(show){show?this.domItem.style.display="":this.domItem.style.display="none"},onMonthClick:function(picker){this.selectedCell&&(this.selectedCell.className="s-calendar-my-item"),(this.selectedCell=picker).className="s-calendar-my-item s-calendar-select",this._selectedMonth=picker.syraValue;var month=this._selectedMonth?this._selectedMonth:this._dateValue.month;this._currentDate=this._dateValue=_dateApi.fromJsDate(new Date(this._dateValue.year,month-1,this._dateValue.day)),this.handler.onEvent("onCalendarUpdate",this)},bindEvents:function(bind){var self=this;bind?$(self.domItem).delegate("td","click",function(evt){self.onClick(evt),evt.preventDefault(),evt.stopPropagation()}):$(self.domItem).undelegate()},onClick:function(evt){var self=this;while(evt.target){if(evt.target.syraOnClick){this[evt.target.syraOnClick](evt.target,evt);return}evt.target=evt.target.parentNode}},destroy:function(){this.bindEvents(!1),this.domItem=this._dateValue=this.selectedCell=null}});exports.MonthChoice=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/yearChoice",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/types/date"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_dateApi=require("syracuse-tablet/html/js/helpers/types/date"),_Klass=utils.defineClass(function(){},null,{create:function(parentSlot,dateValue,handler){this.parent=parentSlot,this.domItem=document.createElement("nav"),this.domItem.className="s-calendar-quick-list",this.handler=handler,this._dateValue=dateValue,this._selectedYear=this._dateValue.year;var table=document.createElement("table");table.className="s-calendar-year-choice";var tbody=document.createElement("tbody");this.rows=[];for(var ii=0;ii<6;ii++){var row=document.createElement("tr");if(ii==0)this.addPrevNextCell(row,!0),this.addPrevNextCell(row,!1);else{var cuYear=this._dateValue.year+ii-4;row.appendChild(this.drawCell(cuYear,cuYear)),row.appendChild(this.drawCell(cuYear+5,cuYear+5))}tbody.appendChild(row),this.rows.push(row)}table.appendChild(tbody),this.domItem.appendChild(table),this.parent.appendChild(this.domItem),this.bindEvents(!0)},addPrevNextCell:function(row,isPrev){var td=document.createElement("td");td.className="s-calendar-my-link-cell";var link=document.createElement("a");link.className=(link.syraIsPrev=isPrev)?"s-calendar-prev-year":"s-calendar-next-year",link.textContent=(link.syraIsPrev=isPrev)?locale.text("date.month.label.prev"):locale.text("date.month.label.next"),link.syraOnClick="onChangeYear",td.appendChild(link),row.appendChild(td)},drawCell:function(value,text){var td=document.createElement("td");return td.className="s-calendar-my-item",td.syraOnClick="onSelectYear",td.syraValue=value,td.textContent=text,value==this._selectedYear&&(td.className+=" s-calendar-select",this.selectedCell=td),td},toggle:function(show){show?this.domItem.style.display="":this.domItem.style.display="none"},_refreshYearCell:function(td,step){td.syraValue+=step,td.textContent=td.syraValue,td.syraValue==this._selectedYear&&(td.className+=" s-calendar-select",this.selectedCell=td)},onChangeYear:function(picker){var step=picker.syraIsPrev?-10:10;for(var ii=1,jj=this.rows.length;ii<jj;ii++){var nodes=this.rows[ii].childNodes;this._refreshYearCell(nodes[0],step),this._refreshYearCell(nodes[1],step)}},onSelectYear:function(picker){this.selectedCell&&(this.selectedCell.className="s-calendar-my-item"),(this.selectedCell=picker).className="s-calendar-my-item s-calendar-select",this._selectedYear=picker.syraValue;var year=this._selectedYear?this._selectedYear:this._dateValue.year;this._currentDate=this._dateValue=_dateApi.fromJsDate(new Date(year,this._dateValue.month,this._dateValue.day)),this.handler.onEvent("onCalendarUpdate",this)},bindEvents:function(bind){var self=this;bind?$(self.domItem).delegate("td","click",function(evt){self.onClick(evt),evt.preventDefault(),evt.stopPropagation()}):$(self.domItem).undelegate()},onClick:function(evt){var self=this;while(evt.target){if(evt.target.syraOnClick){this[evt.target.syraOnClick](evt.target,evt);return}evt.target=evt.target.parentNode}},destroy:function(){this.bindEvents(!1),this.rows=this.domItem=this._dateValue=this.selectedCell=null}});exports.YearChoice=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/types/date","syracuse-tablet/html/js/ui/datetimeSelectors/monthChoice","syracuse-tablet/html/js/ui/datetimeSelectors/yearChoice"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_dateApi=require("syracuse-tablet/html/js/helpers/types/date"),MonthChoice=require("syracuse-tablet/html/js/ui/datetimeSelectors/monthChoice").MonthChoice,YearChoice=require("syracuse-tablet/html/js/ui/datetimeSelectors/yearChoice").YearChoice,_Klass=utils.defineClass(function(){},null,{onClick:function(evt){var self=this,close;while(evt.target&&evt.target!=self.handler.parentSlot){if(evt.target.getAttribute("data-s-syraOnClick")){close=this[evt.target.getAttribute("data-s-syraOnClick")](evt.target,evt),close&&this.handler.closeContainer();return}evt.target=evt.target.parentNode}},onTodayClick:function(){return this._currentDate=_dateApi.today(),this.field.setFieldValueFromSelector(_dateApi.fromInternalValue(this._currentDate._value).toString()),!0},onDayClick:function(picker){return this.field.setFieldValueFromSelector(_dateApi.fromInternalValue(picker.getAttribute("data-s-syraValue")).toString()),!0},onChangePeriode:function(picker){picker.getAttribute("data-s-syraPeriod")=="month"?this._currentDate=this._currentDate.addMonths(picker.getAttribute("data-s-syraIsPrev")?-1:1):picker.getAttribute("data-s-syraPeriod")=="year"?this._currentDate=this._currentDate.addYears(picker.getAttribute("data-s-syraIsPrev")?-1:1):this._currentDate=this._currentDate.addDays(picker.getAttribute("data-s-syraIsPrev")?-7:7),this.handler.onEvent("onCalendarUpdate",this)},onMonthClick:function(){this.handler.onEvent("onMonthClick",this)},onYearClick:function(){this.handler.onEvent("onYearClick",this)},getValueForSelector:function(field){return field.getValue()&&field.getValue().slice(0,10)},create:function(field,handler){this.domItem=document.createElement("div"),this.domItem.className="s-calendar";var value=this.getValueForSelector(field)||"";return this._selectedDate=value?_dateApi.parse(value):_dateApi.today(),this._selectedDate=this._selectedDate._value==0?_dateApi.today():this._selectedDate,this._currentDate=handler._currentDate||_dateApi.fromInternalValue(this._selectedDate._value),this.field=field,this.handler=handler,this._table=document.createElement("table"),this._table.setAttribute("cellspacing",0),this._table.className="s-calendar-content",this._table.appendChild(this._appendHead()),this._table.appendChild(this.body=document.createElement("tbody")),this._table.appendChild(this._appendFoot()),this.domItem.appendChild(this._table),this._drawBody(),this.domItem},_appendHead:function(){var head=document.createElement("thead"),row=document.createElement("tr"),cell=document.createElement("th");cell.setAttribute("colspan",8),cell.className="s-calendar-month-year";var slot=document.createElement("div");slot.className="s-calendar-month-year-slot",cell.appendChild(slot);var link=document.createElement("a");link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraIsPrev",!0),link.setAttribute("data-s-syraPeriod","year"),link.className="s-calendar-prev s-calendar-prev-year glyphicon glyphicon-fast-backward",slot.appendChild(link),link=document.createElement("a"),link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraIsPrev",!0),link.setAttribute("data-s-syraPeriod","month"),link.className="s-calendar-prev s-calendar-prev-month glyphicon glyphicon-step-backward",slot.appendChild(link),this._monthLink=document.createElement("a"),this._monthLink.className="s-month s-calendar-month-year-link",slot.appendChild(this._monthLink).setAttribute("data-s-syraOnClick","onMonthClick"),this._yearLink=document.createElement("a"),this._yearLink.className="s-year s-calendar-month-year-link",slot.appendChild(this._yearLink).setAttribute("data-s-syraOnClick","onYearClick"),link=document.createElement("a"),link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraPeriod","month"),link.className="s-calendar-next s-calendar-next-month glyphicon glyphicon-step-forward",slot.appendChild(link),link=document.createElement("a"),link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraPeriod","year"),link.className="s-calendar-next s-calendar-next-year glyphicon glyphicon-fast-forward",slot.appendChild(link),row.appendChild(cell),head.appendChild(row),row=document.createElement("tr");var cell=document.createElement("th");cell.className="s-calendar-week-day",row.appendChild(cell);var days=[1,2,3,4,5,6,0];for(var ii=0,jj=days.length;ii<jj;ii++){var cell=document.createElement("th");cell.className="s-calendar-week-day",cell.title=_dateApi.dayName(days[ii]),cell.textContent=_dateApi.dayName(days[ii],!0),row.appendChild(cell)}return head.appendChild(row),head},_appendFoot:function(){var row=document.createElement("tr"),cell=document.createElement("td");cell.setAttribute("colspan",3),cell.className="s-calendar-foot-week";var link=document.createElement("a");link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraPeriod","week"),link.className="s-calendar-prev s-calendar-prev-week glyphicon glyphicon-chevron-left",link.setAttribute("data-s-syraIsPrev",!0),cell.appendChild(link);var label=document.createElement("label");label.className="s-calendar-foot-week-title",label.textContent=locale.text("date.label.week"),cell.appendChild(label),this._weekNumber=document.createElement("label"),this._weekNumber.className="s-calendar-foot-week-title-num",cell.appendChild(this._weekNumber),link=document.createElement("a"),link.setAttribute("data-s-syraOnClick","onChangePeriode"),link.setAttribute("data-s-syraPeriod","week"),link.className="s-calendar-next s-calendar-next-week glyphicon glyphicon-chevron-right",cell.appendChild(link),row.appendChild(cell),cell=document.createElement("td"),cell.setAttribute("colspan",3),cell.className="s-calendar-foot-today",link=document.createElement("a"),link.className="s-calendar-today-link",link.setAttribute("data-s-syraOnClick","onTodayClick"),link.textContent=locale.text("date.label.today"),cell.appendChild(link),row.appendChild(cell),cell=document.createElement("td"),cell.setAttribute("colspan",2),row.appendChild(cell);var foot=document.createElement("tfoot");return foot.appendChild(row),foot},_drawBody:function(){var curMonth=this._currentDate.month||9,month=_dateApi.monthName(curMonth);this._monthLink.textContent=month,this._yearLink.textContent=this._currentDate.year||2014,uiUtils.empty(this.body);var curDate=_dateApi.fromInternalValue(this._currentDate._value),begOfMonth=curDate=curDate.begOfMonth();curDate=curDate.begOfWeek(1);for(var weekRow=0;weekRow<6;weekRow++){var row=document.createElement("tr"),weekDay=weekRow==0?begOfMonth:curDate,cell=document.createElement("td");cell.className="s-calendar-week-num",row.appendChild(cell),cell.textContent=weekDay.week;for(var day=0;day<7;day++){var cell=document.createElement("td");cell.className="s-calendar-day-link",cell.setAttribute("data-s-syraOnClick","onDayClick"),cell.setAttribute("data-s-syraValue",curDate._value);var link=document.createElement("a");link.textContent=curDate.day,curMonth!=curDate.month&&(cell.className+=" s-calendar-other-month"),this._currentDate.equals(curDate)&&(cell.className+=" s-calendar-select",link.className="s-calendar-select"),cell.appendChild(link),row.appendChild(cell),curDate=curDate.addDays(1)}this.body.appendChild(row)}this._weekNumber.textContent=this._currentDate.week},bindEvents:function(bind){var self=this,parentSlot=self.handler.getParentSlot();bind?$(parentSlot).delegate("td, a","click",function(evt){self.onClick(evt),evt.preventDefault(),evt.stopPropagation()}):($(parentSlot).undelegate(),self._month&&self._month.bindEvents(!1),self._year&&self._year.bindEvents(!1))},destroy:function(){this.bindEvents(!1),this._currentDate=this.field=this._currentDate=this.quickList=this._month=this._year=this._selectedDate=this._monthLink=this._yearLink=this._weekNumber=this._quick=this.body=this.domItem=null}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/timeSelector",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/types/time","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),_timeApi=require("syracuse-tablet/html/js/helpers/types/time"),locale=require("syracuse-tablet/html/js/helpers/locale"),_Klass=utils.defineClass(function(){},null,{onClick:function(evt){var self=this,close;while(evt.target){if(evt.target.getAttribute("data-s-syraOnClick")){close=this[evt.target.getAttribute("data-s-syraOnClick")](evt.target,evt),close&&this.handler.closeContainer();return}evt.target=evt.target.parentNode}},setContainer:function($$modalElmt){this.$$modalElmt=$$modalElmt},create:function(field,handler,cb){this.domItem=document.createElement("div"),this.domItem.className="s-time-choice";var options=options||{};this.columns=options.columns||2,this.interval=options.interval||60,this.field=field,this.handler=handler,this.cb=cb,this.curTime=_timeApi.now();var cellCount=1440/this.interval,rowCount=cellCount/this.columns,table=document.createElement("table");table.className="s-time-choice-table",table.setAttribute("cellspacing","0"),table.setAttribute("cellpadding","0");var row,cell,cellIndex=0,timeHour=_timeApi.parse("00:00:00");for(var rr=0;rr<rowCount;rr++){row=document.createElement("tr");for(var col=0;col<this.columns;col++){cell=document.createElement("td"),cell.className="s-time-choice-td";if(cellIndex<cellCount){var link=document.createElement("a");link.className="s-time-choice-a",link.setAttribute("data-s-syraOnClick","onTimeClick"),timeHour.hour==this.curTime.hour&&(link.className+=" s-time-select"),link.textContent=timeHour.toString(locale.getTimeFormat()),cell.appendChild(link)}row.appendChild(cell),timeHour=timeHour.addMinutes(this.interval),cellIndex++}table.appendChild(row)}return this.domItem.appendChild(table),this.domItem},onTimeClick:function(picker){var self=this,fieldVal=_timeApi.parse(picker.textContent,locale.getTimeFormat()).toString();if(!this.cb)return self.field.setFieldValueFromSelector(fieldVal),!0;self.cb(fieldVal,self.handler)},bindEvents:function(bind){var self=this,parentSlot=self.handler.getParentSlot();bind?$(parentSlot).delegate("a","click",function(evt){self.onClick(evt),evt.preventDefault(),evt.stopPropagation()}):$(parentSlot).undelegate()},destroy:function(){this.bindEvents(!1),this.domItem=this.field=this.selectedLink=null}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/datetimeSelectors/monthChoice","syracuse-tablet/html/js/ui/datetimeSelectors/yearChoice","syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector","syracuse-tablet/html/js/ui/datetimeSelectors/timeSelector"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),MonthChoice=require("syracuse-tablet/html/js/ui/datetimeSelectors/monthChoice").MonthChoice,YearChoice=require("syracuse-tablet/html/js/ui/datetimeSelectors/yearChoice").YearChoice,DateSelector=require("syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector").Klass,TimeSelector=require("syracuse-tablet/html/js/ui/datetimeSelectors/timeSelector").Klass,_Klass=utils.defineClass(function(field){this.field=field},null,{onEvent:function(evt,selector){this[evt](selector)},setContainer:function($$container){this.$$container=$$container},setParentSlot:function(parentSlot){this.parentSlot=parentSlot},getParentSlot:function(){return this.parentSlot},onMonthClick:function(selector){var self=this,date=selector._currentDate;uiUtils.empty(self.parentSlot),selector.destroy();var monthChoice=new MonthChoice;monthChoice.create(this.parentSlot,date,self)},onYearClick:function(selector){var self=this,date=selector._currentDate;uiUtils.empty(self.parentSlot),selector.destroy();var yearChoice=new YearChoice;yearChoice.create(self.parentSlot,date,self)},onOpenTime:function(selector){var self=this;self.dateValue=selector.dateValue,uiUtils.empty(self.parentSlot),selector.destroy();var timeSelector=new TimeSelector,sDom=timeSelector.create(self.field,self,self.onSelectTime);self.parentSlot.appendChild(sDom),timeSelector.bindEvents(!0)},onCalendarUpdate:function(selector){var self=this;self._currentDate=selector._currentDate,uiUtils.empty(self.parentSlot),selector.destroy();var dateSelector=new DateSelector,sDom=dateSelector.create(self.field,self);self.parentSlot.appendChild(sDom),dateSelector.bindEvents(!0)},onSelectTime:function(timeVal,handler){var self=handler;self.field.setFieldValueFromSelector(self.dateValue+" "+timeVal),self.closeContainer()},closeContainer:function(){this.$$container.modal("hide")}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/datetimeSelector",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/types/date","syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),_dateApi=require("syracuse-tablet/html/js/helpers/types/date"),Base=require("syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector").Klass,_Klass=utils.defineClass(function(){},Base,{onTodayClick:function(){this._currentDate=_dateApi.today(),this.dateValue=_dateApi.fromInternalValue(this._currentDate._value).toString(),this.handler.onEvent("onOpenTime",this)},onDayClick:function(picker){this.dateValue=_dateApi.fromInternalValue(picker.getAttribute("data-s-syraValue")).toString(),this.handler.onEvent("onOpenTime",this)}});exports.Klass=_Klass}),define("syracuse-tablet/html/js/ui/datetimeSelectors/selectorFactory",["require","exports","module","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/ui/modals/modal","syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector","syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler","syracuse-tablet/html/js/ui/datetimeSelectors/datetimeSelector","syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler","syracuse-tablet/html/js/ui/datetimeSelectors/timeSelector","syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler"],function(require,exports,module){var uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),modal=require("syracuse-tablet/html/js/ui/modals/modal"),_selectors={date:{windows:null,android:null,ios:null,"default":require("syracuse-tablet/html/js/ui/datetimeSelectors/dateSelector").Klass,handler:require("syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler").Klass},datetime:{windows:null,android:null,ios:null,"default":require("syracuse-tablet/html/js/ui/datetimeSelectors/datetimeSelector").Klass,handler:require("syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler").Klass},time:{windows:null,android:null,ios:null,"default":require("syracuse-tablet/html/js/ui/datetimeSelectors/timeSelector").Klass,handler:require("syracuse-tablet/html/js/ui/datetimeSelectors/selectorSwitchHandler").Klass}},getType=function(propertyType){var type;switch(propertyType){case"application/x-date":type="date";break;case"application/x-datetime":type="datetime";break;case"application/x-time":type="time";break;default:type=null}return type},getSelector=function(propertyType){var type=getType(propertyType);if(type===null)throw new Error("Expected date/time/datetime type. Got "+propertyType);var laf=uiSettings.getLookAndFeel(),selector=_selectors[type];selector&&(selector=selector[laf]||selector["default"]);if(!selector)throw new Error("Expected type. Got "+propertyType);return new selector},getHandler=function(field){var type=getType(field.$type);if(type===null)throw new Error("Expected date/time/datetime type. Got "+field.$type);var selector=_selectors[type];if(selector)var handler=selector.handler;return handler?new handler(field):null},_createSelector=function(field){if(!field||!field.setFieldValueFromSelector)throw new Error("_createSelector - Field must implement setFieldValueFromSelector");var sHandler=getHandler(field),ctrlSelector=getSelector(field.$type),selectorDom=ctrlSelector.create(field,sHandler),$$selectorModal=modal.field(field.getTitle(),selectorDom.outerHTML,function(modalEvent,$$modalElmt){modalEvent=="shown.bs.modal"?(sHandler&&(sHandler.setContainer($$modalElmt),sHandler.setParentSlot($$modalElmt.find(".modal-body")[0])),ctrlSelector.bindEvents(!0)):ctrlSelector.destroy()})};exports.createSelector=_createSelector}),define("syracuse-tablet/html/js/controls/fields/ctrlDate",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/ui/datetimeSelectors/selectorFactory"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),selectorFactory=require("syracuse-tablet/html/js/ui/datetimeSelectors/selectorFactory");exports.CtrlDate=utils.defineClass(function CtrlDate(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var value=this.getFormattedValue(this.getValue());this.$isEditMode?(this.addPicker("date",fontUtils.getIconByName(this.$type==="application/x-date"?"datePicker":"timePicker")),this.createMainInput(value)):this.appendTextValue(value)},_actDatePicker:function(){selectorFactory.createSelector(this)}})}),define("syracuse-tablet/html/js/sdata/sdataUtils",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),modules=require("syracuse-tablet/html/js/common/modules"),_rID=/^(.*)\(\'(.*)\'\)$/i;exports.parseSDataURL=function(url,noFail){var res=jsutils.parseURL(url);if(res.query&&res.query.representation){res.representation=res.query.representation,res.facet=null;var p=res.representation.indexOf(".");p!=-1&&(res.facet=res.representation.substr(p+1),res.facet.charAt(0)=="$"&&(res.facet=res.facet.substr(1)),res.representation=res.representation.substr(0,p))}var a;if(res.directory){var idx=res.directory.indexOf("/$services/");idx>-1&&(res.$services=res.directory.substring(idx+11)),a=res.directory.split("/")}if(a==null||a.length<=4){if(noFail===!0)return null;throw new Error("Bad sdata url:"+url)}res.dispatch=a[1];if(res.dispatch!=="mobile1"&&res.dispatch!=="mobile2"&&res.dispatch!=="sdata"){if(noFail===!0)return null;throw new Error("Bad sdata url:"+url)}res.application=a[2],res.contract=a[3],res.dataset=a[4];if(a.length===4)return res;var match=_rID.exec(a[5]);return match&&match.length==3?(res.entity=match[1],res.id=match[2],res.id&&res.id.trim().Length===0&&(res.id=null)):(res.entity=a[5],res.id=null),a.length===5?res:res},exports.clearSyracuseStack=function(d){return d.$stackTrace&&d.$stackTrace.indexOf("node_modulessyracuse-x3")>=0&&(d.$message&&d.$stackTrace.indexOf(d.$message)>=0?delete d.$stackTrace:d.$stackTrace=d.$stackTrace.split("\n")[0]),d},exports.scanDiagnoses=function(data,options){var result=[],done=[],_scan=function(o,prop,path){path||(path=[]);if(done.indexOf(o)>=0)return;if(Array.isArray(o))done.push(o),prop&&path.push(prop),o.forEach(function(e,idx){_scan(e,idx+"",path)}),prop&&path.pop(prop);else if($.isPlainObject(o)){done.push(o);for(var p in o)p==="$diagnoses"?options&&options.remove===!0?delete o[p]:o[p].forEach(function(d){var $path=[].concat(path);prop&&$path.push(prop),p&&$path.push(p),d=exports.clearSyracuseStack($.extend({},d)),d.$path=$path.join("."),result.push(d)}):(prop&&path.push(prop),_scan(o[p],p,path),prop&&path.pop(prop))}};return data!=null&&_scan(data),result},exports.addWhereClause=function(url,where,params){params=params||{};var allParamsSet=!0;where=where.value;var res=where.replace(/\{(\w*?)\}/g,function(m,p1){var value=params[p1];return value==null&&(allParamsSet=!1),value!=null?value:""});return allParamsSet&&(url=url+"&where="+res),url},exports.draftReadData=function(draftId,wrap){return modules.get("storage").getStorage().draftOperation("draftRead",draftId).then(function(ctx){return!ctx||!ctx.dataSet?null:(ctx.dataSet.$clientContext={$mobileProtocol:"stateless",$mobileEndpoint:ctx.endpoint,$mobileApplication:""},ctx.dataSet.$clientContext.$draftContext={comment:ctx.comment,status:ctx.status,errorMsg:ctx.errorMsg},wrap?{data:ctx.dataSet}:ctx.dataSet)})}}),define("syracuse-tablet/html/js/sdata/datasetBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/sdata/sdataUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),helpers=require("syracuse-tablet/html/js/common/helpers"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),_linksAndActionsMetaKeys=["$isHidden","$isDisabled"];exports.DatasetBase=utils.defineClass(function DatasetBase(json,prototype,parent,$bind){this.json=json,this.prototype=prototype,this.parent=parent,this.$bind=$bind,this.root=parent&&parent.root||this,this.dirtyProperties=[],this.childDatasets={},this.deltaChangeListeners=[]},null,{destroy:function(){this.parent&&this.parent.childDatasets&&delete this.parent.childDatasets[this.$bind],this.root=null,this.parent=null,this.prototype=null,this.json=null,this.dirtyProperties=null,this.deltaChangeListeners=null;if(this.childDatasets){var $binds=Object.keys(this.childDatasets);for(var i=0;i<$binds.length;i++){var $bind=$binds[i];this.childDatasets[$bind]&&this.childDatasets[$bind].destroy()}this.childDatasets=null}this.destroyed=!0},getValue:function($bind,useWorkingCopy){if($bind.charAt(0)==="$"&&!this.prototype.propExists($bind))return this.json[$bind];if(this.prototype.propIsSimple($bind))return this.json[$bind];if(this.prototype.propIsReference($bind))return this._getValueReference($bind);if(this.prototype.propIsImage($bind))return this._getValueImage($bind,useWorkingCopy);if(this.prototype.propIsText($bind))return this._getValueText($bind,useWorkingCopy);if(this.prototype.propIsDocument($bind)||this.prototype.propIsBinary($bind))return this._getValueDocument($bind,useWorkingCopy);if(this.prototype.propIsArray($bind))throw new Error("Use getChild to access arrays")},getJsonValue:function($bind){return this.json[$bind]},setValue:function($bind,value){if(this.prototype.propIsSimple($bind)){var oldValue=this.json[$bind];oldValue!==value&&(this.json[$bind]=value,this.setDirty($bind))}else if(this.prototype.propIsImage($bind)){var oldValue=this.json[$bind];this.json[$bind]=value,this.setDirty($bind)}else if(this.prototype.propIsText($bind)){var oldValue=typeof this.json[$bind]!="string"?value:this.json[$bind];this.json[$bind]=value,oldValue!==value&&(this.json[$bind]=value,this.setDirty($bind))}else if(this.prototype.propIsReference($bind))this._setValueReference($bind,value);else if(this.prototype.propIsArray($bind))throw new Error("Use getChild to access arrays")},setProperty:function($bind,prop,value){this.json.$properties||(this.json.$properties={}),this.json.$properties[$bind]||(this.json.$properties[$bind]={}),this.json.$properties[$bind][prop]=value},getProperty:function($bind,prop){var props=this.json.$properties?this.json.$properties[$bind]:null;return props?props&&prop?props[prop]:props:null},getClientContext:function(path){var ctx=this.json.$clientContext||{};return path?utils.getPropByPath(ctx,path,null):ctx},isWorkingCopyMode:function(){return this.getClientContext("$mobileProtocol")==="workingcopy"},isStateLessMode:function(){return this.getClientContext("$mobileProtocol")==="stateless"},_getValueReference:function($bind){var value=this.json[$bind],$refValueName=this.prototype.propGetRefValueName($bind),$value=this.json[$refValueName];return $value==null?null:(value=value||{},value.$value=$value,value)},_getValueImage:function($bind,useWorkingCopy){if(this.json[$bind]){var prop="$url";useWorkingCopy!==!0&&this.prototype.root.isWorkingCopyFacet()&&(prop="$urlStateless");var fieldProto=this.prototype.propGetProto($bind),imageUrl=fieldProto.getValueByPath(prop)||"";return this.resolveExpression(imageUrl,!0)+"?salt="+(new Date).getTime()}return null},_getValueText:function($bind,useWorkingCopy){var prop="$url";useWorkingCopy!==!0&&this.prototype.root.isWorkingCopyFacet()&&(prop="$urlStateless");var fieldProto=this.prototype.propGetProto($bind),textUrl=fieldProto.getValueByPath(prop)||"";return this.resolveExpression(textUrl,!0)},_getValueDocument:function($bind,useWorkingCopy){if(this.json[$bind]==null)return null;var prop="$url";useWorkingCopy!==!0&&this.prototype.root.isWorkingCopyFacet()&&(prop="$urlStateless");var fieldProto=this.prototype.propGetProto($bind),textUrl=fieldProto.getValueByPath(prop)||"";return this.resolveExpression(textUrl,!0)},_setValueReference:function($bind,value){var $refValueName=this.prototype.propGetRefValueName($bind),oldValue=this.json[$refValueName];oldValue!==value&&(this.json[$bind]={},this.json[$refValueName]=value,this.setDirty($bind),this.setDirty($refValueName))},getChild:function($bind){var child=this.childDatasets[$bind];if(!child&&this.prototype.propIsArray($bind)){var data=this.json[$bind];data||(data=this.json[$bind]=[]);var klass;this.prototype.propIsSingleArray($bind)?klass=datasetUtils.getImplementation("SingleArrayDataset"):klass=datasetUtils.getImplementation("MultiArrayDataset");var proto=this.prototype.propGetProto($bind);child=new klass(data,proto,this,$bind),this.childDatasets[$bind]=child}return child},setDirty:function($bind){this.dirtyProperties&&this.dirtyProperties.indexOf($bind)<0&&(console.log("dataset setDirty",$bind),this.dirtyProperties.push($bind)),this.parent&&this.parent.setDirty(this.$bind)},isDirty:function($bind){return $bind!=null?this.dirtyProperties&&this.dirtyProperties.length>0&&this.dirtyProperties.indexOf($bind)>-1||!1:this.dirtyProperties&&this.dirtyProperties.length>0||!1},setClean:function($bind,includeChildren){includeChildren=includeChildren==null?!0:!1;if($bind!=null){var idx=this.dirtyProperties.indexOf($bind);idx>=0&&(this.dirtyProperties.splice(idx,1),includeChildren&&this.childDatasets[$bind]&&this.childDatasets[$bind].setClean()),this.prototype.propExists($bind)&&this.prototype.propIsReference($bind)&&this.setClean(this.prototype.propGetRefValueName($bind))}else{this.dirtyProperties=[];if(includeChildren)for(var childName in this.childDatasets){var child=this.childDatasets[childName];child.setClean()}}this.parent&&this.dirtyProperties.length<1&&this.parent.setClean(this.$bind,!1)},getDiagnoses:function($bind){var diags=this.getValueByPath("$properties."+$bind+".$diagnoses");if(this.prototype.propExists($bind)&&this.prototype.propIsReference($bind)){var $bindValue=this.prototype.propGetRefValueName($bind),valueFieldDiags=this.getValueByPath("$properties."+$bindValue+".$diagnoses");diags=diags||[],Array.prototype.push.apply(diags,valueFieldDiags)}return diags||[]},clearDiagnoses:function($bind){var props=[$bind];this.prototype.propExists($bind)&&this.prototype.propIsReference($bind)&&props.push(this.prototype.propGetRefValueName($bind));var self=this;props.forEach(function(prop){var diags=self.getValueByPath("$properties."+prop+".$diagnoses");diags&&diags.length>0&&(self.json.$properties[prop].$diagnoses=[])})},getData:function(){var data={},props=Object.keys(this.json);for(var i=0;i<props.length;i++){var $bind=props[i],childDataset=this.childDatasets[$bind];childDataset?data[$bind]=childDataset.getData():this.prototype.propIsSingleArray($bind)?(childDataset=this.getChild($bind),data[$bind]=childDataset.getData()):data[$bind]=this.json[$bind]}return data},getDataDelta:function(forceUpdateAll){var delta={$uuid:this.json.$uuid};this.isRoot()&&(delta.$url=this.getUrl(),delta.$etag=this.json.$etag);var i,properties;forceUpdateAll===!0?properties=this.prototype.getPropertyNames():properties=this.dirtyProperties;for(i=0;i<properties.length;i++){var $bind=properties[i];this.childDatasets[$bind]?delta[$bind]=this.childDatasets[$bind].getDataDelta(forceUpdateAll):delta[$bind]=this.json[$bind]}return delta},getDataText:function($bind){var delta,i;for(i=0;i<this.dirtyProperties.length;i++){var $bindDirty=this.dirtyProperties[i];$bindDirty===$bind&&(delta=this.json[$bind])}return delta},resolveExpression:function(exp,isUrl,extraData){var self=this,rescan=!0,max=20;if(exp==null)return exp;while(rescan&&max-->0&&exp.replace)rescan=!1,exp=exp.replace(/\{(\S+?)\}/g,function(m,g1,idx){var value,encode=isUrl&&idx>0&&exp.charAt(idx-1)==="=";return extraData&&g1 in extraData?(value=extraData[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value))):g1 in self.json?(value=self.json[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value))):self.root!=self&&g1 in self.root.json?(value=self.root.json[g1],value&&value.indexOf&&value.indexOf("{")===0?rescan=!0:encode&&(value=encodeURIComponent(value))):(value=self.prototype.resolveExpression(m),rescan=rescan||value!=m&&value&&value.indexOf&&value.indexOf("{")>=0),value});return exp},getUrl:function(useProtoype$Url,$bind){var url;return $bind&&(url=this.prototype.getFieldUpdateUrl($bind)),useProtoype$Url!==!0?this.resolveExpression(url||this.json.$url||this.prototype.json.$url):this.resolveExpression(url||this.prototype.json.$url)},getFacet:function(){if(this.isRoot())return this.prototype.getFacet()},getAction:function($actionName){var actionP=this.prototype.getValueByPath("$actions."+$actionName),actionD=this.getValueByPath("$actions."+$actionName)||{};if(!actionP)return;var action=$.extend(!0,{},actionP,actionD);if(action.$isExcluded===!0||helpers.isOfficeLink(action))return;return action},getActions:function(){var actionsP=this.prototype.getValueByPath("$actions");if(!actionsP)return;var actions={},action;for(var actionName in actionsP)action=this.getAction(actionName),action&&(actions[actionName]=action);return actions},getLink:function($linkName,$bind){var link=datasetUtils.checkQueryFullPage(this.prototype,$linkName);if(link)return link;var path=$bind?"$properties."+$bind+".$item.$links."+$linkName:"$links."+$linkName,linkP=this.prototype.getValueByPath(path),linkD=this.getValueByPath(path);if(!linkP&&!linkD)return;link=$.extend(!0,{},linkP,linkD),link.$url&&/\{(\S+?)\}/.test(link.$url)&&(link.$url=this.resolveExpression(link.$url));if(link.$isExcluded===!0||helpers.isOfficeLink(link))return;return link},getLinks:function($bind){var self=this,path=$bind?"$properties."+$bind+".$item.$links":"$links",linksP=this.prototype.getValueByPath(path),linksNames=[];if(linksP)for(var linkName in linksP)linksNames.push(linkName);var linksD=this.getValueByPath(path);if(linksD)for(var linkName in linksD)linksNames.push(linkName);var links={},link;return linksNames.forEach(function(linkName){link=self.getLink(linkName,$bind),link&&(links[linkName]=link)}),links},isRoot:function(){return this!=null&&this==this.root},getRoot:function(){return this.root},getMetaData:function($bind){var protoMeta=this.prototype.getValueByPath("$properties."+$bind),dataMeta=this.getValueByPath("$properties."+$bind),meta=$.extend(!0,{},protoMeta,dataMeta);return meta},applyDelta:function(delta,context){var i,deltaNotifications={},properties=Object.keys(delta);for(var ii=0,jj=properties.length;ii<jj;ii++){var property=properties[ii],value=delta[property];this._deltaSetValue(property,value,deltaNotifications,context)}for(var $bind in deltaNotifications){var notify=deltaNotifications[$bind];notify.$value&&this._deltaManValueChanged($bind),notify.$meta&&this._deltaManMetaChanged($bind),notify.$action&&this._deltaManActionChanged($bind,notify.$action),notify.$link&&this._deltaManLinkChanged($bind,notify.$link)}},_deltaSetValue:function($bind,value,deltaNotifications,context){if("template"===context){if($bind.smStartsWith("$")||!this.prototype.propExists($bind))return;var meta=this.getMetaData($bind);if(this.prototype.propIsSimple($bind)&&this.prototype.propIsRefValue($bind)){var refFieldName=this.prototype.propGetRefProperty($bind);if(refFieldName&&datasetUtils.isDisabled(this.getMetaData(refFieldName)))return}else if(datasetUtils.isDisabled(meta))return}var i=this.dirtyProperties.indexOf($bind);i>=0&&this.dirtyProperties.splice(i,1);if($bind==="$properties")this._deltaSetProperties(value,deltaNotifications);else if($bind==="$actions")this._deltaSetActions(value,deltaNotifications);else if($bind==="$links")this._deltaSetLinks(value,deltaNotifications);else if($bind.smStartsWith("$"))this.json[$bind]=value;else if(!this.prototype.propExists($bind))this.json[$bind]=value;else if(this.prototype.propIsSimple($bind)){var oldValue=this.json[$bind];this.json[$bind]=value;if(oldValue!==value)if(this.prototype.propIsRefValue($bind)){var refField=this.prototype.propGetRefProperty($bind),notify=deltaNotifications[refField]=deltaNotifications[refField]||{};notify.$value=!0}else deltaNotifications[$bind]=deltaNotifications[$bind]||{},deltaNotifications[$bind].$value=!0}else if(this.prototype.propIsReference($bind)){var oldValue=this.json[$bind];this.json[$bind]=value;var notify=deltaNotifications[$bind]=deltaNotifications[$bind]||{};notify.$value=!0}else if(this.prototype.propIsArray($bind)){var array=this.getChild($bind);array.applyDelta(value,context)}else this.prototype.propIsImage($bind)&&context==="draft"&&(this.json[$bind]=value)},_deltaSetProperties:function(value,deltaNotifications){var properties=Object.keys(value);for(var ii=0,jj=properties.length;ii<jj;ii++){var property=properties[ii];this.json.$properties=this.json.$properties||{},this.json.$properties[property]=value[property];if(this.prototype.propIsRefValue(property)){var refField=this.prototype.propGetRefProperty(property),notify=deltaNotifications[refField]=deltaNotifications[refField]||{};notify.$meta=!0}else deltaNotifications[property]=deltaNotifications[property]||{},deltaNotifications[property].$meta=!0}},_deltaSetActions:function(value,deltaNotifications){var self=this,actions=Object.keys(value);for(var ii=0,jj=actions.length;ii<jj;ii++){var action=actions[ii];this.json.$actions=this.json.$actions||{},this.json.$actions[action]=this.json.$actions[action]||{};var keys=Object.keys(value[action]),changed=!1;keys.some(function(key){if(_linksAndActionsMetaKeys.indexOf(key)>-1&&value[action][key]!==self.json.$actions[action][key])return!0})&&(changed=!0),this.json.$actions[action]=$.extend(!0,this.json.$actions[action],value[action]);if(changed===!0){var status={},$isHidden=this.json.$actions[action].$isHidden;$isHidden==null&&($isHidden=this.prototype.getValueByPath("$actions."+action+".$isHidden")),$isHidden!=null&&(status.$isHidden=$isHidden);var $isDisabled=this.json.$actions[action].$isDisabled;$isDisabled==null&&($isDisabled=this.prototype.getValueByPath("$actions."+action+".$isDisabled")),$isDisabled!=null&&(status.$isDisabled=$isDisabled),deltaNotifications[action]=deltaNotifications[action]||{},deltaNotifications[action].$action=status}}},_deltaSetLinks:function(value,deltaNotifications){var self=this,links=Object.keys(value);for(var ii=0,jj=links.length;ii<jj;ii++){var link=links[ii];this.json.$links=this.json.$links||{},this.json.$links[link]=this.json.$links[link]||{};var keys=Object.keys(value[link]),changed=!1;keys.some(function(key){if(_linksAndActionsMetaKeys.indexOf(key)>-1&&value[link][key]!==self.json.$links[link][key])return!0})&&(changed=!0),this.json.$links[link]=value[link];if(changed===!0){var status={},$isHidden=this.json.$links[link].$isHidden;$isHidden==null&&($isHidden=this.prototype.getValueByPath("$links."+link+".$isHidden")),$isHidden!=null&&(status.$isHidden=$isHidden);var $isDisabled=this.json.$links[link].$isDisabled;$isDisabled==null&&($isDisabled=this.prototype.getValueByPath("$links."+link+".$isDisabled")),$isDisabled!=null&&(status.$isDisabled=$isDisabled),deltaNotifications[link]=deltaNotifications[link]||{},deltaNotifications[link].$link=status}}},_deltaManValueChanged:function($bind){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaValueChanged(this,$bind)},_deltaManMetaChanged:function($bind){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaMetaChanged(this,$bind)},_deltaManLinkChanged:function($bind,metaData){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaLinkChanged(this,$bind,null,metaData)},_deltaManActionChanged:function($bind,metaData){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaActionChanged(this,$bind,metaData)},getValueByPath:function(path){return helpers.getValueByPath(this.json,path)},addDeltaChangeListener:function(listener){this.deltaChangeListeners.indexOf(listener)<0&&this.deltaChangeListeners.push(listener)},removeDeltaChangeListener:function(listener){if(!this.deltaChangeListeners)return;var idx=this.deltaChangeListeners.indexOf(listener);idx>=0&&this.deltaChangeListeners.splice(idx,1)},getDataFreshness:function(){function _check$ResourcesTime($resources){if(!$resources)return;var utcTime=(new Date).getTime();$resources.forEach(function(item){item.$cache&&(utcTime=Math.min(utils.getTimeFromString(item.$cache.$lastUpdated),utcTime))}),freshness.dateTime=utcTime}var freshness={dateTime:(new Date).getTime(),level:"verytainted"};if(this.isRoot()){this.json.$cache?freshness.dateTime=Math.min(freshness.dateTime,utils.getTimeFromString(this.json.$cache.$lastUpdated)):_check$ResourcesTime(this.json.$resources);var diffDays=Math.round(((new Date).getTime()-freshness.dateTime)/864e5);return diffDays<=7&&(freshness.level="tainted"),diffDays<=1&&(freshness.level="fresh"),freshness}return this.root.getDataFreshness()},buildTemplateData:function(){var result={},properties=Object.keys(this.json),self=this;return Object.keys(this.json).forEach(function($bind){if($bind==="$properties"||$bind==="$uuid"){result[$bind]=self.json[$bind];return}if($bind.charAt(0)==="$"||!self.prototype.propExists($bind))return;if(self.prototype.propIsSimple($bind))result[$bind]=self.json[$bind];else if(self.prototype.propIsReference($bind))result[$bind]=self.json[$bind];else if(self.prototype.propIsArray($bind)){var array=self.getChild($bind);result[$bind]=array.buildTemplateData(self.getChild($bind))}}),result},getEditTemplateData:function(){return $.extend(!0,{},this.buildTemplateData())},setEditTemplateData:function(page,data){this.applyDelta(datasetUtils.templateAddRowId(data),"template"),page.controller.forceUpdateServer()},getDraftsData:function(){return $.extend(!0,{},this.json)},setDraftsData:function(data){this.applyDelta(data,"draft")},removeDiagnoses:function(){sdataUtils.scanDiagnoses(this.json,{remove:!0})}})}),define("syracuse-tablet/html/js/sdata/datasetArrayRow",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/sdata/datasetBase"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),Base=require("syracuse-tablet/html/js/sdata/datasetBase").DatasetBase;exports.RowDataset=utils.defineClass(function RowDataset(json,prototype,parent,$bind){Base.call(this,json,prototype,parent,$bind)},Base,{destroy:function(){Base.prototype.destroy.call(this)},getLink:function($linkName,$bind){var link=datasetUtils.checkQueryFullPage(this.prototype,$linkName);if(link)return link;var linkD,parentProp=this.parent&&this.parent.$bind;!$bind&&parentProp&&this.parent.parent&&this.parent.parent.$bind==null&&(linkD=this.parent.parent.getValueByPath("$properties."+parentProp+".$item.$links."+$linkName));var path=$bind?"$properties."+$bind+".$item.$links."+$linkName:"$links."+$linkName,linkP=this.prototype.getValueByPath(path);linkD||(linkD=this.getValueByPath(path));if(!linkP&&!linkD)return;link=$.extend(!0,{},linkP,linkD);if(link.$isHidden)return;return link.$url&&/\{(\S+?)\}/.test(link.$url)&&(link.$url=this.resolveExpression(link.$url)),link},getUuid:function(){return this.json?this.json.$uuid:null}})}),define("syracuse-tablet/html/js/sdata/datasetArray",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/sdata/datasetBase"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),Base=require("syracuse-tablet/html/js/sdata/datasetBase").DatasetBase;exports.ArrayDataset=utils.defineClass(function ArrayDataset(json,prototype,parent,$bind){Base.call(this,json,prototype,parent,$bind),this.rowDatasetsByUuid={}},Base,{destroy:function(){Base.prototype.destroy.call(this);if(this.rowDatasetsByUuid){var $uuids=Object.keys(this.rowDatasetsByUuid);for(var i=0;i<$uuids.length;i++)this.removeDatasetByUuid($uuids[i])}},getChild:function($bind){throw new Error("getChild not supported on ArrayDataset")},isValidIndex:function($index){return $index>=0&&$index<this.getNumRows()},getNumRows:function(){return this.json?this.json.length:0},moveRow:function($uuid,targetIndex){var sourceIndex=this.getRowIndex($uuid);if(sourceIndex==null||sourceIndex===targetIndex)return;if(!this.isValidIndex(sourceIndex)||!this.isValidIndex(targetIndex))return;var rowToMove=this.json[sourceIndex];Math.abs(targetIndex-sourceIndex)===1?(this.json[sourceIndex]=this.json[targetIndex],this.json[targetIndex]=rowToMove):(this.json.splice(sourceIndex,1),this.json.splice(targetIndex,0,rowToMove)),this._setAllRowsDirty()},getRowByIndex:function($index){if(!this.isValidIndex($index))return null;var $uuid=this.json[$index].$uuid,row=this.rowDatasetsByUuid[$uuid];return row||(row=this.createRowDataset(this.json[$index],this.rowPrototype,$uuid,$index)),row},getRowByUuid:function($uuid){var row=this.rowDatasetsByUuid[$uuid];if(!row){var index=this.getRowIndex($uuid);index!=null&&(row=this.createRowDataset(this.json[index],this.rowPrototype,$uuid,index))}return row},getRowIndex:function($uuid){var $index=null;return this.json.some(function(rowData,index){return rowData.$uuid===$uuid?($index=index,!0):!1}),$index},createRowDataset:function(json,prototype,$uuid){var klass=datasetUtils.getImplementation("RowDataset"),row=new klass(json,prototype,this,$uuid);return this.rowDatasetsByUuid[$uuid]=row,row},removeRowDataset:function(dataset){dataset&&dataset.$bind&&this.removeDatasetByUuid(dataset.$bind)},removeDatasetByUuid:function($uuid){var dataset=this.rowDatasetsByUuid[$uuid];dataset&&dataset.destroy(),delete this.rowDatasetsByUuid[$uuid]},_deltaManRowAdded:function($uuid,idx){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaRowAdded(this,this.$bind,$uuid,idx)},_deltaManRowRemoved:function($uuid,idx){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaRowRemoved(this,this.$bind,$uuid,idx)},_deltaManRowMoved:function($uuid,newIdx){for(var i=0;i<this.deltaChangeListeners.length;i++)this.deltaChangeListeners[i].onDeltaRowMoved(this,this.$bind,$uuid,newIdx)},removeRow:function($uuid){throw new Error("not implemented")},removeAllRows:function(){if(this.rowDatasetsByUuid){var $uuids=Object.keys(this.rowDatasetsByUuid);for(var i=0;i<$uuids.length;i++)this._deltaManRowRemoved($uuids[i],i),this.removeRow($uuids[i])}}})}),define("syracuse-tablet/html/js/sdata/datasetArrayMulti",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/datasetArray"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/sdata/datasetArray").ArrayDataset;exports.MultiArrayDataset=utils.defineClass(function MultiArrayDataset(json,prototype,parent,$bind){Base.call(this,json,prototype,parent,$bind),this.rowPrototype=prototype.getProto$Item(),this.rowPrototype.json.$type="tablet/x-array-row",this.rowsDeleted={}},Base,{destroy:function(){Base.prototype.destroy.call(this),this.rowPrototype&&(this.rowPrototype.destroy(),this.rowPrototype=null),this._destroyDeletedRow(),this.rowsDeleted=null},_destroyDeletedRow:function(){if(this.rowsDeleted){for(var i=0;i<this.rowsDeleted.length;i++)this.rowsDeleted[i].destroy();this.rowsDeleted={}}},addRow:function(){var $uuid=utils.UUID(),rowData={$uuid:$uuid};return this.json.push(rowData),this.setDirty($uuid),this.getRowByUuid($uuid)},removeRow:function($uuid){var idx=this.getRowIndex($uuid);idx!=null&&this.json.splice(idx,1);var row=this.getRowByUuid($uuid);row&&(this.setDirty($uuid),this.rowsDeleted[$uuid]=row),this.removeDatasetByUuid($uuid),this._setAllRowsDirty()},get$ItemProto:function(){return this.rowPrototype},getDataDelta:function(forceUpdateAll){var deltaRows=[],dirtyRows=this._getOrderedDirtyRows(forceUpdateAll);for(var i=0;i<dirtyRows.length;i++){var $uuid=dirtyRows[i].$uuid,row=this.getRowByUuid($uuid),deltaRow;if(row){deltaRow=row.getDataDelta(forceUpdateAll),deltaRow.$index=dirtyRows[i].$index,deltaRows.push(deltaRow);continue}row=this.rowsDeleted[$uuid];if(row){deltaRow={$uuid:$uuid,$index:dirtyRows[i].$index,$isDeleted:!0},deltaRows.push(deltaRow);continue}}return deltaRows},getData:function(){return this.json},applyDelta:function(delta,context){context==="template"?this.removeAllRows():this._destroyDeletedRow();if(!delta)return;var changedLinesOnly=delta.length>0&&delta[0].$index!==undefined;changedLinesOnly?this._applyDeltaIndexed(delta,context):this._applyDeltaFull(delta,context)},_applyDeltaIndexed:function(delta,context){var self=this,oldUuids=this.json.map(function(row){return row.$uuid});for(var ii=0,jj=delta.length;ii<jj;ii++){var deltaRow=delta[ii],$uuid=deltaRow.$uuid,$index=deltaRow.$index;if(deltaRow.$isDeleted===!0){this._deltaManRowRemoved(deltaRow.$uuid,deltaRow.$index),this.removeDatasetByUuid(deltaRow.$uuid);var idx=this.getRowIndex(deltaRow.$uuid);idx!==null&&this.json.splice(idx,1);continue}var row=this.getRowByUuid($uuid);row?row.applyDelta(deltaRow,context):(this.json.splice($index,0,deltaRow),this._deltaManRowAdded($uuid,$index))}for(var ii=0,jj=this.json.length;ii<jj;ii++){var maybeMoved=this.json[ii],oldIdx=oldUuids.indexOf(maybeMoved.$uuid);oldIdx>-1&&oldIdx!==ii&&this._deltaManRowMoved(maybeMoved.$uuid,ii)}this.dirtyProperties=[]},_applyDeltaFull:function(delta,context){var self=this,oldUuids=this.json.map(function(row){return row.$uuid});for(var ii=0;ii<this.json.length;ii++){var maybeDeletedRow=this.json[ii];delta.some(function(row){return row.$uuid===maybeDeletedRow.$uuid})||(this._deltaManRowRemoved(maybeDeletedRow.$uuid,ii),this.removeDatasetByUuid(maybeDeletedRow.$uuid),this.json.splice(ii,1),ii--)}for(var ii=0,jj=delta.length;ii<jj;ii++){var deltaRow=delta[ii],$uuid=deltaRow.$uuid,row=this.getRowByUuid($uuid);if(!row)this.json.splice(ii,0,deltaRow),this._deltaManRowAdded($uuid,ii);else{var oldIdx=oldUuids.indexOf($uuid);oldIdx!==ii&&this._deltaManRowMoved($uuid,ii),row.applyDelta(deltaRow,context)}}},_deltaSetValue:function($bind,value,context){throw new Error("_deltaSetValue not supported on ArrayDataset")},_getOrderedDirtyRows:function(forceUpdateAll){var rows=[];for(var $uuid in this.rowsDeleted)rows.push({$uuid:$uuid,$index:0});for(var ii=0,jj=this.json.length;ii<jj;ii++){var $uuid=this.json[ii].$uuid;(forceUpdateAll===!0||this.dirtyProperties.indexOf($uuid)>-1||$uuid in this.rowsDeleted)&&rows.push({$uuid:$uuid,$index:ii})}return rows},_setAllRowsDirty:function(){for(var ii=0,jj=this.json.length;ii<jj;ii++){var $uuid=this.json[ii].$uuid;this.setDirty($uuid)}},buildTemplateData:function(){var result=[];for(var ii=0,jj=this.json.length;ii<jj;ii++){var row=this.getRowByUuid(this.json[ii].$uuid);row&&result.push(row.buildTemplateData())}return result}})}),define("syracuse-tablet/html/js/sdata/datasetArraySingle",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/datasetArray"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/sdata/datasetArray").ArrayDataset;exports.SingleArrayDataset=utils.defineClass(function SingleArrayDataset(json,prototype,parent,$bind){var self=this;Base.call(this,json,prototype,parent,$bind),this.isReferenceArray=!1;if(this.prototype.json.$item.$type==="application/x-reference"){this.isReferenceArray=!0,this.valueProperty=Object.keys(this.prototype.json.$item.$item.$properties)[0];var json={$properties:{$value_ref:$.extend(!0,{},this.prototype.json.$item)}};json.$properties.$value_ref.$item[this.valueProperty]="{"+this.valueProperty+"}",json.$properties[this.valueProperty]=$.extend(!0,{},this.prototype.json.$item.$item.$properties[this.valueProperty]),json.$properties[this.valueProperty].$isExcluded=!0,json.$type="$simplePropertyArray",this.rowPrototype=prototype.createNew(json);for(var i=0;i<this.json.length;i++)this.json[i].$uuid=utils.UUID()}else{this.valueProperty="$value",this.rowPrototype=prototype.createNew({$type:"$simplePropertyArray",$properties:{$value:prototype.json.$item}});var wrappedItems=this.json.map(function(row){return self._wrapRow(row)});this.json.splice(0,this.json.length);for(var i=0;i<wrappedItems.length;i++)this.json.push(wrappedItems[i])}},Base,{get$ItemProto:function(){return this.rowPrototype},addRow:function(){var $uuid=utils.UUID(),rowData={$uuid:$uuid};return this.json.push(rowData),this.setDirty(this.$bind),this.getRowByUuid($uuid)},removeRow:function($uuid){var idx=this.getRowIndex($uuid);idx!=null&&this.json.splice(idx,1),this.setDirty(this.$bind),this.removeDatasetByUuid($uuid)},getDataDelta:function(forceUpdateAll){return this.getData()},getData:function(){var deltaRows=[],i;for(i=0;i<this.json.length;i++)if(this.isReferenceArray){var d={};d[this.valueProperty]=this.json[i][this.valueProperty]||"",deltaRows.push(d)}else deltaRows.push(this.json[i][this.valueProperty]);return deltaRows},applyDelta:function(delta,context){context==="template"&&this.removeAllRows();var rowsAdded=0;for(var ii=0,jj=delta.length;ii<jj;ii++){var deltaRow=delta[ii];if(ii<this.json.length){var row=this.json[ii],rowChanged=!1,$bind;this.isReferenceArray?row[this.valueProperty]!==deltaRow[this.valueProperty]&&(row[this.valueProperty]=deltaRow[this.valueProperty],$bind="$value_ref",rowChanged=!0):row[this.valueProperty]!==deltaRow&&(row[this.valueProperty]=deltaRow,$bind=this.valueProperty,rowChanged=!0);if(rowChanged&&$bind){var rowDataset=this.rowDatasetsByUuid[row.$uuid];rowDataset&&rowDataset._deltaManValueChanged($bind)}}else this.isReferenceArray?(deltaRow.$uuid=utils.UUID(),this.json.push(deltaRow)):this.json.push(this._wrapRow(deltaRow)),rowsAdded++}if(delta.length<this.json.length){for(var ii=delta.length,jj=this.json.length;ii<jj;ii++)this._deltaManRowRemoved(this.json[ii].$uuid,ii),this.removeDatasetByUuid(this.json[ii].$uuid);var rowsRemoved=this.json.length-delta.length;this.json.splice(delta.length,rowsRemoved)}else if(rowsAdded>0)for(var ii=this.json.length-rowsAdded,jj=this.json.length;ii<jj;ii++)this._deltaManRowAdded(this.json[ii].$uuid,ii);this.dirtyProperties=[]},setClean:function($bind,includeChildren){Base.prototype.setClean.call(this,$bind,includeChildren)},_setAllRowsDirty:function(){this.setDirty(this.$bind)},_wrapRow:function(row){return row&&row.$value!=null?row:{$uuid:utils.UUID(),$value:row}},buildTemplateData:function(){var result=[];for(var ii=0,jj=this.json.length;ii<jj;ii++){var row=this.json[ii];this.isReferenceArray?result.push(row):result.push(row[this.valueProperty])}return result}})}),define("syracuse-tablet/html/js/sdata/dataset",["require","exports","module","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/sdata/datasetBase","syracuse-tablet/html/js/sdata/datasetArrayRow","syracuse-tablet/html/js/sdata/datasetArrayMulti","syracuse-tablet/html/js/sdata/datasetArraySingle"],function(require,exports,module){var datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils");exports.Dataset=require("syracuse-tablet/html/js/sdata/datasetBase").DatasetBase,datasetUtils.setImplementation(require("syracuse-tablet/html/js/sdata/datasetArrayRow").RowDataset),datasetUtils.setImplementation(require("syracuse-tablet/html/js/sdata/datasetArrayMulti").MultiArrayDataset),datasetUtils.setImplementation(require("syracuse-tablet/html/js/sdata/datasetArraySingle").SingleArrayDataset),exports.createFromDraft=function(draftData,prototype){var dataset=new exports.Dataset({},prototype);return dataset.setDraftsData(draftData),dataset}}),define("syracuse-tablet/html/js/controls/articleParser",["require","exports","module","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var modules=require("syracuse-tablet/html/js/common/modules");exports.parseArticle=function(controller,article,page){function parseNode(controller,article,parent,opts){article.$layoutType&&(opts.index==null?opts.index=0:opts.index++,opts.makeFullHeight=page&&page.options.makeFullHeight===!0);var ctrl=ctrlFactory.createControl(controller,article,parent,page,opts);return ctrl&&article.$layoutType&&article.$items&&article.$items.forEach(function($itm){parseNode(controller,$itm,ctrl,opts)}),ctrl}var ctrlFactory;ctrlFactory=modules.get("ctrlFactory");if(!article)throw new Error("Unexpected empty article");article.$layoutType||(article.$layoutType="stack");var root=parseNode(controller,article,null,{$stackbar:article.$stackbar});return root},exports.createDefaultArticle=function(prototype,options){if(options&&options.isChartDetail)return exports.createDefaultChartDetailArticle(prototype);var article={$layoutType:"stack",$items:[]},$properties=prototype.getValueByPath("$properties");for(var $bind in $properties){if(prototype.getValueByPath("$properties."+$bind+".$isExcluded")==1)continue;article.$items.push({$bind:$bind})}return article},exports.createDefaultChartDetailArticle=function(prototype){var article={$layoutType:"stack",$display:"bothSideToSide",$items:[]},$properties=prototype.getValueByPath("$properties");for(var $bind in $properties){if(prototype.getValueByPath("$properties."+$bind+".$isExcluded")==1)continue;if(prototype.getValueByPath("$properties."+$bind+".$cube")){var graph={$layoutType:"row",$items:[]},cell={$layoutType:"cell",$bgColor:"transparent",$widthAll:"6",$sameSize:!0,$items:[{$bind:$bind,$display:"chart",$arrayOptions:{showPagination:!1,showSortFilter:!1,showSearch:!1,rowIndex:!1}}]};graph.$items.push(cell),cell={$layoutType:"cell",$bgColor:"transparent",$widthAll:"6",$sameSize:!0,$items:[{$bind:$bind,$forceArray:!0,$display:"table"}]},graph.$items.push(cell),article.$items.push(graph)}else article.$items.push({$bind:$bind})}return article}}),define("syracuse-tablet/html/js/sdata/sdataRequesterLocal",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/controls/articleParser","syracuse-tablet/html/js/sdata/dataset","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/sdata/sdataUtils"],function(require,exports,module){function _ajax(url,opts){var def=$.Deferred(),forceNoCache="?"+(new Date).getTime();return ajax.request(url+forceNoCache,null,null,null,opts).then(function(result){_cachedUrls[url]=result,def.resolve(result)}).fail(function(cause){_cachedUrls[url]?def.resolve(_cachedUrls[url]):def.reject(cause)}),def.promise()}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),ajax=require("syracuse-tablet/html/js/common/ajax"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),articleParser=require("syracuse-tablet/html/js/controls/articleParser"),dataset=require("syracuse-tablet/html/js/sdata/dataset"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),Prototype=require("syracuse-tablet/html/js/sdata/prototype").Prototype,sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),_cachedUrls={},_getEntityFromPath=function(path){return/\w*/.exec(path.split("/")[5])},_suffix_facets={$details:"detail",$edit:"edit",$create:"edit",$query:"query",$lookup:"lookup",$queryItem:"query"};exports.fetchPageData=function($link,options){options=options||{};var url=jsutils.parseURL($link.$url),entity=_getEntityFromPath(url.path),facetInfo=protoHelpers.getReprInfoFromUrl($link.$url),prototypeUrl,datasetUrl,articleUrl,isDashboard=url.path.indexOf("/mobileDashboard")>=0;if(isDashboard){var key=protoHelpers.getKeyFromUrl(url.path);prototypeUrl="/syracuse-tablet/html/js/mocks/mobileDashboard/"+(url.query.prototype||"$details")+"_proto.json",datasetUrl="/syracuse-tablet/html/js/mocks/mobileDashboard/"+(url.query.dataset||key)+"_data.json",articleUrl="/syracuse-tablet/html/js/mocks/mobileDashboard/"+(url.query.articleUrl||key)+"_article.json"}else{var suffixFacet=facetInfo&&_suffix_facets[facetInfo.facet],defBaseUrl=null;suffixFacet&&entity&&(defBaseUrl=jsutils.getUrlHost(url)+"/syracuse-tablet/html/js/mocks/"+entity+"/"+entity+"_"+suffixFacet+"_"),datasetUrl=url.query.dataset,defBaseUrl&&datasetUrl==null&&(datasetUrl=defBaseUrl+"data.json"),prototypeUrl=url.query.prototype;if(defBaseUrl&&prototypeUrl==null){var protoName=url.query.protoName;prototypeUrl=defBaseUrl+"proto"+(protoName?"_"+protoName:"")+".json"}articleUrl=url.query.article;if(defBaseUrl&&articleUrl==null){var articleName=url.query.articleName;articleUrl=defBaseUrl+"article"+(articleName?"_"+articleName:"")+".json"}}var prototypeJson,datasetJson,articleJson,headers={};return $.smResolve().then(function(){return _ajax(prototypeUrl)}).then(function(result){return prototypeJson=result.data,facetInfo&&(prototypeJson.$type="{$baseType}."+entity+"."+facetInfo.facet),url.query&&url.query.draftId?sdataUtils.draftReadData(url.query.draftId,!0):_ajax(datasetUrl)}).then(function(result){return datasetJson=result.data||{},!isDashboard&&protoHelpers.isLocaleUrl(datasetUrl)&&(datasetJson=datasetUtils.renewAllIds(datasetJson)),options.page&&options.page.$article?{data:options.page.$article}:_ajax(articleUrl,{acceptStatusCode:[404]})}).then(function(result){return articleJson=result.data,articleJson||(articleJson=articleParser.createDefaultArticle(new Prototype(prototypeJson))),protoHelpers.checkTransform($link.$url,prototypeJson,datasetJson,{$article:articleJson})}).then(function(pageDataTransformed){var pageData={isWorkingCopy:!1};return pageData.prototype=new Prototype(pageDataTransformed.prototypeJson),url.query.draftId?pageData.dataset=dataset.createFromDraft(pageDataTransformed.datasetJson,pageData.prototype):pageData.dataset=new dataset.Dataset(pageDataTransformed.datasetJson,pageData.prototype),pageData.page=pageDataTransformed.page,pageData})},exports.fetchDataset=function(key){var datasetUrl="/syracuse-tablet/html/js/mocks/mobileDashboard/"+key+"_data.json";return _ajax(datasetUrl)},exports.getPrototype=function($url){var url=jsutils.parseURL($url),entity=_getEntityFromPath(url.path),facetInfo=protoHelpers.getReprInfoFromUrl($url),suffixFacet=facetInfo&&_suffix_facets[facetInfo.facet],defBaseUrl=null;suffixFacet&&entity&&(defBaseUrl=jsutils.getUrlHost(url)+"/syracuse-tablet/html/js/mocks/"+entity+"/"+entity+"_"+suffixFacet+"_");var prototypeUrl=url.query.prototype;if(defBaseUrl&&prototypeUrl==null){var protoName=url.query.protoName;prototypeUrl=defBaseUrl+"proto"+(protoName?"_"+protoName:"")+".json"}return _ajax(prototypeUrl)}}),define("syracuse-tablet/html/js/sdata/sdataRequesterOffline",["require","exports","module","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/sdata/sdataUtils","syracuse-tablet/html/js/sdata/dataset","syracuse-tablet/html/js/sdata/prototype"],function(require,exports,module){function _getCache(){return modules.get("cache").getCache()}function _readCacheDetail(op,prototypeJson){return log&&log("Read cache: "+op.$endpoint+"."+op.$representation+": "+op.$key),_getCache().read({$representation:op.$representation,$key:op.$key,$endpoint:op.$endpoint}).then(function(result){return result?(log&&log("Cache hit"),result):(log&&log("Cache miss"),$.smReject(helpers.createDiag(null,"error",locale.text("error.network.offline.cache"))))})}function _writeCacheDetail(op,data,prototypeJson){return log&&log("Put cache: "+op.$endpoint+"."+op.$representation+": "+op.$key),_getCache().put({$representation:op.$representation,$key:op.$key,$endpoint:op.$endpoint,$data:data})}function _readCacheNew(op,prototypeJson){return log&&log("Read cache: "+op.$endpoint+"."+op.$representation+": "+_newTemplateKey),_getCache().read({$representation:op.$representation,$key:_newTemplateKey,$endpoint:op.$endpoint}).then(function(result){return result?(log&&log("Cache hit"),result):(log&&log("Cache miss"),$.smReject(helpers.createDiag(null,"error",locale.text("error.network.offline.cache"))))})}function _writeCacheNew(op,data,prototypeJson){return log&&log("Put cache: "+op.$endpoint+"."+op.$representation+": "+_newTemplateKey),_getCache().put({$representation:op.$representation,$key:_newTemplateKey,$endpoint:op.$endpoint,$data:data})}function _writeCacheArray(op,data,prototypeJson){return!data||!data.$resources?$.smResolve():op.$isRequest===!0||op.$isStats===!0?_writeCacheRequestAndStats(op,data,prototypeJson):_writeCacheQuery(op,data,prototypeJson)}function _writeCacheQuery(op,data,prototypeJson){var proto=prototypeJson.$properties&&prototypeJson.$properties.$resources&&prototypeJson.$properties.$resources.$item||prototypeJson;return $.smForEachPromise(data.$resources,function(item){var key=_calculateKey(proto,item);return key||(key=item.$uuid),_getCache().put({$representation:op.$representation,$key:key,$endpoint:op.$endpoint,$data:item})})}function _writeCacheRequestAndStats(op,data,prototypeJson){}function _readCacheArray(op,data,prototypeJson){return op.$isRequest===!0||op.$isStats===!0?_readCacheRequestAndStats(op,prototypeJson):_readCacheQuery(op,prototypeJson)}function _readCacheQuery(op,prototypeJson){var proto=prototypeJson.$properties&&prototypeJson.$properties.$resources&&prototypeJson.$properties.$resources.$item||prototypeJson,filters=proto.$filters,where,orderBy,keyField;return proto.$type=prototypeJson.$type,$.smResolve().then(function(){return _extendWhereWithFilter(op,filters)}).then(function(_where){where=_where}).then(function(){proto.$key?keyField=proto.$key.replace(/{/g,"").replace(/}/g,""):keyField="$uuid"}).then(function(){return _parseOrderBy(op.$orderBy,keyField)}).then(function(_orderBy){orderBy=_orderBy}).then(function(){return _getCache().query({$proto:proto,$endpoint:op.$endpoint,$where:where,$orderBy:orderBy})}).then(function(result){return result==null?$.smReject(helpers.createDiag(null,"error",locale.text("error.network.offline.cache"))):_queryCutAndAddLinks(op,result,prototypeJson)}).then(function(result){return result})}function _readCacheRequestAndStats(op,prototypeJson){}function _getOperation($url,$method){$method=$method||"GET";var url=$url,result={$url:$url,$method:$method,$parsedUrl:sdataUtils.parseSDataURL($url)};result.$endpoint=result.$parsedUrl.application+"."+result.$parsedUrl.contract+"."+result.$parsedUrl.dataset;var dir=result.$parsedUrl.directory,idx;if($method==="GET"){if(url.indexOf("$prototypes")>-1)result.$operation="prototype",result.$representation=_repExp.exec(url)[1];else if(dir.indexOf("$template")>-1)result.$operation="new",result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation;else if(result.$parsedUrl.$services)result.$operation="service",result.$service=result.$parsedUrl.$services,result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation;else{var key=_keyExp.exec(dir);key!=null?key=key[1]:(key=_keyExpEq.exec(dir),key!=null&&(key=key[1])),result.$isStats=dir.indexOf("/STATS(")>-1,result.$isRequest=dir.indexOf("/QUERY(")>-1,result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation,key&&!result.$isStats&&!result.$isRequest?(result.$operation="read",result.$key=key):result.$operation="query"}result.$parsedUrl.query&&result.$parsedUrl.query.where&&(result.$where=result.$parsedUrl.query.where),result.$parsedUrl.query&&result.$parsedUrl.query.orderBy&&(result.$orderBy=result.$parsedUrl.query.orderBy)}else if(result.$parsedUrl.$services)result.$operation="service",result.$service=result.$parsedUrl.$services,result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation;else if($method==="DELETE"){var key=_keyExp.exec(dir);result.$operation="delete",result.$key=key[1],result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation}else{var key=_keyExp.exec(dir);key?(result.$operation="save",result.$key=key[1],result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation):(result.$operation="save",result.$representation=result.$parsedUrl.query&&result.$parsedUrl.query.representation)}return result}function _calculateKey(proto,item){var key;return proto.$key?key=proto.$key.replace(/\{(.*?)\}/g,function(match,prop){return item[prop]}):key=item.$uuid,key}function _checkQueryPrototype(op,proto){proto.$properties&&proto.$properties.$resources&&proto.$properties.$resources.$item&&(proto.$properties.$resources.$item.$type="{$baseType}."+op.$representation)}function _queryCutAndAddLinks(op,result,prototypeJson){var response={};result=result||[];var baseUrl=op.$parsedUrl.source.split("?")[0],query="",key,max=OFFLINEQUERYCOUNT,orderBy="";op.$parsedUrl.query&&op.$parsedUrl.query.where&&(query+="&where="+op.$parsedUrl.query.where),key=op.$parsedUrl.query&&op.$parsedUrl.query.key;var firstKeyRead,lastKeyRead,resources=response.$resources=[],hasNextPage=!1,hasPreviousPage=!1,i,orderBy="",val,kv,proto=prototypeJson.$properties&&prototypeJson.$properties.$resources&&prototypeJson.$properties.$resources.$item||prototypeJson,keyField;return $.smResolve().then(function(){proto.$key?keyField=proto.$key.replace(/{/g,"").replace(/}/g,""):keyField="$uuid"}).then(function(){if(op.$parsedUrl.query&&op.$parsedUrl.query.orderBy)return _buildOrderBy(op,keyField,op.$parsedUrl.query.orderBy)}).then(function(_orderBy){_orderBy&&(orderBy=_orderBy,query+="&orderBy="+orderBy);var keyType=proto.$properties[keyField],isNumericKey=keyType&&keyType.$type&&keyType.$type!=="application/x-string",gotMatch=!1;if(key&&key.smStartsWith("gt")){val=key.substr(3),val=isNumericKey?+val:val;for(i=0;i<result.length;i++){gotMatch||(kv=_calculateKey(proto,result[i]),kv=isNumericKey?+kv:""+kv);if(kv==val&&!gotMatch)gotMatch=!0;else if(gotMatch){resources.push(result[i]);if(resources.length>max)break}else hasPreviousPage=!0}resources.length>0&&(resources.length>max&&(resources.pop(),hasNextPage=!0),firstKeyRead=_calculateKey(proto,resources[0]),lastKeyRead=_calculateKey(proto,resources[resources.length-1]))}else if(key&&key.smStartsWith("lt")){if(key.length>3){val=isNumericKey?+key.substr(3):""+key.substr(3);for(i=result.length-1;i>=0;i--){gotMatch||(kv=_calculateKey(proto,result[i]),kv=isNumericKey?0+kv:""+kv);if(kv==val&&!gotMatch)gotMatch=!0;else if(gotMatch){resources.push(result[i]);if(resources.length>max)break}else hasNextPage=!0}resources.length>max&&(hasPreviousPage=!0,resources.pop())}else for(i=result.length-1;i>=0;i--){resources.push(result[i]);if(resources.length>max)break}resources.length>0&&(resources.length>max&&(hasPreviousPage=!0,resources.pop()),response.$resources=resources=resources.reverse(),firstKeyRead=_calculateKey(proto,resources[0]),lastKeyRead=_calculateKey(proto,resources[resources.length-1]))}else{for(i=0;i<result.length;i++){resources.push(result[i]);if(resources.length>max)break}resources.length>0&&(resources.length>max&&(hasNextPage=!0,resources.pop()),firstKeyRead=_calculateKey(proto,resources[0]),lastKeyRead=_calculateKey(proto,resources[resources.length-1]))}var links=response.$links={};return key&&(links.$first={$url:baseUrl+"?representation="+op.$representation+query}),key&&firstKeyRead&&hasPreviousPage&&key!=="gt"&&(links.$previous={$url:baseUrl+"?representation="+op.$representation+query+"&key=lt."+firstKeyRead}),key!=="lt"&&lastKeyRead&&hasNextPage&&(links.$next={$url:baseUrl+"?representation="+op.$representation+query+"&key=gt."+lastKeyRead}),key!=="lt"&&hasNextPage&&(links.$last={$url:baseUrl+"?representation="+op.$representation+query+"&key=lt"}),response})}function _parseOrderBy(orderBy,keyField){return $.smResolve().then(function(){if(!orderBy)return[{property:keyField,sort:"ASC"}];var o=[];return orderBy.split(",").map(function(field){field=field.trim();var d=field.split(" "),f=d[0].trim();if(f.length>0){var dir="ASC";d.length>1&&(dir=d[1].toUpperCase(),dir=dir!=="DESC"?"ASC":"DESC"),o.push({property:f,sort:dir})}}),o})}function _buildOrderBy(op,keyField,orderBy){return $.smResolve().then(function(){return orderBy?(orderBy===keyField||orderBy.indexOf(keyField+" ")>-1||orderBy.indexOf(keyField+",")>-1||(orderBy.indexOf(" DESC")>-1?orderBy+=", "+keyField+" DESC":orderBy+=", "+keyField+" ASC"),orderBy):keyField})}function _extendWhereWithFilter(op,filters){return $.smResolve().then(function(){var where=op.$where;if(!filters)return where;var filterName=op.$parsedUrl&&op.$parsedUrl.query&&op.$parsedUrl.query.filter;if(!filterName)return where;var filter=filters&&filters[filterName];return filter?_checkFilterWhere(filterName,filter.$where).then(function(fw){return fw?(where?where="("+where+") and ("+fw+")":where="("+fw+")",where):where}):where})}function _checkFilterWhere(filterName,where){var invalid=where.match(/(\[F\:\w+\]?)/g);return invalid?$.smReject(helpers.createDiag({},"error",locale.text("sdata.error.filter.screenFieldDetails",[filterName,invalid.join(","),where]))):$.smResolve(where)}var log=require("syracuse-tablet/html/js/helpers/logger").getLogger("SDataRequesterOffline",!1),locale=require("syracuse-tablet/html/js/helpers/locale"),helpers=require("syracuse-tablet/html/js/common/helpers"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),modules=require("syracuse-tablet/html/js/common/modules"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),Dataset=require("syracuse-tablet/html/js/sdata/dataset").Dataset,Prototype=require("syracuse-tablet/html/js/sdata/prototype").Prototype,OFFLINEQUERYCOUNT=20,_repExp=/\$prototypes\('(.*?)'\)/,_keyExp=/\('(.*?)'\)/,_keyExpEq=/\(.+'(.*?)'\)/,_newTemplateKey="$$new$$";exports.fetchData=function($url,$method,prototypeJson){var operation;return $.smResolve().then(function(){operation=_getOperation($url,$method)}).then(function(){console.log(operation);switch(operation.$operation){case"new":return _readCacheNew(operation,prototypeJson);case"read":return _readCacheDetail(operation,prototypeJson);case"query":return _readCacheQuery(operation,prototypeJson)}})},exports.getPage=function($url,sdataResponse){var base=jsutils.getUrlHost($url),endpoint=protoHelpers.getEndpointFromUrl($url),repr=protoHelpers.getReprFromUrl($url);repr==="mobileDashboard.$details"&&(repr=protoHelpers.getKeyFromUrl($url),repr+=".$mobileDashboard");var pageName=endpoint+"."+repr;return $.smResolve().then(function(){return metaDataCache.getPage(pageName)})},exports.getPrototype=function($prototypeUrl){var endpoint=protoHelpers.getEndpointFromUrl($prototypeUrl),repr=protoHelpers.getKeyFromUrl($prototypeUrl),protoName=endpoint+"."+repr;return $.smResolve().then(function(){return metaDataCache.getPrototype(protoName)}).then(function(proto){return proto==null?$.smReject(helpers.createDiag(null,"error",locale.text("error.network.offline.cache"),"Url:"+$prototypeUrl)):proto})},exports.writeToCache=function($url,$method,cacheData,prototypeJson){var operation;return $.smResolve().then(function(){operation=_getOperation($url,$method)}).then(function(){switch(operation.$operation){case"new":return _writeCacheNew(operation,cacheData,prototypeJson);case"read":return _writeCacheDetail(operation,cacheData,prototypeJson);case"query":return _writeCacheArray(operation,cacheData,prototypeJson)}})}}),define("syracuse-tablet/html/js/sdata/sdataStatic",["require","exports","module"],function(require,exports,module){exports.getMobileDashboardProto=function(){return{$type:"application/json",$prototype:"{$baseUrl}/$prototypes('{$representation}.$details')",$url:"{$baseUrl}/{$pluralType}('{$key}')",$title:"Mobile dashboard",$key:"{$uuid}",$description:"Mobile dashboard definition",$pluralType:"mobileDashboards",$representation:"mobileDashboard",$properties:{dashboardName:{$title:"Dashboard name",$isUnique:!0,$isMandatory:!0,$capabilities:"sort,filter,alphaTab",$links:{$details:{$type:"application/json;vnd.sage=syracuse",$url:"{$baseUrl}/{$pluralType}('{$key}')?representation={$representation}.$details&role={$role}"}},$type:"application/x-string"},title:{$title:"Title",$isMandatory:!0,$capabilities:"sort,filter,localize,alphaTab",$links:{$details:{$type:"application/json;vnd.sage=syracuse",$url:"{$baseUrl}/{$pluralType}('{$key}')?representation={$representation}.$details&role={$role}"},$localize:{$title:"Translations",$url:"{$shortUrl}/title/$localize",$method:"GET"}},$type:"application/x-string"},description:{$title:"Description",$isMandatory:!0,$capabilities:"sort,filter,localize,alphaTab",$links:{$localize:{$title:"Translations",$url:"{$shortUrl}/description/$localize",$method:"GET"}},$type:"application/x-string"},vignettes:{$title:"Gadgets",$capabilities:"sort,filter",$type:"application/x-array"}},$baseType:"application/json;vnd.sage=syracuse",$baseUrl:"http://localhost:8124/mobile2/syracuse/collaboration/syracuse"}},exports.getMobileApplicationProto=function(){return{$mobileDashboardProto:exports.getMobileDashboardProto(),$type:"application/json",$prototype:"{$baseUrl}/$prototypes('{$representation}.$details')",$url:"{$baseUrl}/{$pluralType}('{$key}')",$title:"Mobile application",$key:"{$uuid}",$pluralType:"mobileApplications",$representation:"mobileApplication",$properties:{title:{$title:"Title",$isMandatory:!0,$capabilities:"sort,filter,localize,alphaTab",$type:"application/x-string"},description:{$title:"Description",$isMandatory:!0,$capabilities:"sort,filter,localize,alphaTab",$type:"application/x-string"},applicationName:{$title:"Mobile application name",$isUnique:!0,$isMandatory:!0,$capabilities:"sort,filter,alphaTab",$type:"application/x-string"},iconName:{$title:"Icon",$capabilities:"sort,filter,alphaTab",$type:"application/x-string",$isMandatory:!1},onlineOnly:{$title:"Online only",$capabilities:"sort,filter",$type:"application/x-boolean",$isNullable:!0,$isMandatory:!1},versionNumber:{$title:"Version",$isReadOnly:!0,$isHidden:!0,$capabilities:"sort,filter,alphaTab",$type:"application/x-string",$isMandatory:!1},roles:{$title:"Roles",$capabilities:"sort,filter",$type:"application/x-array",$item:{$type:"application/x-reference",$item:{$url:"{$baseUrl}/roles('{$key}')?representation={$representation}.$thumb",$shortUrl:"{$baseUrl}/roles('{$key}')",$value:"{description}",$description:"Roles allows personalized configurations for users",$key:"{$uuid}",$properties:{description:{$type:"application/x-string"}},$prototype:"{$baseUrl}/$prototypes('{$representation}.$thumb')",$representation:"role",$links:{$details:{$type:"application/json;vnd.sage=syracuse",$url:"{$baseUrl}/roles('{$key}')?representation=role.$details&role={$role}"}}}}},endPoints:{$title:"Endpoints",$capabilities:"sort,filter",$type:"application/x-array",$item:{$type:"application/x-reference",$item:{$url:"{$baseUrl}/endPoints('{$key}')?representation={$representation}.$thumb",$shortUrl:"{$baseUrl}/endPoints('{$key}')",$value:"{description}",$description:"Endpoints describe services locations",$key:"{$uuid}",$properties:{description:{$type:"application/x-string"}},$prototype:"{$baseUrl}/$prototypes('{$representation}.$thumb')",$representation:"endPoint",$links:{$details:{$type:"application/json;vnd.sage=syracuse",$url:"{$baseUrl}/endPoints('{$key}')?representation=endPoint.$details&role={$role}"}}}}},homeDashboard:{$title:"Home dashboard",$isMandatory:!0,$capabilities:"sort,filter",$type:"application/x-reference",$item:{$url:"{$baseUrl}/mobileDashboards('{$key}')?representation={$representation}.$thumb",$shortUrl:"{$baseUrl}/mobileDashboards('{$key}')",$value:"{title}",$description:"Mobile dashboard definition",$key:"{$uuid}",$properties:{title:{$type:"application/x-string"}},$prototype:"{$baseUrl}/$prototypes('{$representation}.$thumb')",$representation:"mobileDashboard",$links:{$details:{$type:"application/json;vnd.sage=syracuse",$url:"{$baseUrl}/mobileDashboards('{$key}')?representation=mobileDashboard.$details&role={$role}"}}}}},$baseType:"application/json;vnd.sage=syracuse",$baseUrl:"http://localhost:8124/mobile2/syracuse/collaboration/syracuse"}}}),define("syracuse-tablet/html/js/controls/vignette/gadget",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/protocolHelpers"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers");exports.Gadget=utils.defineClass(function Gadget(gadgetJson,parameters){this.json=gadgetJson,this._dashboardParams={}},null,{destroy:function(){},data:function(prop){return this.json?this.json[prop]:null},getType:function(){return this.json.$type},getExternalUrl:function(){return this.json.externalUrl},getLink:function(){var $link;if(this.json.$url&&this.json.$method)$link={$url:this._buildUrl(this.json.$url,!1),$method:this.json.$method};else{var method="_computeLink_"+(this.json.$type==="$representation"?this.json.$type+"_"+this.json.facet:this.json.$type);$link=this[method].call(this)}return $link},_computeLink_$representation_$query:function(){var url,url="{$baseUrl}/"+this.json.entity+"?representation="+this.json.representation+"."+this.json.facet;return url=this._buildUrl(url,!0,!0),{$url:url,$method:"GET"}},_computeLink_$representation_$details:function(){var url;return url="{$baseUrl}/"+this.json.entity+"('{$key}')"+"?representation="+this.json.representation+"."+this.json.facet,url=this._buildUrl(url,!0,!0),{$url:url,$method:"GET"}},_computeLink_$representation_$edit:function(){var url;return url="{$baseUrl}/"+this.json.entity+"('{$key}')"+(this._useWorkingCopyUrl()?"/$workingCopies":"")+"?representation="+this.json.representation+"."+this.json.facet,url=this._buildUrl(url,!0,!0),{$url:url,$method:this._useWorkingCopyUrl()?"PUT":"GET"}},_computeLink_$representation_$create:function(){var url;return url="{$baseUrl}/"+this.json.entity+"/$template"+(this._useWorkingCopyUrl()?"/$workingCopies":"")+"?representation="+this.json.representation+"."+this.json.facet,url=this._buildUrl(url,!0,!0),{$url:url,$method:this._useWorkingCopyUrl()?"POST":"GET"}},_computeLink_$dashboard:function(){var url;return url="{$collaborationBaseUrl}/mobileDashboards(dashboardName%20eq%20'"+this.json.dashboardName+"')?representation=mobileDashboard.$details",url=this._buildUrl(url,!1,!0),{$url:url,$method:"GET"}},_computeLink_$application:function(){var url;return url="{$collaborationBaseUrl}/mobileApplications(applicationName%20eq%20'"+this.json.applicationName+"')?representation=mobileApplication.$details",url=this._buildUrl(url,!1,!0),{$url:url,$method:"GET"}},_computeLink_$external:function(){var url=this.json.externalUrl;return url=this._buildUrl(url,!1),{$url:url,$method:"GET"}},_computeLink_$request:function(){var url="{$baseUrl}/QUERY('"+this.json.requestName+"')?representation=QUERY~"+this.json.requestName+(this.json.requestLevel?"~"+this.json.requestLevel:"")+"."+this.json.facet;return url=this._buildUrl(url,!0,!0),{$url:url,$method:"GET"}},_computeLink_$stats:function(){var url="{$baseUrl}/STATS('"+this.json.statName+"')?representation=STATS~"+this.json.statName+"."+this.json.facet;return url=this._buildUrl(url,!0,!0),{$url:url,$method:"GET"}},_buildUrl:function(url,addParameters,addContext){var self=this;url=url.replace(/\{(\S+?)\}/g,function(m,p){return self._getGadgetValue(p)});if(addParameters){var params=[];this.json.parameters&&Object.keys(this.json.parameters).forEach(function(paramName){var paramValue=self._getParamValue(self.json.parameters[paramName].value);paramValue!=null&&params.push(paramName+"="+paramValue)});if(params.length>0){var sep=url.indexOf("?")<0?"?":"&";url=url+sep+params.join("&")}}return addContext&&(url=protoHelpers.addClientContext(url,this.json.$clientContext)),url},_getParamValue:function(paramValue){var self=this;if(paramValue.indexOf("{")<0)return paramValue;var allParamsSet=!0,res=paramValue.replace(/\{(\S+?)\}/g,function(m,p){var param=self._dashboardParams&&self._dashboardParams[p],value=param&&param.value;return value==null&&(allParamsSet=!1),value!=null?value:""});return allParamsSet==1?res:null},_getGadgetValue:function(key){var method="_get_"+key;return this[method].call(this)},_get_$baseUrl:function(){var baseUrl=protoHelpers.getHostPort(),endpoint=this._getEndpoint(),url=baseUrl+"/mobile2/"+endpoint.split(".").join("/");return url},_get_$hostPort:function(){return protoHelpers.getHostPort()},_get_$key:function(){return this.json.keyParameter},_get_$collaborationBaseUrl:function(){var baseUrl=protoHelpers.getHostPort();return baseUrl+"/mobile2/syracuse/collaboration/syracuse"},_useWorkingCopyUrl:function(){return(this.json.$clientContext&&this.json.$clientContext.$mobileProtocol)==="workingcopy"},_getEndpoint:function(){var endpoint=this.json.endpoint;return endpoint||(endpoint=this.json.$clientContext.$mobileEndpoint),endpoint},setDashboardParams:function(params){this._dashboardParams=params}}),exports.createGadget=function(proto){if(proto){var $item=proto.getValueByPath("$item");if($item)return new exports.Gadget(proto.getValueByPath("$item"))}}}),define("syracuse-tablet/html/js/sdata/sdataRequester",["require","exports","module","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/sdata/dataset","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/controls/articleParser","syracuse-tablet/html/js/sdata/sdataRequesterLocal","syracuse-tablet/html/js/sdata/sdataRequesterOffline","syracuse-tablet/html/js/sdata/sdataStatic","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/controls/vignette/gadget","syracuse-tablet/html/js/sdata/sdataUtils","syracuse-tablet/html/js/helpers/logger"],function(require,exports,module){function _getPrototype($prototypeUrl,options){if(options&&options.prototype)return log&&log("Skip reading prototype"),$.smResolve(options.prototype);var fetchProto=$.Deferred(),fetchStatic=$.Deferred();return _getStaticPrototype($prototypeUrl).then(function(staticProto){fetchStatic.resolve(staticProto)}).fail(function(e){fetchStatic.resolve(null)}),fetchStatic.then(function(staticProto){staticProto?fetchProto.resolve(staticProto):options.useMetaFromCache===!0?sdataRequesterOffline.getPrototype($prototypeUrl).then(function(result){fetchProto.resolve(result)}).fail(function(resultOffline){ajax.request($prototypeUrl).then(function(result){fetchProto.resolve(result.data)}).fail(function(result){result.offline=!0,fetchProto.reject(result)})}):ajax.request($prototypeUrl).fail(function(result){result.offline?sdataRequesterOffline.getPrototype($prototypeUrl).then(function(result){fetchProto.resolve(result)}).fail(function(result){result.offline=!0,fetchProto.reject(result)}):fetchProto.reject(result)}).then(function(result){fetchProto.resolve(result.data)})}),fetchProto}function _getStaticPrototype($prototypeUrl){var endpoint=protoHelpers.getEndpointFromUrl($prototypeUrl),repr=protoHelpers.getKeyFromUrl($prototypeUrl),protoName=endpoint+"."+repr;return protoName==="syracuse.collaboration.syracuse.mobileDashboard.$details"?$.smResolve(sdataStatic.getMobileDashboardProto()):protoName==="syracuse.collaboration.syracuse.mobileApplication.$details"?$.smResolve(sdataStatic.getMobileApplicationProto()):$.smResolve()}function _getData($url,$method,prototypeJson,headers,options){if(options&&options.data)return log&&log("Skip reading data"),$.smResolve(options.data);var writeCache=!0,fetchData=$.Deferred(),fetchStatic=$.Deferred();return options&&options.noCacheWrite===!0&&(writeCache=!1),_getStaticData($url,$method,prototypeJson).then(function(staticData){staticData&&(writeCache=!1),fetchStatic.resolve(staticData)}).fail(function(e){fetchStatic.resolve(null)}),fetchStatic.then(function(staticData){staticData?fetchData.resolve(staticData):ajax.request($url,$method,null,headers,options&&options.ajaxOptions).fail(function(result){result.offline?sdataRequesterOffline.fetchData($url,$method,prototypeJson).then(function(result){fetchData.resolve(result)}).fail(function(result){result.offline=!0,fetchData.reject(result)}):fetchData.reject(result)}).then(function(result){writeCache&&result.data&&sdataRequesterOffline.writeToCache($url,$method,result.data,prototypeJson),fetchData.resolve(result.data)})}),fetchData}function _getStaticData($url,$method,prototypeJson){if(prototypeJson.$representation==="mobileApplication"){var appName=protoHelpers.getKeyFromUrl($url),parsed=jsutils.parseURL($url),endpoint=parsed.query.$mobileEndpoint;if(endpoint)return metaDataCache.tryGetApp(appName,endpoint).then(function(mobileApp){return _checkFetchGadgetData(mobileApp,endpoint)})}return $.smResolve()}function _getPage($url,$method,prototypeJson,datasetJson,options){if(options&&options.page&&options.page.$article)return log&&log("Skip reading article"),$.smResolve({$article:options.page.$article,$views:options.page.$views});var pageUrl,fetchPage=$.Deferred(),fetchStatic=$.Deferred();return _getStaticArticle($url,$method,prototypeJson,datasetJson).then(function(staticArticle){fetchStatic.resolve(staticArticle)}).fail(function(e){fetchStatic.resolve(null)}),fetchStatic.then(function(staticArticle){staticArticle?fetchPage.resolve(staticArticle):options.useMetaFromCache===!0?sdataRequesterOffline.getPage($url,datasetJson).then(function(result){fetchPage.resolve(result)}).fail(function(resultOffline){protoHelpers.getPageUrl($url,datasetJson).then(function(_pageUrl){pageUrl=_pageUrl}).then(function(_pageUrl){return ajax.request(pageUrl)}).fail(function(result){fetchPage.reject(result)}).then(function(result){fetchPage.resolve(result.data)})}):protoHelpers.getPageUrl($url,datasetJson).then(function(_pageUrl){pageUrl=_pageUrl}).then(function(_pageUrl){return ajax.request(pageUrl)}).fail(function(result){result.offline?sdataRequesterOffline.getArticle($url,datasetJson).then(function(result){fetchPage.resolve(result)}).fail(function(result){result.offline=!0,fetchPage.reject(result)}):fetchPage.reject(result)}).then(function(result){fetchPage.resolve(result.data)})}),fetchPage.then(function(page){var $article=page&&page.$article;return!$article&&(!prototypeJson||prototypeJson.$representation!=="mobileDashboard")&&($article=articleParser.createDefaultArticle(new Prototype(prototypeJson),{isChartDetail:options.isChartDetail})),{$article:$article,$views:page&&page.$views}})}function _getStaticArticle($url,$method,prototypeJson,datasetJson){return prototypeJson.$representation==="mobileApplication"?$.smResolve({$layoutType:"stack"}):$.smResolve(null)}function _checkFetchGadgetData(appData,endpoint){if(appData.useHomeGadget!==!0)return $.smResolve(appData);var $mobileProtocol=appData.onlineOnly?"workingcopy":"stateless",gproto={$item:appData.$homeGadget};gproto.$item.$clientContext={$mobileProtocol:$mobileProtocol,$mobileEndpoint:endpoint,$mobileApplication:appData.applicationName};var g=gadget.createGadget(new Prototype(gproto)),$link=g.getLink();return exports.fetchPageData($link).then(function(gadgetData){return appData.$homeGadgetFetched={prototype:gadgetData.prototype.json,dataset:gadgetData.dataset.json},appData.$homeGadgetFetched.dataset.$page=gadgetData.page,appData.$homeGadgetFetched.dataset.$mobileEmbeddedUrl=$link.$url,appData})}var ajax=require("syracuse-tablet/html/js/common/ajax"),__ajax=ajax,jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),utils=require("syracuse-tablet/html/js/helpers/utils"),helpers=require("syracuse-tablet/html/js/common/helpers"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),dataset=require("syracuse-tablet/html/js/sdata/dataset"),Prototype=require("syracuse-tablet/html/js/sdata/prototype").Prototype,articleParser=require("syracuse-tablet/html/js/controls/articleParser"),sdataRequesterLocal=require("syracuse-tablet/html/js/sdata/sdataRequesterLocal"),sdataRequesterOffline=require("syracuse-tablet/html/js/sdata/sdataRequesterOffline"),sdataStatic=require("syracuse-tablet/html/js/sdata/sdataStatic"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),gadget=require("syracuse-tablet/html/js/controls/vignette/gadget"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("SDataRequester",!1);exports.__testInjectAjax=function(ajaxStub){ajax=ajaxStub},exports.__testRestoreAjax=function(ajaxStub){ajax=__ajax},exports.fetchPageData=function($link,options){options=options||{};var $url=$link.$url,urlParsed=jsutils.parseURL($link.$url),$method=$link.$method,self=this,isWorkingCopy=$url.indexOf("$workingCopies")>-1,$mobileProtocol=$url.indexOf("$mobileProtocol=workingcopy")>-1?"workingcopy":"stateless";$link.$method==="POST"&&isWorkingCopy&&($url=$url+"&trackingId="+utils.UUID());if(protoHelpers.isLocaleUrl($url))return sdataRequesterLocal.fetchPageData($link,options);$mobileProtocol==="stateless"&&(options.useMetaFromCache=!0);var prototypeJson,datasetJson,articleJson,viewsJson;return log&&log("Fetching: "+$url+" ("+$method+")"),$url=$url.replace(/\.\%24/g,".$"),exports.getPrototype($url,options).then(function(proto){return prototypeJson=proto,urlParsed.query&&urlParsed.query.draftId?sdataUtils.draftReadData(urlParsed.query.draftId):_getData($url,$method,prototypeJson,null,options)}).then(function(data){return datasetJson=data,_getPage($url,$method,prototypeJson,datasetJson,options)}).then(function(page){return protoHelpers.checkTransform($url,prototypeJson,datasetJson,page)}).then(function(pageDataTransformed){var pageData={};return pageData.prototype=new Prototype(pageDataTransformed.prototypeJson),pageData.dataset=new dataset.Dataset(pageDataTransformed.datasetJson,pageData.prototype),pageData.isWorkingCopy=isWorkingCopy,pageData.$url=$url,pageData.$originalUrl=$url,pageData.page=pageDataTransformed.page,pageData})},exports.createPageDataJson=function(datasetJson,prototypeJson,article){if(prototypeJson.$representation==="mobileDashboard"){var transformed=protoHelpers.transformDashboard(datasetJson,prototypeJson);prototypeJson=transformed.prototypeJson,datasetJson=transformed.datasetJson}var proto=new Prototype(prototypeJson);return{prototype:proto,dataset:new dataset.Dataset(datasetJson,proto),article:article||prototypeJson.$article}},exports.triggerAction=function($actionName,dataset,workingCopy){var def=$.Deferred();return $.smResolve().then(function(){var $action=dataset.getAction($actionName);return $action?$action:$.smReject(helpers.createDiag(null,"error","Action does not exist: "+$actionName))}).then(function($action){var actionData=protoHelpers.createActionData(dataset,$actionName,$action,workingCopy);if(actionData)return ajax.request(actionData.$url,actionData.$method,actionData.data)}).then(function(result){def.resolve(result)}).fail(function(result){result&&result.data&&result.data.$diagnoses?def.resolve(result):def.reject(result)}),def.promise()},exports.executeLink=function($url,$method,dataset){var data;return["PUT","POST"].indexOf($method)>-1&&(data=dataset.getData()),ajax.request($url,$method,data)},exports.deleteWC=function(dataset){return ajax.request(dataset.getUrl(),"DELETE")},exports.updateServer=function(dataset,$bind,forceUpdateAll){return dataset.isRoot()?$.smResolve().then(function(){var isText=$bind&&dataset.prototype.propIsText($bind),delta=isText?dataset.getDataText($bind):dataset.getDataDelta(forceUpdateAll),options={};isText&&(options.contentType=dataset.prototype.propGetType($bind));var $url=dataset.getUrl(!1,isText?$bind:null);return ajax.request($url,"PUT",delta,null,options)}).then(function(response){return response}):$.smReject(helpers.createDiag(null,"error","Server update only possible on root dataset"))},exports.getLazyPropData=function($url,prototypeJson,$type){var headers={Accept:$type},ajaxOptions={contentType:$type};return ajax.request($url,"GET",null,headers,ajaxOptions).then(function(result){return result.data})},exports.getPrototype=function($url,options){return _getPrototype(protoHelpers.getPrototypeUrl($url),options)},exports.processSaveDraft=function(draftCtx,draftIdx){if(!draftCtx)return $.smResolve({success:!0});if(protoHelpers.isLocaleUrl(draftCtx.draftUrl)){var deferred=$.Deferred();return setTimeout(function(){var data;draftIdx%4===0?data={success:!1,status:200,data:{$diagnoses:[{$severity:"error",$message:"Bad field's XXX value"}]}}:draftIdx%4===1?data={success:!1,offline:!0}:draftIdx%4===2?data={success:!1,status:401}:draftIdx%4===3&&(data={success:!0,data:$.extend(!0,null,draftCtx.dataset)}),deferred.resolve(data,draftCtx)},2e3),deferred.promise()}return exports.getPrototype(draftCtx.draftUrl,{useMetaFromCache:!0}).then(function(protoJson){return new Prototype(protoJson)}).then(function(prototype){var dataSet=new dataset.createFromDraft(draftCtx.dataSet,prototype);return exports.triggerAction("$save",dataSet,!1)}).then(function(result){return $.smResolve(result,draftCtx)})}}),define("syracuse-tablet/html/js/helpers/html-escape/lib/escape",["require","exports","module"],function(require,exports,module){function fixOptions(options){return options=options||{},options.allowedTags=(options.allowedTags||[]).concat(["h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","pre","table","thead","caption","tbody","tr","th","td","pre"]),options.allowedAttributes=(options.allowedAttributes||[]).concat(["class","href","src","name","target"]),options.allowedSchemes=(options.allowedSchemes||[]).concat(["http","https","mailto"]),options}function map(array){return array.reduce(function(map,key){return map[key]=!0,map},{})}function escapeText(str){return str.replace(/>/g,"&gt;")}function escapeComment(str){return str.replace(/-->/g,"__>")}function escapeStyle(str){return str.replace(/\/\*.*?\*\//g,"").replace(/(\\|\b)(j\\?a\\?v\\?a\\?s\\?c\\?r\\?i\\?p\\?t|e\\?x\\?p\\?r\\?e\\?s\\?s\\?i\\?o\\?n|u\\?r\\?l)\b/ig,"disabled-$1$2")}function escapeType(str){return str.replace(/javascript/i,"disabled-javascript")}exports.escaper=function(options){function checkChange(oldVal,newVal,prefix){return warn&&newVal!==oldVal&&warn(prefix+": "+oldVal+" -> "+newVal),newVal}function escapeValue(key,val){return key==="style"?checkChange(val,escapeStyle(val),"sanitized style"):key==="type"?checkChange(val,escapeType(val),"sanitized type attribute"):val}function create(){function skipTillMarker(frag,marker,repl){var i=frag.indexOf(marker);return i>=0?(preserve&&(result+=escapeComment(frag.substring(0,i))+repl+"-->"),result+=escapeText(frag.substring(i+marker.length)),inside="text"):preserve&&(result+=escapeComment(frag)),result}function skipTillClosing(frag,tag,allowed){var re=new RegExp("^/"+tag+">","i"),m=re.exec(frag);return m?(allowed?result+="</"+tag+">":preserve&&(result+="</"+tag+">-->"),result+=escapeText(frag.substring(m[0].length)),inside="text"):allowed?result+=escapeValue(tag,"<"+frag):preserve&&(result+=escapeComment("<"+frag)),result}function reject(frag,warn){return warn&&warn("malformed element: "+frag),preserve&&(result+="<!--<"+escapeComment(frag)+"-->"),result}function allowedValue(atb,val){if(urlAttributes.test(atb)){var colon=val.indexOf(":");if(colon<0||!allowedSchemes[val.substring(0,colon)])return!1}return!0}function escapeTag(tag,closing,atbs,autoClosed){if(closing){result+="</"+tag+">",atbs=atbs.trim(),preserve&&atbs&&(result+="<!--@"+escapeComment(atbs)+"-->");return}result+="<"+tag;var end=0,re=/^\s*(\w+)(?:\s*=\s*(?:(["'])(.*?)\2|()([\w_-]+)))?/,m;while(m=re.exec(atbs)){atbs=atbs.substring(m[0].length);var atb=m[1].toLowerCase(),quote=m[2]||'"',val=m[3]||m[5];if(!allowedAttributes[atb]||!allowedValue(atb,val)){warn&&warn("forbidden attribute: "+atb);if(!preserve)continue;atb="disabled-"+atb}result+=" "+atb+(val===undefined?"":"="+quote+escapeValue(atb,val)+quote)}autoClosed?result+="/>":result+=">",atbs=atbs.trim(),warn&&atbs&&warn("malformed attribute: "+atbs),preserve&&atbs&&(result+="<!--@"+escapeComment(atbs)+"-->")}var result="",inside="text";return function(frag){result="";if(inside==="comment")return skipTillMarker("<"+frag,"-->","");if(inside==="cdata")return skipTillMarker("<"+frag,"]]>","]]");if(inside==="script")return skipTillClosing(frag,"script");if(inside==="style")return skipTillClosing(frag,"style",allowedTags.style);if(/^!--/.test(frag))return inside="comment",preserve&&(result+="<!-- "),skipTillMarker(frag.substring(3),"-->","");if(/^!\[CDATA\[/.test(frag))return inside="cdata",warn&&warn("forbidden CDATA"),preserve&&(result+="<!--"),skipTillMarker(frag.substring(1),"]]>","]]");if(/^script\b/i.test(frag))return inside="script",warn&&warn("forbidden *** SCRIPT *** element"),preserve&&(result+="<!--"),skipTillClosing(frag,"script");if(/^style\b/i.test(frag))return inside="style",!allowedTags.style&&warn&&warn("forbidden STYLE element"),preserve&&!allowedTags.style&&(result+="<!--"),skipTillClosing(frag,"style",allowedTags.style);var end=frag.indexOf(">");if(end<0)return reject(frag,warn);var m=/^(\/?)(\w+)/.exec(frag);if(!m)return reject(frag,warn);var tag=m[2].toLowerCase();if(!allowedTags[tag])warn&&!m[1]&&warn("forbidden "+tag.toUpperCase()+" element"),preserve&&reject(frag.substring(0,end+1)),escapeText(frag.substring(0,end+1));else{var autoClosed=frag[end-1]==="/";escapeTag(tag,m[1],frag.substring(m[1].length+tag.length,autoClosed?end-1:end),autoClosed)}return result+=escapeText(frag.substring(end+1)),result}}options=fixOptions(options);var allowedTags=map(options.allowedTags),allowedAttributes=map(options.allowedAttributes),allowedSchemes=map(options.allowedSchemes),urlAttributes=/^(href|src|dynsrc|lowsrc|background)$/i,preserve=options.preserve,warn=options.warn;return options.streaming?function(){var process;return function(text){if(text.indexOf("<")>=0)throw new Error("internal error: bad HTML fragment");return process?process(text):(process=create(),escapeText(text))}}():function(text){var process=create(),frags=text.split("<"),result=escapeText(frags[0]);return frags.slice(1).reduce(function(r,frag){return r+process(frag)},result)}}}),define("syracuse-tablet/html/js/helpers/html-escape/lib/unescape",["require","exports","module"],function(require,exports,module){exports.unescaper=function(options){function uncomment(str){return str.replace(/__>/g,"-->")}function process(str){return str.replace(/disabled-(\w+=?)/g,"$1").replace(/(.?)<!--(.*?)-->/g,function(all,ch,commented){if(commented[0]===" ")return ch+"<!--"+commented.substring(1)+"-->";if(commented[0]==="[")return ch+"<!"+uncomment(commented)+">";if(commented[0]==="<")return ch+uncomment(commented);if(commented[0]==="@")return uncomment(commented.substring(1))+ch;throw new Error("cannot unescape: "+commented)})}options=options||{};if(options.streaming){var buf="";return function(str){if(str===undefined)return process(buf);var start=Math.max(0,buf.length-2);buf+=str;var end=buf.indexOf("-->",start);if(end<0)return"";var r=process(buf.substring(0,end+3));return buf=buf.substring(end+3),r}}return process}}),define("syracuse-tablet/html/js/helpers/html-escape/index",["require","exports","module","./lib/escape","./lib/unescape"],function(require,exports,module){exports.escaper=require("./lib/escape").escaper,exports.unescaper=require("./lib/unescape").unescaper}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/lib/rtfparse",["require","exports","module"],function(require,exports,module){function builder(error){var group=[],stack=[group];return{open:function(){var g=[];group.push(g),stack.push(g),group=g},close:function(){stack.length<=1&&error("too many }"),group=stack.pop(),group=stack[stack.length-1]},text:function(str){group.push(str)},control:function(word,arg){var obj={word:word};arg!=null&&(obj.arg=arg),group.push(obj)},getResult:function(){return stack.length!==1&&error("missing }"),stack[0][0]}}}var lowerLetter={},digit={},LF="\n".charCodeAt(0),SP=" ".charCodeAt(0),BSLASH="\\".charCodeAt(0),OPEN="{".charCodeAt(0),CLOSE="}".charCodeAt(0),DASH="-".charCodeAt(0),QUOTE="'".charCodeAt(0),STAR="*".charCodeAt(0);(function(){function add(clas,chs,i){chs.split("").forEach(function(ch){clas[ch.charCodeAt(0)+(i||0)]=!0})}for(var i=0;i<=9;i++)add(digit,"0",i);for(var i=0;i<26;i++)add(lowerLetter,"a",i)})(),exports.parse=function(str){function error(msg){var end=str.indexOf(/[\n>]/,pos);return end<0&&(end=str.length),new Error("Invalid RTF: "+msg+" at line "+line+" near "+str.substring(pos,end))}function flush(){pos>begText&&bld.text(str.substring(begText,pos))}str=str.replace(/\r\n/g,"\n");var pos=0,begText=0,len=str.length,line=1,bld=builder(error);while(pos<len){var ch=str.charCodeAt(pos);switch(ch){case BSLASH:flush();var beg=++pos;while(lowerLetter[ch=str.charCodeAt(pos)])pos++;if(pos>beg){var word=str.substring(beg,pos),arg=undefined;if(ch===DASH||digit[ch]){beg=pos,pos++;while(digit[ch=str.charCodeAt(pos)])pos++;arg=parseInt(str.substring(beg,pos),10)}(ch===SP||ch===LF||word==="u"&&ch!==BSLASH&&ch!==OPEN&&ch!==CLOSE)&&pos++,bld.control(word,arg)}else if(ch===QUOTE){var symb=String.fromCharCode(parseInt(str.substring(pos+1,pos+3),16));bld.text(symb),pos+=3}else ch===STAR&&(bld.control("*"),pos++);begText=pos;break;case OPEN:flush(),bld.open(),begText=++pos;break;case CLOSE:flush(),bld.close(),begText=++pos;break;case LF:flush(),line++,begText=++pos;break;default:pos++}}return flush(),bld.getResult()}}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/lib/rtfinterpret",["require","exports","module"],function(require,exports,module){exports.interpret=function(root){function interpretFont(features,index,fonts){var fname=features[0].word+features[0].arg,font=documentModel.fonts[fname]={};for(var i=1;i<features.length;i++)interpretFontFeature(features[i],font)}function interpretFontFeature(feature,font){var sep;typeof feature=="string"&&(sep=feature.indexOf(";"))>0&&(font.name=feature.substring(0,sep))}function interpretStylesheet(features,index,styles){var fname,style;if(features[0].word){fname=features[0].word+features[0].arg,style=documentModel.styles[fname]={};for(var i=1;i<features.length;i++)interpretStyleFeature(features[i],style)}}function interpretStyleFeature(feature,style){var sep;typeof feature=="string"&&(sep=feature.indexOf(";"))>0&&(style.name=feature.substring(0,sep))}function interpretControl(node,parent,index){switch(node.word){case"rtf":case"ansi":case"ansicpg":break;case"stylesheet":parent.slice(1).filter(function(item){return Array.isArray(item)}).forEach(interpretStylesheet);break;case"deff":documentModel.deffont="f"+node.arg;break;case"fonttbl":parent.slice(1).filter(function(item){return Array.isArray(item)}).forEach(interpretFont);break;case"colortbl":var i=1;parent[i]===";"&&(documentModel.colors.push([0,0,0]),i++);while(i<parent.length)documentModel.colors.push([parent[i].arg,parent[i+1].arg,parent[i+2].arg]),i+=4;break;case"*":supported.indexOf(parent[index+1].word)==-1&&parent.splice(index,parent.length-index)}}function interpretNode(node,index,array){Array.isArray(node)?node.forEach(interpretNode):typeof node=="object"&&interpretControl(node,array,index)}var group,documentModel={deffont:"",fonts:{},colors:[],styles:{}},fontfamgroups={fnil:"Sans-serif",froman:"Sans-serif",fswiss:"Serif",fmodern:"Monospace",fscript:"Cursive",fdecor:"Cursive"},supported=["rtf","ansi","ansicpg","deff","fonttbl","colortbl","stylesheet","fs","f","cf","highlight","i","b","ul","strike","plain","qc","ql","qr","qj","par","pard","pn"];return interpretNode(root),documentModel}}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/lib/buildhtml",["require","exports","module"],function(require,exports,module){function rgbToHex(rgb){return rgb?toHex(rgb[0])+toHex(rgb[1])+toHex(rgb[2]):"000000"}function toHex(n){return("00"+n.toString(16)).slice(-2)}function twipsToPoint(t){return t/20}function indentCount(t){return t/600}function indentBulletCount(t){return t/420}function twipsToPixel(t){return t/15}function builder(documentModel){function newWorker(){return $current=$worker=$("<div>").addClass("s-rtf-worker").addClass("s-rtf-clean"),$worker.appendTo($section)}function newSection(){return $section=$("<div>").addClass("s-rtf-section").addClass("s-rtf-clean"),newWorker(),$section.appendTo($rootdiv)}function characterFormatting(node){switch(node.word){case"f":var fontface=rtffonts[node.word+node.arg].name;return $("<font face='"+fontface+"'>");case"fs":return $("<span style='font-size: "+node.arg/2+"pt;'>");case"tab":return $("<blockquote>");case"cf":case"highlight":return $("<span style='"+styleName[node.word]+": #"+rgbToHex(colors[node.arg])+";'>");case"b":return $("<b>");case"i":return $("<i>");case"ul":return $("<u>");case"strike":return $("<s>");default:}}function paragraphFormatting(elt,node){elt.addClass("s-rtf-format"),dirty();switch(node.word){case"ql":return elt.attr("align","left");case"qc":return elt.attr("align","center");case"qr":return elt.attr("align","right");case"qj":return elt.attr("align","justify");case"li":return node.arg>0?elt.css("margin-left",twipsToPoint(node.arg)+"pt"):elt;case"ri":return node.arg>0?elt.css("margin-right",twipsToPoint(node.arg)+"pt"):elt;default:return elt}}function dirty(){$worker&&$worker.removeClass("s-rtf-clean"),$section&&$section.removeClass("s-rtf-clean")}function append(elt){dirty(),$current.append(elt)}function wrapIn(elt){dirty(),$current=elt.appendTo($current)}var rtffonts=documentModel.fonts,deffont=documentModel.deffont,colors=documentModel.colors,styles=documentModel.styles,htmltext="",$rootdiv=$("<div>").addClass("s-rtf-root"),$current=null,$section=null,$worker=null,context;return newSection(),context=function(){function flattenFormat(){var f,fmt={};return stack.forEach(function(ctx){f=ctx.format,Object.keys(f).forEach(function(key){typeof fmt[key]=="undefined"&&(fmt[key]=f[key])})}),fmt}var stack=[{format:{}}],current=stack[0];return{open:function(){stack.push(current={format:{}})},close:function(idx,parent){stack.pop(),current=stack[stack.length-1],idx<parent.length-1&&(this.pending=!0)},update:function(prop,el){el===null?delete current.format[prop]:current.format[prop]=el},startOver:function(){if(!this.pending)return;var fmt=flattenFormat();Object.keys(fmt).forEach(function(key){$current=fmt[key].clone().appendTo($current)}),this.pending=!1}}}(),{text:function(str){dirty(),context&&context.startOver();var content=$current.html();$current.html(content+str)},open:function(){context.open()},close:function(idx,parent){$current=$worker,$current.length===0&&($current=$rootdiv),context.close(idx,parent)},control:function(node){switch(node.word){case"par":dirty(),$worker.removeClass("s-rtf-worker").addClass("s-rtf-paragraph"),$current=$worker=newWorker(),context&&(context.pending=!0);break;case"pard":$section.hasClass("s-rtf-clean")||($section=newSection(),context&&(context.pending=!0));break;case"pn":$section.addClass("s-rtf-list");break;case"u":this.unicodechar(node.arg);break;case"qc":case"ql":case"qr":case"qj":case"ri":paragraphFormatting($section,node);break;case"li":$section.hasClass("s-rtf-list")?$section.attr("indent",indentBulletCount(node.arg)):(!$section.hasClass("s-rtf-clean")&&!$section.hasClass("s-rtf-format")&&($section=newSection(),context&&(context.pending=!0)),$section.addClass("s-rtf-left-indent"),$section.attr("indent",indentCount(node.arg)));break;case"lquote":case"rquote":this.text("'");break;case"line":append("<br>");break;case"bullet":break;case"i":case"b":case"strike":case"ulnone":case"ul":if(node.arg===0||node.word==="ulnone"){var tagname;node.word==="strike"?tagname="s":node.word==="ulnone"?tagname="u":tagname=node.word;if($current.is(tagname))$current=$current.parent();else if($current.html()!==""){var tag=$current.closest(tagname);$current=tag.parent()}context.update(node.word,null);break};default:var el=characterFormatting(node);el&&(context.update(node.word,el.clone()),!context.pending&&wrapIn(el))}},unicodechar:function(code){dirty();var content=$current.html();$current.html(content+String.fromCharCode(code))},getHtml:function(){$rootdiv.find(".s-rtf-clean").remove();var sections=$rootdiv.find(".s-rtf-section.s-rtf-list");sections.map(function(i,e){var $e=$(e),i=parseInt($e.attr("indent"),10),w=[];while(w.length<i)w.push("<ul>");$e.wrap(w.join("")).contents()});var workers=sections.find(".s-rtf-paragraph");workers.wrap("<li>").contents().unwrap();var indent=$rootdiv.find(".s-rtf-section.s-rtf-left-indent").removeClass("s-rtf-left-indent");indent.map(function(i,e){var $e=$(e),i=parseInt($e.attr("indent"),10),w=[];while(w.length<i)w.push("<blockquote>");$e.wrap(w.join("")).contents(),$e.removeAttr("indent")}),sections=$rootdiv.find(".s-rtf-section"),sections.find(".s-rtf-paragraph").removeAttr("class").wrap("<p>").contents().unwrap(),sections.find("div:empty").remove(),sections.find(".s-rtf-worker:empty").remove(),sections.filter(":not(.s-rtf-format)").contents().unwrap();while($rootdiv.find("span:empty").length)$rootdiv.find("span:empty").remove();return $rootdiv.find(".s-rtf-worker").removeAttr("class").contents().unwrap(),$rootdiv.find(".s-rtf-format").removeAttr("class"),$rootdiv.html()}}}var styleName={cf:"color",highlight:"background-color"};exports.buildHtml=function(root,documentModel){function interpretNode(node,index,array){if(typeof node=="string"){bld.text(node);return}if(Array.isArray(node)&&node.length>0){if(node[0])switch(node[0].word){case"fonttbl":case"colortbl":case"stylesheet":case"pntxtb":case"pntext":case"pict":return}bld.open(),node.forEach(interpretNode),bld.close(index,array);return}typeof node=="object"&&bld.control(node)}var bld=builder(documentModel);return interpretNode(root,0,[]),root?bld.getHtml():"<div></div>"}}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/lib/buildrtf",["require","exports","module"],function(require,exports,module){function colourNameToHex(color){return colors[color.toLowerCase()]}function rtfContext(){return{open:function(key){this[key]||(this[key]={},this[key].current=0),this[key].current++,this[key].pending=!0,this[key].value&&this[key].value[this[key].current-1]&&this[key].value.pop()},close:function(key){this[key].current--,this[key].current?this[key].pending=!0:this[key].pending=!1},current:function(key){return this[key]?this[key].current:0},pending:function(key,val){return val!==undefined&&(this[key]||(this[key]={}),this[key].pending=val),this[key]?this[key].pending:!1},value:function(key,val){return this[key]?(val!==undefined&&(val=parseInt(val,10),this[key].value===undefined&&(this[key].value=[]),this[key].value.push(this[key].current-1?this[key].value[this[key].current-2]+val:val)),this[key]&&this[key].value?this[key].value[this[key].current-1]:0):0},nl:!1,par:!1,ulindent:0}}function builder(documentModel){function has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function isEmpty(obj){if(obj==null)return!0;for(var key in obj)if(has(obj,key))return!1;return!0}function fromHtmlTag(tag){tag=tag.toLowerCase();switch(tag){case"p":return"\\par";case"b":return"\\b";case"i":return"\\i";case"u":return"\\ul";case"s":return"\\strike";case"br":return"\\par";case"blockquote":return"";default:return""}}var rtffonts=documentModel.fonts,colors=documentModel.colors,rtftext="",needSpace=!1,ctx=rtfContext();return isEmpty(rtffonts)||(rtftext+="{\\fonttbl",Object.keys(rtffonts).forEach(function(key){rtftext+="{\\"+key+" "+rtffonts[key].name+";}"}),rtftext+="}"),colors.length>1&&(rtftext+="{\\colortbl",colors.forEach(function(e){e[0]===0&&e[1]===0&&e[2]===0?rtftext+=";":rtftext+="\\red"+e[0]+"\\green"+e[1]+"\\blue"+e[2]+";"}),rtftext+="}"),rtftext+="\\uc0\\pard",{open:function(){rtftext+="{",needSpace=!1},text:function(str){var pos=0,beg=pos,c;while(pos<str.length){while(str.charCodeAt(pos)<=128&&str.charCodeAt(pos)!=10)pos++;pos>beg?rtftext+=(needSpace?" ":"")+str.substring(beg,pos):str.charCodeAt(pos)==10&&(rtftext+=needSpace?" ":""),needSpace=!1,pos<str.length&&(c=str.charCodeAt(pos),c===160||c===10?rtftext+=" ":this.controlarg("u",str.charCodeAt(pos)),pos++),beg=pos}},fragment:function(str){rtftext+=str,needSpace=!1},font:function(fid){fid!==""&&(rtftext+="\\"+fid,needSpace=!0)},controlarg:function(word,arg){rtftext+="\\"+word+arg,needSpace=!0},control:function(word){ctx.par=word=="par",rtftext+="\\"+word,needSpace=!0},htmltag:function(word){var rtf=fromHtmlTag(word);rtf&&(ctx.par=rtf=="\\par"),rtftext+=rtf,needSpace=!0},star:function(){rtftext+="\\*",needSpace=!1},close:function(){ctx.par||(rtftext+="\\par"),rtftext="{\\rtf1\\ansi"+rtftext+"}",needSpace=!1},getRtf:function(){return rtftext},context:ctx}}var colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",window:"#ffffff",windowframe:"#000000",windowtext:"#000000"},tagMap={"margin-left":"li","margin-right":"ri","margin-top":"sb","margin-bottom":"sa"},toTwips=function(unit,v){var ratio={pt:20,px:15,mm:56.7,cm:567,"in":1440.18};return function(unit,v){return v*(ratio[unit]||ratio.px)}}();exports.buildRtf=function(html){function findColor(arr,obj){if(!obj)return-1;for(var i=0;i<arr.length;i++)if(arr[i][0]==obj[0]&&arr[i][1]==obj[1]&&arr[i][2]==obj[2])return i;return-1}function isLeftIndent(n){return $(n).is("div[style]")?$(n).attr("style").search("margin-left")>-1:!1}function addFont(face){rtffonts.indexOf(face)<0&&rtffonts.push(face)}function findFont(fontname){var fonts=documentModel.fonts,keys=Object.keys(fonts);for(var i=0;i<keys.length;i++)if(fonts[keys[i]].name===fontname)return keys[i];return""}function isList(n){return $(n).is("ul")||$(n).is("li")||n.childElementCount>0&&n.firstChild.nodeName==="UL"}function processNode(n,i){var clr,idx,colorid;bld.context.pending("blockquote")&&!bld.context.current("list")&&!$(n).is("blockquote")&&!$(n).is("div")&&!bld.context.current("list")&&!isList(n)&&(bld.control("li"+bld.context.current("blockquote")*600),bld.context.pending("blockquote",!1));if(n.nodeType===3)bld.text(n.nodeValue),bld.context.par=!1,n.nextSibling&&$(n.nextSibling).is("blockquote")&&bld.control("par");else if($(n).is("*[style]")&&!$(n).is("blockquote")){var rules=$(n).attr("style").split(";"),drill=!($(n).attr("style").search("text-align")>-1&&$(n).attr("style").search("margin-left")>-1),tal=null;n.nodeName=="B"&&bld.htmltag(n.nodeName),rules.forEach(function(e){var stylerule=e.split(":");stylerule[0]!=null&&(stylerule[0]=stylerule[0].replace(/^\s*/,"").replace(/\s*$/,"")),stylerule[1]!=null&&(stylerule[1]=stylerule[1].replace(/^\s*/,"").replace(/\s*$/,""));switch(stylerule[0]){case"color":stylerule[1].substring(0,3)==="rgb"?(clr=rgbColor(stylerule[1]),idx=findColor(documentModel.colors,clr)):idx=findColorInColortbl(stylerule[1]),colorid="cf",bld.controlarg(colorid,idx);break;case"background-color":stylerule[1].substring(0,3)==="rgb"?(clr=rgbColor(stylerule[1]),idx=findColor(documentModel.colors,clr)):idx=findColorInColortbl(stylerule[1]),colorid="highlight",bld.controlarg(colorid,idx);break;case"text-decoration":stylerule[1]==="underline"?bld.control("ul"):stylerule[1]==="line-through"&&bld.control("strike");break;case"font-style":stylerule[1]==="italic"&&bld.control("i");break;case"font-weight":stylerule[1]==="bold"&&bld.control("b");break;case"font-size":var tmp=$(n).attr("style"),m=/([0-9\.\-]+)([A-Za-z]*)/g.exec(stylerule[1]),unit=m[2]&&m[2].toLowerCase();if(unit!="em"){var points=parseFloat(stylerule[1]),halfpoints=Math.round(points*2);bld.controlarg("fs",halfpoints),bld.context.fs=!0}break;case"margin-left":var m=/([0-9\.\-]+)([A-Za-z]*)/g.exec(stylerule[1]),unit=m[2]&&m[2].toLowerCase()||"px",val=parseInt(m[1],10);if($(n).is("ul"))bld.context.ulindent=val/40,bld.context.open("list");else if($(n).is("div")||$(n).is("p"))bld.context.open("lindent"),bld.context.value("lindent",val),bld.controlarg(tagMap[stylerule[0]],toTwips(unit,bld.context.value("lindent"))),tal&&bld.control(align[tal]);drill&&($(n).contents().each(visit),n.nodeName==="P"?(bld.context.close("lindent"),bld.control("par")):n.nodeName==="DIV"&&bld.context.close("lindent"),bld.context.current("lindent")?bld.controlarg(tagMap[stylerule[0]],toTwips(unit,bld.context.value("lindent"))):bld.control("pard")),drill=!0;break;case"margin-right":case"margin-top":case"margin-bottom":var m=/([0-9\.\-]+)([A-Za-z]*)/g.exec(stylerule[1]),unit=m[2]&&m[2].toLowerCase()||"px",val=parseInt(m[1],10);bld.controlarg(tagMap[stylerule[0]],toTwips(unit,val)),$(n).contents().each(visit),n.nodeName==="P"&&bld.control("par"),bld.control("pard");break;case"margin":$(n).contents().each(visit),n.nodeName==="P"&&bld.control("par");break;case"text-align":if(drill){bld.control("pard");var alignment=stylerule[1];bld.control(align[alignment]),$(n).contents().each(visit),bld.control("par"),bld.control("pard")}else tal=stylerule[1];drill=!0}})}else if($(n).is("font")){if($(n).is("font[face]")){var face=$(n).attr("face");bld.font(findFont(face))}$(n).is("font[color]")&&(idx=findColorInColortbl($(n).attr("color")),colorid="cf",bld.controlarg(colorid,idx)),$(n).is("font[bgcolor]")&&(idx=findColorInColortbl($(n).attr("bgcolor")),colorid="highlight",bld.controlarg(colorid,idx)),$(n).is("font[size]")&&(idx=findFontSize($(n).attr("size")),bld.controlarg("fs",idx))}else if($(n).is("div[align]")){var alignment=$(n).attr("align");bld.control("pard"),bld.control(align[alignment]),$(n).contents().each(visit),n.childElementCount>0&&n.firstChild.nodeName==="P"||bld.control("par"),bld.control("pard")}else if(n.nodeName==="UL")bld.control("pard"),bld.context.open("list");else if(n.nodeName==="LI"){bld.fragment("{\\pntext"),bld.font(findFont("Symbol")),bld.fragment("\\'B7\\tab}");if(bld.context.pending("list")){var uls=bld.context.current("list")+bld.context.current("blockquote")+bld.context.ulindent;uls+=bld.context.current("lindent"),bld.fragment("{\\*\\pn\\pnlvlblt\\pnf1\\pnindent0{\\pntxtb\\'B7}}\\f0\\li"+uls*420),bld.context.ulindent=0,bld.context.pending("list",!1)}}else n.nodeName==="P"?bld.control("par"):bld.htmltag(n.nodeName)}function parseColor(color){var match=/#(..)(..)(..)/.exec(color)||/#(..)(..)(..)/.exec(colourNameToHex(color));return match&&match.slice(1).map(function(v){return parseInt(v,16)})}function findColorInColortbl(colorstr){var parsedclr=parseColor(colorstr),idx=findColor(documentModel.colors,parsedclr);return idx==-1?-1:idx}function findFontSize(size){return size=parseInt(size,10),size<0||size>7?0:[0,18,20,24,28,36,48,72][size]}function scan(n){if(!n)return;n.each(visit)}function processColor(coln,atb){coln.each(function(i,e){var tmp=$(e).attr(atb),rgb=parseColor(tmp);rgb&&findColor(documentModel.colors,rgb)==-1&&documentModel.colors.push(rgb)})}function processColorStyle(coln){var clr,idx;coln.each(function(i,e){var s=$(e).attr("style"),styles=s&&s.replace(/[\n\r]*\s*/g,"").split(";"),colorstyles=styles&&styles.filter(function(e){var rule=e.split(":");return rule[0]=rule[0].replace(/^\s*/,"").replace(/\s*$/,""),["color","background-color","background"].indexOf(rule[0])!=-1}),stylerule=colorstyles&&colorstyles[0]&&colorstyles[0].split(":");stylerule&&stylerule[1]&&(stylerule[1]=stylerule[1].replace(/^\s*/,"").replace(/\s*$/,""),stylerule[1].substring(0,3)==="rgb"?(clr=rgbColor(stylerule[1]),idx=findColor(documentModel.colors,clr)):(idx=findColorInColortbl(stylerule[1]),clr=parseColor(stylerule[1])),idx==-1&&clr&&documentModel.colors.push(clr))})}function extractFontsAndColors(){var fnts=$root.find("font[face]"),clrs=$root.find("font[color]"),bgclrs=$root.find("font[bgcolor]"),stylebgclrs=$root.find('*[style*="background-color"]'),styleclrs=$root.find('*[style*="color"]');addFont("MS Sans Serif"),fnts.each(function(i,e){addFont($(e).attr("face"))}),$root.find("ul").length>0&&addFont("Symbol"),processColor(clrs,"color"),processColor(bgclrs,"bgcolor"),processColorStyle(stylebgclrs),processColorStyle(styleclrs)}function rgbColor(colorString){var match=/\s*rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\);*/.exec(colorString);return match?match.slice(1).map(function(elt){return parseInt(elt,10)}):[]}function visit(i,e){var $e=$(e),$contents;if($e.is("blockquote"))bld.context.open("blockquote");else if($e.is("div[align]")||$e.is("*[style*=text-align]")||$e.is("*[style*=margin]")){processNode(e,i),e.nodeName==="UL"&&bld.control("pard");return}var grp,nl,sibling=e.nextSibling,crlf=e.nodeName==="P"&&e.childElementCount===1&&e.firstChild.nodeName==="BR";$contents=$e.contents(),!$e.is("blockquote")&&sibling&&sibling.nodeName==="DIV"&&!isLeftIndent(e)&&!isLeftIndent(sibling)?(!(sibling.childElementCount>0)||sibling.firstChild.nodeName!=="BR"&&sibling.firstChild.nodeName!=="P")&&!crlf&&(nl=!0):$contents.length>0&&sibling&&!$e.is("ul")&&!$e.is("li")&&!$e.is("blockquote")&&!$e.is("p")&&(grp=!0,bld.fragment("{"));if($e.is("p[align]")){var alignment=$e.attr("align");bld.control("pard"),bld.control(align[alignment])}$e.is("p")||processNode(e,i),$contents.each(visit),e.nodeName==="P"&&!nl&&!crlf&&processNode(e,i),(e.nodeName==="B"||$e.is("*[style*=font-weight]"))&&bld.control("b0"),(e.nodeName==="U"||$e.is("*[style*=text-decoration]"))&&bld.control("ul0"),$e.is("*[style*=font-size]")&&bld.context.fs&&(bld.context.fs=!1,grp||bld.control("fs16")),(e.nodeName==="I"||$e.is("*[style*=font-style]"))&&bld.control("i0"),$e.is("*[style*=color]")&&!$e.is("*[style*=background-color]")&&!grp&&bld.control("cf0"),e.nodeName==="UL"?(bld.context.close("list"),bld.control("pard"),bld.context.par=!0,bld.context.current("blockquote")&&bld.context.pending("blockquote",!0),bld.context.current("lindent")&&e.nextSibling&&e.nextSibling.nodeType===3&&bld.control("li"+toTwips("px",bld.context.value("lindent")))):$e.is("li")&&bld.control("par"),grp&&bld.fragment("}"),$e.is("blockquote")&&bld.context.current("blockquote")&&(bld.context.pending("blockquote")?(bld.context.close("blockquote"),!bld.context.current("blockquote")&&sibling&&!$(sibling).html()&&(bld.context.nl=!0)):(bld.context.par||bld.control("par"),bld.control("pard"),bld.context.close("blockquote")));if(nl||bld.context.nl)bld.context.nl=!1,bld.control("par")}function createFontTable(){var fname;for(var i=0;i<rtffonts.length;i++)fname="f"+i,documentModel.fonts[fname]={name:rtffonts[i]}}var documentModel={};documentModel.deffont="",documentModel.fonts={},documentModel.colors=[],documentModel.styles={};var fontfamgroups={fnil:"Sans-serif",froman:"Sans-serif",fswiss:"Serif",fmodern:"Monospace",fscript:"Cursive",fdecor:"Cursive"},align={left:"ql",center:"qc",right:"qr",justify:"qj"},pointPxTable=[{pt:6,px:7},{pt:7,px:9},{pt:40,px:50}],bld,$root=$("<div>").append(html),rtffonts=[];documentModel.colors.push([0,0,0]),extractFontsAndColors(),createFontTable(),bld=builder(documentModel),scan($root),bld.close();var rtftxt=bld.getRtf();return rtftxt}}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/lib/index",["require","exports","module","./rtfparse","./rtfinterpret","./buildhtml","./buildrtf"],function(require,exports,module){var rtfParser=require("./rtfparse"),rtfInterpreter=require("./rtfinterpret"),htmlBuilder=require("./buildhtml"),rtfBuilder=require("./buildrtf");module.exports={toHtml:function(rtf,options){rtf=rtf||"";var root=rtfParser.parse(rtf),model=rtfInterpreter.interpret(root);return htmlBuilder.buildHtml(root,model)},fromHtml:function(html,options){return rtfBuilder.buildRtf(html)}}}),define("syracuse-tablet/html/js/helpers/syracuse-rtf/index",["require","exports","module","./lib/index"],function(require,exports,module){module.exports=require("./lib/index")}),define("syracuse-tablet/html/js/controls/fields/ctrlText",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/helpers/html-escape/index","syracuse-tablet/html/js/helpers/syracuse-rtf/index"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),sdataRequester=require("syracuse-tablet/html/js/sdata/sdataRequester"),escaper=require("syracuse-tablet/html/js/helpers/html-escape/index").escaper({warn:console.warn.bind(console),allowedAttributes:["style"],allowedTags:["span"]}),rtf=require("syracuse-tablet/html/js/helpers/syracuse-rtf/index"),_baseHeight=34;exports.CtrlText=utils.defineClass(function CtrlText(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options),this.cssType="s-m-clob s-m-"+this.$type.replace("/","-")},Base,{destroy:function(){$(this.$$input).off("keyup input"),Base.prototype.destroy.call(this)},_getHeightPixelValue:function(authH){switch(authH){case"medium":return 2*_baseHeight;case"large":return 4*_baseHeight;case"xlarge":return 8*_baseHeight;default:return _baseHeight}},buildFieldValue:function(){var self=this;self._ensure$$value(),self._clear$$value();var $$container=$('<section><div class="s-m-enriched-text"></div></section>').appendTo(self.$$value).children(":first-child"),$$textContent=$(uiUtils.createDomElement("div",["s-m-enriched-text-content"],null,null,$$container));self.authH=self.getAuthoring("$textHeight","medium"),self.authH=self._getHeightPixelValue(self.authH);var $url=self.controller.getLazyUrl(self.$bind);sdataRequester.getLazyPropData($url,self.prototype.json,self.$type).then(function(data){var content=data;self.setValue(content);var empty=(content==null||content.length===0)&&!self.$isEditMode;self.$$elmt.toggleClass("s-m-empty",empty);var $$dataArr=[];switch(self.$type){case"text/plain":self._buildFieldFromPlain(content,$$textContent);break;case"text/html":self._buildFieldFromHtml(content,$$textContent);break;case"text/rtf":self._buildFieldFromRtf(content,$$textContent)}var lineheight=parseInt($$textContent.css("line-height").replace("px",""),10),multiplier=Math.floor(self.authH/lineheight);self.computedHeight=lineheight*multiplier,$$textContent.css({height:self.computedHeight+"px"}),self._appendExpander($$textContent)}).fail(function(e){self._insertError(e.message)})},_buildFieldFromPlain:function(data,$$parent){var self=this;this.$isEditMode?(self.createMainInput(data,"textplain",{wrap:"soft",spellcheck:!1,autocorrect:"off",autocomplete:"off",style:"overflow-y:hidden;box-size:border-box;resize:none;width:100%;height:100%",row:"2"},$$parent),this.$$input.val(data),this.$$input.on("keyup input",function(){self._triggerResizeInput()})):$$parent.append($.parseHTML(escaper(data.replace(/\n/g,"<BR/>"))))},_buildFieldFromHtml:function(data,$$parent){$$parent.append($.parseHTML(escaper(data)))},_buildFieldFromRtf:function(data,$$parent){this._buildFieldFromHtml(rtf.toHtml(data),$$parent)},_triggerResizeInput:function(){var triggerResize=!1;this.$$expander&&this.$$expander.attr("data-params")==="more"&&(this._expandText(this.$$input.parent()),triggerResize=!0),this._resizeInput(),triggerResize&&uiUtils.triggerResizeInternal({preserveScroll:!0})},_resizeInput:function(options){if(!this.$$input)return!1;this.$$input.parent().css("height","auto"),this.$$input.css("height","auto");var domElmt=this.$$input.get(0),height=options&&options.height!=null?options.height:domElmt.scrollHeight+(domElmt.offsetHeight-domElmt.clientHeight);return this.$$input.css("height",height),!1},_expandText:function($textContent){$textContent.css({height:"auto"}),this.$$expander.toggleClass(fontUtils.getIconByName("expand"),!1),this.$$expander.toggleClass(fontUtils.getIconByName("compress"),!0),this.$$expander.attr("data-params","less")},_compressText:function($textContent){$textContent.css({height:this.computedHeight+"px"}),this.$$expander.toggleClass(fontUtils.getIconByName("compress"),!1),this.$$expander.toggleClass(fontUtils.getIconByName("expand"),!0),this.$$expander.attr("data-params","more")},_actToggleText:function(param){var $textContent=this.$$input?this.$$input.parent():this.$$elmt.find(".s-m-enriched-text-content");param==="more"?(this.currentHeight=null,this._expandText($textContent),this._resizeInput()):(this._compressText($textContent),this._resizeInput({height:"100%"})),uiUtils.triggerResizeInternal({preserveScroll:!0})},_insertError:function(msg){var err=['<span class="s-m-error"><p>'];err.push(msg),err.push("<p></span>"),$(err.join("")).appendTo(this.$$elmt)},_appendExpander:function($$container){var self=this,scrollHeight=self.$$input?self.$$input.scrollHeight:$$container.get(0).scrollHeight;if(scrollHeight>self.computedHeight&&scrollHeight-self.computedHeight>5){var buttonTmpl='<a href="#" class="'+fontUtils.getIconByName("expand")+'" data-nevent data-naction="toggleText"				data-control-id="'+self.id+'" data-params="more"></a>',$$expander=self.$$expander=$(buttonTmpl);$$expander.insertBefore($$container),$$expander.css("float","right"),$$expander.wrap("<div class='s-m-enriched-text-expander'></div>"),$$expander.parent().height($$expander.outerHeight())}}})}),define("syracuse-tablet/html/js/controls/fields/ctrlDocument",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/sdata/datasetUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils");exports.CtrlDocument=utils.defineClass(function CtrlDocument(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options),this.cssType="s-m-document"},Base,{initReuseProperties:function(){Base.prototype.initReuseProperties.call(this),this.$$layout=null},applyMetaData:function(metaData,buildOptions){Base.prototype.applyMetaData.call(this,metaData,buildOptions);if(this.$isEditMode&&this.$$layout)var disabled=datasetUtils.isDisabled(metaData)},buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var docUrl=this.controller.getValue(this.$bind)||"";docUrl=docUrl&&docUrl+"?salt="+(new Date).getTime();var empty=docUrl.length===0;if(empty)this.$$value.addClass("s-m-empty");else var classcss=["img-responsive",this._getIcon()],e=uiUtils.createDomElement("span",classcss,null,{href:"#","data-nevent-ctrl-click":""},this.$$value)},onClick:function(evt){var dom=evt.target.parentNode,parentDom;this._openDocument()},_openDocument:function(){var docUrl=this.controller.getValue(this.$bind)||"",empty=docUrl.length===0;empty||window.open(docUrl,"_blank")},_getIcon:function(){return fontUtils.documentFieldIcon()}}),exports.CtrlBinary=utils.defineClass(function CtrlBinary(controller,article,prototype,options){var self=this;exports.CtrlDocument.call(self,controller,article,prototype,options),self.cssType="s-m-binary"},exports.Document,{_getIcon:function(){return fontUtils.binaryFieldIcon()}})}),define("syracuse-tablet/html/js/controls/ctrlTypeUnknown",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/ctrlBase","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase,utils=require("syracuse-tablet/html/js/helpers/utils");exports.CtrlTypeUnknown=utils.defineClass(function CtrlTypeUnknown(controller,article,prototype,options){Base.call(this,controller,"application/x-unknown",article,options),this.prototype=prototype},Base,{buildHtml:function(){var classes=["s-m-control","s-m-unknown","s-m-ctrl"];this.createRootElement(classes);var $type=this.prototype.data("$type"),bind=this.article.$bind?this.article.$bind:"unknown";this.$$elmt.html('<div class="s-m-value">Field '+bind+" - "+($type?"Unknown type["+$type+"]":"Empty $type")+"</div>")}})}),define("syracuse-tablet/html/js/app/settings",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/storage/storage"],function(require,exports,module){function _getStorage(){return _storage||(_storage=modules.get("storage").getStorage()),_storage}function _getGlobalSettings(){return _getStorage().read({$context:_globalCtx,$collection:"$settings",$endpoint:"$local",$key:"$global_settings"}).then(function(result){return result.$status===storageModule.StatusCodes.OK?result.$data:{}})}function _setGlobalSettings(settings){return _getStorage().put({$context:_globalCtx,$collection:"$settings",$endpoint:"$local",$key:"$global_settings",$data:settings}).then(function(result){return result.$status===storageModule.StatusCodes.OK?result.$data:{}})}var modules=require("syracuse-tablet/html/js/common/modules"),storageModule=require("syracuse-tablet/html/js/storage/storage"),_storage,_globalCtx={$user:"none",$role:"none",$lang:"none"};exports.getLastUsedUserProfile=function(){return _getStorage().read({$context:_globalCtx,$collection:"$settings",$endpoint:"$local",$key:"$last_user_profile"}).then(function(result){return result.$status===storageModule.StatusCodes.OK?result.$data:null})},exports.setLastUsedUserProfile=function(userProfile){return _getStorage().put({$context:_globalCtx,$collection:"$settings",$endpoint:"$local",$key:"$last_user_profile",$data:userProfile}).then(function(result){return result.$status===storageModule.StatusCodes.OK?result.$data:null})},exports.removeLastUsedUserProfile=function(){return _globalCtx?_getStorage().remove({$context:_globalCtx,$collection:"$settings",$endpoint:"$local",$key:"$last_user_profile"}):$.smResolve()},exports.setLoginRememberMe=function(rememberMe){return $.smResolve().then(function(){return _getGlobalSettings()}).then(function(settings){return settings.rememberMe=rememberMe,_setGlobalSettings(settings)})},exports.getLoginRememberMe=function(){return $.smResolve().then(function(){return _getGlobalSettings()}).then(function(settings){return settings.rememberMe===!0})},exports.setDeviceType=function(deviceType){return $.smResolve().then(function(){return _getGlobalSettings()}).then(function(settings){return settings["device-type"]=deviceType,_setGlobalSettings(settings)})},exports.getDeviceType=function(){return $.smResolve().then(function(){return _getGlobalSettings()}).then(function(settings){return settings["device-type"]||"auto"})},exports.readUserPagePrefs=function(pageId){var defRes={favorites:[]};if(pageId==null)return $.smResolve(defRes);var cc=modules.get("appController").App.getCacheContext(),storage=_getStorage(),ctx={$user:cc.$user,$role:"none",$lang:"none"};return storage.read({$context:ctx,$collection:"$settings",$endpoint:"$local",$key:pageId}).then(function(result){var res;return result.$status===storageModule.StatusCodes.OK&&(res=result.$data),res=res||defRes,res.favorites=res.favorites||[],res})},exports.writeUserPagePrefs=function(pageId,prefs){if(pageId==null)return $.smResolve();var storage=_getStorage(),cc=modules.get("appController").App.getCacheContext(),ctx={$user:cc.$user,$role:"none",$lang:"none"};return exports.readUserPagePrefs(pageId).then(function(oldPrefs){return"favorites"in prefs&&(oldPrefs.favorites=prefs.favorites),"filter"in prefs&&(oldPrefs.filter=prefs.filter),"sort"in prefs&&(oldPrefs.sort=prefs.sort),"chartDetail"in prefs&&(oldPrefs.chartDetail=prefs.chartDetail),"search"in prefs&&(oldPrefs.search=prefs.search),oldPrefs}).then(function(newPrefs){return storage.put({$context:ctx,$collection:"$settings",$endpoint:"$local",$key:pageId,$data:newPrefs})})},exports.getPagePrefsId=function(pageName,vignette){var id=[pageName];return vignette!=null&&vignette.page?(id.push(vignette.page.pageName),id.push(vignette.$bind)):id.push("fullpage"),id.join("-")}}),define("syracuse-tablet/html/js/controllers/sdataController",["require","exports","module","syracuse-tablet/html/js/controllers/controller","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controllers/controller").Controller,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester"),protocolHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),environment=require("syracuse-tablet/html/js/helpers/environment"),modules=require("syracuse-tablet/html/js/common/modules"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),locale=require("syracuse-tablet/html/js/helpers/locale"),_isServiceLink=function($link){return $link?$link.$url.indexOf("$services")>=0||$link.$method==="DELETE":!1};exports.SdataController=utils.defineClass(function SdataController(dataset,parent,isWorkingCopy){Base.call(this,parent),this.controlsByBind={},this.clientDiagnosesByBind={},this.dataset=dataset,this.isWorkingCopy=!0,isWorkingCopy!==undefined?this.isWorkingCopy=isWorkingCopy:parent!=null&&(this.isWorkingCopy=parent.isWorkingCopy),this.dataset.addDeltaChangeListener(this),this.pendingRequests=0},Base,{destroy:function(){if(this.destroyed===!0)return;this.dataset&&this.dataset.removeDeltaChangeListener(this),this.isWorkingCopy&&this.isRoot()&&this.dataset&&sdataReq.deleteWC(this.dataset),this.isRoot()&&this.dataset.destroy(),this.dataset=null,this.prototype=null,this.clientDiagnosesByBind=null,Base.prototype.destroy.call(this)},registerControl:function(ctrl){Base.prototype.registerControl.call(this,ctrl);var $bind=ctrl.$bind;if($bind){var perBind=this.controlsByBind[$bind]=this.controlsByBind[$bind]||[];perBind.push(ctrl)}},unregisterControl:function(ctrl){Base.prototype.unregisterControl.call(this,ctrl);var $bind=ctrl.$bind;if($bind){var perBind=this.controlsByBind[$bind];if(perBind){var idx=perBind.indexOf(ctrl);idx>-1&&perBind.splice(idx,1),perBind.length==0&&delete this.controlsByBind[$bind]}}},_controlsByBind:function($bind){var c=this.controlsByBind[$bind];return c},getControlsByBind:function($bind){return this._controlsByBind($bind)},setClientDiagnoses:function($bind,diags){diags=diags||[];for(var i=0;i<diags.length;i++)typeof diags[i]=="string"&&(diags[i]={$severity:"error",$message:diags[i]});this.clientDiagnosesByBind[$bind]=diags},getDiagnoses:function($bind,$severity1,$severity2){var client=this.clientDiagnosesByBind[$bind]||[],server=this.dataset.getDiagnoses($bind),diags=[];Array.prototype.push.apply(diags,client),Array.prototype.push.apply(diags,server);var severities=Array.prototype.slice.call(arguments,1);if(severities==null||severities.length==0)return diags;var results=[];return diags.forEach(function(d){severities.indexOf(d.$severity)>=0&&results.push(d)}),results},findErrornousControls:function(){var self=this,errors=[];return Object.keys(self.clientDiagnosesByBind).forEach(function($bind){var diags=self.clientDiagnosesByBind[$bind];if(diags&&diags.length>0){var controls=self.controlsByBind[$bind];controls&&controls.forEach(function(control){control.validateInput()||errors.push(control)})}}),errors},getValue:function($bind){return this.dataset.getValue($bind)},setValue:function($bind,value,updateUI,noServerUpdate){this.dataset.setValue($bind,value),updateUI===!0&&(noServerUpdate===!0&&this.dataset.clearDiagnoses(this.$bind),this.onDeltaValueChanged(this.dataset,$bind)),noServerUpdate!==!0&&this.root._updateServer($bind).fail(function(result){modules.get("modal").error(result)})},addRow:function(){var row=this.dataset.addRow();return this.root._updateServer().then(function(){return row})},removeRow:function($uuid){return this.dataset.removeRow($uuid),this.root._updateServer()},getLazyUrl:function($bind){return this.dataset.getValue($bind,this.isWorkingCopy)},getMetaData:function($bind){return this.dataset.getMetaData($bind)},triggerAction:function($actionName){var self=this;return $.smResolve().then(function(){if(!self.dataset.isRoot())return!1;var $action=self.dataset.getAction($actionName),$title=$action&&$action.$title;$title=$title||$actionName,$title=self.dataset.resolveExpression($title);var errorControls=self.findErrornousControls();if(errorControls.length>0)return self._showNotification($title,locale.text("action.check.input"),"error"),!1;var resultPromise=$.Deferred();return self._countRequest(sdataReq.triggerAction($actionName,self.dataset,self.isWorkingCopy)).fail(function(response){var diag=response.data&&response.data.$diagnoses?response.data:response.$diagnoses?response:response;diag&&modules.get("modal").error(diag),resultPromise.resolve(!1,response)}).then(function(response){var delta=response.data;return delta?self._mergeDelta(delta).then(function(){return response}):response}).then(function(response){return protocolHelpers.computeActionResult($actionName,response)}).then(function(result){if(result.$diagnoses&&result.$diagnoses.length>0){var diag=result.$diagnoses[0];self._showNotification($title,diag.$message,diag.$severity)}result.success?resultPromise.resolve(!0,result):resultPromise.resolve(!1,result)}),resultPromise.promise()}).always(function(){environment.isAutoUITestMode()&&self._updatePageUpdateCycle()})},triggerLink:function($linkName){var self=this;return $.smResolve().then(function(){var $link=self.dataset.getLink($linkName);if(!$link)return;return $link=protoHelpers.transformOldDashboardUrl($link,self.dataset),self.openLink($link,null,null,$linkName)})},openLink:function($link,pageOptions,loadOptions,$linkName){function _openLink(){var $url=self.dataset.resolveExpression($link.$url,!0);return $url?_isServiceLink($link)?self._executeLink($linkName,$url,$link.$method):($url=protoHelpers.addClientContext($url,self.dataset.root.json.$clientContext),self.gotoUrl($url,$link.$method,pageOptions,loadOptions)):$.smResolve()}var self=this;return $link=protocolHelpers.adjustLinkProtocol($link,this._getUsedProtocol()),$link.$confirm?self._askConfirmation($link.$confirm).then(function(confirmed){if(confirmed==="yes")return _openLink()}):_openLink()},_executeLink:function($linkName,$url,$method){var self=this,$link=self.dataset.getLink($linkName),$title=$link&&$link.$title;$title=self.dataset.resolveExpression($title),$title=$title||$linkName;var resultPromise=$.Deferred();return self._countRequest(sdataReq.executeLink($url,$method,self.dataset)).fail(function(response){if(response&&response.$diagnoses){var diag=response.$diagnoses[0];self._showNotification($title,diag.$message,"error")}resultPromise.resolve(!1,null)}).then(function(response){return response.data?self._mergeDelta(response.data).then(function(){return response}):response}).then(function(response){if(response.data&&response.data.$diagnoses){var diag=response.data.$diagnoses[0];self._showNotification($title,diag.$message,diag.$severity)}resultPromise.resolve(!0,response)}),resultPromise.promise()},triggerDrillLevel:function(level,rowDataset){rowDataset.getLink("$drillDown")?this.drillDownLink(level,rowDataset):rowDataset.getLink("levelUp")&&this.levelUpLink(level,rowDataset)},drillDownLink:function(level,dataset){var rowDataset=dataset||this.dataset,$link=rowDataset.getLink("$drillDown");if(!$link||!$link.$url)return null;var $url=rowDataset.resolveExpression($link.$url);this.gotoUrl($url,null,{isChild:!1,context:{controllerId:this.id},isChartDetail:!0,level:level+1})},levelUpLink:function(level,dataset){var rowDataset=dataset||this.dataset,$link=rowDataset.getLink("levelUp");if(!$link||!$link.$url)return null;var $url=protoHelpers.getHostPort()+rowDataset.resolveExpression($link.$url);this.gotoUrl($url,null,{isChild:!1,context:{controllerId:this.id},isChartDetail:!0,level:level+1})},_updateServer:function($bind,forceUpdateAll){var self=this;return $.smResolve().then(function(){return self.isWorkingCopy?self.isRoot()?forceUpdateAll!==!0&&!self.dataset.isDirty()?$.smResolve():self._countRequest(sdataReq.updateServer(self.dataset,$bind,forceUpdateAll)).then(function(response){if(self.destroyed)return;return self._mergeDelta(response.data)}):$.smResolve():$.smResolve()}).always(function(){environment.isAutoUITestMode()&&self._updatePageUpdateCycle()})},forceUpdateServer:function(){return this._updateServer(null,!0)},_updatePageUpdateCycle:function(){var $$page=$('.s-m-page[data-controller-id="'+this.id+'"]');environment.getUnitTestMgr().setPageUpdateCycle($$page)},_mergeDelta:function(delta){return this.dataset.applyDelta(delta),this.isRoot()&&this.uiAdapter&&this.uiAdapter.notifyScrollerUpdate(),$.smResolve(delta)},getCacheContext:function(){return modules.get("appController").App.getCacheContext()},_countRequest:function(promise){var self=this;return self.pendingRequests=self.pendingRequests+1,self._updateRequestCount(self.pendingRequests),promise.always(function(result){return self.pendingRequests=self.pendingRequests-1,self._updateRequestCount(self.pendingRequests),result})},onDeltaValueChanged:function(dataset,$bind){var ctrls=this._controlsByBind($bind);if(ctrls)for(var ii=0,jj=ctrls.length;ii<jj;ii++){var ctrl=ctrls[ii];ctrl.onValueChanged&&ctrl.onValueChanged()}},onDeltaMetaChanged:function(dataset,$bind){var ctrls=this._controlsByBind($bind);if(ctrls){var setCtrlErrFocus=null;for(var ii=0,jj=ctrls.length;ii<jj;ii++){var ctrl=ctrls[ii];ctrl&&ctrl.onMetaChanged&&ctrl.onMetaChanged()===!0&&setCtrlErrFocus==null&&(setCtrlErrFocus=ctrl)}this.uiAdapter&&this.uiAdapter.notifChildError&&this.uiAdapter.notifChildError(),setCtrlErrFocus&&setCtrlErrFocus.setFocus()}},onDeltaRowAdded:function(dataset,$bind,$uuid,idx){this.uiAdapter&&jsutils.isInstanceOf(this.uiAdapter,"CtrlArray")&&this.uiAdapter.onDeltaRow("added",dataset,$uuid,idx)},onDeltaRowRemoved:function(dataset,$bind,$uuid,idx){this.uiAdapter&&jsutils.isInstanceOf(this.uiAdapter,"CtrlArray")&&this.uiAdapter.onDeltaRow("removed",dataset,$uuid,idx)},onDeltaRowMoved:function(dataset,$bind,$uuid,newIdx){this.uiAdapter&&jsutils.isInstanceOf(this.uiAdapter,"CtrlArray")&&this.uiAdapter.onDeltaRow("moved",dataset,$uuid,newIdx)},onDeltaActionChanged:function(dataset,$action,metaData){this.onMenuItemChanged($action,null,metaData)},onDeltaLinkChanged:function(dataset,$link,$bind,metaData){this.onMenuItemChanged($link,$bind,metaData)},_checkUIAdapterAction:function(actionName,method){var first;this.uiAdapter&&this.uiAdapter.beforeOnSdataActionClicked?first=this.uiAdapter.beforeOnSdataActionClicked(actionName,this):first=$.smResolve(!0,null);var self=this;return first.then(function(goAhead,beforeContext){return goAhead!==!0?!0:method.call(self,actionName).then(function(successOrPage,response){var currentPage,success;return jsutils.isInstanceOf(successOrPage,"PageSdata")?(currentPage=successOrPage,response=null,success=!0):(currentPage=self.uiAdapter,success=successOrPage),currentPage&&currentPage.afterOnSdataActionClicked&&currentPage.afterOnSdataActionClicked(actionName,success,beforeContext,response),success})}).fail(function(result){modules.get("modal").error(result)})},onSdataLinkClicked:function($linkName){return $linkName==="$edit"||_isServiceLink(this.dataset.getLink($linkName))?this._checkUIAdapterAction($linkName,this.triggerLink):this.triggerLink($linkName).fail(function(result){modules.get("modal").error(result)})},onSdataActionClicked:function(actionName){return this._checkUIAdapterAction(actionName,this.triggerAction)},isEditMode:function(){var facet=this.getFacet();return["$edit","$create"].indexOf(facet)>-1?!0:!1},getFacet:function(){return this.dataset.getRoot().prototype.getFacet()},setDataset:function(dataset){this.dataset.removeDeltaChangeListener(this),this.dataset=dataset,this.dataset.addDeltaChangeListener(this)},_getUsedProtocol:function(){var rootDataset=this.root.dataset,$mobileProtocol=rootDataset&&rootDataset.json.$clientContext&&rootDataset.json.$clientContext.$mobileProtocol;return $mobileProtocol},applyDatasetBackup:function(datasetJson){var self=this,dataset=self.dataset,prototype=self.dataset.prototype,$binds=Object.keys(this.controlsByBind);return $binds.forEach(function($bind){if(prototype.isReference($bind)){var val=prototype.propGetRefValueName($bind);self.setValue(val,datasetJson[val],!0,!0)}else prototype.propIsSimple($bind)&&self.setValue($bind,datasetJson[$bind],!0,!0)}),this.root._updateServer()},actChartToolbarSetDisplay:function(opts){var articles=this.getArticlesByBind("$resources");if(this.uiAdapter&&this.uiAdapter.actToolbarSetDisplay)return this.uiAdapter.actToolbarSetDisplay(opts)},getArticlesByBind:function($bind){var chartArticle,arrayChartArticle,controls=this.getControlsByBind($bind);return controls.forEach(function(ctrl){ctrl.isArrayChart()&&(ctrl.isHighChart()?chartArticle=$.extend(!0,{},ctrl.article):arrayChartArticle=$.extend(!0,{},ctrl.article))}),{chartArticle:chartArticle,arrayChartArticle:arrayChartArticle}},getChart:function(){var controls=this.getControlsByBind("$resources"),chart;return controls.forEach(function(ctrl){ctrl.isArrayChart()&&ctrl.isHighChart()&&(chart=ctrl)}),chart},canBePinned:function(){return!this.uiAdapter.pageData.prototype.isApplication()},setActionAdapterArrayOptions:function(arrayOptions,ctrl){this.uiAdapter.actionAdapter.showSortFilter=arrayOptions.showSortFilter,this.uiAdapter.actionAdapter.showSearch=arrayOptions.showSearch,this.uiAdapter.actionAdapter.searchCtrl=ctrl},isStackBarAvailable:function(){var article=this.uiAdapter.getArticle(),stackList=this.getRootStackList();return stackList.length>1&&stackList.length===article.$items.length},getRootStackList:function(){var article=this.uiAdapter.getArticle();if(!article.$items)return[];var stackList=article.$items.filter(function(item){return item.$layoutType==="stack"});return stackList},showNavigationStackBar:function(){return this.isStackBarAvailable()&this.uiAdapter.getArticle().$stackbar}})}),define("syracuse-tablet/html/js/helpers/fieldOperators",["require","exports","module","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var locale=require("syracuse-tablet/html/js/helpers/locale"),_excludedTypes=["application/x-array","image","application/x-document","application/x-binary","application/x-object","text/rtf","text/html","application/x-password"],_numberOperators=["gt","ge","lt","le","eq","ne"],_stringOperators=["like","gt","ge","lt","le","eq","ne","like_s"],_defOperators=["eq","ne"],_DATE={type:"application/x-date",checkFieldValue:function(fieldValue){return String(fieldValue)},checkValue:function(value){return String(value)},operators:_numberOperators,defOperator:"eq"},_TIME={type:"application/x-time",checkFieldValue:function(fieldValue){return fieldValue},checkValue:function(value){return value},operators:_numberOperators,defOperator:"eq"},_DATETIME={type:"application/x-datetime",checkFieldValue:function(fieldValue){return fieldValue},checkValue:function(value){return value},operators:_numberOperators,defOperator:"eq"},_DEC={type:"application/x-decimal",checkFieldValue:function(fieldValue){return fieldValue},checkValue:function(value){return parseFloat(value)},operators:_numberOperators,defOperator:"eq"},_REAL={type:"application/x-real",checkFieldValue:function(fieldValue){return fieldValue},checkValue:function(value){return parseFloat(value)},operators:_numberOperators,defOperator:"eq"},_INT={type:"application/x-integer",checkFieldValue:function(fieldValue){return parseInt(fieldValue,10)},checkValue:function(value){return parseInt(value,10)},operators:_numberOperators,defOperator:"eq"},_QTY={type:"application/x-quantity",checkFieldValue:function(fieldValue){return parseFloat(fieldValue)},checkValue:function(value){return parseFloat(value)},operators:_numberOperators,defOperator:"eq"},_STR={type:"application/x-string",checkFieldValue:function(fieldValue){return String(fieldValue)},checkValue:function(value){return String(value)},operators:_stringOperators,defOperator:"like"},_TEXT={type:"text/plain",checkFieldValue:function(fieldValue){return String(fieldValue)},checkValue:function(value){return String(value)},operators:_stringOperators,defOperator:"like"},_REF={type:"application/x-reference",checkFieldValue:function(fieldValue){return fieldValue&&fieldValue.$value?String(fieldValue.$value).toUpperCase():null},checkValue:function(value){return value?String(value).toUpperCase():null},operators:_stringOperators,defOperator:"like"},_CHOICE={type:"application/x-choice",checkFieldValue:function(fieldValue){return parseInt(fieldValue,10)},checkValue:function(value){return parseInt(value,10)},operators:_numberOperators,defOperator:"eq"},_BOOL={type:"application/x-boolean",checkFieldValue:function(fieldValue){return fieldValue},checkValue:function(value){return value},operators:_defOperators,defOperator:"eq"},_types={};[_DATE,_TIME,_DATETIME,_DEC,_REAL,_INT,_QTY,_STR,_TEXT,_REF,_BOOL,_CHOICE].forEach(function(t){_types[t.type]=t});var _operatorsWithTitle={},_operatorsByType=function($type){var t=_types[$type];return t?t.operators:_defOperators},_getOperators=function($type,withTitle,exclude){var operators;if(withTitle===!0){if(_operatorsWithTitle[$type]==null){var ops=_operatorsByType($type),res=[];ops.forEach(function(op){res.push({title:locale.text("field.operator."+op),value:op})}),_operatorsWithTitle[$type]=res}operators=_operatorsWithTitle[$type]}else operators=_operatorsByType($type);if(exclude&&exclude.length>0){var tmp=operators;operators=[],tmp.forEach(function(o){exclude.indexOf(o)<0&&operators.push(o)})}return operators},_getDefaultOperator=function($type){var t=_types[$type];return t?t.defOperator:"eq"},_evaluateOperator=function($type,fieldValue,operator,value){var fieldType=_types[$type];return fieldType==null?(console.log("_evaluateOperator - Type ["+$type+"] not evaluated"),!1):fieldType.operators.indexOf(operator)<0?!1:(fieldValue=fieldType.checkFieldValue(fieldValue),value=fieldType.checkValue(value),fieldValue==null||value==null?!1:operator==="eq"?fieldValue==value:operator==="ne"?fieldValue!=value:operator==="like"?fieldValue.indexOf?fieldValue.indexOf(value)>=0:!1:operator==="like_s"?fieldValue.smStartsWith?fieldValue.smStartsWith(value):!1:operator==="gt"?fieldValue>value:operator==="ge"?fieldValue>=value:operator==="lt"?fieldValue<value:operator==="le"?fieldValue<=value:!1)};exports.getDefaultOperator=_getDefaultOperator,exports.getOperators=_getOperators,exports.evaluateOperator=_evaluateOperator,exports.acceptOperator=function($type){return _excludedTypes.indexOf($type)<0},exports.checkValue=function($type,value){var fieldType=_types[$type];return fieldType?fieldType.checkValue(value):null}}),define("syracuse-tablet/html/js/controls/array/builderBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/fieldOperators","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),modules=require("syracuse-tablet/html/js/common/modules"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),notifications=require("syracuse-tablet/html/js/helpers/notifications");exports.getHtmlStatus=function(statusInfo,rowDataset){if(!statusInfo||!rowDataset)return;var html=['<div class="s-m-control s-m-row-status">'],h,defIcon=fontUtils.getArrayStatusDefIcon(),icon;return statusInfo.list.some(function(s){if(s.color&&fieldOperators.evaluateOperator(s.$type,rowDataset.getValue(s.field),s.operator,s.value))return icon=s.icon||defIcon,html.push('<div class="'+icon.css+'" style="color:'+s.color.bgColor+'"/>'),!0}),html.push("</div>"),html.join("")};var _isExcluded=["application/x-password"];exports.BuilderBase=utils.defineClass(function builderBase(control){this.control=control,this.$itemProto=this.control.get$ItemProto(),this.article=this.control.article,this.prototype=this.control.prototype,this.controller=this.control.controller},null,{destroy:function(){this.destroyed=!0,this.control=null,this.$itemProto=null,this.article=null,this.controller=null,this.prototype=null,notifications.unsubscribe(this)},isDestroyed:function(){return this.control==null||this.control.destroyed},buildHtml:function(data,$$parent,refresh){},buildOnResize:function(data,$$parent,context){},appendRow:function(recordDataset){throw new Error("Not implemented")},insertError:function(html){$(['<span class="s-m-error">',html,"</span>"].join("")).prependTo(this.control.$$elmt)},checkEmptyArray:function(forceEmpty){return this.control.isEmpty()||forceEmpty===!0?(this.updateGestureMgr(),this.control.setEmptyArrayMsg(),!1):!0},doAfterBuild:function(){this.updateGestureMgr(),this.control.page.isFacet("details","edit","create")&&this.control.page.notifyScrollerUpdate()},updateGestureMgr:function(resizeContext){resizeContext=resizeContext||{};var scrollOnly=resizeContext.scrollOnly,preserveScroll=resizeContext.preserveScroll;this._gestureMgr&&(this.isScrollable()?this._gestureMgr.checkViewRect(this.control.getScrollViewRect(),preserveScroll):this._gestureMgr.reset())},makeVisible:function($$elmt,smoothOffset){this._gestureMgr&&this._gestureMgr.makeVisible($$elmt,smoothOffset)},isScrollable:function(){return!0},isExcluded:function(proto){return proto==null||proto.json.$isExcluded===!0||_isExcluded.indexOf(proto.json.$type)>=0},newScroller:function(type,$$elmt,options){return this.destroyScroller(),options=$.extend(!0,{direction:type,name:this.control.$bind,isPageScroller:!1},options),options.valMax==null&&(options.valMax=0),this._gestureMgr=scroller.newScroller($$elmt,options,modules.get("navStack").getMainStack().getTopPage().getGestureMgr()),this._gestureMgr},destroyScroller:function(){this._gestureMgr&&(this._gestureMgr.destroy(),this._gestureMgr=null)},hasScroller:function(){return this._gestureMgr!=null},savedCtxCreate:function(opts){if(this._gestureMgr==null||opts&&opts.noScroll===!0)return{};var res={$display:this.control.$display,selectedRowUuid:this.getLastSelectedRowId()};return res.gestureMgr=this._gestureMgr?this._gestureMgr.savedCtxCreate(opts):null,res},savedCtxRestore:function(ctx){this.control.$$content.find(".s-m-last-selected").removeClass("s-m-last-selected"),ctx.selectedRowUuid&&this.setLastSelectedRowId(ctx.selectedRowUuid),ctx.gestureMgr!=null&&this.control.$display===ctx.$display&&(this._gestureMgr?this._gestureMgr.savedCtxRestore(ctx.gestureMgr,!0):this._restoreGestureMgr=ctx.gestureMgr)},getLastSelectedRowId:function(){throw new Error("Not implemented")},setLastSelectedRowId:function(selectedRowUuid){throw new Error("Not implemented")},updateRowIndex:function($$parent,index){}})}),define("syracuse-tablet/html/js/common/consts",["require","exports","module"],function(require,exports,module){exports.ROWID_PREFIX="rowid-"}),define("syracuse-tablet/html/js/controls/array/ctrlArrayTableRow",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/controls/array/builderBase","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/common/consts","syracuse-tablet/html/js/sdata/protocolHelpers"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),modules=require("syracuse-tablet/html/js/common/modules"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),builderBase=require("syracuse-tablet/html/js/controls/array/builderBase"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,consts=require("syracuse-tablet/html/js/common/consts"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers");exports.CtrlArrayTableRow=utils.defineClass(function CtrlArrayTableRow(rowDataset,arrayController,article,prototype,options){this._rowController=null,this._createSDataController(rowDataset,arrayController),Base.call(this,arrayController,article,prototype,options)},Base,{_createSDataController:function(rowDataset,arrayController){this._rowController&&this._rowController.destroy(),this._rowController=new SdataController(rowDataset,arrayController),this._rowController.setUIAdapter(this)},destroy:function(){Base.prototype.destroy.call(this),this._rowController&&(this._rowController.destroy(),this._rowController=null),this._columnsInfo=null},createId:function(typeName){return consts.ROWID_PREFIX+this.getUuid()},buildHtml:function(columnsInfo){this._columnsInfo=columnsInfo;var classes=["s-m-record"];this.options.rowIndex!=null&&this.options.rowIndex%2===0&&classes.push("s-m-even"),Base.prototype.buildHtml.call(this,classes),this._buildContents()},_buildContents:function(columnsInfo){this.options.rowLinkDomAttrs?this.$$elmt.attr(this.options.rowLinkDomAttrs):this.options.drillDownDomAttrs&&this.$$elmt.attr(this.options.drillDownDomAttrs),this.$$elmt.attr({"data-controller-id":this._rowController.id});var self=this,ctrlFactory=modules.get("ctrlFactory");this._columnsInfo.forEach(function(col,idx){if(col.isProtoItem){var ctrlCell=ctrlFactory.createControl(self._rowController,col.article,self,self.page,{displayCtx:"table",noEdit:self.options.noEdit});if(ctrlCell){var $$td=$(uiUtils.createDomElement("td",null,null,null,self.$$elmt));ctrlCell.set$$container($$td),ctrlCell.buildHtml()}}else{var text;switch(col.$bind){case"rowStatus":text=builderBase.getHtmlStatus(col.statusInfo,self._rowController.dataset);break;case"rowIndex":text='<div class="s-m-control s-m-row-index"><span class="badge">'+(self.options.rowIndex+1)+"</span></div>";break;case"rowDetail":case"rowDelete":case"rowEdit":text='<div class="s-m-control s-m-icon"><a href="#" data-nevent data-naction="rowAction" data-params="'+col.$bind+'" class="a"><span class="'+fontUtils.tableActionIcon(col.$bind)+'"></span></a></div>'}$("<td>"+(text||col.$bind)+"</td>").appendTo(self.$$elmt)}}),this.page&&this.page.isChild("SdataRowDetail")&&this.notifChildError()},getRootElementTag:function(){return"tr"},_refreshContent:function(){this._createSDataController(this._rowController.dataset,this._rowController.parent),this.$$elmt.empty(),this._buildContents()},_actLookupAccept:function(){this.setRowSelected(!0);var lookup=this.controller.root.lookupData,parentController=this._rowController.findController(lookup.controllerId),value=this._rowController.getValue(lookup.$lookupKeyName);return parentController.setValue(lookup.$bind,value,!0),modules.get("appController").App.goBack()},updateRowIndex:function(index){if(this.options.rowIndex==null||index===this.options.rowIndex)return;this.options.rowIndex!=null&&(this.options.rowIndex=index),this.$$elmt.toggleClass("s-m-even",this.options.rowIndex%2===0),this.parent.builderContent.updateRowIndex(this.$$elmt,index)},onSdataLinkClicked:function($linkName,$linkBind){this.page.multiSelectionIsEnabed()?this.page.multiSelectionController.multiSelToggleRecord(this.$$elmt):(this.setRowSelected(),this._rowController.onSdataLinkClicked($linkName,$linkBind))},notifyRowSaved:function(){return this._refreshContent(),modules.get("appController").App.goBack()},notifChildError:function(){this.$$elmt.toggleClass("error",protoHelpers.hasFieldLevelErrors(this._rowController.dataset.json))},openRowDetail:function(activity){this._rowController.gotoUrl("child://SdataRowDetail",null,{isChild:!0,childContext:{controllerId:this._rowController.id,rowControl:this,activity:activity}})},removeRowDetail:function(){this.parent.removeRow(this)},_actRowAction:function(params){switch(params){case"rowDetail":this.setRowSelected(),this.openRowDetail("detail");break;case"rowEdit":this.setRowSelected(),this.openRowDetail("edit");break;case"rowDelete":this.setRowSelected(!1),this.parent.removeRow(this);break;default:}},_actDrillDown:function(){this._rowController.drillDownLink(this.page.controller.level)},_actLevelUp:function(){this._rowController.levelUpLink(this.page.controller.level)},getUuid:function(){return this._rowController.dataset.getUuid()},setRowSelected:function(select){select=select==null?!0:!1,this.parent.$$content.find(".s-m-last-selected").removeClass("s-m-last-selected");if(select)return this.$$elmt.addClass("s-m-last-selected")},doAfterClickAddRow:function(isSingleArray){if(isSingleArray){if(this.children&&this.children.length>0){var self=this;setTimeout(function(){self.children[0].setFocus()})}}else this.openRowDetail("create")}})}),define("syracuse-tablet/html/js/controls/array/ctrlArrayCardCell",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/controls/articleParser","syracuse-tablet/html/js/common/consts"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,utils=require("syracuse-tablet/html/js/helpers/utils"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,articleParser=require("syracuse-tablet/html/js/controls/articleParser"),consts=require("syracuse-tablet/html/js/common/consts");exports.CtrlArrayCardCell=utils.defineClass(function CtrlArrayCardCell(rowDataset,arrayController,article,prototype,options){this._rootLayout=null,this._cellController=new SdataController(rowDataset,arrayController),this._cellController.setUIAdapter(this),Base.call(this,arrayController,article,prototype,options)},Base,{destroy:function(){Base.prototype.destroy.call(this),this._cellController&&this._cellController.destroy(),this._cellController=null,this._rootLayout&&this._rootLayout.destroy(),this._rootLayout=null},createId:function(typeName){return consts.ROWID_PREFIX+this.getUuid()},buildHtml:function(columnsInfo){Base.prototype.buildHtml.call(this),this.options.rowLinkDomAttrs&&this.$$elmt.attr(this.options.rowLinkDomAttrs),this.$$elmt.attr({"data-controller-id":this._cellController.id});if(!this._rootLayout){this._rootLayout=articleParser.parseArticle(this._cellController,this.options.cardArticle);if(this._rootLayout==null)throw new Error("Bad card article");this._rootLayout.set$$container(this.$$elmt)}this._rootLayout.buildHtml()},getRootElementTag:function(){return"div"},onSdataLinkClicked:function($linkName,$linkBind){this.page.multiSelectionIsEnabed()?this.page.multiSelectionController.multiSelToggleRecord(this.$$elmt.closest("td")):(this.setCellSelected(),this._cellController.onSdataLinkClicked($linkName,$linkBind))},getUuid:function(){return this._cellController.dataset.json.$uuid},setCellSelected:function(select){select=select==null?!0:!1,this.parent.$$content.find(".s-m-last-selected").removeClass("s-m-last-selected");if(select)return this.$$elmt.closest("td").addClass("s-m-last-selected")}})}),define("syracuse-tablet/html/js/controls/array/paginators",["require","exports","module","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),ArrayPaginatorBase=utils.defineClass(function ArrayPaginatorBase(arrayCtrl){this.arrayCtrl=arrayCtrl,this.pagingLinks=["$first","$previous","$next","$last"]},null,{getNumPages:function(){throw new Error("Not implemented")},getNumRowsPage:function(){throw new Error("Not implemented")},getRowByIndex:function(idx){throw new Error("Not implemented")},paginate:function(direction){throw new Error("Not implemented")},destroy:function(){},isEnabled:function(direction){return!1},_getDatasetNumRows:function(){return this.arrayCtrl.arrayController.dataset.getNumRows()}});exports.ArrayPaginatorServer=utils.defineClass(function ArrayPaginatorServer(arrayCtrl){ArrayPaginatorBase.call(this,arrayCtrl)},ArrayPaginatorBase,{getNumPages:function(){return-1},getNumRowsPage:function(){return this._getDatasetNumRows()},getRowByIndex:function(index){return this.arrayCtrl.arrayController.dataset.getRowByIndex(index)},paginate:function(direction){if(!this.isEnabled(direction))return;var $links=this._getLinks(),$link=$links[direction];if(!$link)return;this.arrayCtrl.notifyPaginationServer($link)},isEnabled:function(direction){var $links=this._getLinks();return($links&&$links[direction])!=null},_getLinks:function(){var pageDataset=this.arrayCtrl.arrayController.dataset.root,$links=pageDataset.getLinks();return $links}}),exports.ArrayPaginatorClient=utils.defineClass(function ArrayPaginatorServer(arrayCtrl,pageSize){ArrayPaginatorBase.call(this,arrayCtrl),this.pageSize=pageSize,this.indexShift=0},ArrayPaginatorBase,{getNumPages:function(){return Math.ceil(this._getDatasetNumRows()/this.pageSize)},getNumRowsPage:function(){var countTotal=this._getDatasetNumRows();return Math.min(countTotal-this.indexShift,this.pageSize)},getRowByIndex:function(index){return this.arrayCtrl.arrayController.dataset.getRowByIndex(index+this.indexShift)},paginate:function(direction){if(!this.isEnabled(direction))return;switch(direction){case"$first":this.indexShift=0;break;case"$previous":this.indexShift=this.indexShift-this.pageSize;break;case"$next":this.indexShift=this.indexShift+this.pageSize;break;case"$last":this.indexShift=this._getDatasetNumRows()-this.pageSize}this.indexShift=Math.max(0,Math.min(this.indexShift,this._getDatasetNumRows()-1)),this.arrayCtrl.notifyPaginationLocal()},isEnabled:function(direction){switch(direction){case"$first":case"$previous":return this.indexShift>0;case"$next":case"$last":return this.indexShift+this.pageSize<this._getDatasetNumRows()}}})}),define("syracuse-tablet/html/js/controls/array/builderHeader",["require","exports","module","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),_html={header:'<header> 			<nav class="s-m-stdheader"> 				{{#if showPagination}} 				<nav class="s-m-pagin"> 					<ul class="pagination"> 						<li> 							<a class="s-m-link glyphicon glyphicon-step-backward disabled" href="#" 								data-nevent 								data-naction="pagination" 								data-params="$first" 								draggable="false"> 							</a> 						</li> 						<li> 							<a class="s-m-link glyphicon glyphicon-chevron-left disabled" href="#" 								data-nevent 								data-naction="pagination" 								data-params="$previous" 								draggable="false"> 							</a> 						</li> 						<li> 							<a class="s-m-link glyphicon glyphicon-chevron-right disabled" href="#" 								data-nevent 								data-naction="pagination" 								data-params="$next" 								draggable="false "> 							</a> 						</li> 						<li> 							<a class="s-m-link glyphicon glyphicon-step-forward disabled" href="#" 								data-nevent 								data-naction="pagination" 								data-params="$last" 								draggable="false"> 							</a> 						</li> 					</ul> 				</nav> 				{{/if}} 				{{#if showSearch}} 					<nav class="s-m-search"/>				{{/if}} 				{{#if showSortFilter}} 					{{#if hasHeader}}						<div class="s-m-filterSort" data-nevent data-naction="actionArray" data-params="panelfiltersort">							<i class="s-m-sorted" style="display:none"></i>							<i class="s-m-filtered fa fa-filter" style="display:none"></i>							<i class="fa fa-bars"></i>						</div>					{{/if}}				{{/if}}				{{#if showFiltersList}}					<nav class="s-m-filterslist"/>				{{/if}}			</nav> 			{{#if showFiltersTabs}}				<nav class="s-m-filtertabs"/>			{{/if}}		</header>'},_templates={},_getHtml=function(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx||{})};exports.BuilderHeader=utils.defineClass(function builderHeader(control,headerOpts){this.control=control,this.options=headerOpts,this.options.showFiltersList=this.options.$filtersAuthoring==="list",this.options.showFiltersTabs=this.options.showFiltersList!==!0&&this.options.$filtersAuthoring==="tabs",this.options.showFiltersTabs==1&&this.control.page.isVignette()&&(this.options.showFiltersList=!0,this.options.showFiltersTabs=!1),this.options.hasHeader=this.control.page.isVignette()},null,{destroy:function(){this.control=null,this.$$elmt&&this.$$elmt.remove(),this.$$elmt=null},buildHtml:function(arrayData,refresh){var showSearch=this.options.showSearch&&(arrayData.length>0||this.control.filterSearch.hasSearchCriteria());if(refresh==1&&this.$$elmt){this.update(showSearch);return}this.$$elmt&&this.$$elmt.remove(),this.options.showFiltersList||this.options.showFiltersTabs||showSearch||this.options.showSortFilter||this.options.showPagination?(this.$$elmt=$(_getHtml("header",this.options)),showSearch&&$("nav.s-m-search",this.$$elmt).append(this.control.filterSearch.getHtml()),this.options.showFiltersList?$("nav.s-m-filterslist",this.$$elmt).append(this.control.filterX3.getHtml("list")):this.options.showFiltersTabs&&$("nav.s-m-filtertabs",this.$$elmt).append(this.control.filterX3.getHtml("tabs"))):this.$$elmt=$("<header/>"),this.control.$$content.before(this.$$elmt),this.update(showSearch)},update:function(showSearch){$("nav.s-m-search",this.$$elmt).toggle(showSearch),this.control.filterSort&&this.control.filterSort.arrayHeaderUpdate(this.$$elmt);if(this.control.paginator){var self=this,nbEnabled=0;this.control.paginator.pagingLinks.forEach(function(link){var $$link=$('[data-naction="pagination"][data-params="'+link+'"]',self.$$elmt),ena=self.control.paginator.isEnabled(link);ena&&nbEnabled++,$($$link.parent()).add($$link).toggleClass("disabled",!ena)}),this.$$elmt.find(".s-m-pagin").toggle(nbEnabled>0)}},disable:function(yes){yes=yes===!0,this.$$elmt.css("opacity",yes?.5:"inherit"),yes?this.$$elmt.click(function(evt){evt.preventDefault(),evt.stopPropagation()}):this.$$elmt.off()}})}),define("syracuse-tablet/html/js/sdata/sdatawhere/operator",["require","exports","module","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var helpers=require("syracuse-tablet/html/js/helpers/utils");exports.Operator=function(code,text,precedence,isPrefix,isInfix,isAssociative,isPredicate){var self=this;self.code=code,self.text=text,self.precedence=precedence,self.isPrefix=isPrefix,self.isInfix=isInfix,self.isAssociative=isAssociative,self.isPredicate=isPredicate},helpers.defineClass(exports.Operator,null,{toString:function(){return this.text}}),exports.operators=new function(){function createOp(code,text,precedence,isPrefix,isInfix,isAssociative,isPredicate){var op=new exports.Operator(code||text,text,precedence,isPrefix,isInfix,isAssociative,isPredicate);self.operators[op.text]=op}function init(){createOp(null,".",1,!1,!0,!0,!1),createOp(null,"not",2,!0,!1,!1,!1),createOp("*","mul",3,!1,!0,!0,!1),createOp("/","div",3,!1,!0,!0,!1),createOp("%","mod",3,!1,!0,!0,!1),createOp(null,"+",4,!1,!0,!0,!1),createOp(null,"-",4,!0,!0,!0,!1),createOp("=","eq",5,!1,!0,!1,!0),createOp("<>","ne",5,!1,!0,!1,!0),createOp("<","lt",5,!1,!0,!1,!0),createOp("<=","le",5,!1,!0,!1,!0),createOp(">","gt",5,!1,!0,!1,!0),createOp(">=","ge",5,!1,!0,!1,!0),createOp(null,"between",5,!1,!0,!1,!0),createOp(null,"in",5,!1,!0,!1,!0),createOp(null,"like",5,!1,!0,!1,!0),createOp(null,"and",6,!1,!0,!0,!0),createOp(null,"or",7,!1,!0,!0,!0),createOp(null,"(",8,!0,!1,!1,!1),createOp(null,")",8,!1,!1,!1,!1),createOp(null,",",8,!1,!1,!1,!1)}var self=this;return self.operators={},init(),self}}),define("syracuse-tablet/html/js/sdata/sdatawhere/token",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/sdatawhere/operator"],function(require,exports,module){var helpers=require("syracuse-tablet/html/js/helpers/utils"),operators=require("syracuse-tablet/html/js/sdata/sdatawhere/operator");exports.tokenType={identifier:"identifier",operator:"operator",literal:"literal"},exports.Token=function(type,line,offset,length,val){var self=this;self.type=type,self.value=val;var _line=line,_offset=offset,_length=length;self.getRemainingText=function(){return _line.substring(_offset,_line.length)}},helpers.defineClass(exports.Token,null,{matches:function(code){return this.value instanceof operators.Operator&&this.value.code==code}})}),define("syracuse-tablet/html/js/sdata/sdatawhere/tokenizer",["require","exports","module","syracuse-tablet/html/js/sdata/sdatawhere/token","syracuse-tablet/html/js/sdata/sdatawhere/operator"],function(require,exports,module){var token=require("syracuse-tablet/html/js/sdata/sdatawhere/token"),operators=require("syracuse-tablet/html/js/sdata/sdatawhere/operator");exports.Tokenizer=new function(){function _skipSpaces(chars,i){while(i<chars.length&&chars[i]===" ")i++;return i}function _isDigit(str){return(new RegExp("[0-9]")).test(str)}function _isLetter(str){return(new RegExp("[$a-zA-Z%']")).test(str)}function _isWordChar(str){return(new RegExp("[$a-zA-Z0-9_%']")).test(str)}function _parseNumber(line,chars,i,tokens){var end=i+1;while(end<chars.length&&_isDigit(chars[end]))end++;var val;if(end<chars.length&&chars[end]==="."){end++;while(end<chars.length&&_isDigit(chars[end]))end++;val=parseFloat(line.substring(i,end))}else val=parseInt(line.substring(i,end),10);return tokens.push(new token.Token(token.tokenType.literal,line,i,end-i,val)),end}function _parseWord(line,chars,i,tokens){var end=i+1;while(end<chars.length&&_isWordChar(chars[end]))end++;var word=chars.substr(i,end-i),op=operators.operators.operators[word.toLowerCase()];if(op!=null)tokens.push(new token.Token(token.tokenType.operator,line,i,end-i,op));else{var lit;(lit=_literals[word])!==undefined?tokens.push(new token.Token(token.tokenType.literal,line,i,end-i,lit)):tokens.push(new token.Token(token.tokenType.identifier,line,i,end-i,word))}return end}function _parseQuotedString(line,chars,i,tokens){var quote=chars[i],end=i+1,dest=0,res="";while(end<chars.length){if(chars[end]===quote){end++;if(end===chars.length||chars[end]!==quote)return tokens.push(new token.Token(token.tokenType.literal,line,i,end-i,res)),end}res+=chars[end++]}throw new Error("quoted string not terminated: "+line.substring(i))}function _parseOperator(line,ch,i,tokens){var op=operators.operators.operators[ch];return tokens.push(new token.Token(token.tokenType.operator,line,i,1,op)),i+1}function _parseDateTime(line,chars,i,tokens){var end=i+1,len=chars.length;while(end<len){if(chars[end]=="@")break;end++}if(end===chars.length)throw new Error("Where parser: date constant not terminated:"+line.substring(i,line.length));var str=chars.substr(i+1,end-i-1),dt=new Date(str);if(dt!=null){var nt=new token.Token(token.tokenType.literal,line,i,end+1-i,dt);nt.dataType="datetime",nt.svalue=str,tokens.push(nt)}return end+1}var self=this,_literals={"true":!0,"false":!1,"null":null};return self.tokenize=function(line){var tokens=[],i=0;while(i<line.length){i=_skipSpaces(line,i);var ch=line[i];switch(ch){case"@":i=_parseDateTime(line,line,i,tokens);break;case'"':case"'":i=_parseQuotedString(line,line,i,tokens);break;case".":case"-":case"+":case"(":case")":case",":i=_parseOperator(line,ch,i,tokens);break;default:if(_isLetter(ch))i=_parseWord(line,line,i,tokens);else{if(!_isDigit(ch))throw new Error("invalid character: "+line.substring(i));i=_parseNumber(line,line,i,tokens)}}}return tokens},self}}),define("syracuse-tablet/html/js/sdata/sdatawhere/expression",["require","exports","module","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var helpers=require("syracuse-tablet/html/js/helpers/utils");exports.Expression=function(config){var self=this;self.children=null,config.operator?(self.type="operator",self.value=config.operator,self.children=[],config.expression1&&self.children.push(config.expression1),config.expression2&&self.children.push(config.expression2)):config.expressionType&&(self.type=config.expressionType,self.value=config.value,self.svalue=config.svalue,self.dataType=config.dataType,self.type==="function"&&(self.children=[]))},helpers.defineClass(exports.Expression,null,{isPredicate:function(){switch(this.type){case"operator":return this.value.isPredicate;case"identifier":return!0;case"function":return!0;case"literal":return!1;default:throw new Error("invalid expression type: "+this.type)}},toString:function(){if(this.children==null)return this.value.toString();var sb=[];sb.push("["+this.value.toString());for(var i=0;i<this.children.length;i++)sb.push(" "+this.children[i].toString());return sb.push("]"),sb.join("")}})}),define("syracuse-tablet/html/js/sdata/sdatawhere/parser",["require","exports","module","syracuse-tablet/html/js/sdata/sdatawhere/token","syracuse-tablet/html/js/sdata/sdatawhere/operator","syracuse-tablet/html/js/sdata/sdatawhere/tokenizer","syracuse-tablet/html/js/sdata/sdatawhere/expression"],function(require,exports,module){var token=require("syracuse-tablet/html/js/sdata/sdatawhere/token"),operators=require("syracuse-tablet/html/js/sdata/sdatawhere/operator"),tokenizer=require("syracuse-tablet/html/js/sdata/sdatawhere/tokenizer"),expression=require("syracuse-tablet/html/js/sdata/sdatawhere/expression");exports.Parser=new function(){function _finishBetween(tokens,tokenIndex,exp,precedence){if(tokenIndex[0]==tokens.length||!tokens[tokenIndex[0]].matches("and"))throw new Error("invalid expression: expected 'and' after "+tokens[tokenIndex[0]-1].getRemainingText());tokenIndex[0]++;var arg=_parseExpression(tokens,tokenIndex,precedence);exp.children.push(arg)}function _parseExpression(tokens,tokenIndex,precedence){var exp=_parseTerm(tokens,tokenIndex);while(tokenIndex[0]<tokens.length){var tk=tokens[tokenIndex[0]],op=tk.value instanceof operators.Operator?tk.value:null;if(op==null||!op.isInfix||op.precedence>precedence)break;tokenIndex[0]++;if(op.code=="in"){if(tokenIndex[0]===tokens.length||!tokens[tokenIndex[0]].matches("("))throw new Error("invalid expression: '(' expected after "+tk.getRemainingText());tokenIndex[0]++,exp=new expression.Expression({operator:op,expression1:exp}),_parseArguments(tokens,tk,tokenIndex,exp.children)}else{var arg=_parseExpression(tokens,tokenIndex,op.precedence-1);exp=new expression.Expression({operator:op,expression1:exp,expression2:arg}),op.code=="between"&&_finishBetween(tokens,tokenIndex,exp,op.precedence)}if(!op.isAssociative&&op.precedence==precedence)return exp}return exp}function _parseTerm(tokens,tokenIndex){if(tokenIndex[0]==tokens.length)throw new Error("premature end of expression");var tk=tokens[tokenIndex[0]];switch(tk.type){case token.tokenType.identifier:return tokenIndex[0]++,tokenIndex[0]<tokens.length&&tokens[tokenIndex[0]].matches("(")?_parseFunctionCall(tokens,tk,tokenIndex):new expression.Expression({expressionType:"identifier",value:tk.value});case token.tokenType.literal:return tokenIndex[0]++,new expression.Expression({expressionType:"literal",value:tk.value,svalue:tk.svalue,dataType:tk.dataType});case token.tokenType.operator:var op=tk.value;if(!op.isPrefix)throw new Error("invalid expression: expected beginning of term at "+tk.getRemainingText());return tokenIndex[0]++,_parsePrefixOperator(tokens,op,tokenIndex);default:throw new Error("internal error: bad token type "+tk.type)}}function _parseArguments(tokens,tk,tokenIndex,arguments0){if(tokenIndex[0]<tokens.length&&tokens[tokenIndex[0]].matches(")")){tokenIndex[0]++;return}while(tokenIndex[0]<tokens.length){var arg=_parseExpression(tokens,tokenIndex,_maxPrecedence);arguments0.push(arg);if(tokenIndex[0]<tokens.length&&tokens[tokenIndex[0]].matches(")")){tokenIndex[0]++;return}if(tokenIndex[0]==tokens.length||!tokens[tokenIndex[0]].matches(","))throw new Error("invalid expression: expected ',' or ')' at "+tokens[tokenIndex[0]].getRemainingText());tokenIndex[0]++}throw new Error("invalid function call syntax: argument missing after "+tk.getRemainingText())}function _parsePrefixOperator(tokens,op,tokenIndex){var arg1;switch(op.code){case"-":case"not":return arg1=_parseExpression(tokens,tokenIndex,1),new expression.Expression({operator:op,expression1:arg1});case"(":arg1=_parseExpression(tokens,tokenIndex,op.precedence);if(tokenIndex[0]==tokens.length||!tokens[tokenIndex[0]].matches(")"))throw new Error("invalid expression: expected ')' after "+tokens[tokenIndex[0]-1].getRemainingText());return tokenIndex[0]++,arg1;default:throw new Error("internal error: bad prefix operator "+op.code)}}function _parseFunctionCall(tokens,tk,tokenIndex){tokenIndex[0]++;var exp=new expression.Expression({expressionType:"function",value:tk.value});return _parseArguments(tokens,tk,tokenIndex,exp.children),exp}var self=this,_maxPrecedence=8;return self.parse=function(str){if(str==null||str.length==0)return null;var tokens=tokenizer.Tokenizer.tokenize(str),tokenIndex=[];tokenIndex[0]=0;var exp=_parseExpression(tokens,tokenIndex,_maxPrecedence);if(tokenIndex[0]!=tokens.length)throw new Error("invalid expression: unexpected token at "+tokens[tokenIndex[0]].getRemainingText());return exp},self}}),define("syracuse-tablet/html/js/controls/array/filterHelper",["require","exports","module","syracuse-tablet/html/js/sdata/sdatawhere/parser","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){function _setFilterRightValue(filter){var cp=filter.prop,cv,value=(filter.originalValue||filter.value)==null?"":filter.originalValue||filter.value;switch(cp.$type){case"application/x-password":case"application/x-string":return cv=value.replace(/'/g,"\\'"),filter.operator==="like"?cv="%"+cv+"%":filter.operator==="like_s"&&(cv+="%"),cv="'"+cv+"'",cv;case"application/x-integer":case"application/x-real":case"application/x-decimal":case"application/x-quantity":return value;case"application/x-date":if(!value)return null;return"@"+value+"@";case"application/x-datetime":return"@"+value+"@";case"application/x-time":return null;case"application/x-boolean":return value?"true":"false";case"application/x-choice":return cp.$value&&cp.$value.$type==="application/x-string"?"'"+value.replace(/'/g,"\\'")+"'":value+"";case"application/x-reference":return typeof value!="string"&&(value=filter.value),cv=(value||"").replace(/'/g,"\\'"),filter.operator==="like"?cv="%"+cv+"%":filter.operator==="like_s"&&(cv+="%"),cv="'"+cv+"'",cv;default:}return null}var parser=require("syracuse-tablet/html/js/sdata/sdatawhere/parser").Parser,jsutils=require("syracuse-tablet/html/js/helpers/jsutils");exports.getFilterWhereClause=function(filterInfo){var filterClause="";return filterInfo!=null&&filterInfo.length!=0&&$.each(filterInfo,function(idx,filter){var cf="("+filter.id+" "+(filter.operator==="like_s"?"like":filter.operator)+" "+_setFilterRightValue(filter)+")";filterClause=filterClause.length==0?cf:filterClause+" and "+cf}),filterClause},exports.getSearchClause=function(searchInfo){if(!searchInfo)return null;var searchClause="";return Object.keys(searchInfo).forEach(function(key){var search=searchInfo[key],cf="("+search.id+" "+search.operator+" "+_setFilterRightValue(search)+")";searchClause=searchClause.length==0?cf:searchClause+" or "+cf}),searchClause&&(searchClause="("+searchClause+")"),searchClause},exports.filterSortUpdateUrl=function(opt){var options=opt||{},sdataUrl=jsutils.parseURL(options.$url);options.$filters&&(sdataUrl.query||(sdataUrl.query={}),sdataUrl.query.filter=options.$filters.id);var sortClause=null;options.sortInfo!=null&&options.sortInfo.length!=0&&options.sortInfo.some(function(i){if(i.sort!="none")return sortClause={order:i.sort,field:i.id},!0});var filterMsg=!1,filterClause=exports.getFilterWhereClause(options.filterInfos),searchClause=exports.getSearchClause(options.searchInfo);searchClause&&!exports.isValidWhere(searchClause)&&(searchClause=null,filterMsg=!0);if(!sortClause&&!filterClause&&!searchClause)return jsutils.urlToString(sdataUrl);if(sortClause&&sdataUrl.query.key==null){var old=sdataUrl.query.orderBy;sdataUrl.query.orderBy=sortClause.field+" "+sortClause.order,old&&(sdataUrl.query.orderBy=", "+old)}if(filterClause&&sdataUrl.query.key==null){var old=sdataUrl.query.where;sdataUrl.query.where=filterClause,old&&(sdataUrl.query.where=old+" and "+sdataUrl.query.where)}if(searchClause&&sdataUrl.query.key==null){var old=sdataUrl.query.where;sdataUrl.query.where=searchClause,old&&(sdataUrl.query.where=old+" and "+sdataUrl.query.where)}return jsutils.urlToString(sdataUrl)},exports.isValidWhere=function(where){try{return parser.parse(where),!0}catch(e){return!1}}}),define("syracuse-tablet/html/js/controls/array/searchArray",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/fieldOperators","syracuse-tablet/html/js/controls/array/filterHelper"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),locale=require("syracuse-tablet/html/js/helpers/locale"),fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),filterHelper=require("syracuse-tablet/html/js/controls/array/filterHelper"),_templates={basicSearch:'		{{#unless arrayHeader}}		<nav class="s-m-search">		{{/unless}}            <div class="input-group stylish-input-group">                <input type="text" class="form-control"  placeholder="Search"  value="{{searchValue}}">                <span class="input-group-addon">                    <span style="visibility:{{visibleRemove}}" class="glyphicon glyphicon-remove" data-nevent data-naction="actionArray" data-params="removeSearch"></span>					{{#if arrayHeader}}						<span class="glyphicon glyphicon-search" data-nevent data-naction="actionArray" data-params="search"></span>					{{/if}}                </span>            </div>       {{#unless arrayHeader}}		</nav>		{{/unless}}		'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)},_exclude=["application/x-boolean"];exports.SearchArray=utils.defineClass(function searchArray(control){this.control=control,this.maxCrit=7,this.searchInfos=this.control.controller.uiAdapter.getPageSearch(),this.hasSearchCriteria()?this.searchValue=this.searchInfos[0].value:(this.searchValue="",this.searchInfos=null)},null,{destroy:function(){this.control=null,this.searchValue=null,this.searchInfos=null,this.$$search&&(this.$$search.off("input"),this.$$search=null)},getHtml:function(){return this.$$search=$(_getHtml("basicSearch",{searchValue:this.searchValue,visibleRemove:this.searchValue!==""?"visible":"hidden",arrayHeader:this.control.page.isVignette()})),this.$$search},toggleRemoveSearch:function(value){$("[data-params='removeSearch']",this.$$search).css("visibility",value?"visible":"hidden")},removeSearch:function(){return this.searchValue!==""&&(this.searchValue="",this.searchInfos=[],this._updateSdataUrl(this.control)),$(":input",this.$$search).val(""),this.toggleRemoveSearch(),!1},hasSearchCriteria:function(){return!$.isEmptyObject(this.searchInfos)&&this.searchInfos["0"]!=null},search:function(){if(this.isDirty()){var $$value=$(":input",this.$$search);this.searchValue=$$value.val(),this.searchInfos=this.searchValue.length>0?this._filterInfosGet(this.control):[],this._updateSdataUrl(this.control)}},isDirty:function(){var $$value=$(":input",this.$$search);return this.searchValue!=$$value.val()},_updateSdataUrl:function(){var $url=filterHelper.filterSortUpdateUrl(this.control.getFilterSortOptions());this.control.page.setPageSearch(this.searchInfos),this.control.notifyApplyFilter($url)},_filterInfosGet:function(){var columnInfo=this.control.getColumnsInfo(!0),proto=this.control.prototype.getProto$Item(),props=proto.data("$properties"),control,$bind,$type,$capabilities,self=this,formatter,criteria=[],errors,val,$isReference;return columnInfo.forEach(function(column){$bind=column.$bindValue,$type=column.$type,$isReference=column.$type.indexOf("x-reference")>=0,$capabilities=column.$capabilities||"";if($capabilities.indexOf("filter")>=0&&criteria.length<self.maxCrit&&_exclude.indexOf($type)<0&&self._hackFormat(props[$bind]))if($type!=="application/x-choice")errors=[],val=null,formatter=formatApi.getFormatter($type,props[$bind].$format),formatter?(val=formatter.parseValue(self.searchValue,errors),formatter.validateValue&&formatter.validateValue(self.searchValue,errors)):val=self.searchValue,$isReference&&val&&(val=val.toUpperCase()),errors.length===0&&val!==undefined&&criteria.push({operator:fieldOperators.getDefaultOperator($type),id:$bind,value:val,prop:props[$bind],isReference:$isReference});else{var valueList=self._getChoiceTitles(column.$value,proto);valueList.forEach(function(val){val.title.indexOf(self.searchValue)>-1&&criteria.length<self.maxCrit&&criteria.push({operator:fieldOperators.getDefaultOperator($type),id:$bind,value:val.$value,prop:props[$bind],isReference:$isReference})})}}),criteria},_getChoiceTitles:function($value,proto){var res=[],self=this;return $.each($value.$enum,function(index,choice){res.push({$value:choice.$value,title:proto.resolveExpression(choice.$title)})}),res},_hackFormat:function(proto){var searchable=!0;switch(proto.$type){case"application/x-integer":var gs=locale.getNumberGroupSeparator(),ds=locale.getNumberDecimalSeparator();searchable=!isNaN(gs&&gs.length>0?this.searchValue.replace(new RegExp("\\"+gs+"|\\s","g"),""):this.searchValue),searchable=searchable&&(ds&&ds.length>0?this.searchValue.indexOf(ds)<0:!0);break;case"application/x-decimal":case"application/x-real":case"application/x-integer":case"application/x-quantity":searchable=!isNaN(this.searchValue.replace(new RegExp("\\.|,|\\s","g"),""));break;default:searchable=proto.$maxLength?this.searchValue.length<=proto.$maxLength:!0}return searchable},tableHeadUpdate:function($$tabHead){$$tabHead.find(".s-m-search").removeClass("s-m-search");if(!this.hasSearchCriteria())return;var self=this;Object.keys(this.searchInfos).forEach(function(key){$$tabHead.find("."+self.searchInfos[key].id).addClass("s-m-search ")})}})}),define("syracuse-tablet/html/js/controls/array/filtersSort",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/controls/array/filterHelper","syracuse-tablet/html/js/helpers/fieldOperators"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),filterHelper=require("syracuse-tablet/html/js/controls/array/filterHelper"),fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),_sortFilterExclude=["application/x-array","image","application/x-document","application/x-binary","application/x-object","text/rtf","text/html","text/plain"],_templates={filtersList:'			<select	class="form-control" data-nevent-ctrl-change data-naction="actionArray">			{{#each filters}}				<option value="filterSelected,{{id}}" {{#if $isDefault}}selected=""{{/if}}>{{$title}}</option>			{{/each}}		   </select>',filtersTabs:'				<ul class="nav nav-pills nav-justified">					{{#each filters}}						<li role="presentation" role="tab" data-toggle="tab" data-nevent data-naction="actionArray" data-params="filterSelected,{{id}}" class="{{#if $isDefault}}active{{/if}}"><a href="#">{{$title}}</a></li>					{{/each}}				</ul>',sortedHeader:'<div><span>{{title}}</span><i class="{{css}}"></i></div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.Filters=utils.defineClass(function filters(arrayCtrl){this.control=arrayCtrl,this.currentFilterId=null,this._$filters=[],this._protoFilters=null,this._initFilters()},null,{destroy:function(){this.control=null,this._$filters=null},getHtml:function($auth){return($auth=="list"||$auth=="tabs")&&this._$filters&&this._$filters.length>0?$(_getHtml($auth=="list"?"filtersList":"filtersTabs",{filters:this._$filters})):null},_getUrlFilterId:function(){var $url=this.control.controller.uiAdapter.pageData.$url;return $url?($url=jsutils.parseURL($url),$url.query?$url.query.filter:null):null},_initFilters:function(){this._protoFilters=$.extend(!0,{},this.control.prototype.data("$filters",null,!1,!0)),$.isEmptyObject(this._protoFilters)&&(this._protoFilters=null);if(this._protoFilters==null)return;var defFilter=null,currentFilterId=this._getUrlFilterId();for(var p in this._protoFilters){var f=$.extend(!0,{},this._protoFilters[p]),ttl=this.control.prototype.resolveExpression(f.$title);if(ttl==null||ttl.trim().length==0)continue;f.$title=ttl,f.id=p,f.$isDefault=!1,currentFilterId&&f.id===currentFilterId?defFilter=f:!defFilter&&f.$isDefault===!0&&(defFilter=f),this._$filters.push(f)}if(this._$filters.length==0)return;this._$filters.unshift({id:"nofilter",$title:locale.text("nofilter"),$isDefault:defFilter==null}),defFilter&&(defFilter.$isDefault=!0)},get$filterToApply:function(){if(this._$filters.length===0||this.control.$filtersGetAuthoring()=="none")return null;var f=null;return this._$filters.some(function(x){if(x.$isDefault===!0)return f=x,!0}),f==null||f.id=="nofilter"?null:f},filtersSelect:function(param){if(this._$filtersSelect(param)){var $url=filterHelper.filterSortUpdateUrl(this.control.getFilterSortOptions());this.control.notifyApplyFilter($url)}},_$filtersSelect:function(filterId){return this._$filters.length==0?!1:(this._$filters.forEach(function(f){f.$isDefault=!1,filterId===f.id&&(f.$isDefault=!0)}),!0)},hasFilters:function(){return this._protoFilters!=null}}),exports.FilterSort=utils.defineClass(function filterSort(arrayCtrl){this.control=arrayCtrl},null,{destroy:function(){this.control=null},getHtml:function(id){},arrayHeaderUpdate:function($$container){if(!$$container)return;var info=this._headerGetInfo(),$$icon=$$container.find(".s-m-sorted").toggle(info.sortOrder!=null).removeClass();$$icon.toggle(info.sortOrder!==null),info.sortOrder!=null&&$$icon.addClass("s-m-sorted "+fontUtils.sortIcon(info.sortOrder)),$$container.find(".s-m-filtered").toggle(info.hasFilter===!0)},filterInfoGet:function(){var info=this.control.page.getPageFilter();return info},filterMapGet:function(){var self=this,map=[],props=this.control.getColumnsInfo();return props&&props.forEach(function(prop){if(_sortFilterExclude.indexOf(prop.$type)===-1&&prop.$capabilities&&prop.$capabilities.indexOf("filter")>=0&&!prop.$isExcluded){var field={fieldName:prop.$title,operators:fieldOperators.getOperators(prop.$type),id:prop.$bindValue,prop:prop,isReference:prop.$type.indexOf("x-reference")>=0};map.push(field)}}),map},sortInfoGet:function(){var self=this,info=this.control.page.getPageSort();if(info==null||info.length===0){var cols=this.control.getColumnsInfo();cols&&(info=[],cols.forEach(function(c){_sortFilterExclude.indexOf(c.$type)===-1&&c.$capabilities&&c.$capabilities.indexOf("sort")>=0&&info.push({name:c.$title,id:c.$bindValue,sort:"none"})})),this.sortInfoSet(info,!1)}return info},sortInfoSet:function(info,refresh){this.control.page.setPageSort(info);if(refresh){var $url=filterHelper.filterSortUpdateUrl(this.control.getFilterSortOptions());this.control.notifyApplyFilter($url)}},filterInfoSet:function(info,refresh){this.control.page.setPageFilter(info);if(refresh){var $url=filterHelper.filterSortUpdateUrl(this.control.getFilterSortOptions());this.control.notifyApplyFilter($url)}},tableHeadUpdate:function($$tabHead){if(!$$tabHead)return;var info=this._headerGetInfo();if(!info.sortOrder||!info.sortField)return;var $$th=$$tabHead.find(".s-m-sorted");if($$th.length>1){var text=$$th.find("div > span")[0].text();$$th.removeClass()}$$th=$$tabHead.find("."+info.sortField);if($$th.length>0){var title=$$th.text();$$th.html(_getHtml("sortedHeader",{title:title,css:fontUtils.sortIcon(info.sortOrder)})),$$th.addClass("s-m-sorted "+info.sortOrder)}},_headerGetInfo:function(){var res={sortOrder:null,sortField:null,hasFilter:!1},info=this.sortInfoGet();info&&info.some(function(i){if(i.sort!="none")return res.sortOrder=i.sort,res.sortField=i.id,!0});var info=this.filterInfoGet();return res.hasFilter=info&&info.length>0,res}})}),define("syracuse-tablet/html/js/controls/array/builderTable",["require","exports","module","syracuse-tablet/html/js/controls/array/builderBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/array/builderBase").BuilderBase,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),environment=require("syracuse-tablet/html/js/helpers/environment"),settings=require("syracuse-tablet/html/js/app/settings"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_isExcluded=["application/json","application/x-array","application/x-document","application/x-binary"],_fixedSzInfo={},_getFixedSizeInfo=function($$table){var dev=settings.getDeviceType(),r=_fixedSzInfo[dev];if(r)return r;var $$body=$("<tbody></body>").appendTo($$table),$$tr=$('<tr class="s-m-record"><td><div class="s-m-control s-m-field" style="width:100%"><div class="s-m-value" style="width:100%" ><span style="width:100%" id="text">MMMMMMMMMM</span></div></div></td><td class="s-m-icon"><div class="s-m-control s-m-icon"><a href="#" class="a"><span class="fa fa-hand-o-right"></span></a></div></td></tr>');$$tr.appendTo($$body);var tdWidth=$$tr.find("td").outerWidth(),valWidth=$$tr.find(".s-m-value").outerWidth(),textWidth=$$tr.find("#toto").width();return r={cellPadding:tdWidth-valWidth,charWidth:Math.ceil($$tr.find("#text").width()/10),iconWidth:$$tr.find("td.s-m-icon").outerWidth()},$$body.remove(),_fixedSzInfo[dev]=r,r},_additionalCols=[{isProtoItem:!1,$activity:"edit",$bind:"rowEdit",$widthType:"auto",css:["s-m-icon"]},{isProtoItem:!1,$activity:"edit",$bind:"rowDelete",$capabilities:"delete",$widthType:"auto",css:["s-m-icon"]},{isProtoItem:!1,$activity:"read",$bind:"rowDetail",$widthType:"auto",css:["s-m-icon"]}];exports.BuilderTable=utils.defineClass(function builderTable(control){Base.call(this,control),this._nbAdditionalCols=0,this._tableColumnInfo=null},Base,{destroy:function(){Base.prototype.destroy.call(this),this._$$body=null},buildHtml:function(data,$$parent,refresh){Base.prototype.buildHtml.call(this,data,$$parent,refresh),this._createTableColumnInfo(),this._tableColumnInfo&&this._tableColumnInfo.length===0&&$$parent.addClass("empty"),refresh===!0&&this.buildOnResize(data,$$parent,{refresh:!0})},buildOnResize:function(data,$$parent,context){if(this.destroyed)return;var forceEmpty=this._tableColumnInfo==null||this._tableColumnInfo.length===0;if(!this.checkEmptyArray(forceEmpty)&&!this.control.controller.isEditMode())return;this._buildTable(data,$$parent,context)},_buildTable:function(data,$$parent,context){$$parent.empty();var scrollMax=0,$$table=$(uiUtils.createDomElement("table",["table","table-condensed"],null,{"data-controller-id":this.control.arrayController.id},$$parent));this._calulateWidths($$parent,$$table,data);var $$headerScroll=this._buildTableHead($$table);if(data.length===0&&!this.control.controller.isEditMode()){this.doAfterBuild();return}if($$headerScroll!=null&&this.isScrollable()){$$table=$('<table class="table table-condensed"/>').appendTo($$parent),$$headerScroll.css({fontSize:"0px",visibility:"hidden"}).appendTo($$table);if(this.$$tabHead&&this.$$tabHead.length>0&&$$headerScroll!=this.$$tabHead){var top=-1*$$headerScroll.height()/this.control.getTransformScale();$$table.css("top",top+"px"),this.$$tabHead.css("z-index",5e5),environment.isNativeScrolling()||(scrollMax=top)}}this._$$body=$(uiUtils.createDomElement("tbody",null,null,null,$$table));for(var i=0;i<data.length;i++)this._buildTableRow(data[i],i);this._buildTableFooter($$table),this.isScrollable()&&this.newScroller("v",$$table.addClass("s-m-scroll-elmt").wrap('<div class="s-m-scroll-wrapper"/>'),{nopadding:!0,valMax:scrollMax}),this.doAfterBuild()},_buildTableFooter:function($$table){var nbCols=this._tableColumnInfo.length;if(nbCols>0&&this.control.controller.isEditMode()&&this.control.prototype.hasCapability("append")){var $$footer=$('<tfoot><tr><td colspan="'+nbCols+'"><div style= "text-align:center;" class="s-m-control s-m-icon"><a href="#" data-nevent data-naction="addRow" data-params="" class="a"><span class="'+fontUtils.tableActionIcon("rowAdd")+'"></span></a></div></td></tr></tfoot>');$$footer.appendTo($$table)}},_buildTableHead:function($$table){this.$$tabHead=$(uiUtils.createDomElement("thead",null,null,null));var tr=uiUtils.createDomElement("tr",null,null,null,this.$$tabHead);this._tableColumnInfo.forEach(function(col){var th=uiUtils.createDomElement("th",col.cssHeader||col.css,col.title||"",null,tr);col.fixedWidth!=null&&col.fixedWidth>0&&$(th).width(col.fixedWidth)});var showHeader=this.control.getAuthoring("$tableHeaderShow")!==!1;if(showHeader!=1||this.control.isSingleArray())return this.$$tabHead.appendTo($$table),this.$$tabHead.css("visibility","hidden"),null;var $$headerScroll=this.$$tabHead.clone();return this.$$tabHead.appendTo($$table),this.control.filterSort&&this.control.filterSort.tableHeadUpdate(this.$$tabHead),this.control.filterSearch&&this.control.filterSearch.tableHeadUpdate(this.$$tabHead),$$headerScroll},_buildTableRow:function(recordDataset,index){var rowCtrl=this.control.createRecordCtrl(this._$$body,recordDataset,index);return rowCtrl&&(rowCtrl.buildHtml(this._tableColumnInfo),environment.isAutoUITestMode()&&environment.getUnitTestMgr().arrayAddRowIndex(rowCtrl.$$elmt,index)),rowCtrl},appendRow:function(rowDataset){var index=this.control.arrayController.dataset.getRowIndex(rowDataset.json.$uuid);return this._buildTableRow(rowDataset,index)},_calulateWidths:function($$parent,$$table,data){var size=_getFixedSizeInfo($$table),maxWidth=$$parent.width()-this._nbAdditionalCols*size.iconWidth,fixedWidth=0,width;this._tableColumnInfo.forEach(function(i){var art=i.article;i.fixedWidth=0,art&&art.$widthType==="fixed"&&art.$widthVal>0&&(width=size.charWidth*art.$widthVal+size.cellPadding,width>0&&fixedWidth+width<maxWidth&&(i.fixedWidth=width,fixedWidth+=width))});var remainingWidth=maxWidth-fixedWidth,percentWidth=0;this._tableColumnInfo.forEach(function(i){var art=i.article;art&&art.$widthType==="percent"&&art.$widthVal>0&&(width=art.$widthVal*remainingWidth/100+size.cellPadding,width>0&&percentWidth+width<remainingWidth&&(i.fixedWidth=width,percentWidth+=width))})},isExcluded:function(item,proto){return Base.prototype.isExcluded.call(this,proto)?!0:_isExcluded.indexOf(proto.json.$type)>=0||item.$isAdvanced===!0},_createTableColumnInfo:function(){if(this._tableColumnInfo)return this._tableColumnInfo;this._nbAdditionalCols=0,this._tableColumnInfo=[];var nonDataCol=0;this.article.$arrayOptions.rowIndex===!0&&(this._tableColumnInfo.push({isProtoItem:!1,$bind:"rowIndex",cssHeader:"s-m-rowidx"}),nonDataCol++);var statusInfo=this.control.getRowStatusInfo();statusInfo!=null&&(this._tableColumnInfo.push({isProtoItem:!1,$bind:"rowStatus",statusInfo:statusInfo,cssHeader:"s-m-row-status"}),nonDataCol++);var unfound=[],items=this.article.$table,protoColumns=this.control.getColumnsInfo(!0);items||(items=protoColumns);var self=this,dataProps=this.controller.dataset.getValueByPath("$properties");items.forEach(function(item,idx){if(item.$isHidden||dataProps&&dataProps[item.$bind]&&dataProps[item.$bind].$isHidden==1)return;item.$widthType=item.$widthType?item.$widthType:"auto",item.$widthVal=parseInt(item.$widthType==="auto"?0:item.$widthVal,10),item.$imgHeight=item.$imgHeight||"small",isNaN(item.$widthVal)&&(item.$widthVal=0);var proto=self.$itemProto.propGetProto(item.$bind);if(!proto)unfound.push(item);else if(!self.isExcluded(item,proto)){var col={$bind:item.$bind,proto:proto,article:item};col.css=[self.$itemProto.getFieldValueName(item.$bind)],col.article.$isTitleHidden===!0?col.title="":col.article.$title!=null&&col.article.$title!=item.$bind&&(col.article.$titleOrig==null||col.article.$titleOrig.indexOf("{@")>=0)?col.title=self.$itemProto.resolveExpression(col.article.$titleOrig||col.article.$title)||"":col.title=col.proto.data("$title")||"",col.isProtoItem=!0,self._tableColumnInfo.push(col)}});var overflow=this._tableColumnInfo.length-nonDataCol!=protoColumns.length;this.article.$arrayOptions.showRowDetailLink===!1&&(overflow=!1);var editMode=this.controller.isEditMode();_additionalCols.forEach(function(col){if(editMode&&self.control.isSingleArray()&&col.$bind==="rowEdit")return;if(editMode&&col.$activity==="edit"||!editMode&&overflow&&col.$activity==="read")if(col.$capabilities==null||self.prototype.hasCapability(col.$capabilities)){var c=$.extend(!0,{},col);c.$widthType="auto",self._tableColumnInfo.push(c),self._nbAdditionalCols++}});if(unfound.length>0&&jsutils.isDvlpVersion("showUnfoundFields")){var html=["Field(s) not found<ul>"];unfound.forEach(function(x){html.push("<li><b>"+x.$bind+"</b></li>")}),html.push("</ul>"),this.insertError(html.join(""))}return this._tableColumnInfo},isScrollable:function(){return this.control.isArrayChart()||!this.control.isArrayField()&&!this.control.page.isNestedInDashboard("stack")},getLastSelectedRowId:function(){return this.control.$$content.find(".s-m-last-selected").attr("id")},setLastSelectedRowId:function(selectedRowUuid){this.control.$$content.find("#"+selectedRowUuid).addClass("s-m-last-selected")},updateRowIndex:function($$parent,index){$$parent.find(".s-m-control.s-m-row-index > .badge").text(index)}})}),define("syracuse-tablet/html/js/ui/modals/modalDialogScroll",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),_templateAll={header:'		<buttons class="pull-left"> 			<button type="button" class="btn btn-default fa fa-arrow-left" data-action="$cancel"></button> 		</buttons> 		{{#if buttonValidate }}			<buttons class="pull-right"> 				<button type="button" class="btn btn-default fa fa-check " data-action="$validate"></button> 			</buttons> 		{{/if}}		<div class="modal-title">{{title}}</div> 		',headerContent:"{{{headerContent}}}",content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">				<div class="form-group s-m-scroll-element"> 					{{{content}}}				</div> 			</div>',footer:"{{{footer}}}"};exports.ModalDialogScroll=utils.defineClass(function ModalDialogScroll(appList){var self=this;modalDialog.ModalBase.call(self)},modalDialog.ModalBase,{_getTemplates:function(){return{std:_templateAll}},getDisplayFlags:function(opts){var self=this,displayFlags=self.displayFlags||{};return displayFlags.modalClass=opts[self.deviceType],displayFlags},_getDataContext:function(){return{label_validate:locale.text("welcome.select.app.add"),label_cancel:locale.text("welcome.select.app.cancel")}}})}),define("syracuse-tablet/html/js/ui/modals/modalSettings",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialogScroll","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/native/native"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_templateAll[name])),tmpl(ctx)}function _getCache(){return modules.get("cache").getCache()}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalDialogScroll").ModalDialogScroll,modules=require("syracuse-tablet/html/js/common/modules"),native=require("syracuse-tablet/html/js/helpers/native/native"),_cacheOptions={"1week":{days:7},"2week":{days:14},month:{days:30},all:{days:null}},_templateAll={content:' 		<header>{{label_device}}</header> 		<div class="btn-group btn-group-justified" data-toggle="buttons" id="s-m-radio-type-id"> 			<div class="btn-group"> 				<label class="btn btn-primary" data-action="clickType" data-params="auto"> 					<input type="radio" name="s-m-radio-type">{{label_auto}} 				</label> 			</div> 			<div class="btn-group"> 				<label class="btn btn-primary" data-action="clickType" data-params="smartphone"> 					<input type="radio" name="s-m-radio-type">{{label_smartphone}} 				</label> 			</div> 			<div class="btn-group"> 				<label class="btn btn-primary" data-action="clickType" data-params="tablet"> 					<input type="radio" name="s-m-radio-type">{{label_tablet}} 				</label> 			</div> 		</div> 		{{#if showConfigServers}} 			<header>{{label_servers}}</header> 			<div class="btn-group btn-group-justified"> 				<div class="btn-group"> 					<label class="btn btn-primary" data-action="selectServer" data-params="">{{label_switch_server}}</label> 				</div> 			</div> 		{{/if}} 		<header id="s-m-cache-id">{{label_cache}}</header> 		<span id="s-m-cache-explain">{{label_cache_clear}} 		<div id="s-m-cache-btns-id" class="btn-group btn-group-justified"> 			<label id="s-m-cache-clear-all-id" class="btn btn-primary s-m-cache-btn" data-action="clearCache" data-params="clear,all">{{label_cache_all}}<div></div></label> 			<label id="s-m-cache-clear-1week-id" class="btn btn-primary s-m-cache-btn" data-action="clearCache" data-params="clear,1week">{{label_cache_week1}}<div></div></label> 			<label id="s-m-cache-clear-2week-id" class="btn btn-primary s-m-cache-btn" data-action="clearCache" data-params="clear,2week">{{label_cache_week2}}<div></div></label> 			<label id="s-m-cache-clear-month-id" class="btn btn-primary s-m-cache-btn" data-action="clearCache" data-params="clear,month">{{label_cache_month}}<div></div></label> 		</div> 		<div style="display:table-row;"> 		<label id="s-m-cache-confirm-id" class="btn btn-primary s-m-confirm" data-action="clearCache" data-params="confirm,all" style="display: none;">{{label_cache_confirm}}</label> 		<label id="s-m-cache-cancel-id" class="btn btn-warning s-m-cancel" data-action="clearCache" data-params="cancel" style="display: none;">{{label_cancel}}</label> 		</div> 		<div id="s-m-cache-progress-id" class="progress" style="display: none;"> 			<div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%">{{label_clearing}}</div> 		</div> 		<div id="s-m-cache-ok-id" class="alert alert-success" role="alert" style="display: none">{{label_clearing_ok}}</div> 		<div style="width:100%; display: inline-block;"></div>'},_templates={},_Klass=utils.defineClass(function ModalSettings(settings){var self=this;Base.call(self),self.settings=settings&&$.extend(!0,{},settings)||{},self.settings["device-type"]=self.settings["device-type"]||"auto",self.result=null},Base,{getDisplayFlags:function(){var opts={tablet:"settings full",smartphone:"settings full"};return Base.prototype.getDisplayFlags.call(this,opts)},_getDataContext:function(){var self=this,data={label_device:locale.text("settings.device.label"),label_auto:locale.text("settings.device.auto"),label_smartphone:locale.text("settings.device.smartphone"),label_tablet:locale.text("settings.device.tablet"),label_cache:locale.text("settings.cache.label"),label_cache_clear:locale.text("settings.cache.clear"),label_cache_week1:locale.text("settings.cache.week1"),label_cache_week2:locale.text("settings.cache.week2"),label_cache_month:locale.text("settings.cache.month"),label_cache_all:locale.text("settings.cache.all"),label_cache_confirm:locale.text("settings.cache.confirm"),label_clearing:locale.text("settings.cache.clearing"),label_clearing_ok:locale.text("settings.cache.clearing_ok"),label_apps:locale.text("settings.apps.label"),label_apps_update:locale.text("settings.apps.update"),label_apps_confirm:locale.text("settings.apps.confirm"),label_apps_wait:locale.text("settings.apps.wait"),label_apps_ok:locale.text("settings.apps.ok"),label_cancel:""};native.hasCapability("nativeApp")&&(data.showConfigServers=!0,data.label_servers=locale.text("settings.servers.servers"),data.label_switch_server=locale.text("settings.servers.switch"));var ctx=Base.prototype._getDataContext(this),content=_getHtml("content",data),extendedCtx=$.extend(!0,ctx,{buttonValidate:!0,title:locale.text("settings.title"),content:content});return extendedCtx},_onShow:function(){var self=this;Base.prototype._onShow.call(self),$("label[data-params='"+self.settings["device-type"]+"']",self.$$elmt).eq(0).button("toggle"),self._computeCacheSize()},_onValidate:function(){var self=this,$$active=$("#s-m-radio-type-id .active ",this.$$elmt),deviceType=$$active.length<1?"auto":$$active.attr("data-params")||"auto";self.settings["device-type"]=deviceType,self.result=self.settings},_onCancel:function(){this.result=null},_onAction:function(action,param){var self=this;switch(action){case"clickType":$("label[data-params='"+param+"']",self.$$elmt).eq(0).button("toggle");break;case"clearCache":self._clearCache(param);break;case"selectServer":return native.hasCapability("nativeApp")&&native.getModule("nativeApp").selectServer(),!0}return!1},_clearCache:function(param){var self=this,p=param.split(","),action=p[0],data=p[1];self._setButtons("clearCache","cache",action,data);if(action==="confirm"){var dt=self._getDateBefore(_cacheOptions[data].days);return _getCache().clearCache({$not_read_since:dt}).always(function(){self._setButtons("clearCache","cache","ok",""),self._computeCacheSize()})}},_setButtons:function(action,prefix,state,data){var self=this;switch(state){case"confirm":$("#s-m-"+prefix+"-progress-id",self.$$elmt).show(),$("#s-m-"+prefix+"-confirm-id",self.$$elmt).hide(),$("#s-m-"+prefix+"-cancel-id",self.$$elmt).hide();break;case"cancel":$("#s-m-"+prefix+"-btns-id",self.$$elmt).show(),$("#s-m-"+prefix+"-confirm-id",self.$$elmt).hide(),$("#s-m-"+prefix+"-cancel-id",self.$$elmt).hide();break;case"clear":$("#s-m-"+prefix+"-confirm-id",self.$$elmt).show(),$("#s-m-"+prefix+"-cancel-id",self.$$elmt).show(),$("#s-m-"+prefix+"-btns-id",self.$$elmt).hide(),$("#s-m-"+prefix+"-confirm-id",self.$$elmt).attr("data-params","confirm,"+(data||""));break;case"ok":$("#s-m-"+prefix+"-progress-id",self.$$elmt).hide(),$("#s-m-"+prefix+"-ok-id",self.$$elmt).show(),setTimeout(function(){$("#s-m-"+prefix+"-ok-id",self.$$elmt).hide(),$("#s-m-"+prefix+"-btns-id",self.$$elmt).show()},3e3)}},_getDateBefore:function(days){if(!days)return"9999-99-99-00-00-00";var today=new Date,dt=new Date(today);return dt.setDate(today.getDate()-days),dt=dt.toJSON().slice(0,10)+"-00-00-00",dt},_computeCacheSize:function(){var self=this;Object.keys(_cacheOptions).forEach(function(co){var dt=self._getDateBefore(_cacheOptions[co].days);return _getCache().computeCacheSize({$not_read_since:dt}).always(function(result){self._updateCacheSize(co,result)})})},_updateCacheSize:function(key,result){var self=this,$$div=$("#s-m-cache-clear-"+key+"-id > div",self.$$elmt),units=[locale.text("global.units.kilobytes"),locale.text("global.units.megabytes")];$$div.empty();if(result&&result.$data){var size=result.$data.sizeRecords,sizeUnit=locale.text("global.units.bytes");while(size>=1024&&units.length>0)size=(size+1023)/1024,sizeUnit=units.shift();var sizeText=Math.round(size)+" "+sizeUnit;$$div.append($("<span>"+result.$data.numRecords+" "+locale.text("global.units.files")+"</span><span>"+sizeText+"</span>"))}},_getResult:function(){return this.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalSelectContext",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialogScroll"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_templateAll[name])),tmpl(ctx)}var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalDialogScroll").ModalDialogScroll,_templateAll={content:' 		{{#if label_warning}}			<div class="alert alert-warning" role="alert">				{{label_warning}}			</div>		{{/if}}		{{#if label_offline}}			<div class="alert alert-warning" role="alert">				{{label_offline}}			</div>		{{/if}}		{{#if showRoles}} 		<div class="form-group"> 			<label>{{label_roles}}</label>			<select class="form-control" id="login-select-role"> 			{{#each roles}}				<option value="{{this.code}}" {{#if this.selected}}selected{{/if}}>				{{this.description}}				</option>			{{/each}}			</select>		</div> 		{{/if}} 		<div class="form-group" id="login-select-endpoint-group"> 			<label>{{label_endpoints}}</label>			<select class="form-control" id="login-select-endpoint"> 			{{#each endpoints}}				<option value="{{this.code}}" {{#if this.selected}}selected{{/if}}>				{{this.description}}				</option>			{{/each}}			</select>		</div> 		{{#if showLanguages}} 		<div class="form-group"> 			<label>{{label_languages}}</label>			<select class="form-control" id="login-select-language"> 			{{#each languages}}				<option value="{{this.code}}" {{#if this.selected}}selected{{/if}}>				{{this.description}}				</option>			{{/each}}			</select>		</div> 		{{/if}}',endpoints:'		{{#each endpoints}}				<option value="{{code}}" {{#if selected}}selected{{/if}}>{{description}}{{#unless description}}{{code}}{{/unless}}</option>		{{/each}}'},_templates={},_Klass=utils.defineClass(function ModalSelectContext(currentContext,settings){Base.call(this),this._currentContext=currentContext,this._settings=settings},Base,{destroy:function(){this._$$roles&&(this._$$roles.off(),this._$$roles=null),this._$$endpoints&&(this._$$endpoints=null),Base.prototype.destroy.call(this)},getDisplayFlags:function(){var opts={tablet:"select-context full",smartphone:"select-context full"};return Base.prototype.getDisplayFlags.call(this,opts)},_getDataContext:function(){var self=this,roles=self._getRoles(),languages=self._getLanguages(),endpoints=self._getEndpoints(roles),showRoles=self._settings.offline!==!0&&roles.length>1,showLanguages=self._settings.offline!==!0&&languages.length>1,label_warning=locale.text("modal.context.warning"),label_offline=locale.text("modal.context.offline2");self._settings.offline===!0?label_warning=null:label_offline=null;var data={label_endpoints:locale.text("modal.context.endpoints"),endpoints:endpoints,label_roles:locale.text("modal.context.roles"),showRoles:showRoles,roles:roles,label_languages:locale.text("modal.context.languages"),showLanguages:showLanguages,languages:languages,label_ok:locale.text("modal.context.ok"),label_cancel:locale.text("modal.context.cancel"),label_warning:label_warning,label_offline:label_offline},ctx=Base.prototype._getDataContext(this),content=_getHtml("content",data),extendedCtx=$.extend(!0,ctx,{buttonValidate:!0,title:locale.text("modal.context.title"),content:content});return extendedCtx},_getRoles:function(){var self=this,roles=self._settings&&self._settings.profile.roles||[];return roles.forEach(function(r){r.selected=r.code===self._currentContext.role}),roles},_getLanguages:function(){var self=this,languages=self._settings&&self._settings.profile.locales||[];return languages.forEach(function(lang){lang.selected=lang.code===self._currentContext.lang}),languages},_getEndpoints:function(role){var self=this,endpoints;return self._getRoles().some(function(r){if(role&&r.code===role||role==null&&r.selected===!0)return endpoints=r.endPoints,!0}),endpoints=endpoints||[],endpoints.forEach(function(ep){ep.selected=ep.code===self._currentContext.endpoint}),endpoints},_attachDOM:function(){Base.prototype._attachDOM.call(this),this._$$roles=this.$$elmt.find("#login-select-role"),this._$$roles.length>0&&this._$$roles.on("change",jsutils.bindFn(this.onRoleChanged,this)),this._$$endpoints=this.$$elmt.find("#login-select-endpoint"),this._$$endpointsGroup=$("#login-select-endpoint-group"),this.onRoleChanged()},onRoleChanged:function(){var role=this._$$roles.val(),endpoints=this._getEndpoints(role);this._$$endpoints.html(_getHtml("endpoints",{endpoints:endpoints})),endpoints.length>1?this._$$endpointsGroup.show():this._$$endpointsGroup.hide()},_onValidate:function(){var endpoint=this._$$endpoints.val(),role=this._$$roles.val(),language=this.$$elmt.find("#login-select-language").val();this.result={action:"ok",endpoint:endpoint,role:role,language:language}},_onCancel:function(){this.result={action:"cancel"}},_getResult:function(){return this.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalShowLegal",["require","exports","module","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialogScroll","syracuse-tablet/html/js/helpers/types/date","syracuse-tablet/html/js/common/ajax"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_templateAll[name])),tmpl(ctx)}var globals=require("syracuse-tablet/html/js/app/globals"),utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalDialogScroll").ModalDialogScroll,date=require("syracuse-tablet/html/js/helpers/types/date"),ajax=require("syracuse-tablet/html/js/common/ajax"),_templateAll={headerContent:' 		<div class="s-m-header-brand"> 			<h2 class="s-m-brand">{{label_brand}} {{label_product}}</h2> 		</div> 		',content:' 				<div class="form-group"> 					<h3 class="s-m-product-update-label">{{label_update}}</h3>					<label class="s-m-product-update-value">{{update}}</label> 				</div> 				<div class="form-group"> 					<h3>{{label_legal}}</h3> 					<label>{{text1}}</label> 					<label>{{text2}}</label> 					<label>{{text3}}</label> 					<label>{{text4}}</label> 					<label>{{text5}}</label> 					<label>{{text6}}</label> 				</div> 				{{#if licenses}} 				<div class="form-group"> 					<h3>{{label_license}}</h3> 					{{#each licenses}} 						<div class="s-m-field"><div class="s-m-title">{{../label_registrationNumber}}</div><div class="s-m-value">{{toRegNum}}</div></div> 						<div class="s-m-field"><div class="s-m-title">{{../label_licensedTo}}</div><div class="s-m-value">{{toName}}</div></div> 						<div class="s-m-field"><div class="s-m-title">{{../label_reference}}</div><div class="s-m-value">{{toRefNum}}</div></div> 						<div class="s-m-field"><div class="s-m-title">{{../label_installedBy}}</div><div class="s-m-value">{{installedBy}}</div></div> 						<div class="s-m-field"><div class="s-m-title">{{../label_expiryDate}}</div><div class="s-m-value">{{expiryDate}}</div></div> 					{{/each}} 				</div> 				{{/if}} 				{{#if userAgentBuilddate}} 					<div class="form-group"> 					{{#if userAgent}}						<h3>{{label_user_agent}}</h3> 						<div class="form-group"> 							<label>{{userAgent}}</label> 						</div> 					{{/if}} 					{{#if builddate}} 						<div class="form-group"> 							<label>{{builddate}}</label> 						</div> 					{{/if}} 					</div>				{{/if}}'},_templates={},_Klass=utils.defineClass(function ModalShowLegal(){var self=this;Base.call(self)},Base,{getDisplayFlags:function(){var opts={tablet:"show-legal full",smartphone:"show-legal full"};return Base.prototype.getDisplayFlags.call(this,opts)},_getDataContext:function(){var self=this;return ajax.request("/sdata/syracuse/collaboration/syracuse/licenses/$service/current").then(function(result){var data=result.data,version=null,licenses=[];if(data&&data.length>0)return data.forEach(function(lic){var l={};l.expiryDate=locale.text("modal.legal.license.expiryDateValue",[date.getLocalShortDate(lic.validFrom),date.getLocalShortDate(lic.expiryDate)]),l.toName=lic.licensedTo.name,l.toRegNum=lic.licensedTo.registrationNumber,l.toRefNum=lic.licensedTo.reference,l.installedBy=lic.reseller.name,licenses.push(l),version||(version=lic.productVersion)}),{version:version,licenses:licenses}}).then(function(licData){var labels=locale.getProductLabels(),showBuildDate=window.location.href.indexOf("SHOW_VERSION_NUMBER")>-1,builddate=showBuildDate&&locale.text("modal.legal.builddate",[globals.getBuildTimeStamp()]),userAgent=jsutils.isDvlpVersion()?navigator.userAgent:"",pageInfo,data={label_update:locale.text("modal.legal.update"),label_license:locale.text("modal.legal.about.license"),label_legal:locale.text("modal.legal.about.legal"),label_user_agent:locale.text("modal.legal.about.user_agent"),update:licData&&licData.version||"?",licenses:licData&&licData.licenses,builddate:builddate,text1:locale.text("modal.legal.text1"),text2:locale.text("modal.legal.text2"),text3:locale.text("modal.legal.text3"),text4:locale.text("modal.legal.text4"),text5:locale.text("modal.legal.text5"),text6:locale.text("modal.legal.text6"),label_registrationNumber:locale.text("modal.legal.license.registrationNumber"),label_licensedTo:locale.text("modal.legal.license.licensedTo"),label_reference:locale.text("modal.legal.license.reference"),label_userLicense:locale.text("modal.legal.license.userLicense"),label_installedBy:locale.text("modal.legal.license.installedBy"),label_server:locale.text("modal.legal.license.server"),label_expiryDate:locale.text("modal.legal.license.expiryDate"),userAgent:userAgent,userAgentBuilddate:userAgent+builddate},ctx=Base.prototype._getDataContext(this),content=_getHtml("content",data),headerContent=_getHtml("headerContent",{label_brand:labels.brand,label_product:labels.product}),extendedCtx=$.extend(!0,ctx,{title:locale.text("modal.legal.title"),headerContent:headerContent,content:content});return extendedCtx})},_onValidate:function(){},_onCancel:function(){},_getResult:function(){}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/pages/attachedControlsMgr",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules");exports.AttachedControlsMgr=utils.defineClass(function AttachedControlsMgr(page){this.page=page,this.controls=[]},null,{destroyControls:function(){this.controls.forEach(function(control){control.control.destroy()}),this.controls=[]},destroy:function(){this.destroyControls(),this.page=null},createControl:function(info,options,hidden){var self=this;if(self.findByName(info.name)!=null)throw new Error("There can only be one control for a unique name");var ctrlFactory=modules.get("ctrlFactory"),ctrl=ctrlFactory.createControl(self.page.controller,{$type:info.$type},null,null,options);if(ctrl){ctrl.attachedControlsMgr=self,ctrl.attachedControlInfo=info,ctrl.setActionAdapter&&ctrl.setActionAdapter(self.page.actionAdapter);var c=$.extend(!0,{},info,{control:ctrl,isVisible:hidden!==!0});self.controls.push(c)}return ctrl},createAddtionalControl:function(panelInfo,options){var ctrl=this.createControl(panelInfo,{},!0);return this.ensureControl$$container(ctrl,panelInfo),ctrl.buildHtml(),ctrl},ensureControl$$container:function(control,attachedControlInfo){var page;this.page.isVignette()&&attachedControlInfo.vignetteSelectorUseParent?page=this.page.parentPage:page=this.page;var $$container=page.$$elmt.find(attachedControlInfo.selector).first();(!$$container||$$container.length<1)&&console.log("Container for control not found: "+attachedControlInfo.selector),control.set$$container($$container),control.page=page},findByName:function(name){var entry=this._findEntryByName(name);return entry&&entry.control},_findEntryByName:function(name){var entry=null;return this.controls.some(function(control){if(name===control.name)return entry=control,!0}),entry},_findEntryByControl:function(ctrl){var entry=null;return this.controls.some(function(control){if(ctrl===control.control)return entry=control,!0}),entry},buildHtml:function(){var self=this;self.controls.forEach(function(control){self.ensureControl$$container(control.control,control.control.attachedControlInfo),control.control.buildHtml()})},computeLayout:function(context){this.controls.forEach(function(control){control.control.computeLayout&&control.control.computeLayout(context)})},computeMainLayout:function(layoutInfo){var self=this,mainLayout={contentTop:0,contentLeft:0,contentHeight:layoutInfo.application.height,contentWidth:layoutInfo.application.width},tops=[],bottoms=[],bottomsHeight=0;self.controls.forEach(function(control){if(control.isVisible!==!0)return;control.topIndex!=null&&(tops[control.topIndex]=control),control.bottomIndex!=null&&(bottoms[control.bottomIndex]=control,bottomsHeight+=control.control.getDesiredHeight())});var top=0,heightSubstract=0;return tops.forEach(function(control){if(control==null)return;var height=control.control.getDesiredHeight();control.control.setTop(top),heightSubstract+=height,top+=height}),mainLayout.contentTop=top,top=mainLayout.contentHeight-bottomsHeight,bottoms.forEach(function(control){if(control==null)return;var height=control.control.getDesiredHeight();control.control.setTop(top),heightSubstract+=height,top+=height}),mainLayout.contentHeight-=heightSubstract,mainLayout},toggleControls:function(name1,name2,show){var wasVisible=this.isVisible(name1);show=show==null?!wasVisible:show;if(wasVisible&&show||!wasVisible&&!show)return;var self=this,ctrls=[{name:name1,show:show},{name:name2,show:!show}];return ctrls.forEach(function(i){var entry=self._findEntryByName(i.name);if(!entry)return;entry.control.$$elmt.toggle(i.show),entry.isVisible=i.show,i.show&&entry.control.computeLayout()}),show},isVisible:function(nameOrCtrl){if(!nameOrCtrl)return!1;var entry;return typeof nameOrCtrl=="string"?entry=this._findEntryByName(nameOrCtrl):entry=this._findEntryByControl(nameOrCtrl),entry&&entry.isVisible===!0}})}),define("syracuse-tablet/html/js/pages/pageBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controllers/controller","syracuse-tablet/html/js/pages/attachedControlsMgr","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Controller=require("syracuse-tablet/html/js/controllers/controller").Controller,AttachedControlsMgr=require("syracuse-tablet/html/js/pages/attachedControlsMgr").AttachedControlsMgr,settings=require("syracuse-tablet/html/js/app/settings"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),uiRect=require("syracuse-tablet/html/js/ui/rect"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),_id=1,_templates={},_html={fullpage:'		<section class="s-m-page s-m-full {{device}}" id="{{pageId}}" style="display: none" data-page-name="{{pageName}}"> 			<header></header> 			<section class="s-m-topToolbar"  style="display:none"></section> 			<section class="s-m-main-content" data-s-m-content=""></section> 			<footer style="display:none"></footer> 		</section> 	',vignette:'<section class= "s-m-page s-m-nested" id="{{pageId}}" style="display: none;" data-page-name="{{pageName}}"></section>',panelContainers:'		<div class="s-m-side-panel-dismiss" data-nevent data-naction="closePanel"></div> 		<aside class="s-m-panel s-m-left"></aside> 		<aside class="s-m-panel s-m-freeleft"></aside> 		<aside class="s-m-panel s-m-freeright"></aside> 		<aside class="s-m-panel s-m-right"></aside>'},_getHtml=function(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx||{})},_pages={};exports.Page=utils.defineClass(function PageBase(pageName,options){options=options||{},options.nativeCapabilities=options.nativeCapabilities||{},this.pageName=pageName||"noname",this.id=String(_id++),_pages[this.id]=this,this.options=options||{},this.$$container=null,this.$$elmt=null,this.$$contentElmt=null,this.controller=null,this.parentPage=null,this.parentVignette=null,this.parentPage=null,options.isVignette&&(this.parentVignette=options.parentVignette,this.parentPage=options.parentPage),this.attachedControlsMgr=new AttachedControlsMgr(this),this._ensureController()},null,{_ensureController:function(){this.controller=new Controller(null)},destroy:function(){this.destroyed=!0,this.unbuild(),delete _pages[this.id],this.parentVignette=null,this.parentPage=null,this.controller&&(this.controller.destroy(),this.controller=null),this.attachedControlsMgr&&(this.attachedControlsMgr.destroy(),this.attachedControlsMgr=null),notifications.unsubscribe(this)},unbuild:function(){this.attachedControlsMgr&&this.attachedControlsMgr.destroyControls(),this.$$elmt&&(this.$$elmt.unbind(),this.$$elmt.remove()),this.$$elmt=null,this.$$contentElmt=null,this.$$contentRoot=null,this.$$scrollWrapper=null},isRootPage:function(){return!1},isNoHistory:function(){return!1},set$$container:function($$container){this.$$container=$$container},createRootElement:function(){var tplName="fullpage";this.isVignette()&&(tplName="vignette");var ctx={pageId:this.id,pageName:this.pageName,device:siteLayout.getDeviceType()};this.$$elmt=$(_getHtml(tplName,ctx)),this.$$contentElmt=this.$$elmt.find("[data-s-m-content]"),this.$$contentElmt.length===0&&(this.$$contentElmt=this.$$elmt),this.$$contentRoot=this.$$contentElmt,this.isVignette()||this.$$elmt.append($(_getHtml("panelContainers"))),this.$$container.append(this.$$elmt)},hide:function(){if(!this.$$elmt)return;this.$$elmt.hide()},show:function(noCompute){if(!this.$$elmt)return $.smResolve();this.$$elmt.show();var self=this;return $.smResolve().then(function(){noCompute!==!0&&!self.isVignette()&&self.computeLayout()})},build:function(){var self=this;return $.smResolve().then(function(){return self.createRootElement()}).then(function(){return self.initStructure&&self.initStructure()}).then(function(){return self._initScrolling(),self.render&&self.render()}).then(function(){return self.afterRender&&self.afterRender()}).then(function(){self.onPageDataChanged()}).then(function(){notifications.publish(["sm.page.loaded"],self)})},initStructure:function(){this.createAttachedControls()},computeLayout:function(context){this.$$elmt.removeClass("landscape portrait"),this.$$elmt.addClass(siteLayout.getPageOrientation());var layoutInfo=siteLayout.getLayoutInfo();if(!this.isVignette()){var mainLayout=this.attachedControlsMgr.computeMainLayout(layoutInfo);this.$$contentElmt.css({top:mainLayout.contentTop+"px",left:mainLayout.contentLeft+"px",width:mainLayout.contentWidth+"px",height:mainLayout.contentHeight+"px"})}this.mainContentRect=uiRect.elmtRect(this.$$contentElmt,"outer"),this.mainContentNoPaddingRect=uiRect.elmtRect(this.$$contentElmt,"computed"),layoutInfo.pageContentRect=this.mainContentRect,layoutInfo.pageContentNoPaddingRect=this.mainContentNoPaddingRect,this.computeControlsLayouts($.extend(!0,context,layoutInfo)),this._updateScrolling(),this.options.savedCtx&&(this.savedCtxRestore(this.options.savedCtx),delete this.options.savedCtx)},computeControlsLayouts:function(context){this.attachedControlsMgr&&this.attachedControlsMgr.computeLayout(context)},scrollAllowed:function(){return!this.isVignette()&&!this.isDashboard("hub")},_initScrolling:function(preserveScroll){if(!this.scrollAllowed()||this.$$scrollWrapper)return;this.$$scrollWrapper=$('<div class="s-m-scroll-wrapper"/>').appendTo(this.$$contentRoot),this.$$scrollWrapper.css({height:"auto"}),this.$$contentRoot=this.$$scrollWrapper,this._gestureMgr=scroller.newScroller(this.$$scrollWrapper,{isPageScroller:!0})},_updateScrolling:function(preserveScroll){if(!this._gestureMgr||!this.$$elmt.is(":visible"))return;if(!this.scrollAllowed()){this._gestureMgr.reset();return}var viewRect=this.isVignette()?this.parentVignette.getScrollViewRect():this.mainContentRect;if(!viewRect||viewRect.height>=this.$$scrollWrapper.height()){this._gestureMgr.reset();return}var valMax=0;preserveScroll=preserveScroll===!0,this._gestureMgr.init(viewRect,"v",valMax,preserveScroll);var autoScroll=this.options["auto-scroll"];autoScroll!=null&&(this.autoScroll(autoScroll),this.options["auto-scroll"]=undefined);var viewRect=this.isVignette()?this.parentVignette.getScrollViewRect():this.mainContentRect;(!viewRect||viewRect.height>=this.$$scrollWrapper.height())&&this._gestureMgr.reset()},onContentChanged:function(){this._updateScrolling()},getPageTitle:function(){return""},createAttachedControls:function(){var self=this,names=self._getDefaultAttachedControls();names.forEach(function(name){var info=self._getAttachedControlInfo(name);info&&self.attachedControlsMgr.createControl(info)})},_getDefaultAttachedControls:function(){if(this.isVignette())return[];var attachCtrl=["header"];return this.controller.showNavigationStackBar()&&attachCtrl.push("navigationStackBar"),attachCtrl},_getAttachedControlInfo:function(name){var defaults={header:{topIndex:0,selector:"header",$type:"application/x-panel-header-sdata-page"},breadcrumbs:{topIndex:1,selector:"aside.s-m-panel.s-m-freeleft",$type:"application/x-panel-breadcrumbs"},actionsPanel:{selector:"aside.s-m-panel.s-m-freeright",$type:"application/x-panel-actions"},actionsMultiPanel:{selector:"aside.s-m-panel.s-m-freeright",$type:"application/x-panel-actions-multi"},globalPanel:{selector:"aside.s-m-panel.s-m-left",$type:"application/x-panel-global"},filterSortPanel:{selector:"aside.s-m-panel.s-m-right",vignetteSelectorUseParent:!0,$type:"application/x-panel-filtersort"},chartDetailToolBar:{topIndex:2,selector:".s-m-topToolbar",$type:"application/x-chartdetail-toolbar"},sharePanel:{selector:"aside.s-m-panel.s-m-right",vignetteSelectorUseParent:!0,$type:"application/x-panel-share"},dashboardTemplatePanel:{selector:"aside.s-m-panel.s-m-right",$type:"application/x-panel-dashboard-template"},editTemplatesPanel:{selector:"aside.s-m-panel.s-m-right",$type:"application/x-panel-edittemplates"},navigationStackBar:{selector:"header .s-m-navigation-stackbar",$type:"application/x-navigation-stackbar"}},info=defaults[name];return info.name=name,info},getPanel:function(name){return this.attachedControlsMgr.findByName(name)},openPanel:function(name,options){var panel=this.getPanel(name);if(!panel){var info=this._getAttachedControlInfo(name);info&&(panel=this.attachedControlsMgr.createControl(info,options))}if(!panel)return;return panel},_actOpenActionsPanel:function(){var actionsPanel=this.getPanel("actionsPanel");if(!actionsPanel){var info=this._getAttachedControlInfo("actionsPanel");info&&(actionsPanel=this.attachedControlsMgr.createControl(info))}if(!actionsPanel)return;actionsPanel.show()},_actOpenActionsMultiSelectionPanel:function(){var actionsPanel=this.getPanel("actionsMultiPanel");if(!actionsPanel){var info=this._getAttachedControlInfo("actionsMultiPanel");info&&(actionsPanel=this.attachedControlsMgr.createControl(info))}if(!actionsPanel)return;actionsPanel.show()},_actOpenGlobalPanel:function(){var panel=this.openPanel("globalPanel");panel&&panel.show()},_actPageShare:function(){var panel=this.openPanel("sharePanel");panel.show()},onMainPageResize:function(info,orientation,deviceType){var actionsPanel=this.getPanel("actionsPanel");actionsPanel&&actionsPanel.hide(),info.deviceChanged==1&&this.attachedControlsMgr&&(this.attachedControlsMgr.destroyControls(),this.createAttachedControls(),this.attachedControlsMgr.buildHtml()),this.computeLayout(info)},onGotoUrlAction:function(isBack,parsedUrl){return $.smResolve(!0)},onPageDataChanged:function(){},allowAuthoring:function(){return!1},getAuthoringName:function(){},getAuthoringFullName:function(){},getPageName:function(){return this.pageName},isVignette:function(){return this.options.isVignette===!0},isHome:function(){return this.pageName==="HOME"},authUpdateLayout:function(){var self=this;return self.unbuild(),self.build().then(function(){return self.show()})},isDashboard:function(typeDashboard){return!1},isChartDetail:function(typeDashboard){return!1},isCardDetail:function(){return!1},isNestedInDashboard:function(typeDashboard){return this.isVignette()&&this.parentPage&&this.parentPage.isDashboard(typeDashboard)},isChild:function(pageName){return pageName==null?this.options.isChild===!0:this.options.isChild===!0&&this.options.childPageName===pageName},getGestureMgr:function(){return this._gestureMgr},makeVisible:function($$elmt,smoothOffset){$$elmt&&this._gestureMgr&&this._gestureMgr.makeVisible($$elmt,smoothOffset)},notifyScrollerUpdate:function(force){if(!this._gestureMgr||!this.$$elmt.is(":visible"))return;this._updateScrolling(!0),this._gestureMgr.adjust()},isFacet:function(){return!1},savedCtxCreate:function(opts){if(this.destroyed)return;var ctx={pageName:this.pageName,ctxCtrls:this.controller.savedCtxCreate(opts)};return this._gestureMgr&&(ctx.scroll=this._gestureMgr.savedCtxCreate(opts)),ctx},savedCtxCtrlRead:function(ctrl){if(this.destroyed)return;var ctx;if(this.options.savedCtx&&this.options.savedCtx.ctxCtrls){var idx=this.controller.savedCtxIndexOf(ctrl);ctx=idx>=0?this.options.savedCtx.ctxCtrls[idx]:null}return ctx},savedCtxRestore:function(ctx){if(this.destroyed)return;ctx=ctx||this.options.savedCtx;if(!ctx)return;if(this.pageName!=ctx.pageName)return;this._gestureMgr&&ctx.scroll!=null&&this._gestureMgr.savedCtxRestore(ctx.scroll,!0),ctx.ctxCtrls&&this.controller.savedCtxRestore(ctx.ctxCtrls)},getPagePrefsId:function(){return settings.getPagePrefsId(this.pageName,this.parentVignette)},getPinActionState:function(){},isSData:function(){return!1}}),exports.findPage=function(id){return _pages[id]}}),define("syracuse-tablet/html/js/authoring/authoringSData",["require","exports","module","syracuse-tablet/html/js/common/ajax"],function(require,exports,module){function _extractErrors(data,result){return result==null&&(result={errors:!1,diags:{$diagnoses:[]}}),Object.keys(data).forEach(function(key){var value=data[key];key==="$diagnoses"?value.forEach(function(d){result.diags.$diagnoses.push(d),d.$severity=="error"&&(result.errors=!0)}):value&&typeof value=="object"&&_extractErrors(value,result)}),result}var ajax=require("syracuse-tablet/html/js/common/ajax"),_DEVICE_NAME="mobile";exports.getPageVariants=function(pageName){var deferred=$.Deferred(),code=pageName+"."+_DEVICE_NAME,key=encodeURIComponent(code).replace(/'/g,"''");return ajax.request("/sdata/syracuse/collaboration/syracuse/pageDefs(code%20eq%20'"+key+"')?representation=pageDef.$details").then(function(response){deferred.resolve(response.data.variants||[])}).fail(function(e){e.status===404&&deferred.resolve([]),deferred.reject(e)}),deferred.promise()},exports.getPageViews=function(pageName){var deferred=$.Deferred(),key=encodeURIComponent(pageName).replace(/'/g,"''")+",$page,,"+_DEVICE_NAME;return ajax.request("/sdata/syracuse/collaboration/syracuse/pages('"+key+"')").then(function(response){deferred.resolve(response.data.$views||[])}).fail(function(e){e.status===404&&deferred.resolve([]),deferred.reject(e)}),deferred.promise()};var _createPageDefinitionWC=function(opts){var params={pageContext:[opts.application,opts.contract,opts.representation,opts.facet].join("."),device:_DEVICE_NAME,representation:"pageAuth.$edit"},url="/sdata/syracuse/collaboration/syracuse/pageAuths"+(opts.variant!=null?"('"+opts.variant+"')":"/$template")+"/$workingCopies?"+Object.keys(params).map(function(key){return key+"="+params[key]}).join("&");return ajax.request(url,"POST").then(function(response){return response.data})},_savePageDefinitionWC=function(opts,wc){var parameters={roles:opts.roles,users:opts.users,endpoints:opts.endpoints,saveAsOption:opts.saveAsOption,isFactory:!1,isModelRepresentation:!1,personalCopy:!1,variantCode:opts.variantCode,variantTitle:opts.variantTitle,variantDescription:opts.variantDescription};switch(opts.saveAsOption){case"factory_variant":parameters.isFactory=!0;break;case"personal_copy":parameters.personalCopy=!0;break;case"shared_copy":break;case"global_variant":}wc.$actions={};var save;return opts.variant?(save=wc.$actions.$save={},delete parameters.saveAsOption):save=wc.$actions.saveAs={},save.$isRequested=!0,save.$parameters=parameters,ajax.request(wc.$url,"PUT",wc).then(function(response){return response.data})};exports.savePageDefinition=function(opts){var workingCopy;return _createPageDefinitionWC(opts).then(function(wc){workingCopy=wc;var send=$.extend(!0,{},workingCopy);return send.content=send.content||{},send.content.$article=opts.article,_savePageDefinitionWC(opts,send)}).then(function(wcSaved){var data=$.extend(!0,{},workingCopy,wcSaved),result=_extractErrors(data);return result.errors?$.smReject(result.diags):data})}}),define("syracuse-tablet/html/js/authoring/authoringHtml",["require","exports","module"],function(require,exports,module){function _getCompiled(name){var c=_compiled[name];if(c)return c;var t=_templates[name];return c=Handlebars.compile(t),_compiled[name]=c,c}var _templates={authPanelHeader:'		<div style="display:table;table-layout:fixed;;width:100%;">			<div style="display:table-row;width:100%; ">				<div style="display:table-cell;width:300px;">					<div style="display:table;">						<div style="display:table-row;position:absolute;top:0;">							<div style="display:table-cell;">								<button class="btn btn-auth-header" id="s-m-auth-settings-id" type="button"><label class="glyphicon glyphicon-cog"></label>{{label_settings}}</button> 							</div>							<div style="display:table-cell;" >								<div class="btn-group" id="s-m-auth-orientation-id" data-toggle="buttons">									<button class="btn btn-auth-header active" id="s-m-auth-vertical-id" data-auth-orientation="portrait" title="{{label_preview_portrait}}"> 										<input type="radio" name="orientation" checked> 										<label class="glyphicon glyphicon-resize-vertical"></label> 									</button> 									<button class="btn btn-auth-header" id="s-m-auth-horizontal-id" data-auth-orientation="landscape" title="{{label_preview_landscape}}"> 										<input type="radio" name="orientation"> 										<label class="glyphicon glyphicon-resize-horizontal"></label> 									</button> 								</div>							</div>							<div style="display:table-cell;">								<button class="btn btn-auth-header" id="s-m-auth-scale-id" type="button" title="{{label_scale_to_fit}}"><label class="glyphicon glyphicon-fullscreen"></button> 							</div>						</div>					</div>				</div>				<div style="display:table-cell;" id="s-m-auth-header-actions-id">					<div style="display:table;">						<div style="display:table-row;position:absolute;top:0;">							<button style="display:table-cell;" class="btn btn-auth-header" id="s-m-auth-new-layout-id" type="button"><label class="glyphicon glyphicon-blackboard"></label><span>{{label_new_layout}}</span></button> 							<button style="display:table-cell;" class="btn btn-auth-header" id="s-m-auth-remove-all-id" type="button"><label class="glyphicon glyphicon-erase"></label><span>{{label_remove_all}}</span></button> 							<button style="display:table-cell;" class="btn btn-auth-header disabled" id="s-m-auth-remove-id" type="button"><label class="glyphicon glyphicon-trash"></label><span>{{label_remove}}</span></button> 							<button style="display:table-cell;" class="btn btn-auth-header disabled" id="s-m-auth-remove-cnt-id" type="button"><label class="glyphicon glyphicon-erase"></label><span>{{label_remove_container}}</span></button> 						</div>					</div>				</div>				<div style="display:table-cell;">					<button id="auth-btn-close-id" style="float:right;" class="btn btn-danger" type="button"><div class="glyphicon glyphicon-remove"></label></button> 					<button id="auth-btn-save-id" style="float:right;" class="btn btn-default" type="button"><div class="glyphicon glyphicon-ok"></label></button> 					<button id="auth-btn-undo-all-id" style="float:right;" class="btn btn-auth-header" type="button"><div class="icon-undoall"></label>{{label_undo_all}}</button> 					<button id="auth-btn-undo-id"  style="float:right;" class="btn btn-auth-header" type="button"><div class="icon-undo"></label>{{label_undo}}</button> 				</div>			</div>		</div>',authPanelFooter:'		<div class="btn-group"> 		</div>',authPanelRightStructure:'		<div class="s-m-site-auth-panel-content"> 			<header id="authPanelControlType">{{label_design}}</header> 			<p class="form-control-static" id="authPanelControlTitle"> </p> 			<div style="padding: 0 15px;">				<a class="btn btn-primary" id="s-m-auth-child-design-open-id" style="display:none; width: 100%;">{{label_openCardDesign}}</a> 			</div>			<div id="authPanelControl" class="tab-pane panel-body active"> 				<div id="authPanelControlSimple"> 				</div> 			</div> 		</div>',authPanelLeftStructure:'		<div class="s-m-site-auth-panel-content"> 			<ul class="nav nav-pills" role="tablist"> 				<li class="active"><a aria-expanded="true" href="#s-m-auth-tree-box" role="tab" data-toggle="tab">{{label_content}}</a></li> 				<li><a href="#s-m-auth-insert-box" role="tab" data-toggle="tab">{{label_insert}}</a></li> 			</ul> 			<div class="tab-content"> 				<div id="s-m-auth-tree-box" class="tab-pane active"> 					<ul class="s-m-auth-tree" id="auth-structure-root-id"></ul> 				</div> 				<div id="s-m-auth-insert-box" class="tab-pane"> 					<div class="panel panel-primary s-m-panel-auth-prop"> 						<div class="panel-heading" role="tab" id="auth-lp-cnt-containers-header"> 							<a data-toggle="collapse" data-parent="#accordion" href="#auth-lp-cnt-containers-clpse" 								aria-expanded="true" aria-controls="auth-lp-cnt-containers-clpse" 								<h4 class="panel-title"> 									{{label_containers}}								</h4> 							</a> 						</div> 						<div id="auth-lp-cnt-containers-clpse" class="panel-collapse collapse in" 							role="tabpanel" aria-labelledby="auth-lp-cnt-containers-header"> 							<label>{{lab_drag_to_add}}</label><br> 							<div class="s-m-auth-btn-container s-m-draggable fa fa-th" data-auth-bind="group" title="{{lab_group}}" data-auth-drag-action="add_layout"></div> 							<div class="s-m-auth-btn-container s-m-draggable fa fa-square-o" data-auth-bind="tile" title="{{lab_tile}}" data-auth-drag-action="add_layout"></div> 							<div class="s-m-auth-btn-container s-m-draggable fa fa-bars" data-auth-bind="stack" title="{{lab_stack}}" data-auth-drag-action="add_layout"></div> 						</div> 					</div> 					<div class="panel panel-primary s-m-panel-auth-prop"> 						<div class="panel-heading" role="tab" id="auth-lp-cnt-props-header"> 							<a data-toggle="collapse" data-parent="#accordion" href="#auth-lp-cnt-props-clpse" 								aria-expanded="true" aria-controls="auth-lp-cnt-props-clpse">								<h4 class="panel-title"> 									{{label_fields}}								</h4> 							</a> 						</div> 						<div id="auth-lp-cnt-props-clpse" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="auth-lp-cnt-props-header"> 						</div> 					</div> 				</div> 			</div> 		</div>',authPanelPropertyGroup:' 		<div class="panel panel-primary s-m-panel-auth-prop s-m-auth-prop-type-{{type}}"> 			<div class="panel-heading" role="tab" id="heading_{{id}}"> 				<a data-toggle="collapse" data-parent="#{{#if parentId}}{{parentId}}{{/if}}{{#unless parentId}}accordion{{/unless}}" href="#collapse_{{id}}" {{#if expanded}} aria-expanded="true"{{/if}} aria-controls="collapse_{{id}}" {{#unless expanded}}class="collapsed"{{/unless}}>					<h4 class="panel-title"> 						{{label}}					</h4> 				</a> 			</div> 			<div id="collapse_{{id}}" class="panel-collapse collapse {{#if expanded}}in{{/if}}" role="tabpanel" aria-labelledby="heading_{{id}}"> 			</div> 		</div>',authPanelPropertySeperator:' 		<div class="auth-group-seperator"></div> 		',authPanelPropertyRadio:' 		<div class="btn-group" data-toggle="buttons" style="width: 100%;"> 			{{#each options}} 				<div class="btn-group" style="width: 100%; display: {{this.display}};" id="{{this.id}}"> 					<label class="s-m-auth-btn-radio-icon s-m-auth-btn-block" id="{{this.id}}_lab" data-s-m-auth-value="{{this.value}}"> 						<input type="radio" name="{{group}}" id="{{this.id}}">{{this.label}} 					</label> 				</div> 			{{/each}} 		</div>',authPanelPropertyRadioIcon:' 		<div class="btn-group" data-toggle="buttons" style="width: 100%;"> 			{{#each options}} 				<div class="btn-group"> 					<label class="auth-btn-icon {{icon}}" id="{{this.id}}_lab" data-s-m-auth-value="{{this.value}}"> 						<input type="radio" name="{{group}}" id="{{this.id}}"> 					</label> 				</div> 			{{/each}} 		</div>',authPanelPropertyCheckbox:' 		<div class="btn-group" style="width: 100%;"> 			{{#each options}} 				<div class="btn-group" style="width: 100%; display: {{this.display}};" id="{{this.id}}"> 					<label class="s-m-auth-btn-checkbox-icon s-m-auth-btn-block" id="{{this.id}}_lab" data-s-m-auth-value="{{this.value}}"> 							<i class="fa fa-square {{#if checked}}fa-check-square{{/if}}" style="margin-right:5px"></i>{{this.label}} 					</label> 				</div> 			{{/each}} 		</div>',authPanelPropertyInput:' 			<div class="form-group"> 				<input class="form-control" id="{{id}}" value="{{value}}" /> 			</div>',authPanelPropertyInputLocale:' 		<div class="form-group"> 			<input class="form-control" id="{{id}}" value="{{value}}" data-old-value="{{oldValue}}" data-old-uuid="{{oldUUID}}"/> 		</div>',authPanelSliderStep:' 		<div class="form-group"> 			<section style="padding-left:10px;padding-right:10px;">				<input id="{{id}}" type="text" data-slider-min="{{min}}" data-slider-max="{{max}}" data-slider-step="{{step}}"  data-slider-value="{{value}}" data-slider-orientation="horizontal" data-slider-tooltip="hide">				{{#if displayValue}}<span class="s-m-slider-value">{{#if valText}}{{valText}}{{/if}}{{#unless valText}}{{value}}{{/unless}}</span>{{/if}}			</section>		</div>',authPanelGaugeSlider:'		<div class="form-group s-m-auth-g-slider"> 			<section>				<input id="{{id}}" type="text" data-slider-min="{{min}}" data-slider-max="{{max}}" data-slider-step="{{step}}"  data-slider-value="{{value}}" data-slider-orientation="horizontal" data-slider-tooltip="hide" class="s-m-auth-g-range">				<span id="{{id}}SliderVal">{{value}}</span>			</section>		</div>	',authPanelPropertyCellSize:' 		<section>			<label class="s-m-auth-btn-checkbox-icon s-m-auth-btn-block">				<input type="checkbox">				{{sameSize}}			</label>			{{#each sizes}} 				<section class = "{{prop}}">					<label class="{{class}} auth-size-device-header" style="width: 100%">{{this.label}}</label> 					<div class="btn-group" data-toggle="buttons" style="width: 100%;"> 						{{#each ../values}} 							<div class="btn-group"> 								<label class="auth-btn-size-sel" id="{{this.id}}_lab" data-s-m-auth-prop="{{../this.prop}}" data-s-m-auth-value="{{this}}"> 									<input type="radio" name="{{group}}" id="{{../this.prop}}={{this}}">{{this}} 								</label> 							</div> 						{{/each}} 					</div> 				</section>			{{/each}}		</section>',authPanelPropertyJSON:' 			<div class="form-group"> 				<textarea class="form-control" id="{{id}}" rows="10">{{value}}</textarea> 				<div class="btn-group btn-group-justified" role="group">					<a class="btn btn-default" data-action="jsonApply">{{label_apply}}</a> 					<a class="btn btn-default" data-action="openInNewTab">{{label_display}}</a> 				</div>			</div><div style="clear: both;"></div>',authPanelPropertyPROTOTYPE:' 			<div class="form-group"> 				<textarea readonly class="form-control" id="{{id}}" rows="10">{{value}}</textarea> 				<div class="btn-group btn-group-justified" role="group">					<a class="btn btn-default" data-action="openInNewTab">{{label_display}}</a> 				</div>			</div>',authPanelPropertyGBorderValues:'		<div class="form-group">			<p class="s-m-auth-g-borders-tip">{{label_tip}}</p>			<label>{{label_min}}</label>			{{{markupMin}}}			<label>{{label_max}}</label>			{{{markupMax}}}			<button class="btn btn-default btn-block" style="margin-top:5%;">{{label_apply}}</button> 		</div>	',authPanelPropertyGSegmentsNumber:'		<div class="form-group">			{{{value}}} 			<button class="btn btn-default btn-block" style="margin-top:5%;">{{label_apply}}</button> 		</div>	',gaugeBorderInput:'		<textarea class="form-control" id={{id}} rows="1">{{value}}</textarea>	',gaugeSelect:'		<select id={{id}} style="color:black;" class="form-control">			{{#each options}}				<option value="{{option_value}}" {{#if selected}}selected=true{{/if}}>{{option_value}}</option>			{{/each}}		</select>	',gaugeSegment:'		<div id="{{id}}" class="s-m-auth-seg-slot">			<div class="s-m-g-seg-info-block">				<div class="s-m-g-seg-label">					<label>{{label_valstart}}</label>				</div>				<div class="s-m-g-seg-value">					<input type="text" class="form-control" value="{{value_valstart}}" id="{{id}}-valstart">				</div>			</div>			<div class="s-m-g-seg-info-block">				<div class="s-m-g-seg-label">					<label>{{label_valend}}</label>				</div>				<div class="s-m-g-seg-value">					<input type="text" class="form-control" value="{{value_valend}}" id="{{id}}-valend">				</div>			</div>			<div class="s-m-g-seg-info-block">				<div class="s-m-g-seg-label">					<label>{{label_propstart}}</label>				</div>				<div class="s-m-g-seg-value">					{{{value_propstart}}}				</div>			</div>			<div class="s-m-g-seg-info-block">				<div class="s-m-g-seg-label">					<label>{{label_propend}}</label>				</div>				<div class="s-m-g-seg-value">					{{{value_propend}}}				</div>			</div>			<div class="s-m-g-seg-info-block">				<div class="s-m-g-seg-label">					<label>{{label_color}}</label>				</div>				<div class="s-m-g-seg-value">					<input type="text" class="form-control" value="{{value_color}}" id="{{id}}-color">				</div>			</div>		</div>	',authPanelButton:'		<div class="s-m-auth-g-apply-slot">			<button class="btn btn-default btn-block {{css}}" style="margin-top:5%;">{{label}}</button> 		</div>	'},_compiled={};exports.execute=function(name,ctx){var c=_getCompiled(name);return c(ctx)}}),define("syracuse-tablet/html/js/authoring/authoringVal",["require","exports","module","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/modals/modal"],function(require,exports,module){function getAuthoringPropertiesLayouts(){return _authProperties&&_authProperties.getPropertiesLayouts()}function _validate(fullPage,article,properties){var errors=[];try{_checkNode(fullPage,null,article,properties,errors)}catch(e){errors.push("javascriptException - validate\n"+jsutils.cleanStack(e.stack))}return errors}function _checkNode(fullPage,parent,node,properties,errors){Object.keys(_propertiesToCheck).some(function(key){node[key]!==undefined&&_propertiesToCheck[key](fullPage,parent,node,key,properties,errors)});var children;node.$items?children=node.$items:node.$article&&(children=[node.$article]),children&&children.forEach(function(child){_checkNode(fullPage,node,child,properties,errors)})}function _checkLayoutType(fullPage,parent,node,key,properties,errors){var type=node.$layoutType,ptype=parent&&parent.$layoutType,known=["stack","row","cell","hub","hubGroup","tile"];if(known.indexOf(type)<0){errors.push(locale.text("auth.err.unknown.layout",[type]));return}if(!fullPage)return;switch(type){case"hub":parent!=null&&errors.push(locale.text("auth.err.hub.notroot"));break;case"hubGroup":ptype!="hub"&&errors.push(locale.text("auth.err.hubgroup.nohub"));break;case"tile":ptype!="hubGroup"&&errors.push(locale.text("auth.err.tile.nohubgroup"))}}function _checkCellSize(fullPage,parent,node,key,properties,errors){var value=+node[key];value>=1&&value<=12||errors.push(locale.text("auth.err.cellSize",[key,value]))}function _checkTileSize(fullPage,parent,node,key,properties,errors){var value=node[key],valid=getAuthoringPropertiesLayouts().properties.tileSize.values.map(function(e){return e.value});valid.indexOf(value)<0&&errors.push(locale.text("auth.err.tileSize",[valid.join(", "),value]))}var locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),modal=require("syracuse-tablet/html/js/ui/modals/modal"),_authProperties;exports.setProperties=function(properties){_authProperties=properties},exports.validateJSON=function(fullPage,jsonText,properties){var obj;try{if($.isPlainObject(jsonText))obj=jsonText;else{if(!(jsonText!=null&&jsonText.length>0))throw new Error("Unexpected bad JSONtext");obj=JSON.parse(jsonText)}var errors=_validate(fullPage,obj,properties);if(!(errors.length>0))return obj;var text="\n"+errors.join("\n");modal.error(locale.text("auth.panel.save_error_title"),{message:locale.text("auth.panel.save_error_json"),detail:text})}catch(e){modal.error(locale.text("auth.panel.save_error_title"),{message:locale.text("auth.panel.save_error_json"),detail:e})}},exports.toSortedJSON=function(obj){var toJSON=function(){var self=this,that={},$items,$article;return Object.keys(self).forEach(function(key){self.hasOwnProperty(key)&&(key==="$items"?$items=self[key]:key==="$article"?$article=self[key]:key!=="toJSON"&&(that[key]=self[key]))}),$article&&(that.$article=$article),$items&&(that.$items=$items),self.toJSON&&delete self.toJSON,that.toJSON&&delete that.toJSON,that};JSON.stringify(obj,function replacer(key,value){return $.isPlainObject(value)&&(value.toJSON=toJSON),value});var str=JSON.stringify(obj,null," ");return str};var _propertiesToCheck={$layoutType:_checkLayoutType,$size:_checkTileSize,$widthXs:_checkCellSize,$widthSm:_checkCellSize,$widthMd:_checkCellSize,$widthLg:_checkCellSize}}),define("syracuse-tablet/html/js/authoring/authoringComponents",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_templates={genericSlider:'		<div class="form-group" {{#if margin}}style="margin-bottom:{{margin}}px;"{{/if}}> 			<section style="padding-left:10px;padding-right:10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis">				<input id="{{id}}" type="text" data-slider-min="{{min}}" data-slider-max="{{max}}" data-slider-step="{{step}}"  data-slider-value="{{value}}" data-slider-orientation="horizontal" data-slider-tooltip="hide">				{{#if displayValue}}<p class="s-m-slider-value">{{#if valText}}{{valText}}{{/if}}{{#unless valText}}{{value}}{{/unless}}</p>{{/if}}			</section>		</div>',flatRadio:'		<div class="btn-group" style="margin-bottom:10px;" data-toggle="buttons">			{{#each btns}}				<label class="btn btn-primary">					<input type="radio" autocomplete="off" value="{{value}}">					{{title}}				</label>			{{/each}}		</div>',select:'		<div style="position:relative;{{#if margin}}margin-bottom:{{margin}}px;{{/if}}">		  <select class="selectpicker {{css}}"  data-width="100%" {{#if dataSize}}data-size="{{dataSize}}"{{/if}}>		  	{{#each options}}		     	<option value="{{value}}">{{title}}</option>			{{/each}}		  </select>		</div>',actionBtns:'		<div style="text-align:center;">			<div class="btn-group" role="group" style="margin-bottom:10px;">				{{#each btns}}					<button type="button" class="btn btn-default" value="{{value}}">{{title}}</button>				{{/each}}			</div>		</div>',colorPicker:'		<input type="text" {{#if id}}id="{{id}}"{{/if}} class="form-control {{css}}""></input>',editableList:'		<section class = "auth-editableList  {{css}}" {{#if id}}id="{{id}}"{{/if}} >			<ul class="list-group auth-editableList"></ul>			<div class="authMsg"></div>			<div class="btn-group btn-group-justified" role="group">				<a type="button" class="btn btn-default authLstAct" data-action="append">					<i class="fa fa-plus"></i>					<span>{{addTitle}}</span>				</a>				<a style="display:none" type="button" class="btn btn-default authLstAct" data-action="validate">					<i class="fa fa-check"></i>					<span>{{validateTitle}}</span>				</a>				<a style="display:none" type="button" class="btn btn-default authLstAct" data-action="cancel">					<i class="fa fa-times"></i>					<span>{{cancelTitle}}</span>				</a>			</div>		</section>',editableListItem:'		<li class="list-group-item {{css}}" data-params="{{id}}">			<span>				<span>{{#if title}}{{title}}{{/if}}{{#if titleHtml}}{{{titleHtml}}}{{/if}}</span>				<span class="fa fa-pencil" data-action="editItem"></span>				<span class="fa fa-times" data-action="deleteItem"></span>			</span>		</li>',colorPalettePicker:'		<section class="auth-colorPalettePicker {{dropDirection}}">			<div class="input-group" data-toggle="dropdown" aria-expanded="false">				<span class="form-control auth-paletteColor"></span>				<span class="input-group-addon"><div class="fa fa-times"></div></span>			</div>			<div class="dropdown-menu" style="width: 100%;width: 100%;padding-left: 5px;padding-right: 5px;">				<div class="auth-paletteRoot" data-toggle="buttons" style="width: 100%;white-space: normal;" >				</div>		  	</div>		</section>',colorPaletteItem:'		<div class="auth-paletteItem {{css}}" data-id="{{id}}" data-name="{{name}}" data-css="{{css}}">		</div>',iconPalettePicker:'		<section class="auth-iconPalettePicker {{dropDirection}}">			<div class="input-group" data-toggle="dropdown" aria-expanded="false">				<span class="form-control auth-paletteIcon"></span>				<span class="input-group-addon"><div class="fa fa-times"></div></span>			</div>			<div class="dropdown-menu">				<div class="auth-paletteRoot" data-toggle="buttons" style="width: 100%;white-space: normal;" >				</div>		  	</div>		</section>',iconPaletteItem:'		<div class="auth-paletteItem {{css}}" data-params="{{name}}" data-css="{{css}}">		</div>',switcher:'		 <input {{#if id}}id="{{id}}"{{/if}} type="checkbox">',checkboxList:' 		<section class="auth-checkboxList {{css}}" {{#if id}}id="{{id}}"{{/if}}/>',checkboxListContent:' 		<div class="btn-group s-m-list">			{{#each list}} 				<div class="s-m-item btn-group" data-id = "{{id}}"> 					<label> 						<input type="checkbox" {{#if checked}}checked{{/if}}>{{label}} 					</label> 				</div> 			{{/each}}		</div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)},_components={editableList:function(options,name){options=options||{},this.options=options,this.name=name||"editableList",this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("editableList",{id:options.id,css:options.css||"",addTitle:options.appendTitle||locale.text("append"),validateTitle:options.validateTitle||locale.text("validate"),cancelTitle:options.cancelTitle||locale.text("cancel")})).appendTo($$parent),options.isHidden===!0&&this.hide(),this.options.doAction&&this.$$panel.on("click","[data-action]",jsutils.bindFn(this.onClick,this)),this.$$list=this.$$panel.find("ul"),this.$$panel},this.onClick=function(event){var $$target=$(event.target).closest("[data-action]"),action=$$target.attr("data-action"),id;action==="append"||action==="cancel"?id="":action==="editItem"||action==="deleteItem"?id=$$target.closest("[data-params]").attr("data-params")||"":action==="validate"&&(id=$$target.attr("data-params")||"");var done=this.options.doAction(action,id,this);done==1&&(action==="deleteItem"?$$target.closest("li").off().remove():action==="editItem"||action==="append"?this.toggleEditStatus(!0,id):(action==="validate"||action==="cancel")&&this.toggleEditStatus(!1))},this.insertRecords=function(records){if(!records||!this.$$list)return;$.isPlainObject(records)&&(records=[records]);if(!Array.isArray(records))return;var self=this;records.forEach(function(record){if(!record||!record.id)return;var $$newRec=$(_getHtml("editableListItem",{id:record.id,css:record.css||"",titleHtml:record.titleHtml,title:record.title})),$$oldRec=self.$$list.find('[data-params="'+record.id+'"]');$$oldRec.length>0?($$oldRec.before($$newRec),$$oldRec.remove()):$$newRec.appendTo(self.$$list)})},this.destroyMarkup=function(){this.options=null,this.$$list&&(this.$$list.off(),this.$$list=null),this.$$panel=null},this.clear=function(){if(!this.$$list)return;this.$$list.find("li").remove()},this.toggleEditStatus=function(editMode,recordId){if(!this.$$panel)return;this.$$panel.find('[data-action="append"]').toggle(editMode!==!0),this.$$panel.find('[data-action="validate"]').toggle(editMode===!0).attr("data-params",editMode===!0?recordId:""),this.$$panel.find('[data-action="cancel"]').toggle(editMode===!0)},this.disableAppendBtn=function(disabled){this.$$panel.find('[data-action="append"]').attr("disabled",disabled===!0)},this.toggleMessage=function(msgText,type){if(!this.$$panel)return;var $$msg=this.$$panel.find(".authMsg");$$msg.empty().removeClass(),msgText&&msgText.trim().length>0&&($$msg.text(msgText),type&&$$msg.addClass("s-m-"+type)),$$msg.addClass("authMsg")}},colorPicker:function(options,name){options=options||{},this.options=options,this.name=name||"colorPicker",this.createMarkup=function($$parent){return this.$$picker=$(_getHtml("colorPicker",{id:options.id,css:options.css||""})).appendTo($$parent),options.isHidden===!0&&this.$$picker.hide(),this.$$picker.minicolors({control:options.control||"hue",defaultValue:options.value||"",inline:options.inline===!0,letterCase:options.letterCase||"lowercase",opacity:options.opacity===!0,position:options.position||"top left",theme:"bootstrap",change:options.onChange?jsutils.bindFn(this.onChange,this):null}),this.$$panel=this.$$picker,this.$$panel},this.onChange=function(event){this.options.onChange(event,this)},this.destroyMarkup=function(){this.options.onChange=null,this.options=null,this.$$picker&&(this.$$picker.minicolors("destroy"),this.$$picker=null)},this.getValue=function(type){if(!this.$$picker)return;var meth;return type==="rgbObject"||type==="rgbString"||type==="rgbaString"?meth=type:meth="value",this.$$picker.minicolors(meth)},this.setValue=function(valueHexa){if(!this.$$picker)return;return this.$$picker.minicolors("value",valueHexa)}},colorPalettePicker:function(options,name){options=options||{},this.options=options,this.name=name||"colorPalettePicker",this.createMarkup=function($$parent){var css=options.css||"";return this.$$panel=$(_getHtml("colorPalettePicker",{id:options.id,css:css,dropDirection:options.dropUp===!0?"dropup":"dropdown"})).appendTo($$parent),this.$$rootPalette=this.$$panel.find(".auth-paletteRoot"),this.$$input=this.$$panel.find(".auth-paletteColor"),this.$$clearBtn=this.$$panel.find(".input-group-addon").on("click",jsutils.bindFn(this.onClear,this)),this.$$rootPalette.on("click","[data-id]",jsutils.bindFn(this.onSelectColor,this)),options.isHidden===!0&&this.$$panel.hide(),options.palette&&this.updatePalette(options.palette),this.setValue(options.color),this.$$panel},this.updatePalette=function(palette){if(!palette)return;var html=[];palette.forEach(function(item){item.items?(item.title&&html.push('<div class ="authPaletteSection">'+item.title+"</div>"),item.items.forEach(function(subItem){subItem.name=subItem.name||subItem.id,html.push(_getHtml("colorPaletteItem",subItem))})):html.push(_getHtml("colorPaletteItem",item))}),this.$$rootPalette.html(html.join(""))},this.onClear=function(event){this.$$panel.is(".open")||(event.stopPropagation(),this.setValue(null),this.options.onSelectColor&&this.options.onSelectColor(null))},this.onSelectColor=function(event){var $$t=$(event.target),value={id:$$t.attr("data-id")||"",name:$$t.attr("data-name")||"",css:$$t.attr("data-css"),bgColor:$$t.css("background-color"),color:$$t.css("color"),hex:this.getHexColor($$t.css("background-color"))};this.setValue(value),this.options.onSelectColor&&this.options.onSelectColor(value)},this.destroyMarkup=function(){this.$$rootPalette&&(this.$$rootPalette.off(),this.$$rootPalette=null),this.options=null,this.$$clearBtn.off(),this.$$clearBtn=this.$$input=this.$$panel=null},this.getValue=function(){var $$selected=this.$$panel.find(".auth-paletteItem.current");return $$selected.length==0?null:{css:$$selected.attr("data-css")||"",name:$$selected.attr("data-name")||"",id:$$selected.attr("data-id")||"",bgColor:$$selected.css("background-color"),color:$$selected.css("color"),hex:this.getHexColor($$selected.css("background-color"))}},this.setValue=function(color){this.$$panel.find(".auth-paletteItem.current").removeClass("current"),color&&this.$$panel.find('[data-id="'+color.id+'"]').addClass("current"),this.$$input.removeClass().addClass("form-control").text(color?color.name:locale.text("auth.components.palette.nocolor")),color&&this.$$input.addClass(color.css)},this.getHexColor=function(color){var value="#",toHex=function(n){return n=parseInt(n,10),("00"+n.toString(16)).slice(-2)};return/^rgb\(.*\)$/.test(color)?(color.match(/([0-9]+)/g).forEach(function(val){value+=toHex(val)}),value):null}},iconPalettePicker:function(options,name){options=options||{},this.options=options,this.name=name||"iconPalettePicker",this.createMarkup=function($$parent){var css=options.css||"";return this.$$panel=$(_getHtml("iconPalettePicker",{id:options.id,css:css,dropDirection:options.dropUp===!0?"dropup":"dropdown"})).appendTo($$parent),this.$$rootPalette=this.$$panel.find(".auth-paletteRoot"),this.$$input=this.$$panel.find(".auth-paletteIcon"),this.$$clearBtn=this.$$panel.find(".input-group-addon").on("click",jsutils.bindFn(this.onClear,this)),this.$$rootPalette.on("click","[data-params]",jsutils.bindFn(this.onSelectIcon,this)),options.isHidden===!0&&this.$$panel.hide(),options.palette&&this.updatePalette(options.palette),this.setValue(options.icon),this.$$panel},this.updatePalette=function(palette){if(!palette)return;var html=[];palette.forEach(function(item){html.push(_getHtml("iconPaletteItem",item))}),this.$$rootPalette.html(html.join(""))},this.onClear=function(event){this.$$panel.is(".open")||(event.stopPropagation(),this.setValue(null))},this.onSelectIcon=function(event){var $$t=$(event.target),old=this.getValue(),value={name:$$t.attr("data-params"),css:$$t.attr("data-css")};if(old&&old.name==value.name&&old.css==value.css)return;this.setValue(value),this.options.onSelectIcon&&this.options.onSelectIcon(value)},this.destroyMarkup=function(){this.$$rootPalette&&(this.$$rootPalette.off(),this.$$rootPalette=null),this.options=null,this.$$clearBtn.off(),this.$$clearBtn=this.$$input=this.$$panel=null},this.getValue=function(){var $$selected=this.$$panel.find(".auth-paletteItem.current");return $$selected.length==0?null:{css:$$selected.attr("data-css")||"",name:$$selected.attr("data-params")||""}},this.setValue=function(icon){this.$$panel.find(".auth-paletteItem.current").removeClass("current"),icon&&this.$$panel.find('[data-params="'+icon.name+'"]').addClass("current"),this.$$input.removeClass().addClass("form-control").empty(),icon?this.$$input.html('<div class="iconIcon '+icon.css+'"></div><div class="iconName">'+icon.name+"</div>"):this.$$input.text(locale.text("auth.components.palette.noicon"))}},select:function(options,name){options=options||{};if(!options.onChange)throw new Error("select component - onChange is mandatory");options.options=options.options||[],options.value==null&&(options.value=Object.keys(options.options)[0]),this.name=name||"select",this.options=options;var optselect={options:options.options||[],css:options.css||""};options.dataSize&&(optselect.dataSize=options.dataSize),this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("select",optselect)).appendTo($$parent),this.$$select=this.$$panel.find("select"),this.$$select.selectpicker(),this.$$select.selectpicker("val",options.value),this.$$select.on("change",jsutils.bindFn(this.onChange,this)),options.isHidden===!0&&this.$$select.selectpicker("hide"),this.$$panel},this.onChange=function(event){this.options.onChange(event,this)},this.destroyMarkup=function(){this.options.onChange=null,this.options=null,this.$$select&&(this.$$select.off(),this.$$select.selectpicker("destroy"),this.$$select=null)},this.getValue=function(){if(!this.$$select)return;return this.$$select.selectpicker("val")},this.setValue=function(value){if(!this.$$select)return;return this.$$select.selectpicker("val",value)},this.update=function(selectOpts,defValue){if(!this.$$select)return;selectOpts=selectOpts||[],this.$$select.find("option").remove();var self=this;selectOpts.forEach(function(v,idx){self.$$select.append('<option value="'+v.value+'">'+v.title+"</option>")}),defValue==null&&selectOpts.length>0&&(defValue=selectOpts[0].value),defValue!=null&&this.$$select.selectpicker("val",defValue),this.$$select.selectpicker("refresh")},this.clear=function(){this.update(null)}},flatRadio:function(options,name){this.name=name||"flatRadio",this.options=options,this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("flatRadio",{btns:this.options.btns})).appendTo($$parent).on("change","input",this.options.onClick),this.$$panel.find('input[value="'+this.options.value+'"]').parent().button("toggle"),this.$$panel},this.destroyMarkup=function(){this.options.onClick=null,this.options=null,this.$$panel&&(this.$$panel.off(),this.$$panel=null)}},switcher:function(options,name){this.name=name||"switcher",this.options=options,this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("switcher",{id:this.options.id})).appendTo($$parent),this.setValue(this.options.checked),this.$$panel.bootstrapSwitch("onText",this.options.onText||locale.text("auth.switcher.onText")),this.$$panel.bootstrapSwitch("offText",this.options.offText||locale.text("auth.switcher.offText")),this.$$panel.bootstrapSwitch("size",this.options.size||"small"),this.$$panel.bootstrapSwitch("onColor",this.options.onColor||"default"),this.$$panel.bootstrapSwitch("offColor",this.options.offColor||"default"),this.options.onSwitchChange&&this.$$panel.bootstrapSwitch("onSwitchChange",jsutils.bindFn(this.onSwitchChange,this)),this.$$panel},this.onSwitchChange=function(event,state){this.options.onSwitchChange(event,state)},this.destroyMarkup=function(){this.options=null,this.$$panel&&(this.$$panel.bootstrapSwitch("destroy"),this.$$panel=null)},this.getValue=function(value){if(!this.$$panel)return;return this.$$panel.bootstrapSwitch("state")},this.setValue=function(value){if(!this.$$panel)return;this.$$panel.bootstrapSwitch("state",value===!0,!0)}},actionBtns:function(options,name){this.name=name||"actionBtns",this.options=options,this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("actionBtns",{btns:this.options.btns})).on("click",this.options.onClick).appendTo($$parent),this.$$panel},this.destroyMarkup=function(){this.options.onClick=null,this.options=null,this.$$panel&&(this.$$panel.off(),this.$$panel=null)}},genericSlider:function(options,name){this.name=name||"genericSlider",this.options=options,this.label=options.label,this.createMarkup=function($$parent){var displayValue=this.options.displayValue||this.options.slideHandler!=null;this.$$panel=$(_getHtml("genericSlider",{value:this.options.value,min:this.options.min,max:this.options.max,step:this.options.step||1,valText:this.options.value!=null?this.options.slideHandler?this.options.slideHandler(this.options.value,this):this.options.value:"",displayValue:displayValue,margin:this.options.margin+""})),$$parent.append(this.$$panel),this.$$textValue=$(".s-m-slider-value",this.$$panel),this.$$slider=$("input",this.$$panel).slider({}),displayValue&&this.$$slider.on("slide",jsutils.bindFn(this.onSlider,this,"slide")),this.options.stopHandler&&this.$$slider.on("slideStop",jsutils.bindFn(this.onSlider,this,"stop")),this.options.startHandler&&this.$$slider.on("slideStart",jsutils.bindFn(this.onSlider,this,"start")),displayValue==="above"&&this.$$panel.find(".s-m-slider-value").detach().prependTo(this.$$panel.find("section"))},this.destroyMarkup=function(){this.options.startHandler=null,this.options.stopHandler=null,this.options.slideHandler=null,this.options=null,this.$$slider&&(this.$$slider.off(),this.$$slider.slider("destroy"),this.$$slider=null),this.$$panel&&this.$$panel.remove()},this.onSlider=function(slideEvt,action){if(action==="start"){this.options.startHandler(slideEvt.value,this);return}if(action==="slide"){this.$$textValue.text(this.options.slideHandler?this.options.slideHandler(slideEvt.value,this):slideEvt.value);return}if(action==="stop"){this.options.value!=slideEvt.value&&(this.options.value=slideEvt.value,this.options.stopHandler(slideEvt.value,this));return}},this.update=function(opts){if(!opts)return;opts.min!=null&&this.$$slider.slider("setAttribute","min",opts.min),opts.max!=null&&this.$$slider.slider("setAttribute","max",opts.max),opts.step!=null&&this.$$slider.slider("setAttribute","step",opts.step),opts.value!=null&&(this.$$slider.slider("setValue",opts.value),this.$$textValue.text(this.options.slideHandler?this.options.slideHandler(opts.value):opts.value))}},checkboxList:function(options,name){options=options||{},this.options=options,this.name=name||"checkboxList",this.createMarkup=function($$parent){return this.$$panel=$(_getHtml("checkboxList",{id:options.id,css:options.css||""})).appendTo($$parent),options.isHidden===!0&&this.hide(),this.options.onClick&&this.$$panel.on("click",'input[type="checkbox"]',jsutils.bindFn(this.onClick,this)),this._createList(options.list),this.$$panel},this.destroyMarkup=function(){this.$$panel&&(this.$$panel.find('input[type="checkbox"]').off(),this.$$panel.off(),this.$$panel=null),this.options=null},this.onClick=function(evt){var $$input=$(evt.target);this.options.onClick($$input.closest(".s-m-item").attr("data-id"),$$input.is(":checked"))},this.getValue=function(format){if(!this._$$list)return null;var obj=format!=="array",res=obj?{}:[];return this._$$list.find(".s-m-item").each(function(){var $$this=$(this);if(!$$this.is(":visible"))return;var checked=$$this.find("input:checkbox").prop("checked")===!0,id=$$this.attr("data-id");obj?res[id]=checked:res.push({checked:checked,id:id})}),res},this.setValue=function(list){this.updateValue(list)},this.reset=function(){this.updateValue(null)},this.updateValue=function(list){if(!this.$$panel)return;var self=this;self._$$list.find("[data-id]").each(function(){$(this).val(!1)}),list=this._checkInputList(list);if(list.length===0)return;list.forEach(function(itm){if(!itm||!itm.id)return;var $$item=self._$$list.find('[data-id="'+itm.id+'"]');if($$item.length===0)return;itm.isHidden===!0&&$$item.hide(),$$item.attr("data-id",itm.id),$$item.find("input:checkbox").prop("checked",itm.checked===!0),$$item.find("label").text(itm.label)})},this._createList=function(list){if(!this.$$panel)return;this._$$list&&this._$$list.remove(),list=this._checkInputList(list);var newList=[];list.forEach(function(itm){itm.id&&(itm.id=itm.id,itm.checked=itm.checked===!0,itm.label=itm.label||itm.id,newList.push(itm))}),this._$$list=$(_getHtml("checkboxListContent",{list:newList})).appendTo(this.$$panel)},this._arrayToPlainobject=function(){},this._checkInputList=function(list){if(!list)return[];if(Array.isArray(list))return list;if(!$.isPlainObject(list))return[];var res=[];for(var p in list)res.push({id:p,checked:list[p]===!0});return res}}};exports.newComponent=function(type,opts,name){var f=_components[type];if(!f)throw new Error("Unknown authoring component ["+type+"]");return new f(opts,name)}}),define("syracuse-tablet/html/js/authoring/authoringCommons",["require","exports","module","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var modules=require("syracuse-tablet/html/js/common/modules");exports.getCurrentUserLang=function(){var up=modules.get("appController").App.getCurrentUserProfile();return up.selectedLocale.code},exports.getCurrentPage=function(){var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();return currentPage},exports.getCurrentUserUuid=function(){var up=modules.get("appController").App.getCurrentUserProfile();return up.user.$uuid},exports.queryLocalePreferences=function(){return modules.get("ajax").request("/sdata/syracuse/collaboration/syracuse/localePreferences?representation=localePreference.$bulk").then(function(result){return result.data&&result.data.$resources||[]})},exports.getSecurityProfile=function(){var up=modules.get("appController").App.getCurrentUserProfile();return up&&up.securityProfile},exports.isNonSaveablePage=function(){var page=exports.getCurrentPage(),$url=page&&page.pageData&&page.pageData.$url;return $url&&$url.indexOf("/$client/")>-1?!0:!1}}),define("syracuse-tablet/html/js/ui/modals/modalTranslationPage",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalDialog"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),_templateAll={header:'		<buttons class="pull-right"> 			<button type="button" class="btn btn-default s-m-modal-btn-validate" data-action="$validate"></button> 			<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 		</buttons> 		<div class="modal-title">{{title}}</div> 			',content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">				<div class="form-group"> 					<table class="s-m-translation" >					<tr>					<th>{{currentLang.title}}</th><th>{{translateLang.title}}</th>					</tr>					{{#each localizations}}					<tr>					<td>{{this.value}}</td><td><input type="text" id="{{this.key}}" value="{{this.valueTranslate}}"></td>					</tr>					{{/each}}					</table>				</div> 			</div>',footer:""},_Klass=utils.defineClass(function ModalTranslationPage(ctx){this.context=$.extend(!0,{},ctx),modalDialog.ModalBase.call(this),this.result=null},modalDialog.ModalBase,{_getTemplates:function(){return{std:_templateAll}},_getDataContext:function(){var localizations=[],$localization=this.context.$localization,currentLang=this.context.currentLang,translateLang=this.context.translateLang;if(!$localization[currentLang.value])return[];Object.keys($localization[currentLang.value]).forEach(function(key){$localization[currentLang.value][key]&&localizations.push({key:key,value:$localization[currentLang.value][key],valueTranslate:$localization[translateLang.value]&&$localization[translateLang.value][key]?$localization[translateLang.value][key]:""})});var data={};return data.localizations=localizations,data.currentLang=currentLang,data.translateLang=translateLang,data.title=this.context.pageTitle,data},_onShow:function(){modalDialog.ModalBase.prototype._onShow.call(this)},_onValidate:function(){var currentLang=this.context.currentLang.value,translateLang=this.context.translateLang.value,localization=this.context.$localization,value,res;Object.keys(localization[currentLang]).forEach(function(key){value=$("input[id='"+key+"'").val(),localization[translateLang]&&localization[translateLang][key]!==""&&(res||(res={}),res[key]=localization[translateLang][key]);if(!localization[translateLang]&&value!==""||localization[translateLang]&&(localization[translateLang][key]&&value!=localization[translateLang][key]||!localization[translateLang][key]&&value))res||(res={}),res[key]=value}),res&&(localization[translateLang]=res,this.result=localization)},_onCancel:function(){this.result=null},_getResult:function(){return this.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral",["require","exports","module","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/authoring/authoringVal","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/modals/modal","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/modals/modalTranslationPage"],function(require,exports,module){function _createMarkupJSON($$parent,prop,sel,data){var value=authVal.toSortedJSON(data.articlePage),html=authHtml.execute("authPanelPropertyJSON",{id:"auth_opt_"+prop.name,value:value,label_apply:locale.text("auth.panel.label_apply"),label_display:locale.text("auth.panel.label_display")}),$$panel=$(html),title=sel.$$elmt.text(),_getJson=function(validate){var val=$("textarea",$$panel).val(),articleParsed;if(validate)articleParsed=authVal.validateJSON(!0,$("textarea",$$panel).val(),_properties);else try{articleParsed=JSON.parse(val)}catch(e){return jsutils.convertToDiagnoses(e)}return articleParsed?authVal.toSortedJSON(articleParsed):null};$("a[data-action]",$$panel).click(function(){var act=$(this).attr("data-action");try{if(act==="jsonApply"){var articleString=_getJson(!0);articleString&&notifications.publish(["sm.auth.change.prop.ui"],articleString)}else if(act==="openInNewTab"){var title=authCommons.getCurrentPage().getPrototype().getValueByPath("$title",!0);title=title&&title.length>0?locale.text("auth.panel.label_page")+": "+title:"",_openInNewTab("sageMobileJsonAuthoring",_getJson(!1),title)}}catch(e){throw console.log(e.stack),e}}),$$parent.append($$panel)}function _createMarkupPrototype($$parent,prop,sel,data){var json,title;if(data.control)json=data.control.prototype&&data.control.prototype.json,title=data.control.$bind||data.control.id;else if(data.page){var proto=data.page.getPrototype();title=proto.data("$title"),json=proto&&proto.json}var value;json?value=JSON.stringify(json,null," "):value=locale.text("auth.PROTOTYPE_NONE");var html=authHtml.execute("authPanelPropertyPROTOTYPE",{id:"auth_opt_"+prop.name,value:value,label_display:locale.text("auth.panel.label_display")}),$$panel=$(html);$$parent.append($$panel),json&&!$.isEmptyObject(json)&&$("a[data-action]",$$panel).click(function(){var act=$(this).attr("data-action");act==="openInNewTab"&&(title=locale.text("auth.panel.label_"+(data.control?"control":"page"))+": "+title,_openInNewTab("sageMobilePrototype",authVal.toSortedJSON(json),title))})}function getLangDescription(lang,langList){var desc;return langList.forEach(function(v){v.value===lang&&(desc=v.title)}),desc}function _getValueOrDefault(prop,sel,data){var value=data.articleSelection&&data.articleSelection[prop.key];return value=value!=null?value:prop["default"],value}function _setValue(prop,sel,data,value){data.articleSelection[prop.key]=value,data.articleSelection.$isDirty=data.articleSelection.$isDirty||{},data.articleSelection.$isDirty[prop.key]=!0}function _notifyChangePropUI($$parent,sel,data){var $$json=$("textarea#auth_opt_JSON");$$json.val(authVal.toSortedJSON(data.articleSelection)),notifications.publish(["sm.auth.change.item.prop.ui"],data)}function _notifyAuthVariantChange(article){var articleString=authVal.toSortedJSON(article);$("textarea#auth_opt_JSON").val(articleString),notifications.publish(["sm.auth.change.prop.ui"],articleString)}function _createMarkupRadio($$parent,prop,sel,data){var ctx={group:"auth_opt_"+prop.name,options:[]},value=_getValueOrDefault(prop,sel,data),allHidden=!0;prop.values.forEach(function(v){ctx.options.push({id:ctx.group+"_"+v.value,value:""+v.value,label:v.label,display:v.isHidden?"none":"block"}),allHidden=allHidden&&v.isHidden});var html=authHtml.execute("authPanelPropertyRadio",ctx),$$panel=$(html);$("label[data-s-m-auth-value='"+(""+value)+"']",$$panel).eq(0).button("toggle"),$("label",$$panel).on("click",function(e){var $$ct=$(e.currentTarget).closest("[data-s-m-auth-value]"),value=$$ct.attr("data-s-m-auth-value");$$ct.eq(0).button("toggle"),value==="true"?value=!0:value==="false"&&(value=!1),_setValue(prop,sel,data,value),_notifyChangePropUI($$parent,sel,data)}),$$parent.append($$panel),allHidden?$$parent.parent(".s-m-panel-auth-prop").hide():$$parent.parent(".s-m-panel-auth-prop").show()}function _refreshMarkupRadio($$parent,prop,sel,data){var allHidden=!0;prop.values.forEach(function(v){var id="auth_opt_"+prop.name+"_"+v.value,$$btn=$("#"+id,$$parent),display=v.isHidden?"none":"block";$$btn.css("display",display),allHidden=allHidden&&v.isHidden}),allHidden?$$parent.parent(".s-m-panel-auth-prop").hide():$$parent.parent(".s-m-panel-auth-prop").show()}function _createMarkupCheckboxes($$parent,prop,sel,data){var ctx={group:"auth_opt_"+prop.name,options:[]},allHidden=!0,value=data.articleSelection&&data.articleSelection[prop.key]||{};prop.values.forEach(function(v){var cb=value[v.key]!=null?value[v.key]:v["default"];ctx.options.push({id:ctx.group+"_"+v.key,value:v.key,label:v.label,checked:cb,display:v.isHidden?"none":"block"}),allHidden=allHidden&&v.isHidden});var html=authHtml.execute("authPanelPropertyCheckbox",ctx),$$panel=$(html);$("label",$$panel).on("click",function(e){var $$ct=$(e.target).closest("[data-s-m-auth-value]"),key=$$ct.attr("data-s-m-auth-value"),$$cb=$("i",$$ct),value=$("i",$$ct).toggleClass("fa-check-square").is(".fa-check-square"),v=data.articleSelection[prop.key]=data.articleSelection[prop.key]||{};v[key]=value,_notifyChangePropUI($$parent,sel,data)}),$$parent.append($$panel),allHidden?$$parent.parent(".s-m-panel-auth-prop").hide():$$parent.parent(".s-m-panel-auth-prop").show()}function _refreshMarkupCheckboxes($$parent,prop,sel,data){var allHidden=!0;prop.values.forEach(function(v){var id="auth_opt_"+prop.name+"_"+v.key,$$btn=$("#"+id,$$parent),display=v.isHidden?"none":"block";$$btn.css("display",display),allHidden=allHidden&&v.isHidden}),allHidden?$$parent.parent(".s-m-panel-auth-prop").hide():$$parent.parent(".s-m-panel-auth-prop").show()}function _createMarkupIconPicker($$parent,prop,sel,data){var value=data.articleSelection&&data.articleSelection[prop.key]||null,opts={palette:prop.values||[],dropUp:prop.dropUp||!0,onSelectIcon:function(value){_setValue(prop,sel,data,value),_notifyChangePropUI($$parent,sel,data)}};prop._paletteIcon=authComponents.newComponent("iconPalettePicker",opts),prop._paletteIcon.createMarkup($$parent),prop._paletteIcon.setValue(data.articleSelection[prop.key]||prop["default"])}function _destroyMarkupIconPicker($$parent,prop,sel,data){prop._paletteIcon&&(prop._paletteIcon.destroyMarkup(),prop._paletteIcon=null)}var authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),authVal=require("syracuse-tablet/html/js/authoring/authoringVal"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),modal=require("syracuse-tablet/html/js/ui/modals/modal"),locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),modules=require("syracuse-tablet/html/js/common/modules"),modalTranslationPage=require("syracuse-tablet/html/js/ui/modals/modalTranslationPage"),_colorPalette=[{title:"primecolor",items:["sagegreen","green","blue","darkgrey","white","black"]},{title:"secondcolor",items:["lightgreen","grey","medium-grey","orange","purple","medium-purple","skyblue"]},{title:"notifcolors",items:["alert","warning"]}],_cachePalette={},_getColorPalette=function(){if(_cachePalette.colorPalette)return _cachePalette.colorPalette;_cachePalette.colorPalette=[];var _scan=function(items,array){return array=array||[],items.forEach(function(item){if(item.items){var items=_scan(item.items);array.push({title:item.title?locale.text("colorsPalette."+item.title):null,items:items})}else if(typeof item=="string"){var id=item.toLowerCase();array.push({id:id,name:locale.textNoFail("colorsPalette.colors."+id)||item.smCapitalize(),css:"s-m-color-"+id})}}),array};return _scan(_colorPalette,_cachePalette.colorPalette)},_getColorValues=function(){if(_cachePalette.colorValues)return _cachePalette.colorValues;_cachePalette.colorValues=[];var _scan=function(items){items.forEach(function(item){item.items?_scan(item.items):typeof item=="string"&&_cachePalette.colorValues.push({value:item.toLowerCase(),label:locale.textNoFail("colorsPalette.colors."+item)||item.smCapitalize()})})};return _scan(_colorPalette),_cachePalette.colorValues},_getColorInfo=function(id){return _cachePalette.colorInfos?_cachePalette.colorInfos[id]:(_cachePalette.colorInfos={},_getColorValues().forEach(function(color){_cachePalette.colorInfos[color.value]={id:color.value,name:color.label,css:"s-m-color-"+color.value}}),_cachePalette.colorInfos[id])},_openInNewTab=function(tabid,jsonString,title){if(!jsonString||jsonString.trim().length===0)return;var myWindow=window.open("about:blank",tabid,undefined,!0);setTimeout(function(){myWindow.document.write("<html><body><pre>"+(title?title+"\n":"")+locale.text("auth.panel.label_date")+": "+(new Date).toLocaleString()+"</pre><pre>"+jsonString+"</pre></body></html>")})},_properties={SEPARATOR:{isSeparatror:!0},JSON:{key:"$JSON",createMarkup:_createMarkupJSON,type:"expert"},PROTOTYPE:{key:"$PROTOYPE",createMarkup:_createMarkupPrototype,type:"expert"},translation:function(controller,sel,data){if(!data.articleSelection.$localization||$.isEmptyObject(data.articleSelection.$localization[authCommons.getCurrentUserLang()]))return null;this.name="translation",this.type="expert",this.createMarkup=function($$parent,prop,sel,data){var self=this;authCommons.queryLocalePreferences().then(function(ls){var selectOpts=[];ls.forEach(function(v){selectOpts.push({title:v.description,value:v.code})});var opts={options:selectOpts,onChange:self.onChange.bind(self,$$parent,data)};self.langList=authComponents.newComponent("select",opts,"selectLang"),self.langList.createMarkup($$parent)})},this.onChange=function($$parent,data,event,componentSelect){var context={};context.$localization=data.articleSelection.$localization,context.currentLang={value:authCommons.getCurrentUserLang(),title:getLangDescription(authCommons.getCurrentUserLang(),componentSelect.options.options)},context.translateLang={value:componentSelect.getValue(),title:getLangDescription(componentSelect.getValue(),componentSelect.options.options)},this.buildPanel($$parent,data,context)},this.buildPanel=function($$parent,data,context){if(this.$$panel==undefined){var html=authHtml.execute("authPanelButton",{label:locale.text("auth.translation.openPage"),css:"s-m-auth-translation-open"});this.$$panel=$(html),this.$$panel.attr("data-action","openTranslation"),$$parent.append(this.$$panel)}else this.$$panel.off("click");var eventData={};eventData.$$parent=$$parent,eventData.data=data,eventData.context=context,eventData.context.pageTitle=locale.text("auth.translation.page"),this.$$panel.click(eventData,function(){var modal=new modalTranslationPage.Modal(eventData.context);modal.show().then(function(result){result&&(eventData.data.articleSelection.$localization=result,_notifyChangePropUI(eventData.$$parent,null,eventData.data))}).fail(function(e){modules.get("modal").error(e)})})}}},_initProperty=function(p){var pre="auth",lk=pre+"."+p.name;p.label==null&&(p.label=locale.text(lk)),p.values&&p.values.forEach(function(v,idx){if($.isPlainObject(v)){var vk=lk+"."+(""+(v.value!=null?v.value:v.key));v.label==null&&(v.label=locale.text(vk))}else p.values[idx]={label:v+"",valu:v}})},_initProperties=function(properties,dest){var pre="auth";Object.keys(properties).forEach(function(prop){var p=properties[prop];dest&&(dest[prop]=p);if(typeof p=="function")return;p.name=prop,_initProperty(p)})},_err=function(title,ee){return modal.error(title,ee),!0};exports.getColorValues=_getColorValues,exports.getColorPalette=_getColorPalette,exports.getColorInfo=_getColorInfo,exports.properties=_properties,exports.err=_err,exports.createMarkupIconPicker=_createMarkupIconPicker,exports.destroyMarkupIconPicker=_destroyMarkupIconPicker,exports.createMarkupRadio=_createMarkupRadio,exports.refreshMarkupRadio=_refreshMarkupRadio,exports.createMarkupCheckboxes=_createMarkupCheckboxes,exports.refreshMarkupCheckboxes=_refreshMarkupCheckboxes,exports.getValueOrDefault=_getValueOrDefault,exports.setValue=_setValue,exports.notifyAuthVariantChange=_notifyAuthVariantChange,exports.notifyChangePropUI=_notifyChangePropUI,exports.initProperties=_initProperties,exports.initProperty=_initProperty,exports.getModuleProperties=function($$elmt,controller,props,sel,data){props.push(_properties.SEPARATOR),$$elmt.is(".s-m-page")?(props.push(_properties.JSON),props.push(_properties.SEPARATOR),props.push(_properties.PROTOTYPE),props.push(_properties.SEPARATOR),props.push(_properties.translation)):data&&data.control&&data.control.prototype&&props.push(_properties.PROTOTYPE)},exports.initModuleProperties=function(dest){exports.initProperties(_properties,dest)}}),define("syracuse-tablet/html/js/authoring/arrays/authArrayGeneral",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_templates={subtitle:'		<section class="s-m-prop-subtitle" {{#if id}}id="{{id}}"{{/if}} style="{{#if notHidden}}overflow:hidden;{{/if}}white-space:nowrap;text-overflow:ellipsis;{{#if margin}}margin-bottom:{{margin}}px;{{/if}}">			{{#if title}}<p>{{title}}</p>{{/if}}			<div></div>		</section>',subPropTitle:' 		<div class="panel panel-primary s-m-panel-auth-prop s-m-auth-prop-type-{{type}}"> 			<div style="overflow:hidden;" class="panel-heading" role="tab" id="heading_{{id}}"> 				<a style="width:100%;display:table;" data-toggle="collapse" data-parent="#{{#if parentId}}{{parentId}}{{/if}}{{#unless parentId}}accordion{{/unless}}" href="#collapse_{{id}}" {{#if expanded}} aria-expanded="true"{{/if}} aria-controls="collapse_{{id}}" {{#unless expanded}}class="collapsed"{{/unless}}>					<div style="display:table-row;white-space: nowrap;">						<h4 class="panel-title" style="display:table-cell;"> 							{{label}}						</h4> 						{{#if info}}<span style="padding-left: 10px;font-size:x-small;display:table-cell;text-align: right;"><i>{{info}}</i></span>{{/if}}					</div>				</a> 			</div> 			<div id="collapse_{{id}}" class="panel-collapse collapse {{#if expanded}}in{{/if}}" role="tabpanel" aria-labelledby="heading_{{id}}"> 			</div> 		</div>',statusLine:'		<span style="display:table;table-layout:fixed;width:100%">			<span style="display:table-row;">				<span style="display:table-cell;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;">{{field}} {{operator}} {{value}}</span>				<span class="{{css}}" style="{{style}}display:table-cell;width:{{sizeColor}}px;height:{{sizeColor}}px;margin-right:5px;"></span>			</span>		</span>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)},_properties={chartDetailButton:function(controller,sel,data){this.name=null,this.label=null,this.key=null,this.controller=controller,this.control=data.control,this.createButtonMarkup=function(){var level=this.control.level,label="auth."+(level>0&&this.control.hasSublevel()?"subLevel":"chartDetail")+".openDesign";return this.$$OpenButton=$('<button id="auth_opt_chart_design" type="button" class="btn btn-default">'+locale.text(label)+"</button>"),this.$$OpenButton.on("click",jsutils.bindFn(this.onClickButton,this)),this.$$OpenButton},this.destroyButtonMarkup=function(context){this.control=null,this.controller=null,this.$$OpenButton&&(this.$$OpenButton.off("click"),this.$$OpenButton.remove(),this.$$OpenButton=null)},this.onClickButton=function(evt){var opt=null,level=0;if(this.control.hasSublevel()){level=this.control.level+1;var rowId=this.control.rowIdx2Id(0);opt=this.control.drillDownOpt(rowId),opt.level=level,level>1&&(opt.action="$drillDown")}this.control.triggerOpenChartDetail(opt),this.destroyButtonMarkup()}},arrayDisplay:function(controller,sel,data){this.name="arrayDisplay",this.label=null,this.key="$display",this["default"]="table",this.values=[];var self=this;["table","separator","card","carousel","chart"].forEach(function(val){data.control.isAuthoringPropAllowed("arrayDisplay",val)&&self.values.push({value:val})}),this.createMarkup=authPropsGeneral.createMarkupRadio,this.refreshMarkup=authPropsGeneral.refreshMarkupRadio},arraySeparator:{key:"$separator","default":"blank",values:[{value:"blank"},{value:"dash"},{value:"colon"},{value:"semicolon"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio},arrayProtoFilters:function(controller,sel,data){this.name="arrayProtoFilters",this.label=null,this.key="$filters",this["default"]=data.control.page.isVignette()?"none":"list",this.values=[{value:"list"},{value:"tabs"},{value:"none"}],this.createMarkup=authPropsGeneral.createMarkupRadio,this.refreshMarkup=authPropsGeneral.refreshMarkupRadio},arrayQueryLink:function(controller,sel,data){this.name="arrayQueryLink",this.label=null,this.isHidden=!0,this.values=[],this.key="$detailsLink",this["default"]="$details",this.createMarkup=authPropsGeneral.createMarkupRadio,this.refreshMarkup=authPropsGeneral.refreshMarkupRadio,this.initMarkup=function(controller,sel,data){var links=data.control.prototype.getValueByPath("$item.$links");if(!links||links.length===0)return;data.control.page.isVignette()&&(this["default"]="$queryfullpage",this.values.push({value:"$queryfullpage",label:locale.text("auth.arrayQueryLink.queryfullpage")}));var self=this;$.each(links,function(key,link){var method=link&&link.$method||"GET";link&&method==="GET"&&(key.indexOf("$")!==0||["$edit","$details"].indexOf(key)>-1)&&self.values.push({value:key,label:link.$title?controller.dataset.resolveExpression(link.$title)+" - "+key:key})}),this.isHidden=this.values.length===1&&this.values[0].value==="$details"}},arrayOptions:function(controller,sel,data){this.name="arrayOptions",this.label=null,this.key="$arrayOptions";var ctrl=data.control,isVignette=data.control.page.isVignette();this.values=[],ctrl.isArrayChart()&&ctrl.isHighChart()?this.values.push({key:"showPagination","default":!1}):(ctrl.isArrayField()||(this.values.push({key:"showPagination","default":isVignette?!1:!0}),ctrl.isArrayChart()||(ctrl.filterSort!=null&&this.values.push({key:"showSortFilter","default":isVignette?!1:!0}),ctrl.filterSearch!=null&&this.values.push({key:"showSearch","default":isVignette?!1:!0}))),ctrl.$display==="table"&&!ctrl.isSingleArray()&&!ctrl.isArrayChart()&&!controller.dataset.prototype.isQueryLikeFacet()&&this.values.push({key:"showRowDetailLink","default":!1}),this.values.push({key:"rowIndex","default":ctrl.$display==="card"}),ctrl.$display==="card"&&this.values.push({key:"hideEmptyRows","default":!1})),this.createMarkup=authPropsGeneral.createMarkupCheckboxes,this.refreshMarkup=authPropsGeneral.refreshMarkupCheckboxes}};exports.getHtml=_getHtml,exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){props.push(_properties.arrayDisplay),data.control.isSingleArray()?data.control.$display==="separator"&&props.push(_properties.arraySeparator):(data.control.displayAsCarousel!==!0&&props.push(_properties.arrayOptions),!sel.$$elmt.is(".s-m-control.s-m-chart")&&data.control.displayAsCarousel!==!0&&(data.control.$filtersAllowed()&&props.push(_properties.arrayProtoFilters),controller.dataset.prototype.isQuery()&&props.push(_properties.arrayQueryLink)))}}),define("syracuse-tablet/html/js/authoring/arrays/authArrayTable",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/arrays/authArrayGeneral","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authArrayGeneral=require("syracuse-tablet/html/js/authoring/arrays/authArrayGeneral"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),utils=require("syracuse-tablet/html/js/helpers/utils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_maxCharWidth=50,_defCharWidth=20,_defPercentWidth=20,_tableConfigKeys=["$bind","$type","$titleOrig","$widthType","$widthVal","$refValueDisplay","$refDescFormat","$refDescPosition","$imgIcon","$imgDisplayIcon","$imgHeight"],_TableColumnPanel=function(parent,colInfo){this.name="arrayTableColumn",this.label=colInfo.$title||colInfo.$bind,this.parent=parent,this.colInfo=colInfo;if(parent.isSingleArray||!this.colInfo.$widthType)this.colInfo.$widthType="auto";this._myProperties=[],this.createMarkup=function($$parent){this.$$parent=$$parent,parent.isSingleArray||(this.colNameChoiceAdd(),this.colWidthTypeAdd(),this.colWidthValAdd()),this.colXrefAdd(),this.colImageAdd(),this.colImgHeightAdd()},this._add2PropHeading=function(title,prop,$$forceParent){var $$root=$(authArrayGeneral.getHtml("subtitle",{title:title,margin:10,id:prop.name})).appendTo($$forceParent||this.$$parent).find("div");return prop.name==="selectName"&&$$root.css({textOverflow:"inherit"}),prop.createMarkup?(prop.createMarkup($$root),this._myProperties.push(prop)):prop.jquery&&$$root.append(prop),prop},this.colNameChoiceAdd=function(){var idx=this.parent.getFieldProto(this.colInfo.$bind).idx,selectOpts=[];this.parent._protoValue.forEach(function(v){selectOpts.push({title:v.$title,value:v.$bind})});var opts={value:this.colInfo.$bind,options:selectOpts,onChange:jsutils.bindFn(this.colNameSelect,this)};this._add2PropHeading(locale.text("auth.tableDesign.selColName"),authComponents.newComponent("select",opts,"selectName"))},this.colNameSelect=function(event,prop){this.colInfo=this.parent.getFieldProto($(event.target).val()).value;var $$title=prop.$$panel.closest(".panel-primary").find(".panel-title");$$title.text(this.colInfo.$title),$$title.next("span").find("i").text(this.colInfo?this.colInfo.$bind:""),this.$$xrefroot.toggle(this.colInfo.$type==="application/x-reference"),this.$$imageroot.toggle(this.colInfo.$type==="image")},this.colWidthTypeAdd=function(){this._add2PropHeading(locale.text("auth.tableDesign.width"),authComponents.newComponent("flatRadio",{btns:[{value:"auto",title:locale.text("auth.tableDesign.auto")},{value:"fixed",title:locale.text("auth.tableDesign.fixed")},{value:"percent",title:"%"}],onClick:jsutils.bindFn(this.colWidthTypeChanged,this),value:this.colInfo.$widthType||"auto"}))},this.colWidthTypeChanged=function(evt){$(evt.target).val()!==this.colInfo.$widthType&&(this.colInfo.$widthType=$(evt.target).val(),this.colWidthValUpdt())},this.colWidthValAdd=function(){var opts={slideHandler:jsutils.bindFn(this.colWidthValSlide,this),stopHandler:jsutils.bindFn(this.colWidthValChange,this),value:this.colInfo.$widthVal||0,min:0,max:this.colInfo.$widthType==="percent"?100:_maxCharWidth,margin:0};this.propWidthVal=this._add2PropHeading(locale.text("auth.tableDesign.selWidth"),authComponents.newComponent("genericSlider",opts)),this.colWidthValUpdt(opts.value)},this.colWidthValSlide=function(val,prop){return this.colInfo.$widthType==="percent"?val+"%":val+" "+locale.text("auth.tableDesign.characters")},this.colWidthValChange=function(val,prop){this.colInfo.$widthVal=val},this.colWidthValUpdt=function(forceValue){var show=this.colInfo.$widthType!=="auto";this._toggleProp(this.propWidthVal,show);if(!show)return;this.propWidthVal.update({value:forceValue||(this.colInfo.$widthType==="percent"?_defPercentWidth:_defCharWidth),max:this.colInfo.$widthType==="percent"?100:_maxCharWidth})},this.colXrefAdd=function(){var style=this.colInfo.$type!=="application/x-reference"?"display:none":"";this.$$xrefroot=$('<section class="xrefColumn" style="'+style+'" ></section>').appendTo(this.$$parent);var displayValue=this.colInfo.$refValueDisplay===!1?!1:!0;this._xrefDisplayValue=this._createXRefSelect("dispVal",[!0,!1],displayValue);var pos=this.colInfo.$refDescPosition||"bottom";this._xrefDescrPos=this._createXRefSelect("pos",["bottom","right","left","top","none"],pos),this._xrefDescrFmt=this._createXRefSelect("fmt",["desc","title","desctitle","titledesc"],this.colInfo.$refDescFormat||"desc"),this.$$xrefroot.find("#selectDescrfmt").toggle(pos!=="none"),this.$$xrefroot.find("#selectDescrpos").toggle(displayValue)},this._createXRefSelect=function(type,codes,def){var selectOpts=[],defIdx=codes.indexOf(def);defIdx==-1&&(defIdx=0);var textRoot="auth."+(type=="fmt"?"refDescFormat":type=="dispVal"?"refValueDisplay":"refDescPosition");codes.forEach(function(code,idx){selectOpts.push({code:code,title:locale.text(textRoot+"."+code),value:idx})});var opts={value:defIdx,options:selectOpts,onChange:jsutils.bindFn(this.colXrefChange,this,type)};return this._add2PropHeading(locale.text(textRoot),authComponents.newComponent("select",opts,"selectDescr"+type),this.$$xrefroot),selectOpts},this.colXrefChange=function(event,prop,type){var idx=parseInt($(event.target).val(),10),ref=type==="fmt"?this._xrefDescrFmt:type==="dispVal"?this._xrefDisplayValue:this._xrefDescrPos;ref=ref[idx].code,type=="dispVal"&&this.$$xrefroot.find("#selectDescrpos").toggle(ref),type=="pos"&&this.$$xrefroot.find("#selectDescrfmt").toggle(ref!=="none"),this.colInfo["$ref"+(type==="fmt"?"DescFormat":type=="dispVal"?"ValueDisplay":"DescPosition")]=ref},this.colImageAdd=function(){var style=this.colInfo.$type!=="image"?"display:none":"";this.$$imageroot=$('<section class="ximageColumn" style="'+style+'" ></section>').appendTo(this.$$parent);var displayIcon=this.colInfo.$imgDisplayIcon===!0,opts={checked:displayIcon,size:"small",onSwitchChange:this.onImgDisplayIconChanged.bind(this)};this._add2PropHeading(locale.text("auth.imgcol.displayIcon"),authComponents.newComponent("switcher",opts),this.$$imageroot),opts={palette:fontUtils.getColImageIconList(),dropUp:!0,icon:this.colInfo.$imgIcon||fontUtils.getColImageDefIcon(),onSelectIcon:this.onImgIconChanged.bind(this)},this.propImageIcon=this._add2PropHeading(locale.text("auth.imgcol.iconPicker"),authComponents.newComponent("iconPalettePicker",opts),this.$$imageroot),this._toggleProp(this.propImageIcon,displayIcon)},this.onImgIconChanged=function(icon){this.colInfo.$imgIcon=icon},this.onImgDisplayIconChanged=function(event,status){this.colInfo.$imgDisplayIcon=status,this._toggleProp(this.propImageIcon,status)},this.colImgHeightAdd=function(){var opts={value:this.colInfo.$imgHeight||"medium",options:[],onChange:jsutils.bindFn(this.imgHeightSelect,this)};["xsmall","small","medium","large","xlarge"].forEach(function(s){opts.options.push({title:locale.text("auth.imgHeight."+s),value:s})});var prop=this._add2PropHeading(locale.text("auth.imgHeight"),authComponents.newComponent("select",opts));this._toggleProp(prop,this.colInfo.$type==="image")},this.imgHeightSelect=function(event,prop,type){this.colInfo.$imgHeight=$(event.target).val()},this._toggleProp=function(prop,show){return prop.$$panel.closest("section.s-m-prop-subtitle").toggle(show)},this.destroyMarkup=function(){this.parent=null,this.colInfo=null,this._myProperties&&(this._myProperties.forEach(function(p){p.destroyMarkup&&p.destroyMarkup()}),this._myProperties=null),this.$$parent&&(this.$$parent.closest(".s-m-panel-auth-prop").remove(),this.$$parent=null)}},_properties={arrayTableHeader:{key:"$tableHeaderShow","default":!0,values:[{value:!0},{value:!1}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio},arrayTableDesign:function(controller,sel,data){this.isHidden=!1,this.name="arrayTableDesign",this.label=null,this.key="$table",this.controller=controller,this.ctrlArray=data.control,this._generalProperties=[],this._columnProperties=[],this._protoValue=[],this.initMarkup=function(controller,sel,data){this._protoValue=this.ctrlArray.getColumnsInfo(!0),this.isSingleArray=this.ctrlArray.isSingleArray()||this._protoValue.length<=1,this._orginalValue=data.articleSelection.$table;var hasValue=this._orginalValue!=null&&this._orginalValue.length>0;hasValue||(this._orginalValue=null),this._initProps(hasValue?this._orginalValue:this._protoValue),this.isSingleArray?this.isHidden=this._protoValue.length===0||this._protoValue[0].$type!=="application/x-reference":this.addPropNbColumns(),this.isHidden||this.addPropActionButtons(sel,data)},this._initProps=function(props,createEntry){var self=this;self._columnProperties=[],props.forEach(function(prop){self._createColumnProperty(prop,createEntry)})},this.addPropNbColumns=function(){var opts={slideHandler:function(val){return val+" columns"},stopHandler:jsutils.bindFn(this.updateColumns,this),value:this._columnProperties.length,min:1,max:this._protoValue.length,displayValue:"above"};this._generalProperties.push(authComponents.newComponent("genericSlider",opts,"nbcolumns"))},this._updateNbCols=function(){var prop;this._generalProperties.some(function(p){if(p.name==="nbcolumns")return prop=p,!0}),prop.update({value:this._columnProperties.length})},this.addPropActionButtons=function(sel,data){var btns=[{value:"save",title:locale.text("auth.tableDesign.save")}];this._generalProperties.push(authComponents.newComponent("actionBtns",{btns:btns,onClick:jsutils.bindFn(this.onClickAction,this,sel,data)}))},this.onClickAction=function(evt,sel,data){var action=$(evt.target).val();if(action==="save"){var value=[],entry,self=this,conf;this._columnProperties.forEach(function(prop){if(!prop.colInfo)return;entry={},_tableConfigKeys.forEach(function(p){if(p!=="$titleOrig"||utils.isExpression(prop.colInfo[p]))conf=prop.colInfo[p],conf!=null&&(entry[p]=$.isPlainObject(conf)?$.extend(!0,{},conf):conf)}),value.push(entry)}),authPropsGeneral.setValue(this,sel,data,value),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data);return}if(action==="restore"){if(this._orginalValue){this._clearColumns(),this._initProps($.extend(!0,[],this._orginalValue),!0),this._updateNbCols();return}action="all"}if(action==="all"){this.updateColumns(null),this._updateNbCols();return}},this.createMarkup=function($$parent,prop,sel,data){this.$$parent=$$parent,this._accordionId=utils.UUID(),this.$$myAccordion=$('<div id="'+this._accordionId+'" ></div>'),$$parent.append(this.$$myAccordion);var self=this,$$entry;self._generalProperties.forEach(function(prop){$$entry=$(authArrayGeneral.getHtml("subtitle",{title:prop.label?prop.label||prop.name:null})),prop.createMarkup($$entry.find("div")),self.$$myAccordion.append($$entry)}),self._columnProperties.forEach(function(prop){self._createColEntry(prop)})},this._createColEntry=function(prop){var id=utils.UUID(),$$parent;if(!this.isSingleArray){var $$propGroup=$(authArrayGeneral.getHtml("subPropTitle",{id:id,type:"child columns",label:prop.label,info:prop.colInfo?prop.colInfo.$bind:null,expanded:!1,parentId:this._accordionId}));$$parent=$$propGroup.find("#collapse_"+id),this.$$myAccordion.append($$propGroup)}else this.$$myAccordion.append($$propGroup),$$parent=$('<div style="padding-left:10px;padding-right:10px;"></div>').appendTo(this.$$myAccordion);prop.createMarkup($$parent)},this.destroyMarkup=function(){this.$$parent=null,this.ctrlArray=null,this.controller=null,this._getAllProps().forEach(function(p){p.destroyMarkup()}),this._generalProperties=null,this._columnProperties=null},this._getAllProps=function(){return(this._generalProperties||[]).concat(this._columnProperties||[])},this.updateColumns=function(nbCols){this.$$myAccordion&&this.$$myAccordion.find(".collapse").collapse("hide");var init=nbCols==null;nbCols=init?this._protoValue.length:nbCols;var startFrom=0;if(init)this._clearColumns();else if(this._columnProperties.length>0){for(var i=this._columnProperties.length-1;i>=nbCols;i--)this._columnProperties[i].destroyMarkup(),this._columnProperties.splice(i,1);startFrom=this._columnProperties.length}for(var i=startFrom;i<nbCols;i++)this._createColumnProperty(this._protoValue[i],!0)},this._createColumnProperty=function(config,createEntry){var proto=this.getFieldProto(config.$bind,!0);if(!proto)return null;config.$title=this.controller.dataset.prototype.resolveExpression(proto.value.$title)||config.$bind,config.$type=proto.value.$type,config.$titleOrig=proto.value.$titleOrig;var prop=new _TableColumnPanel(this,config);return this._columnProperties.push(prop),createEntry&&this._createColEntry(prop),prop},this._clearColumns=function(){this._columnProperties&&this._columnProperties.forEach(function(p){p.destroyMarkup()}),this._columnProperties=[]},this.getProtoValByIdx=function(idx){if(idx<0||idx>=this._protoValue.length)throw new Error("unexpected bad index["+idx+"]");return this._protoValue[idx]},this.getFieldProto=function(bind,noFail){var res=null;this._protoValue.some(function(v,idx){if(v.$bind===bind)return res={idx:idx,value:v},!0});if(res==null&&noFail!==!0)throw new Error("unexpected null value - bind=["+bind+"]");return res}}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){data.control.isSingleArray()||props.push(_properties.arrayTableHeader),props.push(_properties.arrayTableDesign)}}),define("syracuse-tablet/html/js/authoring/arrays/authArrayCard",["require","exports","module","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_properties={arrayCardsPerRow:{key:"$cardsPerRow","default":"2",values:[{value:"1"},{value:"2"},{value:"3"},{value:"4"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio},arrayBgColor:{key:"$arrayBgColor","default":"",colorChange:function(value,sel,data,prop){authPropsGeneral.setValue(this,sel,data,value?value.id:""),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},createMarkup:function($$parent,prop,sel,data){var opts={color:"",palette:authPropsGeneral.getColorPalette(),dropUp:!1,onSelectColor:jsutils.bindFn(this.colorChange,this,sel,data,prop)};this.paletteColor=authComponents.newComponent("colorPalettePicker",opts),this.paletteColor.createMarkup($$parent),this.paletteColor.setValue(authPropsGeneral.getColorInfo(data.control.article.$arrayBgColor))}},arrayCardsMinWidth:function(controller,sel,data){this.name="arrayCardsMinWidth",this.label=null,this.key="$minWidth",this["default"]=1,this.min=0,this.max=20,this.step=1,this.createMarkup=function($$parent,prop,sel,data){this.ctrl=data.control,this.$$parent=$$parent,this.originValue=authPropsGeneral.getValueOrDefault(this,sel,data);var opts={id:"auth_opt_"+this.name,value:this.originValue,min:this.min,max:this.max,step:this.step||1,slideHandler:jsutils.bindFn(this.onSlide,this,"slide"),startHandler:jsutils.bindFn(this.onSlide,this,"start"),stopHandler:jsutils.bindFn(this.onSlide,this,"stop",sel,data)};this._slider=authComponents.newComponent("genericSlider",opts),this._slider.createMarkup($$parent)},this.onSlide=function(value,prop,action,sel,data){var res=this.ctrl.authOnSlideMinSize(value,action);if(action==="slide")return res;action==="stop"&&this.originValue!=value&&(authPropsGeneral.setValue(this,sel,data,value),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data))},this.destroyMarkup=function(){this.ctrl=null,this.$$parent=null,this.$$slider&&(this.$$slider.slider("destroy"),this.$$slider=null)},this._sliderSetValue=function(slideEvt,$$parent,sel,data,originValue){this.ctrl.authOnSlideMinSize(slideEvt,"stop"),originValue!=slideEvt.value&&(authPropsGeneral.setValue(this,sel,data,slideEvt.value),authPropsGeneral.notifyChangePropUI($$parent,sel,data))}},arrayCardsEmptyCells:{key:"$emptycell","default":"nodisplay",values:[{value:"filled"},{value:"withtitle"},{value:"nodisplay"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){data.control.isSingleArray()||props.push(_properties.arrayCardsPerRow,_properties.arrayCardsMinWidth,_properties.arrayCardsEmptyCells,_properties.arrayBgColor)}}),define("syracuse-tablet/html/js/authoring/arrays/authArrayStatus",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/arrays/authArrayGeneral","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/fieldOperators","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authArrayGeneral=require("syracuse-tablet/html/js/authoring/arrays/authArrayGeneral"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),utils=require("syracuse-tablet/html/js/helpers/utils"),fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_noValue="$$novalue$$",_properties={arrayStatusEnabled:function(controller,sel,data){this.key="$statusEnabled",this.name="arrayStatusEnabled",this["default"]="none",this.values=[{value:"none"},{value:"mono"}],data.control.$display==="card"&&this.values.push({value:"multi"}),this.createMarkup=authPropsGeneral.createMarkupRadio,this.refreshMarkup=authPropsGeneral.refreshMarkupRadio},arrayStatus:function(controller,sel,data){this.name="arrayStatus",this.label=null,this["default"]=null,this.key="$status",this.ctrlArray=data.control,this.isTable=(this.ctrlArray.article.$display||"table")==="table",this._myProperties=[],this.initMarkup=function(controller,sel,data){this._protoValue=this.ctrlArray.getColumnsInfo();var authStatus=data.articleSelection[this.key]||[];this.statusList=[];var self=this,proto;authStatus.forEach(function(c){proto=self.getFieldProto(c.field),proto!=null&&(c=$.extend(!0,{},c),c.id=utils.UUID(),self.statusList.push(c))})},this.getFieldProto=function(bind){var res=null;return this._protoValue.some(function(v,idx){if(v.$bind===bind)return res=v,!0}),res},this.getRecordInfo=function(id){if(!id)return null;var idx=-1,rec=null;return this.statusList.some(function(c,i){if(c.id===id)return rec=c,idx=i,!0}),idx===-1?null:{record:rec,idx:idx}},this.destroyMarkup=function(){this.ctrl=null,this.$$parent=null,this._protoValue=null,this.ctrlArray=null,this._myProperties&&(this._myProperties.forEach(function(p){p.destroyMarkup&&p.destroyMarkup()}),this._myProperties=null)},this.createMarkup=function($$parent,prop,sel,data){this.ctrl=data.control,this.$$parent=$$parent,this.statusListAdd(sel,data),this.editSectionAdd()},this.statusListAdd=function(sel,data){var opts={css:"statuslist",doAction:jsutils.bindFn(this.listCallBackAction,this,sel,data),appendTitle:locale.text("auth.arrayStatus.append")};this.listStatusDisplayer=authComponents.newComponent("editableList",opts),this._addParam("statuslist",this.listStatusDisplayer,!0),this.updateStatusList()},this.editSectionAdd=function(){this.editStatusSection=this._addSubSection("editstatus"),this.editStatusSection.$$panel.hide(),this.editStatusSection.$$content.css("padding-left","7px"),this.editStatusSection.$$title.css("font-weight","bold");var $$rootComponents=this.editStatusSection.$$content;this.paramFieldAdd($$rootComponents),this.paramOperatorAdd($$rootComponents),this.paramValueAdd($$rootComponents),this.paramColorAdd($$rootComponents),this.paramIconAdd($$rootComponents)},this.listCallBackAction=function(action,recordId,listStatusDisplayer,sel,data){if(action==="append")return this._updateParams(null),!0;if(action==="cancel")return this._resetParams(),this.editStatusSection.$$panel.hide(),!0;var recInfo=this.getRecordInfo(recordId);if(action==="validate"){var newRecord=this.validateRecord(!0);return newRecord?(recInfo==null?this.statusList.push(newRecord):(this.statusList.splice(recInfo.idx,1),this.statusList.splice(recInfo.idx,0,newRecord)),this.updateStatusList(!0,sel,data),this._resetParams(),!0):!1}if(action==="deleteItem")return recInfo?(this.statusList.splice(recInfo.idx,1),this.updateStatusList(!0,sel,data),!0):!1;if(action==="editItem")return recInfo?(this._updateParams(recInfo.record),!0):!1},this.validateRecord=function(errorMsg){var self=this,_fail=function(msg){if(errorMsg===!0){var text=msg||locale.text("auth.arrayStatus.invalid");self.listStatusDisplayer.toggleMessage(text,"error"),setTimeout(function(){self.listStatusDisplayer.toggleMessage(null)},2500)}return null},rec={};rec.field=this.fieldSelector.getValue(),rec.operator=this.operatorSelector.getValue();var proto=this.getFieldProto(rec.field);if(!proto)return _fail();rec.$type=proto.$type,rec.$format=proto.$format,rec.$type==="application/x-boolean"?rec.value=this.componentBoolVal.getValue():rec.value=this.$$valueElmt.val()||"";var formatter=formatApi.getFormatter(rec.$type,proto.$format);if(formatter){var errors=[];rec.value=formatter.parseValue(rec.value,errors);if(errors.length>0)return _fail(errors.join(""));rec.value!=null&&rec.value!=this.$$valueElmt.val()&&this.$$valueElmt.val(formatter.formatValueEdit(rec.value))}return rec.$type=="application/x-reference"&&(rec.value=(rec.value||"").toUpperCase()),this.paletteColor&&(rec.color=this.paletteColor.getValue()),this.paletteIcon&&(rec.icon=this.paletteIcon.getValue()),rec.id=utils.UUID(),rec.field==_noValue||rec.operator==_noValue||rec.color==null?_fail():rec},this._updateParams=function(record){var edit=record!=null;record=record||{},this.editStatusSection.$$panel.show(),this.fieldSelector.setValue(record.field||_noValue),this.updateOperators(record.$type,record.operator||_noValue),this.paletteColor&&this.paletteColor.setValue(record.color),this.paletteIcon&&this.paletteIcon.setValue(record.icon);var val=record.value;if(val!=null){var formatter=formatApi.getFormatter(record.$type,record.$format);val=formatter?formatter.formatValueEdit(val):val}var isBool=record.$type==="application/x-boolean";this.$$valSection.toggle(!isBool),this.$$boolValSection.toggle(isBool),this.componentBoolVal.setValue(isBool&&val===!0),this.$$valueElmt.val(isBool||val==null?"":val)},this._resetParams=function(){this.editStatusSection.$$panel.hide(),this.fieldSelector.setValue(_noValue),this.operatorSelector.clear(),this.paletteColor.setValue(""),this.$$valueElmt.val("")},this.updateStatusList=function(updateAuthoring,sel,data){var clearBefore=!0;clearBefore&&this.listStatusDisplayer.clear();var records=[],style,css;this.statusList.forEach(function(c){c.icon?(css=c.icon.css,style="color:"+c.color.bgColor+";font-size:1.4em;"):(css=c.color?c.color.css:"",style=""),records.push({titleHtml:authArrayGeneral.getHtml("statusLine",{field:c.field,operator:c.operator,value:c.value,css:css,style:style,sizeColor:15}),id:c.id})}),this.listStatusDisplayer.insertRecords(records);if(updateAuthoring==1){var value=[];this.statusList.forEach(function(c){c=$.extend(!0,{},c),delete c.id,value.push(c)}),authPropsGeneral.setValue(this,sel,data,value),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data);return}},this.paramFieldAdd=function($$root){var selectOpts=[{title:locale.text("auth.arrayStatus.novalue"),value:_noValue}];this._protoValue.forEach(function(v,idx){fieldOperators.acceptOperator(v.$type)&&selectOpts.push({title:v.$title,value:v.$bind})});var opts={value:_noValue,options:selectOpts,css:"statusField",onChange:jsutils.bindFn(this.onParamFieldSelect,this),isHidden:!1};this.fieldSelector=authComponents.newComponent("select",opts),this._addParam("field",this.fieldSelector,!0,$$root,!0)},this.paramOperatorAdd=function($$root){var opts={value:_noValue,options:[{title:locale.text("auth.arrayStatus.novalue"),value:_noValue}],css:"statusOperator",onChange:jsutils.bindFn(this.onParamOperatorSelect,this),isHidden:!1};this.operatorSelector=authComponents.newComponent("select",opts),this._addParam("operator",this.operatorSelector,!0,$$root,!0),this.updateOperators()},this.paramValueAdd=function($$root){this.$$valueElmt=$('<input class="form-control statusValue"></input>');var opts={size:"small",onText:"True",offText:"False"};this.$$valSection=this._addParam("value",this.$$valueElmt,!0,$$root).hide(),this.componentBoolVal=authComponents.newComponent("switcher",opts),this.$$boolValSection=this._addParam("value",this.componentBoolVal,!0,$$root).hide()},this.paramColorAdd=function($$root){var opts={palette:authPropsGeneral.getColorPalette(),dropUp:!0};this.paletteColor=authComponents.newComponent("colorPalettePicker",opts),this._addParam("color",this.paletteColor,!0,$$root,!0)},this.paramIconAdd=function($$root){var opts={palette:fontUtils.getArrayStatusIconList(),dropUp:!0};this.paletteIcon=authComponents.newComponent("iconPalettePicker",opts),this._addParam("icon",this.paletteIcon,!0,$$root,!1)},this.onParamFieldSelect=function(event,prop){var field=this.getFieldProto($(event.target).val());this.updateOperators(field.$type,"eq"),this.$$valSection.toggle(!this.$$boolValSection.toggle(field.$type==="application/x-boolean").is(":visible"))},this.updateOperators=function(typeField,defValue){defValue=defValue==null?_noValue:defValue;var selectOpts=[{title:locale.text("auth.arrayStatus.novalue"),value:_noValue}],ops=fieldOperators.getOperators(typeField,!0);ops&&ops.forEach(function(v,idx){selectOpts.push({title:v.title,value:v.value})}),this.operatorSelector.update(selectOpts,defValue)},this.onParamOperatorSelect=function(event,prop){},this._addParam=function(prop,component,title,$$parent,mandatory){var $$parent=$$parent||this.$$parent,$$title,$$root;if(title){var res=this._addSubSection(prop,$$parent,mandatory);$$root=res.$$content,$$title=res.$$panel}else $$root=$$parent;if(component==null)throw new Error("unexpected null component");var $$panel;return component.createMarkup?(component.createMarkup($$root),this._myProperties.push(component),$$panel=component.$$panel):component.jquery&&($$root.append(component),$$panel=component),$$title?$$title:$$panel},this._addSubSection=function(textId,$$parent,mandatory){var $$panel=$(authArrayGeneral.getHtml("subtitle",{title:locale.text("auth.arrayStatus."+textId)+(mandatory===!0?"*":""),margin:10,id:"arrayStatus"+textId.smCapitalize()})).appendTo($$parent||this.$$parent);return{$$panel:$$panel,$$content:$$panel.children("div"),$$title:$$panel.children("p")}}}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){if(!controller.dataset.prototype.isLookup()){props.push(_properties.arrayStatusEnabled);var status=data.control.getAuthoring("$statusEnabled");(status==="mono"||status==="multi")&&props.push(_properties.arrayStatus)}}}),define("syracuse-tablet/html/js/authoring/arrays/authArrayCarousel",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),_properties={arrayCarouselPeriod:{key:"$carouselPeriod","default":"none",values:[{value:"none"},{value:"slow"},{value:"normal"},{value:"fast"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){props.push(_properties.arrayCarouselPeriod)}}),define("syracuse-tablet/html/js/authoring/arrays/authoringPropertiesChart",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_err=authPropsGeneral.err,_noValue="$$novalue$$",_templates={subtitle:'		<section {{#if id}}id="{{id}}"{{/if}} style="{{#if notHidden}}overflow:hidden;{{/if}}white-space:nowrap;text-overflow:ellipsis;{{#if margin}}margin-bottom:{{margin}}px;{{/if}}">			{{#if title}}<p>{{title}}</p>{{/if}}			<div></div>		</section>',serieTitle:' 		<div class="panel panel-primary s-m-panel-auth-prop s-m-auth-prop-type-{{type}}"> 			<div style="overflow:hidden;" class="panel-heading" role="tab" id="heading_{{id}}"> 				<a id="serie_{{id}}" style="width:100%;display:table;" data-toggle="collapse" data-parent="#{{#if parentId}}{{parentId}}{{/if}}{{#unless parentId}}accordion{{/unless}}" href="#collapse_{{id}}" {{#if expanded}} aria-expanded="true"{{/if}} aria-controls="collapse_{{id}}" {{#unless expanded}}class="collapsed"{{/unless}}>					<div style="display:table-row;white-space: nowrap;">						<h4 class="panel-title" style="display:table-cell;"> 							{{label}}						</h4> 					</div>				</a> 			</div> 			<div id="collapse_{{id}}" class="panel-collapse collapse {{#if expanded}}in{{/if}}" role="seriepanel" aria-labelledby="heading_{{id}}"> 			</div> 		</div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)},_SeriePanel=function(parent,serieInfo){this.name=serieInfo.name,this.label=serieInfo.$title,this.parent=parent,this.bind=serieInfo.$bind,this.color=serieInfo.color,this.isHidden=serieInfo.isHidden},_properties={chartHeight:{key:"$chartHeight","default":"medium",values:[{value:"xsmall"},{value:"small"},{value:"medium"},{value:"large"},{value:"xlarge"}],createMarkup:authPropsGeneral.createMarkupRadio},chartStyle:function(controller,sel,data){this.name="chartStyle",this.key="$style",this["default"]="line",this._chartGetMeasureCountVisible=function(){var count=data.control.prototype.chartGetNbMeasures();return data.articleSelection.$seriesOptions&&Object.keys(data.articleSelection.$seriesOptions).forEach(function(key){data.articleSelection.$seriesOptions[key].isHidden&&count--}),count},this.values=[{value:"line"},{value:"bar"},{value:"column"}],this._chartGetMeasureCountVisible()===1&&this.values.push({value:"pie"}),this.createMarkup=authPropsGeneral.createMarkupRadio},chartOptions:function(controller,sel,data){var values=[{key:"isTitleHidden","default":!1}],valuesPie=[{key:"isLabelsHidden","default":!1}],valueslineBarColumn=[{key:"isLegendHidden","default":!1},{key:"isGridLineHidden","default":!1},{key:"isXLabelHidden","default":!1},{key:"isXLabelsHidden","default":!1},{key:"isYLabelHidden","default":!1},{key:"isYLabelsHidden","default":!1}];this.name="chartOptions",this.key="$chartOptions",this.values=values.concat(data.articleSelection.$style==="pie"?valuesPie:valueslineBarColumn),this.createMarkup=authPropsGeneral.createMarkupCheckboxes},chartInverted:{key:"$inverted","default":!1,values:[{value:!1},{value:!0}],createMarkup:authPropsGeneral.createMarkupRadio},seriesOptions:function(controller,sel,data){this.name="seriesOptions",this.key="$seriesOptions",this._serieProperties=[],this.initMarkup=function(controller,sel,data){this._protoValue=data.control.prototype.chartGetMeasureInfo(),this._orginalValue=data.articleSelection[this.key];var hasValue=this._orginalValue!=null;this._initProps(hasValue?this._mergeValue():this._protoValue)},this.createMarkup=function($$parent,prop,sel,data){this.$$parent=$$parent,this._accordionId=utils.UUID(),this.$$myAccordion=$('<div id="'+this._accordionId+'" ></div>'),$$parent.append(this.$$myAccordion);var self=this;self._serieProperties.forEach(function(prop){self._createSerieEntry(prop,sel,data)})},this.destroyMarkup=function(){this._serieProperties&&this._serieProperties.forEach(function(prop){prop.destroyMarkup&&prop.destroyMarkup()}),this._serieProperties=null,this.$$parent&&(this.$$parent.closest(".s-m-panel-auth-prop").remove(),this.$$parent=null),this.$$parent&&(this.$$myAccordion=null)},this._mergeValue=function(){var res={},self=this;return Object.keys(self._protoValue).forEach(function(key){res[key]=$.extend(!0,{},self._protoValue[key]),Object.keys(self._orginalValue&&self._orginalValue[key]||{}).forEach(function(prop){res[key][prop]=self._orginalValue[key][prop]})}),res},this._initProps=function(props,createEntry){var self=this;self._serieProperties=[],Object.keys(props).forEach(function(key){self._createSerieProperty(props[key],createEntry)})},this._createSerieProperty=function(prop,createEntry){var prop=new _SeriePanel(this,prop);this._serieProperties.push(prop),createEntry&&this._createSerieEntry(prop)},this._createSerieEntry=function(prop,sel,data){var id=prop.bind,$$parent,$$propGroup=$(_getHtml("serieTitle",{id:id,type:"child",label:prop.label,expanded:!1,parentId:this._accordionId}));$$parent=$$propGroup.find("#collapse_"+id),this.$$myAccordion.append($$propGroup),this.paramHiddenAdd($$parent,sel,data,prop),data.articleSelection.$style!=="pie"&&this.paramColorAdd($$parent,sel,data,prop)},this.paramHiddenAdd=function($$root,sel,data,prop){var opts={size:"small",onText:"True",offText:"False",onSwitchChange:this.onSwitchChange.bind(this,sel,data,prop)};this.componentBoolVal=authComponents.newComponent("switcher",opts),this._addParam(prop,"isHidden",this.componentBoolVal,!0,$$root,!1);var value=this._getPropValue(prop.bind,"isHidden")||!1;this.componentBoolVal.setValue(!value)},this.onSwitchChange=function(sel,data,prop,event,value){var seriesOptions=$.extend(!0,{},data.articleSelection[this.key]);seriesOptions[prop.bind]=seriesOptions[prop.bind]||{},seriesOptions[prop.bind].isHidden=!value,authPropsGeneral.setValue(this,sel,data,seriesOptions),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},this.paramColorAdd=function($$root,sel,data,prop){var opts={color:"",palette:authPropsGeneral.getColorPalette(),dropUp:!0,onSelectColor:jsutils.bindFn(this.colorChange,this,sel,data,prop)};this.paletteColor=authComponents.newComponent("colorPalettePicker",opts);var param=this._addParam(prop,"color",this.paletteColor,!0,$$root,!1);this._getPropValue(prop.bind,"isHidden")&&param.hide(),this.paletteColor.setValue(this._getPropValue(prop.bind,"color"))},this._getPropValue=function(bind,property){var res=null;return this._serieProperties.forEach(function(prop){prop.bind===bind&&(res=prop[property])}),res},this.colorChange=function(value,sel,data,prop){var seriesOptions=$.extend(!0,{},data.articleSelection[this.key]);seriesOptions[prop.bind]=seriesOptions[prop.bind]||{},seriesOptions[prop.bind].color=value,authPropsGeneral.setValue(this,sel,data,seriesOptions),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},this._addParam=function(prop,textId,component,title,$$parent,mandatory){var $$parent=$$parent||this.$$parent,$$title,$$root;if(title){var res=this._addSubSection(prop,textId,$$parent,mandatory);$$root=res.$$content,$$title=res.$$panel}else $$root=$$parent;if(component==null)throw new Error("unexpected null component");var $$panel;return component.createMarkup?(component.createMarkup($$root),this._serieProperties.push(component),$$panel=component.$$panel):component.jquery&&($$root.append(component),$$panel=component),$$title?$$title:$$panel},this._addSubSection=function(prop,textId,$$parent,mandatory){var $$panel=$(_getHtml("subtitle",{title:locale.text("auth.seriesOptions."+textId)+(mandatory===!0?"*":""),margin:10,id:"seriesColor"+prop.bind.smCapitalize()})).appendTo($$parent||this.$$parent);return{$$panel:$$panel,$$content:$$panel.children("div"),$$title:$$panel.children("p")}}},axisLabels:function(controller,sel,data){this.name="axisLabels",this.key="$axisLabels",this.labels=1,this.selectOpts=_getSelectOptions(data.control);if(this.selectOpts.length<=1)return null;this.createMarkup=function($$parent,prop,sel,data){var opts={value:_noValue,options:[{title:"",value:_noValue}].concat(this.selectOpts),onChange:this.onChange.bind(this,$$parent,data)};this.fieldLabelList=authComponents.newComponent("select",opts,"selectLabel"),this.fieldLabelList.createMarkup($$parent),data.articleSelection&&data.articleSelection[this.key]&&data.articleSelection[this.key][this.labels]&&this.fieldLabelList.setValue(data.articleSelection[this.key][this.labels])},this.onChange=function($$parent,data,event,componentSelect){var axisOptions=$.extend(!0,{},data.articleSelection[this.key]);componentSelect.getValue()===_noValue&&axisOptions[this.labels]?delete axisOptions[this.labels]:axisOptions[this.labels]=componentSelect.getValue(),authPropsGeneral.setValue(this,sel,data,axisOptions),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)}}},_getSelectOptions=function(control){var selectOpts=[],measures=control.prototype.chartGetMeasureInfo(),dataset=control.builderContent.getChartDataSet(),$properties=control.prototype.getProperties(function(prop,$bind){return dataset&&dataset.length>0?dataset[0][$bind]!==undefined&&measures[$bind]===undefined:!1});return Object.keys($properties).forEach(function(v){if(!$properties[v].$title){var ids=v.split("_");ids.lenght>=2&&ids[0]==="C"&&($properties[v].$title=($properties[v.substr(2)]?$properties[v.substr(2)].$title:"")+" ("+v+")")}$properties[v].$title&&selectOpts.push({title:$properties[v].$title,value:v})}),selectOpts};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){data.control.chartNeedsHeight&&data.control.chartNeedsHeight()&&props.push(_properties.chartHeight),props.push(_properties.chartStyle,_properties.chartOptions,_properties.seriesOptions,_properties.axisLabels)}}),define("syracuse-tablet/html/js/authoring/arrays/authoringPropertiesArrays",["require","exports","module","syracuse-tablet/html/js/authoring/arrays/authArrayGeneral","syracuse-tablet/html/js/authoring/arrays/authArrayTable","syracuse-tablet/html/js/authoring/arrays/authArrayCard","syracuse-tablet/html/js/authoring/arrays/authArrayStatus","syracuse-tablet/html/js/authoring/arrays/authArrayCarousel","syracuse-tablet/html/js/authoring/arrays/authoringPropertiesChart"],function(require,exports,module){var authArrayGeneral=require("syracuse-tablet/html/js/authoring/arrays/authArrayGeneral"),authArrayTable=require("syracuse-tablet/html/js/authoring/arrays/authArrayTable"),authArrayCard=require("syracuse-tablet/html/js/authoring/arrays/authArrayCard"),authArrayStatus=require("syracuse-tablet/html/js/authoring/arrays/authArrayStatus"),authArrayCarousel=require("syracuse-tablet/html/js/authoring/arrays/authArrayCarousel"),authoringPropertiesChart=require("syracuse-tablet/html/js/authoring/arrays/authoringPropertiesChart");exports.initModuleProperties=function(dest){authArrayGeneral.initModuleProperties(dest),authArrayCard.initModuleProperties(dest),authArrayTable.initModuleProperties(dest),authArrayStatus.initModuleProperties(dest),authArrayCarousel.initModuleProperties(dest),authoringPropertiesChart.initModuleProperties(dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){sel.$$elmt.is(".s-m-control.s-m-chart")?(authArrayGeneral.getModuleProperties($$elmt,controller,props,sel,data),authoringPropertiesChart.getModuleProperties($$elmt,controller,props,sel,data)):(authArrayGeneral.getModuleProperties($$elmt,controller,props,sel,data),data.control.isSingleArray()||(data.control.$display==="card"?data.control.displayAsCarousel?authArrayCarousel.getModuleProperties($$elmt,controller,props,sel,data):authArrayCard.getModuleProperties($$elmt,controller,props,sel,data):data.control.$display==="table"&&authArrayTable.getModuleProperties($$elmt,controller,props,sel,data),authArrayStatus.getModuleProperties($$elmt,controller,props,sel,data)))}}),define("syracuse-tablet/html/js/authoring/authoringPropertiesGauge",["require","exports","module","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"],function(require,exports,module){function _createMarkupGBorderValues($$parent,prop,sel,data){var ctx={};ctx.label_apply=locale.text("auth.g.label_apply");var idMin="s-m-auth-g-borders-min",idMax="s-m-auth-g-borders-max",isProperty=data.articleSelection.$gSetBorderValues==="bind"?!0:!1;if(isProperty){var valMin=data.articleSelection.$gauge.$bindMin,valMax=data.articleSelection.$gauge.$bindMax;ctx.label_tip=locale.text("auth.gBorderValues.label_tip.property"),ctx.label_min=locale.text("auth.gBorderValues.label_min.property"),ctx.label_max=locale.text("auth.gBorderValues.label_max.property");var optionsMin=[],optionsMax=[];optionsMin.push({option_value:"0",selected:valMin==="0"});var proto=data.control.controller.dataset.prototype;if(!(proto&&proto.json&&proto.json.$properties)){_err(locale.text("auth.gBorderValues.err.prototype.title"),locale.text("auth.gBorderValues.err.prototype.msg"));return}$.each(proto.json.$properties,function(bind,value){_isGaugeValuePropertyType(value.$type)&&bind!==data.control.$bind&&bind!==data.articleSelection.$bind&&(optionsMin.push({option_value:bind,selected:valMin===bind}),optionsMax.push({option_value:bind,selected:valMax===bind}))}),ctx.markupMin=authHtml.execute("gaugeSelect",{id:idMin,options:optionsMin}),ctx.markupMax=authHtml.execute("gaugeSelect",{id:idMax,options:optionsMax})}else{var valMin,valMax;data.articleSelection.$gauge.$bindMin&&typeof data.articleSelection.$gauge.$bindMin=="string"?valMin=data.control.controller.dataset.getValue(data.articleSelection.$gauge.$bindMin):valMin=data.articleSelection.$gauge.$bindMin,data.articleSelection.$gauge.$bindMax&&typeof data.articleSelection.$gauge.$bindMax=="string"?valMax=data.control.controller.dataset.getValue(data.articleSelection.$gauge.$bindMax):valMax=data.articleSelection.$gauge.$bindMax,ctx.label_tip=locale.text("auth.gBorderValues.label_tip.input"),ctx.label_min=locale.text("auth.gBorderValues.label_min.input"),ctx.label_max=locale.text("auth.gBorderValues.label_max.input"),ctx.markupMin=authHtml.execute("gaugeBorderInput",{id:idMin,value:valMin}),ctx.markupMax=authHtml.execute("gaugeBorderInput",{id:idMax,value:valMax})}var html=authHtml.execute("authPanelPropertyGBorderValues",ctx),$$panel=$(html);$("button",$$panel).on("click",function(e){var err=!1,vvMin=$(e.target).parent().find("#"+idMin).val(),vvMax=$(e.target).parent().find("#"+idMax).val(),errTitle=locale.text("auth.gBorderValues.err.title");if(!isNaN(parseInt(vvMin),10)&&!isNaN(parseInt(vvMax),10))vvMax<vvMin&&(err=_err(errTitle,locale.text("auth.gBorderValues.err.msg.lowerMax",[vvMax,vvMin])));else{if(typeof vvMin!="string"||typeof vvMax!="string")err=_err(errTitle,locale.text("auth.gBorderValues.err.msg.bothString",[vvMin,vvMax]));vvMin===vvMax&&(err=_err(errTitle,locale.text("auth.gBorderValues.err.msg.samebind")))}err||(data.articleSelection.$gauge.$bindMin=vvMin,data.articleSelection.$gauge.$bindMax=vvMax,authPropsGeneral.notifyChangePropUI($$parent,sel,data))}),$$parent.append($$panel)}function _createMarkupGSegmentsNumbers($$parent,prop,sel,data){var defaultValueLabel=locale.text("auth.gSegmentsNumber.default"),value=data.articleSelection.$gauge.segments?data.articleSelection.$gauge.segments.length:"",options=[];for(var ii=0,jj=maxSegments+1;ii<jj;ii++){var opt={};ii==0?(opt.option_value=defaultValueLabel,opt.selected=value?!0:!1):(opt.option_value=ii,opt.selected=value==ii),options.push(opt)}var ctx={value:authHtml.execute("gaugeSelect",{id:"s-m-auth-g-segnumbers-txt",options:options}),label_apply:locale.text("auth.g.label_apply")},html=authHtml.execute("authPanelPropertyGSegmentsNumber",ctx),$$panel=$(html);$("button",$$panel).on("click",function(e){var vv=$(e.target).prev().val();if(value!=vv){if(vv&&vv!==defaultValueLabel){data.articleSelection.$gauge.segments=data.articleSelection.$gauge.segments||[],data.articleSelection.$gauge.segments.length>vv&&data.articleSelection.$gauge.segments.splice(vv);for(var ii=0,jj=vv;ii<jj;ii++)data.articleSelection.$gauge.segments[ii]=data.articleSelection.$gauge.segments[ii]||{}}else data.articleSelection.$gauge.segments=null;authPropsGeneral.notifyChangePropUI($$parent,sel,data)}}),$$parent.append($$panel)}function _createMarkupGSegmentsConfig($$parent,prop,sel,data){var seg=data.articleSelection.$gauge.segments[prop.segIdx],idRoot="s-m-auth-seg-",idx=prop.segIdx,segInfo={};segInfo.id=idRoot+idx,segInfo.label_valstart=locale.text("auth.gSegmentsConfig.label_valstart"),segInfo.value_valstart=seg.valStart,segInfo.label_valend=locale.text("auth.gSegmentsConfig.label_valend"),segInfo.value_valend=seg.valEnd,segInfo.label_propstart=locale.text("auth.gSegmentsConfig.label_propstart"),segInfo.value_propstart=authHtml.execute("authPanelGaugeSlider",{id:segInfo.id+"-propstart",min:0,max:1,step:.1,value:seg.propStart}),segInfo.label_propend=locale.text("auth.gSegmentsConfig.label_propend"),segInfo.value_propend=authHtml.execute("authPanelGaugeSlider",{id:segInfo.id+"-propend",min:0,max:1,step:.1,value:seg.propEnd}),segInfo.label_color=locale.text("auth.gSegmentsConfig.label_color"),segInfo.value_color=seg.color,segInfo.label_apply=locale.text("auth.g.label_apply");var html=authHtml.execute("gaugeSegment",segInfo),$$panel=$(html),$$rangeInputArr=$("input.s-m-auth-g-range",$$panel);$$rangeInputArr.slider(),$$rangeInputArr.on("slide",function(slideEvt){var $$input=$(slideEvt.target),$$output=$$input.next();$$output.text(slideEvt.value)}),$$parent.append($$panel)}function _createMarkupApply($$parent,prop,sel,data){var html=authHtml.execute("authPanelButton",{label:locale.text("auth.gSegmentsConfigApply.label"),css:"s-m-auth-g-apply"}),$$panel=$(html);$("button",$$panel).on("click",function(e){var segs=[],$$segments=$(e.target).parent().parent().find(".s-m-auth-seg-slot");for(var ii=0,jj=$$segments.length;ii<jj;ii++){var $$seg=$($$segments[ii]),id=$$seg.attr("id"),segInfo={};segInfo.valStart=$("#"+id+"-valstart",$$seg).val(),segInfo.valEnd=$("#"+id+"-valend",$$seg).val(),segInfo.propStart=$("#"+id+"-propstart",$$seg).val(),segInfo.propEnd=$("#"+id+"-propend",$$seg).val(),segInfo.color=$("#"+id+"-color",$$seg).val(),segInfo.valStart=segInfo.valStart===""?null:segInfo.valStart,segInfo.valEnd=segInfo.valEnd===""?null:segInfo.valEnd,segInfo.propStart=segInfo.propStart===""?null:segInfo.propStart,segInfo.propEnd=segInfo.propEnd===""?null:segInfo.propEnd,segInfo.color=segInfo.color===""?null:segInfo.color;var vStart=segInfo.valStart,vEnd=segInfo.valEnd;if(vStart&&isNaN(parseInt(vStart.replace(".","").replace(",",""),10))){_err(locale.text("auth.gSegmentsConfig.err.title"),locale.text("auth.gSegmentsConfig.err.msg.expectedNumber",[locale.text("auth.gSegmentsConfig.label_valstart"),vStart]));return}if(vEnd&&isNaN(parseInt(vEnd.replace(".","").replace(",",""),10))){_err(locale.text("auth.gSegmentsConfig.err.title"),locale.text("auth.gSegmentsConfig.err.msg.expectedNumber",[locale.text("auth.gSegmentsConfig.label_valend"),vEnd]));return}segs.push(segInfo)}data.articleSelection.$gauge.segments=segs,authPropsGeneral.notifyChangePropUI($$parent,sel,data)}),$$parent.append($$panel)}function _destroySlider($$parent,prop){var $$slider=$$parent.find("input.s-m-auth-g-range");$$slider.length>0&&$$slider.slider&&$$slider.slider("destroy")}function _getModuleProperties($$elmt,controller,props,sel,data){if(_isGaugeValuePropertyType(data.type)){var isGauge;data.articleSelection.$numDisplay?isGauge=data.articleSelection.$numDisplay==="gauge":(isGauge=data.articleSelection.$gauge?!0:!1,data.articleSelection.$numDisplay=isGauge?"gauge":"normal"),props.push(_properties.numDisplay);if(isGauge){data.articleSelection.$gSetBorderValues||(data.articleSelection.$gauge.$bindMax?data.articleSelection.$gSetBorderValues=typeof data.articleSelection.$gauge.$bindMax=="string"?"bind":"value":data.articleSelection.$gSetBorderValues="default"),props.push(_properties.gSetBorderValues),data.articleSelection.$gSetBorderValues!=="default"&&props.push(_properties.gBorderValues),props.push(_properties.gSegmentsNumber);if(data.articleSelection.$gauge.segments&&data.articleSelection.$gauge.segments.length>0){for(var ii=0,jj=data.articleSelection.$gauge.segments.length;ii<jj;ii++){var name="gSegmentsConfig"+ii;_properties[name]={"default":"",createMarkup:_createMarkupGSegmentsConfig,type:"child-child",destroyMarkup:_destroySlider,label:locale.text("auth.gSegmentsConfig",[ii+1]),segIdx:ii,name:name},props.push(_properties[name])}props.push(_properties.gSegmentsConfigApply)}}}}function _isGaugeValuePropertyType(type){return type.indexOf("integer")>=0||type.indexOf("real")>=0||type.indexOf("decimal")>=0||type.indexOf("quantity")>=0?!0:!1}var locale=require("syracuse-tablet/html/js/helpers/locale"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),_err=authPropsGeneral.err,maxSegments=5,_properties={numDisplay:{key:"$numDisplay","default":"normal",values:[{value:"normal"},{value:"gauge"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio},gSetBorderValues:{key:"$gSetBorderValues","default":"default",values:[{value:"default"},{value:"value"},{value:"bind"}],createMarkup:authPropsGeneral.createMarkupRadio,refreshMarkup:authPropsGeneral.refreshMarkupRadio,type:"child"},gBorderValues:{"default":"",createMarkup:_createMarkupGBorderValues,type:"child"},gSegmentsNumber:{"default":"",createMarkup:_createMarkupGSegmentsNumbers,type:"child"},gSegmentsConfig:{"default":"",createMarkup:_createMarkupGSegmentsConfig,type:"child",destroyMarkup:_destroySlider},gSegmentsConfigApply:{applyMarkup:_createMarkupApply}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=_getModuleProperties}),define("syracuse-tablet/html/js/authoring/authoringPropertiesCtrls",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/arrays/authoringPropertiesArrays","syracuse-tablet/html/js/authoring/authoringPropertiesGauge","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var authUtils=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authoringPropertiesArrays=require("syracuse-tablet/html/js/authoring/arrays/authoringPropertiesArrays"),authoringPropertiesGauge=require("syracuse-tablet/html/js/authoring/authoringPropertiesGauge"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_modules=[authoringPropertiesArrays,authoringPropertiesGauge],_canBeEmpty=function(typ){switch(typ){case"integer":case"real":case"decimal":case"quantity":case"boolean":return!1;default:return!0}},_ctrlFieldsProperties={checkBoxDisplayAs:{key:"$displayAs","default":"icon",values:[{value:"icon"},{value:"text"}],createMarkup:authUtils.createMarkupRadio},isTitleHidden:{key:"$isTitleHidden","default":!1,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio,type:"default"},hideIfEmpty:{key:"$hideIfEmpty","default":!1,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio},isSignature:{key:"$isSignature","default":!1,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio},imgScale:{key:"$imgScale","default":"original",values:[{value:"original"},{value:"small"},{value:"medium"},{value:"large"}],createMarkup:authUtils.createMarkupRadio},scanGPS:{key:"$scanGPS","default":!1,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio},scanBarcode:{key:"$scanBarcode","default":!1,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio},labelPosition:{key:"$labelPosition","default":"left",values:[{value:"left"},{value:"top"}],createMarkup:authUtils.createMarkupRadio},labelAlign:{key:"$labelAlign","default":"left",values:[{value:"left"},{value:"center"},{value:"right"}],createMarkup:authUtils.createMarkupRadio,refreshMarkup:authUtils.refreshMarkupRadio},theme:{key:"$theme","default":"none",values:[{value:"none"},{value:"largetitle"}],createMarkup:authUtils.createMarkupRadio,toggleTheme:function($$elmt,theme){this.removeTheme($$elmt,theme),this.addTheme($$elmt,theme)},removeTheme:function($$elmt,theme){var e=$$elmt.get(0);if(!e.className||e.className.indexOf("s-m-theme")===-1)return;var newClassName=[];e.className.split(" ").forEach(function(c){c&&!c.smStartsWith("s-m-theme")&&newClassName.push(c)});if(e.className.length===0)return;e.className=newClassName.join(" ")},addTheme:function($$elmt,theme){if(!theme||theme==="none")return;$$elmt.addClass("s-m-theme-"+theme)}},refDescPosition:{key:"$refDescPosition","default":"right",values:[{value:"bottom"},{value:"right"},{value:"left"},{value:"top"},{value:"none"}],createMarkup:authUtils.createMarkupRadio},refDescFormat:{key:"$refDescFormat","default":"desc",values:[{value:"desc"},{value:"title"},{value:"desctitle"},{value:"titledesc"}],createMarkup:authUtils.createMarkupRadio},refValueDisplay:{key:"$refValueDisplay","default":!0,values:[{value:!0},{value:!1}],createMarkup:authUtils.createMarkupRadio},textHeight:{key:"$textHeight","default":"medium",values:[{value:"small"},{value:"medium"},{value:"large"},{value:"xlarge"}],createMarkup:authUtils.createMarkupRadio,refreshMarkup:authUtils.refreshMarkupRadio},emptyImageIcon:{key:"$emptyImageIcon","default":fontUtils.getEmptyImageDefIcon(),values:fontUtils.getEmptyImageIconList(),createMarkup:authUtils.createMarkupIconPicker,destroyMarkup:authUtils.destroyMarkupIconPicker},emptyIconSize:{key:"$emptyIconSize","default":"small",values:[{value:"small"},{value:"medium"},{value:"large"},{value:"xlarge"}],createMarkup:authUtils.createMarkupRadio,refreshMarkup:authUtils.refreshMarkupRadio},urlIcon:{key:"$urlIcon","default":fontUtils.getUrlDefIcon(),values:fontUtils.getUrlIconList(),createMarkup:authUtils.createMarkupIconPicker,destroyMarkup:authUtils.destroyMarkupIconPicker},urlIconSize:{key:"$urlIconSize","default":"small",values:[{value:"small"},{value:"medium"},{value:"large"},{value:"xlarge"}],createMarkup:authUtils.createMarkupRadio,refreshMarkup:authUtils.refreshMarkupRadio},imgHeight:{key:"$imgHeight","default":"small",values:[{value:"xsmall"},{value:"small"},{value:"medium"},{value:"large"},{value:"xlarge"}],createMarkup:authUtils.createMarkupRadio,refreshMarkup:authUtils.refreshMarkupRadio}};exports.initModuleProperties=function(dest){authUtils.initProperties(_ctrlFieldsProperties,dest),_modules.forEach(function(module){module.initModuleProperties(dest)})},exports.getModuleProperties=function($$elmt,controller,props,sel,data){var isField=sel.$$elmt.is(".s-m-control.s-m-field"),isArray=sel.$$elmt.is(".s-m-control.s-m-array");if(isField||isArray&&!controller.dataset.root.prototype.isQueryLikeFacet()){props.push(_ctrlFieldsProperties.isTitleHidden);var labelPosition=!0,alignment=!0;authUtils.getValueOrDefault(_ctrlFieldsProperties.isTitleHidden,sel,data)?labelPosition=!1:authUtils.getValueOrDefault(_ctrlFieldsProperties.labelPosition,sel,data)!=="top"&&(alignment=!1),isArray&&(labelPosition=!1),labelPosition&&props.push(_ctrlFieldsProperties.labelPosition),alignment&&props.push(_ctrlFieldsProperties.labelAlign)}else sel.$$elmt.is(".s-m-control.s-m-chart-array")&&props.push(_ctrlFieldsProperties.isTitleHidden);isField?(_canBeEmpty(data.type)&&props.push(_ctrlFieldsProperties.hideIfEmpty),props.push(_ctrlFieldsProperties.theme),data.type==="boolean"&&props.push(_ctrlFieldsProperties.checkBoxDisplayAs),data.type==="reference"&&(controller.isEditMode()||props.push(_ctrlFieldsProperties.refValueDisplay),props.push(_ctrlFieldsProperties.refDescFormat),props.push(_ctrlFieldsProperties.refDescPosition)),(data.type==="rtf"||data.type==="html"||data.type==="plain")&&props.push(_ctrlFieldsProperties.textHeight),data.type==="image"&&(props.push(_ctrlFieldsProperties.emptyImageIcon,_ctrlFieldsProperties.emptyIconSize,_ctrlFieldsProperties.imgHeight),controller.isEditMode()&&props.push(_ctrlFieldsProperties.imgScale,_ctrlFieldsProperties.isSignature)),data.type==="string"&&data.control&&data.control.cssType==="s-m-url"&&props.push(_ctrlFieldsProperties.urlIcon,_ctrlFieldsProperties.urlIconSize),controller.isEditMode()&&(data.control.getNativeCapabilityAuthoring("GPS")!=null&&props.push(_ctrlFieldsProperties.scanGPS),data.control.getNativeCapabilityAuthoring("scanBarcode")!=null&&props.push(_ctrlFieldsProperties.scanBarcode)),authoringPropertiesGauge.getModuleProperties($$elmt,controller,props,sel,data)):isArray&&(data.control.$display==="separator"&&props.push(_ctrlFieldsProperties.theme),authoringPropertiesArrays.getModuleProperties($$elmt,controller,props,sel,data))},exports.toggleTheme=function($$elmt,theme){if(!$$elmt)return;return _ctrlFieldsProperties.theme.toggleTheme($$elmt,theme)}}),define("syracuse-tablet/html/js/authoring/authoringPropertiesLayouts",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _createMarkupInput($$parent,prop,sel,data){var value=authPropsGeneral.getValueOrDefault(prop,sel,data),html=authHtml.execute("authPanelPropertyInput",{id:"auth_opt_"+prop.name,value:value}),$$panel=$(html);$("input",$$panel).blur(function(){var value=$(this).val();authPropsGeneral.setValue(prop,sel,data,value),authPropsGeneral.notifyChangePropUI($$parent,sel,data)}),$$parent.append($$panel)}function _createMarkupInputLocale($$parent,prop,sel,data){var oldUUID=authPropsGeneral.getValueOrDefault(prop,sel,data),value;oldUUID=oldUUID||"";if(oldUUID.indexOf("{@")<0)value=oldUUID,oldUUID="";else{var loc=data.articlePage.$localization&&data.articlePage.$localization[locale.getCurrentLocale()];value=oldUUID.replace(/\{\@(\S+)\}/g,function(m,g){return loc&&loc[g]||m}),value===oldUUID&&(value=data.control.controller.prototype.resolveExpression(oldUUID,null,!0))}var html=authHtml.execute("authPanelPropertyInputLocale",{id:"auth_opt_"+prop.name,value:value,oldValue:value,oldUUID:oldUUID}),$$panel=$(html);$("input",$$panel).blur(function(){var value=$(this).val(),oldValue=$(this).attr("data-old-value"),oldUUID=$(this).attr("data-old-uuid");value===oldValue?(oldUUID.length>0&&(value=oldUUID),_setValue($$parent,prop,sel,data,value)):oldValue&&value&&utils.isLocalizationExits(data.articlePage.$localization,oldUUID)?modules.get("modal").simpleConfirmPromise({message:locale.text("auth.msg.keepTranslation")}).then(function(result){result.action==="yes"&&(data.articleSelection.keepKey=oldUUID),_setValue($$parent,prop,sel,data,value)}):_setValue($$parent,prop,sel,data,value)}),$$parent.append($$panel)}function _setValue($$parent,prop,sel,data,value){authPropsGeneral.setValue(prop,sel,data,value),authPropsGeneral.notifyChangePropUI($$parent,sel,data)}function _createMarkupIcon($$parent,prop,sel,data){var ctx={group:"auth_opt_"+prop.name,options:[]},value=authPropsGeneral.getValueOrDefault(prop,sel,data);ctx.options.push({id:ctx.group+"_none",value:"",icon:"fa fa-remove"}),fontUtils.getTileIconList().forEach(function(v){var css=fontUtils.getIconByName(v);ctx.options.push({id:ctx.group+"_"+v,value:v,icon:css})});var html=authHtml.execute("authPanelPropertyRadioIcon",ctx),$$panel=$(html);$("label[data-s-m-auth-value='"+(""+value)+"']",$$panel).eq(0).button("toggle"),$("label",$$panel).on("click",function(e){var $$ct=$(e.currentTarget),value=$$ct.attr("data-s-m-auth-value");$$ct.eq(0).button("toggle"),authPropsGeneral.setValue(prop,sel,data,value),authPropsGeneral.notifyChangePropUI($$parent,sel,data)}),$$parent.append($$panel)}function _getAllX3Title(prototype){var title=[],localization=prototype.json.$localization||{};return Object.keys(localization).forEach(function(key){var tit={};tit.value="{"+key+"}",tit.title=localization[key],title.push(tit)}),title.sort(function(a,b){var aTit=a.title.toLowerCase(),bTit=b.title.toLowerCase();return aTit<bTit?-1:aTit>bTit?1:0})}var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),locale=require("syracuse-tablet/html/js/helpers/locale"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),_properties={tileColor:{key:"$bgColor","default":"",values:authPropsGeneral.getColorValues(),colorChange:function(value,sel,data,prop){authPropsGeneral.setValue(this,sel,data,value?value.id:""),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},createMarkup:function($$parent,prop,sel,data){var opts={color:"",palette:authPropsGeneral.getColorPalette(),dropUp:!1,onSelectColor:jsutils.bindFn(this.colorChange,this,sel,data,prop)};this.paletteColor=authComponents.newComponent("colorPalettePicker",opts),this.paletteColor.createMarkup($$parent),this.paletteColor.setValue(authPropsGeneral.getColorInfo(data.articleSelection.$bgColor))}},tileSize:{key:"$size","default":"medium",values:[{value:"small"},{value:"medium"},{value:"wide"},{value:"large"},{value:"full"},{value:"all"}],createMarkup:authPropsGeneral.createMarkupRadio},layoutTitle:function(controller,sel,data){this.name="layoutTitle",this.key="$title";var titleList=_getAllX3Title(controller.dataset.prototype);if(!titleList||!titleList.length){this["default"]="",this.createMarkup=_createMarkupInputLocale;return}this.values=titleList,this.createMarkup=function($$parent,prop,sel,data){var opts={value:"",options:titleList,onChange:jsutils.bindFn(this.valueChange,this,sel,data,prop),dataSize:20};this.titleSelect=authComponents.newComponent("select",opts),this.titleSelect.createMarkup($$parent),data.articleSelection&&data.articleSelection.$title&&this.titleSelect.setValue(data.articleSelection.$title)},this.valueChange=function(event,titleSelect,sel,data,prop){authPropsGeneral.setValue(this,sel,data,titleSelect.getValue()),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)}},layoutCollapsible:{key:"$collapsible","default":"notcollapsible",values:[{value:"notcollapsible"},{value:"expanded"},{value:"collapsed"}],createMarkup:authPropsGeneral.createMarkupRadio},tileIcon:{key:"$icon","default":"",createMarkup:_createMarkupIcon},cellSize:function(controller,sel,data){this["default"]=4,this.name="cellSize",this.destroyMarkup=function(){this.$$parent=null,this._$$panel&&(this._$$panel.off(),this._$$panel=null)},this.createMarkup=function($$parent,prop,sel,data){var self=this;self.$$parent=$$parent;var values=["1","2","3","4","5","6","7","8","9","10","11","12"];self._sizes=[{prop:"widthAll",label:locale.text("auth.cellSize.widthAll"),"class":"s-m-auth-highlight-all"},{prop:"widthXs",label:locale.text("auth.cellSize.$widthXs"),"class":"s-m-auth-highlight-xs"},{prop:"widthSm",label:locale.text("auth.cellSize.$widthSm"),"class":"s-m-auth-highlight-sm"},{prop:"widthMd",label:locale.text("auth.cellSize.$widthMd"),"class":"s-m-auth-highlight-md"},{prop:"widthLg",label:locale.text("auth.cellSize.$widthLg"),"class":"s-m-auth-highlight-lg"}],self._$$panel=$(authHtml.execute("authPanelPropertyCellSize",{id:"auth_opt_"+prop.name,sizes:self._sizes,values:values,sameSize:locale.text("auth.cellSize.sameSize")}));var last="12";self._sizes.forEach(function(size){var value=data.articleSelection&&data.articleSelection["$"+size.prop];value=value||last,last=value,$("label[data-s-m-auth-prop='"+size.prop+"'][data-s-m-auth-value='"+value+"']",self._$$panel).button("toggle")}),self._$$panel.on("click","label.auth-btn-size-sel",jsutils.bindFn(self.onClickSize,this,sel,data)),self._$$panel.on("click",'input[type="checkbox"]',jsutils.bindFn(self.onClickSameSize,this,sel,data)),self._$$panel.appendTo($$parent),self.toggleSameSize($$parent,data.articleSelection.$sameSize)},this.onClickSize=function(e,sel,data){var self=this,$$ct=$(e.currentTarget);$$ct.eq(0).button("toggle"),self._sizes.forEach(function(size){$$ct=self._$$panel.find("label.active[data-s-m-auth-prop='"+size.prop+"']");if($$ct.length>0){var value=$$ct.attr("data-s-m-auth-value");data.articleSelection["$"+size.prop]=value}}),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},this.onClickSameSize=function(e,sel,data){data.articleSelection.$sameSize=$(e.currentTarget).prop("checked"),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},this.toggleSameSize=function($$parent,yes){yes=yes===!0,this._$$panel.find("section.widthAll").toggle(yes),this._$$panel.find("section:not(.widthAll)").toggle(!yes),this._$$panel.find('input[type="checkbox"]').prop("checked",yes)}},layoutTheme:function(controller,sel,data){if(data.articleSelection.$collapsible===undefined||data.articleSelection.$collapsible==="notcollapsible")return null;var level=data.control.$$elmt.parents(".s-m-stack").length;this.name="layoutTheme",this.key="$theme",this["default"]=String.fromCharCode(96+level),this.values=[],this.values.push({value:String.fromCharCode(96+level)}),this.values.push({value:"advanced"}),this.createMarkup=authPropsGeneral.createMarkupRadio}},_layoutProps={stack:[_properties.tileColor,_properties.layoutTitle,_properties.layoutCollapsible,_properties.layoutTheme],row:[_properties.tileColor],"hub-group":[_properties.layoutTitle],tile:[_properties.layoutTitle,_properties.tileColor,_properties.tileSize,,_properties.tileIcon],cell:[_properties.tileColor,_properties.cellSize]};exports.properties=_properties,exports.getModuleProperties=function($$elmt,controller,props,sel,data){Object.keys(_layoutProps).some(function(key){var cls="s-m-"+key;$$elmt.hasClass(cls)&&_layoutProps[key].forEach(function(p){props.push(p)})})},exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)}}),define("syracuse-tablet/html/js/authoring/page/authoringActions",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/common/helpers"],function(require,exports,module){function _getLinksAndActions(page){var prototype=page.getPrototype(),res={},$links=$.extend(!0,{},page.controller.dataset.getLinks());$.each($links,function(name,info){if(name.smStartsWith("$")||helpers.isPaginLink(name))return;info.name=name,info.title=info.$title?prototype.resolveExpression(info.$title):"",info.icon=fontUtils.getIconByName(name);if(info.$type==null||info.$type.length!==0||info.$type==="application/json;vnd.sage=syracuse")if(info.$url){var urlParsed=prototype.resolveExpression(info.$url);urlParsed.indexOf("/mobile2/")>-1&&(res[name]=info)}});var $actions=$.extend(!0,{},page.controller.dataset.getActions());return $.each($actions,function(name,info){if(name.indexOf("$")===0)return;info.name=name,info.title=info.$title?prototype.resolveExpression(info.$title):"",info.icon=fontUtils.getIconByName(name),res[name]=info}),$.isEmptyObject(res)?null:res}var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),locale=require("syracuse-tablet/html/js/helpers/locale"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),helpers=require("syracuse-tablet/html/js/common/helpers"),_templates={subtitle:'		<section class="s-m-prop-subtitle" {{#if id}}id="{{id}}"{{/if}} style="{{#if notHidden}}overflow:hidden;{{/if}}white-space:nowrap;text-overflow:ellipsis;{{#if margin}}margin-bottom:{{margin}}px;{{/if}}">			{{#if title}}<p>{{title}}</p>{{/if}}			<div></div>		</section>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)},_addSubSection=function(title,id,$$parent){var $$panel=$(_getHtml("subtitle",{title:title,margin:10,id:id})).appendTo($$parent||this.$$parent);return{$$panel:$$panel,$$content:$$panel.children("div"),$$title:$$panel.children("p")}},_optionsProperties=["footerHeader","refreshPage","multiselection","backIfSuccess"],_noValue="$$novalue$$",_properties={actionSettings:function(controller,sel,data){this.name="actionSettings",this.label=null,this["default"]=null,this.key="$pageActionSettings",this._myProperties=[],this._page=data.page,this.controller=controller,this.initMarkup=function(controller,sel,data){if(!this._page)return;var $links=_getLinksAndActions(this._page);this._$links=[];if($links)for(var l in $links){var entry=$.extend(!0,{},$links[l]);entry.name=l,entry.$title=entry.$title||entry.name,this._$links.push(entry)}var baseArticle=data.articleSelection||{};baseArticle=baseArticle[this.key]||[],this._actionList=[];var self=this;baseArticle.forEach(function(act){self.getActionProto(act.name)&&(act.$title=act.$title||act.name,act.options=act.options||{},self._actionList.push($.extend(!0,{},act)))})},this.getActionProto=function(name){var res=null;return this._$links.some(function(v,idx){if(v.name===name)return res=v,!0}),res},this.getActionInfo=function(actName){if(!actName)return null;var idx=-1,rec=null;return this._actionList.some(function(c,i){if(c.name===actName)return rec=c,idx=i,!0}),idx===-1?null:{record:rec,idx:idx}},this.destroyMarkup=function(){this._page=null,this.$$parent=null,this.controller=null,this._$links=null,this._myProperties&&(this._myProperties.forEach(function(p){p.destroyMarkup&&p.destroyMarkup()}),this._myProperties=null)},this.createMarkup=function($$parent,prop,sel,data){if(!this._page)return;this.$$parent=$$parent,this._page.isStateLessMode()&&this.downloadOptAdd(sel,data),this.actionListAdd(sel,data),this.editSectionAdd(),this.checkAppendButton()},this.downloadOptAdd=function(sel,data){var value=authPropsGeneral.getValueOrDefault({key:"$allowDownload","default":!1},sel,data),opts={size:"small",onText:"True",offText:"False",onSwitchChange:this.onAllowDownloadChanged.bind(this,sel,data)};this.allowDownload=authComponents.newComponent("switcher",opts),this.$$allowDownload=this._addParam("allowDownload",this.allowDownload,!0),this.allowDownload.setValue(value)},this.onAllowDownloadChanged=function(sel,data,event,value){authPropsGeneral.setValue({key:"$allowDownload"},sel,data,value),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data)},this.actionListAdd=function(sel,data){var opts={css:"actionlist",doAction:jsutils.bindFn(this.listCallBackAction,this,sel,data),appendTitle:locale.text("auth.actionSettings.append")};this.listActionDisplayer=authComponents.newComponent("editableList",opts),this._addParam("actionlist",this.listActionDisplayer,!0),this.updateActionList()},this.editSectionAdd=function(){this.editActionSection=this._addSubSection("editaction"),this.editActionSection.$$panel.hide(),this.editActionSection.$$content.css("padding-left","7px"),this.editActionSection.$$title.css("font-weight","bold");var $$rootComponents=this.editActionSection.$$content;this.paramActionAdd($$rootComponents),this.paramOptionsAdd($$rootComponents),this.paramIconAdd($$rootComponents)},this.checkAppendButton=function(){if(!this.listActionDisplayer)return;this.listActionDisplayer.disableAppendBtn(this._actionList.length>=this._$links.length)},this.listCallBackAction=function(action,recordId,listActionDisplayer,sel,data){if(action==="append")return this._updateParams(null),!0;if(action==="cancel")return this._resetEditParams(),this.editActionSection.$$panel.hide(),this.checkAppendButton(),!0;var recInfo=this.getActionInfo(recordId);if(action==="validate"){var newRecord=this.validateRecord(!0);return newRecord?(recInfo==null?this._actionList.push(newRecord):(this._actionList.splice(recInfo.idx,1),this._actionList.splice(recInfo.idx,0,newRecord)),this.updateActionList(!0,sel,data),this._resetEditParams(),this.checkAppendButton(),!0):!1}if(action==="deleteItem")return recInfo?(this._actionList.splice(recInfo.idx,1),this.checkAppendButton(),this.updateActionList(!0,sel,data),!0):!1;if(action==="editItem")return recInfo?(this._updateParams(recInfo.record),!0):!1},this.validateRecord=function(errorMsg){var self=this,rec={},_fail=function(msg,params){if(errorMsg===!0){var text=locale.text("auth.actionSettings.invalid"+(msg||""),params);self.listActionDisplayer.toggleMessage(text,"error"),setTimeout(function(){self.listActionDisplayer.toggleMessage(null)},2500)}return null};rec.name=this.actionSelector.getValue();if(!rec.name||rec.name==_noValue)return _fail();rec.icon=this.paletteIcon.getValue();var info=this.getActionProto(rec.name);if(!info)return _fail(".action",[rec.name]);rec.$title=info.$title,rec.options=this.optionsList.getValue();var nbChecked=0;for(var p in rec.options)rec.options[p]===!0&&nbChecked++;return nbChecked===0&&!rec.icon?_fail(".empty"):rec.options.footerHeader&&!rec.icon?_fail(".icon"):rec},this._updateParams=function(record){var edit=record!=null;record=record||{},this.editActionSection.$$panel.show(),this.paramActionUpdate(record.name||_noValue,!0,record.options),this.optionsList.updateValue(record.options),this.paletteIcon.setValue(record.icon)},this._resetEditParams=function(){this.editActionSection.$$panel.hide(),this.actionSelector.setValue(_noValue)},this.updateActionList=function(updateAuthoring,sel,data){var self=this,clearBefore=!0;clearBefore&&this.listActionDisplayer.clear();var records=[];this._actionList.forEach(function(c){records.push({titleHtml:"<span>"+(self._page.getPrototype().resolveExpression(c.$title)||c.name)+"</span>",id:c.name})}),this.listActionDisplayer.insertRecords(records);if(updateAuthoring==1){var value=[];this._actionList.forEach(function(c){c=$.extend(!0,{},c),c.$title=c.$title,value.push(c)}),authPropsGeneral.setValue(this,sel,data,value),authPropsGeneral.notifyChangePropUI(this.$$parent,sel,data);return}},this.paramActionAdd=function($$root){var opts={css:"actionName",onChange:jsutils.bindFn(this.onParamActionSelect,this),isHidden:!1};this.actionSelector=authComponents.newComponent("select",opts),this._addParam("action",this.actionSelector,!0,$$root,!0),this.paramActionUpdate(_noValue)},this.onParamActionSelect=function(event,prop){},this.paramActionUpdate=function(value,forceAddValue,options){var selectOpts=[{title:locale.text("auth.actionSettings.novalue"),value:_noValue}],self=this;this._$links.forEach(function(v,idx){if(options&&options.multiselection===!0&&v.name.smStartsWith("$"))return;(forceAddValue===!0&&value===v.name||!self.getActionInfo(v.name))&&selectOpts.push({title:self._page.getPrototype().resolveExpression(v.$title)||v.name,value:v.name})}),this.actionSelector.update(selectOpts,value||_noValue)},this.paramOptionsAdd=function($$root){var opts={list:[],onClick:jsutils.bindFn(this.onClickOptions,this)},self=this;_optionsProperties.forEach(function(x){if(x==="multiselection"&&!self._page.getPrototype().isQuery())return;opts.list.push({id:x,label:locale.text("auth.actionSettings."+x)})}),this.optionsList=authComponents.newComponent("checkboxList",opts),this._addParam("options",this.optionsList,!0,$$root,!1)},this.onClickOptions=function(id,checked){this.paramActionUpdate(this.actionSelector.getValue(),!0,this.optionsList.getValue())},this.paramIconAdd=function($$root){var opts={palette:fontUtils.getPageActionIcon(),dropUp:!0};this.paletteIcon=authComponents.newComponent("iconPalettePicker",opts),this._addParam("icon",this.paletteIcon,!0,$$root,!1)},this._addParam=function(prop,component,title,$$parent,mandatory){var $$parent=$$parent||this.$$parent,$$title,$$root;if(title){var res=this._addSubSection(prop,$$parent,mandatory);$$root=res.$$content,$$title=res.$$panel}else $$root=$$parent;if(component==null)throw new Error("unexpected null component ["+prop+"]");var $$panel;return component.createMarkup?(component.createMarkup($$root),this._myProperties.push(component),$$panel=component.$$panel):component.jquery&&($$root.append(component),$$panel=component),$$title?$$title:$$panel},this._addSubSection=function(textId,$$parent,mandatory){var title=locale.text("auth.actionSettings."+textId)+(mandatory===!0?"*":""),id="actionSettings"+textId.smCapitalize();return _addSubSection(title,id,$$parent||this.$$parent)}}};exports.addSubSection=_addSubSection,exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){data.page.isSData()&&props.push(_properties.actionSettings)}}),define("syracuse-tablet/html/js/authoring/page/authoringChartDetail",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"],function(require,exports,module){var authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),_properties={chartDetailDisplay:{key:"$display","default":"bothSideToSide",values:[{value:"chartOnly"},{value:"arrayOnly"},{value:"bothSideToSide"}],createMarkup:authPropsGeneral.createMarkupRadio}};exports.initModuleProperties=function(dest){authPropsGeneral.initProperties(_properties,dest)},exports.getModuleProperties=function($$elmt,controller,props,sel,data){props.push(_properties.chartDetailDisplay)}}),define("syracuse-tablet/html/js/authoring/authoringPropertiesPages",["require","exports","module","syracuse-tablet/html/js/authoring/page/authoringActions","syracuse-tablet/html/js/authoring/page/authoringChartDetail","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var authoringActions=require("syracuse-tablet/html/js/authoring/page/authoringActions"),authoringChartDetail=require("syracuse-tablet/html/js/authoring/page/authoringChartDetail"),authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),authUtils=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_properties={variants:function(controller,sel,data){this.key="$variant",this.views=data.page.pageData.page.$views;if(!this.views||this.views.length<=1)return;var titles=[],currentSelection;this.views.forEach(function(view,idx){titles.push({title:view.$title,value:view.uuid||view.$url,selected:view.$selected}),view.$selected&&(currentSelection=view.uuid||view.$url)}),this.applyMarkup=function($$parent,prop,sel,data){var subsection=this._addSubSection($$parent),opts={css:"variants-list",value:currentSelection,options:titles,onChange:jsutils.bindFn(this.valueChange,this,sel,data,prop),dataSize:20};this.viewSelect=authComponents.newComponent("select",opts),this.viewSelect.createMarkup(subsection.$$content),data.articleSelection&&data.articleSelection.$variant&&this.viewSelect.setValue(data.articleSelection.$variant)},this._addSubSection=function($$parent){var title=locale.text("auth.page.views"),id="pageViewsList";return authoringActions.addSubSection(title,id,$$parent)},this.valueChange=function(event,viewSelect,sel,data,prop){var uuid=viewSelect.getValue(),self=this,variants=data&&data.page&&data.page.variants;if(!variants)return;var variantSelected=$.smFind(variants,function(variant){return uuid.indexOf(variant.$uuid)>-1?!0:!1});variantSelected&&(this.views.forEach(function(view){view.$selected=!1;if(view.$url===uuid||view.uuid==uuid)view.$selected=!0}),authPropsGeneral.notifyAuthVariantChange(JSON.parse(variantSelected.pageData.content).$article))}},stackbar:function(controller,sel,data){if(!data.page.controller.isStackBarAvailable())return null;this.key="$stackbar",this["default"]=data.articleSelection&&data.articleSelection.$stackbar||!1,this.values=[{value:!0},{value:!1}],this.name="stackbar",this.createMarkup=authUtils.createMarkupRadio}},_modules=[authoringActions,authoringChartDetail];exports.initModuleProperties=function(dest){_modules.forEach(function(module){module.initModuleProperties(dest)})},exports.getModuleProperties=function($$elmt,controller,props,sel,data){var page=data.page?data.page:data.control&&data.control.isVignette()?data.control.getTopPage():null;if(page==null)return;data.control==null?props.push(_properties.variants):data.page=page,!page.isCardDetail()&&!page.isVignette()&&!page.isDashboard()&&(page.isFacet("$details","$edit","$create")&&props.push(_properties.stackbar),authoringActions.getModuleProperties($$elmt,controller,props,sel,data))}}),define("syracuse-tablet/html/js/authoring/authoringProperties",["require","exports","module","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/authoringPropertiesCtrls","syracuse-tablet/html/js/authoring/authoringPropertiesLayouts","syracuse-tablet/html/js/authoring/authoringPropertiesPages"],function(require,exports,module){var authoringPropertiesGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authoringPropertiesCtrls=require("syracuse-tablet/html/js/authoring/authoringPropertiesCtrls"),authoringPropertiesLayouts=require("syracuse-tablet/html/js/authoring/authoringPropertiesLayouts"),authoringPropertiesPages=require("syracuse-tablet/html/js/authoring/authoringPropertiesPages"),_propsModules=[authoringPropertiesPages,authoringPropertiesLayouts,authoringPropertiesCtrls,authoringPropertiesGeneral],_properties;exports.initProperties=function(force){if(_properties!=null&&force!=1)return;_properties={},_propsModules.forEach(function(module){module.initModuleProperties(_properties)})},exports.getAllProperties=function(){return _properties},exports.getProperties=function(sel,data){var $$elmt=sel.$$elmt,props=[],controller=data.control&&data.control.controller;return _propsModules.forEach(function(module){module.getModuleProperties($$elmt,controller,props,sel,data)}),props.forEach(function(p,idx){if(typeof p=="function"){var prop=props[idx]=new p(controller,sel,data);prop.initMarkup&&prop.initMarkup(controller,sel,data),authoringPropertiesGeneral.initProperty(prop)}}),props},exports.getPropertiesLayouts=function(){return authoringPropertiesLayouts}}),define("syracuse-tablet/html/js/authoring/authoringHelpers",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/pages/pageBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/authoring/authoringSData","syracuse-tablet/html/js/authoring/authoringProperties","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/authoring/authoringVal","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/cache/metaDataCache"],function(require,exports,module){function _authCopyPageProperties(page,dst){if(!page.isSData())return;var src=page.getArticle();if(!src||!dst)return;var _authPageProps=["$pageActionSettings"];page.isStateLessMode()&&_authPageProps.push("$allowDownload"),_authPageProps.forEach(function(p){if(src[p]!=null||dst[p]!=null&&src[p]==null)dst[p]=src[p]})}function _updatePageMetaData(page,variant,variants,views,article){variant&&variant.variantId&&views.forEach(function(view){view.$selected=!!(view.$url&&view.$url.indexOf(variant.variantId)>-1)}),page.pageData.page.$views=views,page.variants=variants;var pageName=page.getAuthoringFullName();return metaDataCache.putArticle(pageName,article,views)}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),pageBase=require("syracuse-tablet/html/js/pages/pageBase"),utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),authoringSData=require("syracuse-tablet/html/js/authoring/authoringSData"),authProps=require("syracuse-tablet/html/js/authoring/authoringProperties"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),authVal=require("syracuse-tablet/html/js/authoring/authoringVal"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),uiutils=require("syracuse-tablet/html/js/ui/uiUtils"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),modules=require("syracuse-tablet/html/js/common/modules"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),_openPanels=[];exports.triggerResizeInternal=function(opts){uiutils.triggerResizeInternal(opts)},exports.selectElement=function(sel){$(".s-m-auth-selected").removeClass("s-m-auth-selected");var $$elmt=$("#"+sel.id,$("#s-m-app-id")),domItem=$$elmt[0]},exports.findControl=function($$ctrl){return modules.get("controller").findControlByDom($$ctrl)},exports.getSelectionById=function(id){var $$item=$("#s-m-app-id #"+id);return $$item.length<=0?null:{$$elmt:$$item,id:id}},exports.getSelectionData=function(sel){if(!sel||!sel.id)return null;var article=$.extend(!0,{},authCommons.getCurrentPage().getArticle()),title,type,page,control=exports.findControl(sel.$$elmt);control&&!control.isLayout()?(title=control.prototype&&control.prototype.data("$title"),title?title+=" ("+control.$bind+")":title=control.$bind,type=control.typeName):control?(title=locale.text("auth.label_layout"),type=control.typeName):sel.$$elmt.hasClass("s-m-page")&&(page=pageBase.findPage(sel.id));var articleSelection=control&&control.getArticle()||authCommons.getCurrentPage().getArticle();return{articlePage:article,articleSelection:articleSelection,title:title,type:type,control:control,page:page}};var _PropertyPanel=function($$parent){this.$$parent=$$parent,this.destroyHandlers=[],this.propInstances=[],this.destroy=function(){this.destroyHandlers.forEach(function(h){h&&h()}),this.propInstances.forEach(function(p){p.destroyMarkup&&p.destroyMarkup()}),this.destroyHandlers=this.propInstances=null,this.$$parent&&this.$$parent.empty()},this.addDestroyHandler=function($$content,prop){this.destroyHandlers.push(jsutils.bindFn(prop.destroyMarkup,null,$$content,prop))},this.addPropInstance=function(prop){this.propInstances.push(prop)}};exports.createPropertyPanel=function($$parent,sel,data){var props=authProps.getProperties(sel,data);if(!props)return;var propertyPanel=new _PropertyPanel($$parent),$$accord=$('<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">'),id,num=0,toDestroy=[],article=sel.articleSelection,topButtons=[];return props.forEach(function(prop){id="auth_prop_"+prop.name;var expanded=!1;if(prop.createMarkup){var $$block=$(authHtml.execute("authPanelPropertyGroup",{id:id,expanded:expanded,label:prop.label,type:prop.type||"default"})),$$content=$("#collapse_"+id,$$block);prop.createMarkup($$content,prop,sel,data),$.isPlainObject(prop)&&prop.destroyMarkup?propertyPanel.addDestroyHandler($$content,prop):prop.constructor&&propertyPanel.addPropInstance(prop),prop.isHidden===!0&&$$block.hide()}else if(prop.createButtonMarkup)topButtons.unshift(prop);else if(prop.applyMarkup)prop.applyMarkup($$accord,prop,sel,data);else if(prop.isSeparatror)var $$block=$(authHtml.execute("authPanelPropertySeperator",{id:id,expanded:expanded,label:prop.label,type:prop.type||"default"}));$$accord.append($$block),num++}),topButtons.forEach(function(prop){notifications.publish("sm.auth.top.button","add",prop)}),$$parent.append($$accord),_openPanels.forEach(function(id){$$parent.find("#"+id).collapse({toggle:!0})}),propertyPanel},exports.refreshPropertyPanels=function(sel,data){var props=authProps.getProperties(sel,data);if(!props)return;props.forEach(function(prop){if(prop.refreshMarkup){var id="#collapse_auth_prop_"+prop.name,$$panel=$(id);prop.refreshMarkup($$panel,prop,sel,data)}})},exports.savePanelStates=function(){_openPanels=[],$(".collapse.in","#authPanelControlSimple").each(function(){_openPanels.push($(this).attr("id"))})},exports.getPageVariants=function(page){return authoringSData.getPageVariants(page.getAuthoringName())},exports.getPageViews=function(page){return authoringSData.getPageViews(page.getAuthoringFullName())},exports.saveAuthoring=function(page,opts){var isCreation,_views,_variants,_variant,segs=page.getAuthoringName().split(".");return $.smResolve().then(function(){var pageData={application:segs[0],contract:segs[1],representation:segs[2],facet:segs[3],roles:[],users:[],endpoints:[],saveAsOption:opts.variantType,variantCode:opts.code,variantTitle:opts.title,variantDescription:opts.description,article:opts.article,variant:opts.uuid};return pageData.saveAsOption==="personal_copy"&&pageData.users.push({$uuid:authCommons.getCurrentUserUuid()}),authoringSData.savePageDefinition(pageData)}).then(function(variant){return _variant=variant,exports.getPageVariants(page)}).then(function(variants){return _variants=variants,exports.getPageViews(page)}).then(function(views){return _views=views,_updatePageMetaData(page,_variant,_variants,_views,opts.article)})},exports.getPropertiesVariants=function(page){var propertiesVariants=[],properties={},viewSelected,isPersonal,self=this,views=page.pageData.page.$views||[];return!views||!views.length||!page.variants||page.variants.length===0?propertiesVariants:(viewSelected=$.smFind(views,function(view){return view.$selected}),page.variants.forEach(function(variant){isPersonal=!variant.$factory&&(!variant.roles||!variant.roles.length)&&(!variant.endpoints||!variant.endpoints.length)&&variant.users&&variant.users.length===1,properties={description:variant.description,isFactory:variant.$factory,isPersonal:isPersonal,isGlobal:!variant.$factory&&!isPersonal,title:variant.title,code:variant.code,comment:variant.comment,factoryOwner:variant.$factoryOwner,uuid:variant.$uuid,isSelected:viewSelected!=null&&viewSelected.$url&&viewSelected.$url.indexOf(variant.$uuid)>-1},propertiesVariants.push(properties)}),propertiesVariants)},exports.getPropertiesCurrentVariant=function(page){var properties={},views=page.pageData.page.$views||[];if(!views||!views.length||!page.variants||!page.variants.length)return properties;var viewSelected=$.smFind(views,function(view){return view.$selected});if(!viewSelected)return properties;var variantSelected=$.smFind(page.variants,function(variant){return viewSelected.$url.indexOf(variant.$uuid)>-1?!0:!1});if(!variantSelected)return properties;var isPersonal=!viewSelected.$isFactory&&!variantSelected.roles.length&&!variantSelected.endpoints.length&&variantSelected.users.length===1;return properties={description:viewSelected.$description,isFactory:viewSelected.$isFactory,isPersonal:isPersonal,isGlobal:!viewSelected.$isFactory&&!isPersonal,title:viewSelected.$title,url:viewSelected.$url,code:variantSelected.code,comment:variantSelected.comment,factoryOwner:variantSelected.$factoryOwner,uuid:variantSelected.$uuid},properties},exports.rebuildArticleByPageStruct=function(page,states){function _copyLocNode(uuid){Object.keys($localization).forEach(function(lang){var texts=$localizationNew[lang]=$localizationNew[lang]||{};texts[uuid]=$localization[lang][uuid]})}function _findLocMatch(text){var oldTexts=$localization[curLang]||{},match;return Object.keys(oldTexts).some(function(uuid){return oldTexts[uuid]===text?(match=uuid,!0):!1}),match}function _checkLocalization(nodeArticle){var propsPerNode=["$title"];propsPerNode.forEach(function(key){var text=nodeArticle[key];nodeArticle.$theme==="advanced"&&(text="",nodeArticle[key]="");if(text){var uuid=text.match(/\{\@(\S+)\}/);if(uuid&&uuid[1])_copyLocNode(uuid[1]);else{uuid=_findLocMatch(text);if(!uuid){var keepKey=nodeArticle.keepKey?nodeArticle.keepKey.match(/\{\@(\S+)\}/):null;uuid=keepKey?keepKey[1]:utils.UUID(),keepKey&&(_copyLocNode(uuid),delete nodeArticle.keepKey);var texts=$localizationNew[curLang]=$localizationNew[curLang]||{};texts[uuid]=text}else _copyLocNode(uuid);nodeArticle[key]="{@"+uuid+"}"}}})}function _walkNode(article,node){var nodeArticle=node.getAuthArticle();_checkLocalization(nodeArticle);if(states){var state=node.getAuthState(nodeArticle.$isDirty||{});if(state){var path=node.getPathInTree();path=path.join("."),states[path]=state}}delete nodeArticle.$isDirty,Object.keys(nodeArticle).forEach(function(key){article[key]=nodeArticle[key]});if(node.isVignette()){var page=node.getTopPage();if(page){var rootLayout=page.rootLayout;article.$article={},_walkNode(article.$article,rootLayout)}}else!node.excludeChildrenFromAuthoring()&&node.children&&node.children.length>0&&(article.$items=[],node.children.forEach(function(child){var childArticle={};article.$items.push(childArticle),_walkNode(childArticle,child)}))}var curLang=locale.getCurrentLocale(),rootLayout=page.rootLayout,$localization=page.getArticle()&&page.getArticle().$localization||{},$localizationNew={},jsonArticlePage={};_authCopyPageProperties(page,jsonArticlePage),_walkNode(jsonArticlePage,rootLayout),jsonArticlePage.$localization=$localizationNew;var articleJSON=authVal.toSortedJSON(jsonArticlePage);return articleJSON}}),define("syracuse-tablet/html/js/authoring/authoringPanelRight",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/authoring/authoringCommons"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),environment=require("syracuse-tablet/html/js/helpers/environment"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons");exports.Panel=utils.defineClass(function AuthoringPanelRight(){var self=this;self.$$panel=null,self.topButtons=[]},null,{show:function(){var self=this;self._ensurePanel(),self._subscribe(),self.$$panel.show(),self.$$splitter.show(),self._minWidth=4*siteLayout.splitterWidth,self._initDefaults(),$("#authPanelControl .btn",self.$$panelSave).eq(0).button("toggle"),$('.nav-pills a[href="#authPanelControl"]').tab("show")},hide:function(){var self=this;self._ensurePanel(),self.$$panel.hide(),self.$$splitter.hide(),self._unscribe(),self.$$panel.empty(),self.$$panel=null},_subscribe:function(){var self=this;notifications.subscribe(self,["sm.main.layout.changed"]),notifications.subscribe(self,["sm.auth.set.page"]),notifications.subscribe(self,["sm.auth.set.selection"]),notifications.subscribe(self,["sm.auth.top.button"])},_unscribe:function(){var self=this;notifications.unsubscribe(self,["sm.main.layout.changed"]),notifications.unsubscribe(self,["sm.auth.set.page"]),notifications.unsubscribe(self,["sm.auth.set.selection"]),notifications.unsubscribe(self,["sm.auth.top.button"])},notifMainLayoutChanged:function(){var self=this;self.$$panel.find(".tab-content").css({height:self.$$panel.height()-100})},_ensurePanel:function(){var self=this;if(this.$$panel)return;var ctx={label_design:locale.text("auth.panel.label_design"),label_openCardDesign:locale.text("auth.openCardDesign")};self.$$panel=$("#s-m-auth-panel-right-id"),$(authHtml.execute("authPanelRightStructure",ctx)).appendTo(self.$$panel),self._getDomObjects(),self._initSplitter(),self._initDomEvents()},_getDomObjects:function(){var self=this;self.$$panelRightStruct=self.$$panel.find("#authPanelControlTitle"),self.$$panelControlSimple=$("#authPanelControlSimple"),self.$$panelControlExpert=$("#authPanelControlExpert"),self.$$panelControlTitle=$("#authPanelControlTitle"),self.$$panelControlType=$("#authPanelControlType"),self.$$panelControlChild=$("#s-m-auth-child-design-open-id"),self.$$panelEdit=$("#authPanelEdit")},_initDomEvents:function(){var self=this;self.$$panelControlChild.on("click",self._onChildClick.bind(self))},_initDefaults:function(){var self=this;self.$$panelControlTitle.text(""),self.$$panelControlType.text(locale.text("auth.panel.label_design")),self.destroyPropertyPanel()},destroyPropertyPanel:function(context){if(this.topButtons){var preserveButtons=[];this.topButtons.forEach(function(prop){prop.destroyButtonMarkup&&prop.destroyButtonMarkup(context)===!1&&preserveButtons.push(prop)}),this.topButtons=preserveButtons}this._propertyPanel&&(this._propertyPanel.destroy(),this._propertyPanel=null)},notifAuthSetPage:function(page){var self=this;self.currentPageName=page.getAuthoringName(),self._initDefaults(),self._checkDetailNavigation(null,null)},notifAuthSetSelection:function(id){var self=this;self.$$panelControlTitle.text(""),self.$$panelControlType.text(locale.text("auth.panel.label_design"));var sel=id?authHelpers.getSelectionById(id):null;authHelpers.savePanelStates(),self.destroyPropertyPanel({origin:"selection"});var data;if(sel){data=authHelpers.getSelectionData(sel);if(data){self.$$panelControlTitle.text(data.title||""),self.$$panelControlType.text(locale.text("auth.panel.label_design")+" "+(data.type||""));var article=data.articleSelection;article&&(this._propertyPanel=authHelpers.createPropertyPanel(self.$$panelControlSimple,sel,data));if(environment.isAutoUITestMode()){var id=data.control?data.control.getUnitTestId():data.page?data.page.getPageName():null;environment.getUnitTestMgr().authAddRightPanelId(self.$$panelControlTitle.parent(),id)}}}self._checkDetailNavigation(sel,data)},_initSplitter:function(){var self=this;self.$$splitter=$("#s-m-auth-splitter-right-id"),self.$$splitter.draggable({axis:"x",stop:function(e,ui){var $$splitter=$(this),pos=$$splitter.position(),width=$$splitter.width(),panelRightSize=Math.max(self._minWidth,$(window).width()-pos.left-width);$$splitter.css({left:$(window).width()-panelRightSize-width+"px"}),authHelpers.triggerResizeInternal({layout:{authPanelRight:{width:panelRightSize}}})}})},notifAuthTopButton:function(action,prop){if(!this.$$panelRightStruct||!prop.createButtonMarkup)return;this.topButtons.push(prop),this.$$panelRightStruct.after(prop.createButtonMarkup(this.getPage()))},_checkDetailNavigation:function(sel,data){var self=this,page=authCommons.getCurrentPage();page&&!page.isCardDetail()&&data&&data.control&&data.control.$display==="card"?self.$$panelControlChild.show():self.$$panelControlChild.hide()},_onChildClick:function(){notifications.publish("sm.auth.open.card.design")}})}),define("syracuse-tablet/html/js/authoring/authoringDrag",["require","exports","module","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _updateHoverStack(){var newList=[];$.each(_$$lastElements,function(idx,$$last){$$last.removeClass("s-m-top-stack"),$$last.hasClass("s-m-auth-hover-droptarget")&&newList.push($$last)});var $$last=newList[newList.length-1];return $$last&&$$last.addClass("s-m-top-stack"),_$$lastElements=newList,$$last}function _updateDragHelper($$drop,$$helper,$$draggable){var data=_getDropData($$drop,$$draggable),allowed=_isDropAllowed(data);$$helper.removeClass("drop_move"),$$helper.removeClass("drop_add"),$$helper.removeClass("drop_disabled");if(!allowed){$$helper.addClass("drop_disabled"),$("#s-m-auth-drag-helper-desc-id",$$helper).text("");return}var desc="",title;data.moveBeforeCtrl?title=_controlTitle(data.moveBeforeCtrl):title=_controlTitle(data.toContainer);switch(data.action){case"add_layout":data.moveBeforeCtrl?desc=locale.text("auth.drag.add.before",[title]):desc=locale.text("auth.drag.add.intoend",[title]),$$helper.addClass("drop_add");break;case"add_bind":data.moveBeforeCtrl?desc=locale.text("auth.drag.add.before",[title]):desc=locale.text("auth.drag.add.intoend",[title]),$$helper.addClass("drop_add");break;case"move_ctrl":data.moveBeforeCtrl?desc=locale.text("auth.drag.move.before",[title]):desc=locale.text("auth.drag.move.intoend",[title]),$$helper.addClass("drop_move");break;case"move_layout":data.moveBeforeCtrl?desc=locale.text("auth.drag.move.before",[title]):desc=locale.text("auth.drag.move.intoend",[title]),$$helper.addClass("drop_move")}$("#s-m-auth-drag-helper-desc-id",$$helper).text(desc)}function _isDropAllowed(data){if(!data.toType)return!1;var targetLayout,container;data.ctrl&&(data.container=data.ctrl.parent),data.toCtrl&&data.toCtrl.isLayout()?(container=data.toCtrl,targetLayout=data.toType):data.toCtrl&&(container=data.toCtrl.parent,targetLayout=container.$type,data.moveBeforeCtrl=data.toCtrl),data.toContainer=container;if(data.action==="add_layout"){if(data.bind=="stack"){if(targetLayout!=="stack"&&targetLayout!=="cell"&&targetLayout!=="tile")return!1}else if(data.bind=="group"){if(targetLayout!=="stack"&&targetLayout!=="hub")return!1}else if(data.bind=="tile"&&targetLayout!=="row"&&targetLayout!=="hubGroup"&&targetLayout!=="stack"&&targetLayout!=="hub")return!1;return!0}if(data.action==="add_bind"){if(data.parent!=data.toParent)return!1;if(targetLayout==="stack"||targetLayout==="tile"||targetLayout==="cell"||targetLayout==="hubGroup")return!0}if(data.action==="move")if(data.ctrl&&!data.ctrl.isLayout()){data.action="move_ctrl";if(data.parent!=data.toParent)return!1;if(targetLayout==="stack"||targetLayout==="tile"||targetLayout==="cell"||targetLayout==="hubGroup")return!0}else if(data.ctrl&&data.ctrl.isLayout()){data.action="move_layout";if(data.type=="stack"){if(targetLayout!=="stack"&&targetLayout!=="cell"&&targetLayout!=="tile")return!1}else if(data.type=="tile"){if(targetLayout!=="hubGroup")return!1}else if(data.type=="cell"){if(targetLayout!=="row")return!1}else if(data.type=="row"){if(targetLayout!=="stack"&&targetLayout!=="cell"&&targetLayout!=="tile")return!1}else if(data.type=="hubGroup"&&targetLayout!=="hub")return!1;var $$dropToChildren=data.toCtrl.$$elmt.closest("#"+data.ctrl.id);if($$dropToChildren.length>0)return!1;var vignetteScopeOk=!0,$$fromVignette=data.ctrl.$$elmt.closest(".s-m-control.s-m-vignette"),$$toVignette=data.toCtrl.$$elmt.closest(".s-m-control.s-m-vignette");return $$fromVignette.length!==$$toVignette.length?vignetteScopeOk=!1:$$toVignette.length===0?vignetteScopeOk=!0:$$fromVignette.length===1&&$$toVignette.length===1&&($$fromVignette.attr("id")===$$toVignette.attr("id")?vignetteScopeOk=!0:vignetteScopeOk=!1),vignetteScopeOk}return!1}function _getDropData($$drop,$$draggable){var action,fromId,toId,bind,parent;action=$$draggable.attr("data-auth-drag-action");switch(action){case"move":fromId=$$draggable.attr("data-ctrl-id");break;case"add_bind":bind=$$draggable.attr("data-auth-bind"),parent=$$draggable.attr("data-auth-bind-parent"),parent=parent===""?null:parent;break;case"add_layout":bind=$$draggable.attr("data-auth-bind");break;default:action="move",fromId=$$draggable.attr("id")}var ctrl,$$ctrl;if(fromId&&fromId.length>0){$$ctrl=$("#"+fromId),ctrl=authHelpers.findControl($$ctrl);var v=ctrl&&ctrl.page.vignette;v&&(parent=v.$bind)}toId=$$drop.attr("data-ctrl-id"),toId&&toId.length>0?$$ctrl=$("#"+toId):(toId=$$drop.attr("id"),$$ctrl=$$drop);var toParent,toCtrl=authHelpers.findControl($$ctrl);toCtrl&&!toCtrl.page&&(toCtrl=null);if(toCtrl){var v=toCtrl.page.vignette;v&&(toParent=v.$bind)}return!toCtrl&&$$ctrl.is(".s-m-page,.s-m-full")&&(toCtrl=authCommons.getCurrentPage().getRootLayout()),{action:action,bind:bind,ctrl:ctrl,type:ctrl&&ctrl.$type,parent:parent,fromId:fromId,toId:toId,toType:toCtrl&&toCtrl.$type,toCtrl:toCtrl,toParent:toParent}}function _addLayout(data){var layoutType="stack",toContainer=data.toContainer,parent;switch(data.bind){case"group":data.toType=="hub"?layoutType="hubGroup":layoutType="row";break;case"tile":data.toType=="hubGroup"?layoutType="tile":data.toType=="row"?layoutType="cell":data.toType=="stack"?(parent=_createLayout(data.toCtrl.controller,toContainer,{$layoutType:"row"},{}),layoutType="cell",toContainer=parent):data.toType=="hub"&&(parent=_createLayout(data.toCtrl.controller,toContainer,{$layoutType:"hubGroup"},{}),layoutType="tile",toContainer=parent);break;case"stack":layoutType="stack"}var article={$layoutType:layoutType},ctrl=_createLayout(data.toCtrl.controller,toContainer,article,{});data.moveBeforeCtrl&&(parent?(data.toContainer.removeChildRef(parent),data.toContainer.addChildBefore(parent,data.moveBeforeCtrl)):(toContainer.removeChildRef(ctrl),toContainer.addChildBefore(ctrl,data.moveBeforeCtrl))),notifications.publish(["sm.auth.change.item.prop.ui"])}function _addBind(data){var article={$bind:data.bind},toContainer=data.toContainer;if(data.toType=="hubGroup"){var parent=_createLayout(data.toCtrl.controller,toContainer,{$layoutType:"tile"},{});toContainer=parent}var ctrl=_createBindControl(data.toCtrl.controller,toContainer,article,{});data.moveBeforeCtrl&&(data.toContainer.removeChildRef(ctrl),data.toContainer.addChildBefore(ctrl,data.moveBeforeCtrl)),notifications.publish(["sm.auth.change.item.prop.ui"])}function _moveControl(data){data.container.removeChildRef(data.ctrl);var toContainer=data.toContainer;if(data.toType=="hubGroup"){var parent=_createLayout(data.toCtrl.controller,toContainer,{$layoutType:"tile"},{});toContainer.removeChildRef(parent),toContainer.addChildBefore(parent,data.moveBeforeCtrl),parent.addChildBefore(data.ctrl,null)}else toContainer.addChildBefore(data.ctrl,data.moveBeforeCtrl);notifications.publish(["sm.auth.change.item.prop.ui"])}function _moveLayout(data){data.container.removeChildRef(data.ctrl),data.toContainer.addChildBefore(data.ctrl,data.moveBeforeCtrl),notifications.publish(["sm.auth.change.item.prop.ui"])}function _controlTitle(ctrl){var title=ctrl.prototype&&ctrl.prototype.data("$title");return title?ctrl.$bind&&(title=title+" ("+ctrl.$bind+")"):title=ctrl.$bind,title||(title=ctrl.$type),title}function _createLayout(controller,parent,article,opts){return modules.get("ctrlFactory").createControl(controller,article,parent,null,opts)}function _createBindControl(controller,parent,article,opts){return modules.get("ctrlFactory").createControl(controller,article,parent,null,opts)}var authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),locale=require("syracuse-tablet/html/js/helpers/locale"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),modules=require("syracuse-tablet/html/js/common/modules"),_$$lastElements=[];exports.getClosestDragElement=function($$source){var $$draggable=$$source.closest(".ui-draggable");return $$draggable},exports.dropDrop=function($$drop,$$helper,$$draggable){$$drop=_$$lastElements.length>0&&_$$lastElements[_$$lastElements.length-1],_$$lastElements=[];if(!$$drop)return;var data=_getDropData($$drop,$$draggable);if(!_isDropAllowed(data))return;data.action==="add_layout"?_addLayout(data):data.action=="add_bind"?_addBind(data):data.action=="move_ctrl"?_moveControl(data):data.action=="move_layout"&&_moveLayout(data)},exports.dropAccept=function($$drop,$$draggable){var data=_getDropData($$drop,$$draggable);return!0},exports.dropOut=function($$drop,$$helper,$$draggable){$$drop.removeClass("s-m-top-stack");var $$top=_updateHoverStack();$$top&&_updateDragHelper($$top,$$helper,$$draggable)},exports.dropOver=function($$drop,$$helper,$$draggable){_$$lastElements.push($$drop),_updateHoverStack(),_updateDragHelper($$drop,$$helper,$$draggable)}}),define("syracuse-tablet/html/js/authoring/authoringPanelLeft",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/authoring/authoringDrag","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/ui/siteLayout"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),authDrag=require("syracuse-tablet/html/js/authoring/authoringDrag"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),environment=require("syracuse-tablet/html/js/helpers/environment"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),$$lastHoverList;exports.Panel=utils.defineClass(function AuthoringPanelLeft(){var self=this;self.$$panel=null,self.$$page=$("#s-m-app-id"),self._bindsOnPage=[]},null,{show:function(){var self=this;self._ensurePanel(),self._subscribe(),self.$$panel.show(),self.$$splitter.show(),self._minWidth=2*siteLayout.splitterWidth,self.$$panel.find(".s-m-site-auth-panel-content > ul.nav.nav-pills > li").each(function(){self._minWidth+=$(this).outerWidth()})},hide:function(){var self=this;self._ensurePanel(),self.$$panel.hide(),self.$$splitter.hide(),self._unscribe(),self.$$panel.empty(),self.$$panel=null},_subscribe:function(){var self=this;notifications.subscribe(self,["sm.main.layout.changed"]),notifications.subscribe(self,["sm.auth.set.page"]),notifications.subscribe(self,["sm.auth.set.selection"]),notifications.subscribe(self,["sm.auth.remove.selection"]),notifications.subscribe(self,["sm.auth.hover.in"]),notifications.subscribe(self,["sm.auth.hover.out"])},_unscribe:function(){var self=this;notifications.unsubscribe(self,["sm.main.layout.changed"]),notifications.unsubscribe(self,["sm.auth.set.page"]),notifications.unsubscribe(self,["sm.auth.set.selection"]),notifications.unsubscribe(self,["sm.auth.remove.selection"]),notifications.unsubscribe(self,["sm.auth.hover.in"]),notifications.unsubscribe(self,["sm.auth.hover.out"])},notifMainLayoutChanged:function(){var self=this;$("#s-m-auth-tree-box",self.$$panel).css({height:self.$$panel.height()-45}),$("#s-m-auth-insert-box",self.$$panel).css({height:self.$$panel.height()-40})},_ensurePanel:function(){var self=this;if(this.$$panel)return;var ctx={label_content:locale.text("auth.panel.label_content"),label_insert:locale.text("auth.panel.label_insert"),label_containers:locale.text("auth.panel.label_containers"),label_fields:locale.text("auth.panel.label_fields"),lab_drag_to_add:locale.text("auth.label_layout.drag"),lab_group:locale.text("auth.label_layout.group"),lab_tile:locale.text("auth.label_layout.tile"),lab_stack:locale.text("auth.label_layout.stack")};self.$$panel=$("#s-m-auth-panel-left-id"),self.$$panel.append($(authHtml.execute("authPanelLeftStructure",ctx))),self._getDomObjects(),self._initSplitter()},_getDomObjects:function(){var self=this;self.$$structureRoot=$("#auth-structure-root-id",self.$$panel),self.$$prototypeRoot=$("#auth-lp-cnt-props-clpse",self.$$panel)},_initSplitter:function(){var self=this;self.$$splitter=$("#s-m-auth-splitter-left-id"),self.$$splitter.draggable({axis:"x",stop:function(e,ui){var $$splitter=$(this),pos=$$splitter.position(),width=$$splitter.width(),panelLeftSize=Math.max(self._minWidth,pos.left);$$splitter.css({left:panelLeftSize+"px"}),authHelpers.triggerResizeInternal({layout:{authPanelLeft:{width:panelLeftSize}}})}})},notifAuthSetPage:function(page){var self=this;self._resetContent(page.getArticle())},notifAuthSetSelection:function(id){var self=this,$$item=self._getItemById(id);if($$item.length>0){$$item.addClass("s-m-auth-selected");var $$tb=$("#s-m-auth-tree-box",self.$$panel),o1=$$tb.offset(),o2=$$item.offset();if(o2.top<o1.top||o2.top>o1.top+$$tb.height()){var scroll=o2.top-(o1.top+$$tb.height()/2);$("#s-m-auth-tree-box",self.$$panel).animate({scrollTop:scroll},500)}}},notifAuthRemoveSelection:function(id){var self=this,$$item=self._getItemById(id);$$item.removeClass("s-m-auth-selected")},notifAuthHoverIn:function(id){var self=this,$$item=self._getItemById(id);$$item.addClass("s-m-auth-hover")},notifAuthHoverOut:function(id){var self=this,$$item=self._getItemById(id);$$item.removeClass("s-m-auth-hover")},_getItemById:function(id){var self=this;return $('[data-ctrl-id="'+id+'"]',self.$$panel)},_resetContent:function(article){var self=this;self._buildPageStructTree(),self._buildProtoStructTree(),self._initDomEvents(),self._initDrag()},_buildPageStructTree:function(){function _walkNode(node,$$parent,bindParent,level){var nodeArticle=node.getArticle(),id=node.id,typeClass,label;if(level===1){node.children&&node.children.length>0&&node.children.forEach(function(child){if(child.article.$noAuthoring)return;var $$ul=$('<ul class="s-m-auth-tree">').appendTo($$parent);_walkNode(child,$$ul,bindParent,level+1)});return}if(!node.isLayout()){var title=node.prototype&&node.prototype.data("$title");typeClass=node.typeName,label=title?title:nodeArticle.$bind;var bind=bindParent!=null?bindParent+"."+node.$bind:node.$bind;self._bindsOnPage.push(bind)}else typeClass=nodeArticle.$layoutType||node.typeName,label=nodeArticle.$title?node.getArticleText("$title")+" ("+typeClass+")":typeClass;var $$item=$('<li class="s-m-auth-tree s-m-auth-tree-'+typeClass+'">').appendTo($$parent);if(environment.isAutoUITestMode()&&node.getUnitTestId){var i=node.getUnitTestId();i&&environment.getUnitTestMgr().authAddTreeElmtId($$item,i)}var $$p=$('<p title="'+nodeArticle.$bind+'" data-ctrl-id="'+id+'" class="s-m-draggable s-m-droppable" data-auth-drag-action="move">'+label+"</p>");$$item.append($$p);if(node.isVignette()){self._bindsOnPage.push(node.$bind);var page=node.getTopPage();if(page){var rootLayout=page.rootLayout,$$ul=$('<ul class="s-m-auth-tree">').appendTo($$item),$$li=_walkNode(rootLayout,$$ul,node.$bind,level+1);$(">p",$$li).removeClass("s-m-draggable")}}else!node.excludeChildrenFromAuthoring()&&node.children&&node.children.length>0&&node.children.forEach(function(child){if(child.article.$noAuthoring)return;var $$ul=$('<ul class="s-m-auth-tree">').appendTo($$item);_walkNode(child,$$ul,bindParent,level+1)});return $$item}var self=this;self._bindsOnPage=[];var page=authCommons.getCurrentPage(),rootLayout=page.rootLayout,label=page.getPrototype().data("$title")||locale.text("page");self.$$structureRoot.empty();var $$item=$('<li class="s-m-auth-tree s-m-auth-tree-page">').appendTo(self.$$structureRoot);$$item.append('<p data-ctrl-id="'+page.id+'">'+label+"</p>");var $$ul=$('<ul class="s-m-auth-tree">').appendTo($$item),$$li=_walkNode(rootLayout,$$ul,null,1);$(">p",$$li).removeClass("s-m-draggable")},_buildProtoStructTree:function(){var self=this,page=authCommons.getCurrentPage(),label=page.getPrototype().data("$title");self.$$prototypeRoot.empty();var $$item=$('<li class="s-m-auth-tree s-m-auth-tree-page">').appendTo(self.$$prototypeRoot);$$item.append('<p data-ctrl-id="'+page.id+'">'+label+"</p>");var $$ul=$('<ul class="s-m-auth-tree">').appendTo($$item);if(jsutils.isInstanceOf(page,"PageSdataDashboard")){var pageProto=page.getPrototype(),props=pageProto.getPropertyNames();props.forEach(function(key){var prop=pageProto.getValueByPath("$properties."+key);prop&&(prop.$type==="application/x-vignette"||prop.$type==="application/x-vignette-link")&&self._addVignette(page,prop.$type,key,$$ul)})}else self._addPage(page,$$ul)},_addVignette:function(page,$type,vignette,$$parent){var self=this,proto=page.getPrototype(),title=proto.getValueByPath("$properties."+vignette+".$title"),label=title?title+" ("+vignette+")":vignette,$$item=$('<li class="s-m-auth-tree s-m-auth-tree-vignette">').appendTo($$parent);$$item.append('<p class="s-m-draggable" data-auth-bind="'+vignette+'"  data-auth-drag-action="add_bind">'+label+"</p>");var ctrlVignette=page.controller.getControlsByBind(vignette);ctrlVignette=ctrlVignette&&ctrlVignette[0];if(ctrlVignette){$$item.removeClass("s-m-draggable"),$$item.addClass("disabled");if($type==="application/x-vignette"){page=ctrlVignette.getTopPage();if(page){var $$ul=$('<ul class="s-m-auth-tree">').appendTo($$item);self._addPage(page,$$ul,vignette);var $$children=$("li",$$ul);self._bindsOnPage.indexOf(vignette)>-1&&$$children.length<=0&&$$item.remove(),$$children.length<=0&&$$ul.remove()}}else self._bindsOnPage.indexOf(vignette)>-1&&$$item.remove()}},_addPage:function(page,$$parent,bindParent){var self=this,label="?",proto=page.getPrototype(),props=proto.getPropertyNames();props.forEach(function(key){if(proto.getPropertyData(key,"$isExcluded")!==!0){var bind=bindParent!=null?bindParent+"."+key:key;if(self._bindsOnPage.indexOf(bind)<0){var title=proto.getPropertyData(key,"$title"),type=proto.getPropertyData(key,"$type"),typeClass=utils.getTypeName(type),label=title?title+" ("+key+")":key,$$item=$('<li class="s-m-auth-tree s-m-auth-tree-'+typeClass+'">').appendTo($$parent);$$item.append('<p class="s-m-draggable" data-auth-bind="'+key+'" data-auth-bind-parent="'+(bindParent||"")+'" data-auth-drag-action="add_bind">'+label+"</p>")}}})},_initDomEvents:function(){var self=this;$("li.s-m-auth-tree > p",$("#auth-structure-root-id")).not("li.s-m-auth-hidden > p").mouseover(function(e){var $$o=$(e.currentTarget);if($$lastHoverList){$$lastHoverList.removeClass("s-m-auth-hover");var id=$$lastHoverList.attr("id");notifications.publishEx(["sm.auth.hover.out"],{exclude:[self]},id)}$$o.addClass("s-m-auth-hover"),$$lastHoverList=$$o;var id=$$o.attr("data-ctrl-id");return notifications.publishEx(["sm.auth.hover.in"],{exclude:[self]},id),!1}),$("li.s-m-auth-tree > p",$("#auth-structure-root-id")).not("li.s-m-auth-hidden > p").mouseout(function(e){var $$o=$(e.currentTarget);$$o.removeClass("s-m-auth-hover");var id=$$o.attr("data-ctrl-id");notifications.publishEx(["sm.auth.hover.out"],{exclude:[self]},id)}),$("li.s-m-auth-tree > p",$("#auth-structure-root-id")).not("li.s-m-auth-hidden > p").click(function(e){return self.setSelection($(e.currentTarget),!1),!1}),$("li.s-m-auth-tree > p",$("#auth-structure-root-id")).not("li.s-m-auth-hidden > p").dblclick(function(e){return self.makeVisibleInPage($(e.currentTarget)),!1})},setSelection:function($$newSel,noScroll){var self=this,$$old=$(".s-m-auth-selected",self.$$panel);$$old.removeClass("s-m-auth-selected");var id=$$old.attr("data-ctrl-id");notifications.publishEx(["sm.auth.remove.selection"],{exclude:[self]},id),$$newSel?($$newSel.addClass("s-m-auth-selected"),id=$$newSel.attr("data-ctrl-id")):id=null,notifications.publishEx(["sm.auth.set.selection"],{exclude:[self]},id,noScroll==null?!0:noScroll)},makeVisibleInPage:function($$sel){var self=this;self.setSelection($$sel,!1)},_initDrag:function(){var self=this,dragParam={scroll:!1,containment:$("body"),helper:function(event){var $$source=$(event.target);return self._createDragHelper($$source)},appendTo:"body"};$(".s-m-draggable",self.$$panel).draggable(dragParam),$(".s-m-droppable",self.$$structureRoot).droppable({greedy:!0,hoverClass:"s-m-auth-hover-droptarget",tolerance:"pointer",drop:function(event,ui){var $$helper=ui.helper,$$draggable=ui.draggable;return authDrag.dropDrop($(this),$$helper,$$draggable)},accept:function($$draggable){return authDrag.dropAccept($(this),$$draggable)},over:function(event,ui){var $$helper=ui.helper,$$draggable=ui.draggable;return authDrag.dropOver($(this),$$helper,$$draggable)}})},_createDragHelper:function($$source){var $$dragSource=authDrag.getClosestDragElement($$source),text;if($$dragSource.attr("data-auth-drag-action")==="add_layout"){var name=$$dragSource.attr("data-auth-bind");text=locale.text("auth.drag."+name)}else text=$$dragSource.text();var $$helper=$('<div class="s-m-auth-drag-helper"><p id="s-m-auth-drag-helper-label-id">&nbsp;</p><p id="s-m-auth-drag-helper-desc-id">&nbsp;</p><div style="clear:both;"></div></div>');return $("#s-m-auth-drag-helper-label-id",$$helper).text(text),$$helper[0]}})}),define("syracuse-tablet/html/js/authoring/authoringPage",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/authoring/authoringDrag","syracuse-tablet/html/js/authoring/authoringCommons"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),authDrag=require("syracuse-tablet/html/js/authoring/authoringDrag"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),_selectedRecord="s-m-auth-rec-selected",$$lastHoverElement,_elementsNoAuthoring=[".s-m-array .s-m-control",".s-m-array .s-m-layout",".s-m-control.header",".s-m-control.footer",".s-m-control.navigationpanel",".s-m-control.pageactionpanelregular",".s-m-control.breadcrumbs",".s-m-control.toolbar",".s-m-control.s-m-field > .s-m-value.edit > .s-m-control.s-m-unit",".s-m-layout.s-m-hub",".s-m-main-content > .s-m-scroll-elmt > .s-m-stack",".s-m-main-content > .s-m-stack"];exports.AuthPage=utils.defineClass(function AuthPage(){var self=this;self.__onElementClick=self._onElementClick.bind(self),self.__onElementMouseOver=self._onElementMouseOver.bind(self),self.__onElementMouseOut=self._onElementMouseOut.bind(self),self.$$page=$("#s-m-app-id")},null,{enable:function(){var self=this;self._subscribe()},disable:function(){var self=this;self._unscribe()},enableAuthCss:function(){var self=this;self.disableAuthCss(),$(".s-m-control").addClass("s-m-auth"),$(".s-m-layout").addClass("s-m-auth"),$(".s-m-page").addClass("s-m-auth"),$("section.s-m-card").addClass("s-m-auth"),_elementsNoAuthoring.forEach(function(e){$(e).removeClass("s-m-auth")}),$(".s-m-auth",self.$$page).on("click",self.__onElementClick),$(".s-m-auth",self.$$page).on("mouseover",self.__onElementMouseOver),$(".s-m-auth",self.$$page).on("mouseout",self.__onElementMouseOut),self._enableDrop()},disableAuthCss:function(){var self=this;self._disableDrop();var $$smAuth=$(".s-m-auth",self.$$page);$$smAuth.off("click",self.__onElementClick),$$smAuth.off("mouseover",self.__onElementMouseOver),$$smAuth.off("mouseout",self.__onElementMouseOut),$$smAuth.removeClass("s-m-auth"),$(".s-m-record."+_selectedRecord,self.$$page).removeClass(_selectedRecord)},_subscribe:function(){var self=this;notifications.subscribe(self,["sm.auth.hover.in"]),notifications.subscribe(self,["sm.auth.hover.out"]),notifications.subscribe(self,["sm.auth.set.selection"]),notifications.subscribe(self,["sm.auth.remove.selection"])},_unscribe:function(){var self=this;notifications.unsubscribe(self,["sm.auth.hover.in"]),notifications.unsubscribe(self,["sm.auth.hover.out"]),notifications.unsubscribe(self,["sm.auth.set.selection"]),notifications.unsubscribe(self,["sm.auth.remove.selection"])},_enableDrop:function(){var self=this,dragParam={scroll:!1,containment:$("body"),tolerance:"pointer",helper:function(event){var $$source=$(event.target);return self._createDragHelper($$source)},appendTo:"body",revert:function($$drop){return"invalid"},start:function(){},stop:function(){}};$(".s-m-auth").droppable({greedy:!1,hoverClass:"s-m-auth-hover-droptarget",tolerance:"pointer",drop:function(event,ui){var $$helper=ui.helper,$$draggable=ui.draggable;return authDrag.dropDrop($(this),$$helper,$$draggable)},accept:function($$draggable){return authDrag.dropAccept($(this),$$draggable)},over:function(event,ui){var $$helper=ui.helper,$$draggable=ui.draggable;return authDrag.dropOver($(this),$$helper,$$draggable)},out:function(event,ui){var $$helper=ui.helper,$$draggable=ui.draggable;return authDrag.dropOut($(this),$$helper,$$draggable)}})},_disableDrop:function(){$(".s-m-auth.ui-droppable").droppable("destroy")},_createDragHelper:function($$source){var $$dragSource=authDrag.getClosestDragElement($$source),control=authHelpers.findControl($$dragSource);if(!control)return;var $$helper=$('<p class="s-m-auth-drag-helper">'),text;return control.prototype?(text=control.prototype.data("$title"),text?text=text+"("+control.$bind+")":text=control.$bind):(text=control.title,text?text=text+" ("+control.typeName+")":text=control.typeName),$$helper.text(text),$$helper[0]},_onElementClick:function(e){var self=this,$$o=$(e.currentTarget);if($$o.is("section.s-m-card")){$$o.closest("table").find(".s-m-record."+_selectedRecord).removeClass(_selectedRecord),$$o.closest(".s-m-record").addClass(_selectedRecord);return}var id=this.getCurrentSelected().removeClass("s-m-auth-selected").attr("id");id&&notifications.publishEx(["synch.sm.auth.remove.selection"],{exclude:[self]},id),id=$$o.addClass("s-m-auth-selected").attr("id"),notifications.publishEx(["synch.sm.auth.set.selection"],{exclude:[self]},id);if(utils.stopClickEvent(e))return!1},_onElementMouseOver:function(e){var self=this,$$o=$(e.currentTarget);return $$lastHoverElement&&($$lastHoverElement.removeClass("s-m-auth-hover"),notifications.publishEx(["sm.auth.hover.out"],{exclude:[self]},$$lastHoverElement.attr("id"))),notifications.publishEx(["sm.auth.hover.in"],{exclude:[self]},$$o.attr("id")),$$o.addClass("s-m-auth-hover"),$$lastHoverElement=$$o,!1},_onElementMouseOut:function(e){var self=this,$$o=$(e.currentTarget);$$o.removeClass("s-m-auth-hover"),notifications.publishEx(["sm.auth.hover.out"],{exclude:[self]},$$o.attr("id"))},notifAuthHoverIn:function(id){var self=this,$$pageItem=self._getItemById(id);$$pageItem.addClass("s-m-auth-hover")},notifAuthHoverOut:function(id){var self=this,$$pageItem=self._getItemById(id);$$pageItem.removeClass("s-m-auth-hover")},notifAuthSetSelection:function(id,noScroll){var self=this,$$item=self._getItemById(id);if($$item&&$$item.length>0){$$item.addClass("s-m-auth-selected");if(noScroll!==!0){while(!$$item.is(":visible"))$$item=$$item.parent();self._scrollToVisibleArea($$item)}}},notifAuthRemoveSelection:function(id){var self=this,$$item=self._getItemById(id);$$item.removeClass("s-m-auth-selected")},_getItemById:function(id){return $("#"+id,this.$$page)},getCurrentSelectionId:function(){return this.getCurrentSelected().attr("id")},getCurrentSelected:function(){return $(".s-m-auth-selected:visible",this.$$page)},_scrollToVisibleArea:function($$item){var self=this,page=authCommons.getCurrentPage(),scroller=page&&page.getGestureMgr();scroller&&scroller.makeVisible($$item)}})}),define("syracuse-tablet/html/js/ui/modals/modalChooseDevice",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),modules=require("syracuse-tablet/html/js/common/modules"),_templateAll={header:'			<buttons class="pull-right"> 				<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 			</buttons> 			<div class="modal-title">{{title}}</div> 			',content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">				<div class="form-group s-m-scroll-element"> 					<div class="list-group" id="modal-device-select-list-id"> 						{{#each devices}} 							<a draggable="false" href="#" class="list-group-item" data-action="clickDevice" data-params="{{name}}">{{label}}</a> 						{{/each}} 					</div> 				</div> 		    </div>',footer:""},_Klass=utils.defineClass(function ModalChooseDevice(device){var self=this;modalDialog.ModalBase.call(self),self.selectedDevice=device},modalDialog.ModalBase,{_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="config-tile half_right":displayFlags.modalClass="config-tile full",displayFlags},_getDataContext:function(){var self=this,devices=[],site=modules.get("siteLayout"),devs=site.getDeviceTemplates();for(var dev in devs)devices.push({name:dev,label:locale.textOpt("auth.device."+dev+".title")||dev});var data={title:locale.text("auth.device.title"),devices:devices};return data},_onShow:function(){var self=this;modalDialog.ModalBase.prototype._onShow.call(self),$('a[data-params="'+self.selectedDevice+'"]').addClass("active")},_onValidate:function(){},_onCancel:function(){var self=this;self.selectedApps={}},_onAction:function(action,param){var self=this;return action==="clickDevice"?(self.selectedDevice=param,!0):!1},_getResult:function(){var self=this;return self.selectedDevice}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalNewLayout",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),_templateAll={header:'		<buttons class="pull-right"> 			<button type="button" class="btn btn-default s-m-modal-btn-validate" data-action="$validate"></button> 			<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 		</buttons> 		<div class="modal-title">{{title}}</div> 			',content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">				<div class="alert alert-warning" role="alert"> 					{{warning}} 				</div> 				<div class="form-group" id="dir"> 					<label>{{lab_dir}}</label>         			<div class="btn-group btn-group-vertical btn-group-justified" data-toggle="buttons"> 						<label class="btn btn-primary {{#if horizontal}}active{{/if}}"> 							<input type="radio" id="horizontal" name="scroll" value="horizontal" {{#if horizontal}}checked{{/if}}/>{{lab_horizontal}}						</label> 						<label class="btn btn-primary {{#unless horizontal}}active{{/unless}}"> 							<input type="radio" id="vertical" name="scroll" value="vertical" {{#unless horizontal}}checked{{/unless}}/>{{lab_vertical}}						</label> 					</div> 				</div> 				<div class="form-group" id="tpl"> 					<label>{{lab_tpl}}</label> 					<div class="btn-group btn-group-vertical btn-group-justified" data-toggle="buttons"> 						<label class="btn btn-primary {{#if template}}active{{/if}}"> 							<input type="radio" id="template" name="empty" value="true" {{#if template}}checked{{/if}}/>{{lab_template}}						</label> 						<label class="btn btn-primary  {{#unless template}}active{{/unless}}"> 							<input type="radio" id="empty" name="empty" value="false" {{#unless template}}checked{{/unless}}/>{{lab_empty}}						</label> 					</div> 				</div> 			</div>',footer:""},_Klass=utils.defineClass(function ModalNewLayout(_defaults){var self=this;modalDialog.ModalBase.call(self),self._defaults=_defaults,self.result=null},modalDialog.ModalBase,{_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="half_right":displayFlags.modalClass="full",displayFlags},_getDataContext:function(){var self=this,data={label_validate:locale.text("modal.ok"),label_cancel:locale.text("modal.cancel"),title:locale.text("modal.newlayout.title"),warning:locale.text("modal.newLayout.warning"),lab_horizontal:locale.text("modal.newLayout.horizontal"),lab_vertical:locale.text("modal.newLayout.vertical"),lab_template:locale.text("modal.newLayout.template"),lab_empty:locale.text("modal.newLayout.empty"),lab_dir:locale.text("modal.newLayout.dir"),lab_tpl:locale.text("modal.newLayout.tpl"),horizontal:self._defaults.scroll==="horizontal",template:self._defaults.template};return data},_onValidate:function(){var self=this,dir=self.$$elmt.find("#dir label.active input").val(),tpl=self.$$elmt.find("#tpl label.active input").val();self.result={scroll:dir,template:tpl==="true"}},_onCancel:function(){var self=this;self.result=null},_getResult:function(){var self=this;return self.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/authoring/authoringHeader",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/authoring/authoringHtml","syracuse-tablet/html/js/ui/modals/modalChooseDevice","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/ui/modals/modalNewLayout","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/ui/siteLayout"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml"),modalChooseDevice=require("syracuse-tablet/html/js/ui/modals/modalChooseDevice"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),modalNewLayout=require("syracuse-tablet/html/js/ui/modals/modalNewLayout"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout");exports.Panel=utils.defineClass(function AuthoringPanelHeader(){var self=this;self.$$panel=null},null,{show:function(){var self=this;self._ensurePanel(),self._subscribe(),self.$$panel.show(),self._initDefaults()},hide:function(){var self=this;self._ensurePanel(),self.$$panel.hide(),self._unscribe(),self.$$panel.empty(),self.$$panel=null},_ensurePanel:function(){var self=this;if(this.$$panel)return;var ctx={label_settings:locale.text("auth.device.settings"),label_save:locale.text("auth.panel.label_save"),label_remove:locale.text("auth.panel.label_remove"),label_remove_container:locale.text("auth.panel.label_remove_container"),label_remove_all:locale.text("auth.panel.label_remove_all"),label_new_layout:locale.text("auth.panel.label_new_layout"),label_preview_portrait:locale.text("auth.panel.label_preview_portrait"),label_preview_landscape:locale.text("auth.panel.label_preview_landscape"),label_scale_to_fit:locale.text("auth.panel.label_scale_to_fit"),label_undo:locale.text("auth.label_undo"),label_undo_all:locale.text("auth.label_undo_all")};self.$$panel=$("#s-m-auth-panel-header-id"),self.$$panel.append($(authHtml.execute("authPanelHeader",ctx))),self._getDomObjects(),self._initDomEvents()},_getDomObjects:function(){var self=this;self.$$orientation=$("#s-m-auth-orientation-id",self.$$panel),self.$$removeItem=$("#s-m-auth-remove-id",self.$$panel),self.$$removeCnt=$("#s-m-auth-remove-cnt-id",self.$$panel),self.$$removeAllItems=$("#s-m-auth-remove-all-id",self.$$panel),self.$$newLayout=$("#s-m-auth-new-layout-id",self.$$panel),self.$$undo=$("#auth-btn-undo-id",self.$$panel),self.$$undoAll=$("#auth-btn-undo-all-id",self.$$panel)},_initDomEvents:function(){var self=this;$("#s-m-auth-settings-id").on("click",self._onChooseDevice.bind(self)),$("#s-m-auth-scale-id").on("click",self._onScaleDevice.bind(self)),$("#s-m-auth-vertical-id").on("click",self._onOrientation.bind(self)),$("#s-m-auth-horizontal-id").on("click",self._onOrientation.bind(self)),self.$$removeItem.on("click",self._onRemoveItem.bind(self)),self.$$removeCnt.on("click",self._onRemoveCnt.bind(self)),self.$$removeAllItems.on("click",self._onRemoveAllItems.bind(self)),self.$$newLayout.on("click",self._onNewLayout.bind(self)),self.$$undo.on("click",self._onUndo.bind(self)),self.$$undoAll.on("click",self._onUndoAll.bind(self)),$("#auth-btn-save-id").on("click",self._onSave.bind(self)),$("#auth-btn-close-id").on("click",self._onClose.bind(self))},_initDefaults:function(){var self=this},_subscribe:function(){var self=this;notifications.subscribe(self,["sm.auth.set.page"]),notifications.subscribe(self,["sm.main.layout.changed"]),notifications.subscribe(self,["sm.auth.set.selection"]),notifications.subscribe(self,["sm.auth.history.change"])},_unscribe:function(){var self=this;notifications.unsubscribe(self,["sm.auth.set.page"]),notifications.unsubscribe(self,["sm.main.layout.changed"]),notifications.unsubscribe(self,["sm.auth.set.selection"]),notifications.unsubscribe(self,["sm.auth.history.change"])},notifMainLayoutChanged:function(){var self=this,cur=siteLayout.getCurrentLayoutSettings();cur.pageParameters.forceAutoScale===!0?$("#s-m-auth-scale-id").addClass("active"):$("#s-m-auth-scale-id").removeClass("active"),cur.pageParameters.orientation==="landscape"?($("#s-m-auth-horizontal-id").addClass("active"),$("#s-m-auth-vertical-id").removeClass("active")):($("#s-m-auth-horizontal-id").removeClass("active"),$("#s-m-auth-vertical-id").addClass("active"))},notifAuthSetSelection:function(id){var self=this;self._currentSelectionId=id,self._enableRemoveBtn()},notifAuthHistoryChange:function(pageHistory){var self=this;pageHistory.length>0?(self.$$undo.removeClass("disabled"),self.$$undoAll.removeClass("disabled")):(self.$$undo.addClass("disabled"),self.$$undoAll.addClass("disabled"))},notifAuthSetPage:function(page){this._checkSave()},_checkSave:function(){authCommons.isNonSaveablePage()?$("#auth-btn-save-id").hide():$("#auth-btn-save-id").show()},_enableRemoveBtn:function(){var self=this,stateRemove=!1,stateRemoveCnt=!1,sel,data,parent;self._currentSelectionId&&(sel=authHelpers.getSelectionById(self._currentSelectionId),data=sel&&authHelpers.getSelectionData(sel),!data||!data.control?stateRemove=!1:stateRemove=!0),data&&data.control&&data.control&&(data.control.isRoot()&&(stateRemove=!1),data.control.isLayout()&&(stateRemoveCnt=!0)),stateRemove!==!1?self.$$removeItem.removeClass("disabled"):self.$$removeItem.addClass("disabled"),stateRemoveCnt!==!1?self.$$removeCnt.removeClass("disabled"):self.$$removeCnt.addClass("disabled")},_setDeviceSize:function(size,orientation){var params={layout:{pageParameters:{}}};size&&(params.layout.pageParameters.device=size),orientation&&(params.layout.pageParameters.orientation=orientation),params.layout.pageParameters.forcePreview=!0,authHelpers.triggerResizeInternal(params)},_onRemoveItem:function(){if(!this._currentSelectionId)return;var sel=authHelpers.getSelectionById(this._currentSelectionId),data=sel&&authHelpers.getSelectionData(sel);if(!data||!data.control||data.control.isRoot())return;this._enableRemoveBtn(!1),data.control.destroy(),notifications.publish(["sm.auth.change.item.prop.ui"])},_onRemoveCnt:function(){if(!this._currentSelectionId)return;var sel=authHelpers.getSelectionById(this._currentSelectionId),data=sel&&authHelpers.getSelectionData(sel);if(!data||!data.control)return;data.control.destroyChildren(),notifications.publish(["sm.auth.change.item.prop.ui"])},_onRemoveAllItems:function(){var page=authCommons.getCurrentPage();page.rootLayout.destroyChildren(),notifications.publish(["sm.auth.change.item.prop.ui"])},_onClose:function(){notifications.publish(["sm.auth.close"])},_onSave:function(evt){notifications.publish(["sm.auth.save"])},_onChooseDevice:function(elmt){var self=this,cur=siteLayout.getCurrentLayoutSettings(),modal=new modalChooseDevice.Modal(cur.pageParameters.device);modal.show().then(function(result){result!=null&&(self._setDeviceSize(result),notifications.publish(["sm.auth.display.changed"],"device"))})},_onScaleDevice:function(elmt){var cur=siteLayout.getCurrentLayoutSettings(),params={layout:{pageParameters:{forceAutoScale:cur.pageParameters.forceAutoScale===!1}}};authHelpers.triggerResizeInternal(params),notifications.publish(["sm.auth.display.changed"],"scale")},_onOrientation:function(elmt){var self=this,orient=$(elmt.currentTarget).attr("data-auth-orientation");orient&&(self._setDeviceSize(null,orient),notifications.publish(["sm.auth.display.changed"],"orientation"))},_onNewLayout:function(){var self=this,page=authCommons.getCurrentPage(),data={scroll:jsutils.isInstanceOf(page,"PageSdataDashboard")?"horizontal":"vertical",template:!0},modal=new modalNewLayout.Modal(data);modal.show().then(function(result){result!=null&&notifications.publish(["sm.auth.new.layout"],result.scroll,result.template)})},_onUndo:function(){notifications.publish(["sm.auth.undo"],!1)},_onUndoAll:function(){notifications.publish(["sm.auth.undo"],!0)}})}),define("syracuse-tablet/html/js/authoring/authoringFooter",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/authoring/authoringHtml"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),authHtml=require("syracuse-tablet/html/js/authoring/authoringHtml");exports.Panel=utils.defineClass(function AuthoringPanelFooter(){var self=this;self.$$panel=null},null,{show:function(){var self=this;self._ensurePanel(),self._subscribe(),self.$$panel.show(),self._initDefaults()},hide:function(){var self=this;self._ensurePanel(),self.$$panel.hide(),self._unscribe()},_ensurePanel:function(){var self=this;if(this.$$panel)return;var ctx={};self.$$panel=$("#s-m-auth-panel-footer-id"),self.$$panel.append($(authHtml.execute("authPanelFooter",ctx))),self._getDomObjects(),self._initDomEvents()},_getDomObjects:function(){},_initDomEvents:function(){},_initDefaults:function(){},_subscribe:function(){},_unscribe:function(){}})}),define("syracuse-tablet/html/js/authoring/authoringArticleGen",["require","exports","module","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){function _generateDashboardArticle(proto,orientation,tpl){var article;proto=proto.json;var props=proto.$properties;if(orientation==="horizontal"){article={$layoutType:"hub",$items:[{$layoutType:"hubGroup",$title:"",$items:[]}]};if(tpl===!1)return $.smResolve(article);Object.keys(props).forEach(function(key){var prop=props[key];prop.$type==="application/x-vignette"?article.$items[0].$items.push({$layoutType:"tile",$size:"large",$items:[{$bind:key}]}):prop.$type==="application/x-vignette-link"&&article.$items[0].$items.push({$layoutType:"tile",$size:"medium",$items:[{$bind:key}]})})}else{article={$layoutType:"stack",$items:[]};if(tpl===!1)return $.smResolve(article);var cellCount=4,row;Object.keys(props).forEach(function(key){var prop=props[key];if(prop.$type==="application/x-vignette"||prop.$type==="application/x-vignette-link")cellCount===4&&(cellCount=0,row={$layoutType:"row",$items:[]},article.$items.push(row)),row.$items.push({$layoutType:"cell",$widthXs:12,$widthSm:6,$widthMd:4,$widthLg:3,$items:[{$bind:key}]})})}return $.smResolve(article)}function _generateRegularArticle(proto,orientation,tpl,synch){proto=proto.json,proto.$type==="application/x-array"&&(proto=proto.$item);var props=proto.$properties,$items,prop,forceNoTitle=_getFacet(proto.$url)==="query";if(orientation==="horizontal"){article={$layoutType:"hub",$items:[{$layoutType:"hubGroup",$title:"",$items:[]}]};if(tpl===!1)return $.smResolve(article);var groupItems=article.$items[0].$items,maxItemsPerGroup=4,itemsPerGroup=maxItemsPerGroup,tileItems,singlePropTypes=["application/x-array","application/x-document","image"];for(var p in props){prop=props[p];if(prop.$isExcluded!==!0){if(singlePropTypes.indexOf(prop.$type)>-1){var tile={$layoutType:"tile",$size:"large",$items:[]};groupItems.push(tile),tileItems=tile.$items,itemsPerGroup=maxItemsPerGroup}else if(itemsPerGroup>=maxItemsPerGroup){itemsPerGroup=0;var tile={$layoutType:"tile",$size:"large",$items:[]};groupItems.push(tile),tileItems=tile.$items}itemsPerGroup+=1;var a={$bind:p};forceNoTitle?a.$isTitleHidden=forceNoTitle:a.$labelPosition="top",tileItems.push(a)}}}else{var article={$layoutType:"stack",$items:[]};if(tpl===!1)return $.smResolve(article);if(!proto||!proto.$article||!proto.$article.$layout){$items=article.$items;for(var p in props){prop=props[p];if(prop.$isExcluded!==!0){var a={$bind:p};forceNoTitle&&(a.$isTitleHidden=forceNoTitle),$items.push(a)}}}else _x3Layout2DefaultArticle(proto,article,props)}return synch===!0?article:$.smResolve(article)}function _getFacet($url){var t=_testFacet.exec($url||"");return t!=null&&t.length==2?t[1]:null}function _x3Layout2DefaultArticle(proto,article,props){function _parse(coreLayout,article,props){if(!coreLayout)return;var idx,idx1;coreLayout.$items.forEach(function($itm){switch($itm.$category){case"section":idx=article.$items.push({$title:$itm.$title,$layoutType:"stack",$items:[]}),_parse($itm.$layout,article.$items[idx-1],props);break;case"block":idx=article.$items.push({$title:$itm.$title,$layoutType:"stack",$items:[]}),idx1=article.$items[idx-1].$items.push({$layoutType:"row",$items:[]}),_parse($itm.$layout,article.$items[idx-1].$items[idx1-1],props);break;default:props[$itm.$bind]&&!props[$itm.$bind].$isExcluded&&(idx=article.$items.push({$layoutType:"cell",$bgColor:"",$items:[]}),article.$items[idx-1].$items.push({$bind:$itm.$bind}))}})}_parse(proto.$article.$layout,article,props)}var jsutils=require("syracuse-tablet/html/js/helpers/jsutils");exports.genNewArticle=function(opts){var proto;return proto=opts.page.getPrototype(),jsutils.isInstanceOf(opts.page,"PageSdataDashboard")?_generateDashboardArticle(proto,opts.orientation,opts.template):_generateRegularArticle(proto,opts.orientation,opts.template)},exports.genCardArticle=function(prototype){return _generateRegularArticle(prototype,null,!0,!0)};var _testFacet=/representation=.*\.\$(\w+)[&]*/}),define("syracuse-tablet/html/js/ui/modals/modalSaveAuth",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),_templateAll={header:'			<buttons class="pull-right"> 				<button type="button" class="btn btn-default s-m-modal-btn-validate" data-action="$validate"></button> 				<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 			</buttons> 			<div class="modal-title">{{title}}</div> 			',content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">			<div class="s-m-scroll-element"> 		 		{{#each fields}}				<div class="form-group"> 					<label>{{label}}</label> 					<input class="{{css}} form-control" id="{{id}}" type="text" value="{{value}}" {{readonly}}/> 				</div> 				{{/each}}				<label id="saveType" params="{{saveType}}" >{{label_save_type}}</label> 				<div class="btn-group btn-group-justified" data-toggle="buttons"> 			   {{#each buttons}}					<div class="btn-group"> 					<label class="{{css}} btn btn-primary {{active}}" data-action="clickType" data-params="{{id}}"  >					<input type="radio"  name="options" id="{{id}}" {{checked}}>{{label}} 					</label>					</div>				{{/each}}				</div> 			</div> 			</div>',footer:""},_Klass=utils.defineClass(function ModalSaveAuth(saveContext){var self=this;modalDialog.ModalBase.call(self),self.saveContext=saveContext,self.result=null},modalDialog.ModalBase,{destroy:function(){$("input.evt-input",this.$$elmt).off(),modalDialog.ModalBase.prototype.destroy.call(this)},_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var displayFlags=this.displayFlags||{};return displayFlags.modalClass="authoring-save half_right",displayFlags},_getDataContext:function(){var self=this;self.currentVariant=$.smFind(self.saveContext.variants,function(variant){return variant.isSelected})||{},self.currentVariant.comment=self.currentVariant.comment||self.saveContext.comment;var readonly="readonly",data={title:locale.text("auth.save.title"),page:self.saveContext.pageName,fields:[{id:"authCode",label:locale.text("auth.panel.label_code"),value:self.currentVariant.code,readonly:readonly,css:"evt-input"},{id:"authTitle",label:locale.text("auth.panel.label_title"),value:self.currentVariant.title,readonly:readonly,css:"evt-input"},{id:"authDescription",label:locale.text("auth.panel.label_description"),value:self.currentVariant.description,readonly:readonly,css:"evt-input"},{id:"authComment",label:locale.text("auth.panel.label_comment"),value:self.currentVariant.comment||self.saveContext.comment}],saveType:"save",label_save_type:locale.text("auth.panel.label_save"),buttons:[{id:"personal_copy",label:locale.text("auth.panel.label_personal"),active:self.currentVariant.isPersonal&&self._isPersonelVariantAutorized()?"active":"",css:self._isPersonelVariantAutorized()?"":"disabled"},{id:"global_variant",label:locale.text("auth.panel.label_global"),active:self.currentVariant.isGlobal&&self._isGlobalVariantAutorized()?"active":"",css:self._isGlobalVariantAutorized()?"":"disabled"},{id:"factory_variant",label:locale.text("auth.panel.label_factory"),active:self.currentVariant.isFactory&&self._canUpdateFactory(self.currentVariant)?"active":"",css:self._canManageFactory()?"":"disabled"}]};return data},_canUpdateFactory:function(variant){return this._canManageFactory()&&this.saveContext.securityProfile.factoryId===variant.factoryOwner},_canManageFactory:function(){return this.saveContext.securityProfile.factoryId!=""&&this._isGlobalVariantAutorized()},_isGlobalVariantAutorized:function(){return this.saveContext.securityProfile.personalizationLevel==="admin"},_isPersonelVariantAutorized:function(){return this.saveContext.securityProfile.personalizationLevel==="admin"||this.saveContext.securityProfile.personalizationLevel==="user"},_onShow:function(evt){var self=this;modalDialog.ModalBase.prototype._onShow.call(this,evt),$("input.evt-input",self.$$elmt).on("input",self._onInput.bind(self)),self._refreshBtnValidate()},_onAction:function(action,param){if(action!=="clickType")return!1;var self=this,ctxUI={},create=!1;switch(param){case"factory_variant":self._canManageFactory()&&(self.currentVariant=$.smFind(self.saveContext.variants,function(variant){return variant.isFactory&&variant.factoryOwner===self.saveContext.securityProfile.factoryId}),self.currentVariant||(create=!0,self.currentVariant={isFactory:!0,code:this.saveContext.securityProfile.factoryId,title:this.saveContext.securityProfile.factoryId,description:this.saveContext.securityProfile.factoryId,factoryOwner:this.saveContext.securityProfile.factoryId,comment:""}));break;case"global_variant":self.currentVariant=$.smFind(self.saveContext.variants,function(variant){return variant.isGlobal}),self.currentVariant||(create=!0,this.currentVariant={isGlobal:!0,code:"GLOBAL",title:"GLOBAL",description:"GLOBAL",comment:""});break;case"personal_copy":self.currentVariant=$.smFind(self.saveContext.variants,function(variant){return variant.isPersonal}),self.currentVariant||(create=!0,this.currentVariant={isPersonal:!0,code:"PERSONAL",title:"PERSONAL",description:"PERSONAL",comment:""})}$("label[data-params='"+param+"']",self.$$elmt).eq(0).button("toggle");if(create)var UI={saveType:"saveAs",label_save_type:locale.text("auth.panel.label_saveas_option")};else var UI={saveType:"save",label_save_type:locale.text("auth.panel.label_save")};return UI.fields=[{id:"authCode",value:self.currentVariant.code,readonly:!create},{id:"authTitle",value:self.currentVariant.title,readonly:!create},{id:"authDescription",value:self.currentVariant.description,readonly:!create},{id:"authComment",value:self.currentVariant.comment,readonly:!1}],self._changeUI(UI),!1},_changeUI:function(ctx){var self=this,$$saveType=self.$$elmt.find("#saveType");$$saveType.attr("params",ctx.saveType),$$saveType.text(ctx.label_save_type);var field;ctx.fields.forEach(function(item){field=self.$$elmt.find("#"+item.id),field.val(item.value),item.readonly?field.attr("readonly","readonly"):field.removeAttr("readonly")}),this._refreshBtnValidate(!0)},_onValidate:function(){var self=this;self.result={code:self.$$elmt.find("#authCode").val(),title:self.$$elmt.find("#authTitle").val(),description:self.$$elmt.find("#authDescription").val(),comment:self.$$elmt.find("#authComment").val(),variantType:$("label[data-action='clickType'].active",self.$$elmt).attr("data-params"),uuid:self.currentVariant.uuid}},_onCancel:function(){var self=this;self.result=null},_onInput:function(evt){this._refreshBtnValidate()},_refreshBtnValidate:function(focus){var disabled=!1,$$field;disabled=!$("label[data-action='clickType'].active",this.$$elmt).attr("data-params"),disabled||($$field=this.$$elmt.find("#authCode"),(disabled=$$field.val().trim().length<=0)||($$field=this.$$elmt.find("#authTitle"),(disabled=$$field.val().trim().length<=0)||($$field=this.$$elmt.find("#authDescription"),disabled=$$field.val().trim().length<=0))),focus&&disabled&&$$field&&$$field.focus(),$("button[data-action='$validate']").toggleClass("disabled",disabled)},_getResult:function(){var self=this;return self.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/authoring/authoring",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/authoring/authoringPanelRight","syracuse-tablet/html/js/authoring/authoringPanelLeft","syracuse-tablet/html/js/authoring/authoringPage","syracuse-tablet/html/js/authoring/authoringHeader","syracuse-tablet/html/js/authoring/authoringFooter","syracuse-tablet/html/js/authoring/authoringArticleGen","syracuse-tablet/html/js/authoring/authoringVal","syracuse-tablet/html/js/authoring/authoringCommons","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/modals/modalSaveAuth","syracuse-tablet/html/js/ui/modals/modal","syracuse-tablet/html/js/authoring/authoringProperties","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _mergeViews(page,views){var pviews=page.pageData.page.$views=page.pageData.page.$views||[];views.forEach(function(view){view.$selected=!1,pviews.some(function(pview){var match=pview.$url===view.$url;return match&&(view.$selected=pview.$selected),match})}),page.pageData.page.$views=views}var utils=require("syracuse-tablet/html/js/helpers/utils"),globals=require("syracuse-tablet/html/js/app/globals"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),authoringPanelRight=require("syracuse-tablet/html/js/authoring/authoringPanelRight"),authoringPanelLeft=require("syracuse-tablet/html/js/authoring/authoringPanelLeft"),authoringPage=require("syracuse-tablet/html/js/authoring/authoringPage"),authoringHeader=require("syracuse-tablet/html/js/authoring/authoringHeader"),authoringFooter=require("syracuse-tablet/html/js/authoring/authoringFooter"),authoringArticleGen=require("syracuse-tablet/html/js/authoring/authoringArticleGen"),authVal=require("syracuse-tablet/html/js/authoring/authoringVal"),authCommons=require("syracuse-tablet/html/js/authoring/authoringCommons"),modules=require("syracuse-tablet/html/js/common/modules"),modalSaveAuth=require("syracuse-tablet/html/js/ui/modals/modalSaveAuth"),modal=require("syracuse-tablet/html/js/ui/modals/modal"),authProps=require("syracuse-tablet/html/js/authoring/authoringProperties"),locale=require("syracuse-tablet/html/js/helpers/locale"),_authInterface,_authEvents=["sm.page.loaded","sm.all.vignettes.loaded","sm.auth.change.item.prop.ui","sm.auth.change.prop.ui","sm.auth.close","sm.auth.save","sm.auth.new.layout","sm.auth.set.page","sm.auth.display.changed","sm.auth.undo","sm.auth.open.card.design"];exports.toggleDesignPage=function(){_authInterface||(_authInterface=new AuthInterface),_authInterface.toggleDesignPage()},exports.isEnabled=function(){return _authInterface&&_authInterface.isActive},exports.destroy=function(){if(!_authInterface)return;_authInterface.destroy(),_authInterface=null};var AuthInterface=utils.defineClass(function AuthoringInterface(){var self=this;self.$$authPanel=null,self.isActive=!1,self.undoPageHistory={},self.isDirty=!1,self.rightPanel=new authoringPanelRight.Panel,self.leftPanel=new authoringPanelLeft.Panel,self.headerPanel=new authoringHeader.Panel,self.footerPanel=new authoringFooter.Panel,self.authPage=new authoringPage.AuthPage,authProps.initProperties(authHelpers),authVal.setProperties(authProps)},null,{destroy:function(){var self=this;["rightPanel","leftPanel","headerPanel","authPage"].forEach(function(p){self[p]&&self[p].destroy&&self[p].destroy(),self[p]=null})},toggleDesignPage:function(forceStatus){this.isActive||forceStatus===!1?this.disable():this.enable()},enable:function(){var self=this;self._subscribe(),self.authPage.enable(),self.rightPanel.show(),self.leftPanel.show(),self.headerPanel.show(),self.footerPanel.show();var page=authCommons.getCurrentPage();authHelpers.getPageVariants(page).then(function(variants){return page.variants=variants,authHelpers.getPageViews(page)}).then(function(views){_mergeViews(page,views)}).then(function(){notifications.publish(["sm.auth.set.page"],page),authHelpers.triggerResizeInternal({preserveScroll:!0,layout:{authPanelLeft:{visible:!0},authPanelRight:{visible:!0},authPanelHeader:{visible:!0},authPanelFooter:{visible:!0},pageParameters:{forcePreview:!0}}}),self.authPage.enableAuthCss(),self.isActive=!0,self.isDirty=!1,globals.setAuthoringActive(!0)}).fail(function(e){modules.get("modal").error(e)})},disable:function(){var self=this;self.authPage.disable(),self.rightPanel.hide(),self.leftPanel.hide(),self.headerPanel.hide(),self.footerPanel.hide(),self.isActive=!1,self.authPage.disableAuthCss(),authHelpers.triggerResizeInternal({preserveScroll:!0,layout:{authPanelLeft:{visible:!1},authPanelRight:{visible:!1},authPanelHeader:{visible:!1},authPanelFooter:{visible:!1},pageParameters:{forcePreview:!1}}}),self.isActive=!1,self._unscribe(),globals.setAuthoringActive(!1)},_subscribe:function(){notifications.subscribe(this,_authEvents)},_unscribe:function(){notifications.unsubscribe(this,_authEvents)},notifAllVignettesLoaded:function(dashboardPage){var self=this;if(!self.isActive)return;self.authPage.enableAuthCss(),dashboardPage&&(notifications.publish(["sm.auth.set.page"],dashboardPage),dashboardPage.computeLayout())},notifPageLoaded:function(page){var self=this;if(!self.isActive)return;if(page&&!page.allowAuthoring()){self.authPage.disableAuthCss(),self.toggleDesignPage();return}if(page.isVignette()||page.isDashboard())return;notifications.publish(["sm.auth.set.page"],page),self.authPage.enableAuthCss()},notifAuthSetPage:function(page){var self=this,parentAuthoringName=self.currentPageName;self.currentPageName=page.getAuthoringName(),self.currentPageFullName=page.getAuthoringName(),self.displayedArticle=JSON.stringify(page.getArticle()),self.undoPageHistory[self.currentPageName]||(self.undoPageHistory[self.currentPageName]={parentPageName:parentAuthoringName,articles:[]}),notifications.publish(["sm.auth.history.change"],self.undoPageHistory[self.currentPageName].articles)},notifAuthChangePropUi:function(articlePage,states,vignetteToUpdt){var self=this;self.displayedArticle!=null&&(self.isDirty=!0,self.undoPageHistory[self.currentPageName].articles.push(self.displayedArticle),notifications.publish(["sm.auth.history.change"],self.undoPageHistory[self.currentPageName].articles),self.displayedArticle=null),self._updateLayoutPage(articlePage,states,vignetteToUpdt)},notifAuthChangeItemPropUi:function(){var self=this,page=authCommons.getCurrentPage(),states={},articleJSON=authHelpers.rebuildArticleByPageStruct(page,states);notifications.publish(["sm.auth.change.prop.ui"],articleJSON,states)},notifAuthClose:function(articlePage){var self=this,page=authCommons.getCurrentPage();page&&page.isCardDetail()?self._closeCardDesign():self._authCloseAuthoring(articlePage)},_authCloseAuthoring:function(articlePage){var self=this,_end=function(){self.undoPageHistory={},notifications.publish(["sm.auth.history.change"],[]),self.disable(),authHelpers.triggerResizeInternal()};self.isDirty===!0?modal.simpleConfirmPromise({message:locale.text("auth.msg.close")}).then(function(result){result.action==="yes"&&_end()}):_end()},notifAuthDisplayChanged:function(type){this.leftPanel.setSelection(null)},notifAuthSave:function(){var self=this,page=authCommons.getCurrentPage();if(page&&page.isCardDetail()){self._saveCardDesign();return}var article=authCommons.getCurrentPage().getArticle(),articleParsed=authVal.validateJSON(!0,article,authProps.getAllProperties());if(!articleParsed)return;var propertiesVariantSelected=authHelpers.getPropertiesCurrentVariant(page),comment=articleParsed&&articleParsed.$comment,context={code:propertiesVariantSelected.code||locale.text("auth.panel.authCodeDefault"),title:propertiesVariantSelected.title||locale.text("auth.panel.authTitleDefault"),description:propertiesVariantSelected.description||locale.text("auth.panel.authDescriptionDefault"),isFactory:propertiesVariantSelected.isFactory,isGlobal:propertiesVariantSelected.isGlobal,isPersonal:propertiesVariantSelected.isPersonal,factoryOwner:propertiesVariantSelected.factoryOwner,securityProfile:authCommons.getSecurityProfile(),uuid:propertiesVariantSelected.uuid,comment:propertiesVariantSelected.comment||comment,variants:authHelpers.getPropertiesVariants(page)};context.pageName=self.currentPageName;var modal=new modalSaveAuth.Modal(context),canceled=!1,modalCtx;modal.show().then(function(ctx){modalCtx=ctx,canceled=modalCtx==null;if(canceled)return;articleParsed.$comment=ctx.comment;var params={code:ctx.code,title:ctx.title,description:ctx.description,variantType:ctx.variantType,uuid:ctx.uuid,article:articleParsed};return params.article=utils.sanitizeArticle(params.article),authHelpers.saveAuthoring(page,params)}).then(function(){if(canceled)return;modalCtx.uuid||self.rightPanel.notifAuthSetSelection(),self.isDirty=!1}).then(function(){if(canceled)return;modules.get("modal").info(locale.text("auth.panel.save_ok_title"),locale.text("auth.panel.save_ok_text"))}).fail(function(e){modules.get("modal").error(locale.text("auth.panel.save_error_title"),e)})},notifAuthNewLayout:function(type,template){var self=this,page=authCommons.getCurrentPage();authoringArticleGen.genNewArticle({page:page,orientation:type,template:template}).then(function(article){var articleJSON=authVal.toSortedJSON(article);notifications.publish(["sm.auth.change.prop.ui"],articleJSON)}).fail(function(e){modal.error(e)})},notifAuthUndo:function(all){var self=this,article;all?(article=self.undoPageHistory[self.currentPageName].articles.shift(),self.undoPageHistory[self.currentPageName].articles=[]):article=self.undoPageHistory[self.currentPageName].articles.pop(),notifications.publish(["sm.auth.history.change"],self.undoPageHistory[self.currentPageName].articles),notifications.publishEx(["sm.auth.change.prop.ui"],{exclude:[self]},article),self._updateLayoutPage(article)},notifAuthOpenCardDesign:function(){this._openCardDesign()},_updateLayoutPage:function(articlePage,states,vignetteToUpdt){var self=this,page=authCommons.getCurrentPage();try{var articleParsed=JSON.parse(articlePage)}catch(e){}if(!articleParsed)return;var path=self._findSelectionPath();authHelpers.savePanelStates(),self.displayedArticle=articlePage,self.authPage.disableAuthCss(),page.authUpdateLayout(articleParsed,vignetteToUpdt).then(function(){self.authPage.enableAuthCss(),states&&self._applyPreviousStates(states),self._selectByPath(path)}).fail(function(e){modules.get("modal").error(e)})},_applyPreviousStates:function(states){var self=this,page=authCommons.getCurrentPage();for(var statePath in states){statePath=statePath.length>0?statePath.split("."):[];var node=page.rootLayout.findChildByPath(statePath);node&&node.setAuthState(states[statePath])}},_findSelectionPath:function(){var id=this.authPage.getCurrentSelectionId();if(id===authCommons.getCurrentPage().id)return"$$currentpage$$";var sel=id&&authHelpers.getSelectionById(id),data=sel&&authHelpers.getSelectionData(sel);if(!data||!data.control)return null;var path=data.control.getPathInTree();return path},_selectByPath:function(path){var page=authCommons.getCurrentPage();if(!path||!page)return;if(path==="$$currentpage$$")path=page.id;else{var node=page.rootLayout.findChildByPath(path);path=node?node.id:null}path&&notifications.publishEx(["sm.auth.set.selection"],{exclude:[this]},path)},_isArticleChange:function(articleBefore){var article=JSON.stringify(authCommons.getCurrentPage().getArticle());return articleBefore!==article},_openCardDesign:function(){var id=this.authPage.getCurrentSelectionId(),sel=id&&authHelpers.getSelectionById(id),data=sel&&authHelpers.getSelectionData(sel);if(!data||!data.control||!data.control.getCardDetailPageData)return null;var page=data.control.page||authCommons.getCurrentPage();modules.get("navHelper").gotoUrl("child://SdataCardDetail",null,{isChild:!0,childContext:{controllerId:page.controller.id,arrayControlId:data.control.id,cardDetailPageData:data.control.getCardDetailPageData()}})},_closeCardDesign:function(){this._goBack()},_saveCardDesign:function(){var self=this,page=authCommons.getCurrentPage(),cardArticle=page.getCardArticle(),arrayControl=page.getCardArrayControl();self._goBack().then(function(){page=authCommons.getCurrentPage(),arrayControl&&arrayControl.setCardDetailArticle(cardArticle),notifications.publish(["sm.auth.change.item.prop.ui"])})},_goBack:function(){var navStack=modules.get("navStack").getMainStack();return navStack?navStack.goBack().then(function(){var page=navStack.getTopPage();notifications.publish(["sm.auth.set.page"],page)}):$.smResolve()}})}),define("syracuse-tablet/html/js/app/appController",["require","exports","module","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/app/eventListener","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/sharedContext","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/ui/modals/modalSettings","syracuse-tablet/html/js/ui/modals/modalSelectContext","syracuse-tablet/html/js/ui/modals/modalShowLegal","syracuse-tablet/html/js/helpers/developmentPage","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/authoring/authoring"],function(require,exports,module){function _selectNewContext(){var up=exports.App.getCurrentUserProfile(),currentContext={endpoint:up.selectedEndpoint.code,role:up.selectedRole.code,lang:up.selectedLocale.code},settings={},fetchSettings=$.Deferred();return ajax.request("/sdata/syracuse/collaboration/syracuse/userProfiles/$service/settings").then(function(result){settings.profile=result.data,settings.offline=!1,fetchSettings.resolve()}).fail(function(result){result.offline?(settings.profile={},settings.offline=!0,fetchSettings.resolve()):fetchSettings.reject(result)}),waiting.waitModal(fetchSettings).then(function(){var modal=new modalSelectContext.Modal(currentContext,settings);return modal.show()}).then(function(result){if(result.action!=="cancel"&&result.action==="ok"){var session=modules.get("session");return waiting.waitModal(session.applyNewContext(settings.profile,up,result.endpoint,result.role,result.language))}})}function _logout(){var d=$.Deferred(),session=modules.get("session");return waiting.waitModal(session.logout()).then(function(){d.resolve("loggedout")}).fail(function(result){result.offline&&d.resolve("offline"),d.reject(result)}),d}var locale=require("syracuse-tablet/html/js/helpers/locale"),ajax=require("syracuse-tablet/html/js/common/ajax"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),waiting=require("syracuse-tablet/html/js/utils/waiting"),globals=require("syracuse-tablet/html/js/app/globals"),eventListener=require("syracuse-tablet/html/js/app/eventListener"),modules=require("syracuse-tablet/html/js/common/modules"),utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),sharedContext=require("syracuse-tablet/html/js/helpers/sharedContext"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("appController",!1),modalSettings=require("syracuse-tablet/html/js/ui/modals/modalSettings"),modalSelectContext=require("syracuse-tablet/html/js/ui/modals/modalSelectContext"),modalShowLegal=require("syracuse-tablet/html/js/ui/modals/modalShowLegal"),developmentPage=require("syracuse-tablet/html/js/helpers/developmentPage"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),environment=require("syracuse-tablet/html/js/helpers/environment"),settings=require("syracuse-tablet/html/js/app/settings"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),authoring=require("syracuse-tablet/html/js/authoring/authoring"),_appClass=utils.defineClass(function App(){this.$$elmt=$("#s-m-app-id"),this._cacheContext={$user:"none",$role:"none",$lang:"none"},this._defaultEndpoint="x3.erp.GX3APP",this._currentUserProfile=null,notifications.subscribe(this,["sm.main.layout.changed"])},null,{init:function(){eventListener.registerEvents(this.$$elmt),$(window).triggerHandler("resizeInternal")},notifMainLayoutChanged:function(info,orientation,deviceType){this.$$elmt.width(info.application.width),this.$$elmt.height(info.application.height);var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();currentPage&&(currentPage.onMainPageResize(info,orientation,deviceType),info.afterMainPageLoaded===!0&&environment.isAutoUITestMode()&&environment.getUnitTestMgr().notifPageLoaded("after",currentPage))},setUserProfile:function(userProfile){var self=this,initialProfile=!1;return this._currentUserProfile||(this._currentUserProfile=$.extend(!0,{},userProfile),initialProfile=!0),$.smResolve().then(function(){if(self._currentUserProfile.selectedLocale.code!==userProfile.selectedLocale.code||initialProfile===!0)return locale.setLocaleByUserProfile(userProfile)}).then(function(){self._cacheContext={$user:userProfile.user.login,$role:userProfile.selectedRole.code,$lang:userProfile.selectedLocale.code},self._defaultEndpoint=userProfile.selectedEndpoint.application+"."+userProfile.selectedEndpoint.contract+"."+userProfile.selectedEndpoint.dataset,environment.isAutoUITestMode()&&environment.getUnitTestMgr().notifUserCtxChanged(self._cacheContext,self._defaultEndpoint)}).then(function(){initialProfile||(self._currentUserProfile=$.extend(!0,{},userProfile))}).then(function(){return metaDataCache.clearCachedApps()})},getCurrentUserProfile:function(){return this._currentUserProfile},getCurrentEndpoint:function(){return this._currentUserProfile.selectedEndpoint?this._currentUserProfile.selectedEndpoint.code:""},getCacheContext:function(){return this._cacheContext},getDefaultEndpoint:function(){return this._defaultEndpoint},goBack:function(){var navStack=modules.get("navStack").getMainStack();if(!this.canGoBack()){this.gotoHomePage();return}if(navStack){var changedToBusy=navStack.setBusy(!0);if(!changedToBusy)return;navStack.goBack().always(function(){changedToBusy&&navStack.setBusy(!1)}).fail(function(error){modules.get("modal").error(error)})}},canGoBack:function(){var navStack=modules.get("navStack").getMainStack();return navStack?navStack.canGoBack():!1},_actHistoryBack:function(){if(globals.isAuthoringActive())return;this.goBack()},onBrowserBackButton:function(event){event&&event.preventDefault();if(globals.isAuthoringActive())return;this.goBack()},_actSwitchContext:function(){var self=this;_selectNewContext().fail(function(result){modules.get("modal").error(result)}).then(function(userProfile){if(userProfile)return self.setUserProfile(userProfile).then(function(){modules.get("modal").notify({body:locale.text("switchContext.success"),severityClass:"success"})}).then(function(){return self.initApplicationsList()}).then(function(){self.gotoHomePage()})})},_actLogout:function(){var self=this;_logout().then(function(result){var msg;result=="loggedout"?msg={body:locale.text("logout.msg"),severityClass:"success"}:result==="offline"&&(msg={body:locale.text("logout.offline.msg"),severityClass:"warning"}),modules.get("modal").notify(msg),self.gotoLogoutPage()}).fail(function(result){modules.get("modal").error(result)})},_actSettings:function(){var self=this;return settings.getDeviceType().then(function(deviceType){var modal=new modalSettings.Modal({"device-type":deviceType});return modal.show()}).then(function(result){if(result&&result["device-type"])return settings.setDeviceType(result["device-type"])})},_actAbout:function(){var modal=new modalShowLegal.Modal;modal.show()},_actDevelopmentPage:function(){developmentPage.show()},_actHome:function(){this.gotoHomePage()},_actDraftsList:function(){return modules.get("navHelper").gotoUrl("html://drafts")},gotoHomePage:function(){return modules.get("navHelper").gotoUrl("html://home")},gotoLoginPage:function(){return modules.get("navHelper").gotoUrl("html://login")},gotoLogoutPage:function(){return modules.get("navHelper").gotoUrl("html://logout")},onModalOpened:function(){},onModalClosed:function(){},getMessageSlot:function(){this._$$actMsgSlot||(this._$$actMsgSlot={});var deviceType=siteLayout.getDeviceType(),orientation=siteLayout.getPageOrientation(),key=deviceType+orientation;if(this._$$actMsgSlot[key])return this._$$actMsgSlot[key];var $$slot=this._$$actMsgSlot[key]=$("<div>").addClass("s-m-act-msg-slot").addClass(deviceType).addClass(orientation);return this.$$elmt.prepend($$slot),$$slot},_actDesignPage:function(){authoring.toggleDesignPage()},nativeApplicationActivated:function(){log&&log("nativeApplicationActivated");var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage(),isLoginPage=jsutils.isInstanceOf(currentPage,"PageLogin");isLoginPage&&(log&&log("is login page -> reload"),window.location.reload())},nativeApplicationClosing:function(){log&&log("nativeApplicationClosing");var page=this.findTopmostNonChild();if(page){var context=sharedContext.createContextFromPage(page);return JSON.stringify(context)}return""},findTopmostNonChild:function(){var navStack=modules.get("navStack").getMainStack();if(navStack)return navStack.filterTopPage(function(page){return!page.options||!page.options.isChild})},initApplicationsList:function(){return metaDataCache.initApplicationsList()},_actPageMailto:function(){var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();currentPage&&sharedContext.sendPageByEmail(currentPage).fail(function(error){modules.get("modal").error(error)})},applicationIsStarted:function(){var navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();currentPage}});exports.App=new _appClass}),define("syracuse-tablet/html/js/controls/array/builderCard",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/array/builderBase","syracuse-tablet/html/js/app/appController","syracuse-tablet/html/js/helpers/fieldOperators","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/authoring/authoringArticleGen"],function(require,exports,module){function _checkEmptyRow($$row){if(!$$row)return;var fullCellMinWidth=$$row.width();fullCellMinWidth-=fullCellMinWidth/12;var emptyNotfw=[];$$row.children().each(function(){var $$cell=$(this);$$cell.width()>fullCellMinWidth?$$cell.addClass("s-m-fullwidth"):($$cell.removeClass("s-m-fullwidth"),emptyNotfw&&$$cell.is(".s-m-empty")?emptyNotfw.push($$cell):emptyNotfw=null)}),emptyNotfw&&emptyNotfw.forEach(function($$cell){$$cell.addClass("s-m-fullwidth")})}var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/array/builderBase").BuilderBase,App=require("syracuse-tablet/html/js/app/appController").App,fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),environment=require("syracuse-tablet/html/js/helpers/environment"),authoringArticleGen=require("syracuse-tablet/html/js/authoring/authoringArticleGen");exports.BuilderCard=utils.defineClass(function builderCard(control){Base.call(this,control),this.direction=this.control.isArrayField()?"h":"v"},Base,{destroy:function(){Base.prototype.destroy.call(this),this._tds=null,this._$$body&&(this._$$body.remove(),this.destroyScroller()),this._$$body=null},buildHtml:function(data,$$container,refresh){this.article.$minWidth=this.article.$minWidth||6,Base.prototype.buildHtml.call(this,data,$$container,refresh),this._cardArticle=this._createCardArticle(),this._statusInfo=this.control.getRowStatusInfo(),refresh===!0&&this.buildOnResize(data,$$container,{refresh:!0})},buildOnResize:function(data,$$container,context){if(this.destroyed)return;if(!this.checkEmptyArray())return;this.buildCards(data,$$container,context)},buildCards:function(data,$$container,context){var context=context||{},refresh=context.refresh==1;if(!this._$$body){this.destroyScroller(),this._$$table=$("<table/>").appendTo($$container),this._$$body=$("<tbody>").appendTo(this._$$table),this._tds=[];var self=this;data.forEach(function(rowData,idx){self._tds.push({$$td:$('<td class="s-m-record"/>'),rowData:rowData})})}var sz=this.control.getAvailableSizeForCards(),parentH=sz.height,parentW=sz.width,bs=this._$$body.parent().css("border-spacing");bs&&(bs=bs.split("px"),bs=bs&&bs.length>0?parseInt(bs[0],10):0);var $$hiddenRow,visibleTds=[];this._tds.forEach(function(o,idx){o.$$card&&o.$$card.css({height:"",width:""}),o.$$td.detach(),o.$$td.css("display")!="none"?visibleTds.push(o):($$hiddenRow||($$hiddenRow=$("<tr>").hide()),o.$$td.appendTo($$hiddenRow))}),this._$$body.empty(),$$hiddenRow&&$$hiddenRow.appendTo(this._$$body);if(visibleTds.length===0)return;this.direction==="h"?this.buildCardH(visibleTds,bs,parentH,parentW):this.buildCardV(visibleTds,bs,parentW),this._centerCardInParent(parentH),this.initScroller($$container),this.doAfterBuild()},_centerCardInParent:function(parentH){if(!this.control.isArrayField()&&!this.control.page.isNestedInDashboard("stack")){var top=Math.max(0,(parentH-this._$$body.parent().outerHeight())/2);this._$$body.parent().css({top:top+"px"})}},initScroller:function($$container){(this.direction==="h"||this.direction==="v"&&!this.control.page.isNestedInDashboard("stack"))&&this.newScroller(this.direction,this._$$body.parent())},buildCardV:function(visibleTds,bs,parentW){var scale=this.control.getTransformScale(),cardW,remaining=0,nbCardPerRow=isNaN(this.article.$cardsPerRow)?2:parseInt(this.article.$cardsPerRow,10)||2,$$row=null,self=this;visibleTds.some(function(o,idx){if($$row==null||nbCardPerRow==1||nbCardPerRow>1&&idx%nbCardPerRow===0)$$row=$("<tr>").appendTo(self._$$body),remaining=nbCardPerRow;remaining--,o.$$td.appendTo($$row),o.$$card||(o.$$card=self.createCardContent(o.$$td,idx,o.rowData));if(idx===0){var padding=o.$$card.outerWidth()-o.$$card.width(),availWidth=o.$$td.width()/scale,minWidth=Math.min(availWidth-padding,self.authMinSize2Pixels(self.article.$minWidth));while(nbCardPerRow>0){cardW=Math.round((availWidth-(nbCardPerRow-1)*bs)/nbCardPerRow)-padding;if(cardW>=minWidth){availWidth=cardW;break}nbCardPerRow--}nbCardPerRow=Math.max(nbCardPerRow,1)}o.$$card.width(cardW)});var $emptycell=this.article.$emptycell||"nodisplay";remaining&&this._cardArticle.$emptyCell!=="nodisplay"&&this.addEmptyCells(this._layoutRoot,$$row,remaining,visibleTds.length),this.article.$arrayOptions.hideEmptyRows===!0&&this.checkEmptyRows()},buildCardH:function(visibleTds,bs,parentH,parentW){var scale=this.control.getTransformScale(),cardW,nbCardPerRow=isNaN(this.article.$cardsPerRow)?2:parseInt(this.article.$cardsPerRow,10)||2,remaining=0,maxHeight=0,heightChanged,$$row=null,self=this;visibleTds.some(function(o,idx){if(!$$row||nbCardPerRow==1||nbCardPerRow>1&&idx%nbCardPerRow===0)$$row=$("<tr>").appendTo(self._$$body),remaining=nbCardPerRow;o.$$td.appendTo($$row),o.$$card||(o.$$card=self.createCardContent(o.$$td,idx,o.rowData));if(idx===0){var realH=o.$$td.height()/scale+bs;parentW-=(nbVisiblecardsPerRow+1)*bs;var padding=o.$$card.outerWidth()-o.$$card.width(),availWidth=o.$$td.width()/scale,minWidth=Math.min(availWidth-padding,self.authMinSize2Pixels(self.article.$minWidth)),nbVisiblecardsPerRow=nbCardPerRow;while(nbVisiblecardsPerRow>0){cardW=Math.round((availWidth-(nbVisiblecardsPerRow-1)*bs)/nbVisiblecardsPerRow)-padding;if(cardW>=minWidth){availWidth=cardW;break}nbVisiblecardsPerRow--}nbVisiblecardsPerRow=Math.max(nbVisiblecardsPerRow,1),nbCardPerRow=visibleTds.length,remaining=nbCardPerRow}o.$$card.width(cardW);var cardH=o.$$card.height()/scale;maxHeight===0?maxHeight=cardH:maxHeight!=cardH&&(heightChanged=!0,maxHeight=Math.max(maxHeight,cardH)),remaining--}),heightChanged===!0&&visibleTds.forEach(function(o){o.$$card.height(maxHeight)});var $emptycell=this.article.$emptycell||"nodisplay";if(remaining>0&&$emptycell!=="nodisplay"){var $$emptyCells=this.addEmptyCells(this._layoutRoot,$$row,remaining);$$emptyCells&&heightChanged&&$$emptyCells.height(maxHeight)}this.article.$arrayOptions.hideEmptyRows===!0&&this.checkEmptyRows()},createCardContent:function($$container,index,rowData){var $$card=$('<section class="s-m-card"/>').appendTo($$container).attr("data-idx",index);$('<span class="badge checked fa fa-check">&nbsp;</span>').appendTo($$card),this.article.$arrayOptions.rowIndex===!0&&index!=null&&$('<span class="badge index">'+(index+1)+"</span>").appendTo($$card),this._statusInfo&&this.checkStatusManagement($$card,this._statusInfo,$$card,rowData);var cardCtrl=this.control.createRecordCtrl($$card,rowData,index,{cardArticle:this._cardArticle});return cardCtrl&&(cardCtrl.buildHtml(this._tableColumnInfo),environment.isAutoUITestMode()&&environment.getUnitTestMgr().arrayAddRowIndex(cardCtrl.$$elmt,index)),$$card},checkStatusManagement:function($$parent,statusInfo,$$cell,rowData){if(!statusInfo)return;var $$rootIcon=$$cell.find(".s-m-status");$$rootIcon.length===0&&($$rootIcon=$('<div class="s-m-status"/>').appendTo($$cell));var nbBckg=0;statusInfo.list.some(function(s){if(s.color&&fieldOperators.evaluateOperator(s.$type,rowData.getValue(s.field),s.operator,s.value))return s.icon?($('<div class="s-m-status-icon '+s.icon.css+'" style="color:'+s.color.bgColor+'"/>').appendTo($$rootIcon),statusInfo.type==="mono"):(s.color.css&&nbBckg===0&&($$parent.addClass("s-m-status-color "+s.color.css),nbBckg++),statusInfo.type==="mono")})},authMinSize2Pixels:function(val){var max=700,min=100;return val=parseInt(val,10),val==null||isNaN(val)?200:val>20?max:val<1?min:min+val*(max-min)/20},_createCardArticle:function(){var cardArticle=this.article.$card;return cardArticle||(cardArticle=authoringArticleGen.genCardArticle(this.control.prototype)),cardArticle},getLastSelectedRowId:function(){return this.control.$$content.find(".s-m-last-selected > .s-m-card > .s-m-ctrl").attr("id")},setLastSelectedRowId:function(selectedRowUuid){this.control.$$content.find("#"+selectedRowUuid).closest("td").addClass("s-m-last-selected")},addEmptyCells:function(rootLayout,$$parent,nb,startIdx){if(nb<1)return null;var dispEmpty=this.article.$emptycell;if(dispEmpty==="withtitle"||dispEmpty==="filled"){for(var i=0;i<nb;i++)this.createCardContent($('<td class="s-m-record s-m-empty s-m-'+dispEmpty+' nohover">').appendTo($$parent),startIdx+i);return $$parent.find("td.s-m-empty")}return null},checkEmptyRows:function(){if(!this._$$body)return;this._$$rows||(this._$$rows=this._$$body.find(".s-m-row")),this._$$rows.each(function(){_checkEmptyRow($(this))})},updateRowIndex:function($$parent,index){$$parent.find(".badge.index").text(index)}})}),define("syracuse-tablet/html/js/controls/array/builderCarousel",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/controls/array/builderCard","syracuse-tablet/html/js/helpers/scroller/hammerScroller","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsUtils=require("syracuse-tablet/html/js/helpers/jsutils"),Base=require("syracuse-tablet/html/js/controls/array/builderCard").BuilderCard,hammerScroller=require("syracuse-tablet/html/js/helpers/scroller/hammerScroller"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_templates={footer:'<footer>				<ul class="s-m-carousel-indicators">					<span class="first active"></span>					{{#if middle}}						<span class="middle"></span>					{{/if}}					{{#if last}}						<span class="last"></span>					{{/if}}				</ul>				<span class="left carousel-control {{leftIcon}}"></span>				<span class="right carousel-control {{rightIcon}}"></span>			</footer>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.BuilderCarousel=utils.defineClass(function builderCarousel(control){Base.call(this,control),this.direction="h",this._curIdx=0,this._hammer=null,this._nbCards=0,this._interval=null},Base,{destroy:function(){Base.prototype.destroy.call(this),this._destroySwiper(),this.$$container=null,this._$$footer&&(this._$$footer.off(),this._$$footer.remove())},buildHtml:function(data,$$container,refresh){this._nbCards=data.length,this.$$container=$$container,Base.prototype.buildHtml.call(this,data,$$container,refresh)},buildCardH:function(visibleTds,bs,parentH,parentW){Base.prototype.buildCardH.call(this,visibleTds,bs,parentH,parentW);if(this._nbCards==0)return;this._shiftInPx=this._$$table.find("tbody > tr > td").width()/this.control.getTransformScale()+bs,this._$$footer||(this._$$footer=this.$$container.append(_getHtml("footer",{middle:!0,last:!0,leftIcon:fontUtils.getCarouselIcon("left"),rightIcon:fontUtils.getCarouselIcon("right")})),this._$$footer.on("click",jsUtils.bindFn(this._onClickFooter,this))),this._$$footer.toggle(this._nbCards>0),this._nbCards>0&&this._updateIndicators(),this._swipe("justUpdate")},_centerCardInParent:function(parentH){},_updateIndicators:function(){this._$$footer.find(".s-m-carousel-indicators > .first").toggleClass("active",this._curIdx===0),this._$$footer.find(".s-m-carousel-indicators > .middle").toggleClass("active",this._curIdx>0&&this._curIdx<this._nbCards-1),this._$$footer.find(".s-m-carousel-indicators > .last").toggleClass("active",this._curIdx>=this._nbCards-1)},initScroller:function($$container){this._destroySwiper();if(this._nbCards==0)return;this._hammer=new hammerScroller.Hammer($$container.get(0)),this._hammer.get("swipe").set({direction:hammerScroller.Hammer.DIRECTION_HORIZONTAL}),this._hammer.on("swipeleft swiperight",jsUtils.bindFn(this._onSwipe,this)),this._getInterval()>0&&(this._interval=setInterval(jsUtils.bindFn(this._onTimeout,this),this._getInterval()))},_onClickFooter:function(evt){var $$targ=$(evt.target);if(!$$targ.is(".carousel-control"))return;this._swipe($$targ.is(".left")?"swiperight":"swipeleft")},_onTimeout:function(evt){if(this.destroyed)return;this._swipe("swipeleft")},_onSwipe:function(evt){if(hammerScroller.isEvtDirection(evt,"v")||!evt)return;this._swipe(evt.type)},_swipe:function(type){if(this.destroyed)return;var $$current=this.control.$$elmt.find('.s-m-card[data-idx="'+this._curIdx+'"]');if($$current.length==0)return;if(type!=="justUpdate")if(type==="swipeleft")this._curIdx++,this._curIdx>=this._nbCards&&(this._curIdx=0);else{if(type!=="swiperight")return;this._curIdx--,this._curIdx<0&&(this._curIdx=this._nbCards-1)}var $$next=this.control.$$elmt.find('.s-m-card[data-idx="'+this._curIdx+'"]');if($$next.length==0)return;this._$$table.css("opacity",0,25);var self=this;this._$$table.animate({left:-1*this._curIdx*this._shiftInPx+"px",opacity:1},300,"swing",function(){self._updateIndicators()})},_destroySwiper:function(){this._interval&&(clearInterval(this._interval),this._interval=null),this._hammer&&(this._hammer.destroy(),this._hammer=null)},_getInterval:function(){var period=this.article.$carouselPeriod;return period==="slow"?6e3:period==="normal"?3e3:period==="fast"?1e3:-1}})}),define("syracuse-tablet/html/js/controls/array/builderSeparator",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/array/builderBase","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/controllers/sdataController"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/array/builderBase").BuilderBase,modules=require("syracuse-tablet/html/js/common/modules"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,_seps={semicolon:",",colon:":",blank:" ",dash:"-"};exports.BuilderSeparator=utils.defineClass(function builderSeparator(control){Base.call(this,control)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(data,$$parent,refresh){Base.prototype.buildHtml.call(this,data,$$parent,refresh),$$parent.empty();var $$section=$("<section/>").appendTo($$parent),sep=_seps[this.control.article.$separator||"blank"]||" ",ctrlFactory=modules.get("ctrlFactory"),self=this;data.forEach(function(dataSet,idx){if(idx>0){var $$sep=$('<span class="s-m-separator"/>').appendTo($$section).text(sep);sep===","&&$$sep.css("text-align","left")}var controller=new SdataController(dataSet,self.control.arrayController),ctrlFld=ctrlFactory.createControl(controller,{$bind:dataSet.parent.valueProperty},null,self.control.page,{displayCtx:"separator",noEdit:!0});ctrlFld&&(ctrlFld.set$$container($$section),ctrlFld.buildHtml())})}})}),define("syracuse-tablet/html/js/controls/chart/cubeChartsTheme",["require","exports","module"],function(require,exports,module){var theme={colors:["#BF7070","#BFB730","#7ABF30","#7373FF","#BF7730","#BF3080","#30BF9F","#FF7373","#FFF773","#85FF00","#3030BF","#FF9F40","#FF40BC","#1699A6","#FF0000","#FFF100","#00FF00","#0000FF","#FF7F00","#FF00A6","#00FFC6","#A60000","#A69C00","#56A600","#90B2FF","#A65200","#A6006C","#00A681","#FF4040","#FFF440","#A3FF40","#3673FF","#FFB873","#FF76CE","#73FFED"],chart:{borderRadius:"0",spacingTop:10,backgroundColor:"#fff",borderColor:"#ccc",borderWidth:1,className:"dark-container",resetZoomButton:{theme:{fill:"white",stroke:"#dddddd",r:0,states:{hover:{fill:"#00a1de",style:{color:"white"}}}},position:{x:-50,y:5},relativeTo:"chart"}},title:{style:{color:"#464646",font:'bold 16px "Trebuchet MS", Verdana, sans-serif'}},subtitle:{style:{color:"#464646",font:'bold 12px "Trebuchet MS", Verdana, sans-serif'}},xAxis:{gridLineColor:"rgba(0, 0, 0, 0.05)",gridLineDashStyle:"longdash",gridLineWidth:1,labels:{style:{color:"#A0A0A0"}},lineColor:"rgba(0, 0, 0, 0.2)",tickColor:"rgba(0, 0, 0, 0.2)",title:{style:{color:"#464646",fontWeight:"bold",fontSize:"15px",fontFamily:"arial"}}},yAxis:{minorGridLineColor:"rgba(0, 0, 0, 0.05)",minorTickInterval:"auto",gridLineWidth:2,gridLineColor:"rgba(0, 0, 0, 0.07)",labels:{align:"left",x:0,y:12,style:{color:"#A0A0A0"}},lineColor:"rgba(0, 0, 0, 0.07)",title:{style:{color:"#CCC",fontSize:"16px",fontFamily:"Georgia, Verdana, sans-serif",fontStyle:"italic"}}},tooltip:{backgroundColor:"#464646",borderRadius:"0",style:{color:"#fff",fontSize:"12px",padding:"5px",whiteSpace:"nowrap"}},toolbar:{itemStyle:{color:"silver"}},plotOptions:{series:{marker:{lineWidth:2,lineColor:null,radius:4,states:{hover:{radius:8,lineColor:null}}}},area:{fillOpacity:.15},areaspline:{fillOpacity:.15},line:{dataLabels:{color:"#CCC"},marker:{lineColor:"#FFFFFF"}},spline:{marker:{lineColor:"#FFFFFF"}},scatter:{marker:{lineColor:"#FFFFFF"}},candlestick:{lineColor:"#FFFFFF",animation:{duration:2e3,easing:"easeOutBounce"}},pie:{allowPointSelect:!0,cursor:"pointer",borderColor:"rgba(250,250,250,0.3)",borderWidth:.5,dataLabels:{enabled:!0,connectorWidth:2,color:"#464646",style:{fontWeight:"bold"}}}},legend:{borderRadius:0,borderWidth:1,backgroundColor:"white",itemMarginTop:8,itemStyle:{color:"#464646",fontFamily:'"arial"',fontWeight:"bold",fontSize:"8pt "},itemHoverStyle:{color:"#00a1de"},itemHiddenStyle:{color:"#555"},title:{style:{color:"#464646",fontWeight:"bold",fontSize:"8pt",fontFamily:"arial"}}},credits:{enabled:!1,style:{color:"#666"}},labels:{style:{color:"#CCC"}},exporting:{buttons:{drillUp:{symbolStroke:"#fff",symbolFill:"rgba(250,250,250,0.5)",hoverSymbolStroke:"#fff",hoverSymbolFill:"rgba(250,250,250,0.5)"},exportButton:{symbolStroke:"#fff",symbolFill:"rgba(250,250,250,0.5)",hoverSymbolStroke:"#fff",hoverSymbolFill:"rgba(250,250,250,0.5)"},printButton:{symbolStroke:"#fff",symbolFill:"rgba(250,250,250,0.5)",hoverSymbolStroke:"#fff",hoverSymbolFill:"rgba(250,250,250,0.5)"}}},rangeSelector:{buttonTheme:{fill:{linearGradient:[0,0,0,20],stops:[[.4,"#888"],[.6,"#555"]]},stroke:"#000000",style:{color:"#CCC",fontWeight:"bold"},states:{hover:{fill:{linearGradient:[0,0,0,20],stops:[[.4,"#BBB"],[.6,"#888"]]},stroke:"#000000",style:{color:"white"}},select:{fill:{linearGradient:[0,0,0,20],stops:[[.1,"#000"],[.3,"#333"]]},stroke:"#000000",style:{color:"yellow"}}}},inputStyle:{backgroundColor:"#333",color:"silver"},labelStyle:{color:"silver"}},navigator:{handles:{backgroundColor:"#666",borderColor:"#AAA"},outlineColor:"#CCC",maskFill:"rgba(16, 16, 16, 0.5)",series:{color:"#7798BF",lineColor:"#A6C7ED"}},scrollbar:{barBackgroundColor:{linearGradient:[0,0,0,20],stops:[[.4,"#888"],[.6,"#555"]]},barBorderColor:"#CCC",buttonArrowColor:"#CCC",buttonBackgroundColor:{linearGradient:[0,0,0,20],stops:[[.4,"#888"],[.6,"#555"]]},buttonBorderColor:"#CCC",rifleColor:"#FFF",trackBackgroundColor:{linearGradient:[0,0,0,10],stops:[[0,"#000"],[1,"#333"]]},trackBorderColor:"#666"},legendBackgroundColor:"rgba(0, 0, 0, 0.5)",legendBackgroundColorSolid:"rgb(35, 35, 70)",dataLabelsColor:"#444",textColor:"#C0C0C0",maskColor:"rgba(255,255,255,0.3)"},colors=theme.colors;theme.orgChart={node:{textColor:"black ",borderColor:colors[1],borderWidth:2,backgroundColor:"white ",fontWeight:"normal ",hover:{backgroundColor:colors[3],textColor:"white "}},junction:{lineColor:colors[3],lineWidth:2},dropMarker:{borderColor:colors[1],borderWidth:0,backgroundColor:colors[4],backgroundOpacity:1},tooltip:{backgroundColor:colors[1],backgroundOpacity:1,borderWidth:2,borderRadius:0,borderColor:colors[2],style:{color:"#fff",fontSize:"12px",padding:"5px",whiteSpace:"nowrap"}}},theme.version=Highcharts.version.split(".").map(function(e){return parseInt(e,10)}),theme.version[0]!==2&&theme.version[0]===3&&(theme.navigation={buttonOptions:{symbolStroke:"#DDDDDD",hoverSymbolStroke:"#FFFFFF",theme:{fill:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.4,"#606060"],[.6,"#333333"]]},stroke:"#000000"}}},delete theme.exporting),exports.theme=theme}),define("syracuse-tablet/html/js/controls/array/builderChartBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/array/builderBase","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/controls/chart/cubeChartsTheme","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _isCubeValid(cube,proto){return!!(cube&&cube.$hierarchies&&proto.$axes&&proto.$axes.length>0&&proto.$axes[0].$hierarchies&&proto.$axes[0].$hierarchies.length>0)}var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/array/builderBase").BuilderBase,formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),theme=require("syracuse-tablet/html/js/controls/chart/cubeChartsTheme").theme,locale=require("syracuse-tablet/html/js/helpers/locale"),_merge=Highcharts.merge,objectClone=function(o){return $.extend({},o)};Highcharts.theme=theme,Highcharts.setOptions(Highcharts.theme);var colors=Highcharts.theme.colors,_style=function($style){var map={xy:"line",point:"scatter",stick:"column",radar:"spiderweb"};return $style&&(map[$style]||$style)};exports.BuilderChartBase=utils.defineClass(function builderChartBase(control){Base.call(this,control),this.$prototype=control.prototype.json,this.$prototype.$properties=this.$prototype.$item.$properties,this._localize={highCharts_showHideLegend:locale.text("highCharts_showHideLegend"),highCharts_seriesTitle:locale.text("highCharts_seriesTitle")},this._initializeMeta()},Base,{destroy:function(){Base.prototype.destroy.call(this),this.clearChart(),this._localize=this._meta=this._dataset=this.$prototype=this.currentMetaData=null},clearChart:function(){this.highchartObject&&this.highchartObject.destroy(),this.highchartObject=null},_mergeMetaData:function(metadata){var m={};return metadata&&metadata.$chartOptions&&(metadata.$isXLabelsHidden=metadata.$chartOptions.isXLabelsHidden||!1,metadata.$isYLabelsHidden=metadata.$chartOptions.isYLabelsHidden||!1,metadata.$isXLabelHidden=metadata.$chartOptions.isXLabelHidden||!1,metadata.$isYLabelHidden=metadata.$chartOptions.isYLabelHidden||!1,metadata.$isLegendHidden=metadata.$chartOptions.isLegendHidden||!1,metadata.$isGridLineHidden=metadata.$chartOptions.isGridLineHidden||!1,metadata.$isTitleHidden=metadata.$chartOptions.isTitleHidden||!1,metadata.$isLabelsHidden=metadata.$chartOptions.isLabelsHidden||!1),metadata&&metadata.$axisLabels&&(m.$axisLabels=metadata.$axisLabels),metadata&&metadata.$cube&&(m.$cube=metadata.$cube),metadata&&metadata.$axes&&(m.$axes=metadata.$axes),metadata&&metadata.$style&&(m.$style=metadata.$style),metadata&&metadata.$color&&(m.$color=metadata.$color),metadata&&metadata.$isLegendHidden&&(m.$isLegendHidden=metadata.$isLegendHidden),metadata&&metadata.$isXLabelHidden&&(m.$isXLabelHidden=metadata.$isXLabelHidden),metadata&&metadata.$isYLabelHidden&&(m.$isYLabelHidden=metadata.$isYLabelHidden),metadata&&metadata.$isXLabelsHidden&&(m.$isXLabelsHidden=metadata.$isXLabelsHidden),metadata&&metadata.$isYLabelsHidden&&(m.$isYLabelsHidden=metadata.$isYLabelsHidden),metadata&&metadata.$isGridLineHidden&&(m.$isGridLineHidden=metadata.$isGridLineHidden),metadata&&metadata.$isTitleHidden&&(m.$isTitleHidden=metadata.$isTitleHidden),metadata&&metadata.$isLabelsHidden&&(m.$isLabelsHidden=metadata.$isLabelsHidden),metadata&&metadata.$inverted&&(m.$inverted=metadata.$inverted),metadata&&metadata.$seriesOptions&&(m.$cube=m.$cube||{},m.$cube.$measures=m.$cube.$measures||{},Object.keys(metadata.$seriesOptions).forEach(function(key){metadata.$seriesOptions[key]&&(m.$cube.$measures[key]=m.$cube.$measures[key]||{},metadata.$seriesOptions[key].color&&(m.$cube.$measures[key].$color=metadata.$seriesOptions[key].color.bgColor),m.$cube.$measures[key].$isHidden=metadata.$seriesOptions[key].isHidden)})),this.currentMetaData=_merge(this.currentMetaData||{},m),metadata&&metadata.$item&&metadata.$item.$properties&&this.currentMetaData&&this.currentMetaData.$cube&&this.currentMetaData.$cube.$measures&&$.smForEachKey(this.currentMetaData.$cube.$measures,function(key,m){metadata.$item.$properties[key]&&metadata.$item.$properties[key].$title?m.$title=metadata.$item.$properties[key].$title:m.$title=key}),this.currentMetaData},_ensureFormatter:function(measure){measure.formatter={format:function(val,localFormat){return val}}},_localizedText:function(key){return key},_getFieldEvalTitle:function(){return[]},notifyArrayDataChanged:function(refresh,arrayData,isEmpty){var self=this,chartDataset=[];arrayData&&arrayData.$resources&&arrayData.$resources.forEach(function(dao){chartDataset.push(dao.data)}),self._dataset=chartDataset,self._links=null,arrayData&&arrayData.$links&&(self._links={},Object.keys(arrayData.$links).forEach(function(key){arrayData.$links[key].$isHidden||(self._links[key]=arrayData.$links[key])}))},_settingsFromValue:function(){var self=this,$cube=this.currentMetaData.$cube,icolor=0,settings,dataset=self.getChartDataSet();return $cube&&$cube.$style==="spiderweb"?(settings={},settings.categories=Object.keys(self._meta.series).map(function(key){return self._meta.series[key].options.name}),settings.series={},dataset&&dataset.reduce(function(res,current){var serie={name:self._getMeasureLabel(current,self._meta.xAxis[0].code),color:colors[icolor++],data:[],pointPlacement:"on"};return serie.name&&(serie.id="#s-"+serie.name,$.smForEachKey(self._meta.series,function(key,s){s.isHidden||self._pushData(serie,key,key,current)}),res.series[serie.name]=serie),res},settings)):(settings={categories:[],series:{}},dataset&&dataset.reduce(function(res,current){var categoryName=self._getMeasureLabel(current,self._meta.xAxis[0].code);return categoryName!=null&&(res.categories.push(categoryName),$.smForEachKey(self._meta.series,function(key,s){var serie=res.series[key];serie||(serie=objectClone(s.options),serie.data=[],res.series[key]=serie),self._pushData(serie,categoryName,key,current)})),res},settings)),settings},_pushData:function(serie,categoryName,key,data){var val=parseFloat(data.$rawV&&data.$rawV[key]&&data.$rawV[key].v||data[key])||0;this.useLogarithmicAxis&&(this.maxValue=Math.max(this.maxValue||-Infinity,val),this.minValue=Math.min(this.maxValue||Infinity,val)),serie.data.push({name:categoryName,y:val,rowId:data.$uuid})},createChart:function(settings,$$parent,options){var self=this,options=_merge(self._getPref(),self._getOptions(self.$prototype,$$parent,options));self.highchartObject&&self.clearChart(),settings?(options.xAxis[0].categories=settings.categories,$.smForEachKey(settings.series,function(key,s){var serie=objectClone(s),serieMeta=self._meta.series[key];options.chart.polar&&serie&&serie.type&&delete serie.type,(!serieMeta||!serieMeta.isHidden)&&!(serieMeta&&serieMeta.options&&serieMeta.options.isHidden)&&options.series.push(serie)})):$.smForEachKey(self._meta.series,function(key,s){var serie=objectClone(s.options);options.chart.polar&&serie&&serie.type&&delete serie.type,serie.data=[0],s.isHidden||options.series.push(serie)}),(!self.$prototype.$cube||self.$prototype.$cube.$style!="spiderweb")&&options.series.reverse(),this.useLogarithmicAxis&&(this.maxValue||0)/(this.minValue||1)>10&&(options.yAxis.type="logarithmic"),self.highchartObject=new Highcharts.Chart(options);var legend=this.highchartObject.legend;self.displayLegend=legend&&legend.display;var chartSeries=self.highchartObject.series,serie,serieMeta;for(var j=chartSeries.length-1;j>=0;j--)serie=chartSeries[j],serieMeta=serie&&serie.options.id&&self._meta.series[serie.options.id.slice(3)],serieMeta&&serieMeta.measure&&(serieMeta.measure.$color=serieMeta.options.color=serie.color)},_getOptions:function(proto,$$parent,options){options=options||{};var self=this,$cube=this.currentMetaData.$cube,defOptions=Highcharts.getOptions(),buttons=defOptions.exporting.buttons,enuml,$style=this.currentMetaData.$style||$cube&&$cube.$style||proto.$cube&&proto.$cube.$style,axe=proto.$axes&&proto.$axes[0]||{},titleCode=this._getMeasureCode(axe.$hierarchies[0][0]),hierarchy=$cube.$hierarchies&&$cube.$hierarchies[titleCode],axeTitle=hierarchy?hierarchy.$title:null;axeTitle===null&&proto.$properties&&proto.$properties[titleCode]&&(axeTitle=proto.$properties[titleCode].$title||"");var margin={top:this.currentMetaData.$isTitleHidden&&$style!=="bar"?0:null,bottom:this.currentMetaData.$isXLabelsHidden&&$style!=="bar"?0:null,left:this.currentMetaData.$isYLabelsHidden&&$style!=="bar"?2:null},legend={},options={chart:{renderTo:$$parent.get(0),reflow:!1,zoomType:options.zoomType||"x",ignoreHiddenSeries:!1,width:options.width,height:options.height,inverted:this.currentMetaData.$inverted,marginTop:margin.top,marginBottom:this.currentMetaData.$inverted?margin.left:margin.bottom,marginLeft:this.currentMetaData.$inverted?margin.bottom:margin.left,marginRight:this.currentMetaData.$inverted?margin.bottom:margin.left,events:{load:options.onComplete}},lang:{showHideLegend:self._localize.highCharts_showHideLegend},legend:{layout:legend.layout?legend.layout:"vertical",align:legend.align?legend.align:"right",verticalAlign:legend.verticalAlign?legend.verticalAlign:"top",y:legend.notitle?0:60,x:legend.notitle?0:-10,title:{text:legend.notitle?"":":::: "+self._localize.highCharts_seriesTitle},borderWidth:legend.notitle?0:1,floating:legend.notitle?!1:!0,draggable:legend.notitle?!1:!0,zIndex:20,enabled:this.currentMetaData.$isLegendHidden!==!0&&$style!=="pie"},title:{text:!this.currentMetaData.$isTitleHidden&&$cube&&self._localizedText($cube.$title)||null},subtitle:{text:null},xAxis:[{categories:[],title:{text:!this.currentMetaData.$isXLabelHidden&&self._localizedText(axeTitle)||null},labels:{rotation:-45,align:"right",enabled:this.currentMetaData.$isXLabelsHidden!==!0},gridLineWidth:this.currentMetaData.$isGridLineHidden?0:1,minorGridLineWidth:this.currentMetaData.$isGridLineHidden?0:1,lineWidth:this.currentMetaData.$isGridLineHidden?0:1,tickWidth:this.currentMetaData.$isXLabelsHidden?0:1}],yAxis:[{title:{text:null},labels:{align:"right",enabled:this.currentMetaData.$isYLabelsHidden!==!0},gridLineWidth:this.currentMetaData.$isGridLineHidden?0:1,minorGridLineWidth:this.currentMetaData.$isGridLineHidden?0:1,lineWidth:this.currentMetaData.$isGridLineHidden?0:1,tickWidth:this.currentMetaData.$isYLabelsHidden?0:1}],plotOptions:{series:{pointPadding:0,groupPadding:.1,cursor:"pointer",events:{},point:{events:{click:self.getChartClickHandler()}},stacking:self._meta.stacking,animation:!1}},tooltip:{formatter:function(){var seriesMeta=self._meta.series,serie=this.key&&seriesMeta[this.key]||seriesMeta[this.series.options.id.slice(3)],measure=serie&&serie.measure,data=this.series.processedYData,y=this.y;measure&&self._ensureFormatter(measure);var label=this.series.name||measure&&measure.$title,mformat=measure&&measure.formatter;label=(label?label+"<br>":"")+(this.x||this.key)+": <b> "+(mformat?mformat.format(y):y)+"</b>";if(measure&&measure.$isNormalized&&data.length>0){var sum=data.reduce(function(a,b){return a+b});label+=" ("+(mformat?mformat.formatValue(y/sum*100):y/sum*100)+"%)"}return label}},series:[]};$style==="pie"&&(options.plotOptions.pie=options.plotOptions.pie||{},options.plotOptions.pie.dataLabels=options.plotOptions.pie.datalabels||{},options.plotOptions.pie.dataLabels.enabled=this.currentMetaData.$isLabelsHidden?!1:!0);if(Highcharts.theme.version[0]===3){options.exporting={type:"image/png",url:"http://export.highcharts.com/",buttons:{contextButton:{symbol:"menu",enabled:!1,_titleKey:"contextButtonTitle",menuItems:[{textKey:"showHideLegend",onclick:function(){setTimeout(function(){self._toggleLegendDisplay()},100)}}]},legendButton:{enabled:!1,textKey:"showHideLegend",symbol:"menu",onclick:function(){setTimeout(function(){self._toggleLegendDisplay()},100)}}}};var menuItems=options.exporting.buttons.contextButton.menuItems||[];this._printSupported()&&menuItems.push({text:"Print chart",onclick:function(){this.print(self)}}),this._exportSupported()&&(menuItems.push({separator:!0}),menuItems.push({textKey:"downloadPNG",onclick:function(){this.exportChart()}}),menuItems.push({textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}}),menuItems.push({textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}}),menuItems.push({textKey:"downloadSVG",onclick:function(){this.exportChart({type:"image/svg+xml"})}}))}return options.xAxis[0].title.text!==options.title.text&&(options.xAxis[0].title.text=options.xAxis[0].title.text?options.xAxis[0].title.text:options.title.text),options.chart.type=self._meta.defaultStyle,options},_initializeMeta:function(){this._mergeMetaData(this.$prototype),this._mergeMetaData(this.article);var proto=this.$prototype,cube=this.currentMetaData;this._meta={xAxis:[{}],series:{},displaysOneMeasure:cube&&cube.$displaysOneMeasure,hasMeasureSelector:cube&&cube.$hasMeasureSelector,hasStyleSelector:cube&&cube.$hasStyleSelector,defaultStyle:_style(cube.$style)||"column",drill:{minLevel:1,maxLevel:0,currLevel:1,currAxisHier:0,levelsProperties:[],members:[],stack:[{$axes:proto.$axes,$item:proto.$item,$slicer:proto.$slicer}]}},this.__processMeta(proto,!0)},_exportSupported:function(){return!0},_printSupported:function(){return!0},__processMeta:function(metaData,init){this._processMeasures(metaData,init),this._processAxes(metaData,init)},_processMeasures:function(metaData,init){this._mergeMetaData(metaData);var self=this,items=this.$prototype.$properties,measures=this._getRestraintMeasures(),icolor=0;measures&&$.smForEachKey(measures,function(key,m){var code=m.$property||key,measure=_merge(items[code],m);metaData&&metaData.$item&&metaData.$item.$properties&&(measure=_merge(measure,metaData.$item.$properties[code]));if(!measure.$title||measure.$title==="")measure.$title=key;var serie=self._meta.series[code];init&&(self._ensureFormatter(measure),serie=self._meta.series[code]={options:{id:"#s-"+code,name:self._localizedText(measure.$title)||String.fromCharCode(160)},measure:measure}),serie&&(serie.isHidden=measure.$title==="",serie.options.type=_style(measure.$style),serie.options.color=measure.$color||colors[icolor++],serie.options.name=self._localizedText(measure.$title)||String.fromCharCode(160),serie.options.visible=measure.$title!==""&&(!self._meta.displaysOneMeasure||!!measure.$isDefault),serie.options.isHidden=measure.$isHidden);if(measure.$isStacked||measure.$stackingGroup)serie.options.stack=measure.$stackingGroup||0,self._meta.stacking=measure.$isNormalized?"percent":self._meta.stacking||"normal"})},_getRestraintMeasures:function(){var proto=this.currentMetaData,$cube=proto.$cube,measures=$cube&&$cube.$measures,restraintMeasures=measures;return measures&&proto.$axes&&proto.$axes.length>1&&proto.$axes[1].$members&&proto.$axes[1].$members[0][0].length>0&&(restraintMeasures={},$.smForEach(proto.$axes[1].$members[0][0],function(measureCode){restraintMeasures[measureCode]=measures[measureCode]})),restraintMeasures},_processAxes:function(proto,init){var cube=this.$prototype.$cube;if(!_isCubeValid(cube,proto))return!1;var self=this,currAxisHier=0,axis0=proto.$axes&&proto.$axes[0],mainHLevelsTab=null;if(axis0){$.smForEachKey(axis0.$hierarchies,function(idx,hierarchy){!mainHLevelsTab&&hierarchy.length>1&&hierarchy[1]==1&&(mainHLevelsTab=cube.$hierarchies[hierarchy[0]].$properties,mainHLevelsTab&&(self._meta.xAxis[0].code=mainHLevelsTab[hierarchy.length>2?hierarchy[2]:0],currAxisHier=idx))}),!mainHLevelsTab&&axis0.$hierarchies[0].length>0&&(mainHLevelsTab=cube.$hierarchies[axis0.$hierarchies[0][0]].$properties,mainHLevelsTab&&mainHLevelsTab.length>0&&(self._meta.xAxis[0].code=mainHLevelsTab[0]));var properties;$.smForEach(axis0.$hierarchies,function(hierarchie){properties=cube.$hierarchies[hierarchie[0]].$properties,$.smForEach(properties,function(property){this.levelsProperties[this.maxLevel++]=property},self._meta.drill)}),axis0.$members&&$.smForEach(axis0.$members,function(tuple){$.smForEach(tuple,function(value){value.length>0&&(this.members[this.currLevel++ -1]=value[0])},this)},self._meta.drill)}self._meta.drill.code=proto.$codeStat||"UNKNOWN",self._meta.drill.axis0FieldCode=self._meta.xAxis[0].code||"",self._meta.drill.maxLevel=Math.max(self._meta.drill.maxLevel,self._meta.drill.minLevel)},_getPref:function(){return Highcharts.getOptions()},_getMeasureCode:function(code){var level=this.controller.level!=undefined?this.controller.level+1:0,measureCode=level>1&&this.$prototype.$axes[0].$hierarchies.length>=level?this.$prototype.$axes[0].$hierarchies[level-1][0]:null;return measureCode=this.currentMetaData.$axisLabels?this.currentMetaData.$axisLabels[1]:measureCode,measureCode||code},_getMeasureLabel:function(measure,code){var self=this,label=this._localizedText(measure.$title);if(label)return label;code=this._getMeasureCode(code);if(!measure[code])return"";var item=self.$prototype.$properties[code];if(!item)return null;switch(item.$type){case"application/x-choice":label=measure[code],item.$value.$enum.some(function(element,i,array){return element.$value===label?(label=self._localizedText(element.$title),!0):!1});break;case"application/x-date":item.formatter=formatApi.getFormatter(item.$type,locale.getDateFormat(item.$type)),label=item.formatter.formatValue(measure[code]);break;case"application/x-integer":case"application/x-decimal":item.formatter=formatApi.getFormatter(item.$type,locale.getNumberFormat(item.$type)),label=item.formatter.formatValue(measure[code]);break;default:label=""+measure[code]}return label},_toggleLegendDisplay:function(){var legend=this.highchartObject.legend;legend&&this._displayLegend(!legend.display)},_displayLegend:function(display){var legend=this.highchartObject.legend;if(!legend)return;display?(legend.group.show(),legend.box.show()):(legend.group.hide(),legend.box.hide()),this.displayLegend=legend.display=display}})}),define("syracuse-tablet/html/js/controls/array/builderChart",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/controls/array/builderChartBase","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),globals=require("syracuse-tablet/html/js/app/globals"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/controls/array/builderChartBase").BuilderChartBase,notifications=require("syracuse-tablet/html/js/helpers/notifications"),_getHeight=function(h){return h==="xsmall"?50:h==="small"?100:h==="medium"?200:h==="large"?400:h==="xlarge"?700:200};exports.BuilderChart=utils.defineClass(function builderChart(control){Base.call(this,control)},Base,{initReuseProperties:function(){Base.prototype.initReuseProperties.call(this),this.resetProps(!1)},destroy:function(){Base.prototype.destroy.call(this),this._$$chartSlot=this._$$catchEvt=null},buildHtml:function(arrayData,$$content,refresh){var self=this;Base.prototype.buildHtml.call(this,arrayData,$$content,refresh);var article=this.article;this._height=_getHeight(this.control.article.$chartHeight),this._$$chartSlot=$('<div class="s-m-slot"/>').appendTo($$content),this._setChartDataSet(arrayData);if(this.getChartDataSet().length>0)this._$$catchEvt=$('<div class="s-m-catchevt"/>').appendTo($$content),this._$$catchEvt.hide(),this.control.isOpenDetailEnabled()&&this.control.addChartDetailLink(this._$$catchEvt);else{var title=this.control.prototype.getValueByPath("$cube.$title");title&&$('<div class="s-m-no-data-title"/>').appendTo(this._$$chartSlot).text(title),$('<div class="s-m-no-data-label"/>').appendTo(this._$$chartSlot).text(locale.text("label.chart.nodata")),this._$$chartSlot.css("position","relative")}refresh==1&&this._displayChart(refresh)},buildOnResize:function(arrayData,$$content,context){if(!this.checkEmptyArray())return;this._$$catchEvt&&(this.control.isOpenDetailEnabled()?this._$$catchEvt.show():this._$$catchEvt.toggle(globals.isAuthoringActive()));if(!$$content||!$$content.is(":visible"))this._subscribedExpand||(this._subscribedExpand=!0,notifications.subscribe(this,["sm.layout.expanded"]));this._layouytType==null&&(this.control.isDisplayedInDetailPage()?this._layouytType="stack":this.control.page.isVignette()&&this.control.page.parentVignette&&(this._layouytType=jsutils.isInstanceOf(this.control.page.parentVignette.parent,"LayoutTile")?"hub":"stack")),this._displayChart(!1,!0)},notifLayoutExpanded:function(){this._displayChart(!1,!1)},_checkHeaderHeight:function(height){if(this.control.builderHeader==null)return height;var $$header=this.control.builderHeader.$$elmt;if(!$$header.is(":visible"))return height;var hh=$$header.height()/this.control.getTransformScale(),phh=$$header?2:0;if(height==null){var css={top:hh+"px",height:this.control.$$content.height()/this.control.getTransformScale()-hh-phh+"px"};this._$$chartSlot.css(css),this._$$catchEvt&&this._$$catchEvt.css(css)}else height=height-hh-phh;return height},_displayChart:function(refresh,updtScroller){var self=this;if(self.isDestroyed()||!self._$$chartSlot)return;setTimeout(function(){if(self.isDestroyed())return;var stackPage,height;if(self._layouytType==="stack"){self._$$chartSlot.css("position","relative"),stackPage=self.control.page;if(self.control.isDisplayedInDetailPage())height=stackPage.mainContentRect.height-10;else{if(!stackPage.isVignette()||!stackPage.parentVignette)throw new Error("Unexpected chart page context");stackPage=stackPage.parentVignette.page,height=Math.min(self._height,stackPage.mainContentRect.height-10)}}else height=null;height=self._checkHeaderHeight(height),self.createChart(self._settingsFromValue(),self._$$chartSlot,{height:height,width:self._$$chartSlot.width()/self.control.getTransformScale(),onComplete:function(){}}),updtScroller&&stackPage&&stackPage.notifyScrollerUpdate()},10)},getChartDataSet:function(){return this._dataset||[]},_setChartDataSet:function(arrayData){var chartDataset=[];arrayData&&arrayData.length>0&&arrayData.forEach(function(rowData){chartDataset.push(rowData.getData())}),this._dataset=chartDataset},getChartClickHandler:function(){var self=this;return function(){var rowId=this.rowId,level=self.level,rowDataset=self.controller.dataset.childDatasets.$resources.getRowByUuid(rowId);return self.controller.triggerDrillLevel(level,rowDataset),!0}}})}),define("syracuse-tablet/html/js/controls/array/ctrlArray",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/sdata/datasetUtils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/controls/array/ctrlArrayTableRow","syracuse-tablet/html/js/controls/array/ctrlArrayCardCell","syracuse-tablet/html/js/controls/array/paginators","syracuse-tablet/html/js/controls/array/builderHeader","syracuse-tablet/html/js/controls/array/searchArray","syracuse-tablet/html/js/controls/array/filtersSort","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/controls/array/builderTable","syracuse-tablet/html/js/controls/array/builderCard","syracuse-tablet/html/js/controls/array/builderCarousel","syracuse-tablet/html/js/controls/array/builderSeparator","syracuse-tablet/html/js/controls/array/builderChart","syracuse-tablet/html/js/common/consts"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),datasetUtils=require("syracuse-tablet/html/js/sdata/datasetUtils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),settings=require("syracuse-tablet/html/js/app/settings"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,CtrlArrayTableRow=require("syracuse-tablet/html/js/controls/array/ctrlArrayTableRow").CtrlArrayTableRow,CtrlArrayCardCell=require("syracuse-tablet/html/js/controls/array/ctrlArrayCardCell").CtrlArrayCardCell,paginators=require("syracuse-tablet/html/js/controls/array/paginators"),BuilderHeader=require("syracuse-tablet/html/js/controls/array/builderHeader").BuilderHeader,SearchArray=require("syracuse-tablet/html/js/controls/array/searchArray").SearchArray,FiltersSort=require("syracuse-tablet/html/js/controls/array/filtersSort"),modules=require("syracuse-tablet/html/js/common/modules"),BuilderTable=require("syracuse-tablet/html/js/controls/array/builderTable").BuilderTable,BuilderCard=require("syracuse-tablet/html/js/controls/array/builderCard").BuilderCard,BuilderCarousel=require("syracuse-tablet/html/js/controls/array/builderCarousel").BuilderCarousel,BuilderSeparator=require("syracuse-tablet/html/js/controls/array/builderSeparator").BuilderSeparator,BuilderChart=require("syracuse-tablet/html/js/controls/array/builderChart").BuilderChart,consts=require("syracuse-tablet/html/js/common/consts"),_builders={table:BuilderTable,card:BuilderCard,carousel:BuilderCarousel,separator:BuilderSeparator,chart:BuilderChart},_typeDefValue=function(prop){switch(prop.$type){case"application/x-password":case"application/x-string":return"";case"application/x-quantity":return 0;case"application/x-decimal":case"application/x-real":return 0;case"application/x-integer":return 0;case"application/x-boolean":return!1;case"application/x-date":return"";case"application/x-datetime":return"";case"application/x-time":return"";case"application/x-choice":return prop.$value.$enum[0].$value;case"application/x-reference":return{$value:"",$description:"",$title:""};case"application/x-array":return[];default:return null}},_dataProps=["$isMandatory","$isReadOnly","$isHidden","$isExcluded","$isDisabled","$actions","$format"],_proto2Instance=function(protoArray){var res={$properties:{}},props=protoArray.getValueByPath("$properties");for(var propName in props)if(!propName.smStartsWith("$")){var prop=props[propName];res[propName]=_typeDefValue(prop);var $properties=res.$properties[propName]={};_dataProps.forEach(function(p){prop[p]!=null&&($properties[p]=prop[p])})}return res};exports.CtrlArray=utils.defineClass(function CtrlArray(controller,article,prototype,options){Base.call(this,controller,article,prototype,options),this.$display="table",this.displayAsCarousel=!1,this.arrayController=new SdataController(controller.dataset.getChild(this.$bind),controller),this.arrayController.setUIAdapter(this),this._ensurePaginator(),this.filterSearch=this.filterSortAllowed()?new SearchArray(this):null,this.filterX3=this.filterSortAllowed()?new FiltersSort.Filters(this):null,this.filterSort=this.filterSortAllowed()?new FiltersSort.FilterSort(this):null,this.builderContent=null,this.builderHeader=null,this._checkAuthoring()},Base,{destroy:function(){Base.prototype.destroy.call(this),this.$$title=this.$$content=null,this.arrayController&&(this.arrayController.destroy(),this.arrayController=null),this.paginator&&(this.paginator.destroy(),this.paginator=null),this.filterSearch&&(this.filterSearch.destroy(),this.filterSearch=null),this.builderHeader&&(this.builderHeader.destroy(),this.builderHeader=null),this.filterX3&&(this.filterX3.destroy(),this.filterX3=null),this.filterSort&&(this.filterSort.destroy(),this.filterSort=null),this.builderContent&&(this.builderContent.destroy(),this.builderContent=null)},filterSortAllowed:function(){var page=this.tryGetPage();return page&&!page.isChild("SdataRowDetail")&&(this.prototype.root.isLookup()||this.prototype.root.isQuery())},_checkAuthoring:function(){this.$display=this.controller.isEditMode()||!this.article.$display?"table":this.article.$display,this.$display==="carousel"&&(this.$display="card",this.displayAsCarousel=!0);var page=this.tryGetPage(),isChartDetail=page&&page.isChild("SdataRowDetail"),isRowDetail=page&&page.isChild("SdataChartDetail"),defAuthoring={showPagination:!isChartDetail&&!page.isVignette(),showSortFilter:this.filterSort!=null,showSearch:this.filterSearch!=null,rowIndex:this.$display==="card"};this.article.$arrayOptions=$.extend(!0,defAuthoring,this.article.$arrayOptions||{}),this.displayAsCarousel===!0?(this.article.$cardsPerRow=1,this.article.$minWidth=1,this.article.$filters="none",this.article.$detailsLink="$none",this.article.$arrayOptions=$.extend(!0,this.article.$arrayOptions,{showPagination:!1,showSortFilter:!1,showSearch:!1,rowIndex:!0,showRowDetailLink:!1})):isChartDetail?this.article.$arrayOptions.showRowDetailLink=!1:isRowDetail?this.article.$arrayOptions.showRowDetailLink=!0:this.article.$arrayOptions.showRowDetailLink==null&&(this.article.$arrayOptions.showRowDetailLink=!1);if(this.filterSortAllowed()){var arrayOption={showSearch:this.article.$arrayOptions.showSearch&&(this._getArrayData().length>0||this.filterSearch.hasSearchCriteria()),showSortFilter:this.article.$arrayOptions.showSortFilter};this.controller.setActionAdapterArrayOptions(arrayOption,this.filterSearch)}},get$ItemProto:function(){return this.arrayController.dataset.get$ItemProto()},_newBuilderContent:function(){var BuilderClass=_builders[this.$display=="card"?this.displayAsCarousel?"carousel":"card":this.$display];return BuilderClass||(this.$display="table",this.displayAsCarousel=!1,BuilderClass=_builders.table),new BuilderClass(this)},_newBuilderHeader:function(){if(this.isSingleArray())return null;var headerOpts=$.extend(!0,null,this.article.$arrayOptions);return headerOpts.$filtersAuthoring=this.$filtersGetAuthoring(),headerOpts.showSortFilter=headerOpts.showSortFilter&&this.filterSort!=null&&this.page.isVignette(),headerOpts.showSearch=headerOpts.showSearch&&this.filterSearch!=null&&this.page.isVignette(),this.isArrayField()&&(headerOpts.showPagination=!1),headerOpts.showPagination||headerOpts.showSortFilter||headerOpts.showSearch||headerOpts.$$filtersAuthoring==="list"?new BuilderHeader(this,headerOpts):null},_iniBeforeBuild:function(refresh){if(!this.$$elmt){var css=["s-m-array","s-m-"+this.$display];this.displayAsCarousel&&css.push("s-m-carousel"),this.isSingleArray()&&css.push("s-m-single-array"),Base.prototype.buildHtml.call(this,css)}this.$$title||(this.$$title=$(uiUtils.createDomElement("div",["s-m-title"])).appendTo(this.$$elmt).hide());if(!this.$$content){this.$$content=$(uiUtils.createDomElement("div",["s-m-value"])).appendTo(this.$$elmt);if(this.$display==="card"){var bgColor=this.article.$arrayBgColor||"darkgrey";this.$$content.addClass("s-m-bg s-m-color-"+bgColor.toLowerCase())}}this.clearContent(refresh),this.$$elmt.toggleClass("empty",this.isEmpty());var title=(this.getTitle()||"").trim();this._displayArray()&&title.length>0&&this.getAuthoring("$isTitleHidden")!==!0&&(this.$$title.show(),this.$$title.text(title))},getNbRows:function(){return this.paginator.getNumRowsPage()},isEmpty:function(){return this.getNbRows()==0},getRowCtrlById:function(rowId){return this.arrayController.getControl(consts.ROWID_PREFIX+rowId)},_getArrayData:function(){var arrayData=[],jj=this.paginator.getNumRowsPage();for(var ii=0;ii<jj;ii++)arrayData.push(this.paginator.getRowByIndex(ii));return arrayData},clearContent:function(refresh){refresh!==!0&&(this.builderContent&&this.builderContent.destroy(),this.builderHeader&&this.builderHeader.destroy(),this.$$title.empty().hide(),this.builderContent=this._newBuilderContent(this),this.builderHeader=this._newBuilderHeader(this)),this.$$content.empty()},buildHtml:function(refresh){this._iniBeforeBuild(refresh);var arrayData=this._getArrayData();this.builderHeader&&this.builderHeader.buildHtml(arrayData,refresh),this.builderContent&&this.builderContent.buildHtml(arrayData,this.$$content,refresh)},buildOnResize:function(context){if(!this.builderContent)return;var arrayData=this._getArrayData();this.builderContent.buildOnResize(arrayData,this.$$content,context),this.notifyVignetteArrayHosted()},computeLayout:function(context){this.buildOnResize(context)},createRecordCtrl:function($$container,recordDataset,index,opts){recordDataset==null&&(recordDataset=this.createEmptyRowDataset());var $bind=this.$bind+"-"+recordDataset.$bind+"-"+index,klass,noEdit=!0;if(this.$display==="card")klass=CtrlArrayCardCell;else{if(this.$display!=="table")throw new Error("Unknown record array control");klass=CtrlArrayTableRow,noEdit=this.isSingleArray()!==!0}opts=$.extend(!0,{rowIndex:index,noEdit:noEdit,rowLinkDomAttrs:this._createRecordLinkAttr(),drillDownDomAttrs:this._createDrillDownLinkAttr(),showRowDetail:this.article.showRowDetailLink,showRowDelete:this.prototype.hasCapability("delete")},opts);var rowCtrl=new klass(recordDataset,this.arrayController,{$bind:this.$bind+"-"+recordDataset.$bind+"-"+index},recordDataset.prototype,opts);return this.appendStructElmt(rowCtrl),rowCtrl.set$$container($$container),rowCtrl.page=this.page,rowCtrl},_createRecordLinkAttr:function(){if(this.isArrayField()||this.isArrayChart())return null;var linkDomAttrs;if(this.controller.root.isLookupController)linkDomAttrs=this.getDataActionAttrs("lookupAccept");else{var $linkName=this.getAuthoring("$detailsLink");$linkName==null&&($linkName=this.page.isVignette()?"$queryfullpage":"$details");var $links=this.get$ItemProto().data("$links");$linkName=="$queryfullpage"||$links&&$links[$linkName]?linkDomAttrs=this.getSdataLinkAttrs($linkName):linkDomAttrs=null}return linkDomAttrs},_createDrillDownLinkAttr:function(){if(!this.isChartDetailPage())return null;var $linkName="",linkDomAttrs=null,$links=this.get$ItemProto().data("$links");return $links?($links.$drillDown&&($linkName="drillDown"),$links.levelUp&&($linkName="levelUp"),$linkName!==""&&(linkDomAttrs=this.getDataActionAttrs($linkName)),linkDomAttrs):null},notifyScrollerUpdate:function(){this.builderContent&&this.builderContent.updateGestureMgr()},notifyPaginationServer:function($link){this._updateSdataUrl($link)},notifyPaginationLocal:function(){this.destroyChildren(),this.buildHtml(!0)},notifyApplyFilter:function($url){this._updateSdataUrl({$url:$url})},_updateSdataUrl:function($link){this.page.fetchNewPageData($link)},_ensurePaginator:function(){this.paginator=new paginators.ArrayPaginatorServer(this)},_actPagination:function(direction){if(!this.paginator.isEnabled(direction))return;this.paginator.paginate(direction)},_actActionArray:function(id){switch(id){case"panelfiltersort":this._openFilterSortPanel();break;case"filterSelected":var filterId=arguments[1];filterId&&this.filterX3.filtersSelect(filterId);break;case"search":this.filterSearch.search();break;case"removeSearch":this.filterSearch.removeSearch()}},_openFilterSortPanel:function(){var panel=this.page.openPanel("filterSortPanel",{filter:!0,sort:!0});panel.ensureParentArray(this.id),panel.show()},isArrayField:function(){return this.controller?!this.prototype.root.isQueryLikeFacet():!1},isSingleArray:function(){return this.prototype.isSingleArray()},isArrayChart:function(){return!1},getFilterSortOptions:function(){var opt={$url:this.page.pageData.prototype.getValueByPath("$url",!0,!0),$filters:this.filterX3?this.filterX3.get$filterToApply():null,sortInfo:this.page.getPageSort(),filterInfos:this.page.getPageFilter(),searchInfo:this.filterSearch?this.filterSearch.searchInfos:null};return opt},excludeChildrenFromAuthoring:function(){return!0},getRowStatusInfo:function(){var type=this.getAuthoring("$statusEnabled");if(type==="mono"||type==="multi"){var status=this.getAuthoring("$status");return status==null||$.isEmptyObject(status)?null:{type:type,list:status}}return null},getColumnsInfo:function(onlyVisible){if(!this._columnsInfo){var base={$title:"",$titleOrig:"",$type:"",$bind:"",$widthType:"auto",$imgHeight:"small",$widthVal:0,$capabilities:""};this._columnsInfo=[];var itemProto=this.get$ItemProto(),props=itemProto.data("$properties");if(props){var self=this;Object.keys(props).forEach(function($bind){var prop=props[$bind];if(prop.$isHidden!==!0&&prop.$isExcluded!==!0&&["CREUSR","CREUSR_REF","UPDUSR","UPDUSR_REF"].indexOf($bind)<0){var p=$.extend(!0,{},base,prop);p.$title=itemProto.resolveExpression(prop.$title),p.$titleOrig=prop.$title,p.$bind=$bind,p.$bindValue=itemProto.getFieldValueName($bind),p.$bindType=itemProto.getFieldValueType($bind),self._columnsInfo.push(p)}})}}var dataProps=this.controller.dataset.getValueByPath("$properties");if(onlyVisible!==!0||dataProps==null)return this._columnsInfo;var res=[];return this._columnsInfo.forEach(function(prop){(dataProps[prop.$bind]==null||dataProps[prop.$bind].$isHidden!==!0)&&res.push(prop)}),res},_actAddRow:function(){var self=this;this.arrayController.addRow().then(function(rowDataset){rowDataset&&self.builderContent.appendRow(rowDataset).doAfterClickAddRow(self.isSingleArray())}).fail(function(result){modules.get("modal").error(result)})},removeRow:function(rowCtrl){var self=this;this.arrayController.removeRow(rowCtrl.getUuid()).then(function(){self._deleteCtrlRow(rowCtrl)}).fail(function(result){modules.get("modal").error(result)})},_deleteCtrlRow:function(rowCtrl){if(!rowCtrl)return;rowCtrl.destroy(),this._updateRowsIndex()},_updateRowsIndex:function(skipRowCtrl){var self=this,realIdx=1;this._getArrayData().forEach(function(rowDataset,idx){var rowCtrl=self.getRowCtrlById(rowDataset.getUuid());rowCtrl!=null&&(skipRowCtrl==null||skipRowCtrl!=rowCtrl)&&rowCtrl.updateRowIndex(realIdx++)})},_displayArray:function(){return this.controller.isEditMode()===!0||!this.isEmpty()||this.getAuthoring("$displayIfEmpty")===!0},getScrollViewRect:function(){return this.page.parentVignette?this.page.parentVignette.getScrollViewRect():this.page.mainContentRect},$filtersGetAuthoring:function(){if(!this.filterX3)return"none";var auth=this.getAuthoring("$filters",this.page.isVignette()?"none":"list");return auth!=="none"&&settings.getDeviceType()==="smartphone"&&(auth="tabs"),auth},$filtersAllowed:function(){return this.filterX3!=null&&this.filterX3.hasFilters()},setEmptyArrayMsg:function(text){this.$$content.empty();if(!this.isArrayField()){var title=this.getTitle();title&&$('<div class="s-m-no-data-title"/>').appendTo(this.$$content).text(title),$('<div class="s-m-no-data-label"/>').appendTo(this.$$content).text(text||locale.text("array.empty"))}},notifyVignetteArrayHosted:function(){if(this.isArrayField()||this.prototype.isLookup()||!this.page.isVignette()||!this.page.parentVignette)return;var parent=this.page.parentVignette.parent;if(parent&&parent.notifSpecialArrayHosted){var typeArray=this.displayAsCarousel?"carousel":this.$display;parent.notifSpecialArrayHosted(typeArray)}},savedCtxCreate:function(opts){if(!this.builderContent)return;var res={},builderCtx=this.builderContent.savedCtxCreate(opts);return builderCtx&&(res.$builder=builderCtx),$.isEmptyObject(res)?null:res},savedCtxRestore:function(ctx){if(!ctx)return;this.builderContent&&ctx.$builder&&this.builderContent.savedCtxRestore(ctx.$builder)},getAvailableSizeForCards:function(){var scale=this.getTransformScale();return{height:(this.$$elmt.height()-(this.builderHeader?this.builderHeader.$$elmt.height():0))/scale,width:this.$$content.width()/scale}},createEmptyRowDataset:function(){var proto=this.arrayController.dataset.rowPrototype,json=_proto2Instance(proto);return json.$uuid=utils.UUID(),this.arrayController.dataset.createRowDataset(json,proto,json.$uuid)},authOnSlideMinSize:function(size,action){if(!this.builderContent||!this.builderContent.authMinSize2Pixels)return;var arrayData=this._getArrayData();if(this.$display!="card"||arrayData.length==0)return;var scale=this.getTransformScale(),value=this.builderContent.authMinSize2Pixels(size),contentW=this.$$content.width()/scale,contentH=this.$$content.height()/scale,left=(contentW-value)/2+"px";value+="px";if(action=="start"){var height=this.$$content.find(this.$$content.find("#"+consts.ROWID_PREFIX+arrayData[0].getValue("$uuid"))).closest(".s-m-record").height();height=height,this.$$content.css({opacity:"0.3"}),this._$$cardSize=$('<div class="s-m-auth-minsize"><span>Min size'+value+"</span></div>").appendTo(this.$$elmt),this._$$cardSize.css({height:height+"px",width:value,top:this.$$content.position().top+height/2+"px",left:left});return}if(action=="stop"){this.$$content.css({opacity:"inherit"}),this._$$cardSize.remove(),this._$$cardSize=null;return}if(action=="slide")return this._$$cardSize&&(this._$$cardSize.css({width:value,left:left}),this._minCardText||(this._minCardText=locale.text("array.minCardWidth")+" ",this._minCardSpan=this._$$cardSize.children("span")),this._minCardSpan.text(this._minCardText+value)),value},isChartDetailPage:function(){return!1},isAuthoringPropAllowed:function(property,value){if(property!=="arrayDisplay")return Base.prototype.isAuthoringPropAllowed.call(this,property,value);switch(value){case"table":return!0;case"separator":return this.isSingleArray();case"card":case"carousel":return!this.isSingleArray();default:return!1}},getCardDetailPageData:function(){var dataset=this.getAuthoringDataset();return{prototype:dataset.prototype,dataset:dataset,page:{$article:this.article.$card}}},getAuthoringDataset:function(){var datasetJson,arrayDataSet=this.arrayController.dataset,num=arrayDataSet.getNumRows();num>0?datasetJson=arrayDataSet.getRowByIndex(0).json:datasetJson={};var prototype=arrayDataSet.rowPrototype.clone(),klass=datasetUtils.getImplementation("RowDataset"),dataset=new klass(datasetJson,prototype,arrayDataSet,"$cardDetailDummy");return prototype.json.$title=dataset.resolveExpression(prototype.json.$title),dataset},setCardDetailArticle:function(article){this.article.$card=article},getTransformScale:function(){return modules.get("siteLayout").getTransformScale()},multiSelToggleStatus:function(enabled){this.builderHeader&&this.builderHeader.disable(enabled===!0)},multiSelGetSelectedData:function(disableClick){var self=this,data=[];return this.$$content.find(".s-m-record.s-m-multi-selected").each(function(idx,record){record=$(record),disableClick&&record.attr("disabled","true");var selector='.s-m-control.s-m-ctrl[data-sdata-link-bind="$resources"]',rowId=record.is(selector)?record:record.find(selector);rowId=rowId.attr("id").split(consts.ROWID_PREFIX);if(rowId.length>0){rowId=rowId[1];var rowdata=self.arrayController.dataset.getRowByUuid(rowId);rowdata&&data.push({rowData:rowdata,rowId:rowId,$$record:record,idx:idx,status:"init"})}}),data},multiSelAddDiagnoses:function(data){data.$$record.addClass(data.status);if(data.success!==!0&&data.$diagnoses&&data.$diagnoses.length>0){var diag=data.$diagnoses[0],$$diag=$('<div " class="alert alert-'+(diag.$severity==="error"?"danger":"success")+'" role="alert">'+diag.$message+"</div>"),$$root,smoothOffset;if(this.$display=="table"){var colSpan=data.$$record.children("td").length;$$root=$('<tr class="s-m-multisel-diag" data-nevent data-naction="multiSelTriggerAction" data-params="showdiagnoses"><td colspan="'+colSpan+'"/></tr>'),data.$$record.after($$root),$$diag.appendTo($$root.find("td")),smoothOffset=30}else $$root=$('<section style="padding:2px;width:100%;left: 0px;bottom:0px;" class="s-m-multisel-diag" data-nevent data-naction="multiSelTriggerAction" data-params="showdiagnoses"/>').prependTo(data.$$record.find(".s-m-card")),$$diag.appendTo($$root),smoothOffset=5;$$root.smData("diagnoses",data.$diagnoses),this.notifyScrollerUpdate()}this.builderContent.makeVisible(data.$$record,smoothOffset)},multiSelShowDiagnoses:function(event){if(!event)return;var $$elmt=$(event.target).closest(".s-m-multisel-diag"),diags=$$elmt.smData("diagnoses");if(diags==null||diags.length==0)return;modules.get("modal").error({$diagnoses:diags})},multiSelExit:function(){this.$$content.find(".s-m-record").removeClass("error success");var $$diags=this.$$content.find(".s-m-multisel-diag");$$diags.smRemoveData("diagnoses").remove(),$$diags.remove(),this.$$content.find(".s-m-record.s-m-multi-selected").removeAttr("disabled"),this.notifyScrollerUpdate()},onDeltaRow:function(action,arrayDataset,$uuid,idx){var rowCtrl;this.arrayController.forEachControl(function(row){if(row&&row.getUuid()==$uuid)return rowCtrl=row,!0}),rowCtrl&&this._deleteCtrlRow(rowCtrl);if(action=="removed")return;var rowDataset=arrayDataset.getRowByUuid($uuid);if(!rowDataset)return;rowCtrl=this.builderContent.appendRow(rowDataset),this._updateRowsIndex()}})}),define("syracuse-tablet/html/js/controls/array/ctrlArrayChart",["require","exports","module","syracuse-tablet/html/js/controls/array/ctrlArray","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/controls/array/paginators"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/array/ctrlArray").CtrlArray,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),paginators=require("syracuse-tablet/html/js/controls/array/paginators");exports.CtrlArrayChart=utils.defineClass(function CtrlArrayChart(controller,article,prototype,options){options=options||{},options.localPagination=prototype.isCube(),article.$arrayOptions=article.$arrayOptions||{},article.$arrayOptions.showSortFilter=!1,article.$arrayOptions.showSearch=!1,article.$display||(article.$display="chart"),Base.call(this,controller,article,prototype,options)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(refresh){Base.prototype.buildHtml.call(this,refresh),this.isHighChart()?this.$$elmt.addClass("s-m-chart"):(this.isOpenDetailEnabled()&&this.addChartDetailLink(this.$$value),this.$$elmt.addClass("s-m-chart-array")),this.article.$isHidden===!0&&this.$$elmt.addClass("s-m-hidden")},addChartDetailLink:function($$elmt){this.$$elmt.attr("data-control-id",this.id).attr("data-naction","chartDetail"),this.$$elmt.attr("data-nevent","")},_actChartDetail:function(){if(this.isEmpty())return;this.controller.gotoUrl(this.page.pageData.$url,null,{childContext:{controllerId:this.controller.id},isChartDetail:!0,level:0})},isArrayChart:function(){return!0},setEmptyArrayMsg:function(){Base.prototype.setEmptyArrayMsg.call(this,locale.text("label.chart.nodata"))},_ensurePaginator:function(){this.prototype.isCube()?this.paginator=new paginators.ArrayPaginatorClient(this,10):Base.prototype._ensurePaginator.call(this)},isDisplayedInDetailPage:function(){return this.isChartDetailPage()||!this.page.isVignette()},chartNeedsHeight:function(){return this.$display==="chart"&&this._layouytType==="stack"&&!this.isDisplayedInDetailPage()},isHighChart:function(){return this.$display==="chart"},isOpenDetailEnabled:function(){return this.isChartDetailPage()||this.displayAsCarousel?!1:this.page.isVignette()?this.article.$openDetail!==!1:!0},isChartDetailPage:function(){return this.page.isChartDetail()},isAuthoringPropAllowed:function(property,value){return property!=="arrayDisplay"?Base.prototype.isAuthoringPropAllowed.call(this,property,value):value==="separator"?!1:this.isChartDetailPage()?this.article.$forceArray===!0?value!=="chart":value==="chart":!0}})}),define("syracuse-tablet/html/js/sdata/wpHelpers",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/sdata/sdataStatic","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/controls/vignette/gadget","syracuse-tablet/html/js/sdata/dataset","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/app/navigationPageStack","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){function _fetchWelcomePageData(opts){var prototypeJson,datasetJson,$resources,$url=_getHomeDashboardUrl(opts),noAutoSave=!1,meta;prototypeJson=sdataStatic.getMobileDashboardProto();var fetchDashboard=$.Deferred();return ajax.request($url,"GET").then(function(result){fetchDashboard.resolve(result.data.dashboard)}).fail(function(result){noAutoSave=!0,opts.isPersonal&&result.offline?_readWelcomeDashboardClient(opts.user,opts.userRole).then(function(result){fetchDashboard.resolve(result)}).fail(function(){fetchDashboard.resolve(null)}):fetchDashboard.reject(result)}),fetchDashboard.then(function(dashboard){return $resources=dashboard||{},_getDefaultDataHome($resources.content,opts.isPersonal)}).then(function(datasetJson){return _appendTestHomeDataset(datasetJson)}).then(function(dataset){return datasetJson=dataset,_getHomePage($resources,datasetJson)}).then(function(page){return meta=page.meta||{},meta.uuid=opts.isPersonal?null:opts.currentUuid?opts.currentUuid:opts.uuid,meta.description=opts.description||meta.description,datasetJson.$clientContext={$mobileEndpoint:_getEndpoint()},protoHelpers.checkTransform($url,prototypeJson,datasetJson,page)}).then(function(pageDataTransformed){var pageData={};pageData.prototype=new Prototype(pageDataTransformed.prototypeJson),pageData.dataset=new Dataset(pageDataTransformed.datasetJson,pageData.prototype),pageData.isWorkingCopy=!1,pageData.$url=$url,pageData.$originalUrl=$url,pageData.page=pageDataTransformed.page,pageData.meta=meta,pageData.isPersonal=opts.isPersonal;if(!$resources.content||!_havePersonalDashboard($resources.$views)){if(noAutoSave!==!0&&opts.isPersonal){var data=exports.createWelcomeDashboardFromPageData(pageData,!0);exports.saveWelcomeDashboard(data)}}else if(opts.isPersonal){var data=exports.createWelcomeDashboardFromPageData(pageData,!0);_saveWelcomeDashboardClient(data)}return pageData})}function _havePersonalDashboard(availableViews){var views=availableViews||[];return views.some(function(view){return view.$isPersonal})}function _appendTestHomeDataset(dataset){if(!jsutils.isDvlpVersion())return $.smResolve(dataset);var gadget={$uuid:"$MOCK_mobileDashboard_Gadget",$title:"Test applications",$url:"{$hostPort}/mobile2/$client/$local/$dataset/mobileDashboard('MOCK')",$method:"GET",$type:"$application"};return dataset.$mobileGadgets[gadget.$uuid]=gadget,dataset.vignettes.push({local:!0,gadget:{$uuid:gadget.$uuid},$uuid:"$MOCK_mobileDashboard_Vignette",persistentId:"$MOCK_mobileDashboard_Vignette"}),$.smResolve(dataset)}function _getDefaultDataHome(content,isPersonal){return metaDataCache.getApplicationsList().then(function(appList){return isPersonal&&(appList=exports.filterApps(appList)),_checkHomeDataset(appList,content)})}function _getHomePage($resources,datasetJson){var article=$resources.content?$resources.content.$article:null;return{$article:_homeArticle(article,datasetJson),$views:$resources.$views,$roles:$resources.roles||[],meta:{description:$resources.description||locale.text("welcome.mydashboard")}}}function _homeArticle($article,datasetJson){if(!$article)return _defaultHomeArticle(datasetJson);var $items=[];return datasetJson.vignettes.forEach(function(v){v.local&&$items.push({$layoutType:"tile",$title:"",$size:"medium",$items:[{$bind:v.persistentId}]})}),$items.length>0&&$article.$items.unshift({local:!0,$layoutType:"hubgroup",$title:"Test applications",$items:$items}),$article}function _defaultHomeArticle(datasetJson){var uuid=utils.UUID(),article={$layoutType:"hub",$items:[{local:!0,$layoutType:"hubgroup",$title:"Test applications",$items:[]},{$layoutType:"hubgroup",$title:"{@"+uuid+"}",$items:[]}],$localization:{}};utils.setLocalization(article.$localization,uuid,"All Available applications");var i;return datasetJson.vignettes.forEach(function(v){i=v.local?0:1,article.$items[i].$items.push({$layoutType:"tile",$size:"medium",$items:[{$bind:v.persistentId}]})}),article.$items[0].$items.length===0&&article.$items.shift(),article}function _checkHomeDataset(appList,dashboardContent){var dataset=_ensureHomeDatasetCompatibility(dashboardContent,appList);if(dataset)return dataset;var datasetJson={vignettes:[],$mobileGadgets:{}},endpoint=modules.get("appController").App.getCurrentEndpoint();return appList.forEach(function(app){var vignette={persistentId:app.$uuid,gadget:{$uuid:app.$uuid}};datasetJson.vignettes.push(vignette),datasetJson.$mobileGadgets[app.$uuid]={$type:"$application",$title:app.title,icon:app.iconName,applicationName:app.applicationName}}),datasetJson}function _ensureHomeDatasetCompatibility(datasetJson,appList){var appName,compatibleDatasetJson={$mobileGadgets:{},vignettes:[]};if(!datasetJson)return null;var appTitleList=_getAppListTitle(appList);if(datasetJson.$mobileGadgets)return datasetJson.vignettes.forEach(function(vi){_isVignetteAvailable(datasetJson.$mobileGadgets[vi.gadget.$uuid],appList)&&(compatibleDatasetJson.vignettes.push(vi),compatibleDatasetJson.$mobileGadgets[vi.gadget.$uuid]=datasetJson.$mobileGadgets[vi.gadget.$uuid],compatibleDatasetJson.$mobileGadgets[vi.gadget.$uuid].$type==="$application"&&(appName=compatibleDatasetJson.$mobileGadgets[vi.gadget.$uuid].applicationName,compatibleDatasetJson.$mobileGadgets[vi.gadget.$uuid].$title=appTitleList[appName]?appTitleList[appName].$title:compatibleDatasetJson.$mobileGadgets[vi.gadget.$uuid].$title))}),compatibleDatasetJson;var endpoint=modules.get("appController").App.getCurrentEndpoint();return Object.keys(datasetJson.$vignettes).forEach(function(key){_isVignetteAvailable(datasetJson.$gadgets[key],appList)&&(compatibleDatasetJson.vignettes.push({persistentId:key,gadget:{$uuid:key}}),compatibleDatasetJson.$mobileGadgets[key]=datasetJson.$gadgets[key],compatibleDatasetJson.$mobileGadgets[key].$type==="$application"&&(appName=compatibleDatasetJson.$mobileGadgets[key].applicationName,compatibleDatasetJson.$mobileGadgets[key].$title=appTitleList[appName]?appTitleList[appName].$title:compatibleDatasetJson.$mobileGadgets[key].$title))}),compatibleDatasetJson}function _getAppListTitle(appList){var appListTitle={};return appList.forEach(function(app){appListTitle[app.applicationName]={$title:app.title,$description:app.description}}),appListTitle}function _isVignetteAvailable(gadget,appList){var appMap={};return appList.forEach(function(app){appMap[app.applicationName]=app}),gadget.$type!=="$application"||gadget.$type==="$application"&&appMap[gadget.applicationName]}function _computeWelcomePageData(content,isPersonal,roles,meta){var data={description:meta.description||locale.text("welcome.mydashboard"),clientId:"",content:content,isPersonal:isPersonal,uuid:meta.uuid};if(isPersonal){var up=modules.get("appController").App.getCurrentUserProfile();data.user={$uuid:up.user.$uuid},data.role={$uuid:up.selectedRole.$uuid}}else roles&&(data.roles=roles);return data}function _computeWelcomePageContent(pageData){var $gadgets={},$article={},vignettes=[];pageData.dataset.json.$vignettes.forEach(function(vi){vi.local||(vignettes.push(vi),$gadgets[vi.gadget.$uuid]=pageData.dataset.json.$mobileGadgets[vi.gadget.$uuid])}),$article.$layoutType=pageData.page.$article.$layoutType,$article.$items=[],pageData.page.$article.$items.forEach(function(item){item.local||$article.$items.push(item)}),$article.$localization=pageData.page.$article.$localization;var content={$dashboardName:"$welcomeDashboard",$title:"Home",$article:$article,vignettes:vignettes,$mobileGadgets:$gadgets};return content}function _getEndpoint(){return modules.get("appController").App.getDefaultEndpoint()}function _getHomeDashboardUrl(opts){var url="/mobile2/syracuse/collaboration/syracuse/welcomeDashboards/$service/availableDashboard?representation=mobileDashboard.$details";return url+=opts.user?"&user="+opts.user:"",url+=opts.userRole?"&role="+opts.userRole:"",url+=opts.uuid?"&uuid="+opts.uuid:"",protoHelpers.getHostPort()+url}function _saveWelcomeDashboardClient(data){if(!data.isPersonal)return $.smResolve();var ctx={$user:data.user.$uuid,$role:data.role.$uuid,$lang:"none"};return modules.get("storage").getStorage().put({$context:ctx,$collection:"$welcomeDashboard",$endpoint:"$local",$key:ctx.$user+"_"+ctx.$role,$data:data})}function _getCurrentWelcomeDashboard(){var topStackElement=getTopElementStack(),uuid=topStackElement&&topStackElement.pageCreateData&&topStackElement.pageCreateData.options&&topStackElement.pageCreateData.options.uuid;if(uuid){var opts={uuid:uuid};return _fetchWelcomePageData(opts).then(function(pageData){return exports.createWelcomeDashboardFromPageData(pageData,!1)})}return _getWelcomeDashboarClient()}function _getWelcomeDashboarClient(){var elmt=getTopElementStack(),up=modules.get("appController").App.getCurrentUserProfile();return _readWelcomeDashboardClient(up.user.$uuid,up.selectedRole.$uuid).then(function(data){return data})}function getTopElementStack(){var stack=navigationPageStack.getMainStack(),items=stack.getStackItems();return items[0]}function _readWelcomeDashboardClient($userUuid,$roleUuid){var ctx={$user:$userUuid,$role:$roleUuid,$lang:"none"};return modules.get("storage").getStorage().read({$context:ctx,$collection:"$welcomeDashboard",$endpoint:"$local",$key:ctx.$user+"_"+ctx.$role}).then(function(result){return result.$status===1?result.$data:null})}function _saveWelcomeDashboardServer(data){return ajax.request("/sdata/syracuse/collaboration/syracuse/welcomeDashboards/$service/updateDashboard","POST",data).then(function(result){return result.data})}function _getPinLocalization(article,gadget,localization){var pinlocalization={};if(!localization)return pinlocalization;var titles=_getTitles(article,gadget);return Object.keys(localization).forEach(function(lang){Object.keys(localization[lang]).forEach(function(key){titles["{@"+key+"}"]&&(pinlocalization[lang]=pinlocalization[lang]||{},pinlocalization[lang][key]=localization[lang][key])})}),pinlocalization}function _getTitles(article,gadget){function _walk(value){if(value==null||typeof value!="object")return;Object.keys(value).forEach(function(key){var v=value[key];key==="$title"&&v!=""?titles[v]=v:_walk(v)})}if(!article)return article;var value=$.extend(!0,{},article),titles={};return _walk(value),utils.isExpression(gadget.$title)&&(titles[gadget.$title]=gadget.$title),titles}function _getHubGroup($article,$bind){var grp;return $article.$items.forEach(function(hubgroup){!grp&&hubgroup.$items.length>0&&hubgroup.$items.forEach(function(item){item.$items[0].$bind===$bind&&(grp=hubgroup)})}),grp}function _buildArticle(pageData){var article={$bgColor:"darkgrey",$items:[{$bind:pageData.id}],$layoutType:"tile",$size:"medium"};return _articleTitle(pageData,article.$items[0]),article}function _buildVignette(pageData){return{gadget:{$uuid:pageData.id},persistentId:pageData.id,displayStyle:pageData.displayStyle}}function _buildGadget(pageData){return pageData.$type=="$dashboard"?_buildDashboardGadget(pageData):pageData.$type=="$representation"?_buildRepresentationGadget(pageData):pageData}function _buildRepresentationGadget(pageData){var gadget={$type:pageData.$type,icon:pageData.icon,entity:pageData.entity,action:pageData.action,representation:pageData.representation,facet:pageData.facet,keyParameter:pageData.key,applicationName:pageData.applicationName};return gadget}function _buildDashboardGadget(pageData){var gadget={$type:pageData.$type,icon:pageData.icon,dashboardName:pageData.name,applicationName:pageData.applicationName};return gadget}function _gadgetTitle(pageData,gadget){if(!utils.isExpression(pageData.$title)){var uuid=utils.UUID();gadget.$title="{@"+uuid+"}",pageData.localization=pageData.localization||{},utils.setLocalization(pageData.localization,uuid,pageData.$title)}return gadget}function _articleTitle(pageData,article){if(!utils.isExpression(pageData.$title)){var uuid=utils.UUID();article.$title="{@"+uuid+"}",pageData.localization=pageData.localization||{},utils.setLocalization(pageData.localization,uuid,pageData.$title)}else article.$title=pageData.$title;return article}function _closerTitle(item){var title=item.$title,drillDown=function(it){if(!it)return;title=it.$title||(it.$article?it.$article.$title:"")||title,drillDown(it.$article&&it.$article.$items?it.$article.$items[0]:null)};return drillDown(item),title}var modules=require("syracuse-tablet/html/js/common/modules"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),sdataStatic=require("syracuse-tablet/html/js/sdata/sdataStatic"),ajax=require("syracuse-tablet/html/js/common/ajax"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),gadget=require("syracuse-tablet/html/js/controls/vignette/gadget"),Dataset=require("syracuse-tablet/html/js/sdata/dataset").Dataset,Prototype=require("syracuse-tablet/html/js/sdata/prototype").Prototype,locale=require("syracuse-tablet/html/js/helpers/locale"),navigationPageStack=require("syracuse-tablet/html/js/app/navigationPageStack"),utils=require("syracuse-tablet/html/js/helpers/utils");exports.fetchWelcomePageData=function(options){var up=modules.get("appController").App.getCurrentUserProfile(),opts=options||{};return opts.user=up.user.$uuid,opts.userRole=up.selectedRole.$uuid,opts.isPersonal=opts.isPersonal||!opts.uuid,_fetchWelcomePageData(opts)},exports.filterApps=function(appList){var up=modules.get("appController").App.getCurrentUserProfile(),validApps=[],curEp=up.selectedEndpoint.code,curRole=up.selectedRole.code;return appList.forEach(function(app){var valid=app.endpoints.length===0||app.endpoints.some(function(ep){return[ep.application,ep.contract,ep.dataset].join(".")===curEp});valid=valid&&(app.roles.length===0||app.roles.some(function(role){return role.code===curRole})),valid&&validApps.push(app)}),validApps},exports.welcomePageToCommands=function(data){function _walk(article){if(article.$bind){var vignette=data.prototype.json.$properties[article.$bind];vignette&&vignette.$type==="application/x-vignette-link"&&vignettes.push(vignette)}article.$items&&article.$items.forEach(_walk)}var vignettes=[];_walk(data.page.$article);var commands=[];return vignettes.forEach(function(vignette){var g=gadget.createGadget(new Prototype(vignette));if(g){var title=g.data("$title"),link=g.getLink();link&&title&&commands.push({title:title,page:link})}}),commands},exports.createWelcomeDashboardFromPageData=function(pageData,isPersonal){var content=_computeWelcomePageContent(pageData),data=_computeWelcomePageData(content,isPersonal,pageData.page.$roles,pageData.meta);return data},exports.saveWelcomeDashboard=function(data){return _saveWelcomeDashboardClient(data).then(function(){return _saveWelcomeDashboardServer(data).then(function(data){return data})})},exports.isPagePinned=function(pageId){var self=this;return _getCurrentWelcomeDashboard().then(function(data){return data&&data.content&&data.content.$mobileGadgets&&data.content.$mobileGadgets[pageId]?!0:!1})},exports.getListOfRoles=function(){return ajax.request("/sdata/syracuse/collaboration/syracuse/welcomeDashboards/$service/listOfRoles").then(function(result){return result.data&&result.data.$resources?result.data&&result.data.$resources:[]})},exports.deleteDashboardTemplate=function(uuid){return ajax.request("/sdata/syracuse/collaboration/syracuse/welcomeDashboards/$service/deleteDashboard?uuid="+uuid).then(function(result){return result.data})},exports.pinPage=function(pageData,article){var self=this;return _getCurrentWelcomeDashboard().then(function(data){var gadget=_buildGadget(pageData),gadgetName=pageData.id;data.content.$mobileGadgets[gadgetName]=gadget;var vignette=_buildVignette(pageData);data.content.vignettes.push(vignette);var lastGroup=data.content.$article.$items[data.content.$article.$items.length-1];article=article||_buildArticle(pageData),lastGroup.$items.push(article),data.content.$article.$localization=data.content.$article.$localization||{};var localization=_getPinLocalization(article,gadget,pageData.localization);return Object.keys(localization).forEach(function(lang){Object.keys(localization[lang]).forEach(function(key){data.content.$article.$localization[lang]=data.content.$article.$localization[lang]||{},data.content.$article.$localization[lang][key]=localization[lang][key]})}),data}).then(function(data){return exports.saveWelcomeDashboard(data)}).then(function(data){return!0}).fail(function(){return!1})},exports.unPinPage=function(pageData){var self=this,gadgetName=pageData.id;return _getCurrentWelcomeDashboard().then(function(data){delete data.content.$mobileGadgets[gadgetName];var vignettes=data.content.vignettes.filter(function(vignette){if(vignette.persistentId!==gadgetName)return!0});data.content.vignettes=vignettes;var grp=_getHubGroup(data.content.$article,gadgetName),items=grp.$items.filter(function(item){if(item.$items[0].$bind!==gadgetName)return!0});return grp.$items=items,data}).then(function(data){return exports.saveWelcomeDashboard(data)}).then(function(data){return!0}).fail(function(){return!1})},exports.isPinnedTile=function($bind){return _getCurrentWelcomeDashboard().then(function(data){return data&&data.content&&data.content.vignettes?data.content.vignettes.some(function(vig){return vig.persistentId===$bind}):!1})},exports.addPinnedTile=function($article,prototype,localization){var pageData=prototype.json.$item,article=$.extend(!0,{},$article);return article.$layoutType!=="tile"&&(article.$bgColor="darkgrey",article.$layoutType="tile",article.$size="large"),article.$items&&article.$items[0]&&(article.$items[0].$title=_closerTitle(article.$items[0])||article.$title),pageData.id=article.$items[0].$bind,pageData.applicationName=pageData.$clientContext.$mobileApplication,pageData.displayStyle="$full",pageData.localization=localization||{},exports.pinPage(pageData,article)}}),define("syracuse-tablet/html/js/controls/vignette/ctrlVignette",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/controls/vignette/gadget","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/app/navigationPageStack","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/deps/hammerjs-2.0.4/hammer","syracuse-tablet/html/js/sdata/wpHelpers","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/app/globals"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,uiRect=require("syracuse-tablet/html/js/ui/rect"),utils=require("syracuse-tablet/html/js/helpers/utils"),justils=require("syracuse-tablet/html/js/helpers/jsutils"),environment=require("syracuse-tablet/html/js/helpers/environment"),gadget=require("syracuse-tablet/html/js/controls/vignette/gadget"),locale=require("syracuse-tablet/html/js/helpers/locale"),settings=require("syracuse-tablet/html/js/app/settings"),navigationPageStack=require("syracuse-tablet/html/js/app/navigationPageStack"),modules=require("syracuse-tablet/html/js/common/modules"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),Hammer=require("syracuse-tablet/html/deps/hammerjs-2.0.4/hammer"),wpHelpers=require("syracuse-tablet/html/js/sdata/wpHelpers"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),globals=require("syracuse-tablet/html/js/app/globals"),_templates={main:"			<section/>		",vignetteError:'			<a draggable="false" href="#" data-nevent="" data-naction="vignetteError">{{text}}</a><span class="s-m-diagnose" style="display:none">{{detail}}</span>		',iframe:'			<br><iframe src="{{url}}" style="position: absolute; top: 0px; left: 0px; height: 100vh; width: 100vh;"/>		'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.CtrlVignette=utils.defineClass(function CtrlVignette(controller,article,prototype,options){this.navigationPageStack=null,this.gadget=null,this.hammer=null,options=options||{},options.nativeCapabilities={liveTile:!0},Base.call(this,controller,article,prototype,options),this.gadget=gadget.createGadget(this.prototype,options.dashboardParameters);if(!this.gadget)throw new Error("Cant' create vignette's gadget["+this.id+"] - Check prototype")},Base,{destroy:function(){Base.prototype.destroy.call(this),this.navigationPageStack&&this.navigationPageStack.destroy(!0),this.navigationPageStack=null,this.gadget&&this.gadget.destroy(),this.gadget=null,this.hammer&&(this.hammer.destroy(),this.hammer=null)},buildHtml:function(){Base.prototype.buildHtml.call(this,["s-m-vignette"]),this._addDashboardParams(),this.$$elmt.html(_getHtml("main",{})),this._$$content=this.$$elmt.children("section"),this._$$waitBckg=this.$$elmt.children(".s-m-waiting.bckg"),this._addPressHandler()},_addPressHandler:function(){this.hammer&&this.hammer.destroy(),this.hammer=new Hammer(this.$$elmt.get(0)),this.hammer.get("press").set({time:500}),this.hammer.on("press",Hammer.bindFn(this._onPress,this))},_onPress:function(evt){if(globals.isAuthoringActive())return;if(this.page.isHome())return notifications.publish("sm.vignette.pressed",this.id),!0;var self=this;wpHelpers.isPinnedTile(this.$bind).then(function(pinned){if(pinned){modules.get("modal").info("",locale.text("pin.tile.pinned"));return}modules.get("modal").simpleConfirmPromise({message:locale.text("pin.tile.add.confirm")}).then(function(result){if(result.action!=="yes")return;var localization=$.extend(!0,{},self.$articleLocalization);wpHelpers.addPinnedTile(self.parent.article,self.prototype,localization).then(function(){var notify={severityClass:"success",title:"",body:locale.text("pin.tile.add.ok"),onlyWebapp:!0};modules.get("modal").notify(notify)})})})},afterRender:function(){var link=this.gadget.getLink();if(link)switch(this.gadget.getType()){case"$external":var iFrame=_getHtml("iframe",{url:link.$url});$(iFrame).appendTo(this._$$content);break;case"$representation":case"$stats":case"$request":this.loadSDataPage(link)}else this._displayError("No Gadget link")},_addDashboardParams:function(){var params=this.page.getGadgetParams();params&&this.gadget.setDashboardParams(params)},loadSDataPage:function(link){var self=this,pageOptions={isVignette:!0,pagePrefsId:settings.getPagePrefsId(protoHelpers.getPageName(link.$url),this),makeFullHeight:!0,$vignetteArticle:this.article&&this.article.$article&&!$.isEmptyObject(this.article.$article)?this.article.$article:null,parentVignette:self,parentPage:self.page,savedCtx:this.page.getSavedCtxVignette(this)};self.navigationPageStack=navigationPageStack.getStackForElmt(self._$$content);var loadOptions={navStack:self.navigationPageStack,noError:!0,$$waitParent:self.$$elmt};self.controller.openLink(link,pageOptions,loadOptions).then(function(nestedPage){if(self.destroyed)return;nestedPage.notifyScrollerUpdate(),self.page.onVignetteLoaded(self,!0),environment.isAutoUITestMode()&&environment.getUnitTestMgr().notifPageLoaded("after",nestedPage)}).fail(function(e){if(self.destroyed)return;self._displayError(e),self.page.onVignetteLoaded(self,!1)})},afterAllVignettesLoaded:function(){try{if(this.destroyed)return;this.computeLayout()}catch(e){this._displayError(e)}},computeLayout:function(){this.getTopPage()&&this.getTopPage().computeLayout()},_displayError:function(e){if(!this.$$elmt)return;var diag=justils.convertToDiagnoses(e);if(!this.$$elmt.is(".s-m-error"))this.$$elmt.addClass("s-m-error"),this.$$elmt.prepend(_getHtml("vignetteError",{text:locale.text("vignette.load.failed"),detail:JSON.stringify(diag)}));else try{var currentDiag=JSON.parse(this.$$elmt.find("span").text());currentDiag.$diagnoses=currentDiag.$diagnoses.concat(diag.$diagnoses),this.$$elmt.find("span").text(JSON.stringify(currentDiag))}catch(e){return}},getTitle:function(){return this.article&&this.getArticleText("$title",this.gadget.data("$title"))},_actVignetteError:function(){var diag=this.$$elmt.find("span.s-m-diagnose").text();try{diag=JSON.parse(diag)}catch(e){return}modules.get("modal").asynchError(null,diag)},getTopPage:function(){return this.navigationPageStack&&this.navigationPageStack.getTopPage()},getScrollViewRect:function(){return uiRect.elmtRect(this._$$content)},isVignette:function(){return!0}})}),define("syracuse-tablet/html/js/controls/vignette/ctrlVignetteLink",["require","exports","module","syracuse-tablet/html/js/controls/ctrlSdataBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/vignette/gadget","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/app/navigationPageStack","syracuse-tablet/html/deps/hammerjs-2.0.4/hammer","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/ctrlSdataBase").CtrlSdataBase,utils=require("syracuse-tablet/html/js/helpers/utils"),gadget=require("syracuse-tablet/html/js/controls/vignette/gadget"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),navigationPageStack=require("syracuse-tablet/html/js/app/navigationPageStack"),Hammer=require("syracuse-tablet/html/deps/hammerjs-2.0.4/hammer"),globals=require("syracuse-tablet/html/js/app/globals"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),_templates={linkPage:'			<section>				<div draggable="false" href="{{href}}"				class="s-m-link-page" data-nevent="" data-naction="touch">					{{#if icon}}						<section class="s-m-icon">							<div>								<div class="{{icon}}"></div>							</div>						</section>					{{/if}}					<section class="s-m-title">						<div>{{title}}</div>					</section>				</div>			</section>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.CtrlVignetteLink=utils.defineClass(function CtrlVignetteLink(controller,article,prototype,options){this.hammer=null,Base.call(this,controller,article,prototype,options),this.gadget=gadget.createGadget(this.prototype);if(!this.gadget)throw new Error("Cant' create vignette's gadget["+this.id+"] - Check prototype")},Base,{destroy:function(){Base.prototype.destroy.call(this),this.navigationPageStack&&this.navigationPageStack.destroy(),this.navigationPageStack=null,this.gadget&&this.gadget.destroy(),this.gadget=null,this.hammer&&(this.hammer.destroy(),this.hammer=null)},buildHtml:function(){Base.prototype.buildHtml.call(this,["s-m-vignette"]),this._addDashboardParams();switch(this.gadget.getType()){case"$representation":this._loadRepresentation();break;case"$dashboard":this._loadDashboard();break;case"$application":this._loadApplication();break;case"$external":this._loadExternal();break;default:}this._addPressHandler()},_addPressHandler:function(){this.hammer&&this.hammer.destroy(),this.hammer=new Hammer(this.$$elmt.get(0)),this.hammer.get("press").set({time:500}),this.hammer.on("press",Hammer.bindFn(this._onPress,this))},_onPress:function(evt){if(globals.isAuthoringActive())return;if(this.page.isHome())return notifications.publish("sm.vignette.pressed",this.id),!0},afterRender:function(){},_addDashboardParams:function(){var params=this.page.getGadgetParams();params&&this.gadget.setDashboardParams(params)},getTitle:function(){return this.article&&this.getArticleText("$title",this.gadget.data("$title"))},_loadRepresentation:function(){this._addPicker({title:this.getTitle(),icon:this._getCssIcon("s-m-sage-gadget-icon")})},_loadDashboard:function(){this._addPicker({title:this.getTitle(),icon:this._getCssIcon("s-m-sage-gadget-icon")})},_loadApplication:function(){this._addPicker({title:this.getTitle(),icon:this._getCssIcon("s-m-sage-app-icon")})},_loadExternal:function(){var url=this.gadget.getExternalUrl();this._addPicker({title:this.getTitle()})},_addPicker:function(context){var vignetteCtx={};for(var p in context)vignetteCtx[p]=context[p];$(_getHtml("linkPage",vignetteCtx)).appendTo(this.$$elmt)},_getCssIcon:function(sageBaseCss){var icon=this.article&&this.article.$icon||this.gadget.data("icon");return icon&&(icon.smStartsWith("s-m-")?icon=sageBaseCss+" "+icon:icon=fontUtils.getIconByName(icon)),icon||""},_actTouch:function(){var link=this.gadget&&this.gadget.getLink();if(link)if(this.gadget.getType()=="$external")window.open(link.$url,"s-m-external-window");else{var opts={$mockArticle:this.article.$mockArticle};this.controller.openLink(link,opts)}}})}),define("syracuse-tablet/html/js/controls/fields/ctrlImage",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/native/native"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,locale=require("syracuse-tablet/html/js/helpers/locale"),utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),native=require("syracuse-tablet/html/js/helpers/native/native"),_IMG_TYPE="$SelectedImageType",_scaleMap={small:{width:640,height:480},medium:{width:1024,height:768},large:{width:1920,height:1440}},_templates={layout:' 		<div class="s-m-img-layout">			<section>				<a class="img-responsive s-m-field-img" data-nevent-ctrl-click="" href="#" draggable="false">				</a>			</section>			{{#if actions}}			<footer> 				{{#each actions}}					{{#if active}}						<a class="s-m-meta" 							href = "#"							draggable="false"								data-nevent=""								data-naction="{{id}}"								{{#if display}}									style="display:{{display}}">								{{/if}}							<span 							{{#if css}}								class="{{css}}"							{{/if}}							>							{{#if text}}								{{text}}							{{/if}}							</span>						</a>					{{/if}}				{{/each}}			</footer>			{{/if}}		</div>',layoutDispay:'			<a class="img-responsive s-m-field-img" href="#" draggable="false">			</a>',image:'		{{#if empty}}			<span class="{{css}}"></span>		{{else}}			<img class="img-responsive" src="{{url}}" draggable=false>		{{/if}}		',inputFile:' 		<input			type="file"			accept="image/*"			class="ctrl-evt-change"			data-nevent-ctrl-change=""		>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.CtrlImage=utils.defineClass(function CtrlImage(controller,article,prototype,options){options=options||{},options.nativeCapabilities={penAnnotatedImage:!0,penSignatureImage:!0,camera:!0},Base.call(this,controller,article,prototype,options)},Base,{buildHtml:function(classes){classes=classes||[],classes.push("s-m-img"),Base.prototype.buildHtml.call(this,classes)},buildFieldValue:function(){this._ensure$$value(),this._clear$$value();var imgUrl=this.getValue(),empty=imgUrl==null||imgUrl.length===0;this.$isEditMode?this.buildEditValue(imgUrl,empty):this.buildDisplayValue(imgUrl,empty);var imagetype=this.controller.dataset.getProperty(this.$bind,_IMG_TYPE);!empty&&imagetype&&this._setImage(imagetype+this.controller.dataset.getJsonValue(this.$bind))},buildDisplayValue:function(url){var layout=$(_getHtml("layoutDispay",{})).appendTo(this.$$value);this._newImg(layout,url)},buildEditValue:function(url){var layout=$(_getHtml("layout",{actions:this._imageActions(url===null)})).appendTo(this.$$value);this.img=this._newImg($("a.img-responsive",layout),url),$(_getHtml("inputFile",{})).appendTo(this.$$value)},setDataTypeValue:function(value,type){Base.prototype.setValue.call(this,value),type&&this.controller.dataset.setProperty(this.$bind,_IMG_TYPE,type)},_imageActions:function(empty){var actions=[{id:"$select",active:this._isBtnActive("$select"),css:"s-m-select",text:locale.text("image.label.selectimage")},{id:"$edit",active:this._isBtnActive("$edit"),css:"s-m-edit "+fontUtils.getIconByName("$image-ink")},{id:"$sign",active:this._isBtnActive("$sign"),css:"s-m-sign "+fontUtils.getIconByName("$image-sign")},{id:"$camera",active:this._isBtnActive("$camera"),css:"s-m-camera "+fontUtils.getIconByName("$image-camera")},{id:"$delete",active:this._isBtnActive("$delete"),css:"s-m-delete "+fontUtils.getIconByName("$delete"),display:empty?"none":null}];return actions},_isBtnActive:function(btnId){var isSignature=this.article.$isSignature?!0:!1,isActive=!1;switch(btnId){case"$select":isActive=!isSignature;break;case"$edit":isActive=!isSignature&&this.isNativeCapabilityEnabled("penAnnotatedImage");break;case"$camera":isActive=!isSignature&&this.isNativeCapabilityEnabled("camera");break;case"$sign":isActive=isSignature&&this.isNativeCapabilityEnabled("penSignatureImage");break;case"$delete":isActive=!0;break;default:isActive=!1}return isActive},applyMetaData:function(metaData){Base.prototype.applyMetaData.call(this,metaData)},onDataActionClicked:function(dataAction,dataParams,event){switch(dataAction){case"$select":this._onUploadClick();break;case"$delete":this._onClearClick();break;case"$edit":this._onEditClick();break;case"$camera":this._onCameraClick();break;case"$sign":this._onSignClick();break;default:return!1}},onClick:function(event){},_onUploadClick:function(){var $$inputDom=this.$$elmt.find(".s-m-value > input");try{$$inputDom.trigger("click")}catch(e){jQuery.event.triggered=undefined}},_onClearClick:function(){this._setImage(null),this.setValue("");var element=this.$$elmt.find(".s-m-value > input");element.replaceWith(element=element.clone(!0));var clearBtn=this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$delete']")[0];$(clearBtn).toggle();if(this._isBtnActive("$edit")){var editBtn=this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$edit']")[0];$(editBtn).toggle()}},onChange:function(evt){var self=this;if(evt.target.nodeName.toLowerCase()==="input"){var files=evt.target.files,res={};if(files&&files.length){var f=files[0];if(!f.type.match("image.*"))return;res.$contentType=f.type,res.$fileName=f.name,res.$type="image";var reader=new FileReader;reader.onload=function(theFile,content){return function(e){self._checkScale(e.target.result).then(function(src){var dataType=self._getImageDataTypeValue(src);if(dataType==null)return;self.setDataTypeValue(dataType.data,dataType.type),self.setFocus(),self._setImage(src)})}}(f,res),reader.readAsDataURL(f)}}},_checkScale:function(src){if(!src)return $.smResolve(src);var self=this,scaler=native.getModule("imageScale");if(!scaler)return $.smResolve(src);var opts=self._getResizeOptions();return opts?(opts.imageData=src,scaler.getScaledImage(opts).then(function(result){return result.action==="ok"?result.imageData:result.action==="nochange"?src:src})):$.smResolve(src)},_getResizeOptions:function(){var scale=_scaleMap[this.getAuthoring("$imgScale")||"medium"];return scale==null?null:{width:scale.width,height:scale.height,mode:"LIMIT_MAX_WIDTH_AND_HEIGHT"}},_getImageDataValue:function(content){var i=content.indexOf("base64,");return i>0?content.substring(i+7):content.result},_getImageDataTypeValue:function(data){if(!data)return null;var i=data.indexOf("base64,");return i>0?{data:data.substring(i+7),type:data.substr(0,i+7)}:null},_setImage:function(src){var core=this.$$elmt.find(".s-m-img-layout > section > a")[0];uiUtils.empty(core),this.img=this._newImg(core,src),this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$delete']").toggle(!0),this._isBtnActive("$edit")&&this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$edit']").toggle(!0)},_newImg:function(parent,src){var empty=src===null,css=empty?this._getDefaultIcon()+" s-m-empty img-responsive":"s-m-image",img=$(_getHtml("image",{empty:empty,css:css,url:src})).appendTo(parent);return this._setImgHeight(img)},_defaultImg:function(parent,css){return this._setImgHeight(uiUtils.createDomElement("span",this._getDefaultIcon()+(" "+(css||"")),null,null,parent))},_setImgHeight:function($i){return $i.height(uiUtils.imgHeight2px(this.getAuthoring("$imgHeight")||"small")).get(0)},_getDefaultIcon:function(){var css="s-m-icon-"+(this.article.$emptyIconSize||"small")+" ";return css+(this.article.$emptyImageIcon||fontUtils.getEmptyImageDefIcon()).css},_getBinaryContent:function(){var binary;if(this.img){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");ctx.canvas.width=this.img.naturalWidth,ctx.canvas.height=this.img.naturalHeight,ctx.drawImage(this.img,0,0,this.img.naturalWidth,this.img.naturalHeight),binary=canvas.toDataURL()}return binary},_onEditClick:function(){var self=this,editBtn=this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$edit']")[0],data;try{data=self._getBinaryContent()}catch(e){$(editBtn).hide();return}$(editBtn).toggle(),native.getModule("penAnnotatedImage").getAnnotatedImage({title:self.getTitle(),imageData:data}).then(function(data){data&&data.action==="ok"?data.imageData&&data.imageData.length&&(self.setValue(self._getImageDataValue(data.imageData)),self._setImage(data.imageData)):$(editBtn).toggle()})},_onSignClick:function(){var self=this,signBtn=this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$sign']")[0];$(signBtn).toggle(),native.getModule("penAnnotatedImage").getSignatureImage({title:self.getTitle(),watermark:""}).then(function(data){data&&data.action==="ok"&&data.imageData&&data.imageData.length&&(self.setValue(self._getImageDataValue(data.imageData)),self._setImage(data.imageData)),$(signBtn).toggle()})},_onCameraClick:function(){var self=this,signBtn=this.$$elmt.find(".s-m-img-layout > footer > a[data-naction='$camera']")[0];$(signBtn).toggle(),native.getModule("camera").getPictureFromCamera({resizeOptions:self._getResizeOptions()}).then(function(data){return data&&data.action==="ok"&&data.imageData&&data.imageData.length>0?self._checkScale(data.imageData):null}).then(function(imageData){imageData&&(self.setValue(self._getImageDataValue(imageData)),self._setImage(imageData))}).always(function(){$(signBtn).toggle()})}})}),define("syracuse-tablet/html/js/controls/chart/gaugeChartstheme",["require","exports","module"],function(require,exports,module){exports.ChartsTheme={colors:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/3.0.2/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/3.0.2/gfx/vml-radial-gradient.png"},chart:{borderColor:"#4572A7",borderRadius:5,defaultSeriesType:"line",ignoreHiddenSeries:!0,spacingTop:10,spacingRight:10,spacingBottom:15,spacingLeft:10,style:{fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:"12px"},backgroundColor:"#FFFFFF",plotBorderColor:"#C0C0C0",resetZoomButton:{theme:{zIndex:20},position:{align:"right",x:-10,y:10}}},title:{text:"Chart title",align:"center",y:15,style:{color:"#666",fontSize:"16px"}},subtitle:{text:"",align:"center",y:30,style:{color:"#4d759e"}},plotOptions:{line:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom"},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0},area:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom"},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,threshold:0},spline:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom"},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0},areaspline:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom"},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,threshold:0},column:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:null,x:0,y:null,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null},cropThreshold:50,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:.1,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!1,borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:0},bar:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:null,x:0,y:null,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null},cropThreshold:50,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:.1,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!1,borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:0},scatter:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:0,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom"},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!1,tooltip:{headerFormat:'<span style="font-size: 10px; color:{series.color}">{series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>",followPointer:!0}},pie:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:null,point:{events:{}},dataLabels:{enabled:!0,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:"bottom",distance:30},cropThreshold:300,pointRange:0,showInLegend:!1,states:{hover:{marker:{},brightness:.1,shadow:!1},select:{marker:{}}},stickyTracking:!1,borderColor:"#FFFFFF",borderWidth:1,center:[null,null],clip:!1,colorByPoint:!0,ignoreHiddenPoint:!0,legendType:"point",size:null,slicedOffset:10,tooltip:{followPointer:!0}},arearange:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0},areasplinerange:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0},columnrange:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null,xLow:0,xHigh:0,yLow:0,yHigh:0},cropThreshold:300,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:.1,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!0,borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:null,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},trackByArea:!0},gauge:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:2,marker:{enabled:!0,lineWidth:0,radius:4,lineColor:"#FFFFFF",states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!0,align:"center",x:0,y:5,style:{color:"#666",cursor:"default",fontSize:"16px",lineHeight:"24px",fontWeight:"normal"},verticalAlign:"top",borderWidth:0,borderColor:null,borderRadius:3,zIndex:2},cropThreshold:300,pointRange:0,showInLegend:!1,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!0,dial:{},pivot:{},tooltip:{style:{color:"#666"},headerFormat:""}},boxplot:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:null,x:0,y:null,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null},cropThreshold:50,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:-0.3,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!1,borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:null,fillColor:"#FFFFFF",medianWidth:2,tooltip:{pointFormat:'<span style="color:{series.color};font-weight:bold">{series.name}</span><br/>Minimum: {point.low}<br/>Lower quartile: {point.q1}<br/>Median: {point.median}<br/>Higher quartile: {point.q3}<br/>Maximum: {point.high}<br/>'},whiskerLength:"50%",whiskerWidth:2},errorbar:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:null,x:0,y:null,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null},cropThreshold:50,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:-0.3,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!1,borderColor:"#FFFFFF",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:null,fillColor:"#FFFFFF",medianWidth:2,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.low}</b> - <b>{point.high}</b><br/>'},whiskerLength:"50%",whiskerWidth:null,color:"#000000",grouping:!1,linkedTo:":previous"},waterfall:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:1,marker:null,point:{events:{}},dataLabels:{enabled:!1,align:null,x:0,y:null,style:{color:"#666",cursor:"default",fontSize:"11px",lineHeight:"14px"},verticalAlign:null},cropThreshold:50,pointRange:null,showInLegend:!0,states:{hover:{marker:{},brightness:.1,shadow:!1},select:{marker:{},color:"#C0C0C0",borderColor:"#000000",shadow:!1}},stickyTracking:!1,borderColor:"#333",borderWidth:1,borderRadius:0,groupPadding:.2,pointPadding:.1,minPointLength:0,threshold:0,lineColor:"#333",dashStyle:"dot"},bubble:{allowPointSelect:!1,showCheckbox:!1,animation:{duration:1e3},events:{},lineWidth:0,marker:{enabled:!0,lineWidth:1,radius:4,lineColor:null,states:{hover:{enabled:!0},select:{fillColor:"#FFFFFF",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{enabled:!1,align:"center",x:0,y:0,style:{color:"white",cursor:"default",fontSize:"11px",lineHeight:"14px",textShadow:"0px 0px 3px black"},verticalAlign:"middle",inside:!0},cropThreshold:300,pointRange:0,showInLegend:!0,states:{hover:{marker:{}},select:{marker:{}}},stickyTracking:!1,tooltip:{headerFormat:'<span style="font-size: 10px; color:{series.color}">{series.name}</span><br/>',pointFormat:"({point.x}, {point.y}), Size: {point.z}",followPointer:!0},minSize:8,maxSize:"20%",zThreshold:0}},labels:{style:{position:"absolute",color:"#3E576F"}},legend:{enabled:!0,align:"center",layout:"horizontal",borderWidth:1,borderColor:"#909090",borderRadius:5,navigation:{activeColor:"#274b6d",inactiveColor:"#CCC"},shadow:!1,itemStyle:{cursor:"pointer",color:"#274b6d",fontSize:"12px"},itemHoverStyle:{color:"#000"},itemHiddenStyle:{color:"#CCC"},itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},symbolWidth:16,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"1em"},style:{position:"absolute",backgroundColor:"white",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:!0,backgroundColor:"rgba(255, 255, 255, .85)",borderWidth:1,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',shadow:!0,snap:10,style:{color:"#333333",cursor:"default",fontSize:"12px",padding:"8px",whiteSpace:"nowrap"}},credits:{enabled:!1,text:"Highcharts.com",href:"http://www.highcharts.com",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#909090",fontSize:"9px"}}}}),define("syracuse-tablet/html/js/controls/fields/ctrlGaugeChart",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/chart/gaugeChartstheme","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils"),chartsTheme=require("syracuse-tablet/html/js/controls/chart/gaugeChartstheme").ChartsTheme,locale=require("syracuse-tablet/html/js/helpers/locale");exports.CtrlGaugeChart=utils.defineClass(function CtrlGaugeChart(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{destroy:function(){Base.prototype.destroy.call(this);var $$chartSlot=$(".s-m-gauge-container",this.$$elmt);$$chartSlot&&$$chartSlot.length>0&&$$chartSlot.remove()},buildFieldTitle:function(fieldSlot,buildOptions){},_defaultGaugeSegments:[{propStart:0,propEnd:.25,valStart:null,valEnd:null,color:"#41A940"},{propStart:.25,propEnd:.75,valStart:null,valEnd:null,color:"#FF5800"},{propStart:.75,propEnd:1,valStart:null,valEnd:null,color:"#CB3500"}],buildHtml:function(classes){classes=classes||[],classes.push("s-m-gauge"),Base.prototype.buildHtml.call(this,classes)},buildFieldValue:function(){var localeDecimalSep=locale.getNumberDecimalSeparator(),localeThousandSep=locale.getNumberGroupSeparator();this._ensure$$value(),this._clear$$value(),this.chartsTheme||(this.chartsTheme=chartsTheme);if(!this.chartsTheme.themeWasSet||this.chartsTheme.decimalPoint!==localeDecimalSep||this.chartsTheme.thousandsSep!==localeThousandSep)this.chartsTheme.decimalPoint=localeDecimalSep,this.chartsTheme.thousandsSep=localeThousandSep,Highcharts.setOptions(this.chartsTheme),this.chartsTheme.themeWasSet=!0},computeLayout:function(context){this._renderGauge()},_renderGauge:function(){var $$chartSlot=$(".s-m-gauge-container",this.$$value);$$chartSlot&&$$chartSlot.length>0&&$$chartSlot.remove(),$$chartSlot=$("<div>").addClass("s-m-gauge-container"),this.$$value.append($$chartSlot);var gauge=this.article.$gauge,labelColor=this.$isEditMode?"#666":"#34B233",val=this.getValue(),valMin=0,valMax=100;gauge.$bindMin!=null&&gauge.$bindMax!=null&&(isNaN(gauge.$bindMin)?valMin=this.controller.getValue(gauge.$bindMin):valMin=gauge.$bindMin,isNaN(gauge.$bindMax)?valMax=this.controller.getValue(gauge.$bindMax):valMax=gauge.$bindMax);try{typeof val=="string"&&(val=parseFloat(val))}catch(e){}try{typeof valMin=="string"&&(valMin=parseFloat(valMin))}catch(e){}try{typeof valMax=="string"&&(valMax=parseFloat(valMax))}catch(e){}var cp=this.prototype.json,uom="";cp.$unit&&cp.$properties&&cp.$properties[cp.$unit]&&val&&val[cp.$unit]&&val[cp.$unit].$symbol&&(uom=val[cp.$unit].$symbol);var label=this.getTitle(),decimals=this._getScale(),plotBands=this._createBands(cp,valMin,valMax);this._calcDesiredHeight();var spacingBottom=35,height=this.desiredHeight,centerA="50%",centerB=(height-20)/height*100+"%",size=height-30;$$chartSlot.highcharts({chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,backgroundColor:null,height:height,borderWidth:0,spacingBottom:spacingBottom},title:{text:label,style:{color:labelColor,fontWeight:"normal",textTransform:"uppercase"},verticalAlign:"bottom",y:27},pane:{startAngle:-90,endAngle:90,center:[centerA,centerB],size:size,background:[{backgroundColor:"#FFF",borderWidth:0}]},yAxis:{min:valMin,max:valMax,minorTickWidth:1,minorTickInterval:"auto",minorTickLength:20,minorTickPosition:"inside",minorTickColor:"#fff",tickPixelInterval:30,tickWidth:0,tickPosition:"inside",tickLength:15,tickColor:"#FFF",labels:{step:1,rotation:"auto",style:{color:"#666",cursor:"default",fontSize:"0.9em",fontFamily:"Arial",lineHeight:"14px"},distance:10,y:0,verticalAlign:"center",align:"center"},title:{text:uom,style:{color:"#666"}},plotBands:plotBands},plotOptions:{gauge:{dataLabels:{enabled:!0,format:"{point.y:,."+decimals+"f}",style:{fontFamily:"Arial"}}}},exporting:{buttons:null},series:[{name:label,data:[val],tooltip:{valueSuffix:" "+uom}}]},function(){})},_getScale:function(){function getScaleFromFormat($format){var match=$format.match(/\.(.*)/g);return match.length>=1?match.length:0}return this.article.$scale?this.article.$scale:this.article.$format?getScaleFromFormat(this.article.$format):0},_createBands:function(cp,valMin,valMax){var bands=[];bands.push({from:valMin,to:valMax,color:"#ccc",innerRadius:"79%",outerRadius:"101%"});var data=this.getValue(),bandsDef=this._mergeAuthoringAndDefaults(),seg,s,band,range=valMax-valMin;for(s=0;s<bandsDef.length;s++)seg=bandsDef[s],band={innerRadius:"79%",outerRadius:"101%",color:seg.color},seg.valStart!=null&&seg.valEnd!=null?(band.from=this._resolveExpr(seg.valStart,data,cp),band.to=this._resolveExpr(seg.valEnd,data,cp)):seg.propStart!=null&&seg.propEnd!=null&&(band.from=valMin+range*this._resolveExpr(seg.propStart,data,cp),band.to=valMin+range*this._resolveExpr(seg.propEnd,data,cp)),bands.push(band);return bands},_mergeAuthoringAndDefaults:function(){var $gauge=this.article.$gauge;if(!$gauge.segments)return this._defaultGaugeSegments;if($gauge.segments.length===0)return this._defaultGaugeSegments;var s,def,auth,res=[];for(s=0;s<$gauge.segments.length;s++)def=this._defaultGaugeSegments[Math.min(s,this._defaultGaugeSegments.length-1)],auth=$gauge.segments[s],auth?((auth.propStart==null||auth.propEnd==null)&&(auth.valStart==null||auth.valEnd==null)&&(auth.propStart=def.propStart,auth.propEnd=def.propEnd,auth.valStart=def.valStart,auth.valEnd=def.valEnd),auth.color==null&&(auth.color=def.color),res.push(auth)):res.push(def);return res},_resolveExpr:function(expr,data,cp){return typeof expr!="string"?expr:expr.replace(/\{(\w+)\}/g,function(d0,d1){return data[d1]!=null?data[d1]:cp[d1]!=null?cp[d1]:d0})},_calcDesiredHeight:function(){var $$pscroll=this.$$elmt.closest(".s-m-scroll-wrapper"),isSingleChild=$(".s-m-control",$$pscroll).length<2,isInTile=$$pscroll.closest(".s-m-tile").length>0;if(isInTile&&isSingleChild){var $$tile=$$pscroll.parent();this.desiredHeight=$$tile.height()-20}else this.desiredHeight=200}})}),define("syracuse-tablet/html/js/controls/fields/ctrlFilter",["require","exports","module","syracuse-tablet/html/js/controls/fields/ctrlFieldBase","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/fields/ctrlFieldBase").CtrlFieldBase,utils=require("syracuse-tablet/html/js/helpers/utils");exports.CtrlFilter=utils.defineClass(function CtrlFilter(controller,article,prototype,options){options=options||{},options.nativeCapabilities=null,Base.call(this,controller,article,prototype,options)},Base,{buildFieldValue:function(){this._ensure$$value(),this._clear$$value(),this.appendTextValue(this.getValue()||"")}})}),define("syracuse-tablet/html/js/controls/layouts/layoutBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/ctrlBase","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils");exports.LayoutBase=utils.defineClass(function LayoutBase(controller,type,article,opts){Base.call(this,controller,type,article,opts),this.title=article.$title},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(){this.createRootElement(["s-m-layout","s-m-ctrl"]),this.article.$title&&this.options.noTitle!==!0&&this.buildTitle(),this.article.$icon&&this.options.noIcon!==!0&&this.buildIcon()},_ensureHeader:function($$root){return this.$$header||(this.$$header=$("<header>").prependTo($$root||this.$$elmt)),this.$$header},buildIcon:function($$rootLyt,$$parent,controllerDao,destroyAfter){this._ensureHeader();var icon=fontUtils.getIconByName(this.article.$icon);icon&&this.$$header.addClass("s-m-has-ttl-icon").prepend('<i class="s-m-ttl-icon '+icon+'">')},buildTitle:function(){this._ensureHeader(),this.$$header.find("span.title").remove(),this.$$header.prepend('<span class="title">'+this.getArticleText("$title")+"</span>")},getChild$$Container:function(){throw new Error("Subclass must give container for children")},buildChildrenHtml:function(){var self=this;this.isEmpty=!0;if(this.children){var $$childContainer=self.getChild$$Container();$.each(self.children,function(index,child){child.set$$container($$childContainer),child.buildHtml(),self.isEmpty=self.isEmpty&&child.isEmpty})}this.options.hideEmptyRows===!0&&this.$$elmt.toggleClass("s-m-empty",this.isEmpty)},createId:function(typeName){return utils.readableuid(typeName)},getUnitTestId:function(){if(this.options.index==null)return;return utils.unitTestId(this.typeName.toLowerCase(),this.options.index)},computeLayout:function(context){if(!this.children)return;this.children.forEach(function(child){child.computeLayout&&child.computeLayout(context)})},getGestureMgr:function(){return null},isLayout:function(){return!0}})}),define("syracuse-tablet/html/js/controls/layouts/layoutStack",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),globals=require("syracuse-tablet/html/js/app/globals"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils");exports.LayoutStack=utils.defineClass(function LayoutStack(controller,type,article,opts){var self=this;Base.call(self,controller,type,article,opts)},Base,{destroy:function(){Base.prototype.destroy.call(this),this.$$btnCollapse&&(this.$$btnCollapse.off(),this.$$btnCollapse=null)},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self),self.$$elmt.addClass("s-m-stack"),this.options.makeFullHeight===!0&&self.$$elmt.height("100%");var css=[],level=this.$$container.parents(".s-m-stack").length;if(level){var $theme=self.article&&self.article.$theme||String.fromCharCode(96+Math.min(level,3));css.push("s-m-theme-"+$theme)}self.$$elmt.attr("data-level",level),this.isAdvanced=$theme==="advanced";var $collapsible=self.article&&self.article.$collapsible||"notcollapsible",$title=self.options.$stackbar&&level===1?"":(this.getArticleText("$title")||"").trim();$collapsible!=="notcollapsible"&&css.push("s-m-collapsible"),$title.length&&css.push("s-m-title"),css.length&&self.$$elmt.addClass(css.join(" ")),($collapsible!=="notcollapsible"||$title.length>0)&&self._addHeader($collapsible,$title),self.$$content=$("<content>"),self._setStackColorClass(),self.$$elmt.append(self.$$content),self.buildChildrenHtml(),self._updateCollapseState()},_setStackColorClass:function(){var self=this,color=self.article.$bgColor;color&&self.$$content.addClass("s-m-bg s-m-color-"+color)},buildTitle:function(){},_addHeader:function(state,title){var self=this;self.$$header=$("<header>"),state!=="notcollapsible"&&(self.$$btnCollapse=$('<btn class="'+state+" "+fontUtils.layoutExpandCollapseIcon(state==="collapsed",this.isAdvanced)+'">').appendTo(self.$$header),self.$$header.on("click",jsutils.bindFn(this._actCollapse,this)));var $$title=$('<div class="s-m-title">');$$title.append(title),self.$$elmt.append(self.$$header),self.$$header.append($$title)},getChild$$Container:function(){return this.$$content},_actCollapse:function(events,setCollapse){events&&!globals.isAuthoringActive()&&events.stopPropagation();if(!this.$$btnCollapse)return;setCollapse===!0?this.$$btnCollapse.removeClass("expanded "+fontUtils.layoutExpandCollapseIcon(setCollapse,this.isAdvanced)).addClass("collapsed "+fontUtils.layoutExpandCollapseIcon(!setCollapse,this.isAdvanced)):setCollapse===!1?this.$$btnCollapse.removeClass("collapsed "+fontUtils.layoutExpandCollapseIcon(!setCollapse,this.isAdvanced)).addClass("expanded "+fontUtils.layoutExpandCollapseIcon(setCollapse,this.isAdvanced)):this.$$btnCollapse.toggleClass("collapsed "+fontUtils.layoutExpandCollapseIcon(setCollapse,this.isAdvanced)).toggleClass("expanded "+fontUtils.layoutExpandCollapseIcon(!setCollapse,this.isAdvanced)),this._updateCollapseState(),this.$$btnCollapse.hasClass("collapsed")||notifications.publish("sm.layout.expanded"),this.page.notifyScrollerUpdate()},_updateCollapseState:function(){var self=this;if(!self.$$btnCollapse||!self.$$content)return;var collapse=self.$$btnCollapse.hasClass("expanded");self.$$content.toggle(collapse)},getAuthState:function(dirtyKeys){var self=this;return dirtyKeys.$collapsible?null:{collapsed:self.$$btnCollapse?self.$$btnCollapse.hasClass("collapsed"):!1}},setAuthState:function(state){state&&state.collapsed!=null&&this._actCollapse(null,state.collapsed)},hide:function(){this.$$elmt.hide()},show:function(){this.$$elmt.show()}})}),define("syracuse-tablet/html/js/controls/layouts/layoutRow",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/app/globals"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),globals=require("syracuse-tablet/html/js/app/globals");exports.LayoutRow=utils.defineClass(function LayoutRow(controller,type,article,opts){var self=this;Base.call(self,controller,type,article,opts)},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$elmt.addClass("s-m-row row"),this._setRowColorClass(),this.buildChildrenHtml(),this.$$elmt.is(":empty")&&!globals.isAuthoringActive()&&this.$$elmt.hide()},_setRowColorClass:function(){var self=this,color=self.article.$bgColor;color&&self.$$elmt.addClass("s-m-bg s-m-color-"+color)},getChild$$Container:function(){return this.$$elmt}})}),define("syracuse-tablet/html/js/controls/layouts/layoutCell",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/ui/uiSettings"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),_sizes=[{$prop:"$widthXs",$prefix:"col-xs-",$def:12},{$prop:"$widthSm",$prefix:"col-sm-",$def:6},{$prop:"$widthMd",$prefix:"col-md-",$def:4},{$prop:"$widthLg",$prefix:"col-lg-",$def:3}];exports.LayoutCell=utils.defineClass(function LayoutCell(controller,type,article,opts){Base.call(this,controller,type,article,opts),article.$bgColor==null&&(article.$bgColor=uiSettings.getProp("colors.CELLDEFCOLOR")),article.$bgColor=article.$bgColor.toLowerCase()},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$elmt.addClass("s-m-cell"),this.$$cell=$(uiUtils.createDomElement("div",["cell"],null,null,this.$$elmt)),this._setCellColorClass(),this._setCellSizeClasses(),this.buildChildrenHtml()},getChild$$Container:function(){return this.$$cell},_setCellColorClass:function(){var bg=this.article.$bgColor;if(bg==="transparent"||bg.length===0)return;this.$$cell.addClass("s-m-bg s-m-color-"+bg)},_setCellSizeClasses:function(){var self=this;if(self.article.$sameSize!==!0){var widthFound=!1,sizes=[],sz;_sizes.forEach(function(size){sz=self.article[size.$prop],sz!=null&&sz>=1&&sz<=12&&sizes.push(size.$prefix+sz)}),sizes.length==0&&(self.article.$sameSize=!0,self.article.$widthAll=12)}self.article.$sameSize===!0&&(self.article.$widthAll==null&&(self.article.$widthAll=12),sizes=["col-xs-"+Math.min(12,Math.max(1,self.article.$widthAll),self.article.$widthAll)]),self.$$elmt.addClass(sizes.join(" "))},_ensureHeader:function(){return Base.prototype._ensureHeader.call(this,this.$$cell)},notifSpecialArrayHosted:function(typeArray){if(!this.$$cell)return;typeArray==="chart"?(this.$$cell.removeClass("s-m-bg s-m-color-"+this.article.$bgColor),this.$$elmt.addClass("s-m-chart")):typeArray==="carousel"&&this.$$elmt.addClass("s-m-carousel")}})}),define("syracuse-tablet/html/js/controls/layouts/layoutHub",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),uiRect=require("syracuse-tablet/html/js/ui/rect"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers");exports.LayoutHub=utils.defineClass(function LayoutHub(controller,type,article,opts){var self=this;Base.call(self,controller,type,article,opts),this._gestureMgr=null,this._tilesGroupSpacing=uiSettings.getProp("hubLayout.groupSpacing"),this._minLandscapeHeigth=uiSettings.getProp("hubLayout.landscapeMinHeigth")},Base,{destroy:function(){Base.prototype.destroy.call(this),this._gestureMgr&&(this._gestureMgr.destroy(),this._gestureMgr=null)},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self),self.$$elmt.addClass("s-m-hub"),self.$$scrollElmt=$('<div class="s-m-scroll-elmt">').appendTo(self.$$elmt),self.buildChildrenHtml(),self._gestureMgr&&self._gestureMgr.destroy(),self._gestureMgr=scroller.newScroller(self.$$scrollElmt,{isPageScroller:!0})},getChild$$Container:function(){return this.$$scrollElmt},computeLayout:function(context){var self=this,parentRect=context.pageContentNoPaddingRect,pos=self.$$elmt.position(),w=parentRect.width,h=parentRect.height-pos.top,rel=w/h,posX=0,posY=0,opts;self.scrollDirection=rel>1.2&&h>=this._minLandscapeHeigth?"h":"v",self.scrollDirection==="h"?self.$$elmt.css({width:"100%",height:h+"px"}):self.$$elmt.css({width:w+"px",height:"100%"});if(self.children){var last=self.children.length-1;self.children.forEach(function(child,idx){opts={posX:posX,posY:posY,maxHeight:h,maxWidth:w,scrollDirection:self.scrollDirection,allowSmallTiles:rel>1.2},child.computeLayout(context,opts),self.scrollDirection==="h"?posX+=child.getWidth()+(idx<last?self._tilesGroupSpacing:0):posY+=child.getHeight()+(idx<last?self._tilesGroupSpacing:0)})}var width,height;self.scrollDirection==="h"?(width=posX,height=h):(width=w,height=posY);var oldScroll=null;context&&context.preserveScroll===!0&&(oldScroll=self._gestureMgr.getScroll()),self._gestureMgr.reset(),self.$$scrollElmt.width(width),self.$$scrollElmt.height(height);var scrollRect=uiRect.elmtRect(self.$$scrollElmt,"outer"),viewRect=parentRect.intersectRect(scrollRect);viewRect!=null&&!viewRect.contains(scrollRect)?viewRect:null;if(!viewRect)return;self._gestureMgr.init(viewRect,self.scrollDirection,0),oldScroll!=null&&self._gestureMgr.autoScroll(oldScroll)},getGestureMgr:function(){return this._gestureMgr},savedCtxCreate:function(opts){return this._gestureMgr?{hubScroll:this._gestureMgr.savedCtxCreate(opts)}:null},savedCtxRestore:function(ctx){ctx!=null&&this._gestureMgr&&this._gestureMgr.savedCtxRestore(ctx.hubScroll)}})}),define("syracuse-tablet/html/js/controls/layouts/layoutHubGroup",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/app/globals","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),globals=require("syracuse-tablet/html/js/app/globals"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),locale=require("syracuse-tablet/html/js/helpers/locale"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),modules=require("syracuse-tablet/html/js/common/modules"),_validSizes=["small","medium","wide","large","full","all"];exports.LayoutHubGroup=utils.defineClass(function LayoutHubGroup(controller,type,article,opts){var self=this;Base.call(self,controller,type,article,opts),self._settings=uiSettings.getProp("hubGroup"),self.isEditable=self._getCapability("edit"),self.isDeletable=self._getCapability("delete"),self.isDraggable=self._getCapability("draggable")},Base,{buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self),self.$$elmt.addClass("s-m-hub-group"),self.$$separator=$(uiUtils.createDomElement("div",null,null,null,self.$$elmt)),self.$$separator.addClass("s-m-hub-group-separator"),self._buildCellStructure()},buildTitle:function(){var self=this;self.options.groupActions==null?Base.prototype.buildTitle.call(self):self.buildTitleActions()},buildTitleActions:function(){var self=this;this._ensureHeader(),this.$$input=$("<input data-nevent-ctrl-change>"),this.$$input.val(this.getArticleText("$title")),this.$$header.append(this.$$input),this.$$header.addClass("edit");var $$actions=$('<div class="s-m-group-actions">');this.$$header.append($$actions),self.options.groupActions.forEach(function(action){var actionAttrs=action.disabled===!0?"":'" data-nevent data-naction="'+action.action+'" data-params="'+self.id+'"',className=action.className+(action.disabled===!0?" disabled":""),$$btn=$('<btn class="cfg '+action.icon+" "+className+'" '+actionAttrs+"></btn>");$$actions.append($$btn)})},onChange:function(){var title=this.$$input.val();if(this.getArticleText("$title")!==title){var uuid=this.getArticleTextUUID("$title")||utils.UUID();this.article.$title="{@"+uuid+"}",this.page&&this.page.onGroupTitleChanged&&this.page.onGroupTitleChanged(this,uuid,title)}},_buildCellStructure:function(){var self=this;self.cells=[];var cell=null,notLinksCpt=0,index=0;self.children?self.children.forEach(function(layout){(layout.isLinkVignette==null||layout.isLinkVignette()!==!0)&&notLinksCpt++;var size=layout.article&&layout.article.$size||"medium";_validSizes.indexOf(size)<0&&(size=_validSizes[1],layout.article=layout.article||{},layout.article.$size=size),cell||(cell=self._createCell(size),cell.domItem=uiUtils.createDomElement("div",null,null,null,self.$$elmt),self.cells.push(cell)),size==="small"?(layout.set$$container($(cell.domItem)),layout.buildHtml(),cell.children.push(layout),cell.children.length===4&&(cell=null)):(cell.children.length>0&&(cell=self._createCell(size),cell.domItem=uiUtils.createDomElement("div",null,null,null,self.$$elmt),self.cells.push(cell)),layout.set$$container($(cell.domItem)),layout.buildHtml(),cell.children.push(layout),cell=null),index++}):self.$$elmt.addClass("empty");if(self.options.showAddTiles){var cell=self._createCell("medium"),opts={icon:fontUtils.dashboardIcon("addHiddenTile"),title:locale.text("welcome.dashboard.add.hiddenTile"),action:"addHiddenTile",css:"s-m-tile-action s-m-color-tile-action medium",params:self.id};self._addActionTile(cell,opts),self.cells.push(cell)}self._linksOnly=notLinksCpt===0},_addActionTile:function(cell,opts){var self=this,optsAction={"data-nevent":"","data-naction":opts.action,"data-params":opts.params};cell.domItem=uiUtils.createDomElement("div",null,null,optsAction,self.$$elmt);var addTile=uiUtils.createDomElement("div",opts.css,null,null,cell.domItem);$(addTile).append('<section class="s-m-icon"><div><div class="s-m-sage-app-icon '+opts.icon+'"></div></div></section>'),$(addTile).append('<section class="s-m-title"><div>'+opts.title+"</div></section>")},_createCell:function(size){var self=this;size=size==="small"?"medium":size;var cell={size:size,children:[]};return cell},computeLayout:function(context,options){this.calculateLayout(options),Base.prototype.computeLayout.call(this,context)},calculateLayout:function(options){var self=this,size,index=0,scale=modules.get("siteLayout").getTransformScale();self._headerSpace=self.$$header?self.$$header.height()/scale:0,self._width=0,self._height=0,self.hubGroupOptions=options||self.hubGroupOptions,self.$$elmt.removeClass("s-m-hub-group-v s-m-hub-group-h"),self.$$elmt.addClass("s-m-hub-group-"+self.hubGroupOptions.scrollDirection),self.hubGroupOptions.scrollDirection==="h"?self._calculateLayoutHorizontal():self._calculateLayoutVertical(),self._width=4*self.hubGroupOptions.baseSize+6,self._height=2*self.hubGroupOptions.baseSize,self.cells.forEach(function(cell){size=cell.size,cell.domItem.style.left=cell.x+"px",cell.domItem.style.top=cell.y+self._headerSpace+"px",cell.domItem.style.width=self._sizes[size].width+2+"px",cell.domItem.style.height=self._sizes[size].height+2+"px",cell.domItem.style.position="absolute",$(cell.domItem).attr("data-cellIndex",index),$(cell.domItem).attr("coord",cell.abs+","+cell.ord),$(cell.domItem).attr("silo",cell.silo),$(cell.domItem).attr("size",cell.size),cell.x+self._sizes[size].width>self._width&&(self._width=cell.x+self._sizes[size].width),cell.y+self._sizes[size].height>self._height&&(self._height=cell.y+self._sizes[size].height);var x=0,y=0;cell.children.forEach(function(tileLayout){size=tileLayout.getAuthoringSize(),tileLayout.calculateLayout(x,y,size,self._sizes[size]),x!==0?(x=0,y+=self._sizes[size].height+self.hubGroupOptions.padY):x+=self._sizes[size].width+self.hubGroupOptions.padX}),index++});var style=self.$$elmt.get(0).style;self.hubGroupOptions.scrollDirection==="h"?(self.cells.length<1&&globals.isAuthoringActive()&&(self._width=self.hubGroupOptions.maxGroupWidth),style.top="0px",style.left=self.hubGroupOptions.posX+"px",style.width=6+self._width+"px",style.height=self.hubGroupOptions.maxHeight-6+"px"):(self.cells.length<1&&globals.isAuthoringActive()&&(self._height=self.hubGroupOptions.baseSize),style.top=self.hubGroupOptions.posY+"px",style.left="0px",self._width=self.hubGroupOptions.maxGroupWidth,style.width=self.hubGroupOptions.maxGroupWidth+"px",self._height+=self._headerSpace+self._settings.portraitPadY,style.height=self._height+"px",self.cells.length<1&&globals.isAuthoringActive())},_calculateLayoutHorizontal:function(){var self=this,padSilo=0;self.hubGroupOptions.baseSize=self._settings.landscapeBaseSize,self.hubGroupOptions.padX=self._settings.landscapePadX,self.hubGroupOptions.padY=self._settings.landscapePadY,self.hubGroupOptions.maxGroupHeight=self.hubGroupOptions.maxHeight-self._headerSpace;var maxTiles=self.hubGroupOptions.maxGroupHeight/(self.hubGroupOptions.baseSize+self.hubGroupOptions.padY),remainPixels=self.hubGroupOptions.maxGroupHeight-Math.floor(maxTiles)*(self.hubGroupOptions.baseSize+self.hubGroupOptions.padY),remainPerTile=Math.floor(remainPixels/maxTiles),paddingPerTile=Math.floor(remainPixels/maxTiles/2);self.hubGroupOptions.baseSize+=remainPerTile,self.hubGroupOptions.paddingPerTile=paddingPerTile,self.hubGroupOptions.maxGroupWidth=4*self.hubGroupOptions.baseSize+3*self.hubGroupOptions.padX,self.hubGroupOptions.maxFullTileHeight=self.hubGroupOptions.maxGroupHeight-self.hubGroupOptions.padY,self.hubGroupOptions.maxAllTileHeight=self.hubGroupOptions.maxFullTileHeight,self.hubGroupOptions.maxAllTileWidth=self.hubGroupOptions.maxWidth,self._sizes={small:{width:self.hubGroupOptions.baseSize,height:self.hubGroupOptions.baseSize,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},medium:{width:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padX,height:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},wide:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},large:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padY*3,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},full:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.maxFullTileHeight,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},all:{height:self.hubGroupOptions.maxAllTileHeight,width:self.hubGroupOptions.maxAllTileWidth,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile}};var relX=0,relY=0,x=0,y=0,prevOrd=0,silo=0;self.cells.forEach(function(cell){cell.w=self._sizes[cell.size].width,cell.h=self._sizes[cell.size].height;if(y+cell.h>self.hubGroupOptions.maxGroupHeight||y!==0&&(cell.size==="full"||cell.size==="all"))y=0,relX+=self.hubGroupOptions.maxGroupWidth+self.hubGroupOptions.padX+padSilo,x=relX;cell.size==="medium"?(x-relX+cell.w>self.hubGroupOptions.maxGroupWidth&&(x=relX,y+=cell.h+self.hubGroupOptions.padY),y+cell.h>self.hubGroupOptions.maxGroupHeight&&(y=0,relX+=self.hubGroupOptions.maxGroupWidth+self.hubGroupOptions.padX+padSilo,x=relX),cell.x=x,cell.y=y,x+=cell.w+self.hubGroupOptions.padX):(x!==relX&&(x=relX,y+=self._sizes.medium.height+self.hubGroupOptions.padY),y+cell.h>self.hubGroupOptions.maxGroupHeight&&(y=0,relX+=self.hubGroupOptions.maxGroupWidth+self.hubGroupOptions.padX+padSilo,x=relX),cell.x=x,cell.y=y,y+=cell.h+self.hubGroupOptions.padY,cell.size==="all"&&(y=0,relX+=cell.w+self.hubGroupOptions.padX,x=relX)),cell.abs=Math.round(cell.x/(self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padX)),cell.ord=Math.round(cell.y/(self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY)),cell.ord===0&&cell.ord!==prevOrd&&silo++,cell.silo=silo,prevOrd=cell.ord})},_calculateLayoutVertical:function(){var self=this,centerPadX;self.hubGroupOptions.paddingPerTile=0,self.hubGroupOptions.maxGroupHeight=self.hubGroupOptions.maxHeight-self._headerSpace,self.hubGroupOptions.padX=self._settings.portraitPadX,self.hubGroupOptions.padY=self._settings.portraitPadY,self.hubGroupOptions.maxFullTileHeight=self.hubGroupOptions.maxGroupHeight-self.hubGroupOptions.padY;var small=!1;self.hubGroupOptions.maxWidth>=self._settings.portraitWideMinWidth||self.hubGroupOptions.allowSmallTiles===!0&&self._linksOnly===!0?(self.hubGroupOptions.baseSize=Math.floor((self.hubGroupOptions.maxWidth-7*self.hubGroupOptions.padX)/8),self.hubGroupOptions.maxGroupWidth=8*self.hubGroupOptions.baseSize+7*self.hubGroupOptions.padX):(self.hubGroupOptions.baseSize=Math.floor((self.hubGroupOptions.maxWidth-3*self.hubGroupOptions.padX)/4),self.hubGroupOptions.maxGroupWidth=4*self.hubGroupOptions.baseSize+3*self.hubGroupOptions.padX),self.hubGroupOptions.maxAllTileHeight=self.hubGroupOptions.maxFullTileHeight,self.hubGroupOptions.maxAllTileWidth=self.hubGroupOptions.maxWidth,centerPadX=(self.hubGroupOptions.maxWidth-self.hubGroupOptions.maxGroupWidth)/2,self.hubGroupOptions.maxGroupWidth+=centerPadX,self._sizes={small:{width:self.hubGroupOptions.baseSize,height:self.hubGroupOptions.baseSize,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},medium:{width:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padX,height:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},wide:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},large:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padY*3,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},full:{width:self.hubGroupOptions.baseSize*4+self.hubGroupOptions.padX*3,height:self.hubGroupOptions.maxFullTileHeight,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile},all:{width:self.hubGroupOptions.maxAllTileWidth,height:self.hubGroupOptions.maxAllTileHeight,paddingX:self.hubGroupOptions.paddingPerTile,paddingY:self.hubGroupOptions.paddingPerTile}};var x=centerPadX,y=0,yInc=0;self.cells.forEach(function(cell){cell.w=self._sizes[cell.size].width,cell.h=self._sizes[cell.size].height,cell.x=x,cell.y=y,x+cell.w>self.hubGroupOptions.maxGroupWidth?(x=centerPadX,y+=yInc+self.hubGroupOptions.padY,cell.x=x,cell.y=y,yInc=cell.h,x+=cell.w+self.hubGroupOptions.padX):(x+=cell.w+self.hubGroupOptions.padX,yInc=cell.h>yInc?cell.h:yInc),cell.abs=Math.round(cell.x/(self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padX)),cell.ord=Math.round(cell.y/(self.hubGroupOptions.baseSize*2+self.hubGroupOptions.padY)),cell.silo=0})},getTitle:function(){return this.getArticleText("$title")},_getCapability:function(capability){return this.article.$capabilities&&this.article.$capabilities.indexOf(capability)>-1},getWidth:function(){return this._width},getHeight:function(){return this._height}})}),define("syracuse-tablet/html/js/controls/layouts/layoutTile",["require","exports","module","syracuse-tablet/html/js/controls/layouts/layoutBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/ui/uiSettings"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/layouts/layoutBase").LayoutBase,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings");exports.LayoutTile=utils.defineClass(function LayoutTile(controller,type,article,opts){Base.call(this,controller,type,article,opts),article.$bgColor==null&&(article.$bgColor=uiSettings.getProp("colors.TILEDEFCOLOR")),article.$bgColor=article.$bgColor.toLowerCase()},Base,{initReuseProperties:function(){Base.prototype.initReuseProperties.call(this)},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self),self.$$elmt.addClass("s-m-tile"),self._setCellColorClass(),self.buildChildrenHtml(),self.isEmpty&&self._buildEmptyTile(),self._checkAddActionButtons()},getChild$$Container:function(){return this.$$elmt},_buildEmptyTile:function(){var $$container=this.getChild$$Container();$$container.css({display:"table","table-layout":"fixed","text-align":"center"});var $bind=null;this.article.$items&&this.article.$items.length>0&&($bind=this.article.$items[0].$bind);var html=[];html.push('<section class="s-m-icon" style="display:table-row;height:100%;">'),html.push('<div style="display:table-cell;vertical-align: middle;">'),html.push('<div class="s-m-sage-app-icon '),html.push(fontUtils.dashboardIcon("emptyTile")),html.push('"></div>'),html.push("</div></section>"),html.push('<section class="s-m-title">'),$bind!=null&&jsutils.isDvlpVersion()&&html.push('<span style="font-size:smaller;white-space:nowrap;">'+$bind+"</span><br>");var textName="gadget.not.found";jsutils.isInstanceOf(this.page,"PageHome")&&(textName="welcome.dashboard.emptyTile"),html.push("<div>"+locale.text(textName)+"</div></section>"),$$container.append(html.join(""))},_setCellColorClass:function(){var bg=(this.article.$bgColor||"").toLowerCase();if(bg==="transparent"||bg.length===0)return;bg="s-m-color-"+bg,this.$$elmt.addClass("s-m-bg "+bg)},calculateLayout:function(x,y,authSize,sizeInfo){var css={left:x+"px",top:y+"px",width:sizeInfo.width+"px",height:sizeInfo.height+"px",position:"absolute","padding-left":sizeInfo.paddingX+"px","padding-right":sizeInfo.paddingX+"px","padding-bottom":sizeInfo.paddingY+"px","padding-top":(this.$$header?this.$$header.height():0)+sizeInfo.paddingY+"px"};this.$$elmt.css(css),this.$$elmt.addClass(authSize)},getAuthoringSize:function(){return this.article&&this.article.$size||"medium"},notifSpecialArrayHosted:function(typeArray){if(!this.$$elmt)return;this.$$elmt.removeClass("s-m-carousel s-m-chart"),typeArray==="carousel"?this.$$elmt.addClass("s-m-carousel"):typeArray==="chart"&&this.$$elmt.removeClass("s-m-bg s-m-color-"+this.article.$bgColor).addClass("s-m-chart")},isLinkVignette:function(){var child=this.children?this.children[0]:null;return!child||child.$type!=="tablet/x-vignette"?!1:child.isLinkVignette()},_checkAddActionButtons:function(){var self=this;if(!this.options.tileActions||this.options.tileActions.length<=0)return;this.options.tileActions.forEach(function(action){if(!self.isEmpty||action.action==="removeTile"){var $$btn=$('<btn class="cfg '+action.icon+" "+action.className+'" data-nevent data-naction="'+action.action+'" data-params="'+self.id+'"></btn>');self.$$elmt.append($$btn)}})}})}),define("syracuse-tablet/html/js/controls/panels/panelBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/ctrlBase"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase;exports.PanelBase=utils.defineClass(function PanelBase(controller,type,article,opts){Base.call(this,controller,type,article,opts),this.isPanel=!0},Base,{destroy:function(){Base.prototype.destroy.call(this),this.actionAdapter=null},setActionAdapter:function(actionAdapter){this.actionAdapter=actionAdapter},buildHtml:function(){this.createRootElement(["s-m-panel","s-m-control","s-m-ctrl"])},createId:function(typeName){return utils.readableuid(typeName)},getUnitTestId:function(){if(this.options.index==null)return;return utils.unitTestId(this.typeName.toLowerCase(),this.options.index)},getGestureMgr:function(){return null},disable:function(yes){yes=yes===!0,this.$$elmt.css("opacity",yes?.5:"inherit"),yes?this.$$elmt.click(function(evt){evt.preventDefault(),evt.stopPropagation()}):this.$$elmt.off()},_action$$Elmt:function(action,params){var selector='[data-naction="'+action+'"]';params&&(selector+="[data-params="+params+"]");var res=$();return this.$$elmt.find(selector).each(function(){var $$elmt=$(this);res.push($$elmt),$$elmt.closest('[data-menuitem-id="'+action+'"]').each(function(){res.push($(this))})}),res},enableAction:function(action,yes,params){this._action$$Elmt(action,params).each(function(){$(this).toggleClass("disabled",yes===!1),yes?$(this).removeAttr("disabled"):$(this).attr("disabled","true")})},showAction:function(action,yes,params){this._action$$Elmt(action,params).each(function(){$(this).toggle(yes!==!1)})}})}),define("syracuse-tablet/html/js/controls/panels/panelSdataPage",["require","exports","module","syracuse-tablet/html/js/controls/panels/panelBase","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/panels/panelBase").PanelBase,notifications=require("syracuse-tablet/html/js/helpers/notifications"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),utils=require("syracuse-tablet/html/js/helpers/utils");exports.PanelSdataPage=utils.defineClass(function PanelSdataPage(controller,type,article,opts){Base.call(this,controller,type,article,opts),notifications.subscribe(this,["sm.pin.status.change","sm.edit.templates.changed"])},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this)},onMenuItemChanged:function($itemName,$bind,metaData){var $$item=this.$$elmt.find('[data-menuitem-id="'+$itemName+'"]');if($$item.length<1)return;metaData.$isDisabled===!0?$$item.addClass("disabled"):metaData.$isDisabled===!1&&$$item.removeClass("disabled"),metaData.$isHidden===!0?$$item.addClass("hidden"):metaData.$isHidden===!1&&$$item.removeClass("hidden")},_$$action:function(itemId){return this.$$elmt.find('[data-menuitem-id="'+itemId+'"]')},notifPinStatusChange:function(state){if(this.destroyed)return;this._$$action(state==1?"pinPage":"unpinPage").addClass("hidden"),this._$$action(state==1?"unpinPage":"pinPage").removeClass("hidden")},notifEditTemplatesChanged:function(empty){if(this.destroyed)return;var $$e=this._$$action("showEditTemplates");if($$e.length==0)return;empty=empty===!0,$$e.is(".disabled")&&$$e.removeClass("disabled"),$$e=$$e.children("i"),$$e.removeClass(fontUtils.panelActionIcon(empty?"showEditTemplates":"showEditTemplatesEmpty")),$$e.addClass(fontUtils.panelActionIcon(empty?"showEditTemplatesEmpty":"showEditTemplates"))}})}),define("syracuse-tablet/html/js/controls/panels/footer/panelFooterSdataPageBase",["require","exports","module","syracuse-tablet/html/js/controls/panels/panelSdataPage","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/panelSdataPage").PanelSdataPage,utils=require("syracuse-tablet/html/js/helpers/utils"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),modules=require("syracuse-tablet/html/js/common/modules"),_html={mainContainer:'		<div class="s-m-footer s-m-opened container-fluid {{deviceClass}}">			<div class="s-m-footer-left">			</div>			<div class="s-m-footer-right">			</div>		</div>'},_templates={};exports.PanelFooterSdataPageBase=utils.defineClass(function PanelFooterSdataPageBase(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(deviceClass){this.$$container.css({left:"0px",height:this.getDesiredHeight()+"px"}),Base.prototype.buildHtml.call(this),this.$$elmt.addClass("footer"),this.$$elmt.html(_getHtml("mainContainer",{deviceClass:deviceClass})),this.$$left=this.$$elmt.find(".s-m-footer-left"),this.$$right=this.$$elmt.find(".s-m-footer-right")},computeLayout:function(){if(!this.$$container)return;var layoutInfo=modules.get("siteLayout").getLayoutInfo();this.$$container.css({top:this.top+"px",width:layoutInfo.application.width+"px"}),this.$$container.is(":visible")||this.$$container.show()},getDesiredHeight:function(){var layoutInfo=modules.get("siteLayout").getLayoutInfo(),deviceType=layoutInfo.deviceType;return uiSettings.getProp("footer.height",deviceType)},setTop:function(top){this.top=top}})}),define("syracuse-tablet/html/js/pages/actionAdapter",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale");exports.ActionAdapter=utils.defineClass(function ActionAdapter(page){this.page=page},null,{destroy:function(){this.page=null},getActionsPanelItems:function(){return[]},getFooterItems:function(){return[]},getHeaderItems:function(){return[]},getGlobalPanelItems:function(){return[]},getPageTitle:function(){return this.page.getPageTitle()},_addDataAction:function(items,name,action,params,title,icon,controller,overrides,visibleLinks){visibleLinks=visibleLinks||{};if(visibleLinks[name])return;var item=exports.createDataAction(name,action,params,title,icon,controller,overrides);items.push(item)},_addHomeButton:function(items,controller,overrides){this._addDataAction(items,"home","home",null,"global.action.title.home","",controller,overrides)},_addPinButton:function(items,status,controller,overrides,visibleLinks){status=status==="pin"?"pin":"unpin",this._addDataAction(items,"pinPage",status+"Page",null,"global.action.title."+status,"",controller,overrides,visibleLinks)},_addDesignPageButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"designPage","designPage",null,"global.action.title.designPage","",controller,overrides,visibleLinks)},_addShareButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"pageShare","pageShare",null,"global.action.title.pageShare","",controller,overrides,visibleLinks)},_addSettingsButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"settings","settings",null,"global.action.title.settings","settings",controller,overrides,visibleLinks)},_addAboutButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"about","about",null,"global.action.title.about","about",controller,overrides,visibleLinks)},_addDevButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"developmentPage","developmentPage",null,"global.action.title.developmentPage","development",controller,overrides,visibleLinks)},_addLogoutButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"logout","logout",null,"global.action.title.logout","logout",controller,overrides,visibleLinks)},_addDraftsListButton:function(items,numDrafts,controller,overrides,visibleLinks){},_addAcceptButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"accept","accept",null,"global.action.title.accept","accept",controller,overrides,visibleLinks)},_addCancelButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"cancel","cancel",null,"global.action.title.cancel","cancel",controller,overrides,visibleLinks)},_addPageConfigButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"pageConfig","pageConfig",null,"action.pageConfig","pageConfig",controller,overrides,visibleLinks)},_addMyDashboardTemplatesButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"myDashboardTemplates","myDashboardTemplates",null,"action.myDashboardTemplates","myDashboardTemplates",controller,overrides,visibleLinks)},_addMyDashboardButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"myDashboard","myDashboard",null,"action.myDashboard","myDashboard",controller,overrides,visibleLinks)},_addGlobalAction:function(action,items,controller,overrides,icon,params,visibleLinks){this._addDataAction(items,action,action,params,"global.action.title."+action,icon||action,controller,overrides,visibleLinks)},_addMultiSelectonButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"multiSelToggle","multiSelToggle",null,"action.multiselection.toggle","",controller,overrides,visibleLinks)},_addSortFilterButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"sortFilter","sortFilter",null,"action.sortFilter","sortFilter",controller,overrides,visibleLinks)},_addSearchButton:function(items,controller,overrides,visibleLinks){this._addDataAction(items,"search","search",null,"action.search","search",controller,overrides,visibleLinks)},_addDraftsListLink:function(items,controller,slot){this._addDataAction(items,"draftsList","draftsList",null,"header.links.page.drafts","drafts",controller,{slot:slot,disabled:!0},null)}}),exports.createDataAction=function(name,action,params,title,icon,controller,overrides){var item=$.extend(!0,{name:name,"controller-id":controller.id,action:action,params:params,title:locale.textOpt(title)||title,icon:icon},overrides);return item}}),define("syracuse-tablet/html/js/controls/panels/panelsHtml",["require","exports","module","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/ui/uiUtils","syracuse-tablet/html/js/app/eventListener","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){function _getHtml(panel,name,ctx){var tmpl=_templates[panel];return tmpl||(tmpl=_templates[panel]={}),tmpl=tmpl[name],tmpl||(tmpl=_templates[panel][name]=Handlebars.compile(_html[panel][name])),tmpl(ctx)}var fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),uiutils=require("syracuse-tablet/html/js/ui/uiUtils"),eventListener=require("syracuse-tablet/html/js/app/eventListener"),locale=require("syracuse-tablet/html/js/helpers/locale"),_multiSelActionsList=[{action:"multiSelTriggerDownload",params:"$download",title:"download"},{action:"multiSelActions",params:"$unselectall",title:"unselectall"},{action:"multiSelActions",params:"$selectall",title:"selectall"},{action:"multiSelActions",params:"$invert",title:"invert"},{action:"multiSelActions",params:"$hideunselected",title:"hideunselected"},{action:"multiSelActions",params:"$showunselected",title:"showunselected"}],_html={footer:{defaultItem:'<a href="#"			draggable="false" 			data-menuitem-id="{{uniqueId}} {{#if isDisabled}}disabled{{/if}} {{#if isHidden}}hidden{{/if}}" 			class="s-m-link {{{css}}}" 			{{{style}}} 			{{{attrs}}}>			<i class="{{iconClass}}"></i>			<span>{{title}}</span>		</a>'},header:{defaultItem:'<a href="#"			draggable="false" 			data-menuitem-id="{{uniqueId}}" 			class="s-m-link {{{css}}} {{#if isDisabled}}disabled{{/if}} {{#if isHidden}}hidden{{/if}}" 			{{{style}}} 			{{{attrs}}}>			<i class="{{iconClass}}"></i>		</a>'},actionPanel:{defaultItem:'<li data-menuitem-id="{{uniqueId}}"			class="s-m-link {{{css}}} {{#if isDisabled}}disabled{{/if}} {{#if isHidden}}hidden{{/if}}" 			{{{style}}} >			<a href="#"				draggable="false" 				{{{attrs}}}>				<span class="s-m-text">{{title}}</span>			</a>		</li>'},globalPanel:{defaultItem:'<li data-menuitem-id="{{uniqueId}}">			<a href="#"				draggable="false" 				class="s-m-link {{{css}}} {{#if isDisabled}}disabled{{/if}} {{#if isHidden}}hidden{{/if}}" 				{{{style}}} 				{{{attrs}}}>				<i class="{{iconClass}}"></i>				<span class="s-m-text">{{title}}</span>			</a>		</li>',draftsItem:'<li data-menuitem-id="{{uniqueId}}">			<a href="#" 				draggable="false" 				class="s-m-link {{{css}}}" 				style="{{{style}}}" 				{{#if disabled}} disabled="true"{{/if}}>				<i class="{{iconClass}}"></i>				<span class="s-m-text">{{title}}<span class="badge" style="float: right;">{{count}}</span></span>			</a>		</li>'},multiSel:{menuActions:'			<div id="{{id}}" class="btn-group s-m-link {{{css}}}">				<div class="{{dropDirection}}">					<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">						<span class="badge"></span><span class="title">{{title}}</span><span class="caret"></span>					</button>					<ul class="dropdown-menu dropdown-menu-{{dropPosition}}" role="menu">						{{#each links}}							<li><a  style="display:none" draggable="false" {{{attrs}}}>{{title}}</a></li>						{{/each}}					</ul>				</div>			</div>'}},_templates={},_setDataActionAttrs=function(controllerId,item){item.attrs=eventListener.getDataActionAttrs(controllerId,item.action,item.params,!1)||{}},_getMultiSelMenuActions=function(panelName,controllerId,includeDownload){var dropDirection=panelName==="footer"?"dropup":"dropdown",dropPosition=panelName==="footer"?"right":"left",links=[];return _multiSelActionsList.forEach(function(info){if(includeDownload!==!0&&info.params==="download")return;links.push({title:locale.text("multiselect.action."+info.title),attrs:eventListener.getDataActionAttrs(controllerId,info.action,info.params,!0)})}),_getHtml("multiSel","menuActions",{id:"multiSelMenuActions",links:links,title:locale.text("multiselect.selected"),dropDirection:dropDirection,dropPosition:dropPosition})};exports.getItemHtml=function(panelName,item){var html,tpl,attrs,controllerId=item["controller-id"];item.attrs=null,item.style=null,item.css=null;if(item.action){if(item.action==="multiSelActions"||item.action==="multiSelActionsWithDownload")return _getMultiSelMenuActions(panelName,controllerId,item.action==="multiSelActionsWithDownload");item.action==="pageDrafts"?(tpl="draftsItem",item.count=item.params,item.disabled=item.count<1,item.attrs=eventListener.getDataActionAttrs(controllerId,item.action,item.params)):(tpl="defaultItem",item.attrs=eventListener.getDataActionAttrs(controllerId,item.action,item.params)),item.uniqueId=item.action}else item.$link?(tpl="defaultItem",item.attrs=eventListener.getSdataLinkAttrs(controllerId,item.$link),item.uniqueId=item.$link):item.$sdataAction&&(tpl="defaultItem",item.attrs=eventListener.getSdataActionAttrs(controllerId,item.$sdataAction),item.uniqueId=item.$sdataAction);if(tpl){item.icon&&typeof item.icon=="string"?item.iconClass=fontUtils.panelActionIcon(item.icon):item.icon&&item.icon.css&&(item.iconClass=item.icon.css),item.attrs=item.attrs||{},item.css=[],item.disabled===!0&&(item.attrs.disabled="true",item.css.push("disabled")),item.style="",item.hidden===!0&&(item.style=[],item.style.push("display:none"),item.style=item.style.join(";"));if(item.hidden===!0||item.forceHeader===!0)item.attrs["data-forceheader"]="true";item.attrs=uiutils.objectToHtmlAttrs(item.attrs),item.css=item.css.join(" "),item.style.length>0&&(item.style=' style="'+item.style+'" '),html=_getHtml(panelName,tpl,item)}return html}}),define("syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeTablet",["require","exports","module","syracuse-tablet/html/js/controls/panels/footer/panelFooterSdataPageBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/pages/actionAdapter","syracuse-tablet/html/js/controls/panels/panelsHtml"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/panels/footer/panelFooterSdataPageBase").PanelFooterSdataPageBase,utils=require("syracuse-tablet/html/js/helpers/utils"),actionAdapter=require("syracuse-tablet/html/js/pages/actionAdapter"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml");exports.PanelFooterEditHomeTablet=utils.defineClass(function PanelFooterEditHomeTablet(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self,"tablet"),this.leftItems=[],this.rightItems=[];var items=this._getItems();for(var ii=0,jj=items.length;ii<jj;ii++){var item=items[ii],html=panelsHtml.getItemHtml("footer",item);if(html){var list=item.slot==="left"?this.leftItems:this.rightItems;list.push(html)}}this.rightItems.reverse(),this.$$left.append($(this.leftItems.join(""))),this.$$right.append($(this.rightItems.join("")))},_getItems:function(){var items=[];return items.push(actionAdapter.createDataAction("addGroup","addGroup",null,"welcome.dashboard.add.group","addGroup",this.controller,{slot:"left"})),this.actionAdapter.showMyAvailableDashboard&&items.push(actionAdapter.createDataAction("myAvailableTemplates","myAvailableTemplates",null,"welcome.dashboard.myAvailableTemplates.list","myAvailableTemplates",this.controller,{slot:"left"})),items}})}),define("syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeSmartphone",["require","exports","module","syracuse-tablet/html/js/controls/panels/footer/panelFooterSdataPageBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/pages/actionAdapter","syracuse-tablet/html/js/controls/panels/panelsHtml"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/panels/footer/panelFooterSdataPageBase").PanelFooterSdataPageBase,utils=require("syracuse-tablet/html/js/helpers/utils"),actionAdapter=require("syracuse-tablet/html/js/pages/actionAdapter"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml");exports.PanelFooterEditHomeSmartphone=utils.defineClass(function PanelFooterEditHomeSmartphone(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(self,"smartphone"),this.leftItems=[],this.rightItems=[];var items=this._getItems();for(var ii=0,jj=items.length;ii<jj;ii++){var item=items[ii],html=panelsHtml.getItemHtml("footer",item);if(html){var list=item.slot==="left"?this.leftItems:this.rightItems;list.push(html)}}this.rightItems.reverse(),this.$$left.append($(this.leftItems.join(""))),this.$$right.append($(this.rightItems.join("")))},_getItems:function(){var items=[];return items.push(actionAdapter.createDataAction("addGroup","addGroup",null,"welcome.dashboard.add.group","addGroup",this.controller,{slot:"left"})),this.actionAdapter.showMyAvailableDashboard&&items.push(actionAdapter.createDataAction("myAvailableTemplates","myAvailableTemplates",null,"welcome.dashboard.myAvailableTemplates.list","myAvailableTemplates",this.controller,{slot:"left"})),items}})}),define("syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase",["require","exports","module","syracuse-tablet/html/js/controls/panels/panelSdataPage","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/deps/hammerjs-2.0.4/hammer","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/controls/panels/panelsHtml","syracuse-tablet/html/js/helpers/native/native"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/panelSdataPage").PanelSdataPage,formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),utils=require("syracuse-tablet/html/js/helpers/utils"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),modules=require("syracuse-tablet/html/js/common/modules"),locale=require("syracuse-tablet/html/js/helpers/locale"),Hammer=require("syracuse-tablet/html/deps/hammerjs-2.0.4/hammer"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml"),native=require("syracuse-tablet/html/js/helpers/native/native"),_availableSlots=["unclassified","right","main","array"],_html={mainContainer:'		<div class="s-m-header {{device}}">			{{#if showNav}}				<div class="s-m-header-nav">				<a href="#" draggable="false"					id="{{navigation.id}}"					data-nevent					data-naction="{{navigation.action}}">					<i class="{{navigation.icon}}"></i>				</a>				</div>			{{/if}}			{{#if showLabel}}			<div class="s-m-header-labels">				<span class="s-m-header-label">{{title}}</span>			</div>			{{/if}}			<div class="s-m-header-links">				{{#if showActionPanel}}				<a class="s-m-header-link" href="#" draggable="false" 					data-nevent					data-naction="openActionsPanel">					<i class="fa fa-ellipsis-v"></i>				</a>				{{/if}}				{{#if showActionMultiSelectionPanel}}				<a class="s-m-header-link" href="#" draggable="false" 					data-nevent					data-naction="openActionsMultiSelectionPanel">					<i class="fa fa-ellipsis-v"></i>				</a>				{{/if}}			</div>		</div>		{{#if showFreshness}}			<div class="s-m-freshness s-m-fresh"				data-nevent data-naction="showFreshness"				style="display: none;">				<i class="fa fa-bookmark"></i>			</div>		{{/if}}',itemsBlock:'			<div class="s-m-header-slot {{slot}}">			</ul>'},_templates={};exports.PanelHeaderSdataPageBase=utils.defineClass(function PanelHeaderSdataPageBase(controller,type,article,opts){Base.call(this,controller,type,article,opts),notifications.subscribe(this,["sm.data.freshness.change"]),notifications.subscribe(this,["sm.all.vignettes.loaded"]),notifications.subscribe(this,["sm.page.loaded"])},Base,{destroy:function(){Base.prototype.destroy.call(this),this.hammer&&(this.hammer.destroy(),this.hammer=null),this.$$search&&(this.$$search.off("input"),this.$$search=null),this.$$title=null,this.$$links=null},buildHtml:function(){var self=this,availableSlots=this._getAvailableSlots();self.$$container.css({left:"0px",height:this.getDesiredHeight()+"px"}),Base.prototype.buildHtml.call(this),self.$$elmt.html(_getHtml("mainContainer",this.getHeaderCtx())),self.$$elmt.addClass("header"),self.$$elmt.css({left:"0px",height:self._height+"px"}),self.$$container.append('<nav class="s-m-navigation-stackbar"  style="height:'+this.getNavigationStackHeight()+'px;display:none"></nav>'),self.$$container.show(),self._addPressHandler(),self.$$links=self.$$elmt.find(".s-m-header-links");var items=self._getItems(),ctx={},slots={};items.forEach(function(item){item.slot=item.slot||"unclassified",$.inArray(item.slot,availableSlots)===-1&&(item.slot="unclassified"),slots[item.slot]=slots[item.slot]||[],slots[item.slot].push(item)});var $$itemsBlocksHtml=$("<div></div>");availableSlots.forEach(function(slotName){var slot=slots[slotName];if(slot){var $$itemsBlock=$(_getHtml("itemsBlock",{slot:slotName}));slot.forEach(function(item){$$itemsBlock.append(panelsHtml.getItemHtml("header",item))}),$$itemsBlocksHtml.append($$itemsBlock)}}),self.$$links.append($$itemsBlocksHtml.html()),self.actionAdapter.showSearch&&self.$$links.append(this.actionAdapter.searchCtrl.getHtml()),self.$$search=self.$$elmt.find(".s-m-search"),self.$$title=self.$$elmt.find(".s-m-header-labels"),self._checkBack()},_getAvailableSlots:function(){return _availableSlots},_addPressHandler:function(){this.hammer&&this.hammer.destroy(),this.hammer=new Hammer(this.$$elmt.get(0)),this.hammer.get("press").set({time:400}),this.hammer.on("press",Hammer.bindFn(this._onPress,this))},_onPress:function(evt){if(this.page.isHome())return;var panel=this.page.openPanel("breadcrumbs");panel&&panel.show()},computeLayout:function(context){if(!this.$$container)return;var layoutInfo=modules.get("siteLayout").getLayoutInfo();this.$$container.css({top:this.top+"px",width:layoutInfo.application.width+"px"});var self=this;this.$$search.off("input"),this.$$search.on("input","input",function(){self.actionAdapter.searchCtrl.toggleRemoveSearch($(this).val())}),this._responsiveHeader()},_responsiveHeader:function(){var opt={visibleLinks:this._headerLinksVisible().visibleLinks,layoutChange:!0},actionsPanel=this.actionAdapter.getActionsPanelItems(opt),actionPanelButton=$('[data-naction="openActionsPanel"]',this.$$links);actionsPanel.length===0?actionPanelButton.hide():actionPanelButton.show()},_headerLinksVisible:function(){var lists={visibleLinks:{}},$$nav=this.$$elmt.find(".s-m-header-nav"),showSearch=this.$$search.is(":visible");this._hideSearch();var searchWidth=this.$$search.outerWidth()||0,titleWidth=this.$$title.width()||0,initialWidth=titleWidth,availableWidth=this._getAvailableWidth(),$$list=$(".s-m-link",this.$$links);return jQuery.fn.reverse=[].reverse,$$list.reverse().each(function(idx){var show=!0,forceHeader=$(this).is("[data-forceheader]");availableWidth-$(this).outerWidth()<0?show=!1:availableWidth-=$(this).outerWidth(),show||forceHeader?(forceHeader||$(this).show(),lists.visibleLinks[$(this).attr("data-menuitem-id")]=!0):$(this).hide()}),this.$$links.attr("data-remain-size",availableWidth),showSearch&&this._showSearch(),lists},_getAvailableWidth:function(){var $$btnAction=$(".s-m-header-link",this.$$links);return this.$$links.width()-$$btnAction.outerWidth()},_hideSearch:function(){this.$$search.hide(),this.$$title.show()},_showSearch:function(){var availableWidth=this.$$links.attr("data-remain-size");this.$$search.outerWidth()>availableWidth&&this.$$title.hide(),this.$$search.show()},getHeaderCtx:function(){return{title:this.actionAdapter.getPageTitle(),navigation:{id:this.actionAdapter.showGlobalPanelButton?"s-m-header-panel-id":"s-m-header-back-id",action:this.actionAdapter.showGlobalPanelButton?"openGlobalPanel":"historyBack",icon:this.actionAdapter.showGlobalPanelButton?"fa fa-bars":"fa fa-arrow-left"},showNav:!0,showLabel:!0,showFreshness:!0,showActionPanel:!this.actionAdapter.showGlobalPanelButton,device:siteLayout.getDeviceType(),height:this.getDesiredHeight()-5+"px",navStackBarHeight:this.getNavigationStackHeight()+"px"}},getDesiredHeight:function(){return uiSettings.getProp("header.height")+this.getNavigationStackHeight()},getNavigationStackHeight:function(){return this.controller.showNavigationStackBar()?uiSettings.getProp("navigationStackBar.height"):0},setTop:function(top){this.top=top},notifDataFreshnessChange:function(dataFreshness){this._dataFreshness=dataFreshness,this._$$freshness=$(".s-m-freshness",this.$elmt),this._$$freshness.removeClass("s-m-fresh s-m-tainted s-m-verytainted"),this._$$freshness.addClass("s-m-"+this._dataFreshness.level),this._$$freshness.show()},_actShowFreshness:function(){if(!this._dataFreshness)return;var formatter=formatApi.getFormatter("application/x-datetime"),dateTime=formatter.formatValue(utils.getCurISODateTime(new Date(this._dataFreshness.dateTime)),!1),notify={severityClass:this._dataFreshness.level,title:locale.text("page.data.freshness.last")+" : "+dateTime,body:locale.text("page.data.freshness."+this._dataFreshness.level),onlyWebapp:!0};modules.get("modal").notify(notify)},_getItems:function(){return this.actionAdapter.getHeaderItems()},_checkBack:function(){var layoutInfo=modules.get("siteLayout").getLayoutInfo(),$$back=$("#s-m-header-back-id",this.$$elmt);(native.hasCapability("hardwareBackButton")||layoutInfo.deviceType==="smartphone")&&$$back.hide()},_actActionArray:function(id){switch(id){case"search":this.actionAdapter.searchCtrl.search();break;case"removeSearch":this.actionAdapter.searchCtrl.removeSearch()}},_actSearch:function(){if(this.actionAdapter.searchCtrl.isDirty()){this._actActionArray("search");return}this.$$search.is(":visible")?this._hideSearch():this._showSearch()},notifPageLoaded:function(page){page.isDashboard()&&!this.allVignettesLoader&&$(".s-m-header-nav > a",this.$$elmt).attr("disabled",!0)},notifAllVignettesLoaded:function(){this.allVignettesLoader=!0,$(".s-m-header-nav > a",this.$$elmt).removeAttr("disabled")}})}),define("syracuse-tablet/html/js/multiselection/multiSelectionPanelController",["require","exports","module","syracuse-tablet/html/js/controllers/controller","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controllers/controller").Controller,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale");exports.MultiSelectionPanelController=utils.defineClass(function MultiSelectionPanelController(panel){Base.call(this),this._panel=panel},Base,{destroy:function(){Base.prototype.destroy.call(this),this._panel=null},multiSelToggleStatus:function(enabled){this._nbSelected=0,enabled!==!0&&(this._actMultiSelActions("$showunselected"),this._actMultiSelActions("$unselectall")),this._multiSelUpdateStatus()},multiSelToggleRecord:function(enabled){return this._multiSelAction("$showunselected").css("display")!=="none"&&this._actMultiSelActions("$showunselected"),this._nbSelected=Math.max(0,this._nbSelected+(enabled===!0?1:-1)),this._multiSelUpdateStatus(),!0},multiSelStartProcessing:function(){this._multiSelToggleUnselected(!1),this._multiSelRunToggleStop(!0),this._panel.multiSelUpdateCounter(0,0)},_multiSelRunToggleStop:function(show){this._panel.showAction("multiSelTriggerAction",show,"stop"),this._panel.showAction("multiSelTriggerAction",!show,"exit")},multiSelRunStop:function(){this._multiSelRunToggleStop(!1)},multiSelRunExit:function(){this._multiSelSelected().removeClass("error success"),this._panel.multiSelUpdateCounter(0,0)},_multiSelUpdateStatus:function(){this._panel.$$elmt.find('a.s-m-link:not([data-menuitem-id="multiSelToggle"])').toggleClass("disabled",this._nbSelected==0);var $$menuActions=this._panel.$$elmt.find("#multiSelMenuActions");$$menuActions.find(".badge").text(this._nbSelected),$$menuActions.find(".title").text(locale.text(this._nbSelected>1?"multiselect.selected.plural":"multiselect.selected"));var nbRecords=this._panel.page.getQueryArray().getNbRows();this._multiSelAction("$hideunselected").toggle(this._nbSelected!=0&&this._nbSelected!=nbRecords),this._multiSelAction("$selectall").toggle(this._nbSelected!=nbRecords),this._multiSelAction("$unselectall","$invert").toggle(this._nbSelected>0),this._multiSelAction("$download").toggle(this._panel.page.isDownloadEnabled()&&this._nbSelected>0)},_multiSelUnselected:function(){return this._panel.page.$$contentElmt.find(".s-m-array.s-m-control > .s-m-value .s-m-record:not(.s-m-multi-selected)")},_multiSelSelected:function(){return this._panel.page.$$contentElmt.find(".s-m-array.s-m-control > .s-m-value .s-m-record.s-m-multi-selected")},_multiSelAll:function(){return this._panel.page.$$contentElmt.find(".s-m-array.s-m-control > .s-m-value .s-m-record")},_multiSelAction:function(){var res=$(),args=arguments;return this._panel.$$elmt.find("#multiSelMenuActions a[data-params]").each(function(id){var param=$(this).attr("data-params");Array.prototype.indexOf.apply(args,[param])>=0&&res.push(this)}),res},_multiSelToggleUnselected:function(show){this._multiSelUnselected().toggle(show);var array=this._panel.page.getQueryArray();array.$display==="card"&&(this._panel.page.$$contentElmt.find(".s-m-array.s-m-card tr").each(function(){var e=$(this);e.toggle(show?show:e.find("td").length!=e.find("td.s-m-record:not(:visible)").length)}),array.notifyScrollerUpdate())},_multiSelToggleListStatus:function(elmtList,select){var selected=elmtList.toggleClass("s-m-multi-selected",select);selected.is(".s-m-multi-selected")||(selected=[]),this._nbSelected=this._multiSelSelected().length,this._multiSelUpdateStatus()},_actMultiSelActions:function(params){if(params=="$unselectall"){this._multiSelToggleUnselected(!0),this._multiSelToggleListStatus(this._multiSelSelected(),!1);return}if(params=="$selectall"){this._multiSelToggleUnselected(!0),this._multiSelToggleListStatus(this._multiSelUnselected(),!0);return}if(params=="$invert"){var unselected=this._multiSelUnselected(),selected=this._multiSelSelected();this._multiSelToggleListStatus(unselected,!0),this._multiSelToggleListStatus(selected,!1);return}if(params==="$hideunselected"||params==="$showunselected"){var hideUnselected=params==="$hideunselected";this._multiSelToggleUnselected(!hideUnselected),this._multiSelAction("$hideunselected","$selectall","$unselectall","$invert").toggle(!hideUnselected),this._multiSelAction("$showunselected").toggle(hideUnselected);return}}})}),define("syracuse-tablet/html/js/controls/panels/header/panelHeaderMultisel",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase","syracuse-tablet/html/js/multiselection/multiSelectionPanelController"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase").PanelHeaderSdataPageBase,MultiSelectionPanelController=require("syracuse-tablet/html/js/multiselection/multiSelectionPanelController").MultiSelectionPanelController,_availableSlots=["main","multiSelection","unclassified","left"];exports.PanelHeaderMultisel=utils.defineClass(function PanelHeaderMultisel(controller,type,article,opts){Base.call(this,controller,type,article,opts),this.multiSelectionController=new MultiSelectionPanelController(this)},Base,{destroy:function(){Base.prototype.destroy.call(this),this.multiSelectionController&&(this.multiSelectionController.destroy(),this.multiSelectionController=null)},buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$elmt.addClass("multiSelection")},_getItems:function(){return this.actionAdapter.getMultiSelectionItems(this.multiSelectionController.id)},getHeaderCtx:function(){var ctx=Base.prototype.getHeaderCtx.call(this);return ctx.showNav=!1,ctx.showLabel=!1,ctx.showFreshness=!1,ctx.showActionPanel=!1,ctx.showActionMultiSelectionPanel=!0,ctx},_getAvailableSlots:function(){return _availableSlots}})}),define("syracuse-tablet/html/js/controls/panels/header/panelHeaderMultiselRun",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/header/panelHeaderMultisel"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderMultisel").PanelHeaderMultisel;exports.PanelHeaderMultiselRun=utils.defineClass(function PanelHeaderMultiselRun(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this),this._$$counter=$('<span class="s-m-multiselmsg"/>').prependTo(this.$$elmt.find(".s-m-header > .s-m-header-links"))},multiSelUpdateCounter:function(nbOk,nbKo){nbOk==null&&(nbOk=0),nbKo==null&&(nbKo=0),this._$$counter.text(nbOk+" successes - "+nbKo+" failures")},_getItems:function(){return this.actionAdapter.getMultiSelectionRunItems(this.multiSelectionController.id)}})}),define("syracuse-tablet/html/js/controls/panels/header/panelHeaderEditHome",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase").PanelHeaderSdataPageBase,notifications=require("syracuse-tablet/html/js/helpers/notifications"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),modules=require("syracuse-tablet/html/js/common/modules"),_html={mainContainer:'		<div class="s-m-header {{device}} s-m-dasboard-config">			<buttons class="pull-left dashboard-header-btn"> 				<button type="button" class="btn btn-default fa fa-arrow-left" data-nevent data-naction="closeDashboardConfig" data-controller-id="{{controllerId}}"></button> 			</buttons> 			<div class="s-m-header-title">				<input class="s-m-header-label" value="{{description}}">				{{#if template}}					<div class="s-m-dashboard-header-role-number">{{roleCount}}</div>				    <btn class="s-m-dashboard-header-btn-role fa fa-users" data-nevent data-naction="roleList" data-controller-id="{{controllerId}}">				{{/if}} 			</div>			<buttons class="pull-right dashboard-header-btn" style="width:{{rightBtnWidth}}px">				<button type="button" class="btn btn-default fa fa-check" style="display:{{displaySaveButton}}" data-nevent data-naction="{{buttonSaveAction}}" data-controller-id="{{controllerId}}"></button>			</buttons>		</div>'},_templates={};exports.PanelHeaderEditHome=utils.defineClass(function PanelHeaderEditHome(controller,type,article,opts){Base.call(this,controller,type,article,opts),notifications.subscribe(this,["sm.dashboard.state.change"]),notifications.subscribe(this,["sm.dashboard.roles.change"])},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$elmt.html(_getHtml("mainContainer",this.getHeaderCtx())),$("input.s-m-header-label",this.$$elmt).on("change",jsutils.bindFn(this._descriptionChange,this))},_descriptionChange:function(){notifications.publish(["sm.dashboard.description.change"],$("input.s-m-header-label",this.$$elmt).val())},notifDashboardStateChange:function(dirty){dirty?$("[data-naction='savePersonal'],[data-naction='saveTemplate']",this.$$elmt).show():$("[data-naction='savePersonal'],[data-naction='saveTemplate']",this.$$elmt).hide()},notifDashboardRolesChange:function(){$(".s-m-dashboard-header-role-number",this.$$elmt).text(this.page.roles().length)},getHeaderCtx:function(){return{description:this.page.getPageDescription(),device:modules.get("siteLayout").getDeviceType(),displaySaveButton:"none",rightBtnWidth:50,buttonSaveAction:this.page.isPersonal()?"savePersonal":"saveTemplate",controllerId:this.page.controller.id,template:!this.page.isPersonal(),roleCount:this.page.roles().length}}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelAsideBase",["require","exports","module","syracuse-tablet/html/js/controls/panels/panelSdataPage","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/ui/rect"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/panelSdataPage").PanelSdataPage,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),uiRect=require("syracuse-tablet/html/js/ui/rect"),_html={mainContainer:'		<nav class="navbar s-m-side-panel {{side}} {{additionnalCss}}" role="navigation">			<div class="s-m-panel-content s-m-scroll-elmt">			</div>		</nav>'},_templates={};exports.PanelAsideBase=utils.defineClass(function PanelAsideBase(controller,type,article,opts){Base.call(this,controller,type,article,opts),this._gestureMgr=null},Base,{destroy:function(){this.$$container&&this.$$container.off(),Base.prototype.destroy.call(this),this._gestureMgr&&(this._gestureMgr.destroy(),this._gestureMgr=null)},buildHtml:function(){var selectorElmts=this.attachedControlInfo.selector?this.attachedControlInfo.selector.split("-"):[];if(selectorElmts.length)switch(selectorElmts[selectorElmts.length-1]){case"left":this.attachedSide="left";break;case"freeleft":this.attachedSide="freeleft";break;case"freeright":this.attachedSide="freeright";break;default:this.attachedSide="right"}this._ensure$$container(),Base.prototype.buildHtml.call(this);var type=this.$type.split("application/x-panel-");type.length>0&&this.$$elmt.addClass(type[1]),this.$$elmt.html(_getHtml("mainContainer",{side:this.attachedSide,additionnalCss:this._getAdditionnalCss()})),this.$$panelContent=this.$$elmt.find(".s-m-panel-content"),this.options.noMainScroller===!0&&this.$$panelContent.removeClass("s-m-scroll-elmt"),this.options.noCloseOnClick!==!0&&this.$$container.click(jsutils.bindFn(this.onClickPanel,this))},_getAdditionnalCss:function(){return"navbar-inverse"},show:function(){this.$$elmt||this.buildHtml(),this._makeVisible()},hide:function(){this._makeInvisible()},onClickPanel:function(event){if(!this.$$elmt.is(":visible"))return;this.hide()},_ensure$$container:function(){this.attachedControlsMgr.ensureControl$$container(this,this.attachedControlInfo)},computeLayout:function(layoutInfo){if(!this.$$container)return},_updateGesture:function(){this.$$scrollElmt=this.$$elmt.find(".s-m-scroll-elmt");if(this.$$scrollElmt.length===0)return;if(!this.$$elmt||!this.$$elmt.is(":visible")){this._gestureMgr&&this._gestureMgr.reset();return}this._gestureMgr||(this.$$scrollWrapper=this.$$elmt.find(".s-m-scroll-wrapper"),this.$$scrollWrapper.length===0&&(this.$$scrollWrapper=this.$$elmt),this._gestureMgr=scroller.newScroller(this.$$scrollElmt,{direction:"v",valMax:0,name:this.$type,isPageScroller:!1})),this._gestureMgr.reset();var scrollRect=uiRect.elmtRect(this.$$scrollElmt.css({top:"0px"}),"outer"),wrapperRect=uiRect.elmtRect(this.$$scrollWrapper,"outer"),viewRect=wrapperRect.intersectRect(scrollRect);viewRect&&!viewRect.contains(scrollRect)&&this._gestureMgr.init(viewRect,null,null,!0)},onMenuItemChanged:function($itemName,$bind,metaData){Base.prototype.onMenuItemChanged.call(this,$itemName,$bind,metaData),this._updateGesture()},_actClosePanel:function(){this.hide()},_makeVisible:function(){this._ensure$$dismiss(),this.$$container.fadeIn(200),this.$$elmt.show();var panelWidth=this.$$elmt.width();this.$$dismiss.addClass(this.attachedSide).css(this.attachedSide,panelWidth),this.$$dismiss.addClass("s-m-ctrl"),this.$$dismiss.attr("data-controller-id",this.controller.id),this.$$dismiss.attr("id",this.id),this._updateGesture()},_makeInvisible:function(){this._ensure$$dismiss(),this.$$dismiss.removeClass(this.attachedSide).css(this.attachedSide,0),this.$$dismiss.removeClass("s-m-ctrl"),this.$$dismiss.attr("id",null),this.$$container.hide(),this.$$elmt.hide()},_ensure$$dismiss:function(){this._ensure$$container(),this.$$dismiss=this.$$container.parent().find(".s-m-side-panel-dismiss")}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelAside",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAsideBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/panelsHtml","syracuse-tablet/html/js/sdata/wpHelpers","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideBase").PanelAsideBase,utils=require("syracuse-tablet/html/js/helpers/utils"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml"),wpHelpers=require("syracuse-tablet/html/js/sdata/wpHelpers"),modules=require("syracuse-tablet/html/js/common/modules"),_html={content:'		<div class="container-fluid" data-nevent data-naction="switchContext">		{{#if header}}			<div class="navbar-header">				<div class="navbar-brand" href="#">					<div>{{username}}</div>					<div>{{userrole}}</div>				</div>			</div>		{{/if}}		</div>		{{{itemsBlockHtml}}}',itemsBlock:'		<ul class="nav navbar-nav s-m-panel-slot {{slot}}">		</ul>'},_templates={};exports.PanelAside=utils.defineClass(function PanelAside(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{destroy:function(){Base.prototype.destroy.call(this)},buildHtml:function(){Base.prototype.buildHtml.call(this),this.buildHtmlContaint()},buildHtmlContaint:function(){var ctx=this._getContext();this.$$panelContent.html(_getHtml("content",ctx));if(this.page.actionAdapter.showPinPage===!0){var self=this;wpHelpers.isPagePinned(self.page.getPinPageId()).then(function(state){self.notifPinStatusChange(state)})}},_getContext:function(){var self=this,availableSlots=this._getAvailableSlots(),ctx={},slots={},items=self._filterItems(self._getItems());items.forEach(function(item){item.slot=item.slot||"unclassified",$.inArray(item.slot,availableSlots)===-1&&(item.slot="unclassified"),slots[item.slot]=slots[item.slot]||[],slots[item.slot].push(item)});var $$itemsBlocksHtml=$("<div></div>");return availableSlots.forEach(function(slotName){var slot=slots[slotName];if(slot){var $$itemsBlock=$(_getHtml("itemsBlock",{slot:slotName}));slot.forEach(function(item){$$itemsBlock.append(self._getItemHtml(item))}),$$itemsBlocksHtml.append($$itemsBlock)}}),ctx=this._extendContext(ctx),ctx.itemsBlockHtml=$$itemsBlocksHtml.html(),ctx},_getItemHtml:function(item){return panelsHtml.getItemHtml("globalPanel",item)},_getItems:function(){return[]},_filterItems:function(items){var self=this;return items.filter(function(item){if(!self.controller.isActionHidden||!self.controller.isActionHidden(item.action))return!0})},_extendContext:function(ctx){return ctx},_getAvailableSlots:function(){return["unclassified"]},show:function(){Base.prototype.show.call(this);var self=this;this._$$draftsList=this.$$elmt.find('a[data-naction="draftsList"]');if(this._$$draftsList.length==0)return;setTimeout(function(){self._checkDraftsChanged()})},_checkDraftsChanged:function(){this.enableAction("draftsList",!1);var self=this;modules.get("storage").getStorage().draftOperation("draftCount").then(function(count){if(self.$$elmt==null)return;self.enableAction("draftsList",count>0);var $badge=self._$$draftsList.find("span.badge");$badge.length===0&&($badge=$('<span class="badge"/>').appendTo(self._$$draftsList)),$badge.text(count)}).fail(function(e){console.log("Error counting drafts",e)})}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelActions",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAside","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/panelsHtml"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAside").PanelAside,locale=require("syracuse-tablet/html/js/helpers/locale"),utils=require("syracuse-tablet/html/js/helpers/utils"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml"),_availableSlots=["actions","links","main","array","tools","home","unclassified"];exports.PanelActions=utils.defineClass(function PanelActions(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this)},_getItems:function(){return this.actionAdapter.getActionsPanelItems()},_extendContext:function(ctx){return ctx.title=locale.text("actions"),ctx},_getAvailableSlots:function(){return _availableSlots},_getAdditionnalCss:function(){return""},_getItemHtml:function(item){return panelsHtml.getItemHtml("actionPanel",item)},show:function(){this.$$elmt&&this.buildHtmlContaint(),Base.prototype.show.call(this)}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelActionsMultiSelection",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAside","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/panelsHtml"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAside").PanelAside,locale=require("syracuse-tablet/html/js/helpers/locale"),utils=require("syracuse-tablet/html/js/helpers/utils"),panelsHtml=require("syracuse-tablet/html/js/controls/panels/panelsHtml"),_availableSlots=["actions","links","main","array","tools","home","unclassified"];exports.PanelActionsMultiSelection=utils.defineClass(function PanelActionsMultiSelection(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this)},_getItems:function(){return this.actionAdapter.getMultiSelectionSidePanelItems()},_extendContext:function(ctx){return ctx.title=locale.text("actions"),ctx},_getAvailableSlots:function(){return _availableSlots},_getAdditionnalCss:function(){return""},_getItemHtml:function(item){return panelsHtml.getItemHtml("actionPanel",item)},show:function(){this.$$elmt&&this.buildHtmlContaint(),Base.prototype.show.call(this)}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelGlobalBase",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAside","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){function _getUserName(){var up=modules.get("appController").App.getCurrentUserProfile();if(!up)return"";var name=up.user.firstName||"";return name=(name!=""?name+" ":"")+up.user.lastName,name}function _getUserRole(){var up=modules.get("appController").App.getCurrentUserProfile();return up?up.selectedRole.code:""}var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAside").PanelAside,utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),_availableSlots=["appl","share","tools","draft","logout","unclassified"];exports.PanelGlobalBase=utils.defineClass(function PanelGlobalBase(controller,type,article,opts){Base.call(this,controller,type,article,opts)},Base,{_getItems:function(){return this.actionAdapter.getGlobalPanelItems()},_extendContext:function(ctx){return ctx.username=_getUserName(),ctx.userrole=_getUserRole(),ctx.header=!0,ctx},_getAvailableSlots:function(){return _availableSlots},_getAdditionnalCss:function(){return""}})}),define("syracuse-tablet/html/js/controls/panels/sortfilter/tabBase",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),uiRect=require("syracuse-tablet/html/js/ui/rect"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers");exports.TabBase=utils.defineClass(function TabBase(panel,id,options){this.id=id,this.options=options||{},this.panel=panel,this.$$tab=this.panel.$$panel.find('[href="#'+id+'"]'),this.$$tab.on("shown.bs.tab",jsutils.bindFn(this._onTabShown,this)),this.$$content=this.panel.$$panel.find("#"+this.id),this.$$content.on("click","[data-params]",jsutils.bindFn(this.onTabContentClick,this)),this._gestureMgr&&(this._gestureMgr.destroy(),this._gestureMgr=null),this.buildHtml(),this.$$scrollWrapper=this.$$content.find(".s-m-scroll-wrapper"),this.$$scrollElmt=this.$$content.find(".s-m-scroll-elmt"),this.$$scrollElmt.length>0&&this.$$scrollWrapper.length>0&&(this._gestureMgr=scroller.newScroller(this.$$scrollElmt,{direction:"v",valMax:0,isPageScroller:!1}))},null,{destroy:function(){this.panel=null,this.$$tab&&(this.$$tab.unbind(),this.$$tab.remove(),this.$$tab=null),this.$$content&&(this.$$content.unbind(),this.$$content.remove(),this.$$content=null),this._gestureMgr&&(this._gestureMgr.destroy(),this._gestureMgr=null),this.$$scrollElmt=null,this.$$scrollWrapper=null},hide:function(){this.$$tab.parent().hide(),this.$$content.hide()},setWidth:function(w){this.$$tab.parent().width(w)},triggerActivate:function(){var self=this;self.$$tab.parent().hasClass("active")?self._onTabShown():window.setTimeout(function(){self.$$tab.tab("show")})},_onTabShown:function(event){this.panel.notifyActiveTab(this),this.doTabShow(),this.updateGesture()},doTabShow:function(){},buildHtml:function(){},onTabContentClick:function(evt){evt.preventDefault(),evt.stopPropagation(),this.doContentAction(evt,$(evt.target),$(evt.target).attr("data-params"))},doContentAction:function(evt,$$target,params){},doActionApply:function(){return $.smResolve(!0)},onResize:function(context){this._gestureMgr&&this.$$content.is(":visible")&&this.updateGesture(context)},notifyOpenPanel:function(){},notifyClosePanel:function(){},updateGesture:function(context){if(!this._gestureMgr)return;this._gestureMgr.reset();var viewRect=uiRect.elmtRect(this.$$scrollWrapper).intersectRect(uiRect.elmtRect(this.panel.$$elmt));viewRect&&viewRect.height<this.$$scrollElmt.height()&&this._gestureMgr.init(viewRect)}})}),define("syracuse-tablet/html/js/controls/panels/sortfilter/tabSort",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/sortfilter/tabBase","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/ui/fontUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabBase").TabBase,modules=require("syracuse-tablet/html/js/common/modules"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_templates={main:'		<div id="sorttabroot" class="s-m-scroll-wrapper">			<ul class="list-group s-m-scroll-elmt"/>		</div>',items:'		{{#each items}}			<li class="list-group-item" data-params="{{id}}">				<span>{{name}}</span>				<span class="s-m-order '+fontUtils.sortIcon("desc")+'  {{#smCompare sort "desc"}}enabled{{/smCompare}}" data-params="desc"></span>				<span class="s-m-order '+fontUtils.sortIcon("asc")+'  {{#smCompare sort "asc"}}enabled{{/smCompare}}" data-params="asc"></span>			</li>		{{/each}}'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.TabSort=utils.defineClass(function TabSort(panel,id,options){options=options||{},options.hidden=options.hidden===!0||panel.sortInfoGet(!1).length===0,Base.call(this,panel,id,options)},Base,{destroy:function(){Base.prototype.destroy.call(this),this.$$list=null},buildHtml:function(){this.$$content.append($(_getHtml("main",{}))),this.$$list=this.$$content.find("ul.list-group")},doActionApply:function(){return this.panel.sortInfoSet($.extend(!0,[],this.sortInfo),!0),this.panel.savePagePrefs().then(function(){return!0}).fail(function(error){modules.get("modal").error(error)})},_buildSortInfo:function(){var status={};this.$$content.find(".s-m-order.enabled").each(function(idx,$$e){$$e=$($$e),status[$$e.parent().attr("data-params")]=$$e.attr("data-params")}),this.sortInfo=this.sortInfo||[],this.sortInfo.forEach(function(i){i.sort=status[i.id]||"none"})},getFavoritesData:function(){return this._buildSortInfo(),$.extend(!0,[],this.sortInfo)},doContentAction:function(evt,$$target,dataParams){$$target.hasClass("enabled")?$$target.removeClass("enabled"):((this.options.singleCriteria===!0?this.$$content:$$target.parent()).find(".s-m-order.enabled").removeClass("enabled"),$$target.addClass("enabled")),this._buildSortInfo()},notifyClosePanel:function(){Base.prototype.notifyClosePanel.call(this),this.$$items&&(this.$$items.remove(),this.$$items=null),this.sortInfo=null},doTabShow:function(){this.$$items&&this.$$items.remove(),this.sortInfo=this.sortInfo||$.extend(!0,[],this.panel.sortInfoGet()),this.$$items=$(_getHtml("items",{items:this.sortInfo})),this.$$list.append(this.$$items)}})}),define("syracuse-tablet/html/js/controllers/formController",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/controls/articleParser"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),proto=require("syracuse-tablet/html/js/sdata/prototype").Prototype,Base=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,articleParser=require("syracuse-tablet/html/js/controls/articleParser"),_createProto=function(protoJson,protoParent,baseUrl){return!protoParent&&baseUrl&&(protoJson.$baseUrl=baseUrl),new proto(protoJson)},_createArticle=function(proto){var article={$layoutType:"stack",$items:[]},protoJson=proto.data("$properties",null,!0,!0);return Object.keys(protoJson).forEach(function(key){protoJson[key].$isExcluded||article.$items.push({$bind:key})}),article},_Klass=utils.defineClass(function(id,proto,article,dataset,options){article==null&&(article=_createArticle(proto)),this.article=article,Base.call(this,dataset,null,!1)},Base,{destroy:function(){if(this.destroyed===!0)return;Base.prototype.destroy.call(this),this.rootLayout==null&&this.rootLayout.destroy(),this.rootLayout=null,this.$$formParent=null,this.article=null},render:function($$parent,opts){this.rootLayout==null&&this.buildControlsTree(),this.$$formParent.attr("data-controller-id",this.id),this.rootLayout.set$$container($$parent),this.rootLayout.buildHtml(),this.rootLayout.$$elmt.attr("data-controller-id",this.id)},buildControlsTree:function(){return this.rootLayout&&this.rootLayout.destroy(),this.rootLayout=articleParser.parseArticle(this,this.article),this.rootLayout},isEditMode:function(){return!0},applyChange:function(delta){this.dataset.applyDelta(delta)}});exports.createProto=_createProto,exports.Klass=_Klass}),define("syracuse-tablet/html/js/controls/panels/sortfilter/tabFilterEdit",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controllers/formController","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/fieldOperators","syracuse-tablet/html/js/sdata/dataset","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),formController=require("syracuse-tablet/html/js/controllers/formController"),locale=require("syracuse-tablet/html/js/helpers/locale"),fieldOperators=require("syracuse-tablet/html/js/helpers/fieldOperators"),Dataset=require("syracuse-tablet/html/js/sdata/dataset").Dataset,modules=require("syracuse-tablet/html/js/common/modules"),_templates={main:'		<section id="formtabroot">			<div class="s-m-scroll-wrapper">				<div id="formtabform"/>			</div>			<div class="btn-group btn-group-justified" role="group">				<a type="button" class="btn btn-default" data-params="cancelFilterEdit">					<i class="fa fa-times" data-params="cancelFilterEdit"></i>				</a>				<a type="button" class="btn btn-default disabled" data-params="submitFilterEdit">					<i class="fa fa-check" data-params="submitFilterEdit"></i>				</a>			</div>		</section>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)},_buildOperatorsEnum=function(operators){var res=[];return $.each(operators,function(idx,op){res.push({$value:op,$title:locale.text("field.operator."+op)})}),res},FormKlass=utils.defineClass(function(proto,dao,filtersMap,$$formParent){formController.Klass.call(this,utils.readableuid("FILTERFORM"),proto,null,dao,{$activity:"edit"}),this.$$formParent=$$formParent,this.filtersMap=filtersMap},formController.Klass,{destroy:function(){formController.Klass.prototype.destroy.call(this)},setValue:function($bind,value){var self=this;switch($bind){case"FIELDS":if(value==0){this._toggleSave(!1);return}this._toggleSave(!0);var fm=self.filtersMap[value-1],operators=fm.operators,$newEnum=_buildOperatorsEnum(operators),newData={$properties:{OPERATORS:{$value:{$enum:$newEnum},$isReadOnly:!1}},OPERATORS:$newEnum[0].$value};self.keyToHide&&(newData.$properties[self.keyToHide]={$isHidden:!0});var keyToShow="VALUE-"+fm.id;newData.$properties[keyToShow]={$isHidden:!1},self.keyToHide=keyToShow,window.setTimeout(function(){self.applyChange($.extend(!0,{},newData))});break;case"OPERATORS":formController.Klass.prototype.setValue.call(this,$bind,value,!0);break;default:formController.Klass.prototype.setValue.call(this,$bind,value,!0)}},validateForm:function(){var self=this,res=!0;return this.forEachControl(function(ctrl,idx){var bind=ctrl.$bind;res=!bind||bind==="OPERATORS"&&bind==="FIELDS"&&bind===self.keyToHide?res:res?ctrl.validateInput():res}),res},applyChange:function(newData){formController.Klass.prototype.applyChange.call(this,newData),this._toggleSave(newData!=null&&!$.isEmptyObject(newData))},render:function($$parent,buildOpts){formController.Klass.prototype.render.call(this,$$parent,buildOpts),this._toggleSave(!1)},_toggleSave:function(enable){$("a[data-params='submitFilterEdit']",this.$$formParent).toggleClass("disabled",!enable)}});exports.TabFilterEdit=utils.defineClass(function(parentTab){this.controller=null,this.$$content=$(_getHtml("main",{})),this.$$formtabform=this.$$content.find("#formtabform"),this.parentTab=parentTab,this.panel=parentTab.panel},null,{destroy:function(){this.controller&&(this.controller.destroy(),this.controller=null),this.$$content=null,this.$$formtabform=null,this.parentTab=null,this.panel=null,this.panel=null},create:function($$container){var self=this;self.$$content.parent().length==0&&$$container.append(self.$$content),self.$$formtabform.empty();var protoJson,dataJson,res=self._buildProtoJson();protoJson=res.protoJson,dataJson=res.dataJson;var proto=formController.createProto(protoJson,null,self.panel.parentArray.prototype.data("$baseUrl")),dataset=new Dataset(dataJson,proto);self.controller=new FormKlass(proto,dataset,self.filtersMap,self.$$content),self.controller.render(self.$$formtabform,{}),self.updateGesture(),self.initData&&window.setTimeout(function(){self.controller.applyChange($.extend(!0,{},self.initData),!0),self.controller.keyToHide=self.initKeyToHide})},updateGesture:function(){this.parentTab.updateGesture()},_getFiltersMap:function(){var self=this;return self.filtersMap=self.filtersMap||self.panel.filterMapGet(),self.filtersMap},_buildProtoJson:function(){var self=this,choiceData={};self.filtersMap=self._getFiltersMap();var protoJson={$properties:{FIELDS:{$title:locale.text("panels.array.filterForm.field"),$type:"application/x-choice",$value:{$type:"application/x-integer",$enum:[]},$isMandatory:!0},OPERATORS:{$title:locale.text("panels.array.filterForm.operator"),$type:"application/x-choice",$value:{$type:"application/x-string",$enum:[]},$isReadOnly:!0}},$localization:self.panel.parentArray.prototype.root.getValueByPath("$localization")};for(var ii=0,jj=self.filtersMap.length;ii<jj;ii++){var ff=self.filtersMap[ii],key="VALUE-"+ff.id;protoJson.$properties[key]={$title:locale.text("panels.array.filterForm.value"),$type:ff.prop.$type,$isHidden:!0,$item:ff.prop.$item,$value:ff.prop.$value},ff.isReference&&(protoJson.$properties[ff.prop.$bindValue]={$type:protoJson.$properties[ff.prop.$bindType],$isHidden:!0,$isExcluded:!0}),ff.prop.$type.indexOf("choice")>=0?choiceData[key]=ff.prop.$value.$enum[0].$value:ff.prop.$type.indexOf("boolean")>=0&&(choiceData[key]=!0,protoJson.$properties[key].$format="$switch")}var $fieldEnum=[];$fieldEnum.push({$value:0,$title:locale.text("panels.array.filterForm.fieldDefault")}),$.each(self.filtersMap,function(idx,ff){$fieldEnum.push({$value:idx+1,$title:ff.fieldName})}),protoJson.$properties.FIELDS.$value.$enum=$fieldEnum;var $operatorDefEnum=[],operators=fieldOperators.getOperators();protoJson.$properties.OPERATORS.$value.$enum=_buildOperatorsEnum(operators);var result={protoJson:protoJson,dataJson:choiceData};return result},doActionApply:function(){return this.controller?this.controller.checkControlsData()?(modules.get("modal").info("Data are valid"),this.panel.savePagePrefs().then(function(){return!0})):(modules.get("modal").error("Data are invalid"),$.smResolve(!1)):$.smResolve(!0)},doContentAction:function(evt,$$target,params){var self=this;switch(params){case"submitFilterEdit":self.onFilterEditSubmit();break;case"cancelFilterEdit":self.onCancelEdit()}},onFilterEditSubmit:function(){var self=this;if(self.controller.validateForm()){self.filtersMap=self._getFiltersMap();var data=self.controller.dataset.getData(),fieldId,value,prop;Object.keys(data.$properties).forEach(function(propertie){propertie!="OPERATORS"&&(fieldId=propertie,value=data[propertie])});var filterMapIdx=-1,idx=0;self.filtersMap.forEach(function(filter){fieldId==="VALUE-"+filter.id&&(filterMapIdx=idx),idx++});var operator=self.controller.dataset.getValue("OPERATORS"),prop=self.filtersMap[filterMapIdx].prop,info={filterMapIdx:filterMapIdx,fieldName:self.filtersMap[filterMapIdx].fieldName,operatorLabel:locale.text("field.operator."+operator),value:self._getValue(prop,value),operator:operator,id:self.filtersMap[filterMapIdx].id,prop:prop,originalValue:value,isReference:self.filtersMap[filterMapIdx].isReference};self.filterTab=self.filterTab||self.panel.getTabs().filter,self.filterTab.onFilterUpdate(info,!isNaN(parseInt(self.initIdx,10))&&self.initIdx>=0?self.initIdx:null),self._onTabClose()}},_getValue:function(prop,value){var self=this,vv;return typeof value=="object"?vv=value.$value||value.$description||value.$title:prop.$type.indexOf("choice")>=0?vv=prop.$value.$type.indexOf("integer")>=0?self.panel.parentArray.prototype.resolveExpression(prop.$value.$enum[parseInt(value-1,10)].$title):value:vv=value,vv},onCancelEdit:function(){var self=this;self._onTabClose(),self.parentTab.toggleList(!0)},setInitData:function(info,initIdx){var self=this;self.filtersMap=self._getFiltersMap();var filterMapIdx=info.filterMapIdx,ff=self.filtersMap[filterMapIdx];self.initData={$properties:{OPERATORS:{$value:{$enum:_buildOperatorsEnum(ff.operators)},$isReadOnly:!1}},FIELDS:filterMapIdx+1,OPERATORS:info.operator},ff.isReference&&(self.initData[ff.id]=info.originalValue.$value),self.initData["VALUE-"+ff.id]=info.originalValue;var bind="VALUE-"+ff.id;self.initData.$properties[bind]={$isHidden:!1},self.initIdx=initIdx,self.initKeyToHide=bind},_onTabClose:function(){var self=this;self.controller.destroy(),self.controller=null,self.initData=null,self.initIdx=null}})}),define("syracuse-tablet/html/js/controls/panels/sortfilter/tabFilter",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/sortfilter/tabBase","syracuse-tablet/html/js/controls/panels/sortfilter/tabFilterEdit","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabBase").TabBase,FilterEdit=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabFilterEdit").TabFilterEdit,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modules=require("syracuse-tablet/html/js/common/modules"),_templates={main:'		<div class="s-m-scroll-wrapper" style="height:100%">			<div  class="s-m-scroll-elmt">				<section id="filterlist">				</section>				<section id="filteredit">				</section>			</div>		</div>',filterList:'		<div id="filterListEmpty" style="display:none">			{{emptyList}}		</div>		<ul class="list-group"/>		<div class="btn-group btn-group-justified" role="group">			<a type="button" class="btn btn-default" data-params="addFilter">				<i class="fa fa-plus" data-params="addFilter"></i>			</a>		</div>',items:'		{{#each items}}			{{#unless  @first }}			<span class="s-m-filter-separator '+fontUtils.filterIcon("separator")+'" ></span>			{{/unless}}			<li class="list-group-item" data-params="{{id}}">				<span class="s-m-filter-info"> 					<span class="s-m-filter-field">{{fieldName}}</span>					<span class="s-m-filter-operator">{{operatorLabel}}</span>					<span class="s-m-filter-value">{{value}}</span>				</span>				<span class="s-m-filter '+fontUtils.filterIcon("edit")+'" data-params="edit,{{@index}}"></span>				<span class="s-m-filter '+fontUtils.filterIcon("delete")+'" data-params="delete,{{@index}}"></span>			</li>		{{/each}}'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.TabFilter=utils.defineClass(function TabFilter(panel,id,options){Base.call(this,panel,id,options)},Base,{destroy:function(){Base.prototype.destroy.call(this),this.filterEdit&&(this.filterEdit.destroy(),this.filterEdit=null),this.filterInfo=null,this.$$listSectio=null,this.$$list=null,this.$$editSection=null},buildHtml:function(){this.$$content.append($(_getHtml("main",{}))),this.$$editSection=this.$$content.find("#filteredit"),this.$$listSection=this.$$content.find("#filterlist"),$(_getHtml("filterList",{addFilter:locale.text("panels.array.addFilter"),emptyList:locale.text("panels.array.emptyList")})).appendTo(this.$$listSection),this.$$list=this.$$listSection.find(".list-group"),this.$$emptyList=this.$$content.find("#filterListEmpty")},doTabShow:function(){this.updateFilterList()},updateFilterList:function(list){this.filterInfo=list||this.filterInfo?this.filterInfo:$.extend(!0,[],this.panel.filterInfoGet()),this.$$emptyList.toggle(!1),this.$$list.empty();if(this.filterInfo&&this.filterInfo.length>0){var $$items=$(_getHtml("items",{items:this.filterInfo}));this.$$list.append($$items)}else this.$$emptyList.toggle(!0);this.updateGesture()},doActionApply:function(){return this.panel.filterInfoSet($.extend(!0,[],this.filterInfo),!0),this.panel.savePagePrefs().then(function(){return!0}).fail(function(error){modules.get("modal").error(error)})},getFavoritesData:function(){return $.extend(!0,[],this.filterInfo)},doContentAction:function(evt,$$target,dataParams){if(!dataParams)return;var params=dataParams.split(",");switch(params[0]){case"addFilter":this._openFilterEdit();break;case"cancelFilterEdit":this.filterEdit.onCancelEdit();break;case"submitFilterEdit":this.filterEdit.onFilterEditSubmit();break;case"delete":var idx=params[1];this._onFilterDelete(idx);break;case"edit":var idx=params[1];this._openFilterEdit(idx);break;default:return}},_onFilterDelete:function(idx){this._isIndexValid(idx)&&(this._removeFilter(idx),this.updateFilterList(this.filterInfo))},_addFilter:function(newFilterInfo){this.filterInfo.push(newFilterInfo)},_removeFilter:function(idx){this._isIndexValid(idx)&&this.filterInfo.splice(idx,1)},_updateFilter:function(idx,updateFilterInfo){this._isIndexValid(idx)&&this.filterInfo.splice(idx,1,updateFilterInfo)},_onCancelEdit:function(){this.$$editSection.empty(),this.$$listSection.toggle(!0)},_openFilterEdit:function(filterIdx){this.filterEdit=this.filterEdit||new FilterEdit(this),this._isIndexValid(filterIdx)&&this.filterEdit.setInitData(this.filterInfo[filterIdx],filterIdx),this.filterEdit.create(this.$$editSection),this.toggleList(!1)},_isIndexValid:function(idx){return!isNaN(parseInt(idx,10))&&idx>=0},notifyClosePanel:function(){Base.prototype.notifyClosePanel.call(this),this.$$items&&(this.$$items.remove(),this.$$items=null),this.filterInfo=null},onFilterUpdate:function(filterInfo,filterIdx){this._isIndexValid(filterIdx)?this._updateFilter(filterIdx,filterInfo):this._addFilter(filterInfo),this.updateFilterList(),this.toggleList(!0)},toggleList:function(show){this.$$listSection.toggle(show),this.filterEdit&&this.filterEdit.$$content.toggle(!show)}})}),define("syracuse-tablet/html/js/controls/panels/sortfilter/tabMemo",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/controls/panels/sortfilter/tabBase","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),Base=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabBase").TabBase,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modules=require("syracuse-tablet/html/js/common/modules"),_templates={main:'		<div id="memotabroot" class="s-m-scroll-wrapper" style="height:100%">			<div  class="s-m-scroll-elmt">				<ul class="list-group"/>			</div>		</div>',items:'		{{#each items}}			<li class="list-group-item" data-params="{{@index}}">				<span class="s-m-memo-info"><a draggable="false" href="#" data-params="click">{{title}}</a>				<div style="display:none" class="s-m-value edit"><input class="s-m-meta form-control" type="text" value="{{title}}"></div>				</span>				<span class="s-m-memo '+fontUtils.filterIcon("edit")+'" data-params="edit"></span>				<span class="s-m-memo '+fontUtils.filterIcon("delete")+'" data-params="delete"></span>			</li>		{{/each}}'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)};exports.TabMemo=utils.defineClass(function TabMemo(panel,id,options){options=options||{},options.hidden=!1,Base.call(this,panel,id,options),this.currentSelection=null;var prefs=this.panel.getPagePrefs();this.favorites=prefs.favorites||[]},Base,{destroy:function(){Base.prototype.destroy.call(this),this.$$edit=null,this.$$display=null,this.currentSelection=null},buildHtml:function(){this.$$content.append($(_getHtml("main",{}))),this.$$list=this.$$content.find("ul.list-group"),this.$$list.css({height:"auto",position:"relative"}),this.$$list.on("blur","input",jsutils.bindFn(this.onBlur,this))},notifyClosePanel:function(){Base.prototype.notifyClosePanel.call(this),this.$$items&&(this.$$items.remove(),this.$$items=null),this.currentSelection=null},doTabShow:function(){Base.prototype.doTabShow.call(this),this._render(),this._setButtonsState()},_setButtonsState:function(){this.panel.setButtonsState(!1,this.currentSelection!=null)},_render:function(){this.$$items&&this.$$items.remove(),this.$$items=$(_getHtml("items",{items:this.favorites})),this.$$list.append(this.$$items),this.currentSelection!=null&&this._selectCurrent(this.currentSelection),this.updateGesture()},doContentAction:function(evt,$$target,dataParams){if(!dataParams)return;switch(dataParams){case"delete":var idx=$$target.closest("li").index();this._onMemoDelete(idx);break;case"edit":this._openMemoEdit($$target.closest("li"));break;case"click":var idx=$$target.closest("li").index();this._onMemoClick(idx);break;default:return}},_onMemoDelete:function(idx){var self=this;self._unSelectCurrent(),self.favorites.splice(idx,1),self.saveFavorites().then(function(){self._render()})},_openMemoEdit:function(li){this.$$edit=$(li).find(".s-m-value.edit"),this.$$display=$(li).find("a"),this._setEditMode()},_onMemoClick:function(idx){idx!=this.currentSelection&&this._unSelectCurrent(),this._selectCurrent(idx)},_unSelectCurrent:function(){this.$$list.find(".selected").toggleClass("selected"),this.currentSelection=null,this._setButtonsState()},_selectCurrent:function(idx){this.currentSelection=idx,this.$$list.find("[data-params='"+this.currentSelection+"']").toggleClass("selected"),this._setButtonsState();if(this.currentSelection!==null){var fav=this.favorites[this.currentSelection];fav&&this.panel.favoriteChange(fav)}},onBlur:function(){var self=this;self._updateValue().then(function(){self._setDisplayMode()})},_setDisplayMode:function(){this.$$edit.toggle(!1),this.$$display.toggle(!0),this.$$edit=null,this.$$display=null},_setEditMode:function(){this._unSelectCurrent(),this.$$edit.toggle(!0),this.$$display.toggle(!1),this.$$edit.children().focus(),this.$$edit.children().select()},_updateValue:function(){var idx=this.$$display.closest("li").index(),value=this.$$edit.children().val();return this.$$display.text(value),this.favorites[idx].title=value,this.saveFavorites().then(function(){return!0})},doActionApply:function(){if(this.currentSelection!==null){var fav=this.favorites[this.currentSelection];return fav&&(this.panel.sortInfoSet($.extend(!0,[],fav.sort),!1),this.panel.filterInfoSet($.extend(!0,[],fav.filter),!0)),this.panel.savePagePrefs().then(function(){return!0}).fail(function(error){modules.get("modal").error(error)})}return $.smResolve(!0)},addFavorite:function(favData){if(!favData)return $.smResolve();this.favorites.push(favData);var self=this;return this.saveFavorites().then(function(){self._render();var notify={severityClass:"success",title:favData.title,body:locale.text("panels.array.memo.created"),onlyWebapp:!0};modules.get("modal").notify(notify)})},saveFavorites:function(){var prefs=this.panel.getPagePrefs();return prefs.favorites=this.favorites,prefs.isDirty=!0,this.panel.savePagePrefs().then(function(){return!0})}})}),define("syracuse-tablet/html/js/controls/panels/sortfilter/panelFilterSort",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/aside/panelAsideBase","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/controls/panels/sortfilter/tabSort","syracuse-tablet/html/js/controls/panels/sortfilter/tabFilter","syracuse-tablet/html/js/controls/panels/sortfilter/tabMemo"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideBase").PanelAsideBase,locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),_Sort=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabSort").TabSort,_Filter=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabFilter").TabFilter,_Memo=require("syracuse-tablet/html/js/controls/panels/sortfilter/tabMemo").TabMemo,_templates={main:'			<div class="header">				<buttons class="pull-left">					<button type="button" class="btn btn-default fa fa-arrow-left" data-controller-id="{{controllerId}}" data-control-id="{{ctrlId}}" data-nevent="" data-naction="cancel" />				</buttons>				<buttons class="pull-right">					<button type="button" class="btn btn-default '+fontUtils.sortFilterTab("memo")+'" data-controller-id="{{controllerId}}" data-control-id="{{ctrlId}}" data-nevent="" data-naction="memo"/>					<button type="button" class="btn btn-default '+fontUtils.sortFilterTab("apply")+'" data-controller-id="{{controllerId}}" data-control-id="{{ctrlId}}" data-nevent="" data-naction="apply"/>				</buttons>				<div class="modal-title">{{title}}</div>			</div>			<ul class="nav nav-pills" role="tablist"> 				{{#each tabs}}					<li><a href="#{{id}}" class="" role="tab" data-toggle="tab">{{title}}</a></li> 				{{/each}}			</ul> 			<div class="tab-content">				{{#each tabs}}					<div id="{{id}}" role="tabpanel" class="tab-pane {{type}}">					</div>				{{/each}}			</div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl(ctx)},_tabDescr=[{klass:_Sort,options:{name:"sort",isActive:!0,singleCriteria:!0}},{klass:_Filter,options:{name:"filter",isActive:!1}},{klass:_Memo,options:{name:"memo",isActive:!1}}];exports.PanelFilterSort=utils.defineClass(function PanelFilterSort(controller,$type,article,options){options=options||{},options.noCloseOnClick=!0,options.noMainScroller=!0,options.enableGesture=!1,this._tabs={},Base.call(this,controller,$type,article,options)},Base,{destroy:function(){this.$$elmt.closest("aside").removeClass("sortfilter"),Base.prototype.destroy.call(this),this.$$panel=null,this._activeTab=null;var self=this;notifications.unsubscribe(self,["sm.click.icon.filterSort"]),this._tabs&&($.each(this._tabs,function(key,value){value.destroy()}),this._tabs=null),this.$$btnBar&&(this.$$btnBar.unbind(),this.$$btnBar.remove(),this.$$btnBar=null),this.parentArray=null},buildHtml:function(side){var self=this;notifications.subscribe(self,["sm.click.icon.filterSort"]),Base.prototype.buildHtml.call(this,side),self.$$elmt.addClass(self.typeName),self.$$panel&&self.$$panel.remove();var ctx={title:locale.text("panels.array.title"),ctrlId:self.id,controllerId:self.controller.id,side:side,apply:locale.text("panels.array.apply"),close:locale.text("panels.array.close"),tabs:[]},descriptions=[];_tabDescr.forEach(function(descr){descr=$.extend({},descr),descr.options.hidden=self.options[descr.options.name]===!1,descriptions.push(descr)});var ids={};descriptions.forEach(function(descr){ids[descr.options.name]=utils.readableuid("array"+descr.options.name),ctx.tabs.push({id:ids[descr.options.name],icon:fontUtils.sortFilterTab(descr.options.name),type:descr.options.name,buttons:descr.options.buttons,title:locale.text("panels.array."+descr.options.name)})}),self.$$panel=$(_getHtml("main",ctx));if(self.$$panel&&self.$$panel.length){self.$$panelContent.append(self.$$panel);var visibleTabs=[],activeIdx=-1;descriptions.forEach(function(descr,idx){var t=new descr.klass(self,ids[descr.options.name],descr.options);descr.options.hidden?t.hide():(visibleTabs.push(t),descr.options.isActive&&(activeIdx=idx)),self._tabs[descr.options.name]=t}),visibleTabs.length>0?(this._activeTab=visibleTabs[activeIdx===-1?0:activeIdx],self.$$btnBar=self.$$panelContent.find(".nav-header>.btn-group.header-btn")):this.close()}},notifyToggled:function(visible){$.each(this._tabs,function(id,tab){tab[visible?"notifyOpenPanel":"notifyClosePanel"]()}),visible&&this._activeTab&&this._activeTab.triggerActivate()},onResize:function(context){Base.prototype.onResize.call(this,context);if(this.destoyed||!this._tabs)return;$.each(this._tabs,function(id,tab){tab.onResize(context)})},computeLayout:function(layoutInfo){if(!this.$$container)return;if(this.destoyed||!this._tabs)return;$.each(this._tabs,function(id,tab){tab.onResize()})},applyTabSettings:function(){var self=this;if(!this._activeTab)return;this._activeTab.doActionApply().then(function(close){close&&self.hide()})},addFavorite:function(){if(!this._activeTab)return;var favData=null;$.each(this._tabs,function(key,tab){tab.getFavoritesData&&(favData=favData||{},favData[key]=tab.getFavoritesData())});if(favData){favData.title=locale.text("panels.array.memo")+" "+utils.getCurISODateTime();var memoTab=this._tabs.memo;memoTab.addFavorite(favData)}},notifyActiveTab:function(tab){this._activeTab=tab,this.setButtonsState(!0,!0)},getTabs:function(){return this._tabs},notifClickIconFilterSort:function(context){context&&context.className&&(context.className.indexOf("sorted")>=0?this.getTabs().sort.triggerActivate():context.className.indexOf("filtered")>=0&&this.getTabs().filter.triggerActivate())},setButtonsState:function(memo,apply){this.$$btnBar.find("[data-params='memo']").toggleClass("disabled",!memo),this.$$btnBar.find("[data-params='apply']").toggleClass("disabled",!apply)},getPagePrefs:function(){return this.parentArray.page.getPageSettings()},savePagePrefs:function(){return this.parentArray.page.writePageSettings().then(function(){return!0})},show:function(){this.$$elmt||this.buildHtml("right"),this.$$elmt.closest("aside").addClass("sortfilter"),this._makeVisible(),this.notifyToggled(!0)},hide:function(){this.$$elmt.closest("aside").removeClass("sortfilter"),this._makeInvisible(),this.notifyToggled(!1)},ensureParentArray:function(parentArrayId){this.parentArray=this.controller.getControl(parentArrayId)},filterInfoGet:function(){return this.parentArray.filterSort.filterInfoGet()},filterInfoSet:function(info,refresh){this.parentArray.filterSort.filterInfoSet(info,refresh)},filterMapGet:function(){return this.parentArray.filterSort.filterMapGet()},sortInfoGet:function(){return this.parentArray.filterSort.sortInfoGet()},sortInfoSet:function(info,refresh){this.parentArray.filterSort.sortInfoSet(info,refresh)},favoriteChange:function(favorite){this._tabs.filter.filterInfo=$.extend(!0,[],favorite.filter),this._tabs.sort.sortInfo=$.extend(!0,[],favorite.sort)},_actCancel:function(){this.hide()},_actApply:function(){this.applyTabSettings()},_actMemo:function(){this.addFavorite()}})}),define("syracuse-tablet/html/js/controls/panels/toolBars/chartDetailToolBar",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/controls/ctrlBase","syracuse-tablet/html/js/ui/uiSettings"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),prototype=require("syracuse-tablet/html/js/sdata/prototype"),Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase,uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),_actions=[{params:"arrayOnly",icon:"fa fa-table",enabled:!0,selected:""},{params:"chartOnly",icon:"fa fa-bar-chart",enabled:!0,selected:""},{params:"bothSideToSide",icon:"fa fa-columns",enabled:!0,selected:""}],_chartStyle=[{params:"column",icon:"fa fa-bar-chart",enabled:!0,selected:""},{params:"bar",icon:"fa fa-bar-chart fa-rotate-90",enabled:!0,selected:""},{params:"area",icon:"fa fa-area-chart",enabled:!0,selected:""},{params:"line",icon:"fa fa-line-chart",enabled:!0,selected:""},{params:"pie",icon:"fa fa-pie-chart",enabled:!0,selected:""}],_templates={toolbar:'		<div class="btn-toolbar" role="toolbar">			<div class="btn-group">				{{#each actions}}					{{#if enabled}}					<button type="button" class="btn btn-default {{selected}}" data-nevent data-naction="toolbar" data-params="{{params}}"><span class="{{icon}}"></span></button>					{{/if}}				{{/each}}		    </div>			<div class="btn-group chartstyles">				{{#each chartStyle}}					{{#if enabled}}					<button type="button" class="btn btn-default {{selected}}" data-nevent data-naction="chartstyle" data-params="{{params}}"><span class="{{icon}}"></span></button>					{{/if}}				{{/each}}		    </div>	    </div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.ChartDetailToolBar=utils.defineClass(function(controller,$type,article,options){Base.call(this,controller,$type,article,options)},Base,{buildHtml:function(){this._height=this.getDesiredHeight();var measureCount=this._getChartMeasureCount(),chartSettings=this.controller.uiAdapter.getChartDetailSetting()||{},articles=this.controller.uiAdapter.getArticles(this.controller.uiAdapter.getArticle()),showActionBar=articles.arrayChartArticle&&articles.arrayArticle,showStyleBar=articles.arrayChartArticle!=undefined;_chartStyle.forEach(function(itm){itm.enabled=showStyleBar,itm.selected="",itm.params=="pie"&&(itm.enabled=measureCount==1),chartSettings.display==="arrayOnly"&&(itm.enabled=!1),itm.params===chartSettings.style&&(itm.selected="s-m-selected")}),_actions.forEach(function(itm){itm.enabled=showActionBar,itm.selected="",itm.params===chartSettings.display&&(itm.selected="s-m-selected")}),this.createRootElement(["s-m-panel","s-m-control","s-m-ctrl","toolbar"]),this.$$elmt.append($(_getHtml("toolbar",{ctrlId:this.id,actions:_actions,chartStyle:_chartStyle}))),this.$$container.show()},computeLayout:function(layoutInfo){if(!this.$$container)return;this.$$container.css({top:this.top+"px",width:layoutInfo.application.width+"px",height:this._height})},_getChartMeasureCount:function(){var chart=this.controller.getChart();if(!chart)return 0;var count=chart.prototype.chartGetNbMeasures(),$seriesOptions=chart.article.$seriesOptions;return $seriesOptions?(Object.keys($seriesOptions).forEach(function(key){$seriesOptions[key].isHidden&&count--}),count):count},getDesiredHeight:function(){return uiSettings.getProp("chartDetailToolbar.height")},getHeight:function(){return this.$$elmt.is(":visible")?this._height:0},setTop:function(top){this.top=top},_actToolbar:function(display){if($(".btn[data-params='"+display+"']",this.$$elmt).is(".s-m-selected"))return;this.controller.actChartToolbarSetDisplay({display:display})},_actChartstyle:function(chartType){if($(".btn[data-params='"+chartType+"']",this.$$elmt).is(".s-m-selected"))return;this.controller.actChartToolbarSetDisplay({style:chartType})}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAsideBase","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideBase").PanelAsideBase,utils=require("syracuse-tablet/html/js/helpers/utils"),_html={header:'			<div class="header">			<buttons class="pull-left"> 				<button type="button" class="btn btn-default fa fa-arrow-left" data-control-id="{{ctrlId}}" data-nevent data-naction="cancel"></button> 			</buttons> 			<div class="modal-title">{{title}}</div> 			</div>			'},_templates={};exports.PanelAsideDialog=utils.defineClass(function PanelAsideDialog(controller,type,article,options){options.noCloseOnClick=!0,Base.call(this,controller,type,article,options)},Base,{destroy:function(){this.$$elmt.closest("aside").removeClass("dialogpanel"),Base.prototype.destroy.call(this),this._$$header=null},buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$elmt.addClass("s-m-dialogPanel"),this._$$header&&this._$$header.remove();var ctx={side:this.attachedSide,ctrlId:this.id,title:this.options.title||"  "};this._$$header=this._buildHeader(ctx),this._$$header&&this._$$header.length>0&&this.$$elmt.prepend(this._$$header)},_buildHeader:function(ctx){return $(_getHtml("header",ctx))},_actCancel:function(){this.hide()},_makeVisible:function(){this.$$elmt.closest("aside").addClass("dialogpanel"),this._updateGesture(),Base.prototype._makeVisible.call(this)},_makeInvisible:function(){Base.prototype._makeInvisible.call(this),this.$$elmt.closest("aside").removeClass("dialogpanel")}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelShare",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/ui/datetimeSelectors/selectorFactory","syracuse-tablet/html/js/authoring/authoringPropertiesGeneral","syracuse-tablet/html/js/authoring/authoringComponents","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/helpers/sharedContext","syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog"],function(require,exports,module){function _getShareDeepLink(page){return sharedContext.getNavContextUrlByPage(page).then(function(url){var link={Title:page.getPageTitle(),Url:url};return link})}function _getTileDeepLink(page){var link={Title:page.getPageTitle(),Url:page.pageData.$url};return $.smResolve(link)}function _getDateTimeInfo(date,time){if(!date)return null;date=date.split("-");if(date.length!==3)return null;var res={};return res.year=date[0],res.month=date[1],res.day=date[2],time=time?time.split(":"):[],time.length==3&&(res.hours=time[0],res.minutes=time[1],res.seconds=time[2]),res}function _getUser(){var up=modules.get("appController").App.getCurrentUserProfile();return up.user.login}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),selectorFactory=require("syracuse-tablet/html/js/ui/datetimeSelectors/selectorFactory"),authPropsGeneral=require("syracuse-tablet/html/js/authoring/authoringPropertiesGeneral"),authComponents=require("syracuse-tablet/html/js/authoring/authoringComponents"),modules=require("syracuse-tablet/html/js/common/modules"),native=require("syracuse-tablet/html/js/helpers/native/native"),sharedContext=require("syracuse-tablet/html/js/helpers/sharedContext"),Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog").PanelAsideDialog,_templates={share:'	<div class="modal-subtitle" >{{share.title}}</div> 	<div class="btn-group btn-group-justified" role="group">		<a type="button" href="#" class="btn btn-default" data-control-id="{{ctrlId}}" data-nevent data-naction="sharePageLink">			<i class="{{share.icon}}"/>		<span>{{{share.label}}}</span>		</a>	</div>',scheduleMessage:'	<div class="modal-subtitle">{{scheduleMessage.title}}</div> 	<div class=""> 		<div class="form-group"> 			<table class="s-m-schedulemsg">			{{#each scheduleMessage.items}}			<tr>			<td>{{this.label}}</td>			<td>			{{#if this.picker }}				<div  class="input-group">					<input type="text" readonly="true" class="form-control" size="{{this.size}}" id="{{this.id}}" value="">					<span class="input-group-btn">						<button data-control-id="{{../../ctrlId}}" data-nevent data-naction="{{this.dataAction}}" data-params="{{this.id}} "class="btn btn-default">						<span class="{{this.icon}}"></span>					<span>				<div>			{{else}}				<input type="text"  				{{#if this.mandatory}}					mandatory="mandatory"				{{/if}}				class="form-control" size="{{this.size}}" id="{{this.id}}" value="">			{{/if}}			</td>			</tr>			{{/each}}			</table> 			<div class="btn-group btn-group-justified" role="group">				<a type="button" class="btn btn-default"  data-nevent data-naction="scheduleMessage" data-control-id="{{ctrlId}}">{{scheduleMessage.btnApply}}</a>			</div>		</div> 	</div>',liveTile:'		<div class="modal-subtitle">{{liveTile.title}}</div> 		<div class=""> 			<div class="form-group"> 				<table class="s-m-livetile">				{{#each liveTile.items}}				{{#unless this.disabled}}				<tr>				{{#if this.picker }}					<td>{{this.label}}</td>					<td>					<div  class="input-group" id="{{this.id}}" style="width:100%">					<div>					</td>				{{else}}					{{#if this.select}}						<td>{{this.label}}</td>						<td>						<select class="form-control" id="{{this.id}}" data-nevent data-naction="{{this.dataAction}}" data-control-id="{{../ctrlId}}">							{{#each pages}}								<option value="{{this.id}}">{{this.title}}</option>							{{/each}}						</select>						</td>					{{else}}						<td>{{this.label}}</td>						<td>						<input type="text"  							{{#if this.mandatory}}							mandatory="mandatory"							{{/if}}							class="form-control" size="{{this.size}}" id="{{this.id}}" value="">						</td>					{{/if}}				{{/if}}				</tr> 				{{/unless}}				{{/each}}				</table> 				<div class="btn-group btn-group-justified" role="group">					<a type="button" class="btn btn-default"  data-nevent data-naction="liveTileCreate" data-control-id="{{ctrlId}}">{{liveTile.btnApply}}</a>				</div>			</div> 		</div>'},_blocks=["liveTile","scheduleMessage","share"],_liveTile=[{disabled:!1,id:"vignette",select:!0,dataAction:"choice",mandatory:!0,size:30},{disabled:!1,id:"backgroundColor",size:10,picker:!0,component:"colorPalettePicker"},{disabled:!1,id:"description",type:"application/x-string",defaultValue:"",size:50,mandatory:!0}],_scheduleMsgItems=[{id:"date",size:10,type:"application/x-date",icon:fontUtils.getIconByName("datePicker"),picker:!0,dataAction:"datePicker",mandatory:!0},{id:"time",size:10,type:"application/x-time",icon:fontUtils.getIconByName("timePicker"),picker:!0,dataAction:"timePicker",mandatory:!0},{id:"description",size:50,type:"application/x-string",mandatory:!0}],_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.PanelShare=utils.defineClass(function PanelShare(controller,$type,article,options){options.title=locale.text("share.panel.title"),Base.call(this,controller,$type,article,options),this.initPublishOptions()},Base,{destroy:function(){Base.prototype.destroy.call(this)},initPublishOptions:function(){var self=this,navStack=modules.get("navStack").getMainStack(),currentPage=navStack&&navStack.getTopPage();this._htmlContext={ctrlId:this.id},this._publishOptions=currentPage.getPublishOptions(),_blocks.forEach(function(block){self._publishOptions[block]&&self["_"+block]()})},_liveTile:function(){var ctx;_liveTile.forEach(function(item){item.label=locale.text("liveTile."+item.id+".label")}),ctx={title:locale.text("liveTile.page.subtitle"),btnApply:locale.text("liveTile.apply.label"),items:_liveTile},_liveTile[0].pages=[],this._publishOptions.liveTile.pages.forEach(function(page){_liveTile[0].pages.push({id:page.id,title:page.getPageTitle()})}),this._htmlContext.liveTile=ctx},_scheduleMessage:function(){var ctx;_scheduleMsgItems.forEach(function(item){item.label=locale.text("schedule.message."+item.id+".label")}),ctx={title:locale.text("schedule.message.page.subtitle"),btnApply:locale.text("schedule.message.apply.label"),items:_scheduleMsgItems},this._htmlContext.scheduleMessage=ctx},_share:function(){var ctx={title:locale.text("share.page.subtitle"),icon:fontUtils.panelActionIcon("nativeShare"),label:locale.text("action.nativeShare")};this._htmlContext.share=ctx},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(this),this.$$elmt.addClass(this.typeName),_blocks.forEach(function(block){if(self._htmlContext[block]){var html=_getHtml(block,self._htmlContext);self.$$panelContent.append($(html))}}),_liveTile.forEach(function(item){if(item.component){self.components=self.components||{};var $$item=self.$$panelContent.find(".s-m-livetile #"+item.id),opts={};switch(item.component){case"colorPalettePicker":opts={id:item.id,palette:authPropsGeneral.getColorPalette(),dropUp:!1,onSelectColor:jsutils.bindFn(self._colorChange,self)}}self.components[item.id]=authComponents.newComponent(item.component,opts),self.components[item.id].createMarkup($$item)}}),this._publishOptions.liveTile&&(this._actChoice(this._publishOptions.liveTile.pages[0].id),this._publishOptions.liveTile.pages.length<2&&this.$$panelContent.find(".s-m-livetile #vignette").parent().parent().hide()),this.$$panelContent.on("input","[mandatory]",jsutils.bindFn(this._setButtonsStat,this)),this._setButtonsStat();return},_colorChange:function(value){this._backgroundColor=value?value.hex:null},_setButtonsStat:function(){var self=this,btnCreate=self.$$elmt.find("a[data-naction='liveTileCreate']"),disable=!1,val="";_liveTile.forEach(function(item){!item.disabled&&item.mandatory&&(disable=disable||self.$$panelContent.find(".s-m-livetile #"+item.id).val()=="")}),disable?btnCreate.attr("disabled","disabled"):btnCreate.removeAttr("disabled"),btnCreate=self.$$elmt.find("a[data-naction='scheduleMessage']"),disable=!1,val="",_scheduleMsgItems.forEach(function(item){!item.disabled&&item.mandatory&&(disable=disable||self.$$panelContent.find(".s-m-schedulemsg #"+item.id).val()=="")}),disable?btnCreate.attr("disabled","disabled"):btnCreate.removeAttr("disabled")},onValueChange:function(){this._setButtonsStat()},_getItemLiveTile:function(id){var found;return _liveTile.some(function(item){if(item.id===id)return found=item,!0}),found},_actChoice:function(id){var btnCreate=this.$$elmt.find("a[data-naction='liveTileCreate']"),value=this.$$elmt.find(".s-m-livetile #vignette").val(),itemDescription=this._getItemLiveTile("description");itemDescription&&!itemDescription.disabled&&itemDescription.defaultValue!==undefined&&this.$$elmt.find(".s-m-livetile #description").val(value?this.$$elmt.find(".s-m-livetile #vignette option:selected").text():""),this._setButtonsStat()},_actDatePicker:function(id){selectorFactory.createSelector(new _Field("application/x-date",this.$$panelContent.find(".s-m-schedulemsg #"+id),locale.text("schedule.message."+id+".label"),this))},_actTimePicker:function(id){selectorFactory.createSelector(new _Field("application/x-time",this.$$panelContent.find(".s-m-schedulemsg #"+id),locale.text("schedule.message."+id+".label"),this))},_actSharePageLink:function(){var self=this;_getShareDeepLink(self.page).then(function(deepLink){var opts={pageData:{Title:deepLink.Title,DeepLink:deepLink}},cap=native.getModule("share");if(cap)return cap.sharePageLink(opts)}).then(function(){this._makeInvisible()})},_actScheduleMessage:function(){var self=this,schedule={},msg;_scheduleMsgItems.forEach(function(item){var val=self.$$panelContent.find(".s-m-schedulemsg #"+item.id).attr("isoValue");val&&(schedule[item.id]=schedule[item.id]||{},schedule[item.id].$type=item.$type,schedule[item.id].value=val)});var desc=self.$$panelContent.find(".s-m-schedulemsg #description").val();_getShareDeepLink(self.page).then(function(deepLink){schedule.date&&schedule.time&&(msg={Severity:"reminder",Text1:deepLink.Title,Text2:desc,ScheduleTime:schedule.date.value+" "+schedule.time.value,ScheduleTimeJSON:_getDateTimeInfo(schedule.date.value,schedule.time.value),DeepLink:deepLink});var cap=native.getModule("scheduleMessage");if(cap&&msg)return cap.scheduledMsg(msg)}).fail(function(){modules.get("modal").notify({body:locale.text("liveTile.page.add.notok"),severityClass:"error"})}).then(function(){modules.get("modal").notify({body:locale.text("liveTile.page.add.ok"),severityClass:"success"})}).then(function(){self._makeInvisible()})},_actLiveTileCreate:function(){var self=this,tile={title:self.$$panelContent.find(".s-m-livetile #description").val(),userLogin:_getUser()};self._backgroundColor&&(tile.backgroundColor=self._backgroundColor);var pageId=self.$$panelContent.find(".s-m-livetile #vignette").val();_getTileDeepLink(self.page).then(function(deepLink){self._publishOptions.liveTile.pages.forEach(function(page){""+page.id==""+pageId&&(tile.sDataUrl=page.pageData.$url,tile.id=tile.sDataUrl,tile.DeepLink=deepLink)});var cap=native.getModule("liveTile");if(cap)return cap.addLiveTile(tile)}).fail(function(){modules.get("modal").notify({body:locale.text("liveTile.page.add.notok"),severityClass:"error"})}).then(function(){modules.get("modal").notify({body:locale.text("liveTile.page.add.ok"),severityClass:"success"})}).then(function(){self._makeInvisible()})}});var _Field=utils.defineClass(function(type,item,title,panel){this.$type=type,this.$title=title,this.$$item=item,this.panel=panel},null,{setFieldValueFromSelector:function(value){this.$$item.attr("isoValue",value),this.$$item.val(this._getFormattedValue(value)),this.panel.onValueChange&&this.panel.onValueChange(),this.destroy()},_getFormattedValue:function(value){var formatter=formatApi.getFormatter(this.$type);return formatter.formatValue(value,!1)},getValue:function(){return this.$$item.attr("isoValue")},getTitle:function(){return this.$title},destroy:function(){this.$$item=this.panel=null}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelEditTemplates",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){function _getEndPoint(){return modules.get("appController").App.getDefaultEndpoint()}function _readTemplates(sdataPage,filter){var storage=modules.get("storage").getStorage();return storage.templateOperation("count").then(function(totalCount){var queryRep=filter==="all"?null:sdataPage.getRepresentation(),queryEp=filter==="all"?null:_getEndPoint();return storage.templateOperation("query",queryRep,queryEp,!0).then(function(templates){return $.smResolve(totalCount,templates||[])})})}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),modules=require("syracuse-tablet/html/js/common/modules"),Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog").PanelAsideDialog,notifications=require("syracuse-tablet/html/js/helpers/notifications"),CREATE_BTN="tmpl-panel-create-btn",CREATE_BTN_ADDON="tmpl-panel-create-btn-clear-addon",ITEM_TTL="s-m-tmpl-itm-ttl",ITEM_INFO="s-m-tmpl-itm-info",ITEM_TABLE="s-m-tmpl-itm",ITEM_ACT="s-m-tmpl-itm-act",LST_WRAP="s-m-list-wrapper",LST_SCROLL="s-m-scroll-elmt",ITEM_INPUT_TTL="tmpl-panel-item-input-ttl",ITEM_INPUT_TTL_ADDON="tmpl-panel-item-input-ttl-addon",FILTER_MENU="tmpl-panel-filter",_txt=function(id){return locale.text("edit.templates.dlog."+id)},_templates={error:'<section class="draft-error"><h1>{{error}}<h1><h2>{{contact}}<h2></section>',main:'		<article style="height:100%">			<section class="s-m-memo create">				<header>					<span>{{createSection}}</span>		 		</header>				<div class="panel-body">					<table style="width:100%"><tr>						<td class="s-m-input-label"><span style="padding-right:10px;">{{name}}</span></td>						<td>							<div class="input-group {{#if smartphone}}input-group-sm{{/if}}">								<input id="{{CREATE_BTN}}" data-nevent-ctrl-input class="form-control" aria-describedby="create-clear-addon" type="text"/>								<span  data-nevent data-naction="clearname" data-control-id="{{ctrlId}}" class="input-group-addon" id="{{CREATE_BTN_ADDON}}">X</span>							</div>						</td>						<td>							<span class="btn btn-default disabled" data-nevent data-naction="create" data-control-id="{{ctrlId}}">								<i class="{{createicn}}"></i>								<span>{{create}}</span>							</span>						</td>					</tr></table>				</div>			</section>			<section class="s-m-memo avail">				<header>					<span>{{availSection}}</span>				</header>				<div class="panel-body s-m-filter">					<table style="width:100%;">					<tr>					<td class="s-m-input-label"><span>{{label_endpoint}}</span></td>					<td class="s-m-filter-container"></td>					</tr>					</table>				</div>				<div class="{{LST_WRAP}}">					<ul class="list-group {{LST_SCROLL}}">					</ul>				</div>			</section>		</article>',items:'		{{#each items}}			<li class="list-group-item" data-params="{{tmplId}}">				<table class="{{../ITEM_TABLE}}"><tr>					<td>						<div class="{{../ITEM_TTL}}" data-nevent data-naction="changeItemTitle" data-control-id="{{../ctrlId}}">{{title}}</div>						<div class="{{../ITEM_INFO}}"style="overflow: hidden">							<span>{{date}}</span>							<span>{{representation}}</span>						</div>					</td>					<td>						<table class="{{../ITEM_ACT}}">							<tr>								<td style="width:15%">									<span  class="btn btn-default {{#unless applicable}}disabled{{/unless}}" data-nevent data-naction="apply" data-control-id="{{../ctrlId}}">										<i class="{{../applyicn}}"></i>										<span>{{../apply}}</span>									</span>								</td>								<td>									<span  class="btn btn-default {{#unless applicable}}disabled{{/unless}}" data-nevent data-naction="update" data-control-id="{{../ctrlId}}">										<i class="{{../updateicn}}"></i>									</span>								</td>								<td>									<span  class="btn btn-default" data-nevent data-naction="delete" data-control-id="{{../ctrlId}}">										<i class="{{../deleteicn}}"></i>									</span>								</td>							</tr>						</table>					</td>				</tr></table>			</li>		{{/each}}',noitems:'		<div class="s-m-noitem"><b>{{text}}</b></div>		',changeItemTitle:'		<div >			<div class="input-group {{#if smartphone}}input-group-sm{{/if}}">				<input id="{{ITEM_INPUT_TTL}}" style="font-weight:bold;" data-nevent-ctrl-input class="form-control" type="text" aria-describedby="{{ITEM_INPUT_TTL_ADDON}}" >				<span data-nevent data-naction="saveItemTitle" data-control-id="{{ctrlId}}" class="btn input-group-addon" id="{{ITEM_INPUT_TTL_ADDON}}" style="background-color:inherit">					<i class="{{icon}}"/>				</span>			</div>		</div>',filtersMenu:'		<select id="{{FILTER_MENU}}" data-naction="filter" data-control-id="{{ctrlId}}">			{{#each filterOptions}}				<option value="{{value}}" {{#if selected}}selected{{/if}}>{{title}}</option>			{{/each}}		<select>		'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.PanelEditTemplates=utils.defineClass(function PanelEditTemplates(controller,$type,article,options){options.title=_txt("title"),options.noMainScroller=!0,Base.call(this,controller,$type,article,options),this.dateFormatter=formatApi.getFormatter("application/x-datetime"),this._initLabels()},Base,{destroy:function(){Base.prototype.destroy.call(this),this.dateFormatter=null},_initLabels:function(){this._selectedFilter="current",this._filterOptions=[{value:"current",title:_txt("currendpoint")},{value:"all",title:_txt("allendpoint")}]},getRepresentation:function(){return this.page.getRepresentation()},buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$content&&this.$$content.remove(),this.$$content=this._buildContent().appendTo(this.$$panelContent),this.$$list=this.$$content.find(".s-m-memo.avail ul")},_buildContent:function(){var context={createSection:_txt("createSection"),availSection:_txt("availSection"),name:_txt("name"),label_endpoint:_txt("label.endpoint"),create:_txt("create"),createicn:fontUtils.getIconByName("$apply"),ctrlId:this.id,CREATE_BTN:CREATE_BTN,CREATE_BTN_ADDON:CREATE_BTN_ADDON,LST_WRAP:LST_WRAP,LST_SCROLL:LST_SCROLL,smartphone:modules.get("siteLayout").getDeviceType()==="smartphone"};return $(_getHtml("main",context))},onClickPanel:function(event){this._$$changeItemTitle&&this._$$changeItemTitle.is(":visible")&&(this.$$content.find("."+ITEM_TTL).show(),this._$$changeItemTitle.detach())},getStorage:function(){return this._storage||(this._storage=modules.get("storage").getStorage()),this._storage},_buildItems:function(){this.$$list.off().empty();var context={ctrlId:this.id,updateicn:fontUtils.getIconByName("$refresh"),deleteicn:fontUtils.getIconByName("$delete"),applyicn:fontUtils.getIconByName("$apply"),apply:_txt("apply"),ITEM_TTL:ITEM_TTL,ITEM_INFO:ITEM_INFO,ITEM_TABLE:ITEM_TABLE,ITEM_ACT:ITEM_ACT,items:[]},self=this;_readTemplates(this.page,this._selectedFilter).then(function(totalCount,templates){templates.sort(function(a,b){return b.endpoint===a.endpoint?b.creation_date>a.creation_date:b.endpoint>a.endpoint});if(templates.length>0){var ep=_getEndPoint();templates.forEach(function(tmpl,idx){context.items.push({title:tmpl.title,date:self.dateFormatter.formatValue(tmpl.creation_date),tmplId:tmpl.id,applicable:tmpl.representation===self.getRepresentation(),representation:self._selectedFilter==="all"?tmpl.representation||"":null})}),$(_getHtml("items",context)).appendTo(self.$$list)}else $(_getHtml("noitems",{text:_txt("noitem")})).appendTo(self.$$list);self._$$filter||(self._$$filter=$(self._buildFilterMenu()).appendTo(self.$$content.find(".s-m-memo.avail > .s-m-filter  .s-m-filter-container"))),self._$$filter.val(self._selectedFilter);var filterContainer=$(".edittemplates  .s-m-filter");filterContainer.toggle(self._selectedFilter==="all"||totalCount>templates.length),filterContainer.toggle(templates.length>0),self._updateGesture()}).fail(function(e){modules.get("modal").error(_txt("readallerr"),e,function(){self.$$content.html($(_getHtml("error",{error:locale.text("error"),contact:locale.text("contact.admin")})))})})},_buildFilterMenu:function(){var self=this;self._selectedFilter=self._selectedFilter||"current";var opts=[];return self._filterOptions.forEach(function(item){item=$.extend({},item),item.selected=item.value===self._selectedFilter,opts.push(item)}),_getHtml("filtersMenu",{filterOptions:opts,ctrlId:self.id,FILTER_MENU:FILTER_MENU})},_actFilter:function(){var f=this._$$filter.val();if(f===this._selectedFilter)return;this._selectedFilter=f,this._buildItems()},refresh:function(){this._buildItems(),this._actClearname()},_notify:function(text){var notify={severityClass:"success",body:text,onlyWebapp:!0,delay:"short"};modules.get("modal").notify(notify)},_getTmplId:function(event,propagate){return propagate!==!0&&event.stopPropagation(),$(event.target).closest("li[data-params]").attr("data-params")},_actApply:function(param,event){var self=this,tmplId=self._getTmplId(event);if(!tmplId)return;this.getStorage().templateOperation("read",tmplId).then(function(data){self.hide(),data&&self.page.getDataset().setEditTemplateData(self.page,data.dataSet)}).fail(function(e){modules.get("modal").error("Error deleting template",e)})},_walkCtrls:function(controller,data){controller.forEachControl(function(c){})},_actUpdate:function(param,event){var self=this,tmplId=self._getTmplId(event);if(!tmplId)return;this.getStorage().templateOperation("update",tmplId,{dataSet:self.page.getDataset().getEditTemplateData(self.page.controller)},!1).then(function(){self.hide(),self._notify(_txt("updt.success"))}).fail(function(e){modules.get("modal").error("Error updating template",e)})},_actDelete:function(param,event){var self=this,tmplId=self._getTmplId(event);if(!tmplId)return;this.getStorage().templateOperation("delete",tmplId).then(function(){self.refresh()}).fail(function(e){modules.get("modal").error("Error deleting template",e)})},_actCreate:function(param,event){var ctx={id:utils.UUID(),endpoint:_getEndPoint(),representation:this.getRepresentation(),title:this.$$content.find("#"+CREATE_BTN).val(),dataSet:this.page.getDataset().getEditTemplateData(this.page.controller)},self=this;this.getStorage().templateOperation("save",ctx).then(function(){self.hide(),self._notify("Template has been created successfully")}).fail(function(e){modules.get("modal").error("Error saving template",e)})},_actClearname:function(param,event){this.refreshCreateBtn("")},_actChangeItemTitle:function(param,event){var tmplId=this._getTmplId(event);if(!tmplId)return;this._$$changeItemTitle?$(".s-m-tmpl-itm-ttl",this._$$changeItemTitle.parent()).show():(this._$$changeItemTitle=$(_getHtml("changeItemTitle",{ctrlId:this.id,icon:fontUtils.getIconByName("$refresh"),ITEM_INPUT_TTL:ITEM_INPUT_TTL,ITEM_INPUT_TTL_ADDON:ITEM_INPUT_TTL_ADDON,smartphone:modules.get("siteLayout").getDeviceType()==="smartphone"})),this._$$changeItemTitle.find("span").on("click",jsutils.bindFn(this.onClickSaveItemTitle,this)));var $$target=$(event.target);$$target.before(this._$$changeItemTitle.detach().css({position:"relative",left:""})).hide(),this.refreshSaveItemTitleBtn(this._$$changeItemTitle.find("#"+ITEM_INPUT_TTL).val($$target.text()))},onClickSaveItemTitle:function(event){var self=this,tmplId=self._getTmplId(event,!0);if(!tmplId)return;var $$display=self._$$changeItemTitle.parent().find("."+ITEM_TTL),title=self._$$changeItemTitle.find("#"+ITEM_INPUT_TTL).val();this._$$changeItemTitle.detach();if($$display.text()===title)return;$$display.text(title).show(),this.getStorage().templateOperation("update",tmplId,{title:title},!0).fail(function(e){modules.get("modal").error("Error saving template title",e)})},onMainClick:function(evt){this._$$changeItemTitle&&this._$$changeItemTitle.is(":visible")&&(this.$$content.find("."+ITEM_TTL).show(),this._$$changeItemTitle.detach())},onInput:function(evt){var $$target=$(evt.target);if($$target.is("#"+CREATE_BTN)){this.refreshCreateBtn();return}if($$target.is("#"+ITEM_INPUT_TTL)){this.refreshSaveItemTitleBtn($$target);return}},refreshSaveItemTitleBtn:function($$input){$$input.focus().parent().find("#"+ITEM_INPUT_TTL_ADDON).toggleClass("disabled",$$input.val().trim().length===0)},refreshCreateBtn:function(val){this._$$create||(this._$$create=this.$$content.find('.s-m-memo.create .btn[data-naction="create"]'),this._$$input=this.$$content.find('.s-m-memo.create input[type="text"]')),val!=null&&this._$$input.val(val),this._$$create.toggleClass("disabled",this._$$input.val().trim().length<=0),this._$$input.focus()},show:function(){Base.prototype.show.call(this),this.refresh()},hide:function(){Base.prototype.hide.call(this),this._$$changeItemTitle&&(this._$$changeItemTitle.find("span").off("click"),this._$$changeItemTitle.empty(),this._$$changeItemTitle=null),exports.publishEditTemplateStatus(this.page)}}),exports.publishEditTemplateStatus=function(pageSdata){if(!pageSdata)return;_readTemplates(pageSdata).then(function(totalCount,templates){notifications.publish("sm.edit.templates.changed",templates.length===0)}).fail(function(e){console.log("publishEditTemplateStatus Error"),console.log(JSON.stringify(jsutils.convertToDiagnoses(e),null,2))})}}),define("syracuse-tablet/html/js/controls/panels/aside/panelDashboardTemplate",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/modals/modalConfirm"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideDialog").PanelAsideDialog,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),locale=require("syracuse-tablet/html/js/helpers/locale"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),ModalConfirm=require("syracuse-tablet/html/js/ui/modals/modalConfirm").Modal,_templateAll={content:' 			<article style="height:100%">				<section class="panel panel-default list">					<div class="s-m-list-wrapper">					</div>				</section>			{{#if createLabel}}				<section class="panel panel-default action">					<button type="button" class="btn-primary" data-nevent data-naction="createTemplate"> {{createLabel}}</button>				</section>			{{/if}}			</article>		',list:' 		<ul class="list-group s-m-scroll-elmt">		{{#each views}} 		<li class="list-group-item {{selected}}" data-nevent data-naction="clickView" data-params="{{uuid}}">			<table>				<tr>				<td>					<h4 class="list-group-item-heading">{{description}}</h4>					<p class="list-group-item-text">{{factoryOwner}}</p>				</td>				<td>					{{#if deletable}}					<span  class="btn btn-default s-m-delete-template" data-nevent data-naction="deleteTemplate" data-params="{{uuid}}">					<i class="{{../deleteicon}}"></i>					</span>					{{/if}}			    </td>				</tr>			</table>		</li>		{{/each}}		</ul>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templateAll[key];return tmpl||(tmpl=_templateAll[key]=Handlebars.compile(_templateAll[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.PanelDashboardTemplate=utils.defineClass(function PanelDashboardTemplate(controller,$type,article,options){options=options||{},options.title=options.title||locale.text("welcome.dashboard.choose.template"),Base.call(this,controller,$type,article,options),this._viewList(options.views),notifications.subscribe(this,["sm.dashboard.list.views.change"])},Base,{buildHtml:function(){Base.prototype.buildHtml.call(this),this.$$content=this._buildContent().appendTo(this.$$panelContent),this._buildList().appendTo($(".s-m-list-wrapper",this.$$content))},destroy:function(){},_setData:function(){},_getContext:function(){return null},_buildContent:function(){var opt={ctrlId:this.id};return this.options.showCreateTemplate&&(opt.createLabel=locale.text("dashboard.welcome.create.template")),$(_getHtml("content",opt))},show:function(){this.$$elmt||this.buildHtml("right"),this._makeVisible()},hide:function(){this.changeCurrentView&&(this.changeCurrentView=!1,notifications.publish(["sm.dashboard.change.current.view"])),Base.prototype.hide.call(this)},_buildList:function(){var opts={deleteicon:fontUtils.getIconByName("$delete"),ctrlId:this.id,views:this.views};return $(_getHtml("list",opts))},_viewList:function(views){var self=this;self.views=[],views.forEach(function(view){self.views.push({description:view.$description,personal:view.$isPersonal,selected:view.$selected?"active":"",uuid:view.$uuid,factoryOwner:view.$factoryOwner,deletable:self.options.showCreateTemplate&&!view.$isPersonal})})},notifDashboardListViewsChange:function(opts){this.changeCurrentView=opts.changeCurrentView,this._viewList(opts.views),this._replaceList()},_replaceList:function(){$(".s-m-list-wrapper").empty(),this._buildList().appendTo($(".s-m-list-wrapper",this.$$content))},_actCreateTemplate:function(){this.hide(),notifications.publish(["sm.dashboard.create.template"])},_actDeleteTemplate:function(uuid){var modal=new ModalConfirm(locale.text("modal.confirm.delete.template"),null,!0);return modal.show().then(function(result){result==="yes"&&notifications.publish(["sm.dashboard.delete.template"],uuid)})},_actClickView:function(uuid){this.hide(),notifications.publish(["sm.dashboard.select.template"],uuid)}})}),define("syracuse-tablet/html/js/controls/panels/aside/panelBreadCrumbs",["require","exports","module","syracuse-tablet/html/js/controls/panels/aside/panelAsideBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/app/eventListener","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/app/navigationPageStack"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_html[name])),tmpl(ctx)}var Base=require("syracuse-tablet/html/js/controls/panels/aside/panelAsideBase").PanelAsideBase,utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),eventListener=require("syracuse-tablet/html/js/app/eventListener"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),locale=require("syracuse-tablet/html/js/helpers/locale"),navigationPageStack=require("syracuse-tablet/html/js/app/navigationPageStack"),_html={items:'			<div class="s-m-items">			{{{itemsHtml}}}			</div>			',item:'<a draggable="false" 			href="#" 			{{{attrs}}} class="{{css}}"><div class="s-m-item">			<div class="s-m-text">{{text}}</div>			<div class="{{icon}}"></div>			</div></a>'},_templates={};exports.PanelBreadCrumbs=utils.defineClass(function PanelBreadCrumbs(controller,$type,article,options){Base.call(this,controller,$type,article,options)},Base,{destroy:function(){Base.prototype.destroy.call(this),this._stack=null},buildHtml:function(){var self=this;Base.prototype.buildHtml.call(this),this.$$elmt.css({top:uiSettings.getProp("header.height")-12+"px"}),this._stack=navigationPageStack.findClosest(this.$$elmt);var $$content=this._buildItems();self.$$panelContent.append($$content)},_getAdditionnalCss:function(){return""},_buildItems:function(){this.$$panelContent.empty();if(!this._stack)return;var stackItems=this._stack.getStackItems();this._stack.isFirstPageHome()||stackItems.splice(0,0,{title:locale.text("header.sm.links.home"),pageType:"home"});var items=[],idx=0;for(var i=0;i<stackItems.length;i++){var si=stackItems[i];if(si.noHistory!==!0){var attrs=eventListener.getDataActionAttrs(this.controller.id,"itemClicked",si.id,!0);items.push(_getHtml("item",{attrs:attrs,text:si.title,notLast:idx!==0,icon:this._getIcon(si.pageType),css:si.pageType})),idx++}}var home=items.shift(),last=items.pop();return items.reverse(),items.unshift(home),items.push(last),$(_getHtml("items",{itemsHtml:items.join("")}))},_getIcon:function(pageType){switch(pageType){case"home":return"fa fa-home";case"dashboard":return"fa fa-th";case"$details":return"fa fa-file";case"$lookup":return"fa fa-list-ul";case"$query":return"fa fa-list-ul";case"$create":return"fa fa-pencil";case"$edit":return"fa fa-pencil";case"chartDetail":return"fa fa-pie-chart"}},getDesiredHeight:function(){return 0},setTop:function(top){},_actItemClicked:function(id){var self=this;if(!id){modules.get("appController").App.gotoHomePage();return}this._stack.goBackToId(id).then(function(res){res||self.hide()}).fail(function(e){modules.get("modal").error(e)})}})}),define("syracuse-tablet/html/js/controls/panels/navigationBar/navigationStackBar",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/controls/ctrlBase","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/controls/ctrlBase").CtrlBase,notifications=require("syracuse-tablet/html/js/helpers/notifications"),_templates={navigationBar:'			<ul class="nav nav-pills nav-justified">			{{#each stacks}}			<li role="presentation" role="tab" data-toggle="tab" data-control-id="{{../ctrlId}}" data-nevent data-naction="actionStack" data-params="{{idx}}" class="s-m-stack-tab {{#if selected}}active{{/if}}"><a href="#">{{title}}</a></li>			{{/each}}			</ul>			<div class="btn-group">				<div class="dropdown">					<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">						<a class="s-m-nav-link" style="display:none" href="#">							<i class="fa fa-ellipsis-v"></i>						</a>					</button>					<ul class="dropdown-menu dropdown-menu-right" role="menu">						{{#each stacks}}							<li  role="presentation" role="tab" data-toggle="tab" data-control-id="{{../ctrlId}}"  data-nevent data-naction="actionStack" data-params="{{idx}}" class="s-m-stack-popup nav nav-pills "><a href="#">{{title}}</a></li>						{{/each}}					</ul>				</div>			</div>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[key]=Handlebars.compile(_templates[name])),tmpl||alert("template "+name+" not found"),tmpl(ctx)};exports.NavigationStackBar=utils.defineClass(function(controller,$type,article,options){Base.call(this,controller,$type,article,options),notifications.subscribe(this,["sm.stack.select"])},Base,{destroy:function(){Base.prototype.destroy.call(this),this.$$container.empty(),notifications.unsubscribe(this,["sm.stack.select"])},buildHtml:function(){this.$$container.empty();var ctx=this._context();this.$$navBar=$(_getHtml("navigationBar",ctx)),this.$$container.append(this.$$navBar),this.$$container.show()},_context:function(){var self=this,defaultTitle="",opts={stacks:[],ctrlId:this.id},stacks=self.controller.getRootStackList();return stacks.forEach(function(stack,index){defaultTitle="Panel "+(index+1),opts.stacks.push({selected:index===0,idx:index,title:stack.$title?self.controller.dataset.resolveExpression(stack.$title)||defaultTitle:defaultTitle})}),opts},computeLayout:function(layoutInfo){var self=this;if(!self.$$container)return;$(".dropdown").removeClass("open");var maxWidth=self.$$navBar.width(),width=0,index;self.notDisplayedTab=[],$(".s-m-stack-tab[data-naction='actionStack']",self.$$navBar).each(function(item){width+=$(this).width(),index=parseInt($(this).attr("data-params"),10),width>=maxWidth?(self.notDisplayedTab.push({index:index,title:$("a",$(this)).text()}),$(this).hide(),$(".s-m-stack-popup[data-params='"+index+"']",self.$$navBar).show()):($(this).show(),$(".s-m-stack-popup[data-params='"+index+"']",self.$$navBar).hide())}),self.notDisplayedTab.length>0?$(".s-m-nav-link").show():$(".s-m-nav-link").hide()},notifStackSelect:function(index){$("[data-naction='actionStack']").removeClass("active").removeAttr("disabled"),$("[data-naction='actionStack'][data-params='"+index+"']").addClass("active").attr("disabled","disabled")}})}),define("syracuse-tablet/html/js/controls/ctrlFactory",["require","exports","module","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/controls/fields/ctrlAlphanum","syracuse-tablet/html/js/controls/fields/ctrlCheckbox","syracuse-tablet/html/js/controls/fields/ctrlSwitch","syracuse-tablet/html/js/controls/fields/ctrlCombo","syracuse-tablet/html/js/controls/fields/ctrlNumeric","syracuse-tablet/html/js/controls/fields/ctrlQuantity","syracuse-tablet/html/js/controls/fields/ctrlReference","syracuse-tablet/html/js/controls/fields/ctrlDate","syracuse-tablet/html/js/controls/fields/ctrlText","syracuse-tablet/html/js/controls/fields/ctrlDocument","syracuse-tablet/html/js/controls/fields/ctrlDocument","syracuse-tablet/html/js/controls/ctrlTypeUnknown","syracuse-tablet/html/js/controls/array/ctrlArray","syracuse-tablet/html/js/controls/array/ctrlArrayChart","syracuse-tablet/html/js/controls/vignette/ctrlVignette","syracuse-tablet/html/js/controls/vignette/ctrlVignetteLink","syracuse-tablet/html/js/controls/fields/ctrlImage","syracuse-tablet/html/js/controls/fields/ctrlGaugeChart","syracuse-tablet/html/js/controls/fields/ctrlFilter","syracuse-tablet/html/js/controls/layouts/layoutStack","syracuse-tablet/html/js/controls/layouts/layoutRow","syracuse-tablet/html/js/controls/layouts/layoutCell","syracuse-tablet/html/js/controls/layouts/layoutHub","syracuse-tablet/html/js/controls/layouts/layoutHubGroup","syracuse-tablet/html/js/controls/layouts/layoutTile","syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeTablet","syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeSmartphone","syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase","syracuse-tablet/html/js/controls/panels/header/panelHeaderMultisel","syracuse-tablet/html/js/controls/panels/header/panelHeaderMultiselRun","syracuse-tablet/html/js/controls/panels/header/panelHeaderEditHome","syracuse-tablet/html/js/controls/panels/aside/panelActions","syracuse-tablet/html/js/controls/panels/aside/panelActionsMultiSelection","syracuse-tablet/html/js/controls/panels/aside/panelGlobalBase","syracuse-tablet/html/js/controls/panels/sortfilter/panelFilterSort","syracuse-tablet/html/js/controls/panels/toolBars/chartDetailToolBar","syracuse-tablet/html/js/controls/panels/aside/panelShare","syracuse-tablet/html/js/controls/panels/aside/panelEditTemplates","syracuse-tablet/html/js/controls/panels/aside/panelDashboardTemplate","syracuse-tablet/html/js/controls/panels/aside/panelBreadCrumbs","syracuse-tablet/html/js/controls/panels/navigationBar/navigationStackBar"],function(require,exports,module){function _createControl(controller,article,parent,opts){var $bind=article.$bind;if(!controller.dataset.prototype.propExists($bind))return;var $type=controller.dataset.prototype.propGetType($bind),$format=controller.dataset.prototype.propGetFormat($bind),ctor,proto;switch($type){case"application/x-boolean":switch($format){case"$switch":ctor=CtrlSwitch;break;default:ctor=CtrlCheckbox}break;case"application/x-choice":ctor=CtrlCombo;break;case"application/x-string":case"application/x-password":switch($format){case"$phone":ctor=CtrlPhone;break;case"$email":ctor=CtrlEmail;break;case"$url":ctor=CtrlUrl;break;default:ctor=CtrlAlphaNum}break;case"application/x-reference":ctor=CtrlReference;break;case"application/x-integer":case"application/x-real":case"application/x-decimal":case"application/x-quantity":!article.$gauge&&article.$numDisplay==="gauge"&&(article.$gauge={}),article.$gauge?ctor=CtrlGaugeChart:ctor=$type==="application/x-quantity"?CtrlQuantity:CtrlNumeric;break;case"application/x-date":case"application/x-time":case"application/x-datetime":ctor=CtrlDate;break;case"application/x-array":proto=controller.dataset.prototype.propGetProto($bind),proto.getValueByPath("$cube")?ctor=CtrlArrayChart:ctor=CtrlArray;break;case"application/x-vignette":ctor=CtrlVignette;break;case"application/x-vignette-link":ctor=CtrlVignetteLink;break;case"image":ctor=CtrlImage;break;case"text/plain":case"text/rtf":case"text/html":ctor=CtrlText;break;case"application/x-filter":ctor=CtrlFilter;case"application/x-document":ctor=CtrlDocument;break;case"application/x-binary":ctor=CtrlBinary;break;default:ctor=CtrlTypeUnknown}ctor&&(proto=proto||controller.dataset.prototype.propGetProto($bind));var ctrl;return ctor&&proto&&(ctrl=new ctor(controller,article,proto,opts||{})),ctrl&&parent&&parent.appendStructElmt(ctrl),ctrl}function _createLayout(controller,article,parent,opts){var $type=article.$layoutType,ctrl,ctor;switch($type.toLowerCase()){case"stack":ctor=LayoutStack;break;case"row":ctor=LayoutRow;break;case"cell":ctor=LayoutCell;break;case"hub":ctor=LayoutHub;break;case"hubgroup":ctor=LayoutHubGroup;break;case"tile":ctor=LayoutTile;break;default:throw new Error("Unknown layout type ["+$type+"]")}return ctor&&(ctrl=new ctor(controller,$type,article,opts||{})),ctrl&&parent&&parent.appendStructElmt(ctrl),ctrl}function _createLink(controller,article,parent,opts){}function _createAction(controller,article,parent,opts){}function _createControlType(controller,article,parent,opts){var $type=article.$type,ctor,ctrl;switch($type){case"application/x-panel-header-sdata-page":ctor=PanelHeaderSdataPage;break;case"application/x-panel-header-multisel":ctor=PanelHeaderMultisel;break;case"application/x-panel-header-multisel-run":ctor=PanelHeaderMultiselRun;break;case"application/x-panel-actions":ctor=PanelActions;break;case"application/x-panel-actions-multi":ctor=PanelActionsMultiSelection;break;case"application/x-panel-global":ctor=PanelGlobal;break;case"application/x-panel-breadcrumbs":ctor=PanelBreadCrumbs;break;case"application/x-panel-filtersort":ctor=PanelSortFilter;break;case"application/x-chartdetail-toolbar":ctor=ChartDetailToolBar;break;case"application/x-panel-share":ctor=PanelShare;break;case"application/x-panel-footer-edithome-tablet":ctor=PanelFooterEditHomeTablet;break;case"application/x-panel-footer-edithome-smartphone":ctor=PanelFooterEditHomeSmartphone;break;case"application/x-panel-header-edithome":ctor=PanelHeaderEditHome;break;case"application/x-panel-dashboard-template":ctor=PanelDashboardTemplate;break;case"application/x-panel-edittemplates":ctor=PanelEditTemplates;break;case"application/x-navigation-stackbar":ctor=NavigationStackBar}return ctor&&(ctrl=new ctor(controller,$type,article,opts)),ctrl}var Prototype=require("syracuse-tablet/html/js/sdata/prototype").Prototype,CtrlAlphaNumModule=require("syracuse-tablet/html/js/controls/fields/ctrlAlphanum"),CtrlAlphaNum=CtrlAlphaNumModule.CtrlAlphaNum,CtrlPhone=CtrlAlphaNumModule.CtrlPhone,CtrlEmail=CtrlAlphaNumModule.CtrlEmail,CtrlUrl=CtrlAlphaNumModule.CtrlUrl,CtrlCheckbox=require("syracuse-tablet/html/js/controls/fields/ctrlCheckbox").CtrlCheckbox,CtrlSwitch=require("syracuse-tablet/html/js/controls/fields/ctrlSwitch").CtrlSwitch,CtrlCombo=require("syracuse-tablet/html/js/controls/fields/ctrlCombo").CtrlCombo,CtrlNumeric=require("syracuse-tablet/html/js/controls/fields/ctrlNumeric").CtrlNumeric,CtrlQuantity=require("syracuse-tablet/html/js/controls/fields/ctrlQuantity").CtrlQuantity,CtrlReference=require("syracuse-tablet/html/js/controls/fields/ctrlReference").CtrlReference,CtrlDate=require("syracuse-tablet/html/js/controls/fields/ctrlDate").CtrlDate,CtrlText=require("syracuse-tablet/html/js/controls/fields/ctrlText").CtrlText,CtrlDocument=require("syracuse-tablet/html/js/controls/fields/ctrlDocument").CtrlDocument,CtrlBinary=require("syracuse-tablet/html/js/controls/fields/ctrlDocument").CtrlBinary,CtrlTypeUnknown=require("syracuse-tablet/html/js/controls/ctrlTypeUnknown").CtrlTypeUnknown,CtrlArray=require("syracuse-tablet/html/js/controls/array/ctrlArray").CtrlArray,CtrlArrayChart=require("syracuse-tablet/html/js/controls/array/ctrlArrayChart").CtrlArrayChart,CtrlVignette=require("syracuse-tablet/html/js/controls/vignette/ctrlVignette").CtrlVignette,CtrlVignetteLink=require("syracuse-tablet/html/js/controls/vignette/ctrlVignetteLink").CtrlVignetteLink,CtrlImage=require("syracuse-tablet/html/js/controls/fields/ctrlImage").CtrlImage,CtrlGaugeChart=require("syracuse-tablet/html/js/controls/fields/ctrlGaugeChart").CtrlGaugeChart,CtrlFilter=require("syracuse-tablet/html/js/controls/fields/ctrlFilter").CtrlFilter,LayoutStack=require("syracuse-tablet/html/js/controls/layouts/layoutStack").LayoutStack,LayoutRow=require("syracuse-tablet/html/js/controls/layouts/layoutRow").LayoutRow,LayoutCell=require("syracuse-tablet/html/js/controls/layouts/layoutCell").LayoutCell,LayoutHub=require("syracuse-tablet/html/js/controls/layouts/layoutHub").LayoutHub,LayoutHubGroup=require("syracuse-tablet/html/js/controls/layouts/layoutHubGroup").LayoutHubGroup,LayoutTile=require("syracuse-tablet/html/js/controls/layouts/layoutTile").LayoutTile,PanelFooterEditHomeTablet=require("syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeTablet").PanelFooterEditHomeTablet,PanelFooterEditHomeSmartphone=require("syracuse-tablet/html/js/controls/panels/footer/panelFooterEditHomeSmartphone").PanelFooterEditHomeSmartphone,PanelHeaderSdataPage=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderSdataPageBase").PanelHeaderSdataPageBase,PanelHeaderMultisel=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderMultisel").PanelHeaderMultisel,PanelHeaderMultiselRun=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderMultiselRun").PanelHeaderMultiselRun,PanelHeaderEditHome=require("syracuse-tablet/html/js/controls/panels/header/panelHeaderEditHome").PanelHeaderEditHome,PanelActions=require("syracuse-tablet/html/js/controls/panels/aside/panelActions").PanelActions,PanelActionsMultiSelection=require("syracuse-tablet/html/js/controls/panels/aside/panelActionsMultiSelection").PanelActionsMultiSelection,PanelGlobal=require("syracuse-tablet/html/js/controls/panels/aside/panelGlobalBase").PanelGlobalBase,PanelSortFilter=require("syracuse-tablet/html/js/controls/panels/sortfilter/panelFilterSort").PanelFilterSort,ChartDetailToolBar=require("syracuse-tablet/html/js/controls/panels/toolBars/chartDetailToolBar").ChartDetailToolBar,PanelShare=require("syracuse-tablet/html/js/controls/panels/aside/panelShare").PanelShare,PanelEditTemplates=require("syracuse-tablet/html/js/controls/panels/aside/panelEditTemplates").PanelEditTemplates,PanelDashboardTemplate=require("syracuse-tablet/html/js/controls/panels/aside/panelDashboardTemplate").PanelDashboardTemplate,PanelBreadCrumbs=require("syracuse-tablet/html/js/controls/panels/aside/panelBreadCrumbs").PanelBreadCrumbs,NavigationStackBar=require("syracuse-tablet/html/js/controls/panels/navigationBar/navigationStackBar").NavigationStackBar;exports.createControl=function(controller,article,parent,page,opts){var ctrl;opts=$.extend(!0,{},opts),article.$bind?ctrl=_createControl(controller,article,parent,opts):article.$layoutType?ctrl=_createLayout(controller,article,parent,opts):article.$link?ctrl=_createLink(controller,article,parent,opts):article.$action?ctrl=_createAction(controller,article,parent,opts):article.$type&&(ctrl=_createControlType(controller,article,parent,opts));if(ctrl){ctrl.page=page||parent&&parent.page;var $articleLocalization=article.$localization;!$articleLocalization&&parent&&($articleLocalization=parent.$articleLocalization),$articleLocalization||($articleLocalization={}),ctrl.$articleLocalization=$articleLocalization}return ctrl}}),define("syracuse-tablet/html/js/pages/sdata/actionAdapterPageSdata",["require","exports","module","syracuse-tablet/html/js/pages/actionAdapter","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/helpers/jsutils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/actionAdapter").ActionAdapter,locale=require("syracuse-tablet/html/js/helpers/locale"),utils=require("syracuse-tablet/html/js/helpers/utils"),environment=require("syracuse-tablet/html/js/helpers/environment"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),_skipExlude=["multiSelToggle","multiSelTriggerAction"];exports.ActionAdapterPageSdata=utils.defineClass(function ActionAdapterPageSdata(sdataPage){Base.call(this,sdataPage),this.$arrayOptions={},this._items={header:null,footer:null,globalPanel:null,actionsPanel:null,actionsMultiPanel:null,multiSelection:null,multiSelectionRun:null,multiSelectionReserved:null},this.showAccept=!1,this.showCancel=!1,this.showDesignPage=!1,this.showPageShare=!1,this.showPinPage=!1,this.showPageConfig=!1,this.showMyDashboardTemplates=!1,this.showMyDashboard=!1,this.showEditTemplates=!1,this.showSortFilter=!1,this._initMultiSelItems()},Base,{destroy:function(){Base.prototype.destroy.call(this)},_initMultiSelItems:function(){this._items.multiSelection=[];var actions=this._getPageActionSettings();if(!actions)return;var items=this._items.multiSelection,dataset=this.page.controller.dataset,self=this;actions.forEach(function(act){if(act.options&&act.options.multiselection!==!0)return;var link=dataset.getLink(act.name);if(!link)return;act.slot="main",self._addNonSdataActionItem(items,"multiSelTriggerAction",act.name,dataset.resolveExpression(link.$title),null,act)});if(items&&items.length>0||this.page.isDownloadEnabled())this._addMultiSelectionToggle(items,"left"),items.unshift({action:this.page.isDownloadEnabled()?"multiSelActionsWithDownload":"multiSelActions",slot:"multiSelection"}),this._items.multiSelectionRun=[],this._addNonSdataActionItem(this._items.multiSelectionRun,"multiSelTriggerAction","stop",null,null,{icon:"multiSelectionRunStop",slot:"multiSelection"}),this._addNonSdataActionItem(this._items.multiSelectionRun,"multiSelTriggerAction","exit",null,null,{icon:"multiSelectionRunExit",slot:"multiSelection"})},_getPageActionSettings:function(){var actions=this.page.getAuthoring("$pageActionSettings");if(!actions){if(!this.page.isDownloadEnabled())return;actions=[]}return actions},clearCachedItems:function(){this._items.header=null,this._items.footer=null,this._items.globalPanel=null,this._items.actionsPanel=null,this._items.multiSelectionReserved=null,this._initMultiSelItems()},getHeaderItems:function(){return this.getItems("header")},getFooterItems:function(){return this.getItems("footer")},getMultiSelectionItems:function(panelControllerId){var items=this.getItems("multiSelection").filter(function(item){return!item.options||item.options.footerHeader});return panelControllerId&&items.forEach(function(item){item.action==="multiSelActions"&&(item["controller-id"]=panelControllerId)}),items},getMultiSelectionSidePanelItems:function(){var items=this.getItems("multiSelection");return items.filter(function(item){return item.options&&item.options.multiselection})},getMultiSelectionRunItems:function(){return this.getItems("multiSelectionRun")},getGlobalPanelItems:function(){return this.getItems("globalPanel")},getActionsPanelItems:function(options){return options=options||{},options.recompute=!0,this.getItems("actionsPanel",options)},_hasItems:function(panelName){var items=this.getItems(panelName);return items&&items.length>0||!1},getItems:function(panelName,options){options=options||{};var items=this._items[panelName];if(!items||options.layoutChange||options.recompute){var func="_compute"+panelName.smCapitalize()+"Items";items=this[func].call(this,options.visibleLinks)||[],this._items[panelName]=items}return items},_addFooterHeaderActions:function(items,slot){var actions=this._getPageActionSettings();if(!actions)return;var controller=this.page.controller,knownActions=controller.dataset.getActions()||{},knownLinks=controller.dataset.getLinks()||{},self=this;actions.forEach(function(act){act.options&&act.options.footerHeader===!0&&act.options.multiselection!==!0&&(knownLinks[act.name]?self._addSdataLinkItem(items,act.name,controller,$.extend(!0,{slot:slot},act)):knownActions[act.name]&&self._addSdataActionItem(items,act.name,controller,$.extend(!0,{slot:slot},act)))})},_computeHeaderItems:function(){var items=[],controller=this.page.controller,facet=controller.getFacet(),addFooter=!1;this.showSortFilter&&(this._addSortFilterButton(items,controller,{slot:"array"}),addFooter=!0),this.showSearch&&(this._addSearchButton(items,controller,{slot:"array"}),addFooter=!0),this.showAccept&&(this._addAcceptButton(items,controller,{slot:"main"}),addFooter=!0),this.showCancel&&(this._addCancelButton(items,controller,{slot:"main"}),addFooter=!0);switch(facet){case"$query":this._addSdataLinkItem(items,"$create",controller,{slot:"main"}),addFooter=!0;break;case"$details":this._addSdataLinkItem(items,"$edit",controller,{slot:"main"}),this._addSdataLinkItem(items,"$delete",controller,{slot:"main"}),this._addSdataLinkItem(items,"$query",controller,{slot:"main"}),addFooter=!0;break;case"$edit":this._addSdataLinkItem(items,"$edit",controller,{slot:"main"});case"$create":this._addSdataActionItem(items,"$save",controller,{slot:"main"}),addFooter=!0}return addFooter&&this._addFooterHeaderActions(items,"right"),items},_computeFooterItems:function(){var items=[];return items},_computeGlobalPanelItems:function(){var items=[],controller=this.page.controller;return this.showPageConfig&&this._addPageConfigButton(items,controller,{slot:"tools"}),this.showMyDashboardTemplates&&this._addMyDashboardTemplatesButton(items,controller,{slot:"tools"}),this.showMyDashboard&&this._addMyDashboardButton(items,controller,{slot:"tools"}),this.showPageShare&&this._addShareButton(items,controller,{slot:"share"}),this._addSettingsButton(items,controller,{slot:"appl"}),this._addAboutButton(items,controller,{slot:"appl"}),jsutils.isDvlpVersion()&&this._addDevButton(items,controller,{slot:"tools"}),this._addDraftsListLink(items,controller,"logout"),this._addLogoutButton(items,controller,{slot:"logout"}),items},_computeActionsPanelItems:function(visibleLinks){visibleLinks=visibleLinks||{};var items=[],controller=this.page.controller,$links=controller.dataset.getLinks();for(var $linkName in $links)$linkName.smStartsWith("$")||this._addSdataLinkItem(items,$linkName,controller,{slot:"links"},visibleLinks[$linkName]);var $actions=controller.dataset.getActions();for(var $actionName in $actions)!$actionName.smStartsWith("$")&&!visibleLinks[$actionName]&&this._addSdataActionItem(items,$actionName,controller,{slot:"actions"});this.showSearch&&this._addSearchButton(items,controller,{slot:"main"},visibleLinks),this.showSortFilter&&this._addSortFilterButton(items,controller,{slot:"main"},visibleLinks),this._items.multiSelection.length>0&&this._addMultiSelectonButton(items,controller,{slot:"main"},visibleLinks);var facet=controller.getFacet();switch(facet){case"$query":this._addSdataLinkItem(items,"$create",controller,{slot:"main"},visibleLinks.$create);break;case"$details":this._addSdataLinkItem(items,"$edit",controller,{slot:"main"},visibleLinks.$edit),this._addSdataLinkItem(items,"$delete",controller,{slot:"main"},visibleLinks.$delete),this._addSdataLinkItem(items,"$query",controller,{slot:"main"},visibleLinks.$query);break;case"$edit":case"$create":this._addSdataActionItem(items,"$save",controller,{slot:"main"},visibleLinks.$save),this.showEditTemplates&&this._addGlobalAction("showEditTemplates",items,controller,{slot:"main"},visibleLinks.showEditTemplates)}return this.showPinPage&&(this._addPinButton(items,"pin",controller,{slot:"tools"},visibleLinks),this._addPinButton(items,"unpin",controller,{slot:"tools"},visibleLinks)),this.showPageShare&&this._addShareButton(items,controller,{slot:"tools"},visibleLinks),this.showDesignPage===!0&&environment.isDesktop()&&!environment.isNativeWrapper()&&this._addDesignPageButton(items,controller,{slot:"tools"},visibleLinks),this._addDraftsListLink(items,controller,"home"),items},_addSdataLinkItem:function(items,$linkName,controller,overrides,headerVisible){if(this._isMultiSelectionReserved($linkName)||headerVisible)return;var dataset=controller.dataset,link=dataset.getLink($linkName);if(!link)return;var item={name:$linkName,"controller-id":controller.id,$link:$linkName,icon:$linkName,isDisabled:link.$isDisabled,isHidden:link.$isHidden,title:dataset.resolveExpression(link.$title)};this._pushItem(items,item,overrides)},_addMultiSelectionToggle:function(items,slot){this._addNonSdataActionItem(items,"multiSelToggle",null,locale.text("action.multiselect"),null,{icon:"multiSelection",slot:slot})},_addNonSdataActionItem:function(items,$actionName,params,title,controller,overrides){if(_skipExlude.indexOf($actionName)<0&&this._isMultiSelectionReserved($actionName))return;title=title||"";var item={name:$actionName,"controller-id":controller&&controller.id,action:$actionName,icon:$actionName,title:title,params:params};this._pushItem(items,item,overrides)},_addSdataActionItem:function(items,$actionName,controller,overrides,headerVisible){if(_skipExlude.indexOf($actionName)<0&&this._isMultiSelectionReserved($actionName)||headerVisible)return;var dataset=controller.dataset,action=dataset.getAction($actionName);if(!action)return;var item={name:$actionName,"controller-id":controller.id,$sdataAction:$actionName,icon:$actionName,isDisabled:action.$isDisabled,isHidden:action.$isHidden,title:dataset.resolveExpression(action.$title||"")};this._pushItem(items,item,overrides)},_pushItem:function(items,item,overrides){overrides&&(item=$.extend(!0,{},item,overrides)),items.push(item),this._items.multiSelectionReserved||(this._items.multiSelectionReserved=[]),(item.options&&item.options.multiselection||item.name=="multiSelTriggerAction")&&this._items.multiSelectionReserved.push(item.name)},_isMultiSelectionReserved:function(name){return this._items.multiSelectionReserved!=null&&this._items.multiSelectionReserved.indexOf(name)>=0}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdata",["require","exports","module","syracuse-tablet/html/js/pages/pageBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/controls/articleParser","syracuse-tablet/html/js/pages/sdata/actionAdapterPageSdata","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/sdata/wpHelpers","syracuse-tablet/html/js/sdata/sdataUtils","syracuse-tablet/html/js/controls/panels/aside/panelEditTemplates"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/pageBase").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),helpers=require("syracuse-tablet/html/js/common/helpers"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,articleParser=require("syracuse-tablet/html/js/controls/articleParser"),ActionAdapterPageSdata=require("syracuse-tablet/html/js/pages/sdata/actionAdapterPageSdata").ActionAdapterPageSdata,modules=require("syracuse-tablet/html/js/common/modules"),sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester"),waiting=require("syracuse-tablet/html/js/utils/waiting"),settings=require("syracuse-tablet/html/js/app/settings"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),locale=require("syracuse-tablet/html/js/helpers/locale"),native=require("syracuse-tablet/html/js/helpers/native/native"),wpHelpers=require("syracuse-tablet/html/js/sdata/wpHelpers"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),panelEditTemplates=require("syracuse-tablet/html/js/controls/panels/aside/panelEditTemplates");exports.Page=utils.defineClass(function PageSdata(pageData,options){this.pageData=pageData,options=options||{},Base.call(this,pageData.name,options),this.actionAdapter=new ActionAdapterPageSdata(this),this.actionAdapter.showDesignPage=this.allowAuthoring(),this.actionAdapter.showPageShare=this._checkSharePanelActive(),options.isChild!==!0&&(this.actionAdapter.showPinPage=!0,this.actionAdapter.showEditTemplates=this.controller.isEditMode()),this._publishOptions=null,notifications.subscribe(this,["sm.auth.set.selection"])},Base,{destroy:function(){Base.prototype.destroy.call(this),notifications.unsubscribe(this,["sm.auth.set.selection"]),this.pageData=null,this.controller&&(this.controller.destroy(),this.controller=null),this.actionAdapter&&(this.actionAdapter.destroy(),this.actionAdapter=null)},unbuild:function(){this.rootLayout&&(this.rootLayout.destroy(),this.rootLayout=null),Base.prototype.unbuild.call(this)},_ensureController:function(){this.controller=new SdataController(this.pageData.dataset,null,this.isWorkingCopyDataUrl()),this.controller.setUIAdapter(this)},createRootElement:function(){Base.prototype.createRootElement.call(this),this.$$elmt.attr("data-controller-id",this.controller.id);var css=["regular"],facet=this.controller.dataset.prototype.getFacet();facet&&css.push(facet.smStartsWith("$")?facet.substring(1):facet),this.$$elmt.addClass(css.join(" "))},initStructure:function(){Base.prototype.initStructure.call(this),this.rootLayout=articleParser.parseArticle(this.controller,this.getArticle(),this);if(!this.rootLayout)return $.smReject(helpers.createDiag(null,"error",locale.text("page.invalid.article")))},render:function(){var self=this;return self.attachedControlsMgr.buildHtml(),self.renderRootLayout().then(function(){return self.parentVignette?$.smResolve():self.actionAdapter.showPinPage&&wpHelpers.isPagePinned(self.getPinPageId()).then(function(state){notifications.publish(["sm.pin.status.change"],state)})}).then(function(){self.actionAdapter.showEditTemplates===!0&&panelEditTemplates.publishEditTemplateStatus(self)})},renderRootLayout:function(){var self=this;return $.smResolve().then(function(){self.rootLayout.set$$container(self.$$contentRoot),self.rootLayout.buildHtml()})},afterRender:function(){this.rootLayout.afterRender(),this.controller.showNavigationStackBar()&&this._actActionStack(this.controller.currentStack||0)},rebuildHtml:function(){this.rootLayout.destroy(),this.rootLayout=articleParser.parseArticle(this.controller,this.getArticle(),this),this.rootLayout.set$$container(this.$$contentRoot),this.rootLayout.buildHtml(),this.computeLayout({refresh:!0})},computeControlsLayouts:function(context){Base.prototype.computeControlsLayouts.call(this,context),this.rootLayout&&this.rootLayout.computeLayout(context)},scrollAllowed:function(){return this.controller.dataset.prototype.isQueryLikeFacet()?!1:!0},beforeOnSdataActionClicked:function(actionName,controller){var context=null,goAhead=!0;if(actionName==="$edit"){var selector=".s-m-control.s-m-field";this.$$contentElmt.find(selector).each(function(){var $$e=$(this);if($$e.is(":visible")&&$$e.offset().top>50)return context={selector:selector,id:$$e.attr("id").split("-")[0],offset:$$e.offset().top},!1})}return $.smResolve(goAhead,context)},afterOnSdataActionClicked:function(actionName,success,beforeContext,response){if(actionName!=="$save"&&actionName!=="$delete"||success!==!0){if(actionName==="$edit"&&beforeContext!=null&&this&&this.getGestureMgr()){var id=beforeContext.id+"-",self=this;this.$$contentElmt.find(beforeContext.selector).each(function(){var $$e=$(this);if($$e.attr("id").smStartsWith(id))return self.getGestureMgr().adjust(beforeContext.offset-$$e.offset().top),!1})}}else setTimeout(function(){modules.get("appController").App.goBack()})},_showNotification:function(title,message,severity){modules.get("modal").notify({title:title,body:message,severityClass:severity})},_askConfirmation:function($confirm){var resultPromise=$.Deferred();return $confirm=utils.isExpression($confirm)?this.controller.dataset.resolveExpression($confirm):$confirm,this.controller.dataset.resolveExpression($confirm),modules.get("modal").simpleConfirm($confirm,function(confirmed){resultPromise.resolve(confirmed)}),resultPromise.promise()},_updateRequestCount:function(count){this.$$counter||(this.$$counter=$('<span style="position: absolute; right: 0; bottom: 0; padding: 10px; background: white; z-index: 99999; opacity: 0.5;"><span>'),this.$$elmt.append(this.$$counter)),count>0?(this.$$counter.show(),this.$$counter.text(count)):this.$$counter.hide()},getPageTitle:function(){return this.controller.dataset.prototype.getValueByPath("$title",!0)},fetchNewPageData:function($link){var self=this,$url=$link.$url,fetchData=sdataReq.fetchPageData({$url:$url},{prototype:self.pageData.prototype.json,page:self.pageData.page}).then(function(pageData){var navStack=modules.get("navStack").findClosest(self.$$elmt);navStack&&navStack.replaceCurrentPageData(self,function(currentData){return currentData.url=$url,currentData}),self.options.savedCtx=self.savedCtxCreate({noScroll:!0});var settings=$.extend(!0,{},self.pageData.settings);self.pageData=pageData,self.pageData.settings=settings,self.controller.dataset.destroy(),self.controller.setDataset(self.pageData.dataset),self.rebuildHtml()});return waiting.waitModal(fetchData).fail(function(error){modules.get("modal").error(error)}).then(function(){self.onPageDataChanged()})},getPageSort:function(){return this.getPageSettings().sort},getPageFilter:function(){return this.getPageSettings().filter},getPageSearch:function(){return this.getPageSettings().search},setPageSort:function(sort){var old=this.getPageSort();if(sort==null&&old==null)return;var changed=old==null||sort==null||old.length!=sort.length;changed=changed||sort.some(function(val,idx){return sort[idx].sort!==old[idx].sort||sort[idx].field!==old[idx].field}),changed&&(this.getPageSettings().sort=sort,this.getPageSettings().isDirty=!0)},setPageFilter:function(filter){var old=this.getPageSort();if(old==null&&filter==null)return;this.getPageSettings().filter=filter,this.getPageSettings().isDirty=!0},setPageSearch:function(searchchInfo){this.getPageSettings().search=$.extend(!0,null,searchchInfo),this.getPageSettings().isDirty=!0,this.writePageSettings()},writePageSettings:function(){var self=this,pageSettings=self.getPageSettings();return pageSettings.isDirty?$.smResolve().then(function(){var pagePrefsId=self.getPagePrefsId();if(pagePrefsId)return delete pageSettings.isDirty,settings.writeUserPagePrefs(pagePrefsId,pageSettings)}):$.smResolve()},getPageSettings:function(){return this.pageData.settings||(this.pageData.settings={}),this.pageData.settings},onPageDataChanged:function(){Base.prototype.onPageDataChanged.call(this),this.isVignette()||notifications.publish("sm.data.freshness.change",this.controller.dataset.getDataFreshness())},isFacet:function(){return this.controller.dataset.prototype.isFacet.apply(this.controller.dataset.prototype,arguments)},allowAuthoring:function(){return!0},getAuthoringName:function(){var $url=this.pageData.dataset.json.$mobileEmbeddedUrl||this.pageData.$url,repr=protoHelpers.getReprFromUrl($url),ep=protoHelpers.getEndpointFromUrl($url);return ep=ep.split(".").slice(0,2).join("."),ep+"."+repr},getAuthoringFullName:function(){var $url=this.pageData.dataset.json.$mobileEmbeddedUrl||this.pageData.$url,repr=protoHelpers.getReprFromUrl($url),ep=protoHelpers.getEndpointFromUrl($url);return ep=ep.split(".").slice(0,3).join("."),ep+"."+repr},getPrototype:function(){return this.pageData.prototype},getRootLayout:function(){return this.rootLayout},getArticle:function(){return this.pageData.page.$article},getDataset:function(){return this.pageData.dataset},getRepresentation:function(){return this.getPrototype().getRepresentation()},authUpdateLayout:function(article){return this.pageData.page.$article=article,this.actionAdapter&&this.actionAdapter.clearCachedItems(),Base.prototype.authUpdateLayout.call(this,article)},isDownloadEnabled:function(){return!1},isSData:function(){return!0},isWorkingCopyDataUrl:function(){return this.pageData&&this.pageData.isWorkingCopy},isStateLessMode:function(){return this.pageData.dataset.isStateLessMode()},isWorkingCopyMode:function(){return this.pageData.dataset.isWorkingCopyMode()},getAuthoring:function(path,defValue){var val=utils.getPropByPath(utils.getPropByPath(this,"pageData.page.$article"),path);return val!=null?val:defValue},multiSelectionIsEnabed:function(){return!1},_actPinPage:function(){var self=this,data=this.getPinPageData();wpHelpers.pinPage(data).then(function(pagePined){pagePined&&(notifications.publish(["sm.pin.status.change"],pagePined),modules.get("modal").notify({body:locale.text("pin.page.add.ok",[self.getPageTitle()]),severityClass:"success"}))})},_actUnpinPage:function(){var self=this,data=this.getPinPageData();wpHelpers.unPinPage(data).then(function(pageUnPined){pageUnPined&&(notifications.publish(["sm.pin.status.change"],!pageUnPined),modules.get("modal").notify({body:locale.text("pin.page.remove.ok",[self.getPageTitle()]),severityClass:"success"}))})},getPinPageId:function(){var urlParsed=sdataUtils.parseSDataURL(this.pageData.$url);return this.pageName+(urlParsed&&urlParsed.id?"_"+urlParsed.id:"")},getPinPageData:function(){var name=this.pageName.split("."),urlParsed=sdataUtils.parseSDataURL(this.pageData.$url);return{$title:this.getPageTitle()+(urlParsed.id?" - "+urlParsed.id:""),$type:"$representation",action:this.controller.getFacet(),applicationName:this.getDataset().getClientContext("$mobileApplication")||"none",entity:urlParsed.entity,key:urlParsed.id,representation:this.getRepresentation(),facet:this.controller.getFacet(),id:this.getPinPageId(),name:name[0],icon:"star"}},getPagePublishOptions:function(){if(this._publishOptions)return this._publishOptions;if(this.options.isChild)return this._publishOptions={},this._publishOptions;var opts={scheduleMessage:{page:this},share:{page:this}};return this.pageData.prototype.isQuery()&&(opts.liveTile={page:this,pages:[this]}),this._publishOptions=opts,this._publishOptions},getPublishOptions:function(){var supportedByPage=this.getPagePublishOptions(),opts={};return Object.keys(supportedByPage).forEach(function(fn){native.hasCapability(fn)&&(opts[fn]=supportedByPage[fn])}),opts},_checkSharePanelActive:function(){if(this.options.isVignette)return!1;var opts=this.getPublishOptions();return Object.keys(opts).length>0},_actShowEditTemplates:function(){var panel=this.attachedControlsMgr.findByName("editTemplatesPanel");panel||(panel=this.attachedControlsMgr.createControl(this._getAttachedControlInfo("editTemplatesPanel")));if(!panel)return;panel.show()},_actActionStack:function(param){this._toogleFirstLevelStack(parseInt(param,10)),this.controller.currentStack=parseInt(param,10),notifications.publish(["sm.scroller.update"]),notifications.publish(["sm.stack.select"],param)},_toogleFirstLevelStack:function(idx){if(!this.rootLayout.children||this.rootLayout.children.length===0)return;this.rootLayout.children.forEach(function(elmt,index){elmt.$type==="stack"&&(idx===index||idx===undefined?elmt.show():elmt.hide())})},notifAuthSetSelection:function(id,noScroll){if(this.controller.showNavigationStackBar()){var idx,elmt=this.controller._controlsById[id];if(!elmt)return;var stack=elmt.$$elmt.closest(".s-m-stack[data-level='1'");if(!this.rootLayout.children||this.rootLayout.children.length===0||!stack)return;this.rootLayout.children.forEach(function(elmt,index){elmt.$type==="stack"&&elmt.id===stack.attr("id")&&(idx=index)}),$("[data-naction='actionStack']",this.$$elmt).removeClass("active"),$("[data-naction='actionStack'][data-params='"+idx+"']",this.$$elmt).addClass("active"),this._actActionStack(idx)}}})}),define("syracuse-tablet/html/js/multiselection/multiSelectionMainController",["require","exports","module","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/sdata/sdataUtils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/sdata/sdataRequester"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),modules=require("syracuse-tablet/html/js/common/modules"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester");exports.MultiSelectionMainController=utils.defineClass(function MultiSelectionMainController(queryPage){if(queryPage==null||queryPage.isFacet==null||!queryPage.isFacet("$query"))throw new Error("Sdata query page expected");Base.call(this,queryPage.pageData.dataset,null,queryPage.isWorkingCopyDataUrl()),this._page=queryPage,this._panel=null,this._array=null,this._panelRun=null},Base,{destroy:function(){Base.prototype.destroy.call(this),this._page==null,this._panel=null,this._array=null,this._panelRun=null},multiSelToggleStatus:function(){if(this._panel==null){var panelInfo={name:"headerMultisel",topIndex:0,selector:"header",$type:"application/x-panel-header-multisel"};this._panel=this._page.attachedControlsMgr.createAddtionalControl(panelInfo,{}),this._array=this._page.getQueryArray()}return this.isEnabled=this._page.attachedControlsMgr.toggleControls("headerMultisel","header"),this._panel.multiSelectionController.multiSelToggleStatus(this.isEnabled),this._array.multiSelToggleStatus(this.isEnabled),this.isEnabled},multiSelToggleRecord:function($$recordElmt){if(this._isProcessingData())return;$$recordElmt.toggleClass("s-m-multi-selected"),this._panel.multiSelectionController.multiSelToggleRecord($$recordElmt.is(".s-m-multi-selected"))},multiSelExit:function(){this._array.multiSelExit(),this._panelRun.multiSelectionController.multiSelRunExit(),this._processTogglePanel(!1),this.multiSelToggleStatus()},multiSelTriggerAction:function($actionName,event){if($actionName==="showdiagnoses")this._array.multiSelShowDiagnoses(event);else if($actionName==="stop")this._processRunning=!1;else if($actionName==="exit")this.multiSelExit();else{$('<div id="multiSelSpinner"><div><div class="spinner-loader"></div></div></div>').appendTo(this._page.$$contentElmt),this._processRunning=!0;var self=this,_end=function(status){$("#multiSelSpinner").remove(),self._processRunning=!1,self._panelRun.multiSelectionController.multiSelRunStop()};this._processRun($actionName).then(function(status){_end(status)}).fail(function(error){modules.get("modal").asynchError(locale.text("multiselect.processAll.fail"),error).then(function(){_end("stop")})})}},_isProcessingData:function(){return this._processRunning===!0},_processRun:function($actionName){var self=this,nbOk=0,nbKo=0;return $.smResolve().then(function(){return self._processTogglePanel(!0),self._panelRun.multiSelectionController.multiSelStartProcessing(),{$actionName:$actionName,data:self.getSelectedData(!0),link:protoHelpers.adjustLinkProtocol(self._page.controller.dataset.getLink($actionName),self._getUsedProtocol())}}).then(function(info){if(!info.link||!info.data)return null;var deferred=$.Deferred(),_exec=function(idx){idx>=info.data.length?deferred.resolve("end",info):self._processOne(info,idx).then(function(status){if(status==="stop"){deferred.resolve("stop",info);return}status==="success"?nbOk++:nbKo++,self._panelRun.multiSelUpdateCounter(nbOk,nbKo),_exec(idx+1)}).fail(function(e){deferred.reject(e)})};return _exec(0),deferred.promise()})},_processOne:function(info,idx){var step;info.link.$url==="$UnitTesturl"?step=this._procesUnitTestUrl(info,idx):step=this._processUrl(info,idx);var self=this;return step.then(function(success,result){if(!self._isProcessingData())return"stop";var diagsMsg=[],diagsErr=[];$.isPlainObject(result)&&(sdataUtils.scanDiagnoses(result)||[]).forEach(function(d){d.$severity==="error"?diagsErr.push(d):diagsMsg.push(d)});var diags=info.data[idx];return success=success&&diagsErr.length==0,success?diags.$diagnoses=diagsMsg:jsutils.isError(result)?diags.$diagnoses=[{$message:result.message,$stackTrace:result.stack}]:diags.$diagnoses=diagsErr,diags.status=success?"success":"error",self._array.multiSelAddDiagnoses(diags),diags.status})},_processUrl:function(info,idx){var rowDataSet=info.data[idx].rowData,self=this,deferred=$.Deferred(),$url=rowDataSet.resolveExpression(info.link.$url,!0);return info.link.$parameters&&$.each(info.link.$parameters,function(paramName,paramValue){if(paramValue.indexOf("{")>-1){var pv2=rowDataSet.resolveExpression(paramValue);pv2&&pv2.length>0?paramValue=encodeURIComponent(pv2):paramValue=encodeURIComponent(paramValue)}$url=$url.replace("{"+paramName+"}",paramValue)}),sdataReq.executeLink($url,"GET",rowDataSet).then(function(response){var delta=response.data;return delta?self._mergeDelta(delta).then(function(){return response}):response}).then(function(result){deferred.resolve(result.success===!0,result)}).fail(function(e){deferred.resolve(!1,jsutils.convertToDiagnoses(e))}),deferred.promise()},_procesUnitTestUrl:function(info,idx){var deferred=$.Deferred();return setTimeout(function(){idx%2==0?deferred.resolve(!0,{$diagnoses:[{$message:"test succeeded idx="+idx,$severity:"success"}]}):deferred.resolve(!1,{$diagnoses:[{$message:"test failed idx="+idx,$severity:"error"}]})},1e3),deferred.promise()},_processTogglePanel:function(show){if(this._panelRun==null){var panelInfo={name:"headerMultiselRun",topIndex:0,selector:"header",$type:"application/x-panel-header-multisel-run"};this._panelRun=this._page.attachedControlsMgr.createAddtionalControl(panelInfo,{})}return this._page.attachedControlsMgr.toggleControls("headerMultiselRun","headerMultisel",show),this._panelRun},getSelectedData:function(disableClick){return this._array.multiSelGetSelectedData(disableClick)}})}),define("syracuse-tablet/html/js/sdata/sdataSyncUtils",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/prototype","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/common/ajax"],function(require,exports,module){function _resolvePrototype(opts,node,urlList){node.uuid=utils.UUID(),node.$children=[];if(opts.level>=opts.maxLevels)return $.smResolve(node);var $links;if(opts.prototype.getFacet()==="$query"){var $resources=opts.prototype.getPropertyData("$resources");$resources&&$resources.$item&&$resources.$item.$links&&$resources.$item.$links.$details&&($links={$details:$resources.$item.$links.$details})}else{if(opts.prototype.getFacet()!=="$details")return $.smResolve(node);$links=opts.prototype.data("$links"),$links&&$links.$edit&&(node.$canEdit=!0)}return $links?$.smForEachPromise(Object.keys($links),function(name){var link=$links[name];if(_isCacheableLink(link,name,urlList)){var repr=_getRepresentation(link);if(repr){urlList.push(link.$url);var child={$name:name,$title:opts.prototype.resolveExpression(link.$title),$link:link,$representation:repr};return node.$children.push(child),_processNode(child,opts,urlList)}}return $.smResolve(node)}).then(function(){if(node.$canEdit){node.$editLink=$links.$edit;var repr=_getRepresentation(node.$editLink),protoName=_getProtoName({$representation:repr},{prototype:opts.prototype});return _getPrototypeObject(protoName,repr,opts.prototype).then(function(proto){node.$editPrototype=proto})}}).then(function(){return node}):$.smResolve(node)}function _isCacheableLink(link,name,urlList){if(urlList.indexOf(link.$url)>-1)return!1;if(name.indexOf("$")===0&&name!=="$details")return!1;if(link.$method!=="GET"&&link.$method!=null)return!1;if(link.$url.indexOf("/$services/")>-1)return!1;if(link.$url.indexOf("representation=")<0)return!1;var repr=_getRepresentation(link);return!repr||repr.indexOf(".$details")<0&&repr.indexOf(".$query")<0?!1:!0}function _getRepresentation(link){var repr=/[\?\&]representation=(\S+?)(&|$)/.exec(link.$url);return repr&&repr[1]}function _processNode(node,opts,urlList){return _getPrototypeObject(_getProtoName(node,opts),node.$representation,opts.prototype).then(function(proto){return proto?(node.$prototype=proto,node.$name==="$details"&&(node.$title=proto.data("$title"),node.$isDetails=!0),_resolvePrototype({prototype:proto,level:opts.level+1,maxLevels:opts.maxLevels},node,urlList)):proto})}function _getPrototypeObject(protoName,$representation,baseProto){return metaDataCache.getPrototype(protoName).then(function(proto){if(!proto&&$representation){var $prototypeUrl=baseProto.resolveExpression("{$baseUrl}/$prototypes('"+$representation+"')",!0);return ajax.request($prototypeUrl).then(function(proto){return proto&&proto.data?(metaDataCache.putPrototype(protoName,proto.data),proto.data):null}).fail(function(){return null})}return proto}).then(function(proto){return $.isEmptyObject(proto)?null:new prototypeModule.Prototype(proto)})}function _getProtoName(node,opts){var endpoint=opts.prototype.data("$baseUrl");return endpoint=endpoint.split("/"),endpoint=endpoint.slice(endpoint.length-3,endpoint.length).join("."),endpoint+"."+node.$representation}var utils=require("syracuse-tablet/html/js/helpers/utils"),prototypeModule=require("syracuse-tablet/html/js/sdata/prototype"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),ajax=require("syracuse-tablet/html/js/common/ajax"),_syncMaxLevels=6;exports.getSyncStructure=function(prototype){var node={$title:prototype.data("$title")},urlList=[];return _resolvePrototype({prototype:prototype,level:1,maxLevels:_syncMaxLevels},node,urlList)}}),define("syracuse-tablet/html/js/ui/modals/modalSyncOffline",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/sdata/sdataSyncUtils","syracuse-tablet/html/js/sdata/sdataRequesterOffline","syracuse-tablet/html/js/common/ajax"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),sdataSyncUtils=require("syracuse-tablet/html/js/sdata/sdataSyncUtils"),sdataRequesterOffline=require("syracuse-tablet/html/js/sdata/sdataRequesterOffline"),ajax=require("syracuse-tablet/html/js/common/ajax"),_templateAll={header:'			<buttons class="pull-right"> 				<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-action="$cancel"></button> 			</buttons> 			<div class="modal-title">{{title}}</div> 			',content:' 			<div class="s-m-scroll-wrapper s-m-scroll-wrapper-v">			<div class="s-m-scroll-element"> 				<div class="form-group" id="s-m-sync-no-data-id"> 					<div class="panel s-m-panel-diag-error"><div class="panel-heading">{{label_errors}}</div><ul></ul></div> 					<center>{{label_no_data}}</center>				</div> 				<div class="form-group" id="s-m-sync-actions-id" style="display: none"> 					<center> 						<button type="button" class="btn btn-default s-m-modal-btn-sync" data-action="modal-sync">{{label_sync}}</button> 						<button type="button" class="btn btn-default s-m-modal-btn-sync-stop hidden" data-action="modal-sync-stop">{{label_sync_stop}}<div class="s-m-sync-total"><span class="label label-success ok"></span><span class="label label-danger error"></span></div></button> 					</center> 				</div> 				<div class="form-group" id="s-m-sync-tree-id"> 					<label>{{label_tree}}</label> 					<div id="s-m-sync-tree-id"></div> 				</div> 			</div> 			</div>',footer:""},_Klass=utils.defineClass(function ModalSyncOffline(syncRootData){var self=this;modalDialog.ModalBase.call(self),self.syncRootData=syncRootData},modalDialog.ModalBase,{_getTemplates:function(){var self=this;return{std:_templateAll}},getDisplayFlags:function(){var self=this,displayFlags=self.displayFlags||{};return self.deviceType==="tablet"?displayFlags.modalClass="sync-offline half_right":displayFlags.modalClass="sync-offline full",displayFlags},_getDataContext:function(){var self=this,data={title:locale.text("modal.sync.title"),label_tree:locale.text("modal.sync.header.tree"),label_sync:locale.text("modal.sync.label_sync"),label_sync_stop:locale.text("modal.sync.label_sync_stop"),label_no_data:locale.text("modal.sync.nodata"),label_errors:locale.text("modal.sync.errors")};return data},_onShow:function(){var self=this;modalDialog.ModalBase.prototype._onShow.call(self),sdataSyncUtils.getSyncStructure(self.syncRootData.pageProto).then(function(tree){self.syncTreeRoot=tree,self.syncTreeRoot?self._buildStructHtml(tree):self._noData()}).fail(function(e){self._noData(e)})},_noData:function(e){var self=this;$("#s-m-sync-no-data-id").show(),$("#s-m-sync-actions-id").hide(),$("#s-m-sync-tree-id").hide();var $$ul=$("#s-m-sync-no-data-id ul");$$ul.empty(),e=e?jsutils.convertToDiagnoses(e):null,e=e?e.$diagnoses:null;if(e&&e.length){$("#s-m-sync-no-data-id .panel").show();var i;for(i=0;i<e.length;i++){var msg=e[i]&&e[i].$message;if(msg){var $$li=$("<li>");$$li.text(msg),$$ul.append($$li)}}}else $("#s-m-sync-no-data-id .panel").hide()},_buildStructHtml:function(node){var self=this;$("#s-m-sync-no-data-id").hide(),$("#s-m-sync-actions-id").show(),$("#s-m-sync-tree-id").show();var $$sync=$("#s-m-sync-tree-id"),$$ul=$("<ul>");self._addNode($$ul,node,0),$$sync.append($$ul)},_addNode:function($$parent,node,level){var self=this,cls=level>0?"collapsed":"expanded";cls+=level<1?" selected":"";var $$li=$('				<li class="s-m-sync-tree-item '+cls+'" data-params="'+node.uuid+'"> 					<div class="s-m-tree-icon-expand" data-action="tree-click-expand" data-params="'+node.uuid+'"></div> 					<div class="s-m-tree-label" data-action="tree-click-select" data-params="'+node.uuid+'"></div> 					<div class="s-m-sync-count hidden"><div>"				</li>');$("div.s-m-tree-label",$$li).text(node.$title),$$parent.append($$li);if(node.$children.length>0){var $$ul=$("<ul>");if(node.$isDetails!==!0){var child=node.$children[0];child&&child.$children&&child.$children.length>0&&($$li.append($$ul),child.$children.forEach(function(child){self._addNode($$ul,child)}))}else node.$children&&node.$children.length>0&&($$li.append($$ul),node.$children.forEach(function(child){self._addNode($$ul,child)}))}if($("ul",$$li).length<1){var $$expand=$(">.s-m-tree-icon-expand",$$li);$$expand.removeClass("s-m-tree-icon-expand"),$$expand.addClass("s-m-tree-icon-leaf"),$$expand.attr("data-action",null)}},_onAction:function(action,param){var self=this;return action==="tree-click-expand"?self._onTreeClickExpand(param):action==="tree-click-select"?self._onTreeClickSelect(param):action==="modal-sync"?self._syncData():action==="modal-sync-stop"&&(self.stopSync=!0),!1},_onValidate:function(){},_onCancel:function(){},_getResult:function(){return"done"},_onTreeClickExpand:function(param){var self=this,$$li=$('li[data-params="'+param+'"]');$$li.hasClass("expanded")?($$li.removeClass("expanded"),$$li.addClass("collapsed")):($$li.addClass("expanded"),$$li.removeClass("collapsed"))},_onTreeClickSelect:function(param){var self=this,$$li=$('li[data-params="'+param+'"]');$$li.hasClass("selected")?($$li=$$li.add("li",$$li),$$li.removeClass("selected")):($$li=$$li.add("li",$$li),$$li.addClass("selected"))},_syncData:function(){var self=this;self.stopSync=!1;var $$li=$('li[data-params="'+self.syncTreeRoot.uuid+'"]');$('button[data-action="modal-sync"]',self.$$elmt).addClass("hidden"),$('button[data-action="modal-sync-stop"]',self.$$elmt).removeClass("hidden"),self.syncCount=0,self.errorCount=0,self._updateErrorCount(),$.smForEachPromise(self.syncRootData.rowsData,function(row,idx,cnt){return self.stopSync?$.smResolve():(self._updateSyncCount($$li,idx,cnt),self._syncNodeData(self.syncTreeRoot,row))}).always(function(e){$('button[data-action="modal-sync"]',self.$$elmt).removeClass("hidden"),$('button[data-action="modal-sync-stop"]',self.$$elmt).addClass("hidden")})},_updateSyncCount:function($$li,idx,cnt){var self=this,$$state=$(">div.s-m-sync-count",$$li);$$state.removeClass("hidden"),$$state.text(idx+1+" / "+cnt);var $$states=$("li>div.s-m-sync-count",$$li);$$states.addClass("hidden")},_updateErrorCount:function(){var self=this,$$total=$('button[data-action="modal-sync-stop"]>.s-m-sync-total',self.$$elmt),$$ok=$(">.ok",$$total),$$error=$(">.error",$$total);$$ok.text(self.syncCount),$$error.text(self.errorCount)},_syncNodeData:function(node,parentData){var self=this,$$li;if(self.stopSync)return $.smResolve();if(node.$isDetails!==!0){$$li=$('li[data-params="'+node.uuid+'"]');if($$li.length<1)return $.smResolve();if(!$$li.hasClass("selected"))return $.smResolve();node.$$listItem=$$li}node.$$listItem.addClass("sync-progress");var nodeData;return node.$link?nodeData=self._readNodeData(node,parentData):nodeData=$.smResolve(parentData),nodeData.then(function(nodeData){var dataItems=nodeData&&nodeData.$resources;return!dataItems&&nodeData&&(dataItems=[nodeData]),dataItems?$.smForEachPromise(dataItems,function(dataItem,idx,cnt){return self.stopSync?$.smResolve():(nodeData.$resources&&self._updateSyncCount($$li,idx,cnt),$.smForEachPromise(node.$children,function(child){return self.stopSync?$.smResolve():(child.$$listItem=$$li,self._syncNodeData(child,dataItem))}).then(function(){node.$$listItem.addClass("sync-progress")}))}):$.smResolve(null)}).then(function(){node.$$listItem.removeClass("sync-progress")})},_readNodeData:function(node,parentData){var self=this,deferred=$.Deferred(),linkUrl=utils.parseExpression(node.$link.$url,parentData,node.$prototype);return ajax.request(linkUrl,"GET").then(function(result){return sdataRequesterOffline.writeToCache(linkUrl,"GET",result.data,node.$prototype.json),node.$editLink?self._readEditNodeData(node,result.data).then(function(){return self.syncCount++,self._updateErrorCount(),deferred.resolve(result.data),result.data}):(self.syncCount++,self._updateErrorCount(),deferred.resolve(result.data),result.data)}).fail(function(){self.errorCount++,self._updateErrorCount(),deferred.resolve(null)}),deferred.promise()},_readEditNodeData:function(node,parentData){var self=this,deferred=$.Deferred(),linkUrl=utils.parseExpression(node.$editLink.$url,parentData,node.$editPrototype);return ajax.request(linkUrl,"GET").then(function(result){return sdataRequesterOffline.writeToCache(linkUrl,"GET",result.data,node.$editPrototype.json),deferred.resolve(result),result.data}).fail(function(){deferred.resolve(null)}),deferred.promise()}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/multiselection/downloadController",["require","exports","module","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalSyncOffline"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,utils=require("syracuse-tablet/html/js/helpers/utils"),modalSyncOffline=require("syracuse-tablet/html/js/ui/modals/modalSyncOffline");exports.DownloadController=utils.defineClass(function DownloadController(queryPage){if(queryPage==null||queryPage.isFacet==null||!queryPage.isFacet("$query"))throw new Error("Sdata query page expected");Base.call(this,queryPage.pageData.dataset,null,queryPage.isWorkingCopyDataUrl()),this.page=queryPage},Base,{destroy:function(){Base.prototype.destroy.call(this),this.page==null},multiSelTriggerDownload:function(){var syncRootData={pageProto:this.page.getPrototype(),rowsData:[]},selectedData=this.page.multiSelectionController.getSelectedData();selectedData.forEach(function(selectedItem){var rowDataSet=selectedItem.rowData;syncRootData.rowsData.push(rowDataSet.json)});var modal=new modalSyncOffline.Modal(syncRootData);modal.show().then(function(result){})}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataQuery",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/multiselection/multiSelectionMainController","syracuse-tablet/html/js/multiselection/downloadController"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),MultiSelectionController=require("syracuse-tablet/html/js/multiselection/multiSelectionMainController").MultiSelectionMainController,DownloadController=require("syracuse-tablet/html/js/multiselection/downloadController").DownloadController;exports.Page=utils.defineClass(function PageSdataQuery(pageData,options){options=options||{},options.nativeCapabilities={liveTile:!0,scheduleMessage:!0,share:!0},Base.call(this,pageData,options),this.actionAdapter.showSortFilter=!0,this.actionAdapter.showSearch=!0,this.multiSelectionController=null,this.downloadController=null},Base,{destroy:function(){Base.prototype.destroy.call(this),this.multiSelectionController&&(this.multiSelectionController.destroy(),this.multiSelectionController=null),this.downloadController&&(this.downloadController.destroy(),this.downloadController=null)},_actMultiSelToggle:function(){if(!this.attachedControlsMgr)return;this.multiSelectionController||(this.multiSelectionController=new MultiSelectionController(this)),this.multiSelectionController.multiSelToggleStatus()!==!0&&this.$$contentElmt.find(".s-m-multi-selected").removeClass("s-m-multi-selected")},_actSortFilter:function(){var array=this.getQueryArray();if(!array)return;array._openFilterSortPanel()},multiSelectionIsEnabed:function(){return this.multiSelectionController!=null&&this.multiSelectionController.isEnabled},getQueryArray:function(){var array=this.controller.getControlsByType("application/x-array");if(array.length!==1)throw new Error("One and only one array is expected in a query facet");return array[0]},isDownloadEnabled:function(){return this.isStateLessMode()&&this.getAuthoring("$allowDownload")===!0},_actMultiSelTriggerDownload:function(){this.downloadController||(this.downloadController=new DownloadController(this)),this.downloadController.multiSelTriggerDownload()},_actMultiSelTriggerAction:function(params,event){if(!this.multiSelectionIsEnabed())return;this.multiSelectionController.multiSelTriggerAction(params,event)},fetchNewPageData:function($link){return this._oldX3FilterAuth=this.getQueryArray().$filtersGetAuthoring(),Base.prototype.fetchNewPageData.call(this,$link)},authUpdateLayout:function(article){var step=$.smResolve();if(this.getQueryArray().$filtersGetAuthoring()=="none"&&this._oldX3FilterAuth!="none"){var url=jsutils.parseURL(this.pageData.$url);url.query&&url.query.filter&&(url.query.filter="",step=this.fetchNewPageData({$url:jsutils.urlToString(url)}))}var self=this;return step.then(function(){return Base.prototype.authUpdateLayout.call(self,article)})}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataLookup",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdataQuery","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdataQuery").Page,utils=require("syracuse-tablet/html/js/helpers/utils");exports.Page=utils.defineClass(function PageSdataLookup(pageData,options){Base.call(this,pageData,options),this.controller.isLookupController=!0,this.controller.lookupData=options.lookup},Base,{destroy:function(){Base.prototype.destroy.call(this)}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataDashboard",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/sdata/protocolHelpers"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,notifications=require("syracuse-tablet/html/js/helpers/notifications"),utils=require("syracuse-tablet/html/js/helpers/utils"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers");exports.Page=utils.defineClass(function PageSdataDashboard(pageData,options){options=options||{},Base.call(this,pageData,options),this._nbVignettesLoaded=0,this._dataFreshness={dateTime:(new Date).getTime(),level:"fresh"},this.actionAdapter.showPinPage=this.controller.canBePinned(),this._savedVignetteContext=null,this._parseParameters()},Base,{destroy:function(){Base.prototype.destroy.call(this),this._savedVignetteContext=null,this._vignettes=null},build:function(){return this._publishOptions=null,this._vignettes=null,this._vignettesLoaded=$.Deferred(),Base.prototype.build.call(this)},afterRender:function(){Base.prototype.afterRender.call(this);var vignettes=this._getVignettes();vignettes.length==0&&this.afterAllVignettesLoaded(),this._nbVignettesLoaded=0},getPageTitle:function(){var ttl=this.controller.dataset.getValue("title");return ttl||(ttl=ttl=this.controller.dataset.getValue("$title")),ttl||(ttl=Base.prototype.getPageTitle.call(this)),ttl},onVignetteLoaded:function(vignette,success){var self=this;success&&this._updateDataFreshness(vignette),this._nbVignettesLoaded++;var vignettes=this._getVignettes();if(this._nbVignettesLoaded>=vignettes.length&&vignettes.length>0){var self=this;setTimeout(function(){vignettes.forEach(function(v){v.afterAllVignettesLoaded()}),self.afterAllVignettesLoaded()})}},afterAllVignettesLoaded:function(){this.onContentChanged(),this.actionAdapter.showPageShare=this._checkSharePanelActive(),notifications.publish(["sm.all.vignettes.loaded"],this),this._vignettesLoaded.resolve()},_updateDataFreshness:function(vignette){var childPage=vignette&&vignette.getTopPage(),dataset=childPage&&childPage.controller&&childPage.controller.dataset;if(dataset){var freshness=dataset.getDataFreshness();this._dataFreshness.dateTime>freshness.dateTime&&(this._dataFreshness.dateTime=freshness.dateTime,this._dataFreshness.level=freshness.level,notifications.publish("sm.data.freshness.change",this._dataFreshness))}},getAuthoringName:function(){var $url=this.pageData.$url,key=this.pageData.dataset.json.dashboardName,ep=protoHelpers.getEndpointFromUrl($url);return ep=ep.split(".").slice(0,2).join("."),ep+"."+key+".$mobileDashboard"},getAuthoringFullName:function(){var $url=this.pageData.$url,key=this.pageData.dataset.json.dashboardName,ep=protoHelpers.getEndpointFromUrl($url);return ep=ep.split(".").slice(0,3).join("."),ep+"."+key+".$mobileDashboard"},authUpdateLayout:function(article){var self=this;return Base.prototype.authUpdateLayout.call(self,article).then(function(){return self._vignettesLoaded})},isDashboard:function(typeDashboard){return typeDashboard==null?!0:this.rootLayout?this.rootLayout.$type===typeDashboard:!0},scrollAllowed:function(){return!this.isDashboard("hub")},getGestureMgr:function(){return this.isDashboard("hub")&&this.rootLayout?this.rootLayout.getGestureMgr():Base.prototype.getGestureMgr.call(this)},savedCtxCreate:function(opts){if(this.destroyed)return;var ctx=Base.prototype.savedCtxCreate.call(this,opts);ctx.vignettes=[];var p;return this._getVignettes().forEach(function(v){ctx.vignettes.push(v.getTopPage()?v.getTopPage().savedCtxCreate(opts):null)}),this.isDashboard("hub")&&this.rootLayout&&(ctx.hubCtx=this.rootLayout.savedCtxCreate(opts)),ctx},savedCtxRestore:function(ctx){if(this.destroyed)return;Base.prototype.savedCtxRestore.call(this,ctx),this._savedVignetteContext=ctx.vignettes,ctx.hubCtx&&this.isDashboard("hub")&&this.rootLayout.savedCtxRestore(ctx.hubCtx)},getSavedCtxVignette:function(v){if(v==null)return null;this._savedVignetteContext==null&&(this._savedVignetteContext=this.options.savedCtx&&this.options.savedCtx.vignettes||[]);var idx=this._getVignettes().indexOf(v);return idx==-1||idx>this._savedVignetteContext.length-1?null:this._savedVignetteContext[idx]},_getVignettes:function(){return this._vignettes==null&&(this._vignettes=this.controller.getControlsByType("application/x-vignette")||[]),this._vignettes},getPagePublishOptions:function(){if(this._publishOptions)return this._publishOptions;if(this.options.isChild)return this._publishOptions={},this._publishOptions;var opts={scheduleMessage:{page:this},share:{page:this}},queryVignettes=[];return this._getVignettes().forEach(function(v){var page=v.getTopPage();page&&page.pageData&&page.pageData.prototype.isQueryLikeFacet()&&queryVignettes.push(page)}),queryVignettes.length>0&&(opts.liveTile={page:this,pages:queryVignettes}),this._publishOptions=opts,this._publishOptions},_parseParameters:function(){this._dashboardParams=protoHelpers.getDashboardParams(this.pageData.$url)},getGadgetParams:function(){return this._dashboardParams||{}},getPinPageData:function(){var name=this.pageName.split("."),clientContext=this.pageData.dataset.getValueByPath("$clientContext");return{$type:"$dashboard",$title:this.getPageTitle(),applicationName:clientContext.$mobileApplication,id:this.getPinPageId(),name:name[0],icon:"star"}}})}),define("syracuse-tablet/html/js/controllers/homeController",["require","exports","module","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/notifications"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules"),notifications=require("syracuse-tablet/html/js/helpers/notifications");exports.HomeController=utils.defineClass(function HomeController(dataset,page,options){this.page=page,this.options=options||{},this.configActive=options.forceConfigActive,Base.call(this,dataset),this.isWorkingCopy=!1},Base,{destroy:function(){Base.prototype.destroy.call(this)},headerFooterToggle:function(){var isSmartphone=modules.get("siteLayout").getDeviceType()==="smartphone";if(this._header==null||this._header.actionAdapter==null){var panelInfo;panelInfo={name:"headerEditHome",topIndex:0,selector:"header",$type:"application/x-panel-header-edithome"},this._header=this.page.attachedControlsMgr.createAddtionalControl(panelInfo,{})}if(this._footer==null||this._footer.actionAdapter==null)isSmartphone?panelInfo={name:"footerEditHome",bottomIndex:0,selector:"footer",$type:"application/x-panel-footer-edithome-smartphone"}:panelInfo={name:"footerEditHome",bottomIndex:0,selector:"footer",$type:"application/x-panel-footer-edithome-tablet"},this._footer=this.page.attachedControlsMgr.createAddtionalControl(panelInfo,{});this.page.attachedControlsMgr.toggleControls("headerEditHome","header"),this.page.attachedControlsMgr.toggleControls("footerEditHome","footer"),this.page.computeLayout()},isActionHidden:function(action){return action==="myDashboard"&&this.page.isPersonal()},factoryId:function(){var app=modules.get("appController").App;return app._currentUserProfile.securityProfile.factoryId},showMyDashboardTemplates:function(){var factoryId=this.factoryId();return factoryId!=null&&factoryId!=""},toggleConfig:function(saveContext){saveContext?this.saveContext():this.restoreContext(),this.configActive?this.page._disabledConfig():this.page._enabledConfig()},disabledConfig:function(){this.headerFooterToggle(),this.configActive=!1},enabledConfig:function(forceShow){this.headerFooterToggle(forceShow),this.configActive=!0},isConfigActive:function(){return this.configActive},rolesChange:function(){notifications.publish(["sm.dashboard.roles.change"]),this.setDirty(!0)},dashboardDescriptionChange:function(newDescription){this.saveContext(),this.page.pageData.meta.description=newDescription,this.setDirty(!0)},setDirty:function(dirty){this._dirty=dirty,notifications.publish(["sm.dashboard.state.change"],dirty)},isDirty:function(){return this._dirty},saveContext:function(){this._article=this._article||$.extend(!0,{},this.page.getArticle()),this._meta=this._meta||$.extend(!0,{},this.page.pageData.meta)},restoreContext:function(){this.page.pageData.page.$article=$.extend(!0,{},this._article||this.page.getArticle()),this.page.pageData.meta=$.extend(!0,{},this._meta||this.page.pageData.meta),this.cleanContext()},cleanContext:function(){this._article=null,this._meta=null}})}),define("syracuse-tablet/html/js/ui/modals/modalChoose",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalDialogScroll"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_templateAll[name])),tmpl(ctx)}var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/ui/modals/modalDialogScroll").ModalDialogScroll,_templateAll={content:' 		<div class="list-group">			{{#each elmts}} 				<a draggable="false" href="#" class="list-group-item  {{selected}}" data-action="clickLine" data-params="{{dataParams}}">					<h4 class="list-group-item-heading">{{title}}</h4>					{{#if info}}						<p class="list-group-item-text">{{info}}</p>					{{/if}}				</a>			{{/each}} 		</div>'},_templates={};exports.ModalChoose=utils.defineClass(function ModalChoose(dataList){Base.call(this,dataList),this.dataList=[],this.dataList=$.extend(!0,[],dataList),this.selected={}},Base,{getDisplayFlags:function(){var opts={tablet:"half_right",smartphone:"full"};return Base.prototype.getDisplayFlags.call(this,opts)},_getDataContext:function(datactx,opts){var ctx=Base.prototype._getDataContext.call(this),content=_getHtml("content",{elmts:datactx}),extendedCtx=$.extend(!0,ctx,{buttonValidate:opts.buttonValidate,title:opts.title,content:content});return extendedCtx},_onAction:function(action,param){var self=this;if(action==="clickLine"){var $$item=self.$$elmt.find('[data-params="'+param+'"]');self.selected[param]?($$item.removeClass("active"),delete self.selected[param]):($$item.addClass("active"),$$item.selected[param]=self._selectedElmt(param))}return!1},_selectedElmt:function(key){var match;return this.dataList.some(function(elmt){if(elmt.key===key)return match=elmt,!0}),match},_getResult:function(){var self=this;return Object.keys(self.selected).map(function(key){return self.selected[key]})}})}),define("syracuse-tablet/html/js/ui/modals/modalChooseApps",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalChoose"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalChoose").ModalChoose,_Klass=utils.defineClass(function ModalChooseApps(dataList){Base.call(this,dataList)},Base,{_getDataContext:function(){var datactx=[];return this.dataList.forEach(function(a){datactx.push({title:a.title,info:a.description,dataParams:a.applicationName}),a.key=a.applicationName}),Base.prototype._getDataContext.call(this,datactx,{buttonValidate:!0,title:locale.text("welcome.select.app.title")})},_onAction:function(action,param){var self=this;if(action==="clickLine"){var $$item=self.$$elmt.find('[data-params="'+param+'"]');self.selected[param]?($$item.removeClass("active"),delete self.selected[param]):($$item.addClass("active"),self.selected[param]=self._selectedElmt(param))}return!1},_selectedElmt:function(key){var match;return this.dataList.some(function(elmt){if(elmt.key===key)return match=elmt,!0}),match},_getResult:function(){var self=this;return Object.keys(self.selected).map(function(key){return self.selected[key]})},_onCancel:function(){this.selected={}}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalChooseDashboardGroup",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalChoose"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalChoose").ModalChoose,_Klass=utils.defineClass(function ModalChooseDashboardGroup(dataList){Base.call(this,dataList),this.selectedGroup={}},Base,{_getDataContext:function(){var datactx=[];return this.dataList.forEach(function(a){datactx.push({title:a.title,dataParams:a.id}),a.key=a.id}),Base.prototype._getDataContext.call(this,datactx,{title:locale.text("welcome.move.tile.title")})},_onCancel:function(){this.selected=null},_onAction:function(action,param){return action==="clickLine"&&(this.selected=param),!0},_getResult:function(){return this.selected}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalConfigTile",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalDialogScroll","syracuse-tablet/html/js/ui/fontUtils","syracuse-tablet/html/js/authoring/authoringProperties"],function(require,exports,module){function _getHtml(name,ctx){var tmpl=_templates[name];return tmpl||(tmpl=_templates[name]=Handlebars.compile(_templateAll[name])),tmpl(ctx)}var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalDialogScroll").ModalDialogScroll,fontUtils=require("syracuse-tablet/html/js/ui/fontUtils"),authoringProperties=require("syracuse-tablet/html/js/authoring/authoringProperties"),_templateAll={content:' 		<div class="s-m-item-group">		<label>{{lab_group}}</label> 			{{{dropDownGroup}}}		</div>		<div class="s-m-item-group">		<label>{{lab_size}}</label> 		{{{dropDownSize}}}		</div>		<label>{{lab_color}}</label> 		<div class="s-m-list-colors">			{{#each colors}} 				<a draggable="false" href="#" {{#if active}}class="active"{{/if}} data-action="clickColor" data-params="{{value}}">					<div class="s-m-bg s-m-color-{{value}}"> 					</div> 				</a>			{{/each}} 		</div> 		<label>{{lab_icon}}</label> 		<div class="s-m-list-icons">			{{#each icons}} 				<a draggable="false" href="#" {{#if active}}class="active"{{/if}} data-action="clickIcon" data-params="{{value}}"> 					<i class="{{label}}"/> 				</a>			{{/each}} 		</div> 		<div style="width:100%; display: inline-block;"></div>',dropDown:'		<div id="{{action}}" class="btn-group">			<div class="{{dropDirection}}">				<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">					<span class="s-m-selected-value">{{selectedValue}}</span><span class="caret"></span>				</button>				<ul class="dropdown-menu dropdown-menu-left" role="menu">					{{#each elmts}}						<li><a  {{#if $isHidden}}style="display:none"{{/if}} draggable="false" data-action="{{../action}}" data-params="{{value}},{{label}}" href="#">{{label}}</a></li>					{{/each}}				</ul>			</div>		</div>'},_templates={},_Klass=utils.defineClass(function ModalConfigTile(opts){var self=this;Base.call(self),self.tile=opts.tile,self.groups=opts.groups,self.result=null},Base,{getDisplayFlags:function(){var opts={tablet:"config-tile half_right",smartphone:"config-tile full"};return Base.prototype.getDisplayFlags.call(this,opts)},_getDataContext:function(){var self=this,ctx=Base.prototype._getDataContext(this);authoringProperties.initProperties();var properties=authoringProperties.getAllProperties(),data={lab_addgroup:locale.text("welcome.dashboard.add.group"),lab_group:locale.text("welcome.tile.cfg.lab_group"),lab_title:locale.text("welcome.tile.cfg.lab_title"),lab_color:locale.text("welcome.tile.cfg.lab_color"),lab_size:locale.text("welcome.tile.cfg.lab_size"),lab_icon:locale.text("welcome.tile.cfg.lab_icon"),currentSize:self.tile.size};data.colors=properties.tileColor.values.map(function(e){return{active:self.tile.color===e.value,value:e.value,label:e.label}}),data.sizes=properties.tileSize.values.map(function(e){return{active:self.tile.size===e.value,value:e.value,label:e.label}}),data.icons=fontUtils.getTileIconList().map(function(e){var cls=fontUtils.getIconByName(e);return{active:self.tile.icon===e,value:e,label:cls}});var sizes={elmts:data.sizes,selectedValue:data.currentSize,action:"clickSize",dropDirection:"dropdown"};data.dropDownSize=_getHtml("dropDown",sizes);var opts={elmts:[{active:!1,value:"$new",label:locale.text("welcome.dashboard.new.group")}],action:"clickGroup",dropDirection:"dropdown"};self.groups.forEach(function(group){opts.elmts.push({active:group.current,value:group.id,label:group.title}),group.current&&(opts.selectedValue=group.title)}),data.dropDownGroup=_getHtml("dropDown",opts);var content=_getHtml("content",data),extendedCtx=$.extend(!0,ctx,{buttonValidate:!0,title:utils.isExpression(self.tile.title)&&self.tile.stackTitle?self.tile.stackTitle:self.tile.title,content:content});return extendedCtx},_onValidate:function(){var self=this,$$selected=self.$$elmt.find("a.active"),i,tile=$.extend(!0,{},self.tile),group;for(i=0;i<$$selected.length;i++){var action=$($$selected[i]).attr("data-action"),param=$($$selected[i]).attr("data-params"),params=param.split(",");switch(action){case"clickColor":tile.color=params[0];break;case"clickSize":tile.size=params[0];break;case"clickGroup":group=params[0];break;case"clickIcon":tile.icon=params[0]}}self.result={tile:tile,group:group}},_onCancel:function(){this.result=null},_onAction:function(action,param){var self=this,params=param.split(",");switch(action){case"clickSize":case"clickGroup":$("#"+action+" button .s-m-selected-value",self.$$elmt).text(params[1]),$("#"+action+" .open",self.$$elmt).removeClass("open");case"clickColor":case"clickIcon":var $$old=self.$$elmt.find('a.active[data-action="'+action+'"]'),$$new=self.$$elmt.find('a[data-action="'+action+'"][data-params="'+param+'"]');$$old.removeClass("active"),$$new.addClass("active")}return!1},_getResult:function(){return this.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalChooseWelcomeDashboard",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalChoose"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalChoose").ModalChoose,_Klass=utils.defineClass(function ModalChooseWelcomeDashboard(dataList){var self=this;Base.call(self,dataList.views),self.result=null},Base,{_getDataContext:function(){var self=this,datactx=[];return this.dataList.forEach(function(a){datactx.push({title:a.$description,info:a.$factoryOwner,selected:a.$selected?"active":"",dataParams:a.$uuid}),a.key=a.$uuid}),Base.prototype._getDataContext.call(this,datactx,{title:locale.text("welcome.dashboard.choose.template")})},_onCancel:function(){this.result=null},_onAction:function(action,param){return action==="clickLine"&&(this.result={selectedView:param}),!0},_getResult:function(){return this.result}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalChooseRoles",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/modals/modalChoose"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/ui/modals/modalChoose").ModalChoose,_Klass=utils.defineClass(function ModalChoosRoles(dataList){var self=this;Base.call(self,dataList),self.rolesSelected={}},Base,{_getDataContext:function(){var self=this,datactx=[];return self.dataList.forEach(function(a){datactx.push({title:a.$code,info:a.$description,dataParams:a.$uuid,selected:a.$selected}),a.key=a.$uuid,a.$selected&&(self.rolesSelected[a.$uuid]=!0)}),self.selectedRoles=$.extend(!0,{},self.rolesSelected),Base.prototype._getDataContext.call(self,datactx,{buttonValidate:!0,title:locale.text("welcome.select.roles.title")})},_onCancel:function(){this.selectedRoles=$.extend(!0,{},this.rolesSelected)},_onAction:function(action,param){var self=this;if(action==="clickLine"){var $$item=self.$$elmt.find('[data-params="'+param+'"]');self.selectedRoles[param]?($$item.removeClass("active"),delete self.selectedRoles[param]):($$item.addClass("active"),self.selectedRoles[param]=!0)}return!1},_getResult:function(){var self=this,change=self._compare(self.selectedRoles,self.rolesSelected);return{change:change,selectedRoles:Object.keys(self.selectedRoles)}},_compare:function(roles1,roles2){roles1=roles1||{},roles2=roles2||{};for(var prop in roles1)if(!roles2[prop])return!0;for(var prop in roles2)if(!roles1[prop])return!0;return!1}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/dragManager",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/uiUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),notifications=require("syracuse-tablet/html/js/helpers/notifications"),uiUtils=require("syracuse-tablet/html/js/ui/uiUtils"),defaultOptions={drag:{options:{containment:".s-m-main-content",disabled:!1,helper:"clone",opacity:1}},drop:{options:{tolerance:"pointer",hoverClass:"s-m-hover-droptarget"}}},_Klass=utils.defineClass(function DragManager(dragOpts,dropOpt,$$parent){this._notif=new Notifier,this._dropUI=new DropUI,this._init(dragOpts,dropOpt,$$parent),this.params,this.dragEnable=dragOpts.enable,notifications.subscribe(this,["sm.drag.state.change"])},null,{notifDragStateChange:function(enable){this.dragEnable=enable},destroy:function(){this._notif=null,$(this.dropOpts.selector).droppable("destroy"),$(this.dragOpts.selector).draggable("destroy"),this._dropUI.destroy()},_init:function(dragOpts,dropOpts,$$parent){var self=this;self.dropOpts=$.extend(!0,defaultOptions.drop,dropOpts),self.dragOpts=$.extend(!0,defaultOptions.drag,dragOpts),self._notif.register(self.dragOpts.notify),self._notif.register(self.dropOpts.notify),$(self.dropOpts.selector).droppable($.extend(!0,self.dropOpts.options,{drop:function(event,ui){self._notif.publish("drop",$(this),ui,self.params)},out:function(event,ui){self._notif.publish("out",$(this),ui)},over:function(event,ui){self._notif.publish("over",$(this),ui)}})),$(self.dragOpts.selector).draggable($.extend(!0,self.dragOpts.options,{create:function(event,ui){self._notif.publish("create",$(this),ui)},start:function(event,ui){ui.helper.css("z-index",2e3),ui.helper.addClass("s-m-dragElement"),self._notif.publish("start",$(this),ui)},drag:function(event,ui){if(!self.dragEnable)return!1;event.stopPropagation()},stop:function(event,ui){self.dragEnable=self.dragOpts.enable,self._notif.publish("stop",$(this),ui)},isOnDrag:function(){return self.dragEnable}}))},showIndicator:function(opts,params){this.params=params,this._dropUI.show(opts)},hideIndicator:function(){this._dropUI.hide()},getNotifs:function(){return this._notif.get()}}),DropUI=utils.defineClass(function DropUI(dragOpts,dropOpt,$$parent){this._elmt={}},null,{destroy:function(){this._elmt&&$(this._elmt).remove(),this._elmt=null},show:function(opts){this.hide(),this._elmt=uiUtils.createDomElement("div",["s-m-ui-drop"],null,null,opts.$$parent),opts&&opts.left&&(this._elmt.style.left=opts.left),opts&&opts.top&&(this._elmt.style.top=opts.top),opts&&opts.width&&(this._elmt.style.width=opts.width),opts&&opts.height&&(this._elmt.style.height=opts.height)},hide:function(){this.destroy()}}),Notifier=utils.defineClass(function Notifier(dragOpts,dropOpt,$$parent){this._notifs={}},null,{register:function(notifs){var self=this;if(!notifs)return;Object.keys(notifs).forEach(function(key){self._notifs[key]=notifs[key]})},get:function(event){var self=this;if(event)return self._notifs[event];var notif=[];return Object.keys(self._notifs).forEach(function(key){notif.push(self._notifs[key])}),notif},publish:function(event,$$elt1,$$elt2,params){var self=this;if(!event||!self.get(event))return;notifications.publish(self.get(event),$$elt1,$$elt2,params)}});exports.DragManager=_Klass}),define("syracuse-tablet/html/js/pages/sdata/pageHome",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdataDashboard","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/controllers/homeController","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/sdata/wpHelpers","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/cache/metaDataCache","syracuse-tablet/html/js/authoring/authoringHelpers","syracuse-tablet/html/js/ui/modals/modalChooseApps","syracuse-tablet/html/js/ui/modals/modalChooseDashboardGroup","syracuse-tablet/html/js/ui/modals/modalConfigTile","syracuse-tablet/html/js/ui/modals/modalConfirm","syracuse-tablet/html/js/ui/modals/modalChooseWelcomeDashboard","syracuse-tablet/html/js/ui/modals/modalChooseRoles","syracuse-tablet/html/js/helpers/notifications","syracuse-tablet/html/js/ui/dragManager"],function(require,exports,module){function _getAvailabeNotUsedApps(article,dataset){var boundApps=_getBoundApps(article,dataset);return metaDataCache.getApplicationsList().then(function(appList){var notUsedApps=[];return appList.forEach(function(app){boundApps.indexOf(app.applicationName)<0&&notUsedApps.push(app)}),wpHelpers.filterApps(notUsedApps)})}function _getAvailableRoles(currentRoles){var activeRoles={};return currentRoles&&(activeRoles=currentRoles.reduce(function(roles,current){return roles[current.$uuid]="active",roles},{})),wpHelpers.getListOfRoles().then(function(roles){return roles.forEach(function(role){activeRoles[role.$uuid]&&(role.$selected=activeRoles[role.$uuid])}),roles})}function _getBoundApps(article,dataset){function _checkBind($bind){var gadgetId=dataset[$bind],gadget=gadgetId&&dataset.$mobileGadgets[gadgetId];gadget&&gadget.$type==="$application"&&boundApps.push(gadget.applicationName)}var boundApps=[];return _getAllBinds(article).forEach(function($bind){_checkBind($bind)}),boundApps}function _getAllBinds(article){function _walk(node){node.$bind&&binds.push(node.$bind),node.$items&&node.$items.forEach(function($item){_walk($item)})}var binds=[];return _walk(article),binds}function _bindVignetteToHubGroupCtrl(hubGroupCtrl,vignetteUuid){var article=hubGroupCtrl.getArticle(),tileArticle={$bgColor:"darkgrey",$layoutType:"tile",$size:"medium"},tile=modules.get("ctrlFactory").createControl(hubGroupCtrl.controller,tileArticle,hubGroupCtrl,hubGroupCtrl.page),vignetteArticle={$bind:vignetteUuid},vignette=modules.get("ctrlFactory").createControl(tile.controller,vignetteArticle,tile,tile.page);return!0}function _addVignetteAndGadget(datasetJson,prototypeJson,app){var gadget={$type:"$application",$title:app.title,applicationName:app.applicationName,icon:app.iconName},gadgetId="$welcome_"+app.applicationName+"_GADGET",vignetteId="$welcome_"+app.applicationName+"_VIGNETTE";return datasetJson.$mobileGadgets[gadgetId]=gadget,datasetJson[vignetteId]=gadgetId,prototypeJson&&(prototypeJson.$properties[vignetteId]={$item:gadget,$title:app.title,$type:"application/x-vignette-link"}),datasetJson.$vignettes&&datasetJson.$vignettes.push({persistentId:vignetteId,gadget:{$uuid:gadgetId}}),vignetteId}function _getOtherGroups(rootLayout,groupId){var groups=[];return rootLayout.children.forEach(function(group){group.id!==groupId&&groups.push({title:group.getArticleText("$title"),id:group.id})}),groups}function _getAllGroups(rootLayout,groupId){var groups=[];return rootLayout.children.forEach(function(group){groups.push({title:group.getArticleText("$title"),id:group.id,current:group.id===groupId})}),groups}function _cleanupUnreferenced(pageData){var binds=_getAllBinds(pageData.page.$article),boundVignettes=[];pageData.dataset.json.$vignettes.forEach(function(vignette){if(binds.indexOf(vignette.persistentId)>-1)boundVignettes.push(vignette);else{var vid=vignette.persistentId,gid=vignette.gadget.$uuid;delete pageData.dataset.json[vid],delete pageData.dataset.json.$mobileGadgets[gid]}}),pageData.dataset.json.$vignettes=boundVignettes}var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdataDashboard").Page,BaseSdata=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),HomeController=require("syracuse-tablet/html/js/controllers/homeController").HomeController,native=require("syracuse-tablet/html/js/helpers/native/native"),wpHelpers=require("syracuse-tablet/html/js/sdata/wpHelpers"),modules=require("syracuse-tablet/html/js/common/modules"),metaDataCache=require("syracuse-tablet/html/js/sdata/cache/metaDataCache"),authHelpers=require("syracuse-tablet/html/js/authoring/authoringHelpers"),ModalChooseApps=require("syracuse-tablet/html/js/ui/modals/modalChooseApps").Modal,ModalChooseDashboardGroup=require("syracuse-tablet/html/js/ui/modals/modalChooseDashboardGroup").Modal,ModalConfigTile=require("syracuse-tablet/html/js/ui/modals/modalConfigTile").Modal,ModalConfirm=require("syracuse-tablet/html/js/ui/modals/modalConfirm").Modal,ModalChooseWelcomeDashboard=require("syracuse-tablet/html/js/ui/modals/modalChooseWelcomeDashboard").Modal,ModalChooseRoles=require("syracuse-tablet/html/js/ui/modals/modalChooseRoles").Modal,notifications=require("syracuse-tablet/html/js/helpers/notifications"),dragManager=require("syracuse-tablet/html/js/ui/dragManager").DragManager;exports.Page=utils.defineClass(function PageHome(pageData,options){Base.call(this,pageData,options),this.actionAdapter.showDesignPage=!1,this.actionAdapter.showPageShare=!1,this.actionAdapter.showPinPage=!1,this.actionAdapter.showPageConfig=!0,this.actionAdapter.showMyDashboardTemplates=this.controller.showMyDashboardTemplates(),this.actionAdapter.showMyDashboard=!0,this.actionAdapter.showMyAvailableDashboard=this.hasAvailableTemplates(),this.actionAdapter.showGlobalPanelButton=!0,this.nativeVoiceCommands=native.getModule("voiceCommands"),notifications.subscribe(this,["sm.dashboard.description.change","sm.dashboard.select.template","sm.dashboard.create.template","sm.dashboard.delete.template","sm.dashboard.change.current.view","sm.vignette.pressed"])},Base,{destroy:function(){Base.prototype.destroy.call(this)},getPageTitle:function(){return this.isPersonal()?locale.text("global.pageTitle.home"):this.pageData.meta.description},isRootPage:function(){return!0},isPersonal:function(){return this.pageData.isPersonal},roles:function(){return this.pageData.page.$roles},_ensureController:function(){var opts={forceConfigActive:this.options.replace};this.controller=new HomeController(this.pageData.dataset,this,opts),this.controller.setUIAdapter(this)},afterRender:function(){Base.prototype.afterRender.call(this),this.options.replace&&(this._enabledConfig(!0),this.controller.setDirty(!0),this.options.replace=!1),this.updateVoiceCommands()},updateVoiceCommands:function(){var self=this;self.nativeVoiceCommands&&self.getVoiceCommands().then(function(commands){self.nativeVoiceCommands.updateVoiceCommands(commands)})},_actPageConfig:function(){this.controller.toggleConfig(!0),this._refresh()},_actMyAvailableTemplates:function(){var self=this,templates=this.availableTemplates(),opts={showCreateTemplate:!1,views:templates},modal=new ModalChooseWelcomeDashboard(opts);modal.show().then(function(result){if(result&&result.selectedView){var opts={uuid:result.selectedView,isPersonal:self.isPersonal(),currentUuid:self.isPersonal()?null:self.pageData.meta.uuid,replace:!0,description:self.pageData.meta.description};modules.get("navHelper").gotoUrl("html://home",null,opts)}})},_actMyDashboardTemplates:function(){var self=this,views=[],currentViews=self.pageData.page.$views||[];currentViews.forEach(function(view){view.$factoryOwner&&view.$factoryOwner===self.controller.factoryId()&&views.push(view)});var opts={views:views,showCreateTemplate:!0},panel=this.openPanel("dashboardTemplatePanel",opts);panel.show()},notifDashboardChangeCurrentView:function(){this._actMyDashboard()},notifDashboardSelectTemplate:function(uuid){var opts={uuid:uuid};modules.get("navHelper").gotoUrl("html://home",null,opts)},notifDashboardCreateTemplate:function(){var uuid=utils.UUID(),article={$layoutType:"hub",$items:[{$layoutType:"hubgroup",$title:"{@"+uuid+"}"}],$localization:{}};utils.setLocalization(article.$localization,uuid,locale.text("welcome.newgroup")),this.pageData.page.$article=article,this.pageData.meta.uuid=null,this.pageData.meta.description=locale.text("dashboard.welcome.create.template"),_cleanupUnreferenced(this.pageData),this.pageData.isPersonal=!1,this._enabledConfig(!0),this._refresh(!0)},notifDashboardDeleteTemplate:function(uuid){var self=this;uuid&&wpHelpers.deleteDashboardTemplate(uuid).always(function(data){var diags=data.$diagnoses,views=[];diags&&diags.length>0&&diags.forEach(function(diag){var notify={severityClass:diag.$severity||"error",title:diag.$message};modules.get("modal").notify(notify)});var currentView=self.pageData.page.$views.filter(function(view){return view.$selected}),changeCurrentView=currentView.length>0&&uuid===currentView[0].$uuid;self.pageData.page.$views=data.$resources&&data.$resources.$views?data.$resources.$views:[],self.pageData.page.$views.forEach(function(view){view.$selected=currentView[0]&&currentView[0].$uuid?view.$uuid===currentView[0].$uuid:!1,view.$factoryOwner&&view.$factoryOwner===self.controller.factoryId()&&views.push(view),changeCurrentView&&view.$selected&&notifications.publish(["sm.view.change"],view)}),notifications.publish(["sm.dashboard.list.views.change"],{views:views,changeCurrentView:changeCurrentView})})},_actMyDashboard:function(){modules.get("navHelper").gotoUrl("html://home")},_enabledConfig:function(forceShow){this.controller.enabledConfig(forceShow);var $$tiles=$(".s-m-tile",this.$$elmt);$$tiles.addClass("s-m-tile-edit");for(var i=0;i<$$tiles.length;i++){var $$tile=$($$tiles[i]);$$tile.attr("data-tile-config-id",i),$$tile.attr("data-disable-navigation",!0);var $$vignette=$(".s-m-vignette",$$tile);$$tile.attr("data-empty-tile")||($$tile.append($('<div class="cfg insert top" data-param="top" data-vignette-id="'+$$vignette.attr("id")+'"></div>')),$$tile.append($('<div class="cfg insert bottom" data-param="bottom" data-vignette-id="'+$$vignette.attr("id")+'"></div>')),$$tile.append($('<div class="cfg insert left" data-param="left" data-vignette-id="'+$$vignette.attr("id")+'"></div>')),$$tile.append($('<div class="cfg insert right" data-param="right" data-vignette-id="'+$$vignette.attr("id")+'"></div>')))}this._dragManagerCreate()},_disabledConfig:function(){this.controller.disabledConfig(),$(".s-m-tile-edit",this.$$elmt).removeClass("s-m-tile-edit"),this._dragManagerDestroy()},getVoiceCommands:function(){return $.smResolve(wpHelpers.welcomePageToCommands(this.pageData))},getPageDescription:function(){return this.pageData.meta.description},_actCloseDashboardConfig:function(){if(this.controller.isDirty()){var opts={uuid:this.pageData.meta.uuid};modules.get("navHelper").gotoUrl("html://home",null,opts)}else this.controller.toggleConfig(),this._refresh(!1)},_actSavePersonal:function(){var self=this,data=wpHelpers.createWelcomeDashboardFromPageData(this.pageData,!0);wpHelpers.saveWelcomeDashboard(data).then(function(res){self.controller.cleanContext(),self.controller.setDirty(!1),modules.get("modal").notify({body:locale.text("dashboard.welcome.saved"),severityClass:"success"})})},_actSaveTemplate:function(){var self=this,data=wpHelpers.createWelcomeDashboardFromPageData(this.pageData,!1);wpHelpers.saveWelcomeDashboard(data).then(function(res){self.pageData.page.$views=res.$views,self.pageData.meta.uuid=res.$uuid,self.controller.cleanContext(),self.controller.setDirty(!1),modules.get("modal").notify({body:locale.text("dashboard.welcome.saved"),severityClass:"success"})})},_actRoleList:function(){var self=this;_getAvailableRoles(self.roles()).then(function(roles){var modal=new ModalChooseRoles(roles);return modal.show()}).then(function(result){result&&result.change&&(self.pageData.page.$roles=[],result.selectedRoles.forEach(function(role){self.pageData.page.$roles.push({$uuid:role})}),self.controller.rolesChange())})},_actAddGroup:function(){this._addGroup(),this._refresh(!0)},_addGroup:function(tile){var uuid=utils.UUID(),article=this.getArticle();article.$items.push({$items:[],$layoutType:"hubgroup",$title:"{@"+uuid+"}"}),utils.setLocalization(article.$localization,uuid,locale.text("welcome.newgroup"))},_refresh:function(dirty){var self=this;self.authUpdateLayout(self.getArticle()).then(function(){self.controller.configActive&&self._enabledConfig(!0),self.controller.setDirty(dirty)}).fail(function(e){modules.get("modal").error(e)})},renderRootLayout:function(){var self=this;return self._canAddTile().then(function(canAddTile){self._updateRenderOptions(canAddTile),self.rootLayout.set$$container(self.$$contentRoot),self.rootLayout.buildHtml()})},_updateRenderOptions:function(canAddTiles){var self=this;if(this.controller.isConfigActive()){self.rootLayout.setBuildOptionPerClass("LayoutHubGroup","showAddTiles",canAddTiles),self.rootLayout.setBuildOptionPerClass("LayoutTile","tileActions",self._defineTileActions());var groups=self.rootLayout.children;groups.forEach(function(group,idx){var groupActions=[{action:"removeGroup",className:"remove",icon:"fa fa-trash"},{action:"moveGroupLeft",disabled:idx===0,className:"s-m-move-group"+(idx===0?" disabled":""),icon:"fa fa-arrow-left"},{action:"moveGroupRight",disabled:idx===groups.length-1,className:"s-m-move-group",icon:"fa fa-arrow-right"}];group.setBuildOption("groupActions",groupActions)})}else self.rootLayout.setBuildOptionPerClass("LayoutHubGroup","showAddTiles",null),self.rootLayout.setBuildOptionPerClass("LayoutHubGroup","groupActions",null),self.rootLayout.setBuildOptionPerClass("LayoutTile","tileActions",null)},_defineTileActions:function(){var tileActions=[];return this._hasMoreThanOneGroup()&&tileActions.push({action:"changeGroup",className:"changegroup",icon:"fa fa-sitemap"}),tileActions.push({action:"configTile",className:"config",icon:"fa fa-pencil"}),tileActions.push({action:"removeTile",className:"remove",icon:"fa fa-trash-o"}),tileActions},_hasMoreThanOneGroup:function(){return this.getArticle().$items.length>1},authUpdateLayout:function(article){var self=this;return BaseSdata.prototype.authUpdateLayout.call(self,article)},_actChangeGroup:function(tileId){var self=this,grpIdxDest,ctrlTile=this.controller.getControl(tileId),groupIdTile=ctrlTile.parent.id,groups=_getOtherGroups(this.rootLayout,groupIdTile),modal=new ModalChooseDashboardGroup(groups);modal.show().then(function(groupIdDest){groupIdDest&&self.rootLayout.children.some(function(group,idx){if(group.id===groupIdDest)return grpIdxDest=idx,!0})&&self._changeGroup(grpIdxDest,groupIdTile,ctrlTile.id)&&self._refresh(!0)})},_changeGroup:function(grpIdxDest,groupIdTile,tileId){var self=this,grpIdx,tileIdx,grpIdx=self._getIdxGroup(groupIdTile);if(grpIdx>-1&&self.rootLayout.children[grpIdx].children.some(function(tile,idx){if(tile.id===tileId)return tileIdx=idx,!0})){var article=self.getArticle();return article.$items[grpIdxDest].$items=article.$items[grpIdxDest].$items||[],article.$items[grpIdxDest].$items.push(article.$items[grpIdx].$items.slice(tileIdx,tileIdx+1)[0]),article.$items[grpIdx].$items.splice(tileIdx,1),!0}return!1},_getIdxGroup:function(groupId){var grpIdx=-1;return this.rootLayout.children.some(function(group,idx){if(group.id===groupId)return grpIdx=idx,!0}),grpIdx},_actConfigTile:function(tileId){var self=this,ti=this._getTileInfo(tileId),grpIdxDest;if(ti){var ctrlTile=self.controller.getControl(tileId),groupId=ctrlTile.parent.id,groups=_getAllGroups(self.rootLayout,groupId),modal=new ModalConfigTile({tile:ti,groups:groups});modal.show().then(function(result){if(result){var groupDest="";self._setTileInfo(result.tile),result.group==="$new"&&(self._addGroup(),grpIdxDest=self.rootLayout.children.length),result.group&&groupId!==result.group?(grpIdxDest=grpIdxDest||self._getIdxGroup(result.group),self._changeGroup(grpIdxDest,groupId,tileId)&&self._refresh(!0)):self._rebuildPageByControls(!0)}})}},_actRemoveTile:function(tileId){this._removeTile(tileId)},_actMoveGroupLeft:function(hubGroupId){this._moveGroup(hubGroupId,-1)},_actMoveGroupRight:function(hubGroupId){this._moveGroup(hubGroupId,1)},_actRemoveGroup:function(hubGroupId){var self=this,modal=new ModalConfirm(locale.text("welcome.dashboard.remove.group"),null,!0);modal.show().then(function(result){result==="yes"&&self._deleteGroup(hubGroupId)})},_actAddHiddenTile:function(hubGroupId){var self=this;_getAvailabeNotUsedApps(this.getArticle(),this.pageData.dataset.json).then(function(notUsedApps){var modal=new ModalChooseApps(notUsedApps);return modal.show()}).then(function(result){if(result&&result.length>0)return self._addAppsToGroup(result,hubGroupId)}).then(function(tileAdded){self._rebuildPageByControls(tileAdded)})},_addAppsToGroup:function(apps,hubGroupId){var self=this,hubGroupCtrl=self.controller.getControl(hubGroupId);if(!hubGroupCtrl)return!1;var tileAdded=apps.reduce(function(a,b,index,appList){var vignetteUuid=_addVignetteAndGadget(self.pageData.dataset.json,self.pageData.prototype.json,appList[index]);return b=!1,vignetteUuid&&(b=_bindVignetteToHubGroupCtrl(hubGroupCtrl,vignetteUuid)),a||b},!1);return tileAdded},_moveGroup:function(hubGroupId,dir){var self=this,myIdx;if(self.rootLayout.children.some(function(group,idx){if(group.id===hubGroupId)return myIdx=idx,!0})){var newIdx=myIdx+dir;if(newIdx>=0&&newIdx<self.rootLayout.children.length){var article=self.getArticle(),destGrp=article.$items[newIdx];article.$items[newIdx]=article.$items[myIdx],article.$items[myIdx]=destGrp,self._refresh(!0)}}},onGroupTitleChanged:function(ctrlHubGroup,uuid,title){this.getArticle().$localization=this.getArticle().$localization||{},utils.setLocalization(this.getArticle().$localization,uuid,title),this.controller.setDirty(!0)},_removeTile:function(tileId){var self=this,tile=this.controller.getControl(tileId),group=tile.parent,tileIndex=group.getIndexOfChild(tile),hub=group.parent,groupIndex=hub.getIndexOfChild(group),article=self.getArticle();article.$items[groupIndex].$items.splice(tileIndex,1),_cleanupUnreferenced(self.pageData),self._refresh(!0)},_deleteGroup:function(hubGroupId){var self=this,myIdx;if(self.rootLayout.children.some(function(group,idx){if(group.id===hubGroupId)return myIdx=idx,!0})){var article=self.getArticle();article.$items.splice(myIdx,1),_cleanupUnreferenced(self.pageData),self._refresh(!0)}},_getTileInfo:function(tileId){var tileInfo,ctrlTile=this.controller.getControl(tileId);if(!ctrlTile)return;var ctrlVignette=ctrlTile;ctrlTile.isLayout()&&(ctrlVignette=ctrlTile.getChildByIndex(0));var $$vignette=$("#"+tileId),$$tile=$$vignette.closest(".s-m-tile");if(ctrlVignette&&ctrlVignette.$bind){var article=ctrlTile.isLayout()?ctrlTile.getArticle():ctrlTile.parent.getArticle(),gadgetId=this.pageData.dataset.json[ctrlVignette.$bind],gadget=gadgetId&&this.pageData.dataset.json.$mobileGadgets[gadgetId];tileInfo={$$vignette:$$vignette,$$tile:$$tile,icon:gadget&&gadget.icon,title:ctrlVignette.getTitle(),stackTitle:ctrlTile&&ctrlTile.$$elmt?$(".s-m-stack header",ctrlTile.$$elmt).text():null,size:article.$size,color:article.$bgColor,gadgetId:gadgetId,ctrl:ctrlTile,vignetteId:ctrlVignette.$bind}}return tileInfo},_setTileInfo:function(tileInfo){var article=tileInfo.ctrl.article=tileInfo.ctrl.article||{};article.$size=tileInfo.size,article.$bgColor=tileInfo.color;var gadget=this.pageData.dataset.json.$mobileGadgets[tileInfo.gadgetId];gadget&&(gadget.icon=tileInfo.icon,gadget.title=tileInfo.title);var gadget=this.pageData.prototype.json.$properties[tileInfo.vignetteId].$item;return gadget&&(gadget.icon=tileInfo.icon,gadget.title=tileInfo.title),article},_rebuildPageByControls:function(dirty){var self=this,states=[],newArticle=JSON.parse(authHelpers.rebuildArticleByPageStruct(self,states));self.pageData.page.$article=newArticle,self._refresh(dirty)},_canAddTile:function(){return _getAvailabeNotUsedApps(this.getArticle(),this.pageData.dataset.json).then(function(appsToAdd){return appsToAdd.length>0})},getPagePublishOptions:function(){return{}},notifDashboardDescriptionChange:function(newDescription){this.controller.dashboardDescriptionChange(newDescription)},getPinPageId:function(){return this.pageName},hasAvailableTemplates:function(){return this.pageData.page.$views?this.pageData.page.$views.some(function(view){return!view.$isPersonnal}):!1},availableTemplates:function(){return this.pageData.page.$views?this.pageData.page.$views.filter(function(view){return!view.$isPersonal}):[]},_dragUI:function(ev){return $(ev.currentTarget).hasClass("s-m-group-handle")?$(ev.currentTarget).parent().clone():$(ev.currentTarget).clone()},_dragManagerDestroy:function(){this.dragManager&&(notifications.unsubscribe(this,this.dragManager.getNotifs()),this.dragManager.destroy(),this.dragManager=null)},_dragManagerCreate:function(){var self=this,dragOpts={selector:".s-m-hub-group>header>.s-m-group-handle,.s-m-tile:not([data-empty-tile])",enable:!1,notify:{start:"sm.drag.start",stop:"sm.drag.stop"},options:{opacity:.4,delay:0,scrollSensitivity:100,scrollSpeed:50,helper:self._dragUI}},dropOpts={selector:".s-m-hub-group,.insert",notify:{drop:"sm.element.drop",out:"sm.element.out",over:"sm.element.over"},options:{helper:"clone"}};self.dragManager=new dragManager(dragOpts,dropOpts,self.$$elmt),notifications.subscribe(self,self.dragManager.getNotifs())},notifVignettePressed:function(vignetteId){if(!this.controller.configActive)return;var tileInfo=this._getTileInfo(vignetteId);tileInfo.$$tile.toggleClass("s-m-draggable",!0),notifications.publish("sm.drag.state.change",!0)},notifDragStart:function($$dragElt,ui){$$dragElt.is(".s-m-hub-group>header>.s-m-group-handle")&&($$dragElt.closest(".s-m-hub-group").toggleClass("s-m-not-droppable",!0),ui.helper.css("width",ui.helper.css("width")),ui.helper.css("background-color","#009fda"),ui.helper.css("color","white"))},notifDragStop:function($$dragElt,ui){notifications.publish("sm.drag.state.change",!1),$$dragElt.toggleClass("s-m-draggable",!1);if($$dragElt.is(".s-m-hub-group>header>.s-m-group-handle")){$$dragElt.closest(".s-m-hub-group").toggleClass("s-m-not-droppable",!1);return}},notifElementDrop:function($$dropElt,ui,params){var $$dragElt=ui.draggable;$$dragElt.hasClass("s-m-tile")&&this._tileDrop($$dropElt,$$dragElt,params),$$dragElt.is(".s-m-hub-group > header > .s-m-group-handle")&&this._groupDrop($$dropElt,$$dragElt,params)},notifElementOut:function($$dropElt,ui){var $$dragElt=ui.draggable;if($$dragElt.is(".s-m-hub-group>header> .s-m-group-handle")){var $$group=$$dropElt.closest(".s-m-hub-group");$$group.toggleClass("s-m-over-droptarget",!1)}this.dragManager.hideIndicator()},notifElementOver:function($$dropElt,ui){var $$dragElt=ui.draggable;$$dragElt.hasClass("s-m-tile")&&this._tileOver($$dropElt,$$dragElt),$$dragElt.is(".s-m-hub-group>header > .s-m-group-handle")&&this._groupOver($$dropElt,$$dragElt)},_tileDrop:function($$dropElt,$$dragElt,params){var optsMoveTile=this._getOptsMoveTile($$dropElt,$$dragElt,params);if(optsMoveTile.where==="append"&&!$$dropElt.hasClass("empty"))return;this._moveTile(optsMoveTile)},_groupDrop:function($$dropElt,$$dragElt,params){var $$goupTarget=$$dropElt.closest(".s-m-hub-group");if($$goupTarget.hasClass("s-m-not-droppable"))return;var layoutTarget=this._layoutsMap[$$goupTarget.attr("id")],$$goupToMove=$$dragElt.closest(".s-m-hub-group"),layoutToMove=this._layoutsMap[$$goupToMove.attr("id")];this._moveGroup(layoutTarget,layoutToMove)},_tileOver:function($$dropElt,$$dragElt){var optsMoveTile=this._getOptsMoveTile($$dropElt,$$dragElt),cellOrigineInfo=this._getCellInfo(optsMoveTile.dragId),targetInfo=optsMoveTile.where==="append"&&$$dropElt.hasClass("empty")?this._getGroupInfo(optsMoveTile.dropId,$$dropElt):this._getCellInfo(optsMoveTile.dropId),where=this._tileWhere(optsMoveTile,cellOrigineInfo,targetInfo);if(where&&where.parent){var opts={top:where.top,left:where.left,height:where.height,width:where.width,$$parent:where.parent};this.dragManager.showIndicator(opts,{before:where.before,target:where.idTileTarget||where.idTarget})}else this.dragManager.hideIndicator()},_groupOver:function($$dropElt,$$dragElt){console.log("_groupOver");return;var $$group,$$header},_getOptsMoveTile:function($$dropElt,$$dragElt,params){var optMoveTile={dropId:$$dropElt.attr("id"),dragId:$(".s-m-vignette",$$dragElt).attr("id"),where:"append"};return $$dropElt.hasClass("insert")&&(optMoveTile.dropId=params?params.target:$$dropElt.attr("data-vignette-id"),optMoveTile.where=params?params.before?"top":"bottom":$$dropElt.attr("data-param")),optMoveTile},_getCellInfo:function(tileId){var tileInfos=this._getTileInfo(tileId);if(!tileInfos)return{};var layoutGroup=tileInfos.ctrl.parent.parent,$$dhtmlCell=tileInfos.ctrl.$$elmt.parent().parent(),index=$$dhtmlCell.attr("data-cellIndex"),cells=layoutGroup.cells;return{tileSize:tileInfos.size,tileCtrl:tileInfos.ctrl,$$tile:tileInfos.$$tile,cellIndex:index,cellDomItem:cells[index].domItem,cellColumn:cells[index].abs,cellChildren:cells[index].children}},_getGroupInfo:function(groupId,$$elmt){return{id:groupId,targetElmt:$$elmt}},_tileWhere:function(optsMoveTile,cellOrigineInfo,targetInfo){if(optsMoveTile.where==="append")return{top:parseInt($("header",targetInfo.targetElmt).css("height"),10)+"px",left:"0px",width:cellOrigineInfo.$$tile.css("width"),height:"10px",idTarget:targetInfo.id,before:!1,parent:targetInfo.targetElmt};var layoutGroup=targetInfo.tileCtrl.parent.parent,before=optsMoveTile.where==="top"||optsMoveTile.where==="left",where;switch(cellOrigineInfo.tileSize){case"small":targetInfo.tileSize==="small"||targetInfo.tileSize==="medium"?where={top:"0px",left:before?"-5px":parseInt(targetInfo.$$tile.css("width"),10)-5+"px",width:"10px",height:cellOrigineInfo.$$tile.css("height"),parent:targetInfo.$$tile}:where={top:before?"-5px":layoutGroup.cells[targetInfo.cellIndex].h-5+"px",left:"0px",width:cellOrigineInfo.$$tile.css("width"),height:"10px",parent:targetInfo.cellDomItem};break;case"medium":targetInfo.tileSize==="small"||targetInfo.tileSize==="medium"?where={top:"0px",left:before?"-5px":layoutGroup.cells[targetInfo.cellIndex].w-5+"px",width:"10px",height:cellOrigineInfo.$$tile.css("height"),parent:targetInfo.cellDomItem}:where={top:before?"-5px":layoutGroup.cells[targetInfo.cellIndex].h-5+"px",left:"0px",width:cellOrigineInfo.$$tile.css("width"),height:"10px",parent:targetInfo.cellDomItem};break;case"wide":case"large":case"full":where={top:before?"-5px":layoutGroup.cells[targetInfo.cellIndex].h-5+"px",left:"0px",width:cellOrigineInfo.$$tile.css("width"),height:"10px",parent:targetInfo.cellColumn%2?layoutGroup.cells[targetInfo.cellIndex-1].domItem:targetInfo.cellDomItem};break;case"all ":}if(where){var layoutTile=targetInfo.cellChildren[before?0:targetInfo.cellChildren.length-1];where.idTileTarget=layoutTile.children[0].id,where.before=before}return where},_moveTile:function(opts){var self=this,layoutGroupTarget,idxTarget,tileTarget,items,tileToMove=self._getTileInfo(opts.dragId);if(!tileToMove)return;var layoutGroupOrigin=tileToMove.ctrl.parent.parent,idxOrigin=$.inArray(tileToMove.ctrl.parent.article,layoutGroupOrigin.article.$items);if(!(idxOrigin>=0))return;items=layoutGroupOrigin.article.$items.splice(idxOrigin,1),opts.where==="append"?(layoutGroupTarget=self._getGroupLayout(opts.dropId),idxTarget=layoutGroupTarget.article.$items.length):(tileTarget=self._getTileInfo(opts.dropId),layoutGroupTarget=tileTarget.ctrl.parent.parent,idxTarget=$.inArray(tileTarget.ctrl.parent.article,layoutGroupTarget.article.$items)),idxTarget>=0&&((opts.where==="bottom"||opts.where==="right"&&idxTarget<layoutGroupTarget.article.$items.length)&&idxTarget++,layoutGroupTarget.article.$items.splice(idxTarget,0,items[0])),this._refresh(!0)},_getGroupLayout:function(groupId){return this.getRootLayout().children.find(function(layout){return layout.id===groupId})}})}),define("syracuse-tablet/html/js/pages/html/pageHtmlBase",["require","exports","module","syracuse-tablet/html/js/pages/pageBase","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/pageBase").Page,utils=require("syracuse-tablet/html/js/helpers/utils");exports.Page=utils.defineClass(function PageHtmlBase(pageName,options){Base.call(this,pageName,options)},Base,{destroy:function(){Base.prototype.destroy.call(this)},render:function(){},afterRender:function(){},getPageTitle:function(){return this.pageName},_getDefaultAttachedControls:function(){return[]},scrollAllowed:function(){return!0}})}),define("syracuse-tablet/html/js/pages/html/pageLogin",["require","exports","module","syracuse-tablet/html/js/pages/html/pageHtmlBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/html/pageHtmlBase").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),nativeApp=require("syracuse-tablet/html/js/helpers/native/native").getModule("nativeApp"),settings=require("syracuse-tablet/html/js/app/settings"),waiting=require("syracuse-tablet/html/js/utils/waiting"),modules=require("syracuse-tablet/html/js/common/modules"),_templates={main:'			<div class="s-m-loginform" style="position: relative;">				<div class="row s-m-login-info">					<div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4 col-lg-offset-4 col-lg-4">						<div id="login-reason-id" style="display: none;" class="alert alert-info" role="alert"></div>					</div>				</div>				<div id="s-m-login-online-id" class="row">					<div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4 col-lg-offset-4 col-lg-4">						<div class="panel panel-default">							<div  id="s-m-login-withoutcookie">								<div class="s-m-login-header main">									<span class="s-m-signin">{{label_signin}}</span>									<span class="s-m-brand">{{label_brand}}</span>									<span class="s-m-product">{{label_product}}</span>								</div>																<div class="panel-body s-m-login-body" id="s-m-basic-fields-id">									<br>									<div class="form-group">										<input type="text" autocorrect="off" autocapitalize="off" value="" class="form-control s-m-login-form-input" placeholder="{{label_user}}"	id="login-user">									</div>									<br>									<div class="form-group">										<input type="password" autocorrect="off" autocapitalize="off" class="form-control s-m-login-form-input" placeholder="{{label_password}}" id="login-password">									</div>									<div class="form-group">										<center>											<label style="font-weight:normal"><input type="checkbox" id="s-m-remember-me-id">{{label_rememberme}}</input></label>										</center>									</div>									<button id="login-login" data-nevent data-naction="loginBasic" type="button" class="btn btn-primary s-m-signin-btn">{{act_login}}</button>								</div>								<div id="s-m-sageid-fields-id">									<div class="s-m-login-header" id="s-m-sageid-header">										<span class="s-m-signin">{{sageid_label_header}}</span>									</div>									<div class="panel-body s-m-login-body" id="s-m-sageid-body">										<button id="s-m-sageid-signin" data-nevent data-naction="loginSageId" type="button" class="btn btn-primary s-m-signin-btn">{{sageid_label_signin}}</button>									</div>								</div>								<div id="s-m-external-fields-id">									<div class="s-m-login-header" id="s-m-external-header">										<span class="s-m-signin">{{label_external}}</span>									</div>									<div class="panel-body s-m-login-body" id="s-m-external-body">										{{#each externals}} 											<button style="margin-bottom:10px;" data-nevent data-naction="externalSignin" data-params="{{this.href}}" type="button" class="btn btn-primary s-m-signin-btn">{{this.title}}</button>										{{/each}} 									</div>								</div> 								<div id="s-m-login-noauth-id">									<div class="form-group">										<center>											{{no_auth_method}} 											<br> 											{{contact_admin}} 										</center>									</div>								</div>							</div>						</div>					</div>				</div>				<div id="s-m-login-offline-id" class="row" style="display: none;">					<div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4 col-lg-offset-4 col-lg-4">						<div class="panel panel-default">							<div class="s-m-login-header"><span class="s-m-signin">{{label_signin}} </span> <span class="s-m-brand">{{label_brand}}</span> <span class="s-m-product">{{label_product}}</span></div>							<div class="s-m-login-header" id="s-m-offline-header">								<span class="s-m-signin">{{offline_label_header}}</span>							</div>							<div class="panel-body s-m-login-body" id="s-m-sageid-body">								<button id="s-m-offline-signin" data-nevent data-naction="offlinesignin" type="button" class="btn btn-primary s-m-signin-btn"> 									<div id="s-m-offline-label">{{offline_label_signin_as}}</div> 									<div id="s-m-offline-user-id"></div> 								</button>							</div>						</div>					</div>				</div>				<div id="s-m-login-nooffline-id" class="row" style="display: none;">					<div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4 col-lg-offset-4 col-lg-4">						<div class="panel panel-default">							<div class="s-m-login-header" id="s-m-offline-header">									{{offline_notavail}}							</div>							<div class="panel-body s-m-login-body" id="s-m-sageid-body">								<div>{{offline_emptydb}}</div> 							</div>						</div>					</div>				</div>			</div>		',message:"{{title}}<p>{{message}}</p>{{stack}}"},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)};exports.Page=utils.defineClass(function PageLogin(pageName,options){options=options||{},Base.call(this,pageName,options),this._offline=options.offline===!0},Base,{destroy:function(){Base.prototype.destroy.call(this)},getPageTitle:function(){return locale.text("global.pageTitle.login")},isRootPage:function(){return!0},isNoHistory:function(){return!0},render:function(){var self=this;return this.$$elmt.addClass("login"),this._readLabels().then(function(){var ctx=$.extend(!0,{},self._labels);self.$$contentRoot.append($(_getHtml("main",ctx)))})},afterRender:function(){var self=this;return $("#s-m-basic-fields-id input",self.$$elmt).on("keyup",jsutils.bindFn(self._onEnterPressed,self)),this.options.loginPreset&&$("#s-m-basic-fields-id input",self.$$elmt).val(this.options.loginPreset),$.smResolve().then(function(){return self._showSupportedMethods()})},_onEnterPressed:function(e){var self=this;if(e.which==13||e.keyCode==13)e.preventDefault(),self._actLoginBasic()},_actLoginBasic:function(){var self=this,usr=self.$$elmt.find("#login-user").val(),pwd=self.$$elmt.find("#login-password").val();if(usr==null||usr.length<1){self.$$elmt.find("#login-usr").focus();return}if(pwd==null||pwd.length<1){self.$$elmt.find("#login-password").focus();return}var rememberMe=$("#s-m-remember-me-id").is(":checked");nativeApp&&(rememberMe=!0),this._loginBasic(usr,pwd,rememberMe)},_loginBasic:function(usr,pwd,rememberMe){var self=this,session=modules.get("session"),loginTask=$.smResolve().then(function(){return settings.setLoginRememberMe(rememberMe)}).then(function(){return session.loginBasic(usr,pwd,rememberMe)}).fail(function(result){var data=result&&result.data,$diag=data&&data.$diagnoses&&data.$diagnoses[0];$diag=$diag||result&&result.$diagnoses&&result.$diagnoses[0];var $message=$diag&&$diag.$message;return $message=$message||locale.text("login.failed"),self._showMessage($message),result&&result.offline&&(self._offline=!0),self._showSupportedMethods()});waiting.waitModal(loginTask).then(function(){return self._onBasicLoginOk().fail(function(error){modules.get("modal").error(error).always(function(){modules.get("navHelper").gotoUrl("html://home")})})})},_actLoginSageId:function(){var session=modules.get("session");session.loginSageId()},_actExternalSignin:function(param){window.location.href=param},_actOfflinesignin:function(){var self=this;return $.smResolve().then(function(){return self._onOfflineLoginOk()}).fail(function(error){modules.get("modal").error(error)})},_readLabels:function(){var self=this,product=locale.getProductLabels();return self._ensureExternalProviders().then(function(){self._labels={label_user:locale.text("login.label.user"),label_password:locale.text("login.label.password"),act_login:locale.text("login.label.signinaction"),label_signin:locale.text("login.label.signin"),label_brand:product.brand,label_product:product.product,sageid_label_header:locale.text("sageid.label.header"),sageid_label_signin:locale.text("sageid.label.signin"),offline_label_header:locale.text("login.label.offline"),offline_label_signin_as:locale.text("login.label.login_as"),offline_notavail:locale.text("login.offline.notavail"),offline_emptydb:locale.text("login.offline.emptydb"),label_forgetme:locale.text("login.forgetme"),label_changeuser:locale.text("login.changeuser"),label_rememberme:locale.text("login.rememberme"),no_auth_method:locale.text("login.label.noauth"),contact_admin:locale.text("contact.admin"),label_external:locale.text("authentication.external.accs"),externals:self._externalProviders}})},_showSupportedMethods:function(){var self=this,session=modules.get("session");self._ensureAuthMethods().then(function(){return self._showRememberMe()}).then(function(){return self._offline?self._showOfflineMethods():self._showOnlineMethods()})},_showOnlineMethods:function(){var self=this,methods={"sage-id":"s-m-sageid-fields-id",basic:"s-m-basic-fields-id",$$externals:"s-m-external-fields-id"},count=0;return $("#s-m-login-online-id").show(),$("#s-m-login-offline-id").hide(),$.smResolve().then(function(){return self._ensureAuthMethods()}).then(function(){return self._ensureExternalProviders()}).then(function(){Object.keys(methods).forEach(function(method){var id=methods[method],$$block=$("#"+id);self._authMethods.$supported.indexOf(method)>-1?(count+=1,$$block.show()):$$block.hide()})}).then(function(){count<1?$("#s-m-login-noauth-id").show():$("#s-m-login-noauth-id").hide()})},_ensureAuthMethods:function(){var self=this;if(self._authMethods)return $.smResolve();var session=modules.get("session"),def=$.Deferred();return session.getAuthMethods().then(function(list){self._authMethods=list,def.resolve()}).fail(function(result){self._authMethods={$supported:[]},result&&result.offline?(self._offline=!0,def.resolve()):def.reject(result)}),def.promise()},_ensureExternalProviders:function(){var self=this;return self._externalProviders?$.smResolve():self._ensureAuthMethods().then(function(){self._externalProviders=[],self._authMethods.$supported.indexOf("saml2")>-1&&Array.prototype.push.apply(self._externalProviders,self._authMethods.$saml2||[]),self._authMethods.$supported.indexOf("oauth2")>-1&&Array.prototype.push.apply(self._externalProviders,self._authMethods.$oauth2||[]),self._externalProviders.length>0&&self._authMethods.$supported.push("$$externals")})},_showOfflineMethods:function(){var self=this;return $("#s-m-login-online-id").hide(),$.smResolve().then(function(){return settings.getLastUsedUserProfile()}).then(function(profile){self._offlineProfile=profile,profile?($("#s-m-login-offline-id").show(),$("#s-m-login-nooffline-id").hide(),$("#s-m-offline-user-id").text((self._offlineProfile.user.firstName||"")+" "+(self._offlineProfile.user.lastName||""))):($("#s-m-login-offline-id").hide(),$("#s-m-login-nooffline-id").show())})},_showRememberMe:function(){return $.smResolve().then(function(){return settings.getLoginRememberMe()}).then(function(rememberMe){var $$check=$("#s-m-remember-me-id");nativeApp?(rememberMe=!0,$$check.closest(".form-group").hide()):$$check.closest(".form-group").show(),$$check.attr("checked",rememberMe)})},_onBasicLoginOk:function(){var self=this,session=modules.get("session");return $.smResolve().then(function(){return session.getCurrentUserProfile()}).then(function(profile){return modules.get("appController").App.setUserProfile(profile).then(function(){return profile})}).then(function(profile){return session.storeUserProfile(profile)}).then(function(){return modules.get("appController").App.initApplicationsList()}).then(function(){return self._openTargetPage()})},_onOfflineLoginOk:function(){var self=this;return $.smResolve().then(function(){return modules.get("appController").App.setUserProfile(self._offlineProfile)}).then(function(){return self._openTargetPage()})},_openTargetPage:function(){var target=this.options&&this.options.onLogin&&this.options.onLogin.gotoUrl;return target||(target={url:"html://home"}),modules.get("navHelper").gotoUrl(target.url,target.method,target.options,target.loadOptions)},_showMessage:function(message){var html=Handlebars.compile("{{message}}")({message:message});$("#login-reason-id").empty(),$("#login-reason-id").html(html),$("#login-reason-id").show()},_hideMessage:function(){$("#login-reason-id").hide()}})}),define("syracuse-tablet/html/js/pages/html/pageLogout",["require","exports","module","syracuse-tablet/html/js/pages/html/pageHtmlBase","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/html/pageHtmlBase").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),nativeApp=require("syracuse-tablet/html/js/helpers/native/native").getModule("nativeApp"),modules=require("syracuse-tablet/html/js/common/modules"),_templates={main:'			<div class="s-m-loginform" style="position: relative;">				<div class="row s-m-login-info">				</div>				<div id="s-m-login-online-id" class="row">					<div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 col-md-offset-4 col-md-4 col-lg-offset-4 col-lg-4">						<div class="panel panel-default">							<div>								<div class="s-m-login-header main">									<span class="s-m-signin">{{label_signin}}</span>									<span class="s-m-brand">{{label_brand}}</span>									<span class="s-m-product">{{label_product}}</span>								</div>								<div class="panel-body s-m-login-body">									<center>										<div>{{label_logged_out}}</div>									</center>								</div>								<div class="panel-body s-m-login-body" id="s-m-relogin-id" style="display: none;">									<button id="s-m-offline-signin" data-nevent data-naction="relogin" 										type="button" class="btn btn-primary s-m-signin-btn"> 										<div>{{label_login_as}}</div> 										<div>{{label_last_user}}</div> 									</button>								</div>								<div class="panel-body s-m-login-body" id="s-m-login-changeuser">									<button data-nevent data-naction="changeuser" type="button" class="btn btn-primary s-m-signin-btn">{{label_changeuser}}</button>								</div>								<div class="panel-body s-m-login-body" id="s-m-login-forgetme-id">									<button data-nevent data-naction="forgetme" type="button" class="btn btn-primary s-m-signin-btn">{{label_forgetme}}</button>								</div>							</div>						</div>					</div>				</div>			</div>		',message:"{{title}}<p>{{message}}</p>{{stack}}"},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)};exports.Page=utils.defineClass(function PageLogout(pageName,options){options=options||{},Base.call(this,pageName,options)},Base,{destroy:function(){Base.prototype.destroy.call(this)},getPageTitle:function(){return locale.text("global.pageTitle.logout")},isRootPage:function(){return!0},isNoHistory:function(){return!0},render:function(){this.$$elmt.addClass("login"),this._readLabels();var ctx=$.extend(!0,{},this._labels);this._userProfile=modules.get("appController").App.getCurrentUserProfile(),this._userProfile&&(this._authMethod=this._userProfile.user.authentication,this._lastUsername=(this._userProfile.user.firstName||"")+" "+(this._userProfile.user.lastName||""),this._lastLogin=this._userProfile.user.login,ctx.label_last_user=this._lastUsername),this.$$contentRoot.append($(_getHtml("main",ctx)))},_readLabels:function(){var product=locale.getProductLabels();this._labels={label_brand:product.brand,label_product:product.product,label_forgetme:locale.text("login.forgetme"),label_changeuser:locale.text("login.changeuser"),label_logged_out:locale.text("logout.logged.out"),label_login_as:locale.text("login.label.login_as")}},afterRender:function(){var self=this;return this._userProfile&&$("#s-m-relogin-id").show(),$.smResolve().then(function(){var session=modules.get("session");return session.getReconnectToken()}).then(function(token,login,sid,loginCookieName,sidCookieName){$("#s-m-login-forgetme-id").toggle(token!=null)})},_actRelogin:function(){var self=this;if(this._authMethod==="sage-id"){var session=modules.get("session");session.loginSageId()}else["basic","db","ldap"].indexOf(this._authMethod)>-1?self._gotoLogin({loginPreset:this._lastLogin}):this._actChangeuser()},_actChangeuser:function(){this._gotoLogin()},_actForgetme:function(){var self=this,session=modules.get("session");session.forgetMe().always(function(){self._gotoLogin()})},_gotoLogin:function(options){return modules.get("navHelper").gotoUrl("html://login",null,options)}})}),define("syracuse-tablet/html/js/pages/drafts/actionAdapterPageDrafts",["require","exports","module","syracuse-tablet/html/js/pages/actionAdapter","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/actionAdapter").ActionAdapter,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),_headersLinks=[{action:"draftsRunStop",title:locale.text("drafts.action.stop"),hidden:!0},{action:"draftsRunSynch",title:locale.text("drafts.action.synch"),disabled:!0},{action:"draftsRemove",title:locale.text("drafts.action.remove"),disabled:!0}];exports.ActionAdapterPageDrafts=utils.defineClass(function ActionAdapterPageDrafts(page){Base.call(this,page)},Base,{destroy:function(){Base.prototype.destroy.call(this)},getHeaderItems:function(){var items=$.extend(!0,[],_headersLinks),self=this;return items.forEach(function(item){item.icon=item.action,item["controller-id"]=self.page.controller.id}),items},getActionsPanelItems:function(){var items=[];return items}})}),define("syracuse-tablet/html/js/pages/drafts/pageDrafts",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/formatApi","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/rect","syracuse-tablet/html/js/pages/pageBase","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/scroller/scrollerHelpers","syracuse-tablet/html/js/pages/drafts/actionAdapterPageDrafts","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/sdata/sdataUtils"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),formatApi=require("syracuse-tablet/html/js/helpers/formatApi"),locale=require("syracuse-tablet/html/js/helpers/locale"),uiRect=require("syracuse-tablet/html/js/ui/rect"),Base=require("syracuse-tablet/html/js/pages/pageBase").Page,modules=require("syracuse-tablet/html/js/common/modules"),scroller=require("syracuse-tablet/html/js/helpers/scroller/scrollerHelpers"),ActionAdapterPageDrafts=require("syracuse-tablet/html/js/pages/drafts/actionAdapterPageDrafts").ActionAdapterPageDrafts,sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),_templates={error:'<section class="draft-error"><h1>{{error}}<h1><h2>{{contact}}<h2></section>',spinner:'		<div id="draftSpinner">   			<div>				<div class="spinner-loader"></div>			</div>		</div>',record:'			<section id="{{id}}" data-nevent data-naction="clickRecord" data-params="select" class="list-group-item s-m-draft-item {{status}}">				<div>					<div>						<div class="draft-title">{{title}}</div>						<div class="draft-date">{{creation_date}}</div>					</div>					<div>						<div><span class="draft-status">{{statusText}}</span><span class="draft-errorMsg">{{error}}</span></div>						<div class="draft-endpoint">{{endpoint}}</div>					</div>					<div>						<div class="draft-comment"><i class="fa fa-comment-o"></i>{{comment}}</div>						<div class="draft-actions">							<span data-params="edit" data-url="{{draftUrl}}" class="fa fa-edit"></span>						</div>					</div>				</div>				<span class="badge checked fa fa-check">&nbsp;</span>				<span style="{{#unless index}}display:none;{{/unless}}" class="badge index">{{index}}</span>			</section>',content:'			<div class="s-m-draft-header" style="display:none">				<div>					{{{selectMenu}}}				</div>				<div>					{{{filtersMenu}}}				</div>			</div>			<div id="draftInfo"  style="display:none">{{info}}</div>			<div id="draftPageWrapper" class="s-m-scroll-wrapper">				<div class="list-group s-m-draft-list">				</div>			</div>		</div>',selectMenu:'		<div id="draftSelectMenuId" class="btn-group">			<div class="{{dropDirection}}">				<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">					<span class="badge"></span>{{title}}<span class="caret"></span>				</button>				<ul class="dropdown-menu dropdown-menu-left" role="menu">					{{#each links}}						<li><a  {{#if $isHidden}}style="display:none"{{/if}} draggable="false" data-nevent data-naction="selectMenu" data-params="{{params}}" href="#">{{title}}</a></li>					{{/each}}				</ul>			</div>		</div>',filtersMenu:'		<select id="draftFiltersMenu" data-nevent data-naction="filter">		{{#each filterOptions}}			<option value="{{value}}" {{#if selected}}selected{{/if}}>{{title}}</option>		{{/each}}		<select>'},_getHtml=function(name,ctx){var key=name+"compiled",tmpl=_templates[key];return tmpl||(tmpl=_templates[name],tmpl=_templates[key]=Handlebars.compile(tmpl)),tmpl(ctx)},_selectOptionsList=["unselectall","selectall","hideunselected","showunselected"];exports.Page=utils.defineClass(function DraftsPage(pageName,options){options=options||{},Base.call(this,pageName,options),this.dateFormatter=formatApi.getFormatter("application/x-datetime"),this._initLabels(),this._selectedFilter="creation_date:dsc",this.actionAdapter=new ActionAdapterPageDrafts(this),this._toolsPanel="header"},Base,{destroy:function(){Base.prototype.destroy.call(this),this._myGestureMgr&&(this._myGestureMgr.destroy(),this._myGestureMgr=null)},_initLabels:function(){this._filterOptions=[{value:"creation_date:asc",title:locale.text("drafts.filters.dateasc")},{value:"creation_date:dsc",title:locale.text("drafts.filters.datedsc")}]},getPageTitle:function(){return"Drafts"},scrollAllowed:function(){return!1},_getDefaultAttachedControls:function(){return[this._toolsPanel,"actionsPanel"]},_getAttachedControlInfo:function(name){var ctrl=Base.prototype._getAttachedControlInfo.call(this,name);return name==="header"?{topIndex:0,selector:"header",name:name,$type:"application/x-panel-header-sdata-page"}:name==="actionsPanel"?{selector:"aside.s-m-panel.s-m-freeright",$type:"application/x-panel-actions",name:name}:ctrl},render:function(){this.attachedControlsMgr.buildHtml()},computeLayout:function(context){if(this.destroyed)return;Base.prototype.computeLayout.call(this,context),this._$$list==null?(this.$$elmt.addClass("drafts"),this.$$contentRoot.html(_getHtml("content",{filtersMenu:this._buildSortMenu(),selectMenu:this._buildSelectMenu()})),this._$$selectMenu=this.$$contentRoot.find("#draftSelectMenuId"),this.$$info=this.$$contentRoot.find("#draftInfo"),this.$$listHeader=this.$$contentRoot.find(".s-m-draft-header"),this._$$list=this.$$contentRoot.find(".s-m-draft-list"),this.$$myScrollWrapper=this.$$contentRoot.find("#draftPageWrapper"),this.$$myScrollWrapper.css({height:"auto"}),this._myGestureMgr=scroller.newScroller(this._$$list,{isPageScroller:!0,direction:"v"}),this._updateList()):this._updateMyGesture(context&&context.preserveScroll===!0)},_buildSelectMenu:function(){var links=[];return _selectOptionsList.forEach(function(id){links.push({title:locale.text("multiselect.action."+id),params:id,$isHidden:!1})}),_getHtml("selectMenu",{links:links,title:locale.text("multiselect.selected"),dropDirection:"dropdown"})},_buildSortMenu:function(){this._selectedFilter=this._selectedFilter||"creation_date:asc";var opts=[],self=this;return this._filterOptions.forEach(function(item){item=$.extend({},item),item.selected=item.value===self._selectedFilter,opts.push(item)}),_getHtml("filtersMenu",{filterOptions:opts})},_updateList:function(){this._$$list.empty(),this._$$spinner=null,this.$$info.hide(),this.$$listHeader.hide();var self=this;modules.get("storage").getStorage().draftOperation("draftReadList").then(function(resources){resources=self._applyFilters(resources||[]);var content;if(resources.length>0){var recordsHtml=[];resources.forEach(function(rsrc,idx){recordsHtml.push(self._getRecordHtml(rsrc,idx))}),content=recordsHtml.join("\n")}self._$$list.html(content),self._$$spinner=$(_getHtml("spinner")).appendTo(self._$$list),self._updateUI()}).fail(function(e){modules.get("modal").error(locale.text("drafts.error.loading"),e,function(){self._$$list.html(_getHtml("error",{error:locale.text("error"),contact:locale.text("contact.admin")})),self._updateMyGesture()})})},_updateMyGesture:function(preserveScroll){if(!this._myGestureMgr)return;var mainRect=uiRect.elmtRect(this.$$contentElmt,"outer"),viewRect=uiRect.elmtRect(this.$$myScrollWrapper,"outer"),scrollRect=mainRect.intersectRect(viewRect);scrollRect&&scrollRect.height<this._myGestureMgr.$$elmt.height()?this._myGestureMgr.init(scrollRect,null,null,preserveScroll):this._myGestureMgr.reset()},_getRecordHtml:function(rsrc,index){rsrc=$.extend({},rsrc),rsrc.index=index==null?null:index+1;var date=rsrc.creation_date;return date&&(rsrc.creation_date=this.dateFormatter.formatValue(date)),rsrc.statusText=locale.text("drafts.status."+rsrc.status),rsrc.error=rsrc.errorMsg||"",_getHtml("record",rsrc)},_updateUI:function(preserveScroll){var allRecords=this._selectRecords("all").length,selectedRecords=this._selectRecords(".selected").length;this._$$selectMenu.find("a[data-naction]").toggle(selectedRecords>0),this._$$selectMenu.find('a[data-params="selectall"]').toggle(allRecords!==selectedRecords);var hiddenUnselRecords=this._selectRecords(":not(.selected):not(:visible)").length;this._$$selectMenu.find('a[data-params="hideunselected"]').toggle(selectedRecords>0&&selectedRecords<allRecords&&hiddenUnselRecords==0),this._$$selectMenu.find('a[data-params="showunselected"]').toggle(selectedRecords>0&&hiddenUnselRecords>0),this._$$selectMenu.find(".badge").text(selectedRecords);var panel=this.getPanel(this._toolsPanel);panel&&(panel.enableAction("draftsRemove",selectedRecords>0),panel.enableAction("draftsRunSynch",selectedRecords>0)),this.$$info.text(locale.text("drafts.info",[allRecords]));var isEmpty=allRecords==0;isEmpty&&this._$$list.html(locale.text("drafts.emptyList")),this._$$list.toggleClass("empty",isEmpty),this.$$info.toggle(!isEmpty),this.$$listHeader.toggle(!isEmpty),this._updateMyGesture(preserveScroll)},_selectRecords:function(cssSelector){var selector="";return cssSelector!="all"&&(selector+=cssSelector),this._$$list.find("section.s-m-draft-item"+selector)},_actFilter:function(params,evt){if(this._busy===!0)return;var val=$(evt.target).val();if(val==this._selectedFilter)return;this._selectedFilter=val,this._updateList()},_applyFilters:function(resources){if(!this._selectedFilter)return resources;var f=this._selectedFilter.split(":");if(f.length!=2)return resources;var property=f[0],order=f[1];return resources.sort(function(a,b){a=a[property],b=b[property];if(a==b)return 0;if(a>b)return order=="asc"?1:-1;if(a<b)return order=="asc"?-1:1}),resources},_actSelectMenu:function(action){var self=this;switch(action){case"selectall":case"unselectall":var elmts=self._selectRecords("all").show();action=="unselectall"&&(elmts=self._selectRecords(".selected")),elmts.each(function(){self._toggleRecordSelection($(this),action==="selectall")});break;case"hideunselected":self._selectRecords(":not(.selected)").hide();break;case"showunselected":self._selectRecords(":not(.selected)").show()}this._updateUI()},_actClickRecord:function(params,evt){evt.stopPropagation();if(this._busy===!0)return;var $$elmt=$(evt.target),$$rec=$$elmt.closest(".s-m-draft-item");if(!$$rec)return;var $$params=$$elmt.closest("[data-params]"),action=$$params.attr("data-params");if(action==="select")this._toggleRecordSelection($$rec),this._updateUI(!0);else if(action==="edit"){var id=$$rec.attr("id"),editUrl=$$params.attr("data-url");if(!id||!editUrl)return;modules.get("navHelper").gotoUrl(editUrl)}},_toggleRecordSelection:function($$rec,force){if(!$$rec||$$rec.length==0)return;$$rec.toggleClass("selected",force)},_mainUploadBegin:function(name,ids){this._stop=!1,this._busy=!0,this._logData={nbSuccess:0,nbErrors:0};var panel=this.getPanel(this._toolsPanel);panel&&(panel.showAction("draftsRunStop",!0),panel.enableAction("draftsRunStop",!0)),this._selectRecords(":not(.selected)").hide()},_mainUploadEnd:function(name){this._busy=!1;var panel=this.getPanel(this._toolsPanel);panel&&panel.showAction("draftsRunStop",!1),this.$$elmt.find(".synchronized").removeClass("synchronized"),this._selectRecords(":not(.selected)").show(),this._refreshIndexes(),this._updateUI()},_refreshIndexes:function(){this._$$list.find(".s-m-draft-item").each(function(idx){$(this).find(".badge.index").text(idx+1).show()})},_upload:function(ids){this._mainUploadBegin("upload",ids);var join=$.Deferred(),self=this;return this._uploadPop(ids).then(function(status){self._mainUploadEnd("upload"),join.resolve(status)}).fail(function(e){self._mainUploadEnd("upload"),join.reject(e)}),join.promise()},_uploadPop:function(ids,_mainDeferred,draftIdx){draftIdx=draftIdx==null?0:draftIdx;var first=_mainDeferred==null;first&&(_mainDeferred=$.Deferred());try{if(this._stop===!0){_mainDeferred.resolve("stopped");return}if(!ids||ids.length==0){_mainDeferred.resolve("completed");return}var self=this;this._uploadOne(ids.pop(),draftIdx).then(function(){setTimeout(function(){self._uploadPop(ids,_mainDeferred,draftIdx+1)})}).fail(function(e){_mainDeferred.reject(e)})}catch(e){_mainDeferred.reject(e)}return first?_mainDeferred.promise():null},_uploadOne:function(id,draftIdx){var self=this,deferred=$.Deferred();return this._uploadOneBegin(id).then(function(draftCtx){return sdataReq.processSaveDraft(draftCtx,draftIdx)}).then(function(result,draftCtx){if(!result)return $.smReject("unexpected null http response");if(result.success===!0)return self._uploadOneEnd(id,"saveSucceeded");draftCtx.status="error";if(result.status===401)draftCtx.errorMsg=locale.text("drafts.error.unauthorized");else if(result.offline===!0)draftCtx.errorMsg=locale.text("drafts.error.noconnection");else{var diags=sdataUtils.scanDiagnoses(result.data);draftCtx.errorMsg=diags.length>0?diags[0].$message:"No error message",result.data&&(draftCtx.dataSet=$.extend(!0,null,result.data))}return draftCtx.creation_date=utils.getCurISODateTime(new Date),self._uploadOneEnd(id,"saveFailed",{draftCtx:draftCtx})}).then(function(){deferred.resolve()}).fail(function(e){return self._uploadOneEnd(id,"exception",{exception:e})})},_processRecordBegin:function($$rec){if(this._$$spinner){var pos=$$rec.position();this._$$spinner.css({top:pos.top+"px",display:"table"}),this._$$spinner.children().outerHeight($$rec.outerHeight()).show()}this._myGestureMgr&&this._myGestureMgr.makeVisible($$rec)},_processRecordEnd:function($$rec){this._$$spinner&&this._$$spinner.hide(),this._updateMyGesture(),$$rec},_uploadOneBegin:function(id){return this._processRecordBegin(this.$$elmt.find("#"+id)),modules.get("storage").getStorage().draftOperation("draftRead",id)},_uploadOneEnd:function(id,status,opts){var self=this,$$record=this.$$elmt.find("#"+id);return this._processRecordEnd($$record),status==="saveSucceeded"?modules.get("storage").getStorage().draftOperation("draftDelete",id).then(function(){self._logData.nbSuccess++,$$record.remove()}).fail(function(e){return $.smReject(e)}):status==="saveFailed"?(self._logData.nbErrors++,modules.get("storage").getStorage().draftOperation("draftSave",opts.draftCtx).then(function(){var $$newRecord=$(self._getRecordHtml(opts.draftCtx)).addClass("selected synchronized");$$record.after($$newRecord),$$record.remove()}).fail(function(e){return $.smReject(e)})):status==="exception"?$.smReject(opts.exception):$.smReject(new Error("Unexpected draft status"))},_actDraftsRunStop:function(){this._stop=!0},_actDraftsRunSynch:function(){console.log("_actDraftsRunSynch");var self=this;this._upload(this._selectRecords(".selected").map(function(){return this.id}).get().reverse()).then(function(status){var nbSuccess=self._logData.nbSuccess,nbErrors=self._logData.nbErrors,count=nbSuccess+nbErrors;modules.get("modal").notify({title:locale.text("drafts.synch."+status),body:locale.text("drafts.synch.result",[count,nbSuccess,nbErrors]),severityClass:nbErrors>0?"warning":"success",delay:nbErrors>0?"medium":"short"})}).fail(function(e,status){modules.get("modal").error(locale.text("drafts.error.uploading"),e)})},_actDraftsRemove:function(){console.log("_actDraftsRemove");var self=this;$.smResolve().then(function(){return self._busy=!0,self._logData={nbSuccess:0},self._selectRecords(".selected").map(function(){return $(this)}).get().reverse()}).then(function($$records){var deferred=$.Deferred();return self._removePop($$records).then(function(){modules.get("modal").notify({title:locale.text("drafts.remove.completed",[self._logData.nbSuccess]),severityClass:"success",delay:"short"}),deferred.resolve(!0)}).fail(function(e){modules.get("modal").error(locale.text("drafts.error.removing"),e,function(){deferred.resolve(!1)})}),deferred.promise()}).always(function(){self._busy=!1,self._processRecordEnd(null),self._updateUI(),self._refreshIndexes()})},_removePop:function($$records,mainDeferred){var self=this,first=mainDeferred==null;first&&(mainDeferred=$.Deferred());var $$rec=$$records.length>0?$$records.pop():null;if($$rec==null){mainDeferred.resolve();return}return self._processRecordBegin($$rec),modules.get("storage").getStorage().draftOperation("draftDelete",$$rec.attr("id")).then(function(){self._logData.nbSuccess++,$$rec.remove(),setTimeout(function(){self._removePop($$records,mainDeferred)},500)}).fail(function(e){mainDeferred.reject(e)}),first?mainDeferred.promise():null}})}),define("syracuse-tablet/html/js/ui/modals/modalMultiButtons",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalDialog","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),modules=require("syracuse-tablet/html/js/common/modules"),_templateAll={header:'		{{#if title}}<div class="modal-title">{{title}}</div>{{/if}}',content:'		<div class="s-m-modal-content">			<p>{{{message}}}</p>		</div>',footer:'	{{#each buttons}}		<button type="button" {{#if isHidden}}style="display:none"{{/if}} class="btn btn-default {{#if smallBtns}}btn-sm{{/if}}{{#if isDisabled}}disabled{{/if}}" data-action="{{action}}">{{label}}</button>	{{/each}}'},_Klass=utils.defineClass(function ModalMultiButtons(title,message,opts){modalDialog.ModalBase.call(this),this._dataContext=$.extend({title:title,message:modalDialog.checkMsg(message||"")},opts),this.selectedAction=opts.defaultAction||null;var sl=modules.get("siteLayout");this._dataContext.buttons.forEach(function(b){b.smallBtns=sl.getDeviceType()==="smartphone"&&sl.getPageOrientation()==="portrait",b.label=b.label.toUpperCase()})},modalDialog.ModalBase,{_getTemplates:function(){return{std:_templateAll}},_onShow:function(evt){var self=this;self._css(siteLayout.getPageOrientation(),siteLayout.getDeviceType())},getDisplayFlags:function(){var res=this.displayFlags||{};return this.deviceType==="tablet"?res.modalClass="multibuttons tablet":res.modalClass="multibuttons mobile",res},_getDataContext:function(){return this._dataContext},_onAction:function(action,param){return this.selectedAction=action,!0},_getResult:function(){return this.selectedAction},_checkButtonSize:function(){var sl=modules.get("siteLayout");this.$$elmt.find("button").toggleClass("btn-sm",sl.getDeviceType()==="smartphone"&&sl.getPageOrientation()==="portrait")},notifMainLayoutChanged:function(info,orientation,deviceType){this._checkButtonSize(),info.orientationChanged&&this._css(orientation,deviceType)},_css:function(orientation,deviceType){if(deviceType!=="smartphone")return;var $$modalDialog=$(".modal-dialog",this.$$elmt);orientation==="portrait"?$$modalDialog.css("margin-top","50%"):$$modalDialog.css("margin-top","")}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/ui/modals/modalSaveDraft",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/ui/modals/modalMultiButtons","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/ui/modals/modalDialog"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),Base=require("syracuse-tablet/html/js/ui/modals/modalMultiButtons").Modal,locale=require("syracuse-tablet/html/js/helpers/locale"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),modalDialog=require("syracuse-tablet/html/js/ui/modals/modalDialog"),_template={comment:'		<div style="display:table;">			<div style="display:table-row;">				<div style="display:table-cell;padding-right: 20px;">					{{comment}}				</div>				<div style="display:table-cell;width:100%;">					<input type="text" style="width: 100%;">				</div>			</div>		</div>'},_Klass=utils.defineClass(function ModalSaveDraft(comment,offline){var opts={buttons:[]};["save","cancel"].forEach(function(act){opts.buttons.push({action:act,label:locale.text(act).toUpperCase()})});var type=offline===!0?"offline":"online";Base.call(this,locale.text("drafts.dlog.save.title."+type),locale.text("drafts.dlog.save.info."+type),opts),this._comment=comment||""},Base,{_attachDOM:function(){Base.prototype._attachDOM.call(this),$(Handlebars.compile(_template.comment)({comment:locale.text("comment").smCapitalize()})).appendTo(this.$$elmt.find(".s-m-modal-content")).find('input[type="text"]').val(this._comment).focus()},_getResult:function(){return{action:Base.prototype._getResult.call(this),comment:this.$$elmt.find('input[type="text"]').val()}},_onShow:function(evt){this._css(siteLayout.getPageOrientation(),siteLayout.getDeviceType())},notifMainLayoutChanged:function(info,orientation,deviceType){info.orientationChanged&&this._css(orientation,deviceType)},_css:function(orientation,deviceType){if(deviceType!=="smartphone")return;var $$modalDialog=$(".modal-dialog",this.$$elmt);orientation==="portrait"?$$modalDialog.css("margin-top","40%"):$$modalDialog.css("margin-top","")}});exports.Modal=_Klass}),define("syracuse-tablet/html/js/pages/drafts/pageSdataDraftable",["require","exports","module","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/sdata/sdataUtils","syracuse-tablet/html/js/ui/modals/modalMultiButtons","syracuse-tablet/html/js/ui/modals/modalSaveDraft"],function(require,exports,module){var utils=require("syracuse-tablet/html/js/helpers/utils"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),locale=require("syracuse-tablet/html/js/helpers/locale"),Base=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,modules=require("syracuse-tablet/html/js/common/modules"),sdataUtils=require("syracuse-tablet/html/js/sdata/sdataUtils"),modalMultiButtons=require("syracuse-tablet/html/js/ui/modals/modalMultiButtons"),modalSaveDraft=require("syracuse-tablet/html/js/ui/modals/modalSaveDraft");exports.Page=utils.defineClass(function PageSdataDraftable(pageData,options){Base.call(this,pageData,options);var urlParsed=jsutils.parseURL(pageData.$url);this._draftId=urlParsed.query?urlParsed.query.draftId:null,this._comment=null,this._draftStatus=null,this._errMsg=null;var draftCtx=this._draftId?this.getDataset().getClientContext("$draftContext"):null;draftCtx&&(this._comment=draftCtx.comment,this._draftStatus=draftCtx.status,this._errMsg=draftCtx.errorMsg)},Base,{_isDirty:function(){return this._errMsg!=this.getDataset().getClientContext("$draftContext.errorMsg")?!0:this.pageData.dataset.isDirty()},computeLayout:function(context){Base.prototype.computeLayout.call(this,context);if(this._gestureMgr){var self=this;setTimeout(function(){if(self.$$elmt){var $$err=self.$$elmt.find(".s-m-control.error");self._gestureMgr.makeVisible($$err,100)}},100)}},onGotoUrlAction:function(isBack,parsedUrl){return this.options.isChild?$.smResolve(!0):parsedUrl&&(parsedUrl.protocol==="child"||(jsutils.getPropByPath(parsedUrl,"query.representation")||"").indexOf(".$lookup")>0)?$.smResolve(!0):!this._isDirty()||this._draftStatus=="success"?$.smResolve(!0):this._draftId?this._saveDraft(!1):this._askSaveDraft()},_askSaveDraft:function(){var opts={buttons:[],defaultAction:"continue"};["saveAsDraft","continue","stayOnCurrentPage"].forEach(function(act){opts.buttons.push({action:act,label:locale.text(act)})});var modal=new modalMultiButtons.Modal(locale.text("drafts.dlog.savedraft.title"),locale.text("drafts.dlog.savedraft.info"),opts),self=this;return modal.show().then(function(result){return result==="saveAsDraft"?self._saveDraft(!0).then(function(saved,draftCtx){return saved===!0}):result!=="stayOnCurrentPage"})},_removeDiagnoses:function(){this.getDataset().removeDiagnoses(),this.controller.forEachControl(function(c){c.clearClientDiagnoses&&c.clearClientDiagnoses()})},beforeOnSdataActionClicked:function(actionName,controller){return actionName==="$save"&&this._removeDiagnoses(),$.smResolve(!0)},afterOnSdataActionClicked:function(actionName,success,beforeContext,response){var step;if(actionName==="$save"&&this._draftId&&success===!0)step=this._deleteDraft();else if(actionName==="$save"&&success!==!0){this._draftStatus="error";var diags=response?sdataUtils.scanDiagnoses(response):[];this._errMsg=diags.length>0?diags[0].$message:"No error message",step=$.smResolve()}else actionName==="$save"&&success!==!0?(this._errMsg=null,step=$.smResolve()):step=$.smResolve();var self=this;step.then(function(){Base.prototype.afterOnSdataActionClicked.call(self,actionName,success,beforeContext,response)})},_deleteDraft:function(actionName,success,beforeContext){return this._draftStatus="success",modules.get("storage").getStorage().draftOperation("draftDelete",this._draftId)},_saveDraft:function(confirm){var deferred=$.Deferred(),step;confirm===!0?step=(new modalSaveDraft.Modal(this._comment||"")).show():step=$.smResolve({action:"save",comment:this._comment||""});var self=this;return step.then(function(result){return result==null||result.action!="save"?null:self._saveDraftInDB(result.comment)}).then(function(ctx){ctx&&modules.get("modal").notify({severityClass:"success",title:locale.text("drafts.notify.saved"),body:null,delay:"short"}),deferred.resolve(ctx!=null,ctx)}).fail(function(e){modules.get("modal").asynchError(locale.text("drafts.error.saving"),e).always(function(){deferred.resolve(!1,null)})}),deferred.promise()},_saveDraftInDB:function(comment){var uuid=this._draftId?this._draftId:this.pageData.dataset.getValue("$uuid");if(!uuid)return $.smReject("Unexpected null uuid");var endPoint=modules.get("appController").App.getDefaultEndpoint();if(!endPoint)return $.smReject("Unexpected null endPoint");var draftUrl=this.pageData.$url;if(!draftUrl)return $.smReject("Unexpected null $url");draftUrl=jsutils.parseURL(draftUrl),draftUrl.query=draftUrl.query||{},draftUrl.query.$mobileProtocol="stateless",draftUrl.query.$mobileEndpoint=endPoint,draftUrl.query.draftId=uuid,draftUrl=jsutils.urlToString(draftUrl);var draftContext={id:uuid,draftUrl:draftUrl,endpoint:modules.get("appController").App.getDefaultEndpoint(),representation:this.pageData.prototype.data("$representation"),status:this._draftStatus||"unsavedchanges",errorMsg:this._draftStatus==="error"?this._errMsg:"",title:this.pageData.prototype.data("$title")||"",comment:comment||"",dataSet:this.getDataset().getDraftsData(this.controller),creation_date:utils.getCurISODateTime(new Date)};return modules.get("storage").getStorage().draftOperation("draftSave",draftContext)}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataChildPage",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/controls/articleParser","syracuse-tablet/html/js/controllers/sdataController","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,modules=require("syracuse-tablet/html/js/common/modules"),articleParser=require("syracuse-tablet/html/js/controls/articleParser"),SdataController=require("syracuse-tablet/html/js/controllers/sdataController").SdataController,utils=require("syracuse-tablet/html/js/helpers/utils");exports.Page=utils.defineClass(function PageSdataChildPage(pageData,options){this.options=options||{},this.parentController=modules.get("controller").findController(options.childContext.controllerId),pageData=this._createPageData(pageData),Base.call(this,pageData,options),this.actionAdapter.showPinPage=!1},Base,{destroy:function(){Base.prototype.destroy.call(this)},_createPageData:function(pageData){var dataset=this.parentController.dataset,childPageData=$.extend(!0,{},pageData);return childPageData.dataset=dataset,childPageData.prototype=dataset.prototype,childPageData.page.$article=this._getArticle(dataset.prototype),childPageData},_getArticle:function(prototype){return articleParser.createDefaultArticle(prototype)},_ensureController:function(){this.controller=new SdataController(this.pageData.dataset,this.parentController,this.isWorkingCopyDataUrl()),this.controller.setUIAdapter(this)},getAuthoringName:function(){return"$$child"},getRootPage:function(){return this.controller.root.uiAdapter}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataRowDetail",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdataChildPage","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdataChildPage").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),modules=require("syracuse-tablet/html/js/common/modules");exports.Page=utils.defineClass(function PageSdataRowDetail(pageData,options){Base.call(this,pageData,options);if(!this.options.childContext.rowControl)throw new Error("Unexpected null rowControl");this._activity=this.options.childContext.activity,this.actionAdapter.showAccept=["create","edit"].indexOf(this._activity)>=0,this.actionAdapter.showCancel=["create"].indexOf(this._activity)>=0,this.actionAdapter.showDesignPage=!1,this.datasetBackupJson=$.extend(!0,{},this.controller.dataset.json)},Base,{destroy:function(){Base.prototype.destroy.call(this),this.options.childContext.rowControl=null},getPageTitle:function(){return this.controller.dataset.parent.prototype.getValueByPath("$title",!0)},_actAccept:function(){if(!this.options.childContext.rowControl)return;var self=this;setTimeout(function(){self.options.childContext.rowControl.notifyRowSaved()})},_actHistoryBack:function(){this._cancel()},_actCancel:function(){this._cancel()},_cancel:function(){return this._activity==="create"?this.options.childContext.rowControl.removeRowDetail():this.controller.applyDatasetBackup(this.datasetBackupJson).fail(function(result){modules.get("modal").error(result)}),modules.get("appController").App.goBack()}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataChartDetail",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/helpers/utils"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),utils=require("syracuse-tablet/html/js/helpers/utils");exports.Page=utils.defineClass(function PageSdataChartDetail(pageData,options){options=options||{},options.nativeCapabilities={liveTile:!0,scheduleMessage:!0,share:!0};var settings=pageData.settings?pageData.settings.chartDetail:{};this.applySettings(pageData.page.$article,settings),Base.call(this,pageData,options),this.controller.level=this.options.level||0,this.actionAdapter.showPinPage=!1},Base,{destroy:function(){Base.prototype.destroy.call(this)},scrollAllowed:function(){return!0},_getDefaultAttachedControls:function(){var controls=[],device=siteLayout.getDeviceType();return controls=["header","chartDetailToolBar"],controls},getChartDetailSetting:function(){var settings=this.getPageSettings()||{};return settings.chartDetail},_setDisplay:function(){var chartSettings=this.getChartDetailSetting()||{};this.authUpdateLayout(this.getArticle(chartSettings))},actToolbarSetDisplay:function(opts){this._setChartDetailPrefs(opts),this._setDisplay(),this.writePageSettings().then(function(){})},_setChartDetailPrefs:function(opts){var settings=this.getPageSettings();settings.chartDetail=opts,settings.isDirty=!0},isChartDetail:function(){return!0},getArticle:function(chartSettings){var $article=Base.prototype.getArticle.call(this);return chartSettings&&this.applySettings($article,chartSettings),$article},applySettings:function($article,chartSettings){if(!chartSettings)return;$article.$display=chartSettings.display||$article.$display,this._setArticlesSettings($article,chartSettings,{})},_setArticlesSettings:function($article,chartSettings){var articles=this.getArticles($article);articles.arrayChartArticle&&(articles.arrayChartArticle.$items[0].$isHidden=chartSettings.display==="arrayOnly"),articles.arrayArticle&&(articles.arrayArticle.$items[0].$isHidden=chartSettings.display==="chartOnly");var sameSize=articles.arrayChartArticle&&!articles.arrayChartArticle.$items[0].$isHidden&&articles.arrayArticle&&!articles.arrayArticle.$items[0].$isHidden&&chartSettings.display==="bothSideToSide";articles.arrayChartArticle&&articles.arrayArticle&&(articles.arrayChartArticle.$sameSize=articles.arrayArticle.$sameSize=sameSize,sameSize&&(articles.arrayArticle.$widthAll=articles.arrayChartArticle.$widthAll=6),articles.arrayChartArticle.$items[0].$arrayOptions.showPagination=chartSettings.display==="chartOnly"&&articles.arrayArticle.$items[0].$arrayOptions&&articles.arrayArticle.$items[0].$arrayOptions.showPagination),chartSettings.style&&articles.arrayChartArticle&&(articles.arrayChartArticle.$items[0].$style=chartSettings.style)},getArticles:function(node,articles){if(!node.$items)return;articles=articles||{};for(var i=0;i<node.$items.length;i++)node.$items[i].$display==="chart"?articles.arrayChartArticle=node:["card","carousel","table"].indexOf(node.$items[i].$display)>-1&&(articles.arrayArticle=node),this.getArticles(node.$items[i],articles);return articles},_isStatistics:function(){return this.pageData.prototype.getValueByPath("codeStat")!=undefined},allowAuthoring:function(){return Base.prototype.allowAuthoring.call(this)&&(this.options.level===0||!this._isStatistics())}})}),define("syracuse-tablet/html/js/pages/sdata/pageSdataCardDetail",["require","exports","module","syracuse-tablet/html/js/pages/sdata/pageSdataChildPage","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/controls/articleParser"],function(require,exports,module){var Base=require("syracuse-tablet/html/js/pages/sdata/pageSdataChildPage").Page,utils=require("syracuse-tablet/html/js/helpers/utils"),locale=require("syracuse-tablet/html/js/helpers/locale"),articleParser=require("syracuse-tablet/html/js/controls/articleParser");exports.Page=utils.defineClass(function PageSdataCardDetail(pageData,options){Base.call(this,pageData,options),this.actionAdapter.showAccept=!1,this.actionAdapter.showCancel=!1,this.actionAdapter.showDesignPage=!1,this.actionAdapter.showPinPage=!1},Base,{destroy:function(){Base.prototype.destroy.call(this)},_createPageData:function(pageData){var childPageData=this.options.childContext.cardDetailPageData;return childPageData.page.$article||(childPageData.page.$article=this._getArticle(childPageData.prototype)),childPageData},_getArticle:function(prototype){return articleParser.createDefaultArticle(prototype)},getCardArrayControl:function(){var parentPageController=this.controller.findController(this.options.childContext.controllerId);if(parentPageController){var arrayControl=parentPageController.getControl(this.options.childContext.arrayControlId);if(arrayControl)return arrayControl}},getCardArticle:function(){return this.getArticle()},getPageTitle:function(){return locale.text("auth.designCardLayout")},isCardDetail:function(){return!0}})}),define("syracuse-tablet/html/js/pages/pageFactory",["require","exports","module","syracuse-tablet/html/js/sdata/sdataRequester","syracuse-tablet/html/js/sdata/wpHelpers","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/controls/array/filterHelper","syracuse-tablet/html/js/sdata/protocolHelpers","syracuse-tablet/html/js/pages/sdata/pageSdata","syracuse-tablet/html/js/pages/sdata/pageSdataQuery","syracuse-tablet/html/js/pages/sdata/pageSdataLookup","syracuse-tablet/html/js/pages/sdata/pageSdataDashboard","syracuse-tablet/html/js/pages/sdata/pageHome","syracuse-tablet/html/js/pages/html/pageLogin","syracuse-tablet/html/js/pages/html/pageLogout","syracuse-tablet/html/js/pages/drafts/pageDrafts","syracuse-tablet/html/js/pages/drafts/pageSdataDraftable","syracuse-tablet/html/js/pages/sdata/pageSdataRowDetail","syracuse-tablet/html/js/pages/sdata/pageSdataChartDetail","syracuse-tablet/html/js/pages/sdata/pageSdataCardDetail"],function(require,exports,module){function _fetchSDataPageHomeData(options){return $.smResolve().then(function(){return wpHelpers.fetchWelcomePageData(options)}).then(function(pageData){return pageData.$originalUrl=pageData.$url,pageData})}function _fetchSDataPageData(url,options,method,pagePrefsId){var pageSettings;return $.smResolve().then(function(){return settings.readUserPagePrefs(pagePrefsId)}).then(function(settings){return settings.isDirty=!1,settings}).then(function(settings){pageSettings=settings;var opts={$url:url,sortInfo:settings.sort,filterInfos:settings.filter,searchInfo:settings.search},$url;url.indexOf(".$query")>-1&&($url=filterHelper.filterSortUpdateUrl(opts)),$url=$url||url;var _page={$url:$url,$method:method||"GET"};return sdataReq.fetchPageData(_page,options)}).then(function(pageData){return pageData.settings=pageSettings,pageData.$originalUrl=url,pageData})}function _createSdataPage(pageData,pageCreateData,options){var proto=pageData.prototype,facet=proto.getFacet();options.isChartDetail&&(facet="$chartDetail");var $url=proto.getValueByPath("$url",!0),syrRepr=proto.getValueByPath("$representation");if(syrRepr==="mobileDashboard")return pageData.name=pageData.dataset.json.dashboardName+".$mobileDashboard",new _classes.PageSdataDashboard(pageData,options);pageData.name=pageCreateData.name;if(!(!pageData.dataset.isStateLessMode()||facet!=="$edit"&&facet!=="$create"))return new _classes.PageSdataDraftable(pageData,options);switch(facet){case"$query":return new _classes.PageSdataQuery(pageData,options);case"$lookup":return new _classes.PageSdataLookup(pageData,options);case"$chartDetail":return new _classes.PageSdataChartDetail(pageData,options);default:return new _classes.PageSdata(pageData,options)}}function _createHtmlPage(pageName,options){return $.smResolve().then(function(){var pageClass=_htmlPages[pageName];if(!pageClass)throw new Error("Html page "+pageName+" not found");var page=new pageClass(pageName,options);return page})}function _createChildPage(pageName,options){return $.smResolve().then(function(){var pageClass=_childPages[pageName];if(!pageClass)throw new Error("Child page "+pageName+" not found");var pageData={};return pageData.page={},options=options||{},options.childPageName=pageName,new pageClass(pageData,options)})}var sdataReq=require("syracuse-tablet/html/js/sdata/sdataRequester"),wpHelpers=require("syracuse-tablet/html/js/sdata/wpHelpers"),settings=require("syracuse-tablet/html/js/app/settings"),filterHelper=require("syracuse-tablet/html/js/controls/array/filterHelper"),protoHelpers=require("syracuse-tablet/html/js/sdata/protocolHelpers"),_classes={PageSdata:require("syracuse-tablet/html/js/pages/sdata/pageSdata").Page,PageSdataQuery:require("syracuse-tablet/html/js/pages/sdata/pageSdataQuery").Page,PageSdataLookup:require("syracuse-tablet/html/js/pages/sdata/pageSdataLookup").Page,PageSdataDashboard:require("syracuse-tablet/html/js/pages/sdata/pageSdataDashboard").Page,PageHome:require("syracuse-tablet/html/js/pages/sdata/pageHome").Page,PageLogin:require("syracuse-tablet/html/js/pages/html/pageLogin").Page,PageLogout:require("syracuse-tablet/html/js/pages/html/pageLogout").Page,PageDrafts:require("syracuse-tablet/html/js/pages/drafts/pageDrafts").Page,PageSdataDraftable:require("syracuse-tablet/html/js/pages/drafts/pageSdataDraftable").Page,PageSdataRowDetail:require("syracuse-tablet/html/js/pages/sdata/pageSdataRowDetail").Page,PageSdataChartDetail:require("syracuse-tablet/html/js/pages/sdata/pageSdataChartDetail").Page,PageSdataCardDetail:require("syracuse-tablet/html/js/pages/sdata/pageSdataCardDetail").Page},_htmlPages={login:_classes.PageLogin,logout:_classes.PageLogout,home:_classes.PageHome,drafts:_classes.PageDrafts},_childPages={SdataRowDetail:_classes.PageSdataRowDetail,SdataChartDetail:_classes.PageSdataChartDetail,SdataCardDetail:_classes.PageSdataCardDetail};exports.createPage=function(pageCreateData){var url=pageCreateData.url,method=pageCreateData.method,options=pageCreateData.options||{},fetchOptions={data:null,isChartDetail:pageCreateData.options.isChartDetail===!0};return pageCreateData.name=pageCreateData.name||protoHelpers.getPageName(url),pageCreateData.pagePrefsId=options.isVignette?options.pagePrefsId:settings.getPagePrefsId(pageCreateData.name),options.isVignette&&options.$vignetteArticle?fetchOptions.page={$article:$.extend(!0,null,options.$vignetteArticle)}:options.$mockArticle&&(fetchOptions.page={$article:$.extend(!0,null,options.$mockArticle)}),$.smResolve().then(function(){return url.indexOf("html://")===0?pageCreateData.name==="HOME"?_fetchSDataPageHomeData(options).then(function(pageData){pageData.$url=url,pageData.$method=method,pageData.name=pageCreateData.name;var page=new _classes.PageHome(pageData,options);return page}):_createHtmlPage(pageCreateData.name,options):url.indexOf("child://")===0?_createChildPage(pageCreateData.name,options):_fetchSDataPageData(url,fetchOptions,method,pageCreateData.pagePrefsId).then(function(pageData){pageData.$url=url,pageData.$method=method;var page=_createSdataPage(pageData,pageCreateData,options);return page})})}}),define("syracuse-tablet/html/js/helpers/base64",["require","exports","module"],function(require,exports,module){var Base64=exports.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=Base64._utf8_encode(input);while(i<input.length)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(chr1&3)<<4|chr2>>4,enc3=(chr2&15)<<2|chr3>>6,enc4=chr3&63,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);return output},decode:function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(enc2&15)<<4|enc3>>2,chr3=(enc3&3)<<6|enc4,output+=String.fromCharCode(chr1),enc3!=64&&(output+=String.fromCharCode(chr2)),enc4!=64&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output),output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(c&63|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(c&63|128))}return utftext},_utf8_decode:function(utftext){var string="",i=0,c1,c2,c3,c=c1=c2=0;while(i<utftext.length)c=utftext.charCodeAt(i),c<128?(string+=String.fromCharCode(c),i++):c>191&&c<224?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((c&31)<<6|c2&63),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63),i+=3);return string},raw_decode:function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(enc2&15)<<4|enc3>>2,chr3=(enc3&3)<<6|enc4,output+=String.fromCharCode(chr1),enc3!=64&&(output+=String.fromCharCode(chr2)),enc4!=64&&(output+=String.fromCharCode(chr3));return output}};exports.encode=function(text){return Base64.encode(text)}}),define("syracuse-tablet/html/js/app/session",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/base64","syracuse-tablet/html/js/app/settings","syracuse-tablet/html/js/common/helpers","syracuse-tablet/html/js/helpers/locale","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/native/native"],function(require,exports,module){function _parseReconnectCookie(cookie){if(!cookie)return null;cookie=cookie.split("/");if(cookie.length<3)return null;var token=cookie.pop(),series=cookie.pop(),login=cookie.join("/");return login}var modules=require("syracuse-tablet/html/js/common/modules"),base64=require("syracuse-tablet/html/js/helpers/base64"),settings=require("syracuse-tablet/html/js/app/settings"),helpers=require("syracuse-tablet/html/js/common/helpers"),locale=require("syracuse-tablet/html/js/helpers/locale"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("session",!1),native=require("syracuse-tablet/html/js/helpers/native/native");exports.getAuthMethods=function(){var ajax=modules.get("ajax");return ajax.request("/requireJS/misc/availableAuth").then(function(result){var list=[];return result&&result.data&&Object.keys(result.data).forEach(function(key){var supported=result.data[key];supported&&list.push(key)}),{$supported:list,$oauth2:result.data&&result.data.$oauth2,$saml2:result.data&&result.data.$saml2}})},exports.getCurrentUserProfile=function(){return modules.get("ajax").request("/sdata/syracuse/collaboration/syracuse/userProfiles/$service/current").then(function(result){if(result.data)return result.data;throw new Error("Empty user profile")})},exports.loginBasic=function(user,password,rememberMe){var deferred=$.Deferred(),headers={Authorization:"Basic "+base64.encode(user+":"+password),accept:"application/json"},data={forgetme:!0};rememberMe===!0&&(data.keepConnected=!0);var ajax=modules.get("ajax");return ajax.request("/auth/login/submit","POST",data,headers).then(function(result){exports.nativeStoreReconnectToken(),deferred.resolve(result.data)}).fail(function(result){deferred.reject(result)}),deferred.promise()},exports.loginSageId=function(){window.location.href="/auth/sage-id/signOnStart"},exports.logout=function(){var ajax=modules.get("ajax");return ajax.request("/logout","POST")},exports.forgetMe=function(){var ajax=modules.get("ajax");return ajax.request("/auth/forgetMe/submit","POST",{forgetme:!0}).always(function(){settings.removeLastUsedUserProfile()})},exports.storeUserProfile=function(profile){return settings.setLastUsedUserProfile(profile)},exports.applyNewContext=function(settings,userProfile,endpoint,role,language){var roleMatch,localeMatch,endpointMatch;settings.roles.some(function(r){if(r.code===role)return roleMatch=r,!0});if(!roleMatch)return $.smReject(helpers.createDiag({},"error",locale.text("switchContext.error.role",[role])));settings.locales.some(function(l){if(l.code===language)return localeMatch=l,!0});if(!roleMatch)return $.smReject(helpers.createDiag({},"error",locale.text("switchContext.error.language",[language])));roleMatch.endPoints.some(function(e){if(e.code===endpoint)return endpointMatch=e,!0});if(!endpointMatch)return $.smReject(helpers.createDiag({},"error",locale.text("switchContext.error.endpoint",[endpoint])));var changeDelta={};userProfile.selectedEndpoint.$uuid!==endpointMatch.$uuid&&(changeDelta.selectedEndpoint={$uuid:endpointMatch.$uuid}),userProfile.selectedRole.$uuid!==roleMatch.$uuid&&(changeDelta.selectedRole={$uuid:roleMatch.$uuid}),userProfile.selectedLocale.$uuid!==localeMatch.$uuid&&(changeDelta.selectedLocale={$uuid:localeMatch.$uuid});if(Object.keys(changeDelta).length<=0)return $.smResolve();var ajax=modules.get("ajax");return ajax.request("/sdata/syracuse/collaboration/syracuse/userProfiles/$service/updateProfile","POST",changeDelta).then(function(result){return exports.storeUserProfile(result.data).then(function(){return result.data})})},exports.getReconnectToken=function(){var deferred=new $.Deferred,ajax=modules.get("ajax");return ajax.request("/requireJS/reconnect/getToken","GET",null,{accept:"application/json"}).always(function(result){if(result.status===200&&result.headers){var token=result.headers["x-reconnect-token"],sid=result.headers["x-reconnect-sid"],loginCookieName=result.headers["x-reconnect-login-cookiename"],sidCookieName=result.headers["x-reconnect-sid-cookiename"],login=_parseReconnectCookie(token);deferred.resolve(login?token:null,login,sid,loginCookieName,sidCookieName)}else deferred.resolve()}),deferred.promise()},exports.setReconnectToken=function(loginCookie,sidCookie){var deferred=new $.Deferred;loginCookie=loginCookie||"",sidCookie=sidCookie||"",log&&log("setReconnectToken - Login: ",loginCookie," - sid: ",sidCookie);var ajax=modules.get("ajax");return ajax.request("/requireJS/reconnect/setToken","GET",null,{accept:"application/json","x-reconnect-token":loginCookie,"x-reconnect-sid":sidCookie}).then(function(result){log&&log("setReconnectToken succeeded",loginCookie,sidCookie)}).fail(function(result){log&&log("setReconnectToken failed")}).always(function(){deferred.resolve()}),deferred.promise()},exports.nativeStoreReconnectToken=function(){var deferred=new $.Deferred,nativeApp=native.getModule("nativeApp");return nativeApp?(exports.getReconnectToken().then(function(token,userLogin,sid,loginCookieName,sidCookieName){log&&log("nativeStoreReconnectToken",token,userLogin,sid,loginCookieName,sidCookieName),nativeApp.setReconnectToken(token,userLogin,sid,loginCookieName,sidCookieName)}).always(function(){deferred.resolve()}),deferred.promise()):$.smResolve()}}),define("syracuse-tablet/html/js/sdata/sdatawhere/whereUtils",["require","exports","module"],function(require,exports,module){function _exec(data,exp,proto){if(exp.type=="identifier"){exp.property=data[exp.value];var item=proto&&proto.$properties&&proto.$properties.$resources?proto.$properties.$resources.$item:null;item&&item.$properties&&item.$properties[exp.value]&&item.$properties[exp.value].$type==="application/x-boolean"&&(exp.property=exp.property===!0?2:1)}else if(exp.type=="literal")exp.property=exp.dataType=="datetime"?exp.svalue:exp.value;else if(exp.children){var property=null;if(exp.type=="operator")switch(exp.value.code){case"and":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property&&exp.children[1].property;break;case"or":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property||exp.children[1].property;break;case"between":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property>=exp.children[1].property&&exp.children[0].property<=exp.children[2].property;break;case">=":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property>=exp.children[1].property;break;case">":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property>exp.children[1].property;break;case"<=":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property<=exp.children[1].property;break;case"<":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property<exp.children[1].property;break;case"like_s":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.property=exp.children[0].property.toUpperCase().indexOf(exp.children[1].property.toUpperCase())===0;break;case"like":exp.children.forEach(function(child){_exec(data,child,proto)});var val=exp.children[1].property.toUpperCase().replace(/%/g,"");exp.property=exp.children[0].property.toUpperCase().indexOf(val)>=0;break;case"=":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.children[0].property=="0000-00-00"&&exp.children[1].dataType==="datetime"&&(exp.children[0].property=""),exp.children[1].property=="0000-00-00"&&exp.children[0].dataType==="datetime"&&(exp.children[1].property=""),exp.property=exp.children[0].property==exp.children[1].property;break;case"<>":exp.children.forEach(function(child){_exec(data,child,proto)}),exp.children[0].property=="0000-00-00"&&exp.children[1].dataType==="datetime"&&(exp.children[0].property=""),exp.children[1].property=="0000-00-00"&&exp.children[0].dataType==="datetime"&&(exp.children[1].property=""),exp.property=exp.children[0].property!=exp.children[1].property;break;case".":_exec(data,exp.children[0],proto),_exec(exp.children[0].property,exp.children[1],proto),exp.property=exp.children[1].property;break;default:exp.property=property,exp.children.forEach(function(child){_exec(data,child,proto),child.type=="literal"&&(child.property=property)})}else if(exp.type=="function")throw new Error("exp.type == 'function' not implemented")}}exports.execWhere=function(dataContext,exp,proto){return exp==null?!0:(_exec(dataContext,exp,proto),exp.property)}}),define("syracuse-tablet/html/js/sdata/sdataSort",["require","exports","module"],function(require,exports,module){function _sdataSortArray(data,proto,orderBy){var comparators=[],properties=proto.$properties.$resources&&proto.$properties.$resources.$item&&proto.$properties.$resources.$item.$properties||proto.$properties;orderBy.forEach(function(exp){var prop=exp.property,sort=exp.sort==="DESC"||exp.sort==="desc"?"DESC":"ASC",type=properties[prop]&&properties[prop].$type||"application/x-string";if(type==="application/x-decimal"){if(sort==="ASC"){try{comparators.push(function(a,b){var vala=a[prop],valb=b[prop];return+vala- +valb})}catch(e){}return 0}try{comparators.push(function(a,b){var vala=a[prop],valb=b[prop];return+valb- +vala})}catch(e){}return 0}sort==="ASC"?comparators.push(function(a,b){try{var vala=a[prop],valb=b[prop];if(vala>valb)return 1;if(vala<valb)return-1}catch(e){}return 0}):comparators.push(function(a,b){try{var vala=a[prop],valb=b[prop];if(vala>valb)return-1;if(vala<valb)return 1}catch(e){}return 0})}),data.sort(function(a,b){var c=0;for(var i=0;i<comparators.length;i++){c=comparators[i](a,b);if(c!==0)break}return c})}exports.sdataSortArray=_sdataSortArray}),define("syracuse-tablet/html/js/sdata/cache/sdataCache",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/utils","syracuse-tablet/html/js/storage/storage","syracuse-tablet/html/js/sdata/sdatawhere/parser","syracuse-tablet/html/js/sdata/sdatawhere/whereUtils","syracuse-tablet/html/js/sdata/sdataSort"],function(require,exports,module){function _SDataCache(){}var modules=require("syracuse-tablet/html/js/common/modules"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("SDataCache",!1),utils=require("syracuse-tablet/html/js/helpers/utils"),storageModule=require("syracuse-tablet/html/js/storage/storage"),parser=require("syracuse-tablet/html/js/sdata/sdatawhere/parser").Parser,whereUtils=require("syracuse-tablet/html/js/sdata/sdatawhere/whereUtils"),sdataSort=require("syracuse-tablet/html/js/sdata/sdataSort"),_cachePrefix="$cache_",_keyRegExp=/\{(.*?)\}/g,_cache,_SDataCacheClass=utils.defineClass(_SDataCache,null,{cachePrefix:_cachePrefix,put:function(data){var deferred=$.Deferred(),self=this;try{if(!data.$data)throw new Error("PUT: No data specified");var repr,key;if(data.$proto){var $proto=self._getProto(data.$proto);repr=self._getRepresentation($proto),key=self._getKeyValue(data.$data,$proto)}else{if(!data.$representation||!data.$key)throw new Error("PUT: Neither proto nor representation and key specified");repr=data.$representation,key=data.$key}self.getStorage().put({$context:self.getCacheContext(),$collection:_cachePrefix+repr,$endpoint:data.$endpoint,$key:key,$data:{$item:data.$data}}).then(function(result){deferred.resolve()}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},query:function(data){var deferred=$.Deferred(),self=this;try{var repr;log&&log("Query by: "+JSON.stringify(data));if(data.$proto){var $proto=self._getProto(data.$proto);repr=self._getRepresentation(data.$proto)}else{if(!data.$representation)throw new Error("QUERY: Neither proto nor representation specified");if(data.$where)throw new Error("QUERY: Where clause parsing requires prototype");if(data.$orderBy)throw new Error("QUERY: Order by requires prototype");repr=data.$representation}self.getStorage().query({$context:self.getCacheContext(),$endpoint:data.$endpoint,$collection:_cachePrefix+repr}).then(function(result){var res=[];if(data.$where){var exp=parser.parse(data.$where);result.$data.forEach(function(item,i){if(whereUtils.execWhere(item.$item,exp,$proto)){var d=item.$item,m=result.$metaData[i];d.$cache={$lastRead:m.$lastRead,$lastUpdated:m.$lastUpdated},res.push(d)}})}else result.$data.forEach(function(item,i){var d=item.$item,m=result.$metaData[i];d.$cache={$lastRead:m.$lastRead,$lastUpdated:m.$lastUpdated},res.push(d)});data.$orderBy&&sdataSort.sdataSortArray(res,$proto,data.$orderBy),deferred.resolve(res)}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},read:function(data){var deferred=$.Deferred(),self=this;try{var repr;if(!data.$key)throw new Error("READ: No key specified");if(data.$proto){var $proto=self._getProto(data.$proto);repr=self._getRepresentation($proto)}else{if(!data.$representation)throw new Error("READ: Neither proto nor representation specified");repr=data.$representation}self.getStorage().read({$context:self.getCacheContext(),$collection:_cachePrefix+repr,$endpoint:data.$endpoint,$key:data.$key}).then(function(result){if(result.$status===storageModule.StatusCodes.OK){var res=result.$data.$item;res.$cache={$lastRead:result.$metaData.$lastRead,$lastUpdated:result.$metaData.$lastUpdated},deferred.resolve(res)}else deferred.resolve(null)}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},remove:function(data){var deferred=$.Deferred(),self=this;try{var repr;if(!data.$key)throw new Error("REMOVE: No key specified");if(data.$proto){var $proto=self._getProto(data.$proto);repr=self._getRepresentation($proto)}else{if(!data.$representation)throw new Error("READ: Neither proto nor representation specified");repr=data.$representation}self.getStorage().remove({$context:self.getCacheContext(),$collection:_cachePrefix+repr,$endpoint:data.$endpoint,$key:data.$key}).then(function(){deferred.resolve()}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},clearCache:function(options){var deferred=$.Deferred(),self=this,re=new RegExp(self.cachePrefix.replace(/([\$\_]+)/g,"\\$1")),opts={$context:self.getCacheContext(),$collection:re};options&&options.$not_read_since&&(opts.$not_read_since=options.$not_read_since);try{self.getStorage().clearCollection(opts).then(function(){deferred.resolve()}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},computeCacheSize:function(options){var deferred=$.Deferred(),self=this,re=new RegExp(self.cachePrefix.replace(/([\$\_]+)/g,"\\$1")),opts={$context:self.getCacheContext(),$collection:re};options&&options.$not_read_since&&(opts.$not_read_since=options.$not_read_since);try{self.getStorage().computeCollectionSize(opts).then(function(result){deferred.resolve(result)}).fail(function(error){deferred.reject(error)})}catch(e){deferred.reject(e)}finally{return deferred.promise()}},_getProto:function(proto){var itemProto=proto.$properties.$resources&&proto.$properties.$resources.$item||proto;return itemProto.$type=proto.$type,itemProto},_getRepresentation:function(proto){return proto.$type.split(".").slice(1,3).join(".").replace("$queryItem","$query")},_getKeyValue:function(data,proto){return proto.$key.replace(_keyRegExp,function(m,p){return data[p]})},getStorage:function(){return this._storage||(this._storage=modules.get("storage").getStorage()),this._storage},getCacheContext:function(){return modules.get("appController").App.getCacheContext()}});exports.getCache=function(){return _cache||(_cache=new _SDataCache),_cache}}),define("syracuse-tablet/html/js/init/initModules",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/app/navigationHelper","syracuse-tablet/html/js/app/navigationPageStack","syracuse-tablet/html/js/controls/ctrlFactory","syracuse-tablet/html/js/pages/pageFactory","syracuse-tablet/html/js/controllers/controller","syracuse-tablet/html/js/ui/modals/modal","syracuse-tablet/html/js/ui/siteLayout","syracuse-tablet/html/js/app/appController","syracuse-tablet/html/js/common/ajax","syracuse-tablet/html/js/app/session","syracuse-tablet/html/js/storage/storage","syracuse-tablet/html/js/sdata/cache/sdataCache"],function(require,exports,module){function _initComponentModules(){return $.smResolve().then(function(){modules.addModule("navHelper",navigationHelper),modules.addModule("navStack",navigationPageStack),modules.addModule("ctrlFactory",ctrlFactory),modules.addModule("pageFactory",pageFactory),modules.addModule("controller",controller),modules.addModule("modal",modal),modules.addModule("siteLayout",siteLayout),modules.addModule("appController",appController),modules.addModule("ajax",ajax),modules.addModule("session",session),modules.addModule("storage",storage),modules.addModule("cache",cache)})}var modules=require("syracuse-tablet/html/js/common/modules"),navigationHelper=require("syracuse-tablet/html/js/app/navigationHelper"),navigationPageStack=require("syracuse-tablet/html/js/app/navigationPageStack"),ctrlFactory=require("syracuse-tablet/html/js/controls/ctrlFactory"),pageFactory=require("syracuse-tablet/html/js/pages/pageFactory"),controller=require("syracuse-tablet/html/js/controllers/controller"),modal=require("syracuse-tablet/html/js/ui/modals/modal"),siteLayout=require("syracuse-tablet/html/js/ui/siteLayout"),appController=require("syracuse-tablet/html/js/app/appController"),ajax=require("syracuse-tablet/html/js/common/ajax"),session=require("syracuse-tablet/html/js/app/session"),storage=require("syracuse-tablet/html/js/storage/storage"),cache=require("syracuse-tablet/html/js/sdata/cache/sdataCache");exports.init=function(){return $.smResolve().then(function(){return _initComponentModules()})}}),define("syracuse-tablet/html/js/init/initStorage",["require","exports","module","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/common/modules"],function(require,exports,module){var native=require("syracuse-tablet/html/js/helpers/native/native"),modules=require("syracuse-tablet/html/js/common/modules");exports.init=function(){return $.smResolve().then(function(){return native.getSupportedDB()}).then(function(supportedDB){return modules.get("storage").init(supportedDB)})}}),define("syracuse-tablet/html/js/main",["require","exports","module","syracuse-tablet/html/js/common/modules","syracuse-tablet/html/js/helpers/logger","syracuse-tablet/html/js/helpers/environment","syracuse-tablet/html/js/utils/waiting","syracuse-tablet/html/js/helpers/native/native","syracuse-tablet/html/js/helpers/jsutils","syracuse-tablet/html/js/helpers/developmentPage","syracuse-tablet/html/js/init/initThirdParty","syracuse-tablet/html/js/init/initStyles","syracuse-tablet/html/js/ui/uiSettings","syracuse-tablet/html/js/init/initLocale","syracuse-tablet/html/js/init/initModules","syracuse-tablet/html/js/init/initStorage","syracuse-tablet/html/js/app/appController"],function(require,exports,module){function _checkModuleDependencies(){xrayquire.showCycles(undefined,!0)}function _startApp(){var sessionAvailable,firstPage,initTask=$.smResolve().then(function(){return _initPlatform()}).then(function(){_nativeApp&&_nativeApp.notifLoaded()}).then(function(){return developmentPage.restoreOnStartup()}).then(function(){return App.init()}).then(function(){return _checkSession()}).then(function(_sessionAvailable){sessionAvailable=_sessionAvailable}).then(function(){firstPage=_defineFirstPage(),log&&log("First page to open: "+JSON.stringify(firstPage))});return waiting.waitModal(initTask).then(function(){if(sessionAvailable===!0)return modules.get("appController").App.initApplicationsList().then(function(){return modules.get("navHelper").gotoUrl(firstPage.url,firstPage.method,firstPage.options,{firstPage:!0})});var offline=sessionAvailable==="offline";return modules.get("navHelper").gotoUrl("html://login",null,{offline:offline,onLogin:{gotoUrl:firstPage}})}).then(function(){modules.get("appController").App.applicationIsStarted()}).fail(function(e){_onError(e)})}function _initPlatform(){return $.smResolve().then(function(){return initThirdParty.init()}).then(function(){return initModules.init()}).then(function(){return native.init()}).then(function(){environment.init(),_nativeApp=native.getModule("nativeApp")}).then(function(){return initStyles.init()}).then(function(detectedOS){return uiSettings.init(detectedOS)}).then(function(){return initLocale.init()}).then(function(){return initStorage.init()})}function _checkSession(){var deferred=$.Deferred(),session=modules.get("session"),profile,step,nativeApp=native.getModule("nativeApp");return nativeApp?step=nativeApp.getReconnectToken().then(function(loginCookie,sidCookie){if(loginCookie||sidCookie)return session.setReconnectToken(loginCookie,sidCookie)}):step=$.smResolve(),step.then(function(){return session.getCurrentUserProfile()}).then(function(_profile){return profile=_profile,App.setUserProfile(profile)}).then(function(){return session.storeUserProfile(profile)}).then(function(){session.nativeStoreReconnectToken(),deferred.resolve(!0)}).fail(function(result){result.unauthenticated===!0?deferred.resolve("nosession"):result.offline===!0?deferred.resolve("offline"):deferred.reject(result)}),deferred.promise()}function _defineFirstPage(){var url,page;page=_checkNativeContext();if(page)return page;try{url=jsutils.parseURL(window.location.href)}catch(e){}var query=url&&url.query,url=query.url,method=query.method||"GET";return url?page={url:url,method:method,options:null,loadOptions:{firstPage:!0}}:page={url:"html://home"},page}function _checkNativeContext(){if(_nativeApp){log&&log("Native app, check for context");var contextToRestore=_nativeApp.getReconnectContext();if(contextToRestore){var obj;if(typeof contextToRestore=="string")try{obj=JSON.parse(contextToRestore)}catch(e){}else obj=contextToRestore}if(obj&&obj.url){var ctxString=JSON.stringify(obj);return log&&log("Native app, context: "+ctxString),{url:"context://"+encodeURIComponent(contextToRestore),options:null,loadOptions:{firstPage:!0}}}}}var modules=require("syracuse-tablet/html/js/common/modules"),log=require("syracuse-tablet/html/js/helpers/logger").getLogger("main",!1),environment=require("syracuse-tablet/html/js/helpers/environment"),waiting=require("syracuse-tablet/html/js/utils/waiting"),native=require("syracuse-tablet/html/js/helpers/native/native"),jsutils=require("syracuse-tablet/html/js/helpers/jsutils"),developmentPage=require("syracuse-tablet/html/js/helpers/developmentPage"),initThirdParty=require("syracuse-tablet/html/js/init/initThirdParty"),initStyles=require("syracuse-tablet/html/js/init/initStyles"),uiSettings=require("syracuse-tablet/html/js/ui/uiSettings"),initLocale=require("syracuse-tablet/html/js/init/initLocale"),initModules=require("syracuse-tablet/html/js/init/initModules"),initStorage=require("syracuse-tablet/html/js/init/initStorage"),App=require("syracuse-tablet/html/js/app/appController").App,_nativeApp,_onError=function(error){waiting.reset();try{modules.get("modal").asynchError(error)}catch(e){alert(JSON.stringify(jsutils.convertToDiagnoses(error),null,2))}};window.onerror=function(errorMsg,url,lineNumber,error){var diag={$diagnoses:[{$message:errorMsg,$stackTrace:"url:"+url+"\nLineNUmber:"+lineNumber+"\nError:"+error,$severity:"error"}]};_onError(diag)},$(document).ready(function(){document.location.href.indexOf("?circular")>-1?_checkModuleDependencies():_startApp()})});