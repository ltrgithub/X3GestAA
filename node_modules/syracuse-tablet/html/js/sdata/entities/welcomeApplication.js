"use strict";

var clientContract = require('syracuse-tablet/html/js/sdata/entities/clientContract');
var globals = require('syracuse-tablet/html/js/helpers/globals');

var _welcomeApplication = {
	"$application": {
		"$uuid": "$welcomeApplication",

		"applicationName": "$welcomeApplication",
		"title": "Welcome",
		"description": "Welcome",
		"iconName": "gears",

		"$homeDashboard": {
			"$uuid": "$welcomeDashboard",
			"dashboardName": "$welcomeDashboard"
		},
	},
	"$dashboards": {
		"$welcomeDashboard": {
			"$pageInfo": {
				"isWelcomePage": true,
			},
			"$update": function(dashboard) {
				return _updateWelcomeDashboard(dashboard);
			},
			"$dashboardName": "$welcomeDashboard",
			"$title": "Welcome",
			"$description": "Welcome, this is your personal dashboard",
		}
	},
	"$gadgets": {
		"testLayoutsDashboard": {
			"$type": "$representation",
			"$title": "Query facet",
			"entity": "testDataTypes",
			"action": "$query",
			"representation": "testDataTypes",
			"facet": "$query",
			"keyParameter": "5"
		}
	}
};

function _updateWelcomeDashboard(dashboard) {
	dashboard.$vignettes = {
		"testLayoutsDashboard": {
			"$uuid": "testLayoutsDashboard",
			"$displayStyle": "$link"
		}
	};
	dashboard.$article = {
		"$layoutType": "stack",
		"$items": [{
			"$layoutType": "row",
			"displayOptions": {
				"rowHeight": "150px"
			},
			"$widthXs": "1",
			"$items": [{
				"$bind": "testLayoutsDashboard"
			}]
		}]
	};

	_welcomeApplication.$gadgets = {};
	dashboard.$vignettes = {};
	dashboard.$article = {
		"$layoutType": "hub",
		"$items": [
			/* {
				"$layoutType": "hubGroup",
				"$title": "Gadgets",
				"$items": []
			}, */
			{
				"$layoutType": "hubGroup",
				"$title": "Applications",
				"$items": []
			}
		]
	};

	var apps = globals.getValidApplications();
	Object.keys(apps).forEach(function(appName) {
		var app = apps[appName];
		if (app.applicationName !== _welcomeApplication.$application.applicationName) {
			var name = "$welcome_" + app.applicationName;
			var gadget = {
				"$type": "$application",
				"$title": app.title,
				"applicationName": app.applicationName
			};

			var vignette = {
				"$uuid": name
			};
			_welcomeApplication.$gadgets[name] = gadget;
			dashboard.$vignettes[name] = vignette;

			dashboard.$article.$items[0].$items.push({
				$bind: name,
				$size: "wide"
			});
		}
	});
	return dashboard;
}

exports.register = function() {
	clientContract.registerApp(_welcomeApplication);
};