"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/structElmt').Klass;
var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("ctrl");
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

var _Klass = utils.defineClass(
	function(controller, article, prototype) {
		var self = this;
		self.prototype = prototype;
		Base.call(self, controller, prototype.data('$type'), article);
	}, Base, {
		defaultDisplayOptions: function() {
			var self = this;
			return {
				cssDefCtrl: ["s-m-control", "s-m-" + self.typeName + "-ctrl"]
			};
		},
		destroy: function() {
			var self = this;
			self.prototype = null;
			Base.prototype.destroy.call(self);
		},
		/**
		 * Default ctrl html  - Just the value embedded into a div
		 */
		buildHtml: function(html, controllerDao, buildOptions) {
			var self = this;
			self.buildHtmlBefore(html, controllerDao, buildOptions);
			if (controllerDao) {
				if (!controllerDao.getDisplayValue) throw new Error("BuildHtml - dao is expected for data parameter");
				self.buildHtmlValue(html, controllerDao, buildOptions);
			}
			self.buildHtmlAfter(html, controllerDao, buildOptions);
		},
		buildHtmlValue: function(html, controllerDao, buildOptions) {
			var self = this;
			if (self.article.$isTitleHidden !== true) {
				html.push(self.prototype.property(self.article.$bind, "$title") + " = ");
			}
			var v = controllerDao.getDisplayValue(self.article.$bind) || "";
			html.push(v.length === 0 ? "&nbsp" : v);
		},
		buildHtmlBefore: function(html, controllerDao, buildOptions) {
			var self = this;
			if (self.displayOptions.link) {
				html.push('<a href="#" ');
				html.push(uiUtils.getLinkAttrs(self.displayOptions.link));
				html.push('>');
			}
			html.push('<div class="');
			html.push(self.displayOptions.cssDefCtrl.join(' '));
			html.push('" id="');
			html.push(self.id);
			html.push('"');
			html.push(' title="');
			html.push(self.article.$bind);
			html.push('"');
			html.push('>');
		},
		buildHtmlAfter: function(html, controllerDao, buildOptions) {
			var self = this;
			html.push('</div>');
			if (self.displayOptions.link) {
				html.push('</a>');
			}
		}
	});

exports.Klass = _Klass;