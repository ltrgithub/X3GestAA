"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/structElmt').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 * Default ctrl html  - Just the value embedded into a div
 */
var _Klass = utils.defineClass(

	function(controller, article, prototype) {
		var self = this;
		self.prototype = prototype;
		var $type = prototype.data('$type');
		Base.call(self, controller, $type, article);
		self.ensureEditMode();
	}, Base, {
		ensureEditMode: function() {
			if (!this.$isEditMode) {
				this.$isEditMode = this.article.$isEditMode;
			}
			if (!this.$isEditMode) {
				// TODO get page facet property
			}
		},
		destroy: function() {
			var self = this;
			self.prototype = null;
			Base.prototype.destroy.call(self);
		},
		buildHtml: function(parent, controllerDao, buildOptions) {
			var self = this;
			var fieldSlot = uiUtils.createDomElement("div", ["sm-field-slot"], null, {
				"id": this.id
			});

			this.buildFieldTitle(fieldSlot, buildOptions);
			this.buildFieldCore(fieldSlot, controllerDao, buildOptions);

			parent.appendChild(fieldSlot);
		},

		buildFieldTitle: function(parentSlot, buildOptions) {
			// don't build field title if grid cell
			if (!this.article.$isTitleHidden && buildOptions && buildOptions.isGridCell !== true) {
				parentSlot.appendChild(uiUtils.createDomElement("div", ["sm-field-title"], this.prototype.property(this.article.$bind).$title));
			}
		},

		buildFieldCore: function(parentSlot, controllerDao, buildOptions) {
			var fieldCore = uiUtils.createDomElement("div", ["sm-field-core"]);
			var fieldValueSlot = uiUtils.createDomElement("div", ["sm-field-value-slot"]);
			var fieldValue = uiUtils.createDomElement("div", ["sm-field-value"]);
			fieldValueSlot.appendChild(fieldValue);
			fieldCore.appendChild(fieldValueSlot);


			this.buildFieldValue(fieldValue, controllerDao, buildOptions);
			parentSlot.appendChild(fieldCore);
		},
		buildFieldValue: function(parentSlot, controllerDao, buildOptions) {
			if (!controllerDao) throw new Error("BuildHtml - dao is expected for data parameter");

			if (this.$isEditMode) {
				parentSlot.appendChild(uiUtils.createDomElement("input", ["sm-field-input", "form-control"], null, {
					"type": "text",
					"value": controllerDao.getValue(this.article.$bind)

				}));
			} else {
				parentSlot.appendChild(uiUtils.createDomElement("div", ["sm-field-value-read"], controllerDao.getValue(this.article.$bind)));
			}
		}
	}
);

exports.Klass = _Klass;