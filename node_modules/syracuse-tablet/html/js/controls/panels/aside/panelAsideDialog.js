"use strict";

var Base = require('syracuse-tablet/html/js/controls/panels/aside/panelAsideBase').PanelAsideBase;
var utils = require('syracuse-tablet/html/js/helpers/utils');

var _html = {
	header: '\
			<div class="header">\
			<buttons class="pull-right"> \
				<button type="button" class="btn btn-default s-m-modal-btn-cancel" data-control-id="{{ctrlId}}" data-nevent data-naction="cancel"></button>\
			</buttons> \
			<div class="modal-title">{{title}}</div> \
			</div>\
			'
}

var _templates = {};

function _getHtml(name, ctx) {
	var tmpl = _templates[name];
	if (!tmpl) {
		tmpl = _templates[name] = Handlebars.compile(_html[name]);
	}
	return tmpl(ctx);
};

/**
 * Manages an header with title and close
 * options.title contains the tile
 */
exports.PanelAsideDialog = utils.defineClass(
	function PanelAsideDialog(controller, type, article, options) {
		options.noCloseOnClick = true;
		Base.call(this, controller, type, article, options);
	}, Base, {

		destroy: function() {
			this.$$elmt.closest("aside").removeClass("dialogpanel");
			Base.prototype.destroy.call(this);
			this._$$header = null;
		},

		buildHtml: function() {
			Base.prototype.buildHtml.call(this);
			this.$$elmt.addClass("s-m-dialogPanel");
			if (this._$$header) {
				this._$$header.remove();
			}
			var ctx = {
				side: this.attachedSide,
				ctrlId: this.id,
				title: this.options.title || "  "
			};
			this._$$header = this._buildHeader(ctx);
			if (this._$$header && this._$$header.length > 0) {
				this.$$elmt.prepend(this._$$header);
			}
		},
		_buildHeader: function(ctx) {
			return $(_getHtml("header", ctx));
		},
		_actCancel: function() {
			this.hide();
		},
		_makeVisible: function() {
			this.$$elmt.closest("aside").addClass("dialogpanel");
			Base.prototype._makeVisible.call(this);
		},
		_makeInvisible: function() {
			Base.prototype._makeInvisible.call(this);
			this.$$elmt.closest("aside").removeClass("dialogpanel");
		},
	});