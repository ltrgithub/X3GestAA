"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var fontUtils = require('syracuse-tablet/html/js/ui/fontUtils');
var Base = require('syracuse-tablet/html/js/controls/field/ctrlFieldBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 * Icon used by arrays
 * Displays an icon according to the value of $icon in prototype
 * prototype properties
 * 		$url to attach a link to the icon
 * 		$action to attach an action/navigation to the icon
 * 			Contains all the parameters for the link (data-action, data-params...)
 */
var _Klass = utils.defineClass(

	function(controller, article, prototype) {
		Base.call(this, controller, article, prototype);
	}, Base, {

		buildFieldValue: function(parentSlot, buildOptions) {
			var self = this;
			var $$parent = $(Base.prototype.buildFieldValue.call(self, parentSlot, buildOptions));
			var html = [];
			var url = self.prototype.data("$url");
			if (url && url.length) {
				html.push('<a href="' + url + '">');
			} else {
				// attributes for data-nav or data-action
				var action = self.prototype.data("$action") || self.prototype.data("$navigation");
				if (action) {
					html.push('<a href="*"');
					for (var p in action) {
						html.push(' ' + p + '="' + action[p] + '"');
					}
					html.push('</a>');
				}
			}
			html.push('<span class="' + fontUtils.ctrlIcon(self.prototype.data('$icon')) + '"></span>');
			if (html.length > 1) html.push('</a>');
			$$parent.html(html.join(''));
		}
	});

exports.Klass = _Klass;