"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/ctrlBase').Klass;
var fieldOperators = require('syracuse-tablet/html/js/helpers/fieldOperators');

/**
 * Display the row status in table array mode
 * Enabled by authoring 'manage a status'
 */
var _Klass = utils.defineClass(

	function CtrlRowStatus(controller, article, prototype) {
		Base.call(this, controller, article, prototype);
	}, Base, {
		buildHtml: function($$parent, rowData, buildOptions) {
			var self = this;
			var ctrlArray = buildOptions.htmlRootCtrl;
			if (!ctrlArray) return;
			var statusList = ctrlArray.getRowStatusInfo();
			if (!statusList) return;
			Base.prototype.buildHtml.call(self, $$parent, rowData, buildOptions, ["s-m-row-status"]);
			statusList.some(function(s) {
				if (s.color && fieldOperators.evaluateOperator(s.$type, rowData.getValue(s.field), s.operator, s.value)) {
					self.$$elmt.html('<div class="s-m-status-color ' + s.color.css + '"></div>');
					return true;
				}
			});
		}
	});

exports.Klass = _Klass;