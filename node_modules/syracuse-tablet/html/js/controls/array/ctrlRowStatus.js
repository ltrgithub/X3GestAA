"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/ctrlBase').Klass;
var fieldOperators = require('syracuse-tablet/html/js/helpers/fieldOperators');
var fontUtils = require('syracuse-tablet/html/js/ui/fontUtils');

/**
 * Display the row status in table array mode
 * Enabled by authoring 'manage a status'
 */
var _Klass = utils.defineClass(

	function CtrlRowStatus(controller, article, prototype) {
		Base.call(this, controller, article, prototype);
	}, Base, {
		buildHtml: function($$parent, rowData, buildOptions) {
			var self = this;
			var ctrlArray = buildOptions.htmlRootCtrl;
			if (!ctrlArray) return;
			var statusInfo = ctrlArray.getRowStatusInfo();
			if (!statusInfo) return;
			Base.prototype.buildHtml.call(self, $$parent, rowData, buildOptions, ["s-m-row-status"]);
			var h, defIcon = fontUtils.getArrayStatusDefIcon(),
				icon;
			statusInfo.list.some(function(s) {
				if (s.color && fieldOperators.evaluateOperator(s.$type, rowData.getValue(s.field), s.operator, s.value)) {
					icon = s.icon || defIcon;
					// We use background color for color icon
					self.$$elmt.html('<div class="' + icon.css + '" style="color:' + s.color.bgColor + '"/>');
					return true;
				}
			});
		}
	});

exports.Klass = _Klass;