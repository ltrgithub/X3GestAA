"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/layout/layoutBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 */
var _Klass = utils.defineClass(

	function(controller, type, article, opts) {
		var self = this;
		Base.call(self, controller, type, article, opts);
	}, Base, {

		buildHtml: function($$parent, controllerDao, buildOptions) {
			var self = this;
			Base.prototype.buildHtml.call(self, $$parent, controllerDao, buildOptions);
			self.$$elmt.addClass("s-m-row");
			var attrs = {};
			if (self.displayOptions && self.displayOptions.rowHeight) {
				attrs.style = "height:" + self.displayOptions.rowHeight;
			}
			var widths = self._getWidthClasses();
			var coreSlot = uiUtils.createDomElement("div", ["row"], null, attrs, self.$$elmt);
			$.each(self.children, function(index, child) {
				var coreItemClassList = ["s-m-layout-cell"];
				coreItemClassList.smExtend(widths[index]);
				var coreItem = uiUtils.createDomElement("div", coreItemClassList, null, null, coreSlot);
				child.buildHtml($(coreItem), controllerDao, buildOptions);
			});
		},

		_getWidthClasses: function() {
			var self = this;
			var widths = {};
			var sizes = [{
				$prop: "$widthLg",
				$prefix: "col-lg-"
			}, {
				$prop: "$widthMd",
				$prefix: "col-md-"
			}, {
				$prop: "$widthSm",
				$prefix: "col-sm-"
			}, {
				$prop: "$widthXs",
				$prefix: "col-xs-"
			}];

			sizes.forEach(function(size) {
				var $width = self.article[size.$prop];
				if ($width) {
					var $prefix = size.$prefix;
					var cols = $width.split(",");
					if (self.children.length === cols.length) {
						for (var index = 0; index < self.children.length; index++) {
							widths[index] = widths[index] || [];
							widths[index].push($prefix + cols[index].trim());
							size.$added = true;
						}
					}
				}
			});

			// if there is no size for the smallest device kind, set it to 12 (full row) to have a default for all devices
			var smallest = sizes[sizes.length - 1];
			if (smallest.$added !== true) {
				for (var index = 0; index < self.children.length; index++) {
					widths[index] = widths[index] || [];
					widths[index].push(smallest.$prefix + "12");
				}
			}
			return widths;
		}
	}
);

exports.Klass = _Klass;