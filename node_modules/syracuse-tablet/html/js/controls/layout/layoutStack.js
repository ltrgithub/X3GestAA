"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/layout/layoutBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 * cssOptions
 * 		cssLayout, cssCell: class added to default ones
 * default classes can  be overridden
 */
var _Klass = utils.defineClass(
	function(controller, type, article) {
		var self = this;
		Base.call(self, controller, type, article);
	}, Base, {
		buildHtml: function($$parent, controllerDao, buildOptions) {
			var self = this;
			Base.prototype.buildHtml.call(self, $$parent, controllerDao, buildOptions);
			self.$$elmt.addClass("s-m-stack");
			$.each(self.children, function(index, child) {
				// s-m-layout-cell-dummy does not have 100% height
				var core = uiUtils.createDomElement("div", ["s-m-layout-cell-dummy"], null, null, self.$$elmt);
				child.buildHtml($(core), controllerDao, buildOptions);
			});
			// TODO: Review: Stacks with one control are full height in vignettes
			if ($$parent.attr('class').indexOf("s-m-vignette-content-slot") > -1) {
				var $$ctrl = self.$$elmt.find(".s-m-control");
				if ($$ctrl.length === 1) {
					self.$$elmt.height("100%");
					// Make cell 100% height
					$$ctrl.closest(".s-m-layout-cell-dummy").attr("class", "s-m-layout-cell");
				}
			}
		}
	});

exports.Klass = _Klass;