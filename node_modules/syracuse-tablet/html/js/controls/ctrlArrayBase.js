"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("ctrl");
var Base = require('syracuse-tablet/html/js/controls/ctrlBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 * x-array control class
 */
var _Klass = utils.defineClass(
	function(controller, article, prototype) {
		var self = this;
		Base.call(self, controller, article, prototype);
		self.itemProto = prototype.getPrototype("$item");
	}, Base, {
		/**
		 * Build Html by using a builder class
		 */
		buildHtml: function(parent, controllerDao, buildOptions) {
			var self = this;

			self.container = uiUtils.createDomElement('div', ["s-m-control", "s-m-grid"], null, {
				"id": this.id
			});

			var title = self.prototype.property(self.article.$bind, "$title");
			if (title) {
				var header = uiUtils.createDomElement('div', ["s-m-grid-title"]);
				header.textContent = title;
				self.container.appendChild(header);
			}
			self._buildTable();
			parent.appendChild(self.container);
		},

		_buildTable: function() {
			var self = this;
			self.table = uiUtils.createDomElement('table', ["table table-hover s-m-grid-body"]);
			self.tableHead = uiUtils.createDomElement('thead');
			self.tableBody = uiUtils.createDomElement('tbody');
			self.table.appendChild(self.tableHead);
			self.table.appendChild(self.tableBody);

			self.container.appendChild(self.tableBody);
		},

		/**
		 * Returns an array that contains rows data
		 * Each row data is a dao - see DaoSdata.getQueryData
		 */
		getRows: function(controllerDao) {
			var self = this;
			var d = self._getData(controllerDao);
			return d && d.$resources ? d.$resources : [];
		},
		_getData: function(controllerDao) {
			var self = this;
			if (self._data) return self._data;
			self._data = controllerDao.getArrayData(self.article.$bind, self.itemProto);
			return self._data;
		}
	});

exports.Klass = _Klass;