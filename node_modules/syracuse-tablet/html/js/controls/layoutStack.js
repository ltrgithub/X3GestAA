"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/layoutBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');

/**
 * cssOptions
 * 		cssLayout, cssCell: class added to default ones
 * default classes can  be overridden
 */
var _Klass = utils.defineClass(
	function(controller, type, article) {
		var self = this;
		Base.call(self, controller, type, article);
	}, Base, {
		buildHtml: function(parent, controllerDao, buildOptions) {
			var container = uiUtils.createDomElement('div', ["container", "s-m-layout", "s-m-stack"], null, {
				"id": this.id
			});

			if (this.article.$title) {
				var header = uiUtils.createDomElement('header', ["s-m-layout-header"]);
				header.textContent = this.article.$title;
				container.appendChild(header);
			}


			$.each(this.children, function(index, value) {
				// s-m-layout-cell-dummy does not have 100% height
				var coreItem = uiUtils.createDomElement("div", ["s-m-layout-cell-dummy"]);
				container.appendChild(coreItem);
				this.buildHtml(coreItem, controllerDao, buildOptions);
			});

			// TODO: Review: Stacks with one control are full height in vignettes
			if ($(parent).attr('class').indexOf("s-m-vignette-content-slot") > -1) {
				var $$c = $(container);
				var $$ctrl = $$c.find(".s-m-control");
				if ($$ctrl.length === 1) {
					container.style.height = "100%";

					// Make cell 100% height
					$$ctrl.closest(".s-m-layout-cell-dummy").attr("class", "s-m-layout-cell");
				}
			}
			parent.appendChild(container);
		}
	});

exports.Klass = _Klass;