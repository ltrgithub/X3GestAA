"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/ctrlBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');
var formatApi = require('syracuse-tablet/html/js/helpers/formatApi');

var _Klass = utils.defineClass(
	function(controller, article, prototype) {
		var self = this;
		Base.call(self, controller, article, prototype);
		var $type = prototype.data('$type');
		self.formatter = formatApi.getApi($type);
	}, Base, {
		buildFieldValue: function(parentSlot, controllerDao, buildOptions) {
			if (!controllerDao) throw new Error("BuildHtml - dao is expected for data parameter");
			var rawValue = controllerDao.getValue(this.article.$bind);
			try {
				var value = this.formatter.parse(rawValue);
				// TODO: Add format pattern
				value = value.toString();
			} catch (e) {
				value = rawValue;
			}
			if (this.$isEditMode) {
				parentSlot.appendChild(uiUtils.createDomElement("input", ["sm-field-input", "form-control"], null, {
					"type": "text",
					"value": value
				}));
			} else {
				parentSlot.appendChild(uiUtils.createDomElement("div", ["sm-field-value-read"], value));
			}
		}
	});

exports.Klass = _Klass;