"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/ctrlFieldBase').Klass;
var uiUtils = require('syracuse-tablet/html/js/ui/uiUtils');
var formatApi = require('syracuse-tablet/html/js/helpers/formatApi');
var modal = require('syracuse-tablet/html/js/ui/modal');

var _Klass = utils.defineClass(

	function(controller, article, prototype) {
		var self = this;
		Base.call(self, controller, article, prototype);
	}, Base, {
		buildFieldValue: function(parentSlot, buildOptions) {
			var self = this;
			var value;

			value = self.getFormattedValue(self.getValue());
			if (this.$isEditMode) {

				var inputGroup = uiUtils.createDomElement("div", ["input-group"], null, null, parentSlot);

				self.domInput = uiUtils.createDomElement("input", ["sm-field-input", "form-control"], null, {
					"type": "text",
					"value": value
				}, inputGroup);
				var span = uiUtils.createDomElement("span", ["input-group-btn"], null, null, inputGroup);
				self.picker = uiUtils.createDomElement("button", ["btn", "btn-default"], null, null, span);

				var iconClasses = self.$type.indexOf("date") != -1 ? ["glyphicon", "glyphicon-calendar"] : ["glyphicon", "glyphicon-time"];
				uiUtils.createDomElement("span", iconClasses, null, null, self.picker);

				$(self.picker).click(function() {
					modal.info("Date time selector", "not implemented yet", function(modalEvent, $$modalElmt) {
						// run actions on close
						if (modalEvent == 'hidden.bs.modal') {
							//TODO
						}
						// event on open "shown.bs.modal"
					});
				});

				$(self.domInput).blur(function() {
					self._onBlur.call(self, this);
				});
			} else {
				parentSlot.appendChild(uiUtils.createDomElement("div", ["sm-field-value-read"], value));
			}
		}
	});

exports.Klass = _Klass;