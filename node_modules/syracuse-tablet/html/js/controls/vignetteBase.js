"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("vignette");
var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/controls/ctrlBase').Klass;
var factory = require('syracuse-tablet/html/js/application/appFactory');
var controlsFactory = require('syracuse-tablet/html/js/controls/ctrlFactory');
var reqPage = require('syracuse-tablet/html/js/pages/page');

var _Klass = utils.defineClass(
	function(controller, article, prototype) {
		var self = this;
		Base.call(self, controller, article, prototype);
	}, Base, {

		destroy: function() {
			var self = this;
			Base.prototype.destroy.call(self);
		},

		buildHtmlBefore: function(html) {
			var self = this;
			html.push('<div class="s-m-vignette" id="');
			html.push(self.id);
			html.push('">');
			html.push('<h1>' + self.typeName + '</h1><p>' + self.id + '</p>');
			return html;
		},
		buildHtmlAfter: function(html) {
			var self = this;
			html.push('</div>');
			return html;
		}

		/*
		load: function($elmt) {
			var self = this,
				state;
			var deferred = $.Deferred();
			var rejectError = function(e) {
				var msg = "Vignette page [" + (state ? state.name : "?") + "] loading error";
				log && log(msg, e);
				alert(msg);
				deferred.reject(e);
			};
			try {
				self.$elmt = $elmt;
				var state = self._getPageInfo();
				var dstPage = factory.createPage(self.$elmt, state);
				dstPage.load().then(function() {
					dstPage.activate(null, function() {
						// vignette displayed
					});
				}, rejectError);
			} catch (e) {
				rejectError(e);
			} finally {
				return deferred.promise();
			}
		},
		
		_getPageInfo: function() {
			var self = this;
			var gadget = self.$prototype.$gadget;
			if (gadget.$type === "$representation") {
				var name = gadget.representation + "." + gadget.facet;
				var page = reqPage.pageInfo(name, {
					vignette: true
				});
				if (page) return page;
			}
			return reqPage.pageInfo("vignetteerror", {
				vignette: true
			});
		}*/
	});

exports.Klass = _Klass;