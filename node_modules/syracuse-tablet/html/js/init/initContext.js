"use strict";

var globals = require('syracuse-tablet/html/js/helpers/globals');
var modalSelectContext = require('syracuse-tablet/html/js/pages/html/modalSelectContext');
var notifications = require('syracuse-tablet/html/js/helpers/notifications');

var sdataCommonResources = require('syracuse-tablet/html/js/sdata/sdataCommonResources');

exports.init = function(force) {
	var role = "abc";
	var endpoint = "SUPERV";
	var language = "en_GB";

	var endpoints;
	var roles = [];
	var languages = [];

	return sdataCommonResources.queryEndpoints()
		.then(function(eps) {
			endpoints = eps;
			return sdataCommonResources.queryLocalePreferences();
		})
		.then(function(ls) {
			languages = ls;
			return sdataCommonResources.queryRoles();
		})
		.then(function(rs) {
			roles = rs;
		})
		.then(function() {
			return modalSelectContext.selectContext({
				endpoint: endpoint,
				role: role,
				language: language
			}, endpoints, roles, languages);
		})
		.then(function(context) {
			globals.setEndpoint(context.endpoint);
			//return _setLocales(locale, userProfile);
			return context;
		})
		.then(function(context) {
			notifications.publish("sm.context.changed", context);
			return context;
		});
};