"use strict";

var jsutils = require('syracuse-tablet/html/js/helpers/jsutils');
var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("startupUrl", true);

var _startupUrl;
var _parsedAttrs;

exports.initStartupUrl = function() {
	try {
		var parsedUrl = jsutils.parseURL(window.location.href);
		_startupUrl = parsedUrl && parsedUrl.query && parsedUrl.query.url;
		_ensureValidUrl();
	} catch (e) {}
}

// Check if urlFromCaller is something the client could understand, set null if not
function _ensureValidUrl() {
	if (!_startupUrl) return;
	try {
		var parsedUrl = jsutils.parseURL(_startupUrl);
		var repr = parsedUrl.query.representation;
		var ep = parsedUrl.path.split("/").slice(2, 5).join(".");
		var page = [ep, repr].join(".");
		_parsedAttrs = {
			"data-nav": page,
			"data-sdata-url": _startupUrl
		}
	} catch (e) {
		_startupUrl = null;
		_parsedAttrs = null;
	}
}

// Return only once the attributes to navigate to on startup
exports.navTargetAttrs = function() {
	var attrs = _parsedAttrs;
	_startupUrl = null;
	_parsedAttrs = null;
	return attrs;
}