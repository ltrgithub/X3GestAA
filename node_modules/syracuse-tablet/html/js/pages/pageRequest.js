"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var Base = require('syracuse-tablet/html/js/pages/pageRegular').Page;

/**Temporarily - exclude fields other than $resources
 *
 */
var _hideUnusedFields = function(proto) {
	var props = proto.data("$properties");
	if (!props) return proto;
	for (var p in props) {
		props[p]["$isExcluded"] = (p !== "$resources");
	}
	return proto;
};
/**
 * Request page/controller
 * Used for requests and statistics to hide all controls except the chart or table
 */
var _Klass = utils.defineClass(
	function RequestPage($parent, state, prototype, article, options) {
		Base.call(this, $parent, state, _hideUnusedFields(prototype), article, options);
	}, Base, {
		/*
		 * Id to save settings if this page
		 * We override the default implementation in PageRegular which uses the sdata url as key
		 * Instead, we use the dashboard name + vignette id
		 * This is, because a chart page is likely to be shown in more than one dashboard / vignette and
		 * we want to be able to have dedicated settings for each
		 */
		getPagePrefsId: function() {
			var id = "";
			if (this.isVignette) {
				var vignette = this.getParentVignette();
				if (vignette) {
					id = id + (vignette.controller.state.dashboardName || vignette.controller.state.name);
					var vid = vignette.vignetteId;
					if (vid) {
						id = id + "#" + vid;
					}
				}
			}
			return id;
		},
		destroy: function() {
			Base.prototype.destroy.call(this);
		}
	});

exports.Page = _Klass;