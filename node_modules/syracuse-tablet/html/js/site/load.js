"use strict";

var log = require('js/helpers/logger').log;
var utils = require('js/helpers/utils');
var modals = require('js/ui/modal');

var _templates = ["modals/error", "modals/confirm"];


$(document).ready(function() {
	try {
		log && log("Load", "history.length=" + history.length);
		// Create global site
		var site = $.smobile.createSite($("#site"));
		// Remove templates on reload otherwise they not refreshed
		$.stemplates.removeTmpl();
		modals.init();
		// Goto page
		$.smobile.changePage(window.location.hash).then(function(dstPage) {
			window.history.replaceState(dstPage.state, dstPage.state.uuid, "");
			log && log("Load after change page", "history.length=" + history.length);
			site.$elmt.show();
		}, function(e) {
			alert("ERROR CHANGING PAGE");
		});
	} catch (e) {
		if (modals && modals.error) {
			modals.error("Error loading page\n", e);
		} else {
			alert("Error loading page\n" + e.stack);
		}
	}
});