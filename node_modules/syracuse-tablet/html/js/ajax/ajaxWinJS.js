"use strict";
/*
 * Ajax module for winJS
 */


var utils = require('syracuse-tablet/html/js/helpers/utils');
var winjs = require('syracuse-tablet/html/js/helpers/winjs');

var _ajax;

function _AjaxWinJSInterface() {};

var _ajaxWinJSInterfaceClass = utils.defineClass(
	_AjaxWinJSInterface,
	null, {
		ajax: function(method, url, send, headers, options) {
			var deferred = $.Deferred();
			method = method || "GET";

			var allHeaders = {
				"Accept": "application/json;vnd.sage=syracuse"
			};
			if (headers) {
				$.extend(allHeaders, headers);
			}

			var data = {
				"$method": method || "GET",
				"$url": url,
				"$send": send,
				"$headers": allHeaders,
				"$options": options
			};
			winjs.callWinJS("winjsAjax", "ajax", data).then(function(data) {
				// WinJS call succeeded, this does not mean ajax call succeeded!

				var respHeaders = {
					"status": data.$status,
					"location": (data.$headers && data.$headers["location"]) || ""
				};

				if (data.$succeeded) {
					deferred.resolve(data.$data, respHeaders);
				} else {
					deferred.reject(data.$status, respHeaders);
				}
			}, function(error) {
				// WInJS call failed!
				deferred.reject(500, {});
			});

			return deferred.promise();
		}
	}
);

exports.AjaxInterfaceClass = _ajaxWinJSInterfaceClass;