"use strict";

/*
 * Storage module (Selects implementation depending on what's available in the current browser
 */

var storageInterface = require('syracuse-tablet/html/js/storage/storageInterface');

var _impls = [
	require('syracuse-tablet/html/js/storage/storageWebSQL'),
	require('syracuse-tablet/html/js/storage/storageIndexedDB')
];

var _storageImpl;

// Choose the first supported storage engine
// #8136 noFail used in main error handler 
function _getStorageImpl(noFail) {
	if (_storageImpl) {
		return _storageImpl;
	}

	_impls.some(function(impl) {
		if (impl.isAvailable()) {
			var ctor = impl.getStorageInterface();
			_storageImpl = new ctor();
			return true;
		}
		return false;
	});

	if (_storageImpl == null && noFail !== true) {
		throw new Error("No storage interface (indexedDB or WebSQL) has been found");
	}

	return _storageImpl;
}

exports.getStorage = _getStorageImpl;
exports.StatusCodes = storageInterface.StatusCodes;