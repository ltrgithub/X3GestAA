"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("factory");
var globals = require('syracuse-tablet/html/js/helpers/globals');
var utils = require('syracuse-tablet/html/js/helpers/utils');
var Application = require('syracuse-tablet/html/js/application/application').Application;
var DashoardPage = require('syracuse-tablet/html/js/pages/pageDashboard').Page;
var RegularPage = require('syracuse-tablet/html/js/pages/pageRegular').Page;
var DefHomePage = require('syracuse-tablet/html/js/pages/html/pageDefHome').Page;
var VignetteError = require('syracuse-tablet/html/js/pages/html/pageVignetteError').Page;
var LoginPage = require('syracuse-tablet/html/js/pages/html/pageLogin').Page;
var SettingsPage = require('syracuse-tablet/html/js/pages/html/pageSettings').Page;
var AboutPage = require('syracuse-tablet/html/js/pages/html/pageAbout').Page;
var ViewCtrlr = require('syracuse-tablet/html/js/application/ctrlrView').Controller;
var DaoApp = require('syracuse-tablet/html/js/application/daoApp').Dao;
var DaoSdata = require('syracuse-tablet/html/js/application/daoSdata').Dao;

var _createApplication = function($elmt) {
	var res = new Application($elmt);
	res.init();
	log && log("Application", "Create ok");
	return res;
};

var _createPage = function($parent, state) {
	var res = null,
		type = state.type;
	if (type == "html" && state.name == "login") {
		res = new LoginPage($parent, state);
	} else if (type == "html" && state.name == "settings") {
		res = new SettingsPage($parent, state);
	} else if (type == "html" && state.name == "about") {
		res = new AboutPage($parent, state);
	} else if (type == "html" && state.name == "defhome") {
		res = new DefHomePage($parent, state);
	} else if (type == "html" && state.name == "vignetteerror") {
		res = new VignetteError($parent, state);
	} else if (type == "dashboard") {
		var info = globals.getApplication().dao.getDashboardInfo(state.dashboardUuid);
		res = new DashoardPage($parent, state, info.prototype, info.article);
	} else if (type == "regular") {
		res = new RegularPage($parent, state);
	} else {
		throw new Error("Unknown page type[" + type + "]");
	}
	log && log("New Page", "Create ok");
	return res;
};

var _createViewCtrlr = function(page, type) {
	var ctrlr;
	switch (type) {
		case "representation":
		case "process":
		case "request":
		case "statistics":
		case "dashboardpage":
		case "externallink":
			ctrlr = new ViewCtrlr(page);
			break;
		default:
			throw new Error("Unknown View type[" + type + "]");
			break;
	}
	log && log("New View controller", "Create ok");
	return ctrlr;
};

var _createDaoApp = function(appli) {
	var dao = new DaoApp(appli);
	log && log("New DAO Application", "Create ok");
	return dao;
};

var _createDaoSdata = function(type, data, prototype, parent, options) {
	var dao = new DaoApp();
	switch (type) {
		case "representation":
		case "process":
		case "request":
		case "statistics":
		case "dashboardpage":
		case "externallink":
			dao = new DaoSdata(data, prototype, parent, options);
			break;
		default:
			throw new Error("Unknown View type[" + type + "]");
			break;
	}
	log && log("New DAO View", "Create ok");
	return dao;
};

exports.createApplication = _createApplication;
exports.createPage = _createPage;
exports.createViewCtrlr = _createViewCtrlr;
exports.createDaoApp = _createDaoApp;
exports.createDaoSdata = _createDaoSdata;