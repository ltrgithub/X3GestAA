"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("vignette");
var utils = require('syracuse-tablet/html/js/helpers/utils');
var utils = require('syracuse-tablet/html/js/helpers/utils');
var factory = require('syracuse-tablet/html/js/factories/appFactory');
var reqPage = require('syracuse-tablet/html/js/pages/page');
var factory = require('syracuse-tablet/html/js/factories/appFactory');
var reqPage = require('syracuse-tablet/html/js/pages/page');

var _Controller = utils.defineClass(
	function(parentPageCtrlr, descr) {
		var self = this;
		self.parentPageCtrlr = parentPageCtrlr;
		self.descr = descr;
		self.pageContent = null;
	}, null, {

		destroy: function() {
			var self = this;
			self.pageCtrlr = null;
			self.descr = null;
		},
		load: function($elmt) {
			var self = this;
			try {
				self.$elmt = $elmt;
				var dstPage = factory.createPage(self.$elmt, self._getPageInfo());
				dstPage.load().then(function() {
					dstPage.activate(null, function() {
						// vignette displayed
					});
				}, function(e) {
					logg && log("vignette load rejected", e);
					alert("vignette load rejected");
				});
			} catch (e) {
				log && log("Vignette load error", e);
				alert("vignette load error");
			}
		},
		_getPageInfo: function() {
			var self = this;
			var gadget = self.descr.$gadget;
			if (gadget.$type === "$representation") {
				var name = gadget.representation + "." + gadget.facet;
				var page = reqPage.pageInfo(name, {
					vignette: true
				});
				if (page) return page;
			}
			return reqPage.pageInfo("vignetteerror", {
				vignette: true
			});
		}
	});

exports.Controller = _Controller;