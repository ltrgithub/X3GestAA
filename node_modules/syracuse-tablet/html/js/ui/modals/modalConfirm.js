"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var modalDialog = require('syracuse-tablet/html/js/ui/modals/modalDialog');
var locale = require('syracuse-tablet/html/js/helpers/locale');
var siteLayout = require('syracuse-tablet/html/js/ui/siteLayout');

var _templateAll = {
	header: '\
		<div class="modal-title">{{title}}</div>',
	content: '\
			<div class="s-m-modal-content">\
				{{message}}\
			</div>',
	footer: '\
		<buttons class="pull-right"> \
		<button type="button" class="btn btn-default" data-action="yes">{{yes}}</button> \
		<button type="button" class="btn btn-default" data-action="no">{{no}}</button>\
		</buttons>'
};

var _Klass = utils.defineClass(
	function ModalConfirm(message, action, isSimpleConfirm) {
		var self = this;
		modalDialog.ModalBase.call(self);
		// Init params
		self.message = message;
		self.action = action;
		self.isSimpleConfirm = isSimpleConfirm;
	}, modalDialog.ModalBase, {
		_getTemplates: function() {
			var self = this;
			return {
				std: _templateAll
			};
		},
		_onShow: function(evt) {
			var self = this;
			//modalDialog.ModalBase.prototype._onShow.call(self, evt);
			self._css(siteLayout.getPageOrientation(), siteLayout.getDeviceType())
		},
		getDisplayFlags: function() {
			var self = this;
			var displayFlags = self.displayFlags || {};
			if (self.deviceType === "tablet") {
				displayFlags.modalClass = "confirm tablet";
			} else {
				displayFlags.modalClass = "confirm mobile";
			}
			return displayFlags;
		},
		_getDataContext: function() {
			var self = this;
			var ctx = {};
			ctx.title = self.isSimpleConfirm ? null : locale.text("modal.confirm.ttl");
			// different message depending on whether the calling modal.js method is confirm() or simpleConfirm()
			ctx.message = self.action ? modalDialog.checkMsg(locale.text("modal.confirm.msg", [self.action])) : modalDialog.checkMsg(self.message);
			ctx.yes = locale.text("yes").toUpperCase();
			ctx.no = locale.text("no").toUpperCase();
			return ctx;
		},
		_onAction: function(action, param) {
			var self = this;
			self.selectedAction = action;
			// close on actions
			return true;
		},
		_getResult: function() {
			var self = this;
			return self.selectedAction;
		},
		notifMainLayoutChanged: function(info, orientation, deviceType) {
			if (info.orientationChanged) {
				this._css(orientation, deviceType)
			}
		},
		_css: function(orientation, deviceType) {
			if (deviceType !== "smartphone") return;
			var $$modalDialog = $(".modal-dialog", this.$$elmt);
			if (orientation === "portrait") {
				$$modalDialog.css("margin-top", "50%")
			} else {
				$$modalDialog.css("margin-top", "")
			}
		},
	}
);
exports.Modal = _Klass;