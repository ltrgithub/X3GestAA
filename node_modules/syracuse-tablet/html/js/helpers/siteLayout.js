"use strict";

var globals = require('syracuse-tablet/html/js/helpers/globals');
var authoring = require('syracuse-tablet/html/js/authoring/authoring');
var authLayout = require('syracuse-tablet/html/js/authoring/authoringLayout');

var _currentOrientation = null;

var first;

function _isOrientationChange() {
	var width = $(window).width();
	var height = $(window).height();

	var ratio = width / height;
	var orientation;

	if (ratio < 1) {
		orientation = "portrait";
	} else {
		orientation = "landscape";
	}
	if (orientation == _currentOrientation) {
		return false;
	}
	_currentOrientation = orientation;
	return true;
}

exports.updateLayout = function(force) {
	//	var $$focused = $(':focus'); maybe later
	var noKeyboardOpen = false;

	if (!(force || _isOrientationChange() || noKeyboardOpen)) {
		return;
	}

	// If authoring is active, let the authoring limit the space reserved for the application
	var authPanel = authoring.getPanel();
	if (authPanel) {
		authLayout.updateLayout(authPanel);
	} else {
		// Make container of application full screen
		_ensureAppFullScreen();
	}

	_updateSiteLayout();
	var app = globals.getApplication();
	if (app.currentPage) {
		app.currentPage.onResize();
	}
};

function _ensureAppFullScreen() {
	var width = $(window).width();
	var height = $(window).height();
	var $$app = $("#s-m-app-id");
	$$app.css("width", width + "px");
	$$app.css("height", height + "px");
}

/*
 *
 */
function _updateSiteLayout() {
	var $$app = $("#s-m-app-id");
	var width = $$app.width();
	var height = $$app.height();

	var $$content = $(".s-m-page.s-m-full > section.s-m-main-content");
	var $$header = $(".s-m-page.s-m-full > header");
	var $$footer = $(".s-m-page.s-m-full > footer");

	if ($$header[0]) {
		$$header[0].style.top = "0px";
		$$header[0].style.height = "50px";
		$$header[0].style.width = width + "px";
	}
	if ($$content[0]) {
		$$content[0].style.left = "0px";
		$$content[0].style.top = "50px";
		$$content[0].style.width = width + "px";
		$$content[0].style.height = (height - 100) + "px";
	}
	if ($$footer[0]) {
		$$footer[0].style.top = (height - 50) + "px";
		$$footer[0].style.height = "50px";
		$$footer[0].style.width = width + "px";
	}
}