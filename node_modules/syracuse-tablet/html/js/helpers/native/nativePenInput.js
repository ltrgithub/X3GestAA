"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("nativePenInput", true);

var _currentInputDeferred;

if (!(window.smPenInputJS)) {
	window.smPenInputJS = {
			
		// This method will be invoked from wrapper once the pen input has finished or failed
		penInputFinished: function(data) {
			if (_currentInputDeferred) {
				var def = _currentInputDeferred;
				_currentInputDeferred = null;
				log && log("Got pen input: " + JSON.stringify(data || {}));
				def.resolve(data);
			}
		}
	}
}
/**
 *
 */
exports.supportsPenInput = function() {
	return window && window.smPenInput;
};

/**
 * Trigger pen input modal in native shell
 * options:
 * {
 *      title: Title to display above input area
 * }
 */
exports.getPenInput = function(options) {
	var data = JSON.stringify(options);
	// Be carefull, JS name is lowercase (e.g. setPhraseList) while C# name must be uppercase (e.g. SetPhraseList)
	if (window && window.smPenInput && window.smPenInput.getPenInput) {
		_currentInputDeferred = $.Deferred();
		window.smPenInput.getPenInput(data);
		return _currentInputDeferred.promise();
	} 
	else
	{
		return $.smResolve(null);
	}
};