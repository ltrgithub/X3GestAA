"use strict";

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("smJSCall");

exports.init = function() {

	if (!(window.smJSCall)) {
		/*
		 * This method is the only one that will ever be invoked by wrapper code
		 * It dispatches all incomming calls to dedicated objects per domain
		 */
		window.smJSCall = function(objectName, methodName, jsonParam) {
			log("smJSCall (objectName): " + objectName);
			log("smJSCall (methodName): " + methodName);
			log("smJSCall (jsonParam): " + jsonParam);

			var obj = window[objectName];
			var method = obj && obj[methodName];
			var data = jsonParam;
			try { // try to parse json, if it fails, data is assumed to be a plain string
				data = JSON.parse(jsonParam);
			} catch (e) {}
			var ret = method && method(data);

			// Only strings supported right now!
			if (typeof ret !== "string") {
				ret = "" + ret;
			}
			log("smJSCall (return): " + ret);
			return ret;
		};
	}
};