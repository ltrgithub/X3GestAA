"use strict";

/*
 * This module is called by an external wrapper and maps the calls to javascript methods
 */

var log = require('syracuse-tablet/html/js/helpers/logger').getLogger("nativeJSCall");

exports.init = function() {

	if (!(window.smJSCall)) {
		/*
		 * This method is the only one that will ever be invoked by wrapper code
		 * It dispatches all incomming calls to dedicated objects per domain
		 */
		window.smJSCall = function(objectName, methodName, jsonParam) {
			try {
				log && log("smJSCall (objectName): " + objectName);
				log && log("smJSCall (methodName): " + methodName);
				log && log("smJSCall (jsonParam): " + jsonParam);

				var obj = window[objectName];
				var method = obj && obj[methodName];
				var data = jsonParam;
				try { // try to parse json, if it fails, data is assumed to be a plain string
					data = JSON.parse(jsonParam);
				} catch (e) {}
				var ret = method && method(data);

				// Only strings supported right now!
				if (typeof ret !== "string") {
					ret = "" + ret;
				}
				log && log("smJSCall (return): " + ret);
				return ret;
			} catch (ex) {
				log && log(JSON.stringify(ex));
				throw ex;
			}
		};
	}
};