"use strict";

var jsutils = require('syracuse-tablet/html/js/helpers/jsutils');
var serverLog = require('syracuse-tablet/html/js/helpers/serverLog');

// true to log on Syracuse server console
var _logOnServer = false;

var _log;

if (window.smNativeLogger && window.smNativeLogger.log) {
	_log = function() {
		var args = [];
		for (var i = 0; i < arguments.length; i++) {
			args.push(arguments[i]);
		}
		window.smNativeLogger.log(args.join(""));
	};
} else {
	var _console = _logOnServer === true ? serverLog : window.console;
	_log = function() {
		if (!_console) return;
		var text = [];
		for (var i = 0; i < arguments.length; i++) {
			var a = arguments[i];
			if (a != null) {
				if (jsutils.isError(a))
					_console && _console.log && _console.log(a.message, "\n", jsutils.cleanStack(a.stack));
				else
					text.push(a);
			}
		}
		_console && _console.log && _console.log(text.join(text, " "));
	};
}
if (window) {
	window.logger = _log;
}

function _getLogger(module, force) {
	// if (module && module.indexOf("native") > -1) force = true;
	if (!(force === true)) {
		return null;
	}
	var logger = function() {
		var text, errs;
		for (var i = 0; i < arguments.length; i++) {
			if (jsutils.isError(arguments[i])) {
				if (!errs) errs = [];
				errs.push(arguments[i]);
			} else {
				if (!text) text = ["[" + module + "]: "];
				text.push(arguments[i]);
			}
		}
		if (text && text.length > 1) _log(text.join(" "));
		if (errs) {
			errs.forEach(function(e) {
				_log("[" + module + "]: " + e.message);
				if (e.stack) _log(jsutils.cleanStack(e.stack));
			});
		}
	};
	return logger;
}

exports.log = _log;
exports.getLogger = _getLogger;