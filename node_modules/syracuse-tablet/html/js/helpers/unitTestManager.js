"use strict";

var globals = require('syracuse-tablet/html/js/helpers/globals');
var _application = globals.getApplication();

var _notifPageLoaded = function(step, page) {
	if (step == "before") {
		$('[data-s-ut-page-is-current]').removeAttr("data-s-ut-page-is-current");
		return;
	}
	if (step == "after") {
		if (!page) {
			return;
		}
		// Put page name on vignettes too once they are loaded so we can easily find them too
		page.$$elmt.attr("data-s-ut-page-name", page.state.name);
		if (page.isVignette) {
			return;
		}
		// Put current page flag on top level page only
		page.$$elmt.attr("data-s-ut-page-is-current", page.state.name);
		return;
	}
};
var _notifUserCtxChanged = function(ctx, endpoint) {
	globals.getApplication().$$elmt.removeAttr("data-s-ut-user-ctx");
	if (ctx && endpoint) {
		var data = [ctx.$user || "", ctx.$role || "", ctx.$lang || "", endpoint || ""];
		globals.getApplication().$$elmt.attr("data-s-ut-user-ctx", data.join(','));
	}
};
var _notifDeviceChanged = function(device, orientation) {
	globals.getApplication().$$elmt.attr("data-s-ut-device", device + "," + orientation);
};

var _addFieldAttributes = function(field) {
	field.$$elmt.attr("data-s-ut-field-x3name", field.$bind);
};

var _init = function() {
	globals.setUnitTestMgr(exports);
};
exports.notifPageLoaded = _notifPageLoaded;
exports.addFieldAttributes = _addFieldAttributes;
exports.notifUserCtxChanged = _notifUserCtxChanged;
exports.notifDeviceChanged = _notifDeviceChanged;
exports.init = _init;