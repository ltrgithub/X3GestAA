"use strict";

var utils = require('syracuse-tablet/html/js/helpers/utils');
var authoringPropertiesGeneral = require('syracuse-tablet/html/js/authoring/authoringPropertiesGeneral');
var authoringPropertiesCtrls = require('syracuse-tablet/html/js/authoring/authoringPropertiesCtrls');
var authoringPropertiesLayouts = require('syracuse-tablet/html/js/authoring/authoringPropertiesLayouts');
var authoringPropertiesPages = require('syracuse-tablet/html/js/authoring/authoringPropertiesPages');

var _propsModules = [authoringPropertiesPages, authoringPropertiesLayouts, authoringPropertiesCtrls, authoringPropertiesGeneral];

var _properties;

exports.initProperties = function(force) {
	if (_properties != null && force != true) {
		return;
	}
	_properties = {};
	_propsModules.forEach(function(module) {
		module.initModuleProperties(_properties);
	});
};

exports.getAllProperties = function() {
	return _properties;
};

exports.getProperties = function(sel, data) {

	var $$elmt = sel.$$elmt;
	var props = [];

	var controller = $$elmt.is(".s-m-page") ? $$elmt.smPageController() : utils.findController($$elmt);

	_propsModules.forEach(function(module) {
		module.getModuleProperties($$elmt, controller, props, sel, data);
	});
	props.forEach(function(p, idx) {
		if (typeof p === "function") {
			var prop = props[idx] = new p(controller, sel, data);
			// to simplify the code writing in function object
			if (prop.initMarkup) {
				prop.initMarkup(controller, sel, data);
			}
			authoringPropertiesGeneral.initProperty(prop);
		}
	});
	return props;
};

/* The following getters are used to avoid some cyclic deps in authoring modules
 */
exports.getPropertiesLayouts = function() {
	return authoringPropertiesLayouts;
};