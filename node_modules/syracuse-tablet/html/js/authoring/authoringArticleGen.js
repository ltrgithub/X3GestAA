"use strict";

var jsutils = require('syracuse-tablet/html/js/helpers/jsutils');

/*
 * Generator for articles of different page types and scrolling models
 *
 */

exports.genNewArticle = function(opts) {
	var proto;
	proto = opts.page.prototype;

	if (jsutils.isInstanceOf(opts.page, "DashboardPage")) {
		return exports.generateDashboardArticle(proto, opts.orientation);
	} else {
		return _generateRegularArticle(proto, opts.orientation);
	}
};

exports.generateDashboardArticle = function(proto, orientation) {

	var article;
	proto = $.isPlainObject(proto) ? proto : proto.json;
	var props = proto.$properties;

	if (orientation === "horizontal") {
		article = {
			"$layoutType": "hub",
			"$items": [{
				"$layoutType": "hubGroup",
				"$title": "",
				"$items": []
			}]
		};

		Object.keys(props).forEach(function(key) {
			var prop = props[key];
			article.$items[0].$items.push({
				"$layoutType": "tile",
				"$size": "medium",
				"$items": [{
					"$bind": key,
				}]
			});

		});
	} else {
		article = {
			"$layoutType": "stack",
			"$items": []
		};

		var cellCount = 4;
		var row;
		Object.keys(props).forEach(function(key) {
			if (cellCount === 4) {
				cellCount = 0;
				row = {
					"$layoutType": "row",
					"$rowHeight": "200px",
					"$items": []
				};
				article.$items.push(row);
			}
			var prop = props[key];
			row.$items.push({
				"$layoutType": "cell",
				"$widthXs": 12,
				"$widthSm": 6,
				"$widthMd": 4,
				"$widthLg": 3,
				"$items": [{
					"$bind": key,
				}]
			});
		});
	}
	return $.smResolve(article);
};

function _generateRegularArticle(proto, orientation) {
	var self = this;
	proto = $.isPlainObject(proto) ? proto : proto.json;
	var props = proto.$properties;
	var $items;

	if (orientation === "horizontal") {
		article = {
			"$layoutType": "hub",
			"$items": [{
				"$layoutType": "hubGroup",
				"$title": "",
				"$items": [{
					"$layoutType": "tile",
					"$size": "all",
					"$items": []
				}]
			}]
		};
		$items = article.$items[0].$items[0].$items;
	} else {
		var article = {
			$layoutType: "stack",
			$items: []
		};
		$items = article.$items;
	}


	var forceNoTitle = proto.$url && proto.$url.indexOf(".$query") > 0,
		prop;
	for (var p in props) {
		prop = props[p];
		if (prop.$isExcluded !== true) {
			var a = {
				$bind: p
			};
			if (forceNoTitle) {
				a.$isTitleHidden = forceNoTitle;
			}
			$items.push(a);
		}
	}

	return $.smResolve(article);
}