"use strict";

var helpers = require('@sage/syracuse-core').helpers;

// Testcase: /syracuse-collaboration/test/server/mobileApplicationTest._js

exports.entity = {
	$titleTemplate: "Mobile dashboard vignette",
	$descriptionTemplate: "Mobile dashboard vignette",
	$valueTemplate: "{gadget.code}",
	$properties: {
		displayStyle: {
			$title: "Display style",
			$enum: [{
				$value: "$link",
				$title: "Always display as link"
			}, {
				$value: "$full",
				$title: "Always display as vignette"
			}],
			$default: "$link",
			$isNullable: false
		},
		persistentId: {
			$isExcluded: true,
		}
	},
	$relations: {
		gadget: {
			$title: "Gadget",
			$type: "mobileGadget",
			$isMandatory: true,
		}
	},
	$events: {
		$beforeSave: [

			function(_, instance) {

				/*
				 * vignettes are referenced by page definitions this is why we need a persistent
				 * id to know which vignette goes where in the layout
				 * Note the id has just to be unique for this instance and it's siblings in the same dashboard
				 */
				if (!instance.persistentId(_)) {
					// Once a vignette is created, we store it's initial uuid in a string property to ensure
					// it will be still there after an export/import cycle
					instance.persistentId(_, instance.$uuid);
				}
			}
		]
	}
};