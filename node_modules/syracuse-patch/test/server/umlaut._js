var module = QUnit.module;
var patch = require("syracuse-patch/lib/integrate");
var unit = require("syracuse-patch/test/fixtures/unit");
var fs = require("fs");
module("patch");

asyncTest("start", 0, function(_) { fs.mkdir("patchunittest", _); start(); })

asyncTest("create", 1, function(_) {
	patch.patch("patchunittest", __dirname+"/../fixtures/umlaut_create.patch", {}, _);
	var errors = unit.testhash("patchunittest", { '/umlaut.txt': 'b512cd7434daac9a864cb7a60a9be4c1fb82e39c' }, _);
	strictEqual(errors, "");
	start(); });

asyncTest("change", 1, function(_) {
	patch.patch("patchunittest", __dirname+"/../fixtures/umlaut_change.patch", {}, _);
	var errors = unit.testhash("patchunittest", { '/umlaut.txt': '2d408a57a209de051b7de50975ae1a9d9ff6654b' }, _);
	strictEqual(errors, "");
	start(); });

asyncTest("delete", 1, function(_) {
	patch.patch("patchunittest", __dirname+"/../fixtures/umlaut_delete.patch", {}, _);
	var errors = unit.testhash("patchunittest", {}, _);
	strictEqual(errors, "");
	start(); });

asyncTest("end", 0, function(_) { unit.rmdirRec("patchunittest", _); start(); })
