"use strict";
var patch = require("syracuse-patch/lib/integrate");
var unit = require("syracuse-patch/test/fixtures/unit");
var fs = require('streamline-fs');
QUnit.module(module.id);

it('start', function(_) {
	fs.mkdir("patchunittest", _);
});

it('create_empty', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_create_empty.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': 'da39a3ee5e6b4b0d3255bfef95601890afd80709'
	}, _);
	strictEqual(errors, "");
});

it('one_line', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_one_line.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': 'a9993e364706816aba3e25717850c26c9cd0d89d'
	}, _);
	strictEqual(errors, "");
});

it('changed_line_br', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_changed_line_br.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': 'bc026f8f251f95b68a14e47f4c79b3e22be0de69'
	}, _);
	strictEqual(errors, "");
});

it('empty_line', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_empty_line.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': 'adc83b19e793491b1c6ea0fd8b46cd9f32e592fc'
	}, _);
	strictEqual(errors, "");
});

it('four_lines', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_four_lines.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': '8b1c3f606c4849b61aa120f9743a49e7ea01e9e9'
	}, _);
	strictEqual(errors, "");
});

it('some_changes', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_some_changes.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/text.txt': '21fe573ba31dd788e52b8f753626329101ab8d54'
	}, _);
	strictEqual(errors, "");
});

it('deleted', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_deleted.patch", {}, _);
	var errors = unit.testhash("patchunittest", {}, _);
	strictEqual(errors, "");
});

it('subdir', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_subdir.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/dir/test.txt': '430f6538da9c59312df634c6a9c3730b0784d047',
		'/dir2/dir3/test.txt': 'a02bab66aa019e81b600c5f3298dfba081c3c203'
	}, _);
	strictEqual(errors, "");
});

it('spaces', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_spaces.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/a b.txt': '5277cbb45a15902137d332d97e89cf8136545485',
		'/c b/d a.txt': '9c6465b4471e43aea3500843516a5d825d590080',
		'/dir/test.txt': '430f6538da9c59312df634c6a9c3730b0784d047',
		'/dir2/dir3/test.txt': 'a02bab66aa019e81b600c5f3298dfba081c3c203'
	}, _);
	strictEqual(errors, "");
});

it('space_edits', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_space_edits.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/a b.txt': 'da39a3ee5e6b4b0d3255bfef95601890afd80709',
		'/c b/d a.txt': 'f078fafb604ef5b91705dddbf2ce86d0bbcd86bf',
		'/dir/test.txt': '430f6538da9c59312df634c6a9c3730b0784d047',
		'/dir2/dir3/test.txt': 'a02bab66aa019e81b600c5f3298dfba081c3c203'
	}, _);
	strictEqual(errors, "");
});

it('add_del1_rename', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_add_del1_rename.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/c b/d a.txt': 'f078fafb604ef5b91705dddbf2ce86d0bbcd86bf',
		'/dir/f a .txt': 'da39a3ee5e6b4b0d3255bfef95601890afd80709',
		'/dir2/add_del.txt': 'e93c8d1836fff1917f4f767ad5d92058bf3c7d5a',
		'/dir2/del_add.txt': 'ab5bbf9c6adefac20615c78c892d4750d07e4bc8',
		'/dir2/test1.txt': 'a02bab66aa019e81b600c5f3298dfba081c3c203'
	}, _);
	strictEqual(errors, "");
});

it('add_del2', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_add_del2.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/c b/d a.txt': 'f078fafb604ef5b91705dddbf2ce86d0bbcd86bf',
		'/dir/f a .txt': 'da39a3ee5e6b4b0d3255bfef95601890afd80709',
		'/dir2/add_del.txt': '6b4a3890a15731d6a8f8181cace78663f0182d2c',
		'/dir2/del_add.txt': 'e93c8d1836fff1917f4f767ad5d92058bf3c7d5a',
		'/dir2/test1.txt': 'a02bab66aa019e81b600c5f3298dfba081c3c203'
	}, _);
	strictEqual(errors, "");
});

it('rm_all', function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/text_rm_all.patch", {}, _);
	var errors = unit.testhash("patchunittest", {}, _);
	strictEqual(errors, "");
});

it('end', function(_) {
	unit.rmdirRec("patchunittest", _);
});