"use strict";
var patch = require('../../lib/integrate');
var unit = require('../fixtures/unit');
var fs = require('streamline-fs');
import { assert } from 'chai';
Object.keys(assert).forEach(key => {
	if (key !== 'isNaN') global[key] = assert[key];
});

describe(module.id, () => {
	var tracer; // = console.log;

	it('start', function(_) {
		unit.rmdirRec("patchunittest", _);
		fs.mkdir("patchunittest", _);
	});
	it('Z', function(_) {
		strictEqual(true, true);
	});

	it('create', function(_) {
		try {
			patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_create.patch", {}, _);

		} catch (e) {
			tracer && tracer(e.stack);
		}
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '3d727f4695d5a6a647b418ecd232ba9a75e768ab'
		}, _);
		strictEqual(errors, "");
	});

	it('bytechanges', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_bytechanges.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '3622f30d2a3579c0006dc1be0c6b765cd4c2eabd'
		}, _);
		strictEqual(errors, "");
	});

	it('byteremove', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_byteremove.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '8f1f147ffe8a59dc019f4ef5a4554ae035cb0f60'
		}, _);
		strictEqual(errors, "");
	});

	it('byteadd', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_byteadd.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '7b582eced238f722405a13210394f7b149234367'
		}, _);
		strictEqual(errors, "");
	});

	it('removemuch', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_removemuch.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '180257efdddd452e3fba7f12718da6bc4d2a7688'
		}, _);
		strictEqual(errors, "");
	});

	it('addmuch', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_addmuch.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': '7b582eced238f722405a13210394f7b149234367'
		}, _);
		strictEqual(errors, "");
	});

	it('empty', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_empty.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': 'da39a3ee5e6b4b0d3255bfef95601890afd80709'
		}, _);
		strictEqual(errors, "");
	});

	it('nonempty', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_nonempty.patch", {}, _);
		var errors = unit.testhash("patchunittest", {
			'/test.bin': 'e380711b3ad6de4fed8afe67dcb59745d973ec1d'
		}, _);
		strictEqual(errors, "");
	});

	it('remove', function(_) {
		patch.normalPatch("patchunittest", __dirname + "/../fixtures/binary_remove.patch", {}, _);
		var errors = unit.testhash("patchunittest", {}, _);
		strictEqual(errors, "");
	});

	it('end', function(_) {
		unit.rmdirRec("patchunittest", _);
		ok(true, "ended ok");
	});
});