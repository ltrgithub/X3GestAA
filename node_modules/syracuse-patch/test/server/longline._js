"use strict";
var patch = require("syracuse-patch/lib/integrate");
var unit = require("syracuse-patch/test/fixtures/unit");
var fs = require('streamline-fs');
QUnit.module(module.id);

asyncTest("start", 0, function(_) {
	unit.rmdirRec("patchunittest", _);
	fs.mkdir("patchunittest", _);
	start();
});

asyncTest("create", 1, function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/longline_create.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/test.txt': '6888cbd99c5c17430aee1f80d26c4ea15f048b5a'
	}, _);
	strictEqual(errors, "");
	start();
});

asyncTest("change", 1, function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/longline_change.patch", {}, _);
	var errors = unit.testhash("patchunittest", {
		'/test.txt': 'd5717ebcd6aad1e5908cfe7aa4ccac0e75020568'
	}, _);
	strictEqual(errors, "");
	start();
});

asyncTest("delete", 1, function(_) {
	patch.normalPatch("patchunittest", __dirname + "/../fixtures/longline_delete.patch", {}, _);
	var errors = unit.testhash("patchunittest", {}, _);
	strictEqual(errors, "");
	start();
});

asyncTest("end", 0, function(_) {
	unit.rmdirRec("patchunittest", _);
	start();
});