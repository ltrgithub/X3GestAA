"use strict";

var helpers = require('syracuse-core/lib/helpers');
var os = require("os");

exports.NtlmSession = helpers.defineClass(function(options) {
	options = options || {};
	this.host = options.host || os.hostname();
	this.connectionType = options.connectionType || "connectionOriented";
	this.clientChallenge = options.clientChallenge;
	this.clientChallenge2 = options.clientChallenge2;
	this.randomSessionKey = options.randomSessionKey;
	this.timestamp = options.timestamp;
}, null, {
    computeSignature: function(message) {
		if (!this.seqNum) this.seqNum = 0;
		var mac = this.authenticateMessage.gen.mac(this.authenticateMessage.negotiateFlags, this.seqNum, this.clientSigningKey, this.clientSealingKey, new Buffer(4), message);
		if (this.connectionType === "connectionOriented") {
		    this.seqNum++;
		}
		return mac;
    },
});
