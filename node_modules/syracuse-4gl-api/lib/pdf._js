"use strict";

/// !doc
/// 
/// # Syracuse PDF  
/// This API module allows to sign a PDF file.  
/// To use this module do `var pdf = require('syracuse-4gl-api/lib/pdf')`.  
/// All the methods are asynchronous.  
/// 

var pdfReader = require('@sage/syracuse-lib/src/pdf/reader');
var pdfWriter = require('@sage/syracuse-lib/src/pdf/writer');

exports.$exported = true;


/// 
/// -------------
/// ## send :
/// ``` javascript
/// pdf.sign(_, pdfName, buffer, certName, options);  
/// ```
/// It allows to send email using (or not) notification themes defined into Syracuse.  
/// 
/// * **pdfName** The file's name.  
/// * **buffer** The PDF data.  
/// * **certName** The certificate name that is inserted in Syracuse collaboration database.  
/// * **options** allows to decide if data needs to be returned and in what encoding.  
/// `options` can contain the following properties :  
///     * returnData : `Boolean`. Must be set to true if data has to be returned in payload.  
///     * encoding : `String`. Must be set to `base64` if called from 4GL code.  
/// 
exports.sign = function(_, pdfName, buffer, certName, options) {
	options = options || {};
	var reader = pdfReader.createFromBuffer(_, pdfName, buffer);
	var writer = pdfWriter.create(_, reader);
	var res = writer.sign(_, certName);
	writer.close(_);
	res.data = reader.close(_, options.returnData, options.encoding);
	return res;
};