"use strict";

exports.entity = {
	$titleTemplate: "Pipe",
	$descriptionTemplate: "ETL pipe",
	$valueTemplate: "{name}",
	$properties: {
		name: {
			$title: "Name",
			$isMandatory: true,
			$isUnique: true,
			$linksToDetails: true
		},
		description: {
			$title: "Description",
			$isLocalized: true
		},
	},
	$relations: {
		source: {
			$title: "Source device",
			$type: "device",
			$isMandatory: true,
		},
		destination: {
			$title: "Destination device",
			$type: "device",
			$isMandatory: true,
		},
		error: {
			$title: "Error device",
			$type: "device",
		},
	},
	$searchIndex: {
		$fields: ["name"]
	},
	$services: {
		run: {
			$title: "Run",
			$description: "Pipes the source into the destination",
			$isMethod: false,
			$method: "POST",
			$execute: function(_, context, instance, parameters) {
				try {
					this.source(_).reader(_).pipe(_, this.destination(_).writer(_));
				} catch (ex) {
					var errdev = this.error(_);
					if (errdev) errdev.writer(_).write(_, {

					});
				}
			},
		},
	},
	$events: {},
};