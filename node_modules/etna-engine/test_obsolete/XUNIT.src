Funprog INITALL()
	Global Integer SILENT
	SILENT = 1
End
Funprog INIT(TRT, COUNT)
	If dim(SILENT) < 0 : Global Integer SILENT : Endif
	Global Integer SUCCESS, FAILURE, TESTCOUNT
	TESTCOUNT = COUNT
	Errbox "RUNNING"-TRT
End
Funprog CHECK_EQUAL(NAME, GOT, EXPECT)
	Value Char NAME, GOT, EXPECT
	Local Char TEXT
	If GOT = EXPECT Then TEXT = "OK: " + NAME + ": " + num$(GOT) : SUCCESS += 1
	Else TEXT = "FAILED:" + NAME + ": expected " + num$(EXPECT) + ", got " + num$(GOT) : FAILURE += 1 
	Endif
	If GOT <> EXPECT Or Not SILENT  : Errbox TEXT : Endif
End
Funprog CHECK2(EXPR, EXPECT)
	#Value Char EXPR, EXPECT
	Local Char TEXT
	GOT = evalue(EXPR)
	Local Char TEXT
	If GOT = EXPECT Then TEXT = "OK: " + EXPR + ": " + num$(GOT) : SUCCESS += 1
	Else TEXT = "FAILED:" + EXPR + ": expected " + num$(EXPECT) + ", got " + num$(GOT) : FAILURE += 1 
	Endif
	If GOT <> EXPECT Or Not SILENT  : Errbox TEXT : Endif
End

Funprog CHECKERR(GOT, EXPECT, MSG)
	Value Integer GOT, EXPECT
	Value Char MSG
	Local Char TEXT
	If EXPECT <> 0 and GOT = EXPECT Then TEXT = "OK: error test returned: " + num$(GOT) : SUCCESS += 1
	Else TEXT = "ERROR TEST FAILED: expected " + num$(EXPECT) + ", got " + num$(GOT) : FAILURE += 1 
	Endif
	If GOT <> EXPECT Or Not SILENT  : Errbox TEXT : Endif
End
Funprog FINISH()
	Local Char TEST
	If SUCCESS = TESTCOUNT And FAILURE = 0 : TEXT = "ALL TESTS PASSED:"-num$(SUCCESS)
	Else
	 TEXT = "ERROR:"
	 If SUCCESS + FAILURE  <> TESTCOUNT : TEXT -= num$(TESTCOUNT - SUCCESS - FAILURE)-"tests DID NOT RUN!" : Endif
	 If FAILURE <> 0 : TEXT -= num$(FAILURE)-"tests FAILED!" : Endif
	 TEXT -= "("+num$(SUCCESS)-"tests passed)"
	Endif
	Errbox TEXT
End
