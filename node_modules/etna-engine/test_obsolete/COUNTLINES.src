Local Char CHAINE(250)
Local Integer NB_INST,MINCH
Local Integer I,J,K,L,M,MINCH
SAVIFS = adxifs
SAVIRS = adxirs
SAVIUM = adxium
 
adxifs = ""
adxirs = chr$(10)
adxium = CST_UTF8
 
File (PROGRAMS) From System "lsadx -a GX3APP TRT src" As [PRG]
 
Local Integer NB_PROG,NB_INST
For [PRG] Where PROGRAMS>="X" and PROGRAMS<="ZZZZ"
    Gosub ANALYZE_PROG
    NB_PROG+=1
Next
Errbox num$(NB_PROG)-num$(NB_INST)
 
adxifs = SAVIFS
adxirs = SAVIRS
adxium = SAVIUM
 
End
 
$ANALYZE_PROG
Openi filpath('TRT',[PRG]PROGRAMS,'src') Using [RRR]
CHAINE=""
Rdseq CHAINE Using [RRR]
While fstat=0
    If ascii(CHAINE)<>38 and vireblc(CHAINE,2)<>"" : # ligne suite ou ligne vide
        M=0
        NB_INST+=find(ascii(vireblc(right$(CHAINE,M),0)),35,0)=0
        Repeat
            I=instr(M,CHAINE+"'","'"): J=instr(M,CHAINE+'"','"') : K=instr(M,CHAINE+':',':') : L=instr(M,CHAINE+"#",'#')
            MINCH=min(I,J,K,L)
            If MINCH<len(CHAINE)
                Case MINCH
                    When L : M=0
                    When I : M=instr(I+1,CHAINE,"'") : M+=(M<>0)
                    When J : M=instr(J+1,CHAINE,'"') : M+=(M<>0)
                    When K : M=K+1 : NB_INST+=find(ascii(vireblc(right$(CHAINE,M),0)),35,0)=0
                    When Default : M=0
                Endcase
            Else
                M=0
            Endif
        Until M=0
    Endif
    CHAINE=""
    Rdseq CHAINE Using [RRR]
Wend
Openi Using [RRR]
Return
 
 
 

 