"use strict";
// / = 47
// : = 58
// . = 46
// 

function _patabs(pat) {
	return (
		(pat.charCodeAt(0) === 47) ||
		(pat.charCodeAt(1) === 58) ||
		(
			(pat.charCodeAt(0) === 46) &&
			(
				(pat.charCodeAt(1) === 47) ||
				(!(pat.charCodeAt(1))) ||
				((pat.charCodeAt(1) === 46) && ((pat.charCodeAt(2) === 47) || (!(pat.charCodeAt(2)))))
			)
		)
	);
}

function fromString(canstr) {

	var can = {};

	//replace \\	
	var str = canstr.replace(/\\/g, "/");

	// host
	var p = str.lastIndexOf("@");
	if (p >= 0) {
		if (p > 0) can.host = str.slice(0, p);
		str = str.substr(p + 1);
	}

	// volume
	p = str.lastIndexOf("%");
	if ((p >= 0) && (!(_patabs(str)))) {
		if (p > 0) can.volume = str.slice(0, p);
		str = str.substr(p + 1);
	}

	// app
	p = str.lastIndexOf(".");
	if ((p >= 0) && (!(_patabs(str)))) {
		if (p > 0) can.application = str.slice(0, p);
		str = str.substr(p + 1);
	}

	for (var i = str.length; i > 0; i--) {
		if ((str.charCodeAt(i - 1) === 47) ||
			(i === 2) && (str.charCodeAt(1) === 58))
			break;
	}

	if (i > 0) {
		var si = i;
		if (!(str.charCodeAt(i))) {
			// root case			
			if (i === 1) {
				//case '/'
				i++;
			} else if (str.charCodeAt(1) === 58) {
				if (i === 3) {
					//case 'c:/'
					i++;
				} else if (i === 2) {
					//case 'c:'
					var dd = str.slice(0, 1) + ":/";
					i = 4;
				}
			}
		}
		can.directory = dd || str.slice(0, i - 1);
		str = str.substr(si);
	}

	p = str.lastIndexOf("$");
	if (p >= 0) {
		can.extention = str.substr(p + 1);
		can.name = str.slice(0, p);
	} else
		can.name = str;

	return (can);
}

function filpath(dir, nam, ext, app, vol, hst) {
	var p;

	can = fromString(nam);

	if ((can.directory === undefined) && (dir !== ""))
		can.directory = dir;

	var fca = ((can.directory) && (_patabs(can.directory)));

	// host
	if (can.host === undefined) {
		p = app.charCodeAt("@");
		if (p >= 0) {
			can.host = app.slice(0, p);
			app = app.substr(p + 1);
		} else if (hst !== "")
			can.host = hst;
	}

	// application
	if ((can.application === undefined) && (!(fca)))
		can.application = apl;

	// extention
	if ((can.extention === undefined) && (ext != ""))
		can.extention = ext;
}

var res = fromString("machine@SUPERV.TRT/filname$adx");
var res = fromString("machine@SUPERV.TRT/SUB/filname$adx");
var res = fromString("machine@SUPERV.TRT/SUB/filname");
var res = fromString("machine@SUPERV.filname");
var res = fromString("machine@SUPERV.filname$adx");
var res = fromString("machine@/home/adonix/toto$adx");
var res = fromString("machine@/adonix/toto$adx");
var res = fromString("machine@toto$adx");
var res = fromString("@SUPERV.TRT/adonix$adx");
var res = fromString("SUPERV.TRT/adonix$adx");
var res = fromString("c:/");
var res = fromString("/");
var res = fromString("@/");
var res = fromString("@c:");
var res = fromString("@c:/");
var res = fromString("SUPERV.TRT/TRALALA/adonix$");
var res = fromString("/machin/chose/adonix$adx");
var res = fromString("C:\\taratata\\adonix$adx");
console.log(res);