"use strict";
var sys = require("util");
var ez = require('ez-streams');
var helpers = require('syracuse-core/lib/helpers');
var uuid = require('syracuse-core/lib/uuid');
var jsxml = require("jsxml/lib/jsxml");
var config = require('config');
var DebugContext = require('./context').DebugContext;

var server;
var pendingClients;

exports.start = function(_) {
	if (!server || server.closed) {
		console.error("Starting debugger service");
		server = ez.devices.net.server(function(c, _) {
			console.error("New debugger connection: " + c.remoteAddress + ":" + +c.remotePort);
			try {
				new DebugContext(c).listen(!_);
			} catch (ex) {
				console.error(ex.stack);
				throw ex;
			}
		}).listen(_, 9124);
	}
};