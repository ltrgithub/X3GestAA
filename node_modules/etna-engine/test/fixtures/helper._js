"use strict";
var mongodb = require("streamline-mongodb");

exports.getEtnaConfigForUnitTest = function(_, endpointName) {
	var config = require("etna-util/lib/nodeconfig").config;
	var collaboration = config.collaboration || {};
	var server = new mongodb.Server(collaboration.hostname || "localhost", collaboration.port || 27017, {});

	var db = new mongodb.Db("syracuse", server, {
		w: 1 //"majority"
	});
	db.open(_);
	try {
		var endPoint = db.collection('EndPoint', _).find({
			application: 'x3',
			contract: 'erp',
			dataset: endpointName

		}).toArray(_)[0];

		return {
			endpointName: config.unit_test.etnaEndPoint,
			solutionName: endPoint.x3SolutionName,
			folderName: endPoint.x3ServerFolder,
			solutionPath: endPoint.etnaSolutionPath,
			mongo: {
				host: endPoint.etnaMongoHost,
				port: endPoint.etnaMongoPort,
				database: endPoint.x3SolutionName + '-' + endPoint.x3ServerFolder
			},
			sql: {
				driver: endPoint.etnaDriver,
				user: endPoint.etnaDatabaseUser,
				password: endPoint.etnaDatabasePassword,
				database: endPoint.etnaOracleSID,
				port: endPoint.etnaDatabasePort,
				hostname: endPoint.etnaDatabaseHost
			}
		};
	} finally {
		db.close();
	}
};