#<AdxTL>@(#)8.0.0.0 $Revision$
TOTO = func TESTSUITE()
Infbox TOTO

End

# ---------- TEST_SUITE uni function       -------------------------
# ------------------------------------------------------------------

Funprog TESTSUITE()

    Call ADD_TESTCASE("TEST_ERROR0", "Test instance/Collection", 67) From AXUNIT


End func AXUNIT.RUN_TESTSUITE("Types", "Common")

# -----------------------TEST_WR_READ -------------------------------------
# #########################################################################

Subprog TEST_ERROR0( )

Local Integer I
Local Char TC(255),EVENT(50)
Local Integer MY_STATUS,ASTATUS,LINE_NUM,SUBLINE_NUM

Local Char RPROP(255)
Local Integer RSTATUS
Local Char RPROP_LAB(255)
Local Char RERR_MESS(255)
Local Integer RCATEGORY
Local Char RENVIRONMENT(255)
Local Integer ST
Local Integer MAXSEVERITYALL


Local Instance INSTANCE1 Using C_AQCCOL01
Local Instance INSTANCE3 Using C_AQCCOL01

Local Instance INSTANCE2_1 Using C_AQCCOL02
Local Instance INSTANCE2_2 Using C_AQCCOL02

INSTANCE1 = NewInstance C_AQCCOL01 AllocGroup Null


TC="Initialize Instance"
Call CHECK_EQUAL(TC,TC) From AXUNIT
[L]MY_STATUS = fmet INSTANCE1.AINIT()
Call CHECK_EQUAL([L]MY_STATUS,[V]CST_AOK) From AXUNIT

TC="Assign properties"
Call CHECK_EQUAL(TC,TC) From AXUNIT
INSTANCE1.KEY1="TEST1"
INSTANCE1.FIELD1="Header"

TC="Add First line to instance"
Call CHECK_EQUAL(TC,TC) From AXUNIT
[L]LINE_NUM = fmet INSTANCE1.ADDLINE("LINCOL",[V]CST_ALASTPOS)

TC="Assign properties in line colletion"
Call CHECK_EQUAL(TC,TC) From AXUNIT
INSTANCE2_1 = INSTANCE1.LINCOL(LINE_NUM)
INSTANCE2_1.KEY1 = "TEST1"
INSTANCE2_1.LINNO = 1
INSTANCE2_1.LINFLD = "Line1"

TC="Add First line to instance"
Call CHECK_EQUAL(TC,TC) From AXUNIT
[L]LINE_NUM = fmet INSTANCE1.ADDLINE("LINCOL",[V]CST_ALASTPOS)

TC="Assign properties in line colletion"
Call CHECK_EQUAL(TC,TC) From AXUNIT
INSTANCE2_2 = INSTANCE1.LINCOL(LINE_NUM)
INSTANCE2_2.KEY1 = "TEST2"
INSTANCE2_2.LINNO = 2
INSTANCE2_2.LINFLD = "Line2"

Callmet INSTANCE1.ASETERRORCAT("FIELD1", "Celine DION sings AC/DC", [V]CST_AERROR,5)
Callmet INSTANCE1.ASETERRORCAT("", "Elvis Alive", [V]CST_AFATAL, 6)
Callmet INSTANCE2_1.ASETERRORCAT("KEY1", "The Cure remix", [V]CST_AERROR, 7)
Callmet INSTANCE2_2.ASETERROR("LINNO", "Neil Young new EP", [V]CST_AOK)
Callmet INSTANCE2_1.ASETERROR("", "Liam Gallagher drunk", [V]CST_AINFO)
Callmet INSTANCE2_1.ASETERROR("KEY1", "BB King dead", [V]CST_AFATAL)
Callmet INSTANCE2_2.ASETERROR("LINNO", "Pixies new bass player", [V]CST_AINFO)

Call CHECK_EQUAL(INSTANCE1.AERROR(1).MES, "Celine DION sings AC/DC") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(2).MES, "Elvis Alive") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(3).MES, "The Cure remix")  From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(4).MES, "Neil Young new EP")  From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(5).MES, "Liam Gallagher drunk")  From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(6).MES, "BB King dead")  From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(7).MES, "Pixies new bass player")  From AXUNIT

Call CHECK_EQUAL(INSTANCE1.AERROR(1).PRO, "FIELD1") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(2).PRO, "") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(3).PRO, "LINCOL(1).KEY1") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(4).PRO, "LINCOL(2).LINNO") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(5).PRO, "LINCOL(1)") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(6).PRO, "LINCOL(1).KEY1") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(7).PRO, "LINCOL(2).LINNO") From AXUNIT

Call CHECK_EQUAL(INSTANCE1.AERROR(1).LAB, "Zone") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(2).LAB, "") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(3).LAB, "Clé") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(4).LAB, "Ligne") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(5).LAB, "") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(6).LAB, "Clé") From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(7).LAB, "Ligne") From AXUNIT

Call CHECK_EQUAL(INSTANCE1.AERROR(1).CAT, 5) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(2).CAT, 6) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(3).CAT, 7) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(4).CAT, 0) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(5).CAT, 0) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(6).CAT, 0) From AXUNIT
Call CHECK_EQUAL(INSTANCE1.AERROR(7).CAT, 0) From AXUNIT

MAXSEVERITYALL = fmet INSTANCE1.AGETMAXERRORALL( )
Call CHECK_EQUAL(MAXSEVERITYALL, [V]CST_AFATAL) From AXUNIT

MAXSEVERITY = fmet INSTANCE1.AGETMAXERROR( )
Call CHECK_EQUAL(MAXSEVERITY, [V]CST_AFATAL) From AXUNIT

ST = fmet INSTANCE1.AGETMAXERRORTXT( [V]CST_ACURRENT, RPROP, RSTATUS, RPROP_LAB, RERR_MESS, RCATEGORY, RENVIRONMENT)
if (ST = [V]CST_AOK)
	Call CHECK_EQUAL(RPROP,"") From AXUNIT
	Call CHECK_EQUAL(RSTATUS, [V]CST_AFATAL) From AXUNIT

	Call CHECK_EQUAL(RPROP_LAB,"") From AXUNIT
	Call CHECK_EQUAL(RERR_MESS,"Elvis Alive") From AXUNIT
	Call CHECK_EQUAL(RCATEGORY,6) From AXUNIT
	Call CHECK_EQUAL(RENVIRONMENT,"") From AXUNIT
Endif

TC="Initialize Instance3"
INSTANCE3 = NewInstance C_AQCCOL01 AllocGroup INSTANCE1
Call CHECK_EQUAL(TC,TC) From AXUNIT
[L]MY_STATUS = fmet INSTANCE3.AINIT()
Call CHECK_EQUAL([L]MY_STATUS,[V]CST_AOK) From AXUNIT

TC="Assign properties"
Call CHECK_EQUAL(TC,TC) From AXUNIT
INSTANCE3.KEY1="TEST3"
INSTANCE3.FIELD1="Header3"

Callmet INSTANCE3.ASETERRORCAT("FIELD1", "Message Instance3 property FIELD1", [V]CST_AERROR, 5)
Callmet INSTANCE3.ASETERRORCAT("", "Message Instance3", [V]CST_AFATAL, 6)

ST = fmet INSTANCE3.AGETERRORSFROM( INSTANCE1, "Instance1 Env" )

Call CHECK_EQUAL(INSTANCE3.AERROR(1).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(2).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(3).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(4).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(5).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(6).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(7).CPY, 1) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(8).CPY, 0) From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(9).CPY, 0) From AXUNIT

Call CHECK_EQUAL(INSTANCE3.AERROR(1).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(2).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(3).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(4).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(5).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(6).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(7).ENV, "Instance1 Env") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(8).ENV, "") From AXUNIT
Call CHECK_EQUAL(INSTANCE3.AERROR(9).ENV, "") From AXUNIT


ST = fmet INSTANCE2_1.ADELETEERROR("KEY1")
Call CHECK_EQUAL(ST, [V]CST_AOK) From AXUNIT
ST = fmet INSTANCE1.ADELETEERRORALL( )
Call CHECK_EQUAL(ST, [V]CST_AOK) From AXUNIT

freeGroup INSTANCE1

Call CHECK_EQUAL( I, 0 ) From AXUNIT
End

