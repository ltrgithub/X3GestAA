#<AdxTL>@(#)8.0.0.0 $Revision$
TOTO = func TESTSUITE()
Infbox TOTO

End

# ---------- TEST_SUITE uni function       -------------------------
# ------------------------------------------------------------------

Funprog TESTSUITE()

    Call ADD_TESTCASE("TEST_OPENCLOSE", "Test open/close/adxseek",16) From AXUNIT
    Call ADD_TESTCASE("TEST_BASIC", "Test open/close basic write read, delete/rename file", 12) From AXUNIT
	Call ADD_TESTCASE("TEST_ALLTYPES", "Test open/close read write all types", 28) From AXUNIT
	Call ADD_TESTCASE("TEST_CHARTABLE", "Test open/close and table of char", 16) From AXUNIT
	Call ADD_TESTCASE("TEST_BASIC_BOM", "Test open/close basic write read, delete/rename file with bom", 9) From AXUNIT
	Call ADD_TESTCASE("TEST_BASICPUTGET", "Test basic putseq/getseq",12) From AXUNIT
	Call ADD_TESTCASE("TEST_PUTGETALLTYPES", "Test putseq/getseq all types",9) From AXUNIT
	Call ADD_TESTCASE("TEST_PUTGETLOB", "Test putseq/getseq lob",7) From AXUNIT	
End func AXUNIT.RUN_TESTSUITE("Types", "Common")

# -----------------------TEST_UNI -------------------------------------
# #####################################################################

$OPERROR
Call CHECK_EQUAL( errn, 20 ) From AXUNIT
Resume

Subprog TEST_OPENCLOSE( )
Local Char CHRVAR(20)
Local Integer INTVAR

Call CHECK_EQUAL( adxseek(0), -1 ) From AXUNIT
Call CHECK_EQUAL( adxseek(1), -1 ) From AXUNIT
Call CHECK_EQUAL( adxseek("TITI"), -1 ) From AXUNIT

NAME = "C:\temp\etna.txt" 
Onerrgo OPERROR
Openi NAME, 0 Using [FAB]
Onerrgo

Openo NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT
Call CHECK_EQUAL( adxseek("FAB"), 0 ) From AXUNIT
Openo Using [FAB]
R = Delfile( NAME )
Call CHECK_EQUAL( adxseek("FAB"), -1 ) From AXUNIT
Call CHECK_EQUAL( filinfo( NAME, 7 ), -20 ) From AXUNIT

NAME = "C:\temp\etna.txt" 
Onerrgo OPERROR
Openi NAME, 0
Onerrgo

Openo NAME, 0
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT
Call CHECK_EQUAL( adxseek(1), 0 ) From AXUNIT
Openo
Call CHECK_EQUAL( adxseek(1), -1 ) From AXUNIT
R = Delfile( NAME )

Openio NAME, 0
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT
Call CHECK_EQUAL( adxseek(1), 0 ) From AXUNIT
Openo
Call CHECK_EQUAL( adxseek(1), -1 ) From AXUNIT
R = Delfile( NAME )
Call CHECK_EQUAL( filinfo( NAME, 7 ), -20 ) From AXUNIT

End

Subprog TEST_BASIC( )
Local Char NAME(250)
Local Char CHRVAR(20)
Local Char TCHRVAR(20)(1..4)
Local Integer INTVAR
Local Integer R

TCHRVAR(1) ="TAB1"
TCHRVAR(2) ="TAB2"

NAME = "C:\temp\etna.txt" 
NAME2 = "C:\temp\etna2.txt" 
[S]adxifs = ";"
[S]adxium = 0

Openio NAME, 0 Using [FAB]

# Iomode adxifs "," Using  [FAB]

Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT
CHRVAR = "line0"
INTVAR = 25
Wrseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( adxseek("FAB"), 9 ) From AXUNIT
CHRVAR = "line1"
INTVAR = 26
Wrseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( adxseek("FAB"), 18 ) From AXUNIT
CHRVAR = "line2"
INTVAR = 27
Wrseq CHRVAR, Using [FAB]
Wrseq INTVAR Using [FAB]
Call CHECK_EQUAL( adxseek("FAB"), 27 ) From AXUNIT
Iomode adxifs "" Using  [FAB]
CHRVAR = "tété"
INTVAR = 28
Wrseq CHRVAR,INTVAR Using [FAB]

Seek First + 0 Using [FAB]
#Seek First + 5 Using [FAB]
#Seek Last - 0 Using [FAB]
#Seek Last - 5 Using [FAB]
#Seek Curr - 5 Using [FAB]
#Seek 5 Using [FAB]

Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line0" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 25 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line1" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 26 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line2" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 27 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "tété" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 28 ) From AXUNIT

Openo Using [FAB]

R = Renamefile( NAME, NAME2 )
R = Delfile( NAME2 )

End

Subprog TEST_VARIA( MYVAR )
Variable Char MYVAR( )
MYVAR = "tralalalala"
End


# -----------------------------------------------------------------------
Subprog TEST_ALLTYPES( )
NAME = "C:\temp\etna.txt" 
Local Char CHRVAR(20)
Local Integer INTVAR
Local Shortint SHTVAR
Local Decimal DCBVAR
Local Tinyint TNYVAR
Local Date DTEVAR
Local Datetime DTMVAR
Local Uuident UIDVAR
Local Clbfile CLBVAR(1)

[S]adxifs = ";"
[S]adxium = 0

Openio NAME, 0 Using [FAB]

Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

CHRVAR = "myline0"
INTVAR = 1
SHTVAR = 1
DCBVAR = 1.1
TNYVAR = 1
DTEVAR = "20040701"
DTMVAR = "2015-07-01T10:30:32Z"
UIDVAR = "288eadf8-43a6-4a15-8659-5330411430ea"
CLBVAR = "tralala0"
Wrseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]
CHRVAR = "myline1"
INTVAR = 2
SHTVAR = 2
DCBVAR = 2.2
TNYVAR = 2
DTEVAR = "20040702"
DTMVAR = "2015-07-02T10:30:32Z"
UIDVAR = "288eadf8-43a6-4a15-8659-5330411430ea"
CLBVAR = "tralalaa1"
Wrseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]
CHRVAR = "myline2"
INTVAR = 3
SHTVAR = 3
DCBVAR = 3.3
TNYVAR = 3
DTEVAR = "20040703"
DTMVAR = "2015-07-03T10:30:32Z"
UIDVAR = "288eadf8-43a6-4a15-8659-5330411430ea"
CLBVAR = "tralalaaa2"
Wrseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]

Seek First + 0 Using [FAB]

Rdseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "myline0" )  From AXUNIT
Call CHECK_EQUAL( INTVAR, 1 )  From AXUNIT
Call CHECK_EQUAL( SHTVAR, 1 ) From AXUNIT
Call CHECK_EQUAL( DCBVAR, 1.1 ) From AXUNIT
Call CHECK_EQUAL( TNYVAR, 1 ) From AXUNIT
Call CHECK_EQUAL( DTEVAR, "20040701" ) From AXUNIT
Call CHECK_EQUAL( DTMVAR, gdatetime$("2015-07-01T10:30:32Z") )  From AXUNIT
Call CHECK_EQUAL( UIDVAR, touuid("288eadf8-43a6-4a15-8659-5330411430ea")) From AXUNIT
Call CHECK_EQUAL( CLBVAR, "tralala0" ) From AXUNIT

Rdseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "myline1") From AXUNIT
Call CHECK_EQUAL( INTVAR, 2) From AXUNIT
Call CHECK_EQUAL( SHTVAR, 2) From AXUNIT
Call CHECK_EQUAL( DCBVAR, 2.2) From AXUNIT
Call CHECK_EQUAL( TNYVAR, 2) From AXUNIT
Call CHECK_EQUAL( DTEVAR, "20040702") From AXUNIT
Call CHECK_EQUAL( DTMVAR, gdatetime$("2015-07-02T10:30:32Z")) From AXUNIT
Call CHECK_EQUAL( UIDVAR, touuid("288eadf8-43a6-4a15-8659-5330411430ea")) From AXUNIT
Call CHECK_EQUAL( CLBVAR, "tralalaa1" ) From AXUNIT

Rdseq CHRVAR,INTVAR,SHTVAR,DCBVAR,TNYVAR,DTEVAR,DTMVAR,UIDVAR,CLBVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "myline2") From AXUNIT
Call CHECK_EQUAL( INTVAR, 3) From AXUNIT
Call CHECK_EQUAL( SHTVAR, 3) From AXUNIT
Call CHECK_EQUAL( DCBVAR, 3.3) From AXUNIT
Call CHECK_EQUAL( TNYVAR, 3) From AXUNIT
Call CHECK_EQUAL( DTEVAR, "20040703") From AXUNIT
Call CHECK_EQUAL( DTMVAR, gdatetime$("2015-07-03T10:30:32Z")) From AXUNIT
Call CHECK_EQUAL( UIDVAR, touuid("288eadf8-43a6-4a15-8659-5330411430ea")) From AXUNIT
Call CHECK_EQUAL( CLBVAR, "tralalaaa2") From AXUNIT

Openo Using [FAB]

R = Delfile( NAME )
End

# -----------------------------------------------------------------------
# -----------------------------------------------------------------------
Subprog TEST_CHARTABLE( )
NAME = "C:\temp\etna.txt" 
Local Char CHRVAR(20)(1..4)
Local Integer INTVAR, I

[S]adxifs = ";"
[S]adxium = 0

Openio NAME, 0 Using [FAB]

Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

For I = 1 To 4
	CHRVAR(I)="TABLine1"+num$(I)
Next
INTVAR = 0
Wrseq CHRVAR,INTVAR Using [FAB]
For I = 1 To 4
	CHRVAR(I)="TABLine2"+num$(I)
Next
INTVAR = 1
Wrseq CHRVAR,INTVAR Using [FAB]
For I = 1 To 4
	CHRVAR(I)="TABLine3"+num$(I)
Next
INTVAR = 2
Wrseq CHRVAR,INTVAR Using [FAB]

Seek First + 0 Using [FAB]

Rdseq CHRVAR,INTVAR Using [FAB]
For I = 1 To 4
	Call CHECK_EQUAL( CHRVAR(I), "TABLine1"+num$(I) ) From AXUNIT
Next
Call CHECK_EQUAL( INTVAR, 0 )  From AXUNIT

Rdseq CHRVAR,INTVAR Using [FAB]
For I = 1 To 4
	Call CHECK_EQUAL( CHRVAR(I), "TABLine2"+num$(I) ) From AXUNIT
Next
Call CHECK_EQUAL( INTVAR, 1 )  From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
For I = 1 To 4
	Call CHECK_EQUAL( CHRVAR(I), "TABLine3"+num$(I) ) From AXUNIT
Next
Call CHECK_EQUAL( INTVAR, 2 )  From AXUNIT

R = Delfile( NAME )

Openio Using [FAB]
End


Subprog TEST_BASIC_BOM( )
Local Char NAME(250)
Local Char CHRVAR(20)
Local Char TCHRVAR(20)(1..4)
Local Integer INTVAR
Local Integer R

TCHRVAR(1) ="TAB1"
TCHRVAR(2) ="TAB2"


NAME2 = "C:\temp\etna.txt" 
[S]adxifs = ";"
[S]adxium = 1

Openio NAME2, 0 Using [FAB]

# Iomode adxifs "," Using  [FAB]

Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT
CHRVAR = "line0"
INTVAR = 25
Wrseq CHRVAR,INTVAR Using [FAB]
CHRVAR = "line1"
INTVAR = 26
Wrseq CHRVAR,INTVAR Using [FAB]
CHRVAR = "line2"
INTVAR = 27
Wrseq CHRVAR, Using [FAB]
Wrseq INTVAR Using [FAB]
Iomode adxifs "" Using  [FAB]
CHRVAR = "tété"
INTVAR = 28
Wrseq CHRVAR,INTVAR Using [FAB]

Openo Using [FAB]
Openio NAME2, 0 Using [FAB]

Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line0" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 25 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line1" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 26 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "line2" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 27 ) From AXUNIT
Rdseq CHRVAR,INTVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "tété" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 28 ) From AXUNIT

Openo Using [FAB]

R = Delfile( NAME2 )

End


Subprog TEST_BASICPUTGET( )
Local Char CHRVAR(20)
Local Char TCHRVAR(8)(1..4)
Local Char NAME(255)
Local Integer INTVAR
Local Shortint SHTVAR
Local Date DTEVAR
NAME = "C:\temp\etna.dmp"

DTEVAR = Date$
Openio NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

CHRVAR = "tralala"
INTVAR = 4
SHTVAR = 2

Putseq 4, CHRVAR, INTVAR, SHTVAR, DTEVAR Using [FAB]
Seek First + 0 Using [FAB]
CHRVAR = ""
INTVAR = 0
SHTVAR = 0

Getseq 4, CHRVAR, INTVAR, SHTVAR, DTEVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "tralala" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 4 ) From AXUNIT
Call CHECK_EQUAL( SHTVAR, 2 ) From AXUNIT
Call CHECK_EQUAL( DTEVAR, Date$ ) From AXUNIT



Openio Using [FAB]
R = Delfile( NAME )

Openio NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

TCHRVAR(1) = "tralala0"
TCHRVAR(2) = "tralala1"
TCHRVAR(3) = "tralala2"
TCHRVAR(4) = "tralala3"
INTVAR = 4
SHTVAR = 2



Putseq 6, TCHRVAR, INTVAR, SHTVAR Using [FAB]
Seek First + 0 Using [FAB]
TCHRVAR(1) = ""
TCHRVAR(2) = ""
TCHRVAR(3) = ""
TCHRVAR(4) = ""
INTVAR = 0
SHTVAR = 0
Getseq 6, TCHRVAR, INTVAR, SHTVAR Using [FAB]
Call CHECK_EQUAL( TCHRVAR(1), "tralala0" ) From AXUNIT
Call CHECK_EQUAL( TCHRVAR(2), "tralala1" ) From AXUNIT
Call CHECK_EQUAL( TCHRVAR(3), "tralala2" ) From AXUNIT
Call CHECK_EQUAL( TCHRVAR(4), "tralala3" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 4 ) From AXUNIT
Call CHECK_EQUAL( SHTVAR, 2 ) From AXUNIT

Openio Using [FAB]
R = Delfile( NAME )

End

Subprog TEST_PUTGETALLTYPES( )
Local Char CHRVAR(20)
Local Char TCHRVAR(8)(1..4)
Local Char NAME(255)
Local Integer INTVAR
Local Shortint SHTVAR
Local Date DTEVAR
Local Tinyint TNYVAR
Local Uuident UIDVAR
Local Datetime DTMVAR
Local Decimal DCBVAR
Local Decimal DCBVAR2(9,2)

NAME = "C:\temp\etna.dmp"


Openio NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

CHRVAR = "tralala"
INTVAR = 4
SHTVAR = 2
TNYVAR = 130
DTEVAR = Date$
UIDVAR = "288eadf8-43a6-4a15-8659-5330411430ea"
DTMVAR = "2015-07-01T10:30:32Z"
DCBVAR = 552.23

Putseq 8, CHRVAR, INTVAR, SHTVAR, DTEVAR,TNYVAR,UIDVAR,DTMVAR,DCBVAR Using [FAB]
Seek First + 0 Using [FAB]
CHRVAR = ""
INTVAR = 0
SHTVAR = 0
TNYVAR = 0
UIDVAR = "00000000-0000-0000-0000-000000000000"
DCBVAR= 0

Getseq 8, CHRVAR, INTVAR, SHTVAR, DTEVAR,TNYVAR,UIDVAR,DTMVAR,DCBVAR Using [FAB]
Call CHECK_EQUAL( CHRVAR, "tralala" ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 4 ) From AXUNIT
Call CHECK_EQUAL( SHTVAR, 2 ) From AXUNIT
Call CHECK_EQUAL( DTEVAR, Date$ ) From AXUNIT
Call CHECK_EQUAL( TNYVAR, 130 ) From AXUNIT
Call CHECK_EQUAL( UIDVAR, touuid("288eadf8-43a6-4a15-8659-5330411430ea")) From AXUNIT
Call CHECK_EQUAL( DTMVAR, gdatetime$("2015-07-01T10:30:32Z") )  From AXUNIT
Call CHECK_EQUAL( DCBVAR, 552.23 )  From AXUNIT

Openio Using [FAB]
R = Delfile( NAME )



End

Subprog TEST_PUTGETLOB( )
Local Char CHRVAR(20)
Local Integer OLEN, SLEN
Local Integer INTVAR
Local Blbfile BLBVAR
Local Clbfile CLBVAR
Local Char CHRVAR(20)
Local Integer INTVAR
Local Char STR(255)

NAME = "C:\temp\etna.dmp"
STR = "Tralala &à%ù@"

BLBVAR = toBlbfile("Tralala &à%ù@",CST_UTF8)
OLEN = len(BLBVAR)
SLEN = OLEN

Openio NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

Putseq 1, OLEN Using [FAB]
Putseq 1, BLBVAR Using [FAB]
Seek First + 0 Using [FAB]
OLEN = 0

Getseq 1, OLEN Using [FAB]
Call CHECK_EQUAL( OLEN, SLEN ) From AXUNIT
Getseq 1, BLBVAR Sized OLEN Using [FAB]

CLBVAR = toClbfile(BLBVAR, CST_UTF8) : # iso-8859-1 string
Call CHECK_EQUAL( CLBVAR, STR ) From AXUNIT

Openio Using [FAB]
R = Delfile( NAME )

Openio NAME, 0 Using [FAB]
Call CHECK_EQUAL( filinfo( NAME, 7 ), 0 ) From AXUNIT

CHRVAR = "tralala"
INTVAR = 4
CLBVAR = STR

Putseq 3, CHRVAR, CLBVAR, INTVAR Using [FAB]
Seek First + 0 Using [FAB]

Getseq 3, CHRVAR, CLBVAR, INTVAR Using [FAB]

Call CHECK_EQUAL( CHRVAR, "tralala" ) From AXUNIT
Call CHECK_EQUAL( CLBVAR, STR ) From AXUNIT
Call CHECK_EQUAL( INTVAR, 4 ) From AXUNIT

Openio Using [FAB]
R = Delfile( NAME )

End

