Call OUVRE_TRACE("QLFAR_75403") From LECFIC
Call TESTSUITE()

Call FERME_TRACE From LECFIC
GTRACE = "QLFAR_75403_"+GUSER
Call LEC_TRACE From LECFIC
End

# ---------- TEST_SUITE field synchronisation -----------------
# -------------------------------------------------------------

Funprog TESTSUITE()

Call TESTSUITE_START("QLFAR_75403", "QLFAR_75403") From AXUNIT
Call ADD_TESTCASE("TEST_SDA0", "evalueSData classic test", 14) From AXUNIT
Call ADD_TESTCASE("TEST_SDA1", "evalueSData date test", 14) From AXUNIT
Local Clbfile  SUITE_RESULT
SUITE_RESULT = func AXUNIT.RUN_TESTSUITE("QLFAR_75403", "QLFAR_75403")
End SUITE_RESULT

# -----------------------TEST_VARIABLE --------------------------------
# ###################################################################
Subprog TEST_SDA0( )
Local Char TBPRO(20)(1..10)
Local Char TBFIL(20)(1..10)
Local File AABREV [ABV]
Local Integer I

# ---------------- Cas 1, all provided ------------------------
# -------------------------------------------------------------
TBPRO(1) = "TOTO"
TBFIL(1) = "[F:ABV]ABREV"

Filter [ABV] Where evalueSData("TOTO eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT


# ---------------- Cas 2, no class F ------------------------
# -----------------------------------------------------------
TBPRO(1) = "TOTO"
TBFIL(1) = "[ABV]ABREV"
Filter [ABV] Where evalueSData("TOTO eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT

# ---------------- Cas 3, no class ----------------------------
# -------------------------------------------------------------
TBPRO(1) = "TOTO"
TBFIL(1) = "ABREV"
Filter [ABV] Where evalueSData("TOTO eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT

# ---------------- Cas 4 no class at all ------------------------
# ---------------------------------------------------------------
TBPRO(1) = ""
TBFIL(1) = ""
Filter [ABV] Where evalueSData("ABREV eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT


# ---------------- Cas 5 class not well formed : ignored --------
# ---------------------------------------------------------------
TBPRO(1) = "TOTO"
TBFIL(1) = "AB]ABREV"
Filter [ABV] Where evalueSData("TOTO eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT


# ---------------- Cas 6 class no field provided ----------------
# ---------------------------------------------------------------
TBPRO(1) = "ABREV"
TBFIL(1) = "[ABV]"
Filter [ABV] Where evalueSData("ABREV eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT


# ---------------- Cas 7 class nothing provided -----------------
# ---------------------------------------------------------------
TBPRO(1) = "ABREV"
TBFIL(1) = ""
Filter [ABV] Where evalueSData("ABREV eq '%'",TBPRO,TBFIL)
I = 0
For [ABV]
    Call CHECK_EQUAL( [ABV]ABREV, "%" ) From AXUNIT
    I += 1
Next
Call CHECK_EQUAL( I, 1 ) From AXUNIT

Close Local File [ABV]

End


Subprog TEST_SDA1( )
Local Char TBPRO(20)(1..10)
Local Char TBFIL(20)(1..10)
Local File AABREV [ABV]
Local Integer I


TBPRO(1) = "CREDATTIM"
TBFIL(1) = "[ABV]"
Filter [ABV] Where evalueSData("CREDATTIM eq @@",TBPRO,TBFIL)
I = 0
For [ABV]
    I += 1
Next
Call CHECK_NOTEQUAL( I, 0 ) From AXUNIT

Filter [ABV] Where evalueSData("CREDATTIM eq null",TBPRO,TBFIL)
I = 0
For [ABV]
    I += 1
Next
Call CHECK_NOTEQUAL( I, 0 ) From AXUNIT



End
