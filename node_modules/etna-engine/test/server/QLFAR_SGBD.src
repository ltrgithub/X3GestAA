#<AdxTL>@(#)8.0.0.0 $Revision$
TOTO = func TESTSUITE()
Infbox TOTO

End

# ---------- TEST_SUITE uni function       -------------------------
# ------------------------------------------------------------------

Funprog TESTSUITE()
    Call ADD_TESTCASE("TEST_WR_READ", "Test base", 15) From AXUNIT
    Call ADD_TESTCASE("TEST_WR_READ_NULL", "Test Null", 13) From AXUNIT
    Call ADD_TESTCASE("TEST_READ_WRITE_LOB", "Test write lob", 2) From AXUNIT
    Call ADD_TESTCASE("TEST_READ_REWRITE_LOB", "Test rewrite lob", 4) From AXUNIT
    Call ADD_TESTCASE("TEST_WR_READ_WHER", "Test filter", 1) From AXUNIT    
	Call ADD_TESTCASE("TEST_BASIC_FOR", "Test For basic", 20) From AXUNIT
	Call ADD_TESTCASE("TEST_FOR_FUNC", "Test For with functions", 40) From AXUNIT
	Call ADD_TESTCASE("TEST_FOR_POSTEVA", "Test post evaluation", 2) From AXUNIT		
	Call ADD_TESTCASE("TEST_FOR_EVALUE", "Test For with evalue", 4) From AXUNIT
	Call ADD_TESTCASE("TEST_BASIC_LINK", "Test Link basic", 2) From AXUNIT
	Call ADD_TESTCASE("TEST_ORDER_BY", "Test order by key", 5) From AXUNIT
	Call ADD_TESTCASE("TEST_NESTED_LOOP1", "Test nested loop 1", 12) From AXUNIT
	Call ADD_TESTCASE("TEST_NESTED_LOOP2", "Test nested loop 2", 4) From AXUNIT		
	Call ADD_TESTCASE("TEST_TRANSACTION", "Test transaction", 2) From AXUNIT
	Call ADD_TESTCASE("TEST_WR_KEY", "Test where key", 2) From AXUNIT
	Call ADD_TESTCASE("TEST_LOCK_HINT", "Test lock hint", 4) From AXUNIT
	Call ADD_TESTCASE("TEST_REWRITE", "Test Rewrite", 3) From AXUNIT		
	Call ADD_TESTCASE("TEST_DELETE", "Test delete", 13) From AXUNIT		
	Call ADD_TESTCASE("TEST_UPDATE", "Test update", 6) From AXUNIT
	Call ADD_TESTCASE("TEST_FUNC0", "Test funtion 0", 4) From AXUNIT	
	Call ADD_TESTCASE("TEST_G", "Test class G", 14) From AXUNIT
	Call ADD_TESTCASE("TEST_FIRSTLAST", "Test First Last", 2) From AXUNIT	
	Call ADD_TESTCASE("TEST_HINT", "Test Read Hint", 7) From AXUNIT	
	Call ADD_TESTCASE("TEST_READ_MQ", "Test read multi-query", 2) From AXUNIT	
	Call ADD_TESTCASE("TEST_SQL", "Test sql", 10) From AXUNIT	
	Call ADD_TESTCASE("TEST_FORFROMTO", "Test from to", 4) From AXUNIT	
	Call ADD_TESTCASE("TEST_FORSQL", "Test sql", 1) From AXUNIT
	Call ADD_TESTCASE("TEST_COLUMNS", "Test columns", 60) From AXUNIT	
	
	

End func AXUNIT.RUN_TESTSUITE("Types", "Common")

# -----------------------TEST_WR_READ -------------------------------------
# #########################################################################

Subprog TEST_WR_READ( )
Local Integer I
Local Char FILEN(30)
Default File "[ABV], [ABV]"
#dbgetna
Local File AQCDBTYPES [ABV]
Local File AQCITEML [ITM]
#dbgetna
trbegin [ABV]
delete [ABV] Where 1=1
commit

#dbgetna
#Filter [ABV] Order By Key CODE(1) Desc

[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Trbegin [ABV]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

#dbgetna
Trbegin [ABV]
Read [ABV]CODE=201
#dbgetna
Readlock [ABV] Curr
Commit
Read [ABV]CODE(1)=201

#Read [ABV]=

Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

#Filter [ABV] Where [ABV]DCB9_2 = 124521.215112
#Read [ABV] First

#Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

# test value.....
Call CHECK_EQUAL( [ABV]IDX, 201 ) From AXUNIT
Call CHECK_EQUAL( [ABV]C5, 15126 ) From AXUNIT
Call CHECK_EQUAL( [ABV]A10, "A2" ) From AXUNIT
Call CHECK_EQUAL( [ABV]A250, "A121545" ) From AXUNIT
#Call CHECK_EQUAL( [ABV]DTM, [04/02/2015] ) From AXUNIT
Call CHECK_EQUAL( [ABV]L8, 154654 ) From AXUNIT
Call CHECK_EQUAL( [ABV]DCB9_2, 124521.215 ) From AXUNIT
Call CHECK_EQUAL( [ABV]CREDATTIM, gdatetime$("2015-07-01T10:30:32Z") ) From AXUNIT
Call CHECK_EQUAL( [ABV]UPDDATTIM, gdatetime$("2015-07-01T10:30:32Z") ) From AXUNIT
Call CHECK_EQUAL( [ABV]CREUSR, "AQCOR" ) From AXUNIT
Call CHECK_EQUAL( [ABV]UPDUSR, "AQCOR" ) From AXUNIT
Call CHECK_EQUAL( [ABV]AUUID, touuid("288eadf8-43a6-4a15-8659-5330411430ea") ) From AXUNIT

#dbgetna
Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT

[ABV]IDX = 202
Trbegin [ABV]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
#dbgetna

Read [ABV]CODE>=201

Close Local File [ABV]


#Read [ITM]AQCITML0="ART5"
#Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
#[ITM]YITMREF = "ZART5"
#Trbegin [ITM]
#Write [ITM]
#Commit
#Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

End

# -----------------------TEST_WR_READ_NULL---------------------------------
# #########################################################################


Subprog TEST_WR_READ_NULL( )
Local Integer I
Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

[ABV]IDX = 201

Trbegin [ABV]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

# test value.....
Call CHECK_EQUAL( [ABV]IDX, 201 ) From AXUNIT
Call CHECK_EQUAL( [ABV]C5, 0 ) From AXUNIT
Call CHECK_EQUAL( [ABV]A10, "" ) From AXUNIT
Call CHECK_EQUAL( [ABV]A250, "" ) From AXUNIT
#Call CHECK_EQUAL( [ABV]DTM, [04/02/2015] ) From AXUNIT
Call CHECK_EQUAL( [ABV]L8, 0 ) From AXUNIT
Call CHECK_EQUAL( [ABV]DCB9_2, 0 ) From AXUNIT
#Call CHECK_EQUAL( [ABV]CREDATTIM, gdatetime$("0000-00-00T00:00:00Z") ) From AXUNIT
#Call CHECK_EQUAL( [ABV]UPDDATTIM, gdatetime$("2015-07-01T10:30:32Z") ) From AXUNIT
Call CHECK_EQUAL( [ABV]CREUSR, "USER" ) From AXUNIT
Call CHECK_EQUAL( [ABV]UPDUSR, "USER" ) From AXUNIT
Call CHECK_EQUAL( [ABV]AUUID, touuid("00000000-0000-0000-0000-000000000000") ) From AXUNIT
									  
Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT

[ABV]IDX = 202
Trbegin [ABV]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Close Local File [ABV]
End

# -----------------------TEST_WR_READ_LOB---------------------------------
# #########################################################################

Subprog TEST_READ_WRITE_LOB()
Local File ABLOB[ABV]

Read [ABV]ABB0="AUSPIC";"VPO";""
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

Trbegin [ABV]
Delete [ABV]ABB0="AUSPIC";"VPO";"A2";"Z3"
[ABV]IDENT2 = "A2"
[ABV]IDENT3 = "Z3"
[ABV]CREDAT = [00/00/0000]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
End

Subprog TEST_READ_REWRITE_LOB()
Local File ABLOB[ABV]
Local Char IMG64(250)
Local Clbfile GOT(2)
Local Integer DUMMY

IMG64 = "R0lGODlhBgAJAJECAPj3+NXt/wAAAAAAACH5BAEAAAIALAAAAAAGAAkAAAINlC+AqQfREmygOrYiKgA7"
Trbegin [ABV]
Read [ABV]ABB0="AUSPIC";"VPO";"A2";"Z3"
Call CHECK_EQUAL(fstat, 0) From AXUNIT

DUMMY = B64Decode(IMG64, [ABV]BLOB)
Rewrite [ABV]
Call CHECK_EQUAL(fstat, 0) From AXUNIT
Commit

Read [ABV]ABB0="AUSPIC";"VPO";"A2";"Z3"
Call CHECK_EQUAL(fstat, 0) From AXUNIT
DUMMY = B64Encode([ABV]BLOB, GOT)
Call CHECK_EQUAL(IMG64, GOT) From AXUNIT

Close Local File [ABV]
End


# -----------------------TEST_WR_READ_WHER---------------------------------
# #########################################################################

Subprog TEST_WR_READ_WHER( )
Local Integer I
Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Trbegin [ABV]
Write [ABV]
Commit
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

#Filter [ABV] Where [ABV]DCB9_2 = 124521.215112

#Read [ABV] First
#Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Close Local File [ABV]
End

# -----------------------TEST BASIC FOR  ---------------------------------
# #########################################################################


Subprog TEST_BASIC_FOR( )
Local Integer I
LOCAL INTEGER MYIDX
LOCAL INTEGER MYC5
Local INTEGER AINT
Local File AQCDBTYPES [ABV]
Local File AABREV[ABB]

trbegin [ABV]
delete [ABV] Where 1=1
commit


Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")


Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

I = 0
MYIDX = 201
MYC5 = 15126
#dbgetna
For [ABV] Where ((C5 >= 1) Or ([ABV]CREUSR >= "A")) And ([ABV]IDX >= 0)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
I=0
AINT = 1
For [ABV] Where (([ABV]C5 >= AINT) Or ([ABV]CREUSR >= "A")) And ([ABV]IDX >= 0)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
AINT = 1
For [ABV] Where (([ABV]C5 >= [L]AINT) Or ([ABV]CREUSR >= "A")) And ([ABV]IDX >= 0)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
[ABB]ABREV = "A"
#dbgetna
For [ABV] Where (([ABV]C5 >= [L]AINT) Or ([ABV]CREUSR >= [ABB]ABREV)) And ([ABV]IDX >= 0)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I = 0

For [ABV] Where (([ABV]C5 >= INT(1)) Or ([ABV]CREUSR >= "A")) And ([ABV]IDX >= 0)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
Close Local File [ABV]
Close Local File [ABB]

End


# -----------------------TEST BASIC FUNC  ---------------------------------
# #########################################################################


Subprog TEST_FOR_FUNC( )
Local Integer I
LOCAL INTEGER MYIDX
LOCAL INTEGER MYC5
Local INTEGER AINT
Local File AQCDBTYPES [ABV]
Local File AABREV[ABB]
local Integer TAB(1..2)

trbegin [ABV]
delete [ABV] Where 1=1
commit


Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")


Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]


[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

I = 0
MYIDX = 202
MYC5 = 15127
####   length
#dbgetna

For [ABV]CODE Where len([ABV]A250) >= 5
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
I=0

For [ABV]CODE Where tolower([ABV]A250) = "a121545"
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
For [ABV]CODE Where left$([ABV]A250, 5) = "A1215"
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
For [ABV]CODE Where mid$([ABV]A250, 1, 5) = "A1215"
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
For [ABV]CODE Where pat([ABV]A250, "A1215*")
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
For [ABV]CODE Where pat([ABV]A250, "A1215*") <> 0
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
MYIDX = 201
MYC5 = 15126
For [ABV]CODE Where pat([ABV]A250, "A1215*") = 0
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
MYIDX = 201
MYC5 = 15126
For [ABV]CODE Where find([ABV]IDX, 201, 202)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next


I=0
TAB(1) = 201
TAB(2) = 202
MYIDX = 201
MYC5 = 15126
#dbgetna
For [ABV]CODE Where find([ABV]IDX, TAB)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
MYIDX = 201
MYC5 = 15126

For [ABV]CODE Where find([ABV]IDX, 201, 202) <> 0
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next

I=0
MYIDX = 203
MYC5 = 15128

For [ABV]CODE Where find([ABV]IDX, 201, 202) = 0
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
Close Local File [ABV]
End

# -----------------------TEST BASIC LINK  ---------------------------------
# #########################################################################

Subprog TEST_BASIC_LINK( )
Local File ATABLE [ATB]
Local File ATEXTE [ATX]
Local Integer N

#dbgetna
Link [ATB]  With [ATX]NUMERO="FRA";[ATB]INTITFIC As [LNK]

For [LNK] Where [ATB]CODFIC = "ATABLE"
	Call CHECK_EQUAL( [ATB]CODFIC, "ATABLE" ) From AXUNIT
Next

#dbgetna
Link [ATB]  With [ATX]NUMERO~="FRA";[ATB]INTITFIC As [LNK1]

For [LNK1] Where [ATB]CODFIC = "ATABLE"
	Call CHECK_EQUAL( [ATB]CODFIC, "ATABLE" ) From AXUNIT
Next

Close Local File [ATB]
Close Local File [ATX]
End

# -----------------------TEST BASIC EVALUE  ---------------------------------
# #########################################################################

Subprog TEST_FOR_EVALUE( )
Local Integer I
LOCAL INTEGER MYIDX
LOCAL INTEGER MYC5
Local INTEGER AINT
Local File AQCDBTYPES [ABV]
Local File AABREV[ABB]
Local Char STR(250)

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

I = 0
MYIDX = 201
MYC5 = 15126

STR = "(([ABV]C5 >= 1) Or ([ABV]CREUSR >= 'A')) And ([ABV]IDX >= 0)"

#dbgetna
For [ABV] Where evalue(STR)
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
Close Local File [ABV]
End


# -----------------------TEST POST EVALUATION  ----------------------------
# #########################################################################


Subprog TEST_FOR_POSTEVA( )
Local Integer I
LOCAL INTEGER MYIDX
LOCAL INTEGER MYC5
Local INTEGER AINT
Local File AQCDBTYPES [ABV]
Local File AABREV[ABB]

trbegin [ABV]
delete [ABV] Where 1=1
commit


Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]


[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

I = 0
MYIDX = 202
MYC5 = 15127
For [ABV]CODE Where len([ABV]A250) >= 5  and SEG$([ABV]A250,2,4) = "121" and [ABV]IDX > 201
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT#
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next
Close Local File [ABV]
End

# -----------------------TEST ORDER BY  ----------------------------
# #########################################################################


Subprog TEST_ORDER_BY( )

Local Integer I
LOCAL INTEGER MYIDX
LOCAL INTEGER MYC5
Local INTEGER AINT
Local File AQCDBTYPES [ABV]
Local File AABREV[ABB]

trbegin [ABV]
delete [ABV] Where 1=1
commit


Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

I = 0
MYIDX = 202
MYC5 = 15127
Filter [ABV] Where len([ABV]A250) >= 5  and SEG$([ABV]A250,2,4) = "121" and [ABV]IDX > 201 Order By Key CLE1=IDX;C5

For [ABV]CLE1
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT#
	Call CHECK_EQUAL( [ABV]C5, MYC5+I ) From AXUNIT
	I += 1
Next


Filter [ABV] Where len([ABV]A250) >= 5  and SEG$([ABV]A250,2,4) = "121" and [ABV]IDX > 201 Order By Key CODE
MYIDX = 202
I=0
For [ABV]
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT#
	I += 1
Next

Filter [ABV] Where len([ABV]A250) >= 5  and SEG$([ABV]A250,2,4) = "121" and [ABV]IDX > 201 Order By Key CODE Desc
MYIDX = 202
I=0
For [ABV]
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT#
	I += 1
Next

#dbgetna
Filter [ABV] Where len([ABV]A250) >= 5  and SEG$([ABV]A250,2,4) = "121" and [ABV]IDX > 201 Order With "[ABV]IDX;C5"
MYIDX = 202
I=0
For [ABV]
	Call CHECK_EQUAL( [ABV]IDX, MYIDX+I ) From AXUNIT#
	I += 1
Next

Close Local File [ABV]
End


# -----------------------TEST NESTED LOOP  ----------------------------
# #########################################################################

Subprog TEST_NESTED_LOOP1( )

Local File AQCREQ2 [AQCREQ2]
Local File TABCOUNTRY [TCY]
Local File TABCUR [TCU]
Local File ALISTEH [ALH]
Local File ATEXTRA [AY12]
Local Integer N1, N2,N3

# Now let's declare the request (Link) and the fields expected (Columns)


Link [AQCREQ2] With [TCY]TCY0 = [F:AQCREQ2]CRY, [TCU]TCU0 = [F:TCY]CUR, [AY12]AXX0 = "TABCOUNTRY";"CRYDES";"ENG";[F:TCY]CRY;""  As [LNK]
& Where [F:AQCREQ2]CRY = 'AN' or [F:AQCREQ2]CRY = 'AR'
& Order by Key CLE = [F:AQCREQ2]CRY;[F:TCU]CURSYM Desc

N1=0
N2=0
N3=0
For [LNK]CLE(1)
    N1+=1
    For [LNK]CLE(2)
        N2+=1   
        For [LNK]CLE
            N3+=1
        Next
    Next
Next

Call CHECK_EQUAL( N3, 16 ) From AXUNIT
Call CHECK_EQUAL( N2, 2 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

N1=0
N2=0
N3=0
For [LNK]CLE(1)
    N1+=1
    For [LNK]CLE
        N2+=1   
    Next
Next
Call CHECK_EQUAL( N3, 0 ) From AXUNIT
Call CHECK_EQUAL( N2, 16 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

N1=0
N2=0
N3=0
For [LNK]CLE(1)
    N1+=1
    For [LNK]CLE(2)
        N2+=1   
    Next
Next
Call CHECK_EQUAL( N3, 0 ) From AXUNIT
Call CHECK_EQUAL( N2, 2 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

N1=0
N2=0
N3=0
For [LNK]CLE(1)
    N1+=1
Next
Call CHECK_EQUAL( N3, 0 ) From AXUNIT
Call CHECK_EQUAL( N2, 0 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

Close Local File [LNK]
Close Local File [AQCREQ2]
Close Local File [TCY]
Close Local File [TCU]
Close Local File [ALH]
Close Local File [AY12]

End


# -----------------------TEST NESTED LOOP2  ----------------------------
# #########################################################################

Subprog TEST_NESTED_LOOP2( )
Local File AQCREQ2 [AQCREQ2]
Local File TABCOUNTRY [TCY]
Local File TABCUR [TCU]
Local File ALISTEH [ALH]
Local File ATEXTRA [AY12]
Local Integer N1, N2

# Now let's declare the request (Link) and the fields expected (Columns)
Link [AQCREQ2] With [TCY]TCY0 = [F:AQCREQ2]CRY, [TCU]TCU0 = [F:TCY]CUR, [AY12]AXX0 = "TABCOUNTRY";"CRYDES";"ENG";[F:TCY]CRY;""  As [LNK]
& Where [F:AQCREQ2]CRY = 'AN' or [F:AQCREQ2]CRY = 'AR'
& Order by Key CLE = [F:AQCREQ2]CRY

N1=0
N2=0
For [LNK]CLE(1)
    N1+=1
    For [LNK]CLE
        N2+=1   
    Next
Next
Call CHECK_EQUAL( N2, 16 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

N1=0
N2=0
For [LNK]CLE(1)
    N1+=1
Next
Call CHECK_EQUAL( N2, 0 ) From AXUNIT
Call CHECK_EQUAL( N1, 2 ) From AXUNIT

Close Local File [LNK]
Close Local File [AQCREQ2]
Close Local File [TCY]
Close Local File [TCU]
Close Local File [ALH]
Close Local File [AY12]

End


# -----------------------TEST TRANSACTION  --------------------------------
# #########################################################################

Subprog TEST_TRANSACTION( )
Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

commit

Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Rollback

Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT

End

# ---------------------------   WHERE KEY  --------------------------------
# #########################################################################
Subprog TEST_WR_KEY( )
Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Filter [ABV] Order by key CLE=IDX;C5

#dbgetna
For [ABV] Where Key CLE=202;15127
	Call CHECK_EQUAL( [ABV]IDX, 202 ) From AXUNIT
Next

#dbgetna
For [ABV] Where Key CLE>202;15127
	Call CHECK_EQUAL( [ABV]IDX, 203 ) From AXUNIT
Next

Close Local File [ABV]

End

# ---------------------------   WHERE KEY  --------------------------------
# #########################################################################
Subprog TEST_LOCK_HINT( )
Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Trbegin [ABV]
For [ABV] Where Key CODE=202 With Lock
	Call CHECK_EQUAL( [ABV]IDX, 202 ) From AXUNIT
Next
Commit

For [ABV] Hint key CODE Where Key CODE=202
	Call CHECK_EQUAL( [ABV]IDX, 202 ) From AXUNIT
Next

For [ABV] Hint key ="CODE" Where Key CODE=202
	Call CHECK_EQUAL( [ABV]IDX, 202 ) From AXUNIT
Next

#dbgetna
For [ABV] Hint key ="CODE" Where Key CODE(1)=202
	Call CHECK_EQUAL( [ABV]IDX, 202 ) From AXUNIT
Next

End

# ---------------------------   REWRITE  ----------------------------------
# #########################################################################
Subprog TEST_REWRITE( )

Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Trbegin [ABV]
Readlock [ABV]CODE=201
Call CHECK_EQUAL( [ABV]IDX, 201 ) From AXUNIT
[ABV]C5 = 20000
#dbgetna
Rewrite [ABV]
Read [ABV]CODE=201
Call CHECK_EQUAL( [ABV]C5, 20000 ) From AXUNIT

Readlock [ABV]CODE=202
[ABV]IDX = 201
Rewrite [ABV]
Call CHECK_EQUAL( fstat, 3 ) From AXUNIT

Commit

End


# ---------------------------   DELETE  ----------------------------------
# #########################################################################
Subprog TEST_DELETE( )

Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Trbegin [ABV]
Readlock [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Delete [ABV] Curr
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Rollback
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT

Trbegin [ABV]
Delete [ABV]CODE=201
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Rollback

Trbegin [ABV]

Delete [ABV]CODE>201
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Read [ABV]CODE=203
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Rollback

Trbegin [ABV]
#dbgetna
delete [ABV] Where num$([ABV]C5)="15127"
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Read [ABV]CODE=203
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Rollback

Trbegin [ABV]

delete [ABV] Where [ABV]C5=15127
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Read [ABV]CODE=202
Call CHECK_EQUAL( fstat, 5 ) From AXUNIT
Read [ABV]CODE=203
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Rollback


End


# ---------------------------   UPDATE  ----------------------------------
# #########################################################################
Subprog TEST_UPDATE( )

Local File AQCDBTYPES [ABV]

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Trbegin [ABV]
Update [ABV] Where [ABV]IDX=201 With [ABV]C5 = 230,A10="tralala"
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Call CHECK_EQUAL( [ABV]C5, 230 ) From AXUNIT
Call CHECK_EQUAL( [ABV]A10, "tralala" ) From AXUNIT

Update [ABV] Where num$([ABV]IDX)="201" With [ABV]C5 = 231,A10="trololo"
Read [ABV]CODE=201
Call CHECK_EQUAL( fstat, 0 ) From AXUNIT
Call CHECK_EQUAL( [ABV]C5, 231 ) From AXUNIT
Call CHECK_EQUAL( [ABV]A10, "trololo" ) From AXUNIT

Commit

End


# ---------------------------  FUNC0  -------------------------------------
# #########################################################################
Subprog TEST_FUNC0( )

Local File AQCDBTYPES [ABV]
Local Integer R0, R

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 50
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

R = nbrecord([ABV])
Call CHECK_EQUAL( R, 3 ) From AXUNIT

R0 = uniqid([ABV])
R = uniqid([ABV])
Call CHECK_EQUAL( R, R0+1 ) From AXUNIT

Filter [ABV] Where [ABV]C5 > 100
R = rowcount([ABV])
Call CHECK_EQUAL( R, 2 ) From AXUNIT


Filter [ABV] Where num$([ABV]IDX) = "201"
R = rowcount([ABV])
Call CHECK_EQUAL( R, 1 ) From AXUNIT

End

# ---------------------------  G CLASS -----------------------------------------
# #########################################################################
Subprog TEST_G( )

Local File AQCDBTYPES [ABV]
Local File ACCES[ACC]

Local Char NAM(30)
Local Integer NBZ, KYU, DIV
[F:ABV]C5 = 10

NAM = [G:ABV]adxfname(1)
Call CHECK_EQUAL( NAM, "CREDATTIM" ) From AXUNIT
NBZ = [G:ABV]nbzon
Call CHECK_EQUAL( NBZ, 13 ) From AXUNIT
NAM = [G:ABV]keyname(0)
Call CHECK_EQUAL( NAM, "CODE") From AXUNIT
KYU = [G:ABV]keyuniq(0)
Call CHECK_EQUAL( KYU, 1) From AXUNIT
DIV = [G:ABV]keylen(0)
Call CHECK_EQUAL( DIV, 0) From AXUNIT
DIV = [G:ABV]filenume
Call CHECK_EQUAL( DIV, 0) From AXUNIT
DIV = [G:ABV]nbind
Call CHECK_EQUAL( DIV, 1) From AXUNIT

DIV = [G:ACC]nbind
Call CHECK_EQUAL( DIV, 2) From AXUNIT
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 1) From AXUNIT

# ------ currind ---------------------------
Read [ACC]CODACC="trash";"trash"
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 1) From AXUNIT
Read [ACC]PRFCOD="trash";"trash";"trash"
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 2) From AXUNIT

[G:ACC]currind = 1
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 1) From AXUNIT

Read [ACC]="trash";"trash"
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 1) From AXUNIT

[G:ACC]currind = 2
Filter [ACC] Order By key CLE=CODACC;USR
DIV = [G:ACC]currind
Call CHECK_EQUAL( DIV, 1) From AXUNIT
Read [ACC]="trash";"trash"
Filter [ACC]
[G:ACC]currind = 2
[G:ACC]currind = 1

# ------ currlen ---------------------------

End


# ----------------------  FIRST LAST  -------------------------------------
# #########################################################################
Subprog TEST_FIRSTLAST( )

Local File AQCDBTYPES [ABV]
Local Integer R0, R

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 50
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Filter [ABV] Where C5 > 100

Read [ABV] First
Call CHECK_EQUAL( [ABV]IDX, 201) From AXUNIT

Read [ABV] Last
Call CHECK_EQUAL( [ABV]IDX, 203) From AXUNIT


End

# ----------------------  TEST HINT  -------------------------------------
# #########################################################################
Subprog TEST_HINT( )

Local File AQCDBTYPES [ABV]
Local Integer R0, R

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 50
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit


Filter [ABV] Where A250="A121545" and Key CODE=202
Read [ABV] First
Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT

Read [ABV] First Hint Key CODE
Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT

Read [ABV] Last Hint Key [ABV]CODE
Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT

Read [ABV] First Nohint
Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT

For [ABV] Hint Key CODE
	Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT
Next

For [ABV] Hint Key [ABV]CODE
	Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT
Next

For [ABV]
	Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT
Next

End



# ----------------------  TEST READ MULTI-QUERY ---------------------------
# #########################################################################
Subprog TEST_READ_MQ( )

Local File AQCDBTYPES [ABV]
Local Integer R0, R

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 50
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

Filter [ABV] Order by key CLE=IDX;C5

Read [ABV]CLE>=202;49
Call CHECK_EQUAL( [ABV]IDX, 202) From AXUNIT

Read [ABV]CLE>=200;49
Call CHECK_EQUAL( [ABV]IDX, 201) From AXUNIT

End

# ----------------------  TEST SQL ------------ ---------------------------
# #########################################################################
Subprog TEST_SQL( ) 	
	Local Integer TAB(1..10)
	Execsql From "3" Sql "Create Table ZZEXESQL( nn integer )"
	Execsql From "3" Sql "Drop Table ZZEXESQL"

	Anasql From "3" Sql "Select * from AABREV" Using TAB
	Call CHECK_EQUAL( TAB(1), 8) From AXUNIT
	Call CHECK_EQUAL( TAB(2), 4) From AXUNIT
	Call CHECK_EQUAL( TAB(3), 25) From AXUNIT
	Call CHECK_EQUAL( TAB(4), 40) From AXUNIT
	Call CHECK_EQUAL( TAB(5), 15) From AXUNIT
	Call CHECK_EQUAL( TAB(6), 15) From AXUNIT
	Call CHECK_EQUAL( TAB(7), 526) From AXUNIT
	Call CHECK_EQUAL( TAB(8), 526) From AXUNIT
	Call CHECK_EQUAL( TAB(9), 525) From AXUNIT

	Call CHECK_EQUAL( "ok", "ok") From AXUNIT
End

# ----------------------  TEST SQL ------------ ---------------------------
# #########################################################################
Subprog TEST_FORSQL( ) 
	#dbgetna
	For (Char V0(30), Char V1(30)) From "3" Sql "Select ABREV_0, MOT_0 from SUPERV.AABREV" As [ABV]
    	Infbox [ABV]V0-[ABV]V1
	Next

	Call CHECK_EQUAL( "ok", "ok") From AXUNIT
End

# ----------------------  TEST SQL ------------ ---------------------------
# #########################################################################
Subprog TEST_FORFROMTO( ) 

Local File AQCDBTYPES [ABV]
Local Integer K(3), I

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 50
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 204
[ABV]C5 = 15129
[ABV]A10 = "A5"
[ABV]A250 = "A122546"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 205
[ABV]C5 = 15130
[ABV]A10 = "A6"
[ABV]A250 = "A122547"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]


Commit

K(0)=202
K(1)=203
K(2)=204
For [ABV] From 202 to 204
	Call CHECK_EQUAL( K(I), [ABV]IDX) From AXUNIT	
	I+=1
Next

Call CHECK_EQUAL( "ok", "ok") From AXUNIT
	
End

# ----------------------  TEST SQL ------------ ---------------------------
# #########################################################################
Subprog TEST_COLUMNS( ) 
Local File AQCDBTYPES [ABV]
Local Integer K(5), C(5), I

trbegin [ABV]
delete [ABV] Where 1=1
commit

Trbegin [ABV]
[ABV]IDX = 201
[ABV]C5 = 15126
[ABV]A10 = "A2"
[ABV]A250 = "A121"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

#
Write [ABV]

[ABV]IDX = 202
[ABV]C5 = 15127
[ABV]A10 = "A3"
[ABV]A250 = "A121545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 203
[ABV]C5 = 15128
[ABV]A10 = "A4"
[ABV]A250 = "A122545"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 204
[ABV]C5 = 15129
[ABV]A10 = "A5"
[ABV]A250 = "A122546"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]

[ABV]IDX = 205
[ABV]C5 = 15130
[ABV]A10 = "A6"
[ABV]A250 = "A122547"
#[ABV]DTM = [04/02/2015]
[ABV]L8 = 154654
[ABV]DCB9_2 = 124521.215112
[ABV]CREDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]UPDDATTIM = gdatetime$("2015-07-01T10:30:32Z")
[ABV]CREUSR = "AQCOR"
[ABV]UPDUSR = "AQCOR"
[ABV]AUUID = touuid("288eadf8-43a6-4a15-8659-5330411430ea")

Write [ABV]
Commit

For I=0 To 4
	K(I) = 201+I
	C(I) = 15126+I
Next

Columns [F:ABV] (IDX, [ABV]C5, C5)

Read [ABV]=201
Call CHECK_EQUAL( [ABV]IDX, 201) From AXUNIT
Call CHECK_EQUAL( [ABV]C5, 15126) From AXUNIT
Call CHECK_EQUAL( [ABV]A10, "A2") From AXUNIT
I=0
For [ABV]
	Call CHECK_EQUAL( [ABV]IDX, K(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5,  C(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]A10, "A2") From AXUNIT
	I+=1
Next

Columns [F:ABV] (IDX, [ABV]C5) Extended
#dbgetna
Read [ABV]=202
Call CHECK_EQUAL( [ABV]A10, "A2") From AXUNIT

[ABV]L8 = 0
I=0
For [ABV] Where L8 = 154654
	Call CHECK_EQUAL( [ABV]IDX, K(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5,  C(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]A10, "A2") From AXUNIT
	Call CHECK_EQUAL( [ABV]L8, 154654) From AXUNIT
	I+=1
Next

I=0


For [ABV] Where L8 = 154654
Trbegin [ABV]
	Readlock [ABV] Curr
	Rewrite [ABV]
	I+=1
Commit
Next


I=0
For [ABV] Where L8 = 154654
	Call CHECK_EQUAL( [ABV]IDX, K(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]C5,  C(I)) From AXUNIT
	Call CHECK_EQUAL( [ABV]A10, "A2") From AXUNIT
	Call CHECK_EQUAL( [ABV]L8, 154654) From AXUNIT
	I+=1
Next

Columns [F:ABV]
Close Local File [ABV]

Call CHECK_EQUAL( "ok", "ok") From AXUNIT
End

